(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function a(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=a(o);fetch(o.href,s)}})();function On(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Gi(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function pr(e){let t,a,r;e.length!==2?(t=On,a=(l,c)=>On(e(l),c),r=(l,c)=>e(l)-c):(t=e===On||e===Gi?e:Qi,a=e,r=e);function o(l,c,d=0,u=l.length){if(d<u){if(t(c,c)!==0)return u;do{const f=d+u>>>1;a(l[f],c)<0?d=f+1:u=f}while(d<u)}return d}function s(l,c,d=0,u=l.length){if(d<u){if(t(c,c)!==0)return u;do{const f=d+u>>>1;a(l[f],c)<=0?d=f+1:u=f}while(d<u)}return d}function i(l,c,d=0,u=l.length){const f=o(l,c,d,u-1);return f>d&&r(l[f-1],c)>-r(l[f],c)?f-1:f}return{left:o,center:i,right:s}}function Qi(){return 0}function Po(e){return e===null?NaN:+e}const Zi=pr(On),Ji=Zi.right;pr(Po).center;const es=Math.sqrt(50),ts=Math.sqrt(10),ns=Math.sqrt(2);function ea(e,t,a){const r=(t-e)/Math.max(0,a),o=Math.floor(Math.log10(r)),s=r/Math.pow(10,o),i=s>=es?10:s>=ts?5:s>=ns?2:1;let l,c,d;return o<0?(d=Math.pow(10,-o)/i,l=Math.round(e*d),c=Math.round(t*d),l/d<e&&++l,c/d>t&&--c,d=-d):(d=Math.pow(10,o)*i,l=Math.round(e/d),c=Math.round(t/d),l*d<e&&++l,c*d>t&&--c),c<l&&.5<=a&&a<2?ea(e,t,a*2):[l,c,d]}function as(e,t,a){if(t=+t,e=+e,a=+a,!(a>0))return[];if(e===t)return[e];const r=t<e,[o,s,i]=r?ea(t,e,a):ea(e,t,a);if(!(s>=o))return[];const l=s-o+1,c=new Array(l);if(r)if(i<0)for(let d=0;d<l;++d)c[d]=(s-d)/-i;else for(let d=0;d<l;++d)c[d]=(s-d)*i;else if(i<0)for(let d=0;d<l;++d)c[d]=(o+d)/-i;else for(let d=0;d<l;++d)c[d]=(o+d)*i;return c}function Ya(e,t,a){return t=+t,e=+e,a=+a,ea(e,t,a)[2]}function Xa(e,t,a){t=+t,e=+e,a=+a;const r=t<e,o=r?Ya(t,e,a):Ya(e,t,a);return(r?-1:1)*(o<0?1/-o:o)}function rs(e,t){let a;for(const r of e)r!=null&&(a<r||a===void 0&&r>=r)&&(a=r);return a}function os(e,t){let a;for(const r of e)r!=null&&(a>r||a===void 0&&r>=r)&&(a=r);return a}function _a(e,t,a=Po){if(!(!(r=e.length)||isNaN(t=+t))){if(t<=0||r<2)return+a(e[0],0,e);if(t>=1)return+a(e[r-1],r-1,e);var r,o=(r-1)*t,s=Math.floor(o),i=+a(e[s],s,e),l=+a(e[s+1],s+1,e);return i+(l-i)*(o-s)}}function is(e,t){let a=0,r=0;for(let o of e)o!=null&&(o=+o)>=o&&(++a,r+=o);if(a)return r/a}var ss={value:()=>{}};function mr(){for(var e=0,t=arguments.length,a={},r;e<t;++e){if(!(r=arguments[e]+"")||r in a||/[\s.]/.test(r))throw new Error("illegal type: "+r);a[r]=[]}return new qn(a)}function qn(e){this._=e}function ls(e,t){return e.trim().split(/^|\s+/).map(function(a){var r="",o=a.indexOf(".");if(o>=0&&(r=a.slice(o+1),a=a.slice(0,o)),a&&!t.hasOwnProperty(a))throw new Error("unknown type: "+a);return{type:a,name:r}})}qn.prototype=mr.prototype={constructor:qn,on:function(e,t){var a=this._,r=ls(e+"",a),o,s=-1,i=r.length;if(arguments.length<2){for(;++s<i;)if((o=(e=r[s]).type)&&(o=cs(a[o],e.name)))return o;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++s<i;)if(o=(e=r[s]).type)a[o]=Nr(a[o],e.name,t);else if(t==null)for(o in a)a[o]=Nr(a[o],e.name,null);return this},copy:function(){var e={},t=this._;for(var a in t)e[a]=t[a].slice();return new qn(e)},call:function(e,t){if((o=arguments.length-2)>0)for(var a=new Array(o),r=0,o,s;r<o;++r)a[r]=arguments[r+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(s=this._[e],r=0,o=s.length;r<o;++r)s[r].value.apply(t,a)},apply:function(e,t,a){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],o=0,s=r.length;o<s;++o)r[o].value.apply(t,a)}};function cs(e,t){for(var a=0,r=e.length,o;a<r;++a)if((o=e[a]).name===t)return o.value}function Nr(e,t,a){for(var r=0,o=e.length;r<o;++r)if(e[r].name===t){e[r]=ss,e=e.slice(0,r).concat(e.slice(r+1));break}return a!=null&&e.push({name:t,value:a}),e}var ja="http://www.w3.org/1999/xhtml";const Br={svg:"http://www.w3.org/2000/svg",xhtml:ja,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function xa(e){var t=e+="",a=t.indexOf(":");return a>=0&&(t=e.slice(0,a))!=="xmlns"&&(e=e.slice(a+1)),Br.hasOwnProperty(t)?{space:Br[t],local:e}:e}function ds(e){return function(){var t=this.ownerDocument,a=this.namespaceURI;return a===ja&&t.documentElement.namespaceURI===ja?t.createElement(e):t.createElementNS(a,e)}}function us(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function _o(e){var t=xa(e);return(t.local?us:ds)(t)}function fs(){}function gr(e){return e==null?fs:function(){return this.querySelector(e)}}function hs(e){typeof e!="function"&&(e=gr(e));for(var t=this._groups,a=t.length,r=new Array(a),o=0;o<a;++o)for(var s=t[o],i=s.length,l=r[o]=new Array(i),c,d,u=0;u<i;++u)(c=s[u])&&(d=e.call(c,c.__data__,u,s))&&("__data__"in c&&(d.__data__=c.__data__),l[u]=d);return new Be(r,this._parents)}function ps(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function ms(){return[]}function Io(e){return e==null?ms:function(){return this.querySelectorAll(e)}}function gs(e){return function(){return ps(e.apply(this,arguments))}}function ys(e){typeof e=="function"?e=gs(e):e=Io(e);for(var t=this._groups,a=t.length,r=[],o=[],s=0;s<a;++s)for(var i=t[s],l=i.length,c,d=0;d<l;++d)(c=i[d])&&(r.push(e.call(c,c.__data__,d,i)),o.push(c));return new Be(r,o)}function Ao(e){return function(){return this.matches(e)}}function No(e){return function(t){return t.matches(e)}}var vs=Array.prototype.find;function bs(e){return function(){return vs.call(this.children,e)}}function xs(){return this.firstElementChild}function ws(e){return this.select(e==null?xs:bs(typeof e=="function"?e:No(e)))}var Ss=Array.prototype.filter;function Ms(){return Array.from(this.children)}function $s(e){return function(){return Ss.call(this.children,e)}}function ks(e){return this.selectAll(e==null?Ms:$s(typeof e=="function"?e:No(e)))}function Ds(e){typeof e!="function"&&(e=Ao(e));for(var t=this._groups,a=t.length,r=new Array(a),o=0;o<a;++o)for(var s=t[o],i=s.length,l=r[o]=[],c,d=0;d<i;++d)(c=s[d])&&e.call(c,c.__data__,d,s)&&l.push(c);return new Be(r,this._parents)}function Bo(e){return new Array(e.length)}function Ts(){return new Be(this._enter||this._groups.map(Bo),this._parents)}function ta(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}ta.prototype={constructor:ta,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function Ls(e){return function(){return e}}function Es(e,t,a,r,o,s){for(var i=0,l,c=t.length,d=s.length;i<d;++i)(l=t[i])?(l.__data__=s[i],r[i]=l):a[i]=new ta(e,s[i]);for(;i<c;++i)(l=t[i])&&(o[i]=l)}function Rs(e,t,a,r,o,s,i){var l,c,d=new Map,u=t.length,f=s.length,h=new Array(u),p;for(l=0;l<u;++l)(c=t[l])&&(h[l]=p=i.call(c,c.__data__,l,t)+"",d.has(p)?o[l]=c:d.set(p,c));for(l=0;l<f;++l)p=i.call(e,s[l],l,s)+"",(c=d.get(p))?(r[l]=c,c.__data__=s[l],d.delete(p)):a[l]=new ta(e,s[l]);for(l=0;l<u;++l)(c=t[l])&&d.get(h[l])===c&&(o[l]=c)}function Cs(e){return e.__data__}function Ps(e,t){if(!arguments.length)return Array.from(this,Cs);var a=t?Rs:Es,r=this._parents,o=this._groups;typeof e!="function"&&(e=Ls(e));for(var s=o.length,i=new Array(s),l=new Array(s),c=new Array(s),d=0;d<s;++d){var u=r[d],f=o[d],h=f.length,p=_s(e.call(u,u&&u.__data__,d,r)),x=p.length,T=l[d]=new Array(x),k=i[d]=new Array(x),w=c[d]=new Array(h);a(u,f,T,k,w,p,t);for(var v=0,L=0,R,$;v<x;++v)if(R=T[v]){for(v>=L&&(L=v+1);!($=k[L])&&++L<x;);R._next=$||null}}return i=new Be(i,r),i._enter=l,i._exit=c,i}function _s(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Is(){return new Be(this._exit||this._groups.map(Bo),this._parents)}function As(e,t,a){var r=this.enter(),o=this,s=this.exit();return typeof e=="function"?(r=e(r),r&&(r=r.selection())):r=r.append(e+""),t!=null&&(o=t(o),o&&(o=o.selection())),a==null?s.remove():a(s),r&&o?r.merge(o).order():o}function Ns(e){for(var t=e.selection?e.selection():e,a=this._groups,r=t._groups,o=a.length,s=r.length,i=Math.min(o,s),l=new Array(o),c=0;c<i;++c)for(var d=a[c],u=r[c],f=d.length,h=l[c]=new Array(f),p,x=0;x<f;++x)(p=d[x]||u[x])&&(h[x]=p);for(;c<o;++c)l[c]=a[c];return new Be(l,this._parents)}function Bs(){for(var e=this._groups,t=-1,a=e.length;++t<a;)for(var r=e[t],o=r.length-1,s=r[o],i;--o>=0;)(i=r[o])&&(s&&i.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(i,s),s=i);return this}function Fs(e){e||(e=Us);function t(f,h){return f&&h?e(f.__data__,h.__data__):!f-!h}for(var a=this._groups,r=a.length,o=new Array(r),s=0;s<r;++s){for(var i=a[s],l=i.length,c=o[s]=new Array(l),d,u=0;u<l;++u)(d=i[u])&&(c[u]=d);c.sort(t)}return new Be(o,this._parents).order()}function Us(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Vs(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function Os(){return Array.from(this)}function qs(){for(var e=this._groups,t=0,a=e.length;t<a;++t)for(var r=e[t],o=0,s=r.length;o<s;++o){var i=r[o];if(i)return i}return null}function zs(){let e=0;for(const t of this)++e;return e}function Hs(){return!this.node()}function Ws(e){for(var t=this._groups,a=0,r=t.length;a<r;++a)for(var o=t[a],s=0,i=o.length,l;s<i;++s)(l=o[s])&&e.call(l,l.__data__,s,o);return this}function Ys(e){return function(){this.removeAttribute(e)}}function Xs(e){return function(){this.removeAttributeNS(e.space,e.local)}}function js(e,t){return function(){this.setAttribute(e,t)}}function Ks(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Gs(e,t){return function(){var a=t.apply(this,arguments);a==null?this.removeAttribute(e):this.setAttribute(e,a)}}function Qs(e,t){return function(){var a=t.apply(this,arguments);a==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,a)}}function Zs(e,t){var a=xa(e);if(arguments.length<2){var r=this.node();return a.local?r.getAttributeNS(a.space,a.local):r.getAttribute(a)}return this.each((t==null?a.local?Xs:Ys:typeof t=="function"?a.local?Qs:Gs:a.local?Ks:js)(a,t))}function Fo(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Js(e){return function(){this.style.removeProperty(e)}}function el(e,t,a){return function(){this.style.setProperty(e,t,a)}}function tl(e,t,a){return function(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(e):this.style.setProperty(e,r,a)}}function nl(e,t,a){return arguments.length>1?this.each((t==null?Js:typeof t=="function"?tl:el)(e,t,a??"")):Qt(this.node(),e)}function Qt(e,t){return e.style.getPropertyValue(t)||Fo(e).getComputedStyle(e,null).getPropertyValue(t)}function al(e){return function(){delete this[e]}}function rl(e,t){return function(){this[e]=t}}function ol(e,t){return function(){var a=t.apply(this,arguments);a==null?delete this[e]:this[e]=a}}function il(e,t){return arguments.length>1?this.each((t==null?al:typeof t=="function"?ol:rl)(e,t)):this.node()[e]}function Uo(e){return e.trim().split(/^|\s+/)}function yr(e){return e.classList||new Vo(e)}function Vo(e){this._node=e,this._names=Uo(e.getAttribute("class")||"")}Vo.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function Oo(e,t){for(var a=yr(e),r=-1,o=t.length;++r<o;)a.add(t[r])}function qo(e,t){for(var a=yr(e),r=-1,o=t.length;++r<o;)a.remove(t[r])}function sl(e){return function(){Oo(this,e)}}function ll(e){return function(){qo(this,e)}}function cl(e,t){return function(){(t.apply(this,arguments)?Oo:qo)(this,e)}}function dl(e,t){var a=Uo(e+"");if(arguments.length<2){for(var r=yr(this.node()),o=-1,s=a.length;++o<s;)if(!r.contains(a[o]))return!1;return!0}return this.each((typeof t=="function"?cl:t?sl:ll)(a,t))}function ul(){this.textContent=""}function fl(e){return function(){this.textContent=e}}function hl(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function pl(e){return arguments.length?this.each(e==null?ul:(typeof e=="function"?hl:fl)(e)):this.node().textContent}function ml(){this.innerHTML=""}function gl(e){return function(){this.innerHTML=e}}function yl(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function vl(e){return arguments.length?this.each(e==null?ml:(typeof e=="function"?yl:gl)(e)):this.node().innerHTML}function bl(){this.nextSibling&&this.parentNode.appendChild(this)}function xl(){return this.each(bl)}function wl(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Sl(){return this.each(wl)}function Ml(e){var t=typeof e=="function"?e:_o(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function $l(){return null}function kl(e,t){var a=typeof e=="function"?e:_o(e),r=t==null?$l:typeof t=="function"?t:gr(t);return this.select(function(){return this.insertBefore(a.apply(this,arguments),r.apply(this,arguments)||null)})}function Dl(){var e=this.parentNode;e&&e.removeChild(this)}function Tl(){return this.each(Dl)}function Ll(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function El(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Rl(e){return this.select(e?El:Ll)}function Cl(e){return arguments.length?this.property("__data__",e):this.node().__data__}function Pl(e){return function(t){e.call(this,t,this.__data__)}}function _l(e){return e.trim().split(/^|\s+/).map(function(t){var a="",r=t.indexOf(".");return r>=0&&(a=t.slice(r+1),t=t.slice(0,r)),{type:t,name:a}})}function Il(e){return function(){var t=this.__on;if(t){for(var a=0,r=-1,o=t.length,s;a<o;++a)s=t[a],(!e.type||s.type===e.type)&&s.name===e.name?this.removeEventListener(s.type,s.listener,s.options):t[++r]=s;++r?t.length=r:delete this.__on}}}function Al(e,t,a){return function(){var r=this.__on,o,s=Pl(t);if(r){for(var i=0,l=r.length;i<l;++i)if((o=r[i]).type===e.type&&o.name===e.name){this.removeEventListener(o.type,o.listener,o.options),this.addEventListener(o.type,o.listener=s,o.options=a),o.value=t;return}}this.addEventListener(e.type,s,a),o={type:e.type,name:e.name,value:t,listener:s,options:a},r?r.push(o):this.__on=[o]}}function Nl(e,t,a){var r=_l(e+""),o,s=r.length,i;if(arguments.length<2){var l=this.node().__on;if(l){for(var c=0,d=l.length,u;c<d;++c)for(o=0,u=l[c];o<s;++o)if((i=r[o]).type===u.type&&i.name===u.name)return u.value}return}for(l=t?Al:Il,o=0;o<s;++o)this.each(l(r[o],t,a));return this}function zo(e,t,a){var r=Fo(e),o=r.CustomEvent;typeof o=="function"?o=new o(t,a):(o=r.document.createEvent("Event"),a?(o.initEvent(t,a.bubbles,a.cancelable),o.detail=a.detail):o.initEvent(t,!1,!1)),e.dispatchEvent(o)}function Bl(e,t){return function(){return zo(this,e,t)}}function Fl(e,t){return function(){return zo(this,e,t.apply(this,arguments))}}function Ul(e,t){return this.each((typeof t=="function"?Fl:Bl)(e,t))}function*Vl(){for(var e=this._groups,t=0,a=e.length;t<a;++t)for(var r=e[t],o=0,s=r.length,i;o<s;++o)(i=r[o])&&(yield i)}var Ho=[null];function Be(e,t){this._groups=e,this._parents=t}function Tn(){return new Be([[document.documentElement]],Ho)}function Ol(){return this}Be.prototype=Tn.prototype={constructor:Be,select:hs,selectAll:ys,selectChild:ws,selectChildren:ks,filter:Ds,data:Ps,enter:Ts,exit:Is,join:As,merge:Ns,selection:Ol,order:Bs,sort:Fs,call:Vs,nodes:Os,node:qs,size:zs,empty:Hs,each:Ws,attr:Zs,style:nl,property:il,classed:dl,text:pl,html:vl,raise:xl,lower:Sl,append:Ml,insert:kl,remove:Tl,clone:Rl,datum:Cl,on:Nl,dispatch:Ul,[Symbol.iterator]:Vl};function nt(e){return typeof e=="string"?new Be([[document.querySelector(e)]],[document.documentElement]):new Be([[e]],Ho)}function ql(e){let t;for(;t=e.sourceEvent;)e=t;return e}function ht(e,t){if(e=ql(e),t===void 0&&(t=e.currentTarget),t){var a=t.ownerSVGElement||t;if(a.createSVGPoint){var r=a.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,r=r.matrixTransform(t.getScreenCTM().inverse()),[r.x,r.y]}if(t.getBoundingClientRect){var o=t.getBoundingClientRect();return[e.clientX-o.left-t.clientLeft,e.clientY-o.top-t.clientTop]}}return[e.pageX,e.pageY]}const Ka={capture:!0,passive:!1};function Ga(e){e.preventDefault(),e.stopImmediatePropagation()}function zl(e){var t=e.document.documentElement,a=nt(e).on("dragstart.drag",Ga,Ka);"onselectstart"in t?a.on("selectstart.drag",Ga,Ka):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Hl(e,t){var a=e.document.documentElement,r=nt(e).on("dragstart.drag",null);t&&(r.on("click.drag",Ga,Ka),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in a?r.on("selectstart.drag",null):(a.style.MozUserSelect=a.__noselect,delete a.__noselect)}function vr(e,t,a){e.prototype=t.prototype=a,a.constructor=e}function Wo(e,t){var a=Object.create(e.prototype);for(var r in t)a[r]=t[r];return a}function Ln(){}var wn=.7,na=1/wn,Xt="\\s*([+-]?\\d+)\\s*",Sn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Xe="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Wl=/^#([0-9a-f]{3,8})$/,Yl=new RegExp(`^rgb\\(${Xt},${Xt},${Xt}\\)$`),Xl=new RegExp(`^rgb\\(${Xe},${Xe},${Xe}\\)$`),jl=new RegExp(`^rgba\\(${Xt},${Xt},${Xt},${Sn}\\)$`),Kl=new RegExp(`^rgba\\(${Xe},${Xe},${Xe},${Sn}\\)$`),Gl=new RegExp(`^hsl\\(${Sn},${Xe},${Xe}\\)$`),Ql=new RegExp(`^hsla\\(${Sn},${Xe},${Xe},${Sn}\\)$`),Fr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};vr(Ln,_t,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Ur,formatHex:Ur,formatHex8:Zl,formatHsl:Jl,formatRgb:Vr,toString:Vr});function Ur(){return this.rgb().formatHex()}function Zl(){return this.rgb().formatHex8()}function Jl(){return Yo(this).formatHsl()}function Vr(){return this.rgb().formatRgb()}function _t(e){var t,a;return e=(e+"").trim().toLowerCase(),(t=Wl.exec(e))?(a=t[1].length,t=parseInt(t[1],16),a===6?Or(t):a===3?new Ie(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):a===8?_n(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):a===4?_n(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Yl.exec(e))?new Ie(t[1],t[2],t[3],1):(t=Xl.exec(e))?new Ie(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=jl.exec(e))?_n(t[1],t[2],t[3],t[4]):(t=Kl.exec(e))?_n(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Gl.exec(e))?Hr(t[1],t[2]/100,t[3]/100,1):(t=Ql.exec(e))?Hr(t[1],t[2]/100,t[3]/100,t[4]):Fr.hasOwnProperty(e)?Or(Fr[e]):e==="transparent"?new Ie(NaN,NaN,NaN,0):null}function Or(e){return new Ie(e>>16&255,e>>8&255,e&255,1)}function _n(e,t,a,r){return r<=0&&(e=t=a=NaN),new Ie(e,t,a,r)}function ec(e){return e instanceof Ln||(e=_t(e)),e?(e=e.rgb(),new Ie(e.r,e.g,e.b,e.opacity)):new Ie}function Qa(e,t,a,r){return arguments.length===1?ec(e):new Ie(e,t,a,r??1)}function Ie(e,t,a,r){this.r=+e,this.g=+t,this.b=+a,this.opacity=+r}vr(Ie,Qa,Wo(Ln,{brighter(e){return e=e==null?na:Math.pow(na,e),new Ie(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?wn:Math.pow(wn,e),new Ie(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Ie(Pt(this.r),Pt(this.g),Pt(this.b),aa(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:qr,formatHex:qr,formatHex8:tc,formatRgb:zr,toString:zr}));function qr(){return`#${Lt(this.r)}${Lt(this.g)}${Lt(this.b)}`}function tc(){return`#${Lt(this.r)}${Lt(this.g)}${Lt(this.b)}${Lt((isNaN(this.opacity)?1:this.opacity)*255)}`}function zr(){const e=aa(this.opacity);return`${e===1?"rgb(":"rgba("}${Pt(this.r)}, ${Pt(this.g)}, ${Pt(this.b)}${e===1?")":`, ${e})`}`}function aa(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Pt(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Lt(e){return e=Pt(e),(e<16?"0":"")+e.toString(16)}function Hr(e,t,a,r){return r<=0?e=t=a=NaN:a<=0||a>=1?e=t=NaN:t<=0&&(e=NaN),new He(e,t,a,r)}function Yo(e){if(e instanceof He)return new He(e.h,e.s,e.l,e.opacity);if(e instanceof Ln||(e=_t(e)),!e)return new He;if(e instanceof He)return e;e=e.rgb();var t=e.r/255,a=e.g/255,r=e.b/255,o=Math.min(t,a,r),s=Math.max(t,a,r),i=NaN,l=s-o,c=(s+o)/2;return l?(t===s?i=(a-r)/l+(a<r)*6:a===s?i=(r-t)/l+2:i=(t-a)/l+4,l/=c<.5?s+o:2-s-o,i*=60):l=c>0&&c<1?0:i,new He(i,l,c,e.opacity)}function nc(e,t,a,r){return arguments.length===1?Yo(e):new He(e,t,a,r??1)}function He(e,t,a,r){this.h=+e,this.s=+t,this.l=+a,this.opacity=+r}vr(He,nc,Wo(Ln,{brighter(e){return e=e==null?na:Math.pow(na,e),new He(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?wn:Math.pow(wn,e),new He(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,a=this.l,r=a+(a<.5?a:1-a)*t,o=2*a-r;return new Ie(Ia(e>=240?e-240:e+120,o,r),Ia(e,o,r),Ia(e<120?e+240:e-120,o,r),this.opacity)},clamp(){return new He(Wr(this.h),In(this.s),In(this.l),aa(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=aa(this.opacity);return`${e===1?"hsl(":"hsla("}${Wr(this.h)}, ${In(this.s)*100}%, ${In(this.l)*100}%${e===1?")":`, ${e})`}`}}));function Wr(e){return e=(e||0)%360,e<0?e+360:e}function In(e){return Math.max(0,Math.min(1,e||0))}function Ia(e,t,a){return(e<60?t+(a-t)*e/60:e<180?a:e<240?t+(a-t)*(240-e)/60:t)*255}const br=e=>()=>e;function ac(e,t){return function(a){return e+a*t}}function rc(e,t,a){return e=Math.pow(e,a),t=Math.pow(t,a)-e,a=1/a,function(r){return Math.pow(e+r*t,a)}}function oc(e){return(e=+e)==1?Xo:function(t,a){return a-t?rc(t,a,e):br(isNaN(t)?a:t)}}function Xo(e,t){var a=t-e;return a?ac(e,a):br(isNaN(e)?t:e)}const ra=(function e(t){var a=oc(t);function r(o,s){var i=a((o=Qa(o)).r,(s=Qa(s)).r),l=a(o.g,s.g),c=a(o.b,s.b),d=Xo(o.opacity,s.opacity);return function(u){return o.r=i(u),o.g=l(u),o.b=c(u),o.opacity=d(u),o+""}}return r.gamma=e,r})(1);function ic(e,t){t||(t=[]);var a=e?Math.min(t.length,e.length):0,r=t.slice(),o;return function(s){for(o=0;o<a;++o)r[o]=e[o]*(1-s)+t[o]*s;return r}}function sc(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function lc(e,t){var a=t?t.length:0,r=e?Math.min(a,e.length):0,o=new Array(r),s=new Array(a),i;for(i=0;i<r;++i)o[i]=xr(e[i],t[i]);for(;i<a;++i)s[i]=t[i];return function(l){for(i=0;i<r;++i)s[i]=o[i](l);return s}}function cc(e,t){var a=new Date;return e=+e,t=+t,function(r){return a.setTime(e*(1-r)+t*r),a}}function ze(e,t){return e=+e,t=+t,function(a){return e*(1-a)+t*a}}function dc(e,t){var a={},r={},o;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(o in t)o in e?a[o]=xr(e[o],t[o]):r[o]=t[o];return function(s){for(o in a)r[o]=a[o](s);return r}}var Za=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Aa=new RegExp(Za.source,"g");function uc(e){return function(){return e}}function fc(e){return function(t){return e(t)+""}}function jo(e,t){var a=Za.lastIndex=Aa.lastIndex=0,r,o,s,i=-1,l=[],c=[];for(e=e+"",t=t+"";(r=Za.exec(e))&&(o=Aa.exec(t));)(s=o.index)>a&&(s=t.slice(a,s),l[i]?l[i]+=s:l[++i]=s),(r=r[0])===(o=o[0])?l[i]?l[i]+=o:l[++i]=o:(l[++i]=null,c.push({i,x:ze(r,o)})),a=Aa.lastIndex;return a<t.length&&(s=t.slice(a),l[i]?l[i]+=s:l[++i]=s),l.length<2?c[0]?fc(c[0].x):uc(t):(t=c.length,function(d){for(var u=0,f;u<t;++u)l[(f=c[u]).i]=f.x(d);return l.join("")})}function xr(e,t){var a=typeof t,r;return t==null||a==="boolean"?br(t):(a==="number"?ze:a==="string"?(r=_t(t))?(t=r,ra):jo:t instanceof _t?ra:t instanceof Date?cc:sc(t)?ic:Array.isArray(t)?lc:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?dc:ze)(e,t)}function hc(e,t){return e=+e,t=+t,function(a){return Math.round(e*(1-a)+t*a)}}var Yr=180/Math.PI,Ja={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Ko(e,t,a,r,o,s){var i,l,c;return(i=Math.sqrt(e*e+t*t))&&(e/=i,t/=i),(c=e*a+t*r)&&(a-=e*c,r-=t*c),(l=Math.sqrt(a*a+r*r))&&(a/=l,r/=l,c/=l),e*r<t*a&&(e=-e,t=-t,c=-c,i=-i),{translateX:o,translateY:s,rotate:Math.atan2(t,e)*Yr,skewX:Math.atan(c)*Yr,scaleX:i,scaleY:l}}var An;function pc(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Ja:Ko(t.a,t.b,t.c,t.d,t.e,t.f)}function mc(e){return e==null||(An||(An=document.createElementNS("http://www.w3.org/2000/svg","g")),An.setAttribute("transform",e),!(e=An.transform.baseVal.consolidate()))?Ja:(e=e.matrix,Ko(e.a,e.b,e.c,e.d,e.e,e.f))}function Go(e,t,a,r){function o(d){return d.length?d.pop()+" ":""}function s(d,u,f,h,p,x){if(d!==f||u!==h){var T=p.push("translate(",null,t,null,a);x.push({i:T-4,x:ze(d,f)},{i:T-2,x:ze(u,h)})}else(f||h)&&p.push("translate("+f+t+h+a)}function i(d,u,f,h){d!==u?(d-u>180?u+=360:u-d>180&&(d+=360),h.push({i:f.push(o(f)+"rotate(",null,r)-2,x:ze(d,u)})):u&&f.push(o(f)+"rotate("+u+r)}function l(d,u,f,h){d!==u?h.push({i:f.push(o(f)+"skewX(",null,r)-2,x:ze(d,u)}):u&&f.push(o(f)+"skewX("+u+r)}function c(d,u,f,h,p,x){if(d!==f||u!==h){var T=p.push(o(p)+"scale(",null,",",null,")");x.push({i:T-4,x:ze(d,f)},{i:T-2,x:ze(u,h)})}else(f!==1||h!==1)&&p.push(o(p)+"scale("+f+","+h+")")}return function(d,u){var f=[],h=[];return d=e(d),u=e(u),s(d.translateX,d.translateY,u.translateX,u.translateY,f,h),i(d.rotate,u.rotate,f,h),l(d.skewX,u.skewX,f,h),c(d.scaleX,d.scaleY,u.scaleX,u.scaleY,f,h),d=u=null,function(p){for(var x=-1,T=h.length,k;++x<T;)f[(k=h[x]).i]=k.x(p);return f.join("")}}}var gc=Go(pc,"px, ","px)","deg)"),yc=Go(mc,", ",")",")"),vc=1e-12;function Xr(e){return((e=Math.exp(e))+1/e)/2}function bc(e){return((e=Math.exp(e))-1/e)/2}function xc(e){return((e=Math.exp(2*e))-1)/(e+1)}const wc=(function e(t,a,r){function o(s,i){var l=s[0],c=s[1],d=s[2],u=i[0],f=i[1],h=i[2],p=u-l,x=f-c,T=p*p+x*x,k,w;if(T<vc)w=Math.log(h/d)/t,k=function(F){return[l+F*p,c+F*x,d*Math.exp(t*F*w)]};else{var v=Math.sqrt(T),L=(h*h-d*d+r*T)/(2*d*a*v),R=(h*h-d*d-r*T)/(2*h*a*v),$=Math.log(Math.sqrt(L*L+1)-L),D=Math.log(Math.sqrt(R*R+1)-R);w=(D-$)/t,k=function(F){var N=F*w,X=Xr($),j=d/(a*v)*(X*xc(t*N+$)-bc($));return[l+j*p,c+j*x,d*X/Xr(t*N+$)]}}return k.duration=w*1e3*t/Math.SQRT2,k}return o.rho=function(s){var i=Math.max(.001,+s),l=i*i,c=l*l;return e(i,l,c)},o})(Math.SQRT2,2,4);var Zt=0,hn=0,on=0,Qo=1e3,oa,pn,ia=0,It=0,wa=0,Mn=typeof performance=="object"&&performance.now?performance:Date,Zo=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function wr(){return It||(Zo(Sc),It=Mn.now()+wa)}function Sc(){It=0}function sa(){this._call=this._time=this._next=null}sa.prototype=Jo.prototype={constructor:sa,restart:function(e,t,a){if(typeof e!="function")throw new TypeError("callback is not a function");a=(a==null?wr():+a)+(t==null?0:+t),!this._next&&pn!==this&&(pn?pn._next=this:oa=this,pn=this),this._call=e,this._time=a,er()},stop:function(){this._call&&(this._call=null,this._time=1/0,er())}};function Jo(e,t,a){var r=new sa;return r.restart(e,t,a),r}function Mc(){wr(),++Zt;for(var e=oa,t;e;)(t=It-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Zt}function jr(){It=(ia=Mn.now())+wa,Zt=hn=0;try{Mc()}finally{Zt=0,kc(),It=0}}function $c(){var e=Mn.now(),t=e-ia;t>Qo&&(wa-=t,ia=e)}function kc(){for(var e,t=oa,a,r=1/0;t;)t._call?(r>t._time&&(r=t._time),e=t,t=t._next):(a=t._next,t._next=null,t=e?e._next=a:oa=a);pn=e,er(r)}function er(e){if(!Zt){hn&&(hn=clearTimeout(hn));var t=e-It;t>24?(e<1/0&&(hn=setTimeout(jr,e-Mn.now()-wa)),on&&(on=clearInterval(on))):(on||(ia=Mn.now(),on=setInterval($c,Qo)),Zt=1,Zo(jr))}}function Kr(e,t,a){var r=new sa;return t=t==null?0:+t,r.restart(o=>{r.stop(),e(o+t)},t,a),r}var Dc=mr("start","end","cancel","interrupt"),Tc=[],ei=0,Gr=1,tr=2,zn=3,Qr=4,nr=5,Hn=6;function Sa(e,t,a,r,o,s){var i=e.__transition;if(!i)e.__transition={};else if(a in i)return;Lc(e,a,{name:t,index:r,group:o,on:Dc,tween:Tc,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:ei})}function Sr(e,t){var a=We(e,t);if(a.state>ei)throw new Error("too late; already scheduled");return a}function Ke(e,t){var a=We(e,t);if(a.state>zn)throw new Error("too late; already running");return a}function We(e,t){var a=e.__transition;if(!a||!(a=a[t]))throw new Error("transition not found");return a}function Lc(e,t,a){var r=e.__transition,o;r[t]=a,a.timer=Jo(s,0,a.time);function s(d){a.state=Gr,a.timer.restart(i,a.delay,a.time),a.delay<=d&&i(d-a.delay)}function i(d){var u,f,h,p;if(a.state!==Gr)return c();for(u in r)if(p=r[u],p.name===a.name){if(p.state===zn)return Kr(i);p.state===Qr?(p.state=Hn,p.timer.stop(),p.on.call("interrupt",e,e.__data__,p.index,p.group),delete r[u]):+u<t&&(p.state=Hn,p.timer.stop(),p.on.call("cancel",e,e.__data__,p.index,p.group),delete r[u])}if(Kr(function(){a.state===zn&&(a.state=Qr,a.timer.restart(l,a.delay,a.time),l(d))}),a.state=tr,a.on.call("start",e,e.__data__,a.index,a.group),a.state===tr){for(a.state=zn,o=new Array(h=a.tween.length),u=0,f=-1;u<h;++u)(p=a.tween[u].value.call(e,e.__data__,a.index,a.group))&&(o[++f]=p);o.length=f+1}}function l(d){for(var u=d<a.duration?a.ease.call(null,d/a.duration):(a.timer.restart(c),a.state=nr,1),f=-1,h=o.length;++f<h;)o[f].call(e,u);a.state===nr&&(a.on.call("end",e,e.__data__,a.index,a.group),c())}function c(){a.state=Hn,a.timer.stop(),delete r[t];for(var d in r)return;delete e.__transition}}function Wn(e,t){var a=e.__transition,r,o,s=!0,i;if(a){t=t==null?null:t+"";for(i in a){if((r=a[i]).name!==t){s=!1;continue}o=r.state>tr&&r.state<nr,r.state=Hn,r.timer.stop(),r.on.call(o?"interrupt":"cancel",e,e.__data__,r.index,r.group),delete a[i]}s&&delete e.__transition}}function Ec(e){return this.each(function(){Wn(this,e)})}function Rc(e,t){var a,r;return function(){var o=Ke(this,e),s=o.tween;if(s!==a){r=a=s;for(var i=0,l=r.length;i<l;++i)if(r[i].name===t){r=r.slice(),r.splice(i,1);break}}o.tween=r}}function Cc(e,t,a){var r,o;if(typeof a!="function")throw new Error;return function(){var s=Ke(this,e),i=s.tween;if(i!==r){o=(r=i).slice();for(var l={name:t,value:a},c=0,d=o.length;c<d;++c)if(o[c].name===t){o[c]=l;break}c===d&&o.push(l)}s.tween=o}}function Pc(e,t){var a=this._id;if(e+="",arguments.length<2){for(var r=We(this.node(),a).tween,o=0,s=r.length,i;o<s;++o)if((i=r[o]).name===e)return i.value;return null}return this.each((t==null?Rc:Cc)(a,e,t))}function Mr(e,t,a){var r=e._id;return e.each(function(){var o=Ke(this,r);(o.value||(o.value={}))[t]=a.apply(this,arguments)}),function(o){return We(o,r).value[t]}}function ti(e,t){var a;return(typeof t=="number"?ze:t instanceof _t?ra:(a=_t(t))?(t=a,ra):jo)(e,t)}function _c(e){return function(){this.removeAttribute(e)}}function Ic(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Ac(e,t,a){var r,o=a+"",s;return function(){var i=this.getAttribute(e);return i===o?null:i===r?s:s=t(r=i,a)}}function Nc(e,t,a){var r,o=a+"",s;return function(){var i=this.getAttributeNS(e.space,e.local);return i===o?null:i===r?s:s=t(r=i,a)}}function Bc(e,t,a){var r,o,s;return function(){var i,l=a(this),c;return l==null?void this.removeAttribute(e):(i=this.getAttribute(e),c=l+"",i===c?null:i===r&&c===o?s:(o=c,s=t(r=i,l)))}}function Fc(e,t,a){var r,o,s;return function(){var i,l=a(this),c;return l==null?void this.removeAttributeNS(e.space,e.local):(i=this.getAttributeNS(e.space,e.local),c=l+"",i===c?null:i===r&&c===o?s:(o=c,s=t(r=i,l)))}}function Uc(e,t){var a=xa(e),r=a==="transform"?yc:ti;return this.attrTween(e,typeof t=="function"?(a.local?Fc:Bc)(a,r,Mr(this,"attr."+e,t)):t==null?(a.local?Ic:_c)(a):(a.local?Nc:Ac)(a,r,t))}function Vc(e,t){return function(a){this.setAttribute(e,t.call(this,a))}}function Oc(e,t){return function(a){this.setAttributeNS(e.space,e.local,t.call(this,a))}}function qc(e,t){var a,r;function o(){var s=t.apply(this,arguments);return s!==r&&(a=(r=s)&&Oc(e,s)),a}return o._value=t,o}function zc(e,t){var a,r;function o(){var s=t.apply(this,arguments);return s!==r&&(a=(r=s)&&Vc(e,s)),a}return o._value=t,o}function Hc(e,t){var a="attr."+e;if(arguments.length<2)return(a=this.tween(a))&&a._value;if(t==null)return this.tween(a,null);if(typeof t!="function")throw new Error;var r=xa(e);return this.tween(a,(r.local?qc:zc)(r,t))}function Wc(e,t){return function(){Sr(this,e).delay=+t.apply(this,arguments)}}function Yc(e,t){return t=+t,function(){Sr(this,e).delay=t}}function Xc(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Wc:Yc)(t,e)):We(this.node(),t).delay}function jc(e,t){return function(){Ke(this,e).duration=+t.apply(this,arguments)}}function Kc(e,t){return t=+t,function(){Ke(this,e).duration=t}}function Gc(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?jc:Kc)(t,e)):We(this.node(),t).duration}function Qc(e,t){if(typeof t!="function")throw new Error;return function(){Ke(this,e).ease=t}}function Zc(e){var t=this._id;return arguments.length?this.each(Qc(t,e)):We(this.node(),t).ease}function Jc(e,t){return function(){var a=t.apply(this,arguments);if(typeof a!="function")throw new Error;Ke(this,e).ease=a}}function ed(e){if(typeof e!="function")throw new Error;return this.each(Jc(this._id,e))}function td(e){typeof e!="function"&&(e=Ao(e));for(var t=this._groups,a=t.length,r=new Array(a),o=0;o<a;++o)for(var s=t[o],i=s.length,l=r[o]=[],c,d=0;d<i;++d)(c=s[d])&&e.call(c,c.__data__,d,s)&&l.push(c);return new lt(r,this._parents,this._name,this._id)}function nd(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,a=e._groups,r=t.length,o=a.length,s=Math.min(r,o),i=new Array(r),l=0;l<s;++l)for(var c=t[l],d=a[l],u=c.length,f=i[l]=new Array(u),h,p=0;p<u;++p)(h=c[p]||d[p])&&(f[p]=h);for(;l<r;++l)i[l]=t[l];return new lt(i,this._parents,this._name,this._id)}function ad(e){return(e+"").trim().split(/^|\s+/).every(function(t){var a=t.indexOf(".");return a>=0&&(t=t.slice(0,a)),!t||t==="start"})}function rd(e,t,a){var r,o,s=ad(t)?Sr:Ke;return function(){var i=s(this,e),l=i.on;l!==r&&(o=(r=l).copy()).on(t,a),i.on=o}}function od(e,t){var a=this._id;return arguments.length<2?We(this.node(),a).on.on(e):this.each(rd(a,e,t))}function id(e){return function(){var t=this.parentNode;for(var a in this.__transition)if(+a!==e)return;t&&t.removeChild(this)}}function sd(){return this.on("end.remove",id(this._id))}function ld(e){var t=this._name,a=this._id;typeof e!="function"&&(e=gr(e));for(var r=this._groups,o=r.length,s=new Array(o),i=0;i<o;++i)for(var l=r[i],c=l.length,d=s[i]=new Array(c),u,f,h=0;h<c;++h)(u=l[h])&&(f=e.call(u,u.__data__,h,l))&&("__data__"in u&&(f.__data__=u.__data__),d[h]=f,Sa(d[h],t,a,h,d,We(u,a)));return new lt(s,this._parents,t,a)}function cd(e){var t=this._name,a=this._id;typeof e!="function"&&(e=Io(e));for(var r=this._groups,o=r.length,s=[],i=[],l=0;l<o;++l)for(var c=r[l],d=c.length,u,f=0;f<d;++f)if(u=c[f]){for(var h=e.call(u,u.__data__,f,c),p,x=We(u,a),T=0,k=h.length;T<k;++T)(p=h[T])&&Sa(p,t,a,T,h,x);s.push(h),i.push(u)}return new lt(s,i,t,a)}var dd=Tn.prototype.constructor;function ud(){return new dd(this._groups,this._parents)}function fd(e,t){var a,r,o;return function(){var s=Qt(this,e),i=(this.style.removeProperty(e),Qt(this,e));return s===i?null:s===a&&i===r?o:o=t(a=s,r=i)}}function ni(e){return function(){this.style.removeProperty(e)}}function hd(e,t,a){var r,o=a+"",s;return function(){var i=Qt(this,e);return i===o?null:i===r?s:s=t(r=i,a)}}function pd(e,t,a){var r,o,s;return function(){var i=Qt(this,e),l=a(this),c=l+"";return l==null&&(c=l=(this.style.removeProperty(e),Qt(this,e))),i===c?null:i===r&&c===o?s:(o=c,s=t(r=i,l))}}function md(e,t){var a,r,o,s="style."+t,i="end."+s,l;return function(){var c=Ke(this,e),d=c.on,u=c.value[s]==null?l||(l=ni(t)):void 0;(d!==a||o!==u)&&(r=(a=d).copy()).on(i,o=u),c.on=r}}function gd(e,t,a){var r=(e+="")=="transform"?gc:ti;return t==null?this.styleTween(e,fd(e,r)).on("end.style."+e,ni(e)):typeof t=="function"?this.styleTween(e,pd(e,r,Mr(this,"style."+e,t))).each(md(this._id,e)):this.styleTween(e,hd(e,r,t),a).on("end.style."+e,null)}function yd(e,t,a){return function(r){this.style.setProperty(e,t.call(this,r),a)}}function vd(e,t,a){var r,o;function s(){var i=t.apply(this,arguments);return i!==o&&(r=(o=i)&&yd(e,i,a)),r}return s._value=t,s}function bd(e,t,a){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;return this.tween(r,vd(e,t,a??""))}function xd(e){return function(){this.textContent=e}}function wd(e){return function(){var t=e(this);this.textContent=t??""}}function Sd(e){return this.tween("text",typeof e=="function"?wd(Mr(this,"text",e)):xd(e==null?"":e+""))}function Md(e){return function(t){this.textContent=e.call(this,t)}}function $d(e){var t,a;function r(){var o=e.apply(this,arguments);return o!==a&&(t=(a=o)&&Md(o)),t}return r._value=e,r}function kd(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,$d(e))}function Dd(){for(var e=this._name,t=this._id,a=ai(),r=this._groups,o=r.length,s=0;s<o;++s)for(var i=r[s],l=i.length,c,d=0;d<l;++d)if(c=i[d]){var u=We(c,t);Sa(c,e,a,d,i,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new lt(r,this._parents,e,a)}function Td(){var e,t,a=this,r=a._id,o=a.size();return new Promise(function(s,i){var l={value:i},c={value:function(){--o===0&&s()}};a.each(function(){var d=Ke(this,r),u=d.on;u!==e&&(t=(e=u).copy(),t._.cancel.push(l),t._.interrupt.push(l),t._.end.push(c)),d.on=t}),o===0&&s()})}var Ld=0;function lt(e,t,a,r){this._groups=e,this._parents=t,this._name=a,this._id=r}function ai(){return++Ld}var Qe=Tn.prototype;lt.prototype={constructor:lt,select:ld,selectAll:cd,selectChild:Qe.selectChild,selectChildren:Qe.selectChildren,filter:td,merge:nd,selection:ud,transition:Dd,call:Qe.call,nodes:Qe.nodes,node:Qe.node,size:Qe.size,empty:Qe.empty,each:Qe.each,on:od,attr:Uc,attrTween:Hc,style:gd,styleTween:bd,text:Sd,textTween:kd,remove:sd,tween:Pc,delay:Xc,duration:Gc,ease:Zc,easeVarying:ed,end:Td,[Symbol.iterator]:Qe[Symbol.iterator]};function Ed(e){return--e*e*e+1}function Rd(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var Cd={time:null,delay:0,duration:250,ease:Rd};function Pd(e,t){for(var a;!(a=e.__transition)||!(a=a[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return a}function _d(e){var t,a;e instanceof lt?(t=e._id,e=e._name):(t=ai(),(a=Cd).time=wr(),e=e==null?null:e+"");for(var r=this._groups,o=r.length,s=0;s<o;++s)for(var i=r[s],l=i.length,c,d=0;d<l;++d)(c=i[d])&&Sa(c,e,t,d,i,a||Pd(c,t));return new lt(r,this._parents,e,t)}Tn.prototype.interrupt=Ec;Tn.prototype.transition=_d;function Id(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function la(e,t){if((a=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var a,r=e.slice(0,a);return[r.length>1?r[0]+r.slice(2):r,+e.slice(a+1)]}function Jt(e){return e=la(Math.abs(e)),e?e[1]:NaN}function Ad(e,t){return function(a,r){for(var o=a.length,s=[],i=0,l=e[0],c=0;o>0&&l>0&&(c+l+1>r&&(l=Math.max(1,r-c)),s.push(a.substring(o-=l,o+l)),!((c+=l+1)>r));)l=e[i=(i+1)%e.length];return s.reverse().join(t)}}function Nd(e){return function(t){return t.replace(/[0-9]/g,function(a){return e[+a]})}}var Bd=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function ca(e){if(!(t=Bd.exec(e)))throw new Error("invalid format: "+e);var t;return new $r({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}ca.prototype=$r.prototype;function $r(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}$r.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Fd(e){e:for(var t=e.length,a=1,r=-1,o;a<t;++a)switch(e[a]){case".":r=o=a;break;case"0":r===0&&(r=a),o=a;break;default:if(!+e[a])break e;r>0&&(r=0);break}return r>0?e.slice(0,r)+e.slice(o+1):e}var ri;function Ud(e,t){var a=la(e,t);if(!a)return e+"";var r=a[0],o=a[1],s=o-(ri=Math.max(-8,Math.min(8,Math.floor(o/3)))*3)+1,i=r.length;return s===i?r:s>i?r+new Array(s-i+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+la(e,Math.max(0,t+s-1))[0]}function Zr(e,t){var a=la(e,t);if(!a)return e+"";var r=a[0],o=a[1];return o<0?"0."+new Array(-o).join("0")+r:r.length>o+1?r.slice(0,o+1)+"."+r.slice(o+1):r+new Array(o-r.length+2).join("0")}const Jr={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:Id,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>Zr(e*100,t),r:Zr,s:Ud,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function eo(e){return e}var to=Array.prototype.map,no=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Vd(e){var t=e.grouping===void 0||e.thousands===void 0?eo:Ad(to.call(e.grouping,Number),e.thousands+""),a=e.currency===void 0?"":e.currency[0]+"",r=e.currency===void 0?"":e.currency[1]+"",o=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?eo:Nd(to.call(e.numerals,String)),i=e.percent===void 0?"%":e.percent+"",l=e.minus===void 0?"−":e.minus+"",c=e.nan===void 0?"NaN":e.nan+"";function d(f){f=ca(f);var h=f.fill,p=f.align,x=f.sign,T=f.symbol,k=f.zero,w=f.width,v=f.comma,L=f.precision,R=f.trim,$=f.type;$==="n"?(v=!0,$="g"):Jr[$]||(L===void 0&&(L=12),R=!0,$="g"),(k||h==="0"&&p==="=")&&(k=!0,h="0",p="=");var D=T==="$"?a:T==="#"&&/[boxX]/.test($)?"0"+$.toLowerCase():"",F=T==="$"?r:/[%p]/.test($)?i:"",N=Jr[$],X=/[defgprs%]/.test($);L=L===void 0?6:/[gprs]/.test($)?Math.max(1,Math.min(21,L)):Math.max(0,Math.min(20,L));function j(O){var Q=D,Y=F,y,B,E;if($==="c")Y=N(O)+Y,O="";else{O=+O;var m=O<0||1/O<0;if(O=isNaN(O)?c:N(Math.abs(O),L),R&&(O=Fd(O)),m&&+O==0&&x!=="+"&&(m=!1),Q=(m?x==="("?x:l:x==="-"||x==="("?"":x)+Q,Y=($==="s"?no[8+ri/3]:"")+Y+(m&&x==="("?")":""),X){for(y=-1,B=O.length;++y<B;)if(E=O.charCodeAt(y),48>E||E>57){Y=(E===46?o+O.slice(y+1):O.slice(y))+Y,O=O.slice(0,y);break}}}v&&!k&&(O=t(O,1/0));var b=Q.length+O.length+Y.length,S=b<w?new Array(w-b+1).join(h):"";switch(v&&k&&(O=t(S+O,S.length?w-Y.length:1/0),S=""),p){case"<":O=Q+O+Y+S;break;case"=":O=Q+S+O+Y;break;case"^":O=S.slice(0,b=S.length>>1)+Q+O+Y+S.slice(b);break;default:O=S+Q+O+Y;break}return s(O)}return j.toString=function(){return f+""},j}function u(f,h){var p=d((f=ca(f),f.type="f",f)),x=Math.max(-8,Math.min(8,Math.floor(Jt(h)/3)))*3,T=Math.pow(10,-x),k=no[8+x/3];return function(w){return p(T*w)+k}}return{format:d,formatPrefix:u}}var Nn,oi,ii;Od({thousands:",",grouping:[3],currency:["$",""]});function Od(e){return Nn=Vd(e),oi=Nn.format,ii=Nn.formatPrefix,Nn}function qd(e){return Math.max(0,-Jt(Math.abs(e)))}function zd(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Jt(t)/3)))*3-Jt(Math.abs(e)))}function Hd(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Jt(t)-Jt(e))+1}function si(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Wd(e){return function(){return e}}function Yd(e){return+e}var ao=[0,1];function Ht(e){return e}function ar(e,t){return(t-=e=+e)?function(a){return(a-e)/t}:Wd(isNaN(t)?NaN:.5)}function Xd(e,t){var a;return e>t&&(a=e,e=t,t=a),function(r){return Math.max(e,Math.min(t,r))}}function jd(e,t,a){var r=e[0],o=e[1],s=t[0],i=t[1];return o<r?(r=ar(o,r),s=a(i,s)):(r=ar(r,o),s=a(s,i)),function(l){return s(r(l))}}function Kd(e,t,a){var r=Math.min(e.length,t.length)-1,o=new Array(r),s=new Array(r),i=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++i<r;)o[i]=ar(e[i],e[i+1]),s[i]=a(t[i],t[i+1]);return function(l){var c=Ji(e,l,1,r)-1;return s[c](o[c](l))}}function li(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Gd(){var e=ao,t=ao,a=xr,r,o,s,i=Ht,l,c,d;function u(){var h=Math.min(e.length,t.length);return i!==Ht&&(i=Xd(e[0],e[h-1])),l=h>2?Kd:jd,c=d=null,f}function f(h){return h==null||isNaN(h=+h)?s:(c||(c=l(e.map(r),t,a)))(r(i(h)))}return f.invert=function(h){return i(o((d||(d=l(t,e.map(r),ze)))(h)))},f.domain=function(h){return arguments.length?(e=Array.from(h,Yd),u()):e.slice()},f.range=function(h){return arguments.length?(t=Array.from(h),u()):t.slice()},f.rangeRound=function(h){return t=Array.from(h),a=hc,u()},f.clamp=function(h){return arguments.length?(i=h?!0:Ht,u()):i!==Ht},f.interpolate=function(h){return arguments.length?(a=h,u()):a},f.unknown=function(h){return arguments.length?(s=h,f):s},function(h,p){return r=h,o=p,u()}}function ci(){return Gd()(Ht,Ht)}function Qd(e,t,a,r){var o=Xa(e,t,a),s;switch(r=ca(r??",f"),r.type){case"s":{var i=Math.max(Math.abs(e),Math.abs(t));return r.precision==null&&!isNaN(s=zd(o,i))&&(r.precision=s),ii(r,i)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(s=Hd(o,Math.max(Math.abs(e),Math.abs(t))))&&(r.precision=s-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(s=qd(o))&&(r.precision=s-(r.type==="%")*2);break}}return oi(r)}function Zd(e){var t=e.domain;return e.ticks=function(a){var r=t();return as(r[0],r[r.length-1],a??10)},e.tickFormat=function(a,r){var o=t();return Qd(o[0],o[o.length-1],a??10,r)},e.nice=function(a){a==null&&(a=10);var r=t(),o=0,s=r.length-1,i=r[o],l=r[s],c,d,u=10;for(l<i&&(d=i,i=l,l=d,d=o,o=s,s=d);u-- >0;){if(d=Ya(i,l,a),d===c)return r[o]=i,r[s]=l,t(r);if(d>0)i=Math.floor(i/d)*d,l=Math.ceil(l/d)*d;else if(d<0)i=Math.ceil(i*d)/d,l=Math.floor(l*d)/d;else break;c=d}return e},e}function Ma(){var e=ci();return e.copy=function(){return li(e,Ma())},si.apply(e,arguments),Zd(e)}function Jd(e,t){e=e.slice();var a=0,r=e.length-1,o=e[a],s=e[r],i;return s<o&&(i=a,a=r,r=i,i=o,o=s,s=i),e[a]=t.floor(o),e[r]=t.ceil(s),e}const Na=new Date,Ba=new Date;function ge(e,t,a,r){function o(s){return e(s=arguments.length===0?new Date:new Date(+s)),s}return o.floor=s=>(e(s=new Date(+s)),s),o.ceil=s=>(e(s=new Date(s-1)),t(s,1),e(s),s),o.round=s=>{const i=o(s),l=o.ceil(s);return s-i<l-s?i:l},o.offset=(s,i)=>(t(s=new Date(+s),i==null?1:Math.floor(i)),s),o.range=(s,i,l)=>{const c=[];if(s=o.ceil(s),l=l==null?1:Math.floor(l),!(s<i)||!(l>0))return c;let d;do c.push(d=new Date(+s)),t(s,l),e(s);while(d<s&&s<i);return c},o.filter=s=>ge(i=>{if(i>=i)for(;e(i),!s(i);)i.setTime(i-1)},(i,l)=>{if(i>=i)if(l<0)for(;++l<=0;)for(;t(i,-1),!s(i););else for(;--l>=0;)for(;t(i,1),!s(i););}),a&&(o.count=(s,i)=>(Na.setTime(+s),Ba.setTime(+i),e(Na),e(Ba),Math.floor(a(Na,Ba))),o.every=s=>(s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?o.filter(r?i=>r(i)%s===0:i=>o.count(0,i)%s===0):o)),o}const da=ge(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);da.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?ge(t=>{t.setTime(Math.floor(t/e)*e)},(t,a)=>{t.setTime(+t+a*e)},(t,a)=>(a-t)/e):da);da.range;const at=1e3,Ve=at*60,rt=Ve*60,ct=rt*24,kr=ct*7,ro=ct*30,Fa=ct*365,Wt=ge(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*at)},(e,t)=>(t-e)/at,e=>e.getUTCSeconds());Wt.range;const Dr=ge(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*at)},(e,t)=>{e.setTime(+e+t*Ve)},(e,t)=>(t-e)/Ve,e=>e.getMinutes());Dr.range;const eu=ge(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*Ve)},(e,t)=>(t-e)/Ve,e=>e.getUTCMinutes());eu.range;const Tr=ge(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*at-e.getMinutes()*Ve)},(e,t)=>{e.setTime(+e+t*rt)},(e,t)=>(t-e)/rt,e=>e.getHours());Tr.range;const tu=ge(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*rt)},(e,t)=>(t-e)/rt,e=>e.getUTCHours());tu.range;const En=ge(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Ve)/ct,e=>e.getDate()-1);En.range;const Lr=ge(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/ct,e=>e.getUTCDate()-1);Lr.range;const nu=ge(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/ct,e=>Math.floor(e/ct));nu.range;function Bt(e){return ge(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,a)=>{t.setDate(t.getDate()+a*7)},(t,a)=>(a-t-(a.getTimezoneOffset()-t.getTimezoneOffset())*Ve)/kr)}const $a=Bt(0),ua=Bt(1),au=Bt(2),ru=Bt(3),en=Bt(4),ou=Bt(5),iu=Bt(6);$a.range;ua.range;au.range;ru.range;en.range;ou.range;iu.range;function Ft(e){return ge(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,a)=>{t.setUTCDate(t.getUTCDate()+a*7)},(t,a)=>(a-t)/kr)}const di=Ft(0),fa=Ft(1),su=Ft(2),lu=Ft(3),tn=Ft(4),cu=Ft(5),du=Ft(6);di.range;fa.range;su.range;lu.range;tn.range;cu.range;du.range;const Er=ge(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());Er.range;const uu=ge(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());uu.range;const dt=ge(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());dt.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:ge(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,a)=>{t.setFullYear(t.getFullYear()+a*e)});dt.range;const At=ge(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());At.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:ge(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,a)=>{t.setUTCFullYear(t.getUTCFullYear()+a*e)});At.range;function fu(e,t,a,r,o,s){const i=[[Wt,1,at],[Wt,5,5*at],[Wt,15,15*at],[Wt,30,30*at],[s,1,Ve],[s,5,5*Ve],[s,15,15*Ve],[s,30,30*Ve],[o,1,rt],[o,3,3*rt],[o,6,6*rt],[o,12,12*rt],[r,1,ct],[r,2,2*ct],[a,1,kr],[t,1,ro],[t,3,3*ro],[e,1,Fa]];function l(d,u,f){const h=u<d;h&&([d,u]=[u,d]);const p=f&&typeof f.range=="function"?f:c(d,u,f),x=p?p.range(d,+u+1):[];return h?x.reverse():x}function c(d,u,f){const h=Math.abs(u-d)/f,p=pr(([,,k])=>k).right(i,h);if(p===i.length)return e.every(Xa(d/Fa,u/Fa,f));if(p===0)return da.every(Math.max(Xa(d,u,f),1));const[x,T]=i[h/i[p-1][2]<i[p][2]/h?p-1:p];return x.every(T)}return[l,c]}const[hu,pu]=fu(dt,Er,$a,En,Tr,Dr);function Ua(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Va(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function sn(e,t,a){return{y:e,m:t,d:a,H:0,M:0,S:0,L:0}}function mu(e){var t=e.dateTime,a=e.date,r=e.time,o=e.periods,s=e.days,i=e.shortDays,l=e.months,c=e.shortMonths,d=ln(o),u=cn(o),f=ln(s),h=cn(s),p=ln(i),x=cn(i),T=ln(l),k=cn(l),w=ln(c),v=cn(c),L={a:m,A:b,b:S,B:_,c:null,d:uo,e:uo,f:Fu,g:ju,G:Gu,H:Au,I:Nu,j:Bu,L:ui,m:Uu,M:Vu,p:U,q:I,Q:po,s:mo,S:Ou,u:qu,U:zu,V:Hu,w:Wu,W:Yu,x:null,X:null,y:Xu,Y:Ku,Z:Qu,"%":ho},R={a:C,A:V,b:K,B:Z,c:null,d:fo,e:fo,f:tf,g:ff,G:pf,H:Zu,I:Ju,j:ef,L:hi,m:nf,M:af,p:W,q:H,Q:po,s:mo,S:rf,u:of,U:sf,V:lf,w:cf,W:df,x:null,X:null,y:uf,Y:hf,Z:mf,"%":ho},$={a:j,A:O,b:Q,B:Y,c:y,d:lo,e:lo,f:Cu,g:so,G:io,H:co,I:co,j:Tu,L:Ru,m:Du,M:Lu,p:X,q:ku,Q:_u,s:Iu,S:Eu,u:xu,U:wu,V:Su,w:bu,W:Mu,x:B,X:E,y:so,Y:io,Z:$u,"%":Pu};L.x=D(a,L),L.X=D(r,L),L.c=D(t,L),R.x=D(a,R),R.X=D(r,R),R.c=D(t,R);function D(P,z){return function(G){var A=[],ie=-1,re=0,se=P.length,we,Oe,Ut;for(G instanceof Date||(G=new Date(+G));++ie<se;)P.charCodeAt(ie)===37&&(A.push(P.slice(re,ie)),(Oe=oo[we=P.charAt(++ie)])!=null?we=P.charAt(++ie):Oe=we==="e"?" ":"0",(Ut=z[we])&&(we=Ut(G,Oe)),A.push(we),re=ie+1);return A.push(P.slice(re,ie)),A.join("")}}function F(P,z){return function(G){var A=sn(1900,void 0,1),ie=N(A,P,G+="",0),re,se;if(ie!=G.length)return null;if("Q"in A)return new Date(A.Q);if("s"in A)return new Date(A.s*1e3+("L"in A?A.L:0));if(z&&!("Z"in A)&&(A.Z=0),"p"in A&&(A.H=A.H%12+A.p*12),A.m===void 0&&(A.m="q"in A?A.q:0),"V"in A){if(A.V<1||A.V>53)return null;"w"in A||(A.w=1),"Z"in A?(re=Va(sn(A.y,0,1)),se=re.getUTCDay(),re=se>4||se===0?fa.ceil(re):fa(re),re=Lr.offset(re,(A.V-1)*7),A.y=re.getUTCFullYear(),A.m=re.getUTCMonth(),A.d=re.getUTCDate()+(A.w+6)%7):(re=Ua(sn(A.y,0,1)),se=re.getDay(),re=se>4||se===0?ua.ceil(re):ua(re),re=En.offset(re,(A.V-1)*7),A.y=re.getFullYear(),A.m=re.getMonth(),A.d=re.getDate()+(A.w+6)%7)}else("W"in A||"U"in A)&&("w"in A||(A.w="u"in A?A.u%7:"W"in A?1:0),se="Z"in A?Va(sn(A.y,0,1)).getUTCDay():Ua(sn(A.y,0,1)).getDay(),A.m=0,A.d="W"in A?(A.w+6)%7+A.W*7-(se+5)%7:A.w+A.U*7-(se+6)%7);return"Z"in A?(A.H+=A.Z/100|0,A.M+=A.Z%100,Va(A)):Ua(A)}}function N(P,z,G,A){for(var ie=0,re=z.length,se=G.length,we,Oe;ie<re;){if(A>=se)return-1;if(we=z.charCodeAt(ie++),we===37){if(we=z.charAt(ie++),Oe=$[we in oo?z.charAt(ie++):we],!Oe||(A=Oe(P,G,A))<0)return-1}else if(we!=G.charCodeAt(A++))return-1}return A}function X(P,z,G){var A=d.exec(z.slice(G));return A?(P.p=u.get(A[0].toLowerCase()),G+A[0].length):-1}function j(P,z,G){var A=p.exec(z.slice(G));return A?(P.w=x.get(A[0].toLowerCase()),G+A[0].length):-1}function O(P,z,G){var A=f.exec(z.slice(G));return A?(P.w=h.get(A[0].toLowerCase()),G+A[0].length):-1}function Q(P,z,G){var A=w.exec(z.slice(G));return A?(P.m=v.get(A[0].toLowerCase()),G+A[0].length):-1}function Y(P,z,G){var A=T.exec(z.slice(G));return A?(P.m=k.get(A[0].toLowerCase()),G+A[0].length):-1}function y(P,z,G){return N(P,t,z,G)}function B(P,z,G){return N(P,a,z,G)}function E(P,z,G){return N(P,r,z,G)}function m(P){return i[P.getDay()]}function b(P){return s[P.getDay()]}function S(P){return c[P.getMonth()]}function _(P){return l[P.getMonth()]}function U(P){return o[+(P.getHours()>=12)]}function I(P){return 1+~~(P.getMonth()/3)}function C(P){return i[P.getUTCDay()]}function V(P){return s[P.getUTCDay()]}function K(P){return c[P.getUTCMonth()]}function Z(P){return l[P.getUTCMonth()]}function W(P){return o[+(P.getUTCHours()>=12)]}function H(P){return 1+~~(P.getUTCMonth()/3)}return{format:function(P){var z=D(P+="",L);return z.toString=function(){return P},z},parse:function(P){var z=F(P+="",!1);return z.toString=function(){return P},z},utcFormat:function(P){var z=D(P+="",R);return z.toString=function(){return P},z},utcParse:function(P){var z=F(P+="",!0);return z.toString=function(){return P},z}}}var oo={"-":"",_:" ",0:"0"},xe=/^\s*\d+/,gu=/^%/,yu=/[\\^$*+?|[\]().{}]/g;function oe(e,t,a){var r=e<0?"-":"",o=(r?-e:e)+"",s=o.length;return r+(s<a?new Array(a-s+1).join(t)+o:o)}function vu(e){return e.replace(yu,"\\$&")}function ln(e){return new RegExp("^(?:"+e.map(vu).join("|")+")","i")}function cn(e){return new Map(e.map((t,a)=>[t.toLowerCase(),a]))}function bu(e,t,a){var r=xe.exec(t.slice(a,a+1));return r?(e.w=+r[0],a+r[0].length):-1}function xu(e,t,a){var r=xe.exec(t.slice(a,a+1));return r?(e.u=+r[0],a+r[0].length):-1}function wu(e,t,a){var r=xe.exec(t.slice(a,a+2));return r?(e.U=+r[0],a+r[0].length):-1}function Su(e,t,a){var r=xe.exec(t.slice(a,a+2));return r?(e.V=+r[0],a+r[0].length):-1}function Mu(e,t,a){var r=xe.exec(t.slice(a,a+2));return r?(e.W=+r[0],a+r[0].length):-1}function io(e,t,a){var r=xe.exec(t.slice(a,a+4));return r?(e.y=+r[0],a+r[0].length):-1}function so(e,t,a){var r=xe.exec(t.slice(a,a+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),a+r[0].length):-1}function $u(e,t,a){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(a,a+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),a+r[0].length):-1}function ku(e,t,a){var r=xe.exec(t.slice(a,a+1));return r?(e.q=r[0]*3-3,a+r[0].length):-1}function Du(e,t,a){var r=xe.exec(t.slice(a,a+2));return r?(e.m=r[0]-1,a+r[0].length):-1}function lo(e,t,a){var r=xe.exec(t.slice(a,a+2));return r?(e.d=+r[0],a+r[0].length):-1}function Tu(e,t,a){var r=xe.exec(t.slice(a,a+3));return r?(e.m=0,e.d=+r[0],a+r[0].length):-1}function co(e,t,a){var r=xe.exec(t.slice(a,a+2));return r?(e.H=+r[0],a+r[0].length):-1}function Lu(e,t,a){var r=xe.exec(t.slice(a,a+2));return r?(e.M=+r[0],a+r[0].length):-1}function Eu(e,t,a){var r=xe.exec(t.slice(a,a+2));return r?(e.S=+r[0],a+r[0].length):-1}function Ru(e,t,a){var r=xe.exec(t.slice(a,a+3));return r?(e.L=+r[0],a+r[0].length):-1}function Cu(e,t,a){var r=xe.exec(t.slice(a,a+6));return r?(e.L=Math.floor(r[0]/1e3),a+r[0].length):-1}function Pu(e,t,a){var r=gu.exec(t.slice(a,a+1));return r?a+r[0].length:-1}function _u(e,t,a){var r=xe.exec(t.slice(a));return r?(e.Q=+r[0],a+r[0].length):-1}function Iu(e,t,a){var r=xe.exec(t.slice(a));return r?(e.s=+r[0],a+r[0].length):-1}function uo(e,t){return oe(e.getDate(),t,2)}function Au(e,t){return oe(e.getHours(),t,2)}function Nu(e,t){return oe(e.getHours()%12||12,t,2)}function Bu(e,t){return oe(1+En.count(dt(e),e),t,3)}function ui(e,t){return oe(e.getMilliseconds(),t,3)}function Fu(e,t){return ui(e,t)+"000"}function Uu(e,t){return oe(e.getMonth()+1,t,2)}function Vu(e,t){return oe(e.getMinutes(),t,2)}function Ou(e,t){return oe(e.getSeconds(),t,2)}function qu(e){var t=e.getDay();return t===0?7:t}function zu(e,t){return oe($a.count(dt(e)-1,e),t,2)}function fi(e){var t=e.getDay();return t>=4||t===0?en(e):en.ceil(e)}function Hu(e,t){return e=fi(e),oe(en.count(dt(e),e)+(dt(e).getDay()===4),t,2)}function Wu(e){return e.getDay()}function Yu(e,t){return oe(ua.count(dt(e)-1,e),t,2)}function Xu(e,t){return oe(e.getFullYear()%100,t,2)}function ju(e,t){return e=fi(e),oe(e.getFullYear()%100,t,2)}function Ku(e,t){return oe(e.getFullYear()%1e4,t,4)}function Gu(e,t){var a=e.getDay();return e=a>=4||a===0?en(e):en.ceil(e),oe(e.getFullYear()%1e4,t,4)}function Qu(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+oe(t/60|0,"0",2)+oe(t%60,"0",2)}function fo(e,t){return oe(e.getUTCDate(),t,2)}function Zu(e,t){return oe(e.getUTCHours(),t,2)}function Ju(e,t){return oe(e.getUTCHours()%12||12,t,2)}function ef(e,t){return oe(1+Lr.count(At(e),e),t,3)}function hi(e,t){return oe(e.getUTCMilliseconds(),t,3)}function tf(e,t){return hi(e,t)+"000"}function nf(e,t){return oe(e.getUTCMonth()+1,t,2)}function af(e,t){return oe(e.getUTCMinutes(),t,2)}function rf(e,t){return oe(e.getUTCSeconds(),t,2)}function of(e){var t=e.getUTCDay();return t===0?7:t}function sf(e,t){return oe(di.count(At(e)-1,e),t,2)}function pi(e){var t=e.getUTCDay();return t>=4||t===0?tn(e):tn.ceil(e)}function lf(e,t){return e=pi(e),oe(tn.count(At(e),e)+(At(e).getUTCDay()===4),t,2)}function cf(e){return e.getUTCDay()}function df(e,t){return oe(fa.count(At(e)-1,e),t,2)}function uf(e,t){return oe(e.getUTCFullYear()%100,t,2)}function ff(e,t){return e=pi(e),oe(e.getUTCFullYear()%100,t,2)}function hf(e,t){return oe(e.getUTCFullYear()%1e4,t,4)}function pf(e,t){var a=e.getUTCDay();return e=a>=4||a===0?tn(e):tn.ceil(e),oe(e.getUTCFullYear()%1e4,t,4)}function mf(){return"+0000"}function ho(){return"%"}function po(e){return+e}function mo(e){return Math.floor(+e/1e3)}var Vt,Rr;gf({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function gf(e){return Vt=mu(e),Rr=Vt.format,Vt.parse,Vt.utcFormat,Vt.utcParse,Vt}function yf(e){return new Date(e)}function vf(e){return e instanceof Date?+e:+new Date(+e)}function mi(e,t,a,r,o,s,i,l,c,d){var u=ci(),f=u.invert,h=u.domain,p=d(".%L"),x=d(":%S"),T=d("%I:%M"),k=d("%I %p"),w=d("%a %d"),v=d("%b %d"),L=d("%B"),R=d("%Y");function $(D){return(c(D)<D?p:l(D)<D?x:i(D)<D?T:s(D)<D?k:r(D)<D?o(D)<D?w:v:a(D)<D?L:R)(D)}return u.invert=function(D){return new Date(f(D))},u.domain=function(D){return arguments.length?h(Array.from(D,vf)):h().map(yf)},u.ticks=function(D){var F=h();return e(F[0],F[F.length-1],D??10)},u.tickFormat=function(D,F){return F==null?$:d(F)},u.nice=function(D){var F=h();return(!D||typeof D.range!="function")&&(D=t(F[0],F[F.length-1],D??10)),D?h(Jd(F,D)):u},u.copy=function(){return li(u,mi(e,t,a,r,o,s,i,l,c,d))},u}function bf(){return si.apply(mi(hu,pu,dt,Er,$a,En,Tr,Dr,Wt,Rr).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}const Bn=e=>()=>e;function xf(e,{sourceEvent:t,target:a,transform:r,dispatch:o}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:a,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:o}})}function ot(e,t,a){this.k=e,this.x=t,this.y=a}ot.prototype={constructor:ot,scale:function(e){return e===1?this:new ot(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new ot(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var ka=new ot(1,0,0);ot.prototype;function Oa(e){e.stopImmediatePropagation()}function dn(e){e.preventDefault(),e.stopImmediatePropagation()}function wf(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function Sf(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function go(){return this.__zoom||ka}function Mf(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function $f(){return navigator.maxTouchPoints||"ontouchstart"in this}function kf(e,t,a){var r=e.invertX(t[0][0])-a[0][0],o=e.invertX(t[1][0])-a[1][0],s=e.invertY(t[0][1])-a[0][1],i=e.invertY(t[1][1])-a[1][1];return e.translate(o>r?(r+o)/2:Math.min(0,r)||Math.max(0,o),i>s?(s+i)/2:Math.min(0,s)||Math.max(0,i))}function Df(){var e=wf,t=Sf,a=kf,r=Mf,o=$f,s=[0,1/0],i=[[-1/0,-1/0],[1/0,1/0]],l=250,c=wc,d=mr("start","zoom","end"),u,f,h,p=500,x=150,T=0,k=10;function w(y){y.property("__zoom",go).on("wheel.zoom",N,{passive:!1}).on("mousedown.zoom",X).on("dblclick.zoom",j).filter(o).on("touchstart.zoom",O).on("touchmove.zoom",Q).on("touchend.zoom touchcancel.zoom",Y).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}w.transform=function(y,B,E,m){var b=y.selection?y.selection():y;b.property("__zoom",go),y!==b?$(y,B,E,m):b.interrupt().each(function(){D(this,arguments).event(m).start().zoom(null,typeof B=="function"?B.apply(this,arguments):B).end()})},w.scaleBy=function(y,B,E,m){w.scaleTo(y,function(){var b=this.__zoom.k,S=typeof B=="function"?B.apply(this,arguments):B;return b*S},E,m)},w.scaleTo=function(y,B,E,m){w.transform(y,function(){var b=t.apply(this,arguments),S=this.__zoom,_=E==null?R(b):typeof E=="function"?E.apply(this,arguments):E,U=S.invert(_),I=typeof B=="function"?B.apply(this,arguments):B;return a(L(v(S,I),_,U),b,i)},E,m)},w.translateBy=function(y,B,E,m){w.transform(y,function(){return a(this.__zoom.translate(typeof B=="function"?B.apply(this,arguments):B,typeof E=="function"?E.apply(this,arguments):E),t.apply(this,arguments),i)},null,m)},w.translateTo=function(y,B,E,m,b){w.transform(y,function(){var S=t.apply(this,arguments),_=this.__zoom,U=m==null?R(S):typeof m=="function"?m.apply(this,arguments):m;return a(ka.translate(U[0],U[1]).scale(_.k).translate(typeof B=="function"?-B.apply(this,arguments):-B,typeof E=="function"?-E.apply(this,arguments):-E),S,i)},m,b)};function v(y,B){return B=Math.max(s[0],Math.min(s[1],B)),B===y.k?y:new ot(B,y.x,y.y)}function L(y,B,E){var m=B[0]-E[0]*y.k,b=B[1]-E[1]*y.k;return m===y.x&&b===y.y?y:new ot(y.k,m,b)}function R(y){return[(+y[0][0]+ +y[1][0])/2,(+y[0][1]+ +y[1][1])/2]}function $(y,B,E,m){y.on("start.zoom",function(){D(this,arguments).event(m).start()}).on("interrupt.zoom end.zoom",function(){D(this,arguments).event(m).end()}).tween("zoom",function(){var b=this,S=arguments,_=D(b,S).event(m),U=t.apply(b,S),I=E==null?R(U):typeof E=="function"?E.apply(b,S):E,C=Math.max(U[1][0]-U[0][0],U[1][1]-U[0][1]),V=b.__zoom,K=typeof B=="function"?B.apply(b,S):B,Z=c(V.invert(I).concat(C/V.k),K.invert(I).concat(C/K.k));return function(W){if(W===1)W=K;else{var H=Z(W),P=C/H[2];W=new ot(P,I[0]-H[0]*P,I[1]-H[1]*P)}_.zoom(null,W)}})}function D(y,B,E){return!E&&y.__zooming||new F(y,B)}function F(y,B){this.that=y,this.args=B,this.active=0,this.sourceEvent=null,this.extent=t.apply(y,B),this.taps=0}F.prototype={event:function(y){return y&&(this.sourceEvent=y),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(y,B){return this.mouse&&y!=="mouse"&&(this.mouse[1]=B.invert(this.mouse[0])),this.touch0&&y!=="touch"&&(this.touch0[1]=B.invert(this.touch0[0])),this.touch1&&y!=="touch"&&(this.touch1[1]=B.invert(this.touch1[0])),this.that.__zoom=B,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(y){var B=nt(this.that).datum();d.call(y,this.that,new xf(y,{sourceEvent:this.sourceEvent,target:w,transform:this.that.__zoom,dispatch:d}),B)}};function N(y,...B){if(!e.apply(this,arguments))return;var E=D(this,B).event(y),m=this.__zoom,b=Math.max(s[0],Math.min(s[1],m.k*Math.pow(2,r.apply(this,arguments)))),S=ht(y);if(E.wheel)(E.mouse[0][0]!==S[0]||E.mouse[0][1]!==S[1])&&(E.mouse[1]=m.invert(E.mouse[0]=S)),clearTimeout(E.wheel);else{if(m.k===b)return;E.mouse=[S,m.invert(S)],Wn(this),E.start()}dn(y),E.wheel=setTimeout(_,x),E.zoom("mouse",a(L(v(m,b),E.mouse[0],E.mouse[1]),E.extent,i));function _(){E.wheel=null,E.end()}}function X(y,...B){if(h||!e.apply(this,arguments))return;var E=y.currentTarget,m=D(this,B,!0).event(y),b=nt(y.view).on("mousemove.zoom",I,!0).on("mouseup.zoom",C,!0),S=ht(y,E),_=y.clientX,U=y.clientY;zl(y.view),Oa(y),m.mouse=[S,this.__zoom.invert(S)],Wn(this),m.start();function I(V){if(dn(V),!m.moved){var K=V.clientX-_,Z=V.clientY-U;m.moved=K*K+Z*Z>T}m.event(V).zoom("mouse",a(L(m.that.__zoom,m.mouse[0]=ht(V,E),m.mouse[1]),m.extent,i))}function C(V){b.on("mousemove.zoom mouseup.zoom",null),Hl(V.view,m.moved),dn(V),m.event(V).end()}}function j(y,...B){if(e.apply(this,arguments)){var E=this.__zoom,m=ht(y.changedTouches?y.changedTouches[0]:y,this),b=E.invert(m),S=E.k*(y.shiftKey?.5:2),_=a(L(v(E,S),m,b),t.apply(this,B),i);dn(y),l>0?nt(this).transition().duration(l).call($,_,m,y):nt(this).call(w.transform,_,m,y)}}function O(y,...B){if(e.apply(this,arguments)){var E=y.touches,m=E.length,b=D(this,B,y.changedTouches.length===m).event(y),S,_,U,I;for(Oa(y),_=0;_<m;++_)U=E[_],I=ht(U,this),I=[I,this.__zoom.invert(I),U.identifier],b.touch0?!b.touch1&&b.touch0[2]!==I[2]&&(b.touch1=I,b.taps=0):(b.touch0=I,S=!0,b.taps=1+!!u);u&&(u=clearTimeout(u)),S&&(b.taps<2&&(f=I[0],u=setTimeout(function(){u=null},p)),Wn(this),b.start())}}function Q(y,...B){if(this.__zooming){var E=D(this,B).event(y),m=y.changedTouches,b=m.length,S,_,U,I;for(dn(y),S=0;S<b;++S)_=m[S],U=ht(_,this),E.touch0&&E.touch0[2]===_.identifier?E.touch0[0]=U:E.touch1&&E.touch1[2]===_.identifier&&(E.touch1[0]=U);if(_=E.that.__zoom,E.touch1){var C=E.touch0[0],V=E.touch0[1],K=E.touch1[0],Z=E.touch1[1],W=(W=K[0]-C[0])*W+(W=K[1]-C[1])*W,H=(H=Z[0]-V[0])*H+(H=Z[1]-V[1])*H;_=v(_,Math.sqrt(W/H)),U=[(C[0]+K[0])/2,(C[1]+K[1])/2],I=[(V[0]+Z[0])/2,(V[1]+Z[1])/2]}else if(E.touch0)U=E.touch0[0],I=E.touch0[1];else return;E.zoom("touch",a(L(_,U,I),E.extent,i))}}function Y(y,...B){if(this.__zooming){var E=D(this,B).event(y),m=y.changedTouches,b=m.length,S,_;for(Oa(y),h&&clearTimeout(h),h=setTimeout(function(){h=null},p),S=0;S<b;++S)_=m[S],E.touch0&&E.touch0[2]===_.identifier?delete E.touch0:E.touch1&&E.touch1[2]===_.identifier&&delete E.touch1;if(E.touch1&&!E.touch0&&(E.touch0=E.touch1,delete E.touch1),E.touch0)E.touch0[1]=this.__zoom.invert(E.touch0[0]);else if(E.end(),E.taps===2&&(_=ht(_,this),Math.hypot(f[0]-_[0],f[1]-_[1])<k)){var U=nt(this).on("dblclick.zoom");U&&U.apply(this,arguments)}}}return w.wheelDelta=function(y){return arguments.length?(r=typeof y=="function"?y:Bn(+y),w):r},w.filter=function(y){return arguments.length?(e=typeof y=="function"?y:Bn(!!y),w):e},w.touchable=function(y){return arguments.length?(o=typeof y=="function"?y:Bn(!!y),w):o},w.extent=function(y){return arguments.length?(t=typeof y=="function"?y:Bn([[+y[0][0],+y[0][1]],[+y[1][0],+y[1][1]]]),w):t},w.scaleExtent=function(y){return arguments.length?(s[0]=+y[0],s[1]=+y[1],w):[s[0],s[1]]},w.translateExtent=function(y){return arguments.length?(i[0][0]=+y[0][0],i[1][0]=+y[1][0],i[0][1]=+y[0][1],i[1][1]=+y[1][1],w):[[i[0][0],i[0][1]],[i[1][0],i[1][1]]]},w.constrain=function(y){return arguments.length?(a=y,w):a},w.duration=function(y){return arguments.length?(l=+y,w):l},w.interpolate=function(y){return arguments.length?(c=y,w):c},w.on=function(){var y=d.on.apply(d,arguments);return y===d?w:y},w.clickDistance=function(y){return arguments.length?(T=(y=+y)*y,w):Math.sqrt(T)},w.tapDistance=function(y){return arguments.length?(k=+y,w):k},w}async function Tf(e){const t="http://localhost:8000";try{const a=await fetch(`${t}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok){const o=await a.text();throw new Error(`Chat API error (${a.status}): ${o}`)}return await a.json()}catch(a){return console.error("Chat API error:",a),{message:`Fehler bei der Kommunikation mit dem Chat-Service: ${a instanceof Error?a.message:"Unbekannter Fehler"}`,success:!1,error:a instanceof Error?a.message:"Unknown error"}}}function Lf(e){const t={mode:e.mode,canvasView:e.canvasView,selectedVariable:e.variable,selectedModel:e.model,selectedScenario:e.scenario,selectedDate:e.date,selectedUnit:e.selectedUnit};return e.dataMin!==null&&e.dataMax!==null&&e.dataMean!==null&&(t.dataStats={min:e.dataMin,max:e.dataMax,mean:e.dataMean}),e.chartPoint&&(t.selectedLocation={lat:e.chartPoint.lat,lon:e.chartPoint.lon}),e.mode==="Compare"&&e.compareMode&&(t.compareMode=e.compareMode,e.compareMode==="Scenarios"?(t.scenario1=e.compareScenarioA,t.scenario2=e.compareScenarioB):e.compareMode==="Models"?(t.model1=e.compareModelA,t.model2=e.compareModelB):e.compareMode==="Dates"&&(t.date1=e.compareDateStart,t.date2=e.compareDateEnd)),e.canvasView==="chart"&&e.chartMode&&(t.chartMode=e.chartMode,t.chartState={mode:e.chartMode,scenarios:e.chartScenarios,models:e.chartModels,date:e.chartDate,rangeStart:e.chartRangeStart,rangeEnd:e.chartRangeEnd,unit:e.chartUnit,variable:e.chartVariable,samples:e.chartSamples.length,location:e.chartLocation,locationName:e.chartLocationName||void 0}),e.mode==="Ensemble"&&(t.ensembleScenarios=e.ensembleScenarios,t.ensembleModels=e.ensembleModels,t.ensembleStatistic=e.ensembleStatistic,t.ensembleDate=e.ensembleDate,t.ensembleVariable=e.ensembleVariable,t.ensembleUnit=e.ensembleUnit,t.ensembleStatistics=e.ensembleStatistics),e.masks&&e.masks.length>0&&(t.masks=e.masks.map(a=>({variable:a.variable,unit:a.unit,statistic:a.statistic,lowerBound:a.lowerBound,upperBound:a.upperBound}))),t}let rr=null;function Ef(e){rr=e}function Rf(e){if(!e||!rr)return;const t={};e.mode&&(t.mode=e.mode),e.selectedModel?t.model=e.selectedModel:e.model&&(t.model=e.model),e.selectedScenario&&(t.scenario=ut(e.selectedScenario)),e.selectedDate&&(t.date=e.selectedDate),e.variable&&(t.variable=e.variable),e.palette&&(t.palette=e.palette),e.compareMode&&(t.compareMode=e.compareMode),e.scenario1&&(t.compareScenarioA=e.scenario1),e.scenario2&&(t.compareScenarioB=e.scenario2),e.model1&&(t.compareModelA=e.model1),e.model2&&(t.compareModelB=e.model2),e.date1&&(t.compareDateStart=e.date1),e.date2&&(t.compareDateEnd=e.date2),e.chartMode&&(t.chartMode=e.chartMode),e.chartDate&&(t.chartDate=e.chartDate),e.location&&(t.chartLocation=e.location),e.start_date&&(t.chartRangeStart=e.start_date),e.end_date&&(t.chartRangeEnd=e.end_date),e.models&&(t.chartModels=e.models),e.scenarios&&(t.chartScenarios=e.scenarios.map(a=>ut(a))),e.colorPalette&&(t.palette=mh(e.colorPalette)),e.selectedUnit&&(t.selectedUnit=e.selectedUnit),e.masks&&(t.masks=e.masks.map(a=>({variable:a.variable,unit:a.unit,lowerBound:a.lowerBound,upperBound:a.upperBound,statistic:a.statistic}))),e.canvasView&&(t.canvasView=e.canvasView.toLowerCase()),Object.keys(t).length>0&&(console.log("Applying state updates from backend:",t),rr(t))}function Cf(e){let t=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");t=t.replace(/```(.+?)```/gs,'<code style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px; font-family: monospace; display: inline-block; margin: 4px 0; line-height: 1.4;">$1</code>'),t=t.replace(/`(.+?)`/g,'<code style="background: rgba(255,255,255,0.1); padding: 2px 4px; border-radius: 3px; font-family: monospace; font-size: 0.9em; vertical-align: middle; line-height: 1.4;">$1</code>'),t=t.replace(/\*\*(.+?)\*\*/g,'<strong style="font-weight: 700;">$1</strong>'),t=t.replace(/__(.+?)__/g,'<strong style="font-weight: 700;">$1</strong>');const a=t.split(`
`),r=[];for(let o=0;o<a.length;o++){const s=a[o].trim();if(s.startsWith("- ")){const i=s.substring(2);r.push(`<div style="display: flex; gap: 8px; margin: 6px 0;"><span style="flex-shrink: 0;">•</span><span style="flex: 1; line-height: 1.6; word-break: break-word; overflow-wrap: break-word;">${i}</span></div>`)}else if(/^\d+\.\s/.test(s)){const i=s.match(/^(\d+)\.\s(.+)$/);if(i){const l=i[1],c=i[2];r.push(`<div style="display: flex; gap: 8px; margin: 6px 0;"><span style="flex-shrink: 0; font-weight: 600; line-height: 1.6;">${l}.</span><span style="flex: 1; line-height: 1.6; word-break: break-word; overflow-wrap: break-word;">${c}</span></div>`)}else r.push(s)}else s.length>0?r.push(`<div style="margin: 8px 0; line-height: 1.6;">${s}</div>`):r.push('<div style="height: 12px;"></div>')}return r.join("")}function gi(e){const t=e.sender==="user"?"chat-bubble chat-bubble-user":"chat-bubble chat-bubble-agent",a=e.sender==="user"?e.text:Cf(e.text);return`<div class="${t}">${a}</div>`}function qa(e,t){const a=e.querySelector(".chat-messages");if(!a)return;const r=gi(t);a.insertAdjacentHTML("beforeend",r),a.scrollTop=a.scrollHeight}function za(e,t){const a=e.querySelector(".chat-loading");a&&(a.style.display=t?"flex":"none")}function Pf(e,t){return`
    <div class="chat-stack">
      <div class="chat-lead">Discuss the data with an agent, or ask questions.</div>

      <div class="chat-messages">
            ${e.map(a=>gi(a)).join("")}
      </div>
      <div class="chat-bubble chat-bubble-agent chat-loading" style="display: none">
        <span class="chat-loading-dot"></span><span class="chat-loading-dot"></span><span class="chat-loading-dot"></span>
      </div>
    

      <div class="chat-box">
        <input
          type="text"
          value="${t}"
          data-action="chat-input"
          class="chat-input"
          placeholder="Ask a question"
        />
        <button 
          type="button" 
          data-action="chat-send" 
          aria-label="Send chat message" 
          class="chat-send"
        >
          ➤
        </button>
      </div>
    </div>
  `}function _f(e,t){const a=e.querySelector('[data-action="chat-input"]'),r=e.querySelector('[data-action="chat-send"]');a?.addEventListener("input",o=>{t.chatInput=o.target.value}),a?.addEventListener("keydown",o=>{if(o.key==="ArrowUp"&&t.chatMessages.length>0){const s=[...t.chatMessages].reverse().find(i=>i.sender==="user");s&&(t.chatInput=s.text,a&&(a.value=s.text),setTimeout(()=>{a?.setSelectionRange(a.value.length,a.value.length)},0))}o.key==="Enter"&&yo(e,t)}),r?.addEventListener("click",()=>{yo(e,t)})}async function yo(e,t){const a=t.chatInput.trim();if(!a)return;const r={id:Date.now(),sender:"user",text:a};t.chatMessages=[...t.chatMessages,r],t.chatInput="";const o=e.querySelector('[data-action="chat-input"]');o&&(o.value=""),qa(e,r),za(e,!0);const s=t.chatMessages.slice(Math.max(0,t.chatMessages.length-11),-1).map(l=>({role:l.sender==="user"?"user":"assistant",content:l.text})),i=Lf(t);try{const l=await Tf({message:a,context:i,history:s}),c={id:Date.now()+1,sender:"agent",text:l.message,new_state:l.new_state};console.log("New state from agent:",c.new_state),t.chatMessages=[...t.chatMessages,c],c.new_state&&Rf(c.new_state),za(e,!1),qa(e,c)}catch(l){const c={id:Date.now()+1,sender:"agent",text:`Entschuldigung, es gab einen Fehler: ${l instanceof Error?l.message:"Unbekannter Fehler"}`};t.chatMessages=[...t.chatMessages,c],za(e,!1),qa(e,c)}}const Ee=360;let Mt=null,Je=null;function If(e){const{root:t,isOpen:a,onCanvasToggleUpdate:r,onTimeSliderUpdate:o}=e;Mt||(Mt=t.querySelector('[data-role="sidebar"]')),Je||(Je=t.querySelector('[data-action="toggle-sidebar"]'));const s=t.querySelector('[data-role="canvas-toggle"]'),i=t.querySelector('[data-role="compare-info-trigger"]'),l=t.querySelector('[data-role="compare-info-overlay"]');if(!Mt||!s||!Je)return;const c=a?"translateX(0)":`translateX(${Ee+24}px)`;Mt.style.transform=c,Mt.style.pointerEvents=a?"auto":"none",Mt.setAttribute("aria-hidden",String(!a));const d=a?`${Ee+10}px`:"14px";Je.style.right=d,Je.setAttribute("aria-label",a?"Collapse sidebar":"Expand sidebar"),Je.className=a?"sidebar-toggle open":"sidebar-toggle";const u=Je.querySelector("span");u&&(u.textContent=a?"›":"‹");const f=a?Ee+24:24;s.style.right=`${f}px`,i&&(i.style.right=`${f}px`),l&&(l.style.left=a?`${Ee}px`:"0",l.style.right="0"),r&&r(f),o&&o(a)}function Af(e){const{root:t,getSidebarOpen:a,setSidebarOpen:r,onCanvasToggleUpdate:o,onTimeSliderUpdate:s}=e;Mt=t.querySelector('[data-role="sidebar"]'),Je=t.querySelector('[data-action="toggle-sidebar"]'),Je?.addEventListener("click",()=>{const i=!a();r(i),If({root:t,isOpen:i,onCanvasToggleUpdate:o,onTimeSliderUpdate:s})})}function Nf(e){const t=e?Ee+10:14;return`
      <button
        type="button"
        aria-label="${e?"Collapse sidebar":"Expand sidebar"}"
        data-action="toggle-sidebar"
        class="${e?"sidebar-toggle open":"sidebar-toggle"}"
        style="right: ${t}px"
      >
        <span class="sidebar-toggle-icon">${e?"›":"‹"}</span>
      </button>
    `}const fe={map:"map",scenario:"scenario",models:"models",date:"date",variable:"variable",unit:"unit",palette:"palette",timeframe:"timeframe",mapReview:"map-review",compareSwitch:"compare-switch",compareParameters:"compare-parameters",chatSwitch:"chat-switch",chatOverview:"chat-overview",analysisSwitch:"analysis-switch",analysisOverview:"analysis-overview"},Te={map:"#map-canvas",scenario:'[data-role="scenario-selector"]',model:'[data-role="model-selector"]',date:'[data-role="date-picker"]',variable:'[data-role="variable-selector"]',unit:'[data-role="unit-selector"]',palette:'[data-role="palette-selector"]',timeSlider:'[data-role="time-slider"]',compareSwitch:'[data-action="set-mode"][data-value="Compare"]',compareParameters:'[data-role="compare-parameters"]',chatSwitch:'[data-action="set-tab"][data-value="Chat"]',chatSection:'[data-role="chat-section"]',analysisSwitch:'[data-action="set-canvas"][data-value="chart"]',analysisOverview:'[data-role="chart-container"]'},Rn=[{id:fe.map,title:"Welcome to Climate Visualization",description:"This interactive map shows climate data across the globe. You can pan by dragging, zoom with your mouse wheel, and hover over any location to see detailed information.",targetSelector:Te.map,position:"center",requiresAction:{type:"none"}},{id:fe.scenario,title:"Climate Scenarios",description:"Choose a climate scenario: Historical (1950-2014) shows past data, while SSP245, SSP370, and SSP585 represent different future warming pathways. Select one to continue.",targetSelector:Te.scenario,position:"left",requiresAction:{type:"select",dataKey:"scenario"}},{id:fe.models,title:"Climate Models",description:"Select from 11 global climate models developed by research institutions worldwide. Each model provides unique projections. Choose a model to continue.",targetSelector:Te.model,position:"left",requiresAction:{type:"select",dataKey:"model"}},{id:fe.date,title:"Date Selection",description:"Pick a date to view climate data. The available range depends on your chosen scenario. Select a date to continue.",targetSelector:Te.date,position:"left",requiresAction:{type:"input",dataKey:"date"}},{id:fe.variable,title:"Climate Variable",description:"Select which climate variable to visualize, such as temperature or precipitation. Choose one to continue.",targetSelector:Te.variable,position:"left",requiresAction:{type:"select",dataKey:"variable"}},{id:fe.unit,title:"Unit Preferences",description:"Choose your preferred temperature unit: Celsius (°C), Fahrenheit (°F), or Kelvin (K). Select a unit to continue.",targetSelector:Te.unit,position:"left",requiresAction:{type:"select",dataKey:"unit"}},{id:fe.palette,title:"Color Palette",description:"Select a color scheme for the map. Different palettes can help visualize temperature variations. Choose a palette to continue.",targetSelector:Te.palette,position:"left",requiresAction:{type:"select",dataKey:"palette"}},{id:fe.timeframe,title:"Time Navigation",description:"Use this slider to quickly navigate through different dates and see how climate patterns change over time.",targetSelector:Te.timeSlider,position:"top",requiresAction:{type:"none"}},{id:fe.mapReview,title:"Review the Map",description:"Great! Your parameters are set. Take a quick look at the map with your chosen settings, then continue.",targetSelector:Te.map,position:"right",requiresAction:{type:"none"}},{id:fe.compareSwitch,title:"Compare Mode",description:"Now switch to Compare mode to explore differences side by side. Click Compare to continue.",targetSelector:Te.compareSwitch,position:"left",requiresAction:{type:"click"}},{id:fe.compareParameters,title:"Compare Parameters",description:"These settings control what you compare and how the differences are calculated. Review the options, then continue.",targetSelector:Te.compareParameters,position:"left",requiresAction:{type:"none"}},{id:fe.chatSwitch,title:"Chat",description:"Open the Chat tab to ask questions about the data and get insights. Click Chat to continue.",targetSelector:Te.chatSwitch,position:"left",requiresAction:{type:"click"}},{id:fe.chatOverview,title:"Chat Overview",description:"Use the chat to explore insights, ask about trends, or get help interpreting results. You can also change the parameters with the chat, e.g. 'Compare optimistic and pessimistic prediction of precipitation for 2050. Change the color for a good representation'.<br><br>When you're ready, continue.",targetSelector:Te.chatSection,position:"left",requiresAction:{type:"none"}},{id:fe.analysisSwitch,title:"Analysis Tools",description:"Switch to the Analysis view to see detailed charts and statistics. Click the Analysis button to continue.",targetSelector:Te.analysisSwitch,position:"left",requiresAction:{type:"click"}},{id:fe.analysisOverview,title:"Analysis Overview",description:"Here you can explore charts, compare scenarios, and analyze trends over time. This is where you dive deeper into the data. The tutorial is complete!",targetSelector:Te.analysisOverview,position:"center",requiresAction:{type:"none"}}];let bt={active:!1,currentStep:0,completed:!1};const Cr=new Set;function et(){return bt}function Bf(){bt={active:!0,currentStep:0,completed:!1},Cr.clear()}function yi(){bt={active:!1,currentStep:0,completed:!1},Cr.clear(),document.querySelectorAll(".tutorial-target-active").forEach(e=>{e.classList.remove("tutorial-target-active")})}function Ff(){bt.currentStep<Rn.length-1?bt.currentStep++:yi()}function Dt(){const e=Rn[bt.currentStep];e&&Cr.add(e.id),Ff()}function Uf(){return{current:bt.currentStep+1,total:Rn.length}}function vo(e,t,a=!0){if(t===fe.map)return null;const r=document.querySelector(e);if(r){if(t===fe.mapReview){const l=document.querySelector('[data-role="sidebar"]')?.getBoundingClientRect(),c=l?l.left:window.innerWidth;return new DOMRect(0,0,Math.max(c,0),window.innerHeight)}if(t===fe.chatOverview){const l=document.querySelector('[data-role="sidebar"]')?.getBoundingClientRect();if(l)return new DOMRect(l.left,0,l.width,window.innerHeight)}const o=r.getBoundingClientRect(),s=r.querySelector(".custom-select-dropdown");if(a&&s&&r.classList.contains("open")){const i=s.getBoundingClientRect(),l=Math.min(o.top,i.top),c=Math.max(o.bottom,i.bottom),d=Math.min(o.left,i.left),u=Math.max(o.right,i.right);return new DOMRect(d,l,u-d,c-l)}return o}return null}function Vf(e,t,a){if(!e)return{top:"50%",left:"50%"};const r=20,o={};switch(t){case"top":o.bottom=`${window.innerHeight-e.top+r}px`,o.left=`${e.left+e.width/2}px`;break;case"bottom":o.top=`${e.bottom+r}px`,o.left=`${e.left+e.width/2}px`;break;case"left":if(o.top=`${e.top+e.height/2}px`,a===fe.chatSwitch||a===fe.chatOverview){const i=document.querySelector('[data-role="sidebar"]')?.getBoundingClientRect(),l=i?i.left:e.left;o.right=`${window.innerWidth-l+r}px`}else o.right=`${window.innerWidth-e.left+r}px`;break;case"right":o.top=`${e.top+e.height/2}px`,o.left=`${e.right+r}px`;break;default:o.top="50%",o.left="50%";break}return o}function Of(e){if(!e.active)return"";const t=Rn[e.currentStep];if(!t)return"";const a=document.querySelector(t.targetSelector);if(a){document.querySelectorAll(".tutorial-target-active").forEach(h=>{h!==a&&h.classList.remove("tutorial-target-active")}),a.classList.add("tutorial-target-active");const u=a.closest(".custom-select-container");if(u){u.classList.add("tutorial-target-active");const h=u.querySelector(".custom-select-info-panel");h&&h.classList.add("tutorial-target-active")}const f=document.querySelector(".custom-select-info-panel-shared");f&&f.classList.add("tutorial-target-active")}const r=Uf(),o=vo(t.targetSelector,t.id,!0),s=vo(t.targetSelector,t.id,!1),i=Vf(s,t.position,t.id);let l="";t.position==="center"?l="transform: translate(-50%, -50%);":t.position==="top"||t.position==="bottom"?l="transform: translateX(-50%);":(t.position==="left"||t.position==="right")&&(l="transform: translateY(-50%);");const c=Object.entries(i).map(([u,f])=>`${u}: ${f};`).join(" ");let d="";if(o){const f=o.top-5,h=o.left-5,p=o.bottom+5,x=o.right+5;d=`clip-path: polygon(
            0% 0%, 
            0% 100%, 
            ${h}px 100%, 
            ${h}px ${f}px, 
            ${x}px ${f}px, 
            ${x}px ${p}px, 
            ${h}px ${p}px, 
            ${h}px 100%, 
            100% 100%, 
            100% 0%
        );`}return`
        <div class="tutorial-backdrop" style="${d}"></div>
        ${o?`<div class="tutorial-spotlight" style="
                    top: ${o.top}px;
                    left: ${o.left}px;
                    width: ${o.width}px;
                    height: ${o.height}px;
                "></div>`:""}
        <div class="tutorial-box" data-role="tutorial-box" style="${c} ${l}">
            <div class="tutorial-header">
                <div class="tutorial-progress">Step ${r.current} of ${r.total}</div>
                <button class="tutorial-close" data-action="close-tutorial" aria-label="Close tutorial">×</button>
            </div>
            <h3 class="tutorial-title">${t.title}</h3>
            <p class="tutorial-description">${t.description}</p>
            <div class="tutorial-actions">
                        <button class="tutorial-btn tutorial-btn-primary" data-action="tutorial-continue">Continue →</button>
                    </div>
        </div>
    `}function qf(){return bt.completed?"":`
        <button class="tutorial-start-btn" data-action="start-tutorial" aria-label="Start tutorial">
            ?
        </button>
    `}function or(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:{r:0,g:0,b:0}}const zf=e=>e-273.15,Hf=e=>(e-273.15)*(9/5)+32,Wf=e=>e*1e3,Yf=e=>e*3.6,Xf=e=>e*2.237,jf=e=>e/1e3,Ot=e=>e;function Ue(e){switch(e){case"tas":case"tasmin":case"tasmax":return[{label:"Kelvin (K)",unit:"K",convert:Ot},{label:"Celsius (°C)",unit:"°C",convert:zf},{label:"Fahrenheit (°F)",unit:"°F",convert:Hf}];case"pr":return[{label:"g m⁻² s⁻¹",unit:"g m⁻² s⁻¹",convert:Wf},{label:"kg m⁻² s⁻¹",unit:"kg m⁻² s⁻¹",convert:Ot}];case"rsds":case"rlds":return[{label:"W/m²",unit:"W/m²",convert:Ot},{label:"kW/m²",unit:"kW/m²",convert:jf}];case"sfcWind":return[{label:"m/s",unit:"m/s",convert:Ot},{label:"km/h",unit:"km/h",convert:Yf},{label:"mph",unit:"mph",convert:Xf}];case"hurs":return[{label:"Percent (%)",unit:"%",convert:Ot}];default:return[{label:"Default",unit:"",convert:Ot}]}}function Pe(e){return Ue(e)[0]}function jt(e,t,a,r){const s=Ue(t).find(i=>i.label===a);return s?r?.isDifference&&["tas","tasmin","tasmax"].includes(t)?a.includes("Celsius")?e:a.includes("Fahrenheit")?e*(9/5):e:s.convert(e):e}function vi(e,t){return Ue(e).find(o=>o.label===t)?.unit||""}function Da(e,t,a,r,o){const i=Ue(a).find(l=>l.label===r);return i?o?.isDifference&&["tas","tasmin","tasmax"].includes(a)?r.startsWith("Celsius")?{min:e,max:t}:r.startsWith("Fahrenheit")?{min:e*1.8,max:t*1.8}:{min:e,max:t}:{min:i.convert(e),max:i.convert(t)}:{min:e,max:t}}let it=null,$n=[];function Pr(e,t,a,r){const o=r.map(or);for(let s=0;s<a;s++){const l=(1-s/(a-1))*(o.length-1),c=Math.floor(l),d=Math.min(c+1,o.length-1),u=l-c,f=o[c],h=o[d],p=Math.round(f.r+(h.r-f.r)*u),x=Math.round(f.g+(h.g-f.g)*u),T=Math.round(f.b+(h.b-f.b)*u);e.fillStyle=`rgb(${p}, ${x}, ${T})`,e.fillRect(0,s,t,1)}}function Kf(e,t,a,r,o,s,i=0){const l=r?.variable_metadata[e],c=l?.name||e;let d=t,u=a,f=l?.unit||"";if(o){const T=Da(t,a,e,o,{isDifference:s});d=T.min,u=T.max,f=vi(e,o)}const h=(u-d)/4,p=[u,u-h,u-2*h,u-3*h,d];return`
      <div class="map-legend" ${i?`style="transform: translateY(calc(-50% - ${i}px));"`:""}>
        <div class="legend-title">${c}</div>
        <div class="legend-container">
        <canvas id="legend-gradient-canvas" width="20" height="200" style="width: 20px; height: 200px; border-radius: 4px;"></canvas>
          <div class="legend-labels">
            ${p.map(T=>`<span>${T.toFixed(2)} ${f}</span>`).join("")}
          </div>
        </div>
      </div>
    `}function Yn(e,t){const a=document.getElementById(e);if(!a){console.warn("Legend canvas not found");return}it=a,$n=t;const r=a.getContext("2d");if(!r)return;const o=a.width,s=a.height;Pr(r,o,s,t)}function Gf(e,t,a){if(!it||$n.length===0)return;const r=it.getContext("2d");if(!r)return;const o=it.width,s=it.height;Pr(r,o,s,$n);const i=a-t,l=!Number.isFinite(i)||i<=0||!Number.isFinite(e)?.5:Math.min(1,Math.max(0,(e-t)/i)),c=Math.round(s*(1-l));r.strokeStyle="rgba(255, 255, 255, 0.95)",r.lineWidth=2,r.shadowColor="rgba(0, 0, 0, 0.8)",r.shadowBlur=4,r.beginPath(),r.moveTo(0,c),r.lineTo(o,c),r.stroke(),r.shadowBlur=0}function Qf(){if(!it||$n.length===0)return;const e=it.getContext("2d");if(!e)return;const t=it.width,a=it.height;Pr(e,t,a,$n)}const Cn="http://localhost:8000";class Ae extends Error{statusCode;details;constructor(t,a,r){super(t),this.name="DataClientError",this.statusCode=a,this.details=r}}function st(e){return{Historical:"historical",SSP245:"ssp245",SSP585:"ssp585"}[e]||e.toLowerCase()}function Zf(e){return e===1?"low":e===2?"medium":"high"}function Jf(e,t,a="float32"){const r=atob(e),o=new Uint8Array(r.length);for(let s=0;s<r.length;s++)o[s]=r.charCodeAt(s);if(a.includes("float32"))return new Float32Array(o.buffer);if(a.includes("float64"))return new Float64Array(o.buffer);throw new Error(`Unsupported dtype: ${a}`)}function eh(e,t){const a=e.flat(),r=new Float32Array(a.length);for(let o=0;o<a.length;o++)r[o]=a[o];return r}async function _e(e,t){const r=`${Cn}/data`;try{const o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,scenario:e.scenario?st(e.scenario):void 0,data_format:e.data_format||"base64"})});if(!o.ok){const s=await o.json().catch(()=>({detail:o.statusText}));throw new Ae(s.detail||`HTTP ${o.status}: ${o.statusText}`,o.status,s)}return await o.json()}catch(o){throw o instanceof Ae?o:new Ae(`Failed to fetch data: ${o instanceof Error?o.message:String(o)}`,void 0,o)}}async function Ta(e){const a=`${Cn}/metadata`;try{const r=await fetch(a,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Ae(`HTTP ${r.status}: ${r.statusText}`,r.status);return await r.json()}catch(r){throw r instanceof Ae?r:new Ae(`Failed to fetch metadata: ${r instanceof Error?r.message:String(r)}`)}}function Re(e){return e.data?e.data instanceof Float32Array||e.data instanceof Float64Array?e.data:e.data_encoding==="none"?null:e.data_encoding==="base64"&&typeof e.data=="string"?Jf(e.data,e.shape,e.dtype):e.data_encoding==="list"&&Array.isArray(e.data)?eh(e.data,e.shape):null:null}function pe(e){return{variable:e.variable,time:e.date,model:e.model,scenario:e.scenario,resolution:Zf(e.resolution),data_format:e.dataFormat||"base64"}}async function _r(e,t){const r=`${Cn}/pixel-data`;try{const o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,scenario:e.scenario?st(e.scenario):void 0,resolution:e.resolution||"medium",step_days:e.step_days||1})});if(!o.ok){const s=await o.json().catch(()=>({detail:o.statusText}));throw new Ae(s.detail||`HTTP ${o.status}: ${o.statusText}`,o.status,s)}return await o.json()}catch(o){throw o instanceof Ae?o:new Ae(`Failed to fetch pixel data: ${o instanceof Error?o.message:String(o)}`,void 0,o)}}async function ir(e,t){const r=`${Cn}/aggregate-on-demand`;try{const o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,scenario:e.scenario?st(e.scenario):void 0,resolution:e.resolution||"medium",step_days:e.step_days||1})});if(!o.ok){const s=await o.json().catch(()=>({detail:o.statusText}));throw new Ae(s.detail||`HTTP ${o.status}: ${o.statusText}`,o.status,s)}return await o.json()}catch(o){throw o instanceof Ae?o:new Ae(`Failed to fetch aggregate data: ${o instanceof Error?o.message:String(o)}`,void 0,o)}}async function th(e){const a=`${Cn}/health`;try{return(await fetch(a,{method:"GET",signal:AbortSignal.timeout(5e3)})).ok}catch{return!1}}let un=null,bi=0,xi=1,Xn="",jn="",wi=!1;function Si(){return un||(un=document.createElement("div"),un.className="map-tooltip",document.body.appendChild(un)),un}function nh(e,t,a,r,o,s,i){const l=Si();let c=o,d=s;jn&&Xn&&(c=jt(o,Xn,jn,{isDifference:i??wi}),d=vi(Xn,jn)||s),l.textContent=`Lat: ${a.toFixed(2)}, Lon: ${r.toFixed(2)}, Value: ${c.toFixed(2)} ${d}`,l.style.display="block",l.style.left=`${e+10}px`,l.style.top=`${t+10}px`,Gf(c,bi,xi)}function gn(){const e=Si();e.style.display="none",Qf()}function ah(e,t,a,r,o){bi=e,xi=t,a!==void 0&&(Xn=a),r!==void 0&&(jn=r),o!==void 0&&(wi=o)}let te=ka,yn=null,he=null,Mi=null,$i=!1,ha=null,ki,Di,vn=!1,sr=null,lr=null;function Ti(){return te.k}function rh(e){const t=e.getContext("2d");if(!t)return null;const a=e.getBoundingClientRect();return e.width=a.width*window.devicePixelRatio,e.height=a.height*window.devicePixelRatio,t.scale(window.devicePixelRatio,window.devicePixelRatio),{ctx:t,rect:a,viewWidth:a.width,viewHeight:a.height}}function oh(e,t,a,r){const o=e*a+a/2,s=o>180?o-360:o,i=90-(t*r+r/2);return[s,i]}function ih(e,t,a,r,o){if(e<0||e>=a||t<0||t>=r)return null;const i=(r-1-t)*a+e,l=o[i];return isFinite(l)?l:null}function Ha(e){vn?e.style.cursor="crosshair":e.style.cursor="auto"}function bo(e,t,a){if(!he)return null;const r=e.getBoundingClientRect(),o=t-r.left,s=a-r.top;let i=(o-te.x)/te.k;const l=(s-te.y)/te.k,c=he.width,d=he.height;if(l<0||l>d)return null;let u=i;u=u%c,u<0&&(u+=c),u<0&&(u=0),u>=c&&(u=c*(1-Number.EPSILON));const f=u/c*360-180,h=90-l/d*150,p=Math.max(-180,Math.min(180,f)),x=Math.max(-90,Math.min(90,h));return!Number.isFinite(p)||!Number.isFinite(x)?null:{lat:x,lon:p}}function sh(e,t){vn=e,sr=e?t??null:null}function Kn(e,t,a){if(!he)return null;const r=he.width,o=he.height;let s=t;for(;s>180;)s-=360;for(;s<-180;)s+=360;const i=(s+180)/360*r,l=(90-a)/150*o,c=i*te.k+te.x,d=l*te.k+te.y,u=e.getBoundingClientRect(),f=r*te.k,h=u.width/2;let p=c,x=Math.abs(c-h);for(let T=-f;T<=f;T+=f){const k=c+T,w=Math.abs(k-h);w<x&&(x=w,p=k)}return d<-o*te.k||d>u.height+o*te.k?null:{x:p,y:d}}function lh(e,t,a,r,o,s){sh(s?.drawMode??!1,{onClick:s?.onDrawClick,onMove:s?.onDrawMove}),lr=s?.onTransform??null,Ha(e);const i=nt(e);yn=Df().scaleExtent([.8,10]).filter(l=>vn?!1:!l.ctrlKey&&!l.button).on("zoom",l=>{te=l.transform,(he||t)&&xo(e),lr?.()}).on("start",()=>{e.style.cursor="grabbing",gn()}).on("end",()=>{Ha(e)}),i.call(yn),i.call(yn.transform,te),i.on("click.draw",l=>{const c=bo(e,l.clientX,l.clientY);if(c){if(vn){sr?.onClick?.(c);return}s?.onMapClick?.(c)}}),i.on("pointermove.tooltip",l=>{if(vn){const c=bo(e,l.clientX,l.clientY);c&&sr?.onMove?.(c),gn();return}if(l.buttons===0&&Mi&&ha&&he){const[c,d]=ht(l,e);dh(l.clientX,l.clientY,c,d,a,ki,Di,$i)}}),i.on("pointerleave",()=>{gn()}),Ha(e)}function xo(e){if(!he)return;const t=e.getContext("2d");if(!t)return;const a=e.getBoundingClientRect();t.clearRect(0,0,a.width,a.height),t.save(),t.translate(te.x,te.y),t.scale(te.k,te.k),t.imageSmoothingEnabled=!1;const r=he.width,o=-te.x/te.k,s=(a.width-te.x)/te.k,i=Math.floor(o/r)-1,l=Math.ceil(s/r)+1;for(let c=i;c<=l;c++)t.drawImage(he,c*r,0);t.restore()}function Gn(e,t,a,r,o,s,i,l,c,d,u,f){if(t)try{ch(e,t,a,r,o,s,i,l,c,d,u,f)}catch(h){console.error("renderMapData failed (e.g. when changing display variable with masks):",h)}}function ch(e,t,a,r,o,s,i,l,c,d,u,f){const h=Re(e);if(!h){console.warn("No data to render");return}const p=rh(t);if(!p)return;const{ctx:x,rect:T,viewWidth:k,viewHeight:w}=p,[v,L]=e.shape,R=L*v;x.clearRect(0,0,T.width,T.height),x.save();const $=!!e?.metadata?.comparison||typeof e.model=="string"&&e.model.includes(" minus ");Mi=e,ki=i,Di=l,$i=$;const D=new Array(w).fill(null).map(()=>new Float32Array(k).fill(NaN));let F=o,N=s;if(i&&l){const W=Da(o,s,i,l,{isDifference:$});F=W.min,N=W.max}Number.isFinite(F)||(F=0),Number.isFinite(N)||(N=1),N<=F&&(N=F+1),ah(F,N,i,l,$);const j=(a.find(W=>W.name===r)||a[0]).colors,O=j.length>0?j.map(or):[or("#808080")];function Q(W,H){const P=(W+180)/360*k,z=(90-H)/150*w;return[P,z]}const Y=document.createElement("canvas");Y.width=k,Y.height=w;const y=Y.getContext("2d");if(!y)return;const B=y.createImageData(k,w),E=B.data,m=Math.max(k/L,w/v),b=Math.ceil(m/2),S=360/L,_=150/v,U=new Map;if(!u&&c&&c.length>0&&f){const W=new Set;for(const H of c)H.variable&&H.variable!==i&&W.add(H.variable);W.forEach(H=>{const P=f.get(H);if(P)try{const z=Re(P);z&&z.length===R&&U.set(H,z)}catch(z){console.warn(`Failed to decode mask data for variable ${H}:`,z)}})}for(let W=0;W<v;W++)for(let H=0;H<L;H++){const P=ih(H,W,L,v,h);if(P===null)continue;const[z,G]=oh(H,W,S,_),[A,ie]=Q(z,G);let re=P;i&&l&&(re=jt(P,i,l,{isDifference:$}));let se=!1;if(c&&c.length>0)if(u&&d){se=!0;for(const le of c){const ue=!le.lowerEdited||le.lowerBound===null,ye=!le.upperEdited||le.upperBound===null,Ge=le.statistic||"mean",ke=d.get(Ge);if(!ke)continue;const De=(v-1-W)*L+H,qe=ke[De];if(!isFinite(qe)){se=!1;break}let rn=qe;if(i&&l&&(rn=jt(qe,i,l,{isDifference:Ge!=="mean"||$})),!ue&&le.lowerBound!==null&&rn<le.lowerBound){se=!1;break}if(!ye&&le.upperBound!==null&&rn>le.upperBound){se=!1;break}}}else{const le=new Map;for(const ue of c){const ye=ue.variable;ye&&(le.has(ye)||le.set(ye,[]),le.get(ye).push(ue))}se=!0;for(const[ue,ye]of le){let Ge=!1,ke;if(ue===i)ke=P;else if(U.has(ue)){const De=U.get(ue),qe=(v-1-W)*L+H;if(ke=De[qe],!isFinite(ke)){se=!1;break}}else{se=!1;break}for(const De of ye){const qe=!De.lowerEdited,rn=!De.upperEdited,Ra=De.unit;let Ca=ke;Ra&&(Ca=jt(ke,ue,Ra));let Pa=!0;if(!qe&&De.lowerBound!==null&&Ca<De.lowerBound&&(Pa=!1),!rn&&De.upperBound!==null&&Ca>De.upperBound&&(Pa=!1),Pa){Ge=!0;break}}if(!Ge){se=!1;break}}}else se=!0;let we,Oe,Ut;if(!se&&c&&c.length>0)we=20,Oe=24,Ut=32;else{const le=N-F;let ue;!Number.isFinite(le)||le<=0||!Number.isFinite(re)?ue=.5:(ue=Math.min(1,Math.max(0,(re-F)/le)),Number.isFinite(ue)||(ue=.5));const ye=Math.max(0,O.length-1),Ge=Math.min(Math.max(0,Math.floor(ue*ye)),ye),ke=O[Ge],De=O[Math.min(Ge+1,ye)]??ke,qe=Math.max(0,Math.min(1,ue*ye-Ge));we=Math.round(ke.r+(De.r-ke.r)*qe),Oe=Math.round(ke.g+(De.g-ke.g)*qe),Ut=Math.round(ke.b+(De.b-ke.b)*qe)}const Yi=Math.max(0,Math.floor(A-b)),Xi=Math.min(k,Math.ceil(A+b)),ji=Math.max(0,Math.floor(ie-b)),Ki=Math.min(w,Math.ceil(ie+b));for(let le=ji;le<Ki;le++)for(let ue=Yi;ue<Xi;ue++){const ye=(le*k+ue)*4;E[ye]=we,E[ye+1]=Oe,E[ye+2]=Ut,E[ye+3]=255,D[le][ue]=P}}y.putImageData(B,0,0),he=Y,ha=D,x.clearRect(0,0,T.width,T.height),x.save(),x.translate(te.x,te.y),x.scale(te.k,te.k),x.imageSmoothingEnabled=!1;const I=he.width,C=-te.x/te.k,V=(T.width-te.x)/te.k,K=Math.floor(C/I)-1,Z=Math.ceil(V/I)+1;for(let W=K;W<=Z;W++)x.drawImage(he,W*I,0);x.restore()}function Li(e,t,a,r=3.2,o=550){if(!he||!yn)return;const s=e.getBoundingClientRect(),i=he.width,l=he.height;let c=t;for(;c>180;)c-=360;for(;c<-180;)c+=360;const d=(c+180)/360*i,u=(90-a)/150*l,f=[d-i,d,d+i];let h=s.width/2-d*r,p=Math.abs(h-te.x);for(const k of f){const w=s.width/2-k*r,v=Math.abs(w-te.x);v<p&&(p=v,h=w)}const x=s.height/2-u*r,T=ka.translate(h,x).scale(r);nt(e).transition().duration(o).ease(Ed).call(yn.transform,T),te=T,lr?.()}function dh(e,t,a,r,o,s,i,l){if(!ha||!he)return;let c=(a-te.x)/te.k;const d=(r-te.y)/te.k,u=he.width,f=he.height;c=(c%u+u)%u;const h=Math.floor(c),p=Math.floor(d);if(h>=0&&h<u&&p>=0&&p<f){const x=ha?.[p]?.[h]??0;if(isFinite(x)){const T=c/u*360-180,k=90-d/f*150;nh(e,t,k,T,x,o,l)}else gn()}else gn()}function pt(e){const t=new Date(e);return`${["January","February","March","April","May","June","July","August","September","October","November","December"][t.getMonth()]} ${t.getDate()}, ${t.getFullYear()}`}function uh(e){const{date:t,timeRange:a,sidebarOpen:r,sidebarWidth:o,mode:s,compareMode:i,compareDateStart:l,compareDateEnd:c}=e;let d=0,u=0,f=0,h=0,p=0,x=0,T=0,k=100;if(a){const v=new Date(a.start),L=new Date(a.end),R=new Date(t);if(u=Math.floor((L.getTime()-v.getTime())/(1e3*60*60*24)),f=Math.floor((R.getTime()-v.getTime())/(1e3*60*60*24)),h=u>0?f/u*100:0,s==="Compare"&&i==="Dates"){const $=l?new Date(l):v,D=c?new Date(c):L;p=Math.max(0,Math.floor(($.getTime()-v.getTime())/(1e3*60*60*24))),x=Math.min(u,Math.floor((D.getTime()-v.getTime())/(1e3*60*60*24))),T=u>0?p/u*100:0,k=u>0?x/u*100:100}}const w=r?o+16:16;if(s==="Compare"&&i==="Dates"&&a){const v=pt(l||a.start),L=pt(c||a.end);return`
      <div class="time-slider-container" style="right: ${w}px">
        <div data-role="time-label" class="time-label">${v} – ${L}</div>
        <div class="time-slider-row dual-slider" data-role="dual-slider">
          <div
            class="dual-slider-track"
            aria-hidden="true"
          ></div>
          <div
            class="dual-slider-fill"
            data-role="dual-fill"
            style="--fill-start: ${T}%; --fill-end: ${k}%"
            aria-hidden="true"
          ></div>
          <input
            type="range"
            min="${d}"
            max="${u}"
            step="1"
            value="${p}"
            data-action="set-time-start"
            class="time-slider dual-thumb dual-thumb-start"
            aria-label="Start date"
          />
          <input
            type="range"
            min="${d}"
            max="${u}"
            step="1"
            value="${x}"
            data-action="set-time-end"
            class="time-slider dual-thumb dual-thumb-end"
            aria-label="End date"
          />
        </div>
      </div>
    `}return`
      <div class="time-slider-container" data-role="time-slider" style="right: ${w}px">
        <div data-role="time-label" class="time-label">${pt(t)}</div>
        <div class="time-slider-row">
          <input
            type="range"
            min="${d}"
            max="${u}"
            step="1"
            value="${f}"
            data-action="set-time"
            class="time-slider"
            style="--slider-fill: ${h}%"
          />
        </div>
      </div>
    `}let qt=null,cr=null;function fh(e){const{root:t,getTimeRange:a,onDateChange:r,getMode:o,getCompareMode:s,getCompareDates:i,onDateRangeChange:l}=e;cr=t.querySelector('[data-role="time-label"]')?.parentElement??null;const c=()=>o?.()==="Compare"&&s?.()==="Dates";t.querySelectorAll('[data-action="set-time"]').forEach(k=>k.addEventListener("input",()=>{if(c())return;const w=Number.parseInt(k.value,10),v=a();if(!Number.isNaN(w)&&v){const L=new Date(v.start);L.setDate(L.getDate()+w);const R=L.toISOString().split("T")[0],$=t.querySelector('[data-role="time-label"]');$&&($.textContent=pt(R));const D=new Date(v.end),F=Math.floor((D.getTime()-new Date(v.start).getTime())/(1e3*60*60*24)),N=F>0?w/F*100:0;k.style.setProperty("--slider-fill",`${N}%`),qt&&window.clearTimeout(qt),qt=window.setTimeout(()=>{r(R)},500)}}));const u=t.querySelectorAll('[data-action="set-time-start"]'),f=t.querySelectorAll('[data-action="set-time-end"]'),h=t.querySelector('[data-role="dual-fill"]'),p=(k,w,v,L,R)=>{const $=t.querySelector('[data-role="time-label"]'),D=new Date(v.start),F=new Date(v.start);D.setDate(D.getDate()+k),F.setDate(F.getDate()+w);const N=D.toISOString().split("T")[0],X=F.toISOString().split("T")[0];$&&($.textContent=`${pt(N)} – ${pt(X)}`);const j=new Date(v.end).getTime()-new Date(v.start).getTime(),O=Math.max(1,Math.floor(j/(1e3*60*60*24))),Q=k/O*100,Y=w/O*100;[h,L,R].forEach(B=>{B&&(B.style.setProperty("--fill-start",`${Q}%`),B.style.setProperty("--fill-end",`${Y}%`))})},x=(k,w,v)=>{k.addEventListener("input",()=>{if(!c())return;const L=a();if(!L)return;const R=Math.floor((new Date(L.end).getTime()-new Date(L.start).getTime())/(1e3*60*60*24));let $=Number.parseInt(v?k.value:w.value,10),D=Number.parseInt(v?w.value:k.value,10);if(Number.isNaN($)||Number.isNaN(D))return;$=Math.max(0,Math.min($,R)),D=Math.max(0,Math.min(D,R)),v&&$>D?(D=$,w.value=String(D)):!v&&D<$&&($=D,w.value=String($)),p($,D,L,v?k:w,v?w:k);const F=new Date(L.start);F.setDate(F.getDate()+$);const N=new Date(L.start);N.setDate(N.getDate()+D);const X=F.toISOString().split("T")[0],j=N.toISOString().split("T")[0];qt&&window.clearTimeout(qt),qt=window.setTimeout(()=>{l?.(X,j)},300)})},T=k=>{const w=u[0],v=f[0];!w||!v||(k==="start"?(w.style.zIndex="4",v.style.zIndex="3"):(w.style.zIndex="3",v.style.zIndex="4"))};if(u.length&&f.length){u.forEach((v,L)=>{const R=f[L]||f[0];x(v,R,!0),v.addEventListener("pointerdown",()=>T("start"))}),f.forEach((v,L)=>{const R=u[L]||u[0];x(v,R,!1),v.addEventListener("pointerdown",()=>T("end"))}),u.forEach(v=>v.addEventListener("focus",()=>T("start"))),f.forEach(v=>v.addEventListener("focus",()=>T("end")));const k=(v,L)=>{v.addEventListener("pointerdown",R=>{if(!c())return;const $=a();if(!$)return;const D=v.getBoundingClientRect(),F=Math.min(1,Math.max(0,(R.clientX-D.left)/D.width)),N=Math.max(1,Math.floor((new Date($.end).getTime()-new Date($.start).getTime())/(1e3*60*60*24))),X=Number.parseInt(v.value,10),O=(Number.isNaN(X)?0:Math.max(0,Math.min(X,N)))/N;Math.abs(F-O)*D.width>14&&(R.preventDefault(),R.stopPropagation(),T(v===L?"end":"start"))})};if(k(u[0],f[0]),k(f[0],u[0]),c()){const v=a(),L=i?.();if(v&&L){const R=Math.max(0,Math.floor((new Date(L.start).getTime()-new Date(v.start).getTime())/864e5)),$=Math.max(0,Math.floor((new Date(L.end).getTime()-new Date(v.start).getTime())/(1e3*60*60*24))),D=u[0],F=f[0];D.value=String(R),F.value=String(Math.max($,R)),p(R,Math.max($,R),v,D,F)}}t.querySelectorAll(".dual-slider").forEach(v=>{v.addEventListener("pointermove",L=>{if(!c())return;const R=a();if(!R)return;const $=u[0],D=f[0];if(!$||!D)return;const F=v.getBoundingClientRect(),N=Math.min(1,Math.max(0,(L.clientX-F.left)/F.width)),X=Math.max(1,Math.floor((new Date(R.end).getTime()-new Date(R.start).getTime())/(1e3*60*60*24)));let j=Number.parseInt($.value,10),O=Number.parseInt(D.value,10);Number.isNaN(j)&&(j=0),Number.isNaN(O)&&(O=X);const Q=j/X,Y=O/X,y=Math.abs(N-Q)<=Math.abs(N-Y);T(y?"start":"end")})})}}function hh(e,t){if(cr){const a=e?t+16:16;cr.style.right=`${a}px`}}const ph=!1;function Ei(e,t){document.querySelectorAll("[data-role='chart-container']").forEach(r=>{r.style.transition="padding 220ms ease, padding-right 220ms ease, transform 220ms ease",r.style.paddingRight=`${e}px`,typeof t=="number"&&(r.style.transform=`scale(${t})`,r.style.transformOrigin="center center")})}function ut(e){const t=e.toLowerCase();return t==="historical"?"Historical":t==="ssp245"?"SSP245":t==="ssp370"?"SSP370":t==="ssp585"?"SSP585":e}function mh(e){const t=e.toLowerCase();return t==="viridis"?"Viridis":t==="magma"?"Magma":t==="cividis"?"Cividis":t==="thermal"?"Thermal":e}function J(e){return new Date(e)}function nn(e){if(!e.length)return Ne("Historical");let t="1900-01-01",a="2100-12-31";return e.forEach((r,o)=>{const s=Ne(r);if(o===0){t=s.start,a=s.end;return}t=J(s.start)>J(t)?s.start:t,a=J(s.end)<J(a)?s.end:a}),{start:t,end:a}}function ve(e,t){const a=J(e),r=J(t.start),o=J(t.end);return a<r?t.start:a>o?t.end:e}function Ri(e){const t=J(e);if(Number.isNaN(t.getTime()))return{start:"2015-01-01",end:"2099-01-01"};const a=t.getMonth(),r=t.getDate(),o=l=>{const c=new Date(l,a+1,0).getDate();return Math.min(r,c)},s=new Date(2015,a,o(2015)),i=new Date(2099,a,o(2099));return{start:s.toISOString().slice(0,10),end:i.toISOString().slice(0,10)}}const Me=["Historical","SSP245","SSP370","SSP585"],me=["ACCESS-CM2","CanESM5","CESM2","CMCC-CM2-SR5","EC-Earth3","GFDL-ESM4","INM-CM5-0","IPSL-CM6A-LR","MIROC6","MPI-ESM1-2-HR","MRI-ESM2-0"],Le=["tas","pr","rsds","hurs","rlds","sfcWind","tasmin","tasmax"],gh={SSP245:"A moderate scenario (2015-2100) that assumes we take active measures against climate change. This represents a realistic path where significant climate protection policies are implemented, leading to moderate warming by the end of the century.",SSP370:"A moderate-to-high scenario (2015-2100) representing a middle ground. This path assumes some climate action is taken, but not enough to prevent substantial warming. It falls between optimistic and pessimistic outcomes.",SSP585:"A pessimistic scenario (2015-2100) representing a worst-case path with minimal climate action. This shows what happens if we continue with current trends and take little to no measures against climate change, leading to severe warming.",Historical:"Historical climate simulation (1950-2014) based on past conditions. This represents simulated climate data for the historical period, used as a baseline to compare against future projections."},yh={tas:"Near-Surface Air Temperature",pr:"Precipitation",rsds:"Surface Downwelling Shortwave Radiation",hurs:"Near-Surface Relative Humidity",rlds:"Surface Downwelling Longwave Radiation",sfcWind:"Daily-Mean Near-Surface Wind Speed",tasmin:"Daily Minimum Near-Surface Air Temperature",tasmax:"Daily Maximum Near-Surface Air Temperature"},vh={tas:"The air temperature near the Earth's surface, measured in Kelvin.",pr:"The amount of water that falls from the atmosphere to the surface, measured as mass per unit area per unit time.",rsds:"Incoming solar radiation reaching the Earth's surface, measured in Watts per square meter.",hurs:"The amount of moisture in the air relative to the maximum it can hold, expressed as a percentage.",rlds:"Incoming thermal radiation from the atmosphere, measured in Watts per square meter.",sfcWind:"The average wind speed near the surface over a day, measured in meters per second.",tasmin:"The lowest air temperature near the surface during a day, measured in Kelvin.",tasmax:"The highest air temperature near the surface during a day, measured in Kelvin."},bh={"ACCESS-CM2":"Developed by Australia's research institutions. This model is part of the global CMIP6 ensemble, providing climate projections that contribute to our understanding of future climate patterns.",CanESM5:"The Canadian Earth System Model version 5, developed by Environment and Climate Change Canada. This model represents North American climate research and contributes valuable projections to the global climate science community.",CESM2:"The Community Earth System Model version 2, developed by the National Center for Atmospheric Research (NCAR) in the United States. One of the most widely used models in climate research, known for its comprehensive representation of Earth's climate system.","CMCC-CM2-SR5":"Developed by the Euro-Mediterranean Center on Climate Change (CMCC) in Italy. This model provides European perspectives on climate change and is particularly valuable for understanding Mediterranean and European climate patterns.","EC-Earth3":"A collaborative European climate model developed by multiple research institutions across Europe. This model combines expertise from various European countries to provide comprehensive climate projections.","GFDL-ESM4":"Developed by NOAA's Geophysical Fluid Dynamics Laboratory in the United States. This model is known for its advanced representation of ocean and atmosphere interactions, providing detailed climate projections.","INM-CM5-0":"Developed by the Institute of Numerical Mathematics in Russia. This model contributes a unique perspective from Russian climate research to the global ensemble of climate models.","IPSL-CM6A-LR":"Developed by the Institut Pierre-Simon Laplace in France. This model is part of a long-standing French climate modeling tradition and provides important contributions to understanding global climate dynamics.",MIROC6:"Developed by a Japanese research consortium. This model represents Asian climate research expertise and contributes valuable insights, particularly for understanding climate patterns in the Asia-Pacific region.","MPI-ESM1-2-HR":"Developed by the Max Planck Institute in Germany. This high-resolution model provides detailed climate projections and is known for its sophisticated representation of Earth's climate system.","MRI-ESM2-0":"Developed by Japan's Meteorological Research Institute. This model contributes Japanese climate research expertise to the global ensemble, providing valuable perspectives on climate change projections."},de=[{name:"Viridis",colors:["#440154","#3b528b","#21908d","#5dc863","#fde725"]},{name:"Magma",colors:["#000004","#3b0f70","#8c2981","#de4968","#fe9f6d"]},{name:"Cividis",colors:["#00204c","#31456a","#6b6d7f","#a59c8f","#fdea9b"]},{name:"Thermal",colors:["#04142f","#155570","#1fa187","#f8c932","#f16623"]}],M={page:{position:"relative",minHeight:"100vh",color:"white",overflow:"hidden",fontFamily:"Inter, system-ui, sans-serif"},bgLayer1:{position:"absolute",inset:0,background:"linear-gradient(135deg, #05070f, #0b1326)"},bgLayer2:{position:"absolute",inset:0,background:"radial-gradient(circle at 20% 20%, rgba(56,189,248,0.12), transparent 32%), radial-gradient(circle at 80% 10%, rgba(139,92,246,0.15), transparent 30%), radial-gradient(circle at 50% 70%, rgba(34,197,94,0.08), transparent 28%)"},bgOverlay:{position:"absolute",inset:0,background:"#050505",opacity:.35},branding:{position:"fixed",top:16,left:16,display:"flex",alignItems:"center",gap:12,padding:"8px 0",background:"transparent",border:"none",borderRadius:0,zIndex:"9999",boxShadow:"none",backdropFilter:"none",pointerEvents:"auto"},brandIcon:{width:38,height:38,position:"relative",display:"grid",placeItems:"center",filter:"drop-shadow(0 8px 18px rgba(0, 0, 0, 0.42))",transition:"transform 160ms ease, filter 160ms ease","--iris-x":"0px","--iris-y":"0px","--pupil-x":"0px","--pupil-y":"0px","--blink-open":"1"},brandSvg:{width:"100%",height:"100%",display:"block"},brandOutline:{stroke:"white",strokeWidth:5,strokeLinecap:"round",strokeLinejoin:"round",fill:"none",opacity:.92},brandLids:{transform:"translate(60px, 40px) scaleY(var(--blink-open, 1)) translate(-60px, -40px)",transformOrigin:"60px 40px",transition:"none"},brandClipRect:{transform:"translate(60px, 40px) scaleY(var(--blink-open, 1)) translate(-60px, -40px)",transformOrigin:"60px 40px",transition:"none"},brandIrisGroup:{transform:"translate(var(--iris-x, 0px), var(--iris-y, 0px))",transition:"none",transformBox:"fill-box",transformOrigin:"center center"},brandIris:{stroke:"white",strokeWidth:5,fill:"rgba(255, 255, 255, 0.08)"},brandPupilGroup:{transform:"translate(var(--pupil-x, 0px), var(--pupil-y, 0px))",transition:"none",transformOrigin:"center center"},brandEyeContent:{clipPath:"url(#brand-eye-clip)"},brandPupil:{fill:"white"},brandHighlight:{fill:"white",opacity:.92},brandName:{fontSize:18,fontWeight:700,letterSpacing:.6,color:"white",textTransform:"none",textShadow:"0 8px 20px rgba(0, 0, 0, 0.45)"},field:{minWidth:0,display:"flex",flexDirection:"column",gap:4},fieldLabel:{fontSize:11,letterSpacing:.5,color:"var(--text-secondary)",textTransform:"uppercase"},mapArea:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:10,textAlign:"center",pointerEvents:"none",zIndex:1},mapSearchWrap:{position:"absolute",top:18,left:"50%",transform:"translateX(-50%)",width:"min(360px, 70vw)",pointerEvents:"auto",zIndex:12,transition:"transform 220ms ease, width 220ms ease"},mapSearchResults:{maxHeight:220,overflowY:"auto"},mapMarker:{position:"absolute",left:0,top:0,width:28,height:36,pointerEvents:"none",zIndex:11,transform:"translate(-9999px, -9999px)",opacity:0,transition:"opacity 160ms ease",filter:"drop-shadow(0 10px 18px rgba(0,0,0,0.45))"},mapInfoPanel:{position:"absolute",left:0,top:0,width:360,maxWidth:"min(360px, 80vw)",opacity:0,userSelect:"none",transform:"translate(-9999px, -9999px)",transition:"opacity 160ms ease",zIndex:12},mapInfoHeader:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:8},mapInfoTitleGroup:{display:"flex",flexDirection:"column",gap:2,flex:1,minWidth:0},mapInfoActions:{display:"flex",gap:6,alignItems:"center"},mapInfoActionBtn:{width:30,height:30,borderRadius:8,border:"none",background:"transparent",color:"var(--text-secondary)",display:"inline-flex",alignItems:"center",justifyContent:"center",cursor:"pointer",pointerEvents:"auto",transition:"all 120ms ease"},mapInfoExpandBtn:{position:"absolute",right:12,bottom:12},mapInfoSubtitle:{fontSize:11.5,color:"var(--text-secondary)",marginTop:2},mapInfoBody:{marginTop:10,display:"flex",flexDirection:"column",gap:10,paddingBottom:36},mapInfoLoadingRow:{display:"flex",alignItems:"center",gap:8,fontSize:11,color:"var(--text-secondary)"},mapInfoLoadingSpinner:{width:14,height:14,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.18)",borderTop:"2px solid #34d399",animation:"sv-spin 1s linear infinite",flexShrink:0},mapRangeOverlay:{position:"fixed",left:0,bottom:0,right:0,height:"min(280px, 36vh)",display:"flex",alignItems:"flex-end",pointerEvents:"none",zIndex:9,transition:"right 220ms ease, opacity 180ms ease"},mapRangePanel:{width:"100%",height:"100%",padding:"12px 18px 12px",display:"flex",flexDirection:"column",gap:10,pointerEvents:"auto",background:"linear-gradient(180deg, rgba(6, 10, 18, 0) 0%, rgba(6, 10, 18, 0.55) 45%, rgba(6, 10, 18, 0.94) 100%)",backdropFilter:"blur(8px)"},mapRangeHeader:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:12},mapRangeTitleGroup:{display:"flex",flexDirection:"column",gap:3,minWidth:0},mapRangeTitle:{fontSize:14,fontWeight:700,letterSpacing:.2,color:"var(--text-primary)"},mapRangeBody:{display:"flex",flexDirection:"column",gap:10,maxHeight:220,overflow:"hidden"},mapRangeChartWrap:{width:"100%",display:"flex",justifyContent:"center",alignItems:"flex-start",height:220,overflow:"hidden"},mapRangeLoadingRow:{display:"flex",alignItems:"center",gap:8,fontSize:11,color:"var(--text-secondary)"},mapRangeLoadingSpinner:{width:14,height:14,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.18)",borderTop:"2px solid #34d399",animation:"sv-spin 1s linear infinite",flexShrink:0},drawOverlay:{position:"absolute",inset:0,background:"rgba(5, 10, 20, 0.28)",backdropFilter:"blur(1px)",pointerEvents:"none",zIndex:8},drawOverlayCanvas:{position:"absolute",inset:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:9},drawPrompt:{position:"absolute",top:16,left:"50%",transform:"translateX(-50%)",padding:"10px 14px",borderRadius:12,background:"rgba(15, 23, 42, 0.92)",border:"1px solid var(--border-medium)",boxShadow:"var(--shadow-elevated)",fontWeight:800,fontSize:13,color:"var(--text-primary)",pointerEvents:"none",zIndex:10,textAlign:"center"},drawPromptSub:{marginTop:4,fontSize:12,fontWeight:600,color:"var(--text-secondary)"},loadingIndicator:{position:"absolute",left:18,bottom:80,display:"flex",alignItems:"center",gap:12,padding:0,pointerEvents:"auto",zIndex:20,minWidth:160},loadingSpinner:{width:18,height:18,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.18)",borderTop:"2px solid #34d399",animation:"sv-spin 1s linear infinite",flexShrink:0},loadingTextGroup:{display:"flex",flexDirection:"column",gap:4,alignItems:"flex-start",minWidth:0},loadingText:{fontSize:12.5,fontWeight:700,color:"var(--text-primary)",letterSpacing:.3},loadingSubtext:{fontSize:11.5,color:"var(--text-secondary)",letterSpacing:.2},loadingBar:{position:"relative",width:120,height:6,borderRadius:999,background:"rgba(255, 255, 255, 0.08)",overflow:"hidden"},loadingBarFill:{position:"absolute",inset:0,borderRadius:999,background:"linear-gradient(90deg, rgba(52, 211, 153, 0.9), rgba(125, 211, 252, 0.9))",transition:"width 140ms ease",width:"0%"},compareInfoWrap:{position:"fixed",right:24,bottom:88,display:"flex",alignItems:"center",pointerEvents:"auto",zIndex:1e4},compareInfoButton:{padding:0,background:"transparent",border:"none",color:"var(--text-primary)",fontWeight:700,fontSize:13,letterSpacing:.2,cursor:"pointer",textDecoration:"underline"},infoModalOverlay:{position:"fixed",inset:0,background:"transparent",backdropFilter:"none",zIndex:200,display:"flex",alignItems:"center",justifyContent:"center",padding:16},infoModal:{width:"min(480px, 92vw)",background:"rgba(12, 16, 24, 0.98)",border:"1px solid var(--border-default)",borderRadius:14,boxShadow:"var(--shadow-elevated)",color:"var(--text-primary)",padding:20,position:"relative",maxWidth:"520px"},infoModalHeader:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,marginBottom:12},infoModalTitle:{fontSize:16,fontWeight:900,letterSpacing:.2,background:"var(--gradient-accent)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",color:"transparent"},infoModalClose:{width:32,height:32,borderRadius:8,border:"none",background:"transparent",color:"var(--text-secondary)",cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",fontWeight:700},infoModalBody:{fontSize:14,lineHeight:1.6,color:"var(--text-primary)",display:"block",textAlign:"left",whiteSpace:"normal",wordBreak:"break-word"},infoModalFooter:{marginTop:18,display:"flex",justifyContent:"center"},infoModalConfirm:{padding:"10px 16px",borderRadius:10,border:"1px solid var(--accent-border)",background:"var(--gradient-primary)",color:"white",fontWeight:700,cursor:"pointer",boxShadow:"var(--shadow-combined)"},canvasToggle:{position:"fixed",top:14,display:"flex",alignItems:"center",gap:8,pointerEvents:"auto",zIndex:100,transition:"right 0.25s ease"},canvasSwitch:{position:"relative",display:"grid",gridTemplateColumns:"1fr 1fr",gap:0,padding:3,borderRadius:11,background:"var(--dark-bg)",border:"var(--border-base)",boxShadow:"var(--shadow-elevated)",zIndex:101},canvasIndicator:{position:"absolute",top:3,bottom:3,left:3,width:"calc(50% - 3px)",borderRadius:9,background:"var(--gradient-indicator)",boxShadow:"var(--shadow-canvas), var(--shadow-inset)",transition:"transform 180ms ease",zIndex:0,pointerEvents:"none"},canvasBtn:{width:40,height:40,borderRadius:9,border:"1px solid transparent",background:"var(--bg-transparent)",color:"var(--text-secondary)",cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",transition:"color 120ms ease",position:"relative",zIndex:1},canvasBtnActive:{color:"white"},mapTitle:{fontSize:18,fontWeight:600},mapSubtitle:{fontSize:14,color:"var(--text-secondary)"},modeSwitch:{position:"relative",display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:4,padding:2,borderRadius:10,border:"1px solid var(--border-subtle)",background:"var(--bg-subtle)",boxShadow:"none"},modeIndicator:{position:"absolute",top:2,bottom:2,left:2,width:"calc(33.333% - 2px)",borderRadius:8,background:"var(--gradient-mode-indicator)",boxShadow:"var(--shadow-combined)",transition:"transform 200ms ease",zIndex:0},modeBtn:{flex:1,padding:"8px 0",borderRadius:8,border:"none",color:"var(--text-secondary)",cursor:"pointer",transition:"all 0.15s ease",background:"var(--bg-transparent)",textAlign:"center",fontSize:12.5,fontWeight:700,letterSpacing:.2,outline:"none",boxShadow:"none",position:"relative",zIndex:1},modeBtnActive:{background:"var(--gradient-primary)",border:"none",color:"white",boxShadow:"var(--shadow-combined)"},tabSwitch:{position:"absolute",left:32,right:12,bottom:-8,display:"flex",gap:10,padding:"0 8px",alignItems:"flex-end",pointerEvents:"auto",zIndex:0},tabBtn:{borderRadius:"14px 14px 0 0",padding:"12px 18px",background:"var(--bg-strong)",color:"var(--text-secondary)",fontWeight:700,fontSize:13,letterSpacing:.35,cursor:"pointer",transition:"all 0.18s ease",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.06), 0 8px 18px rgba(0,0,0,0.32)",borderTop:"var(--border-base)",borderRight:"var(--border-base)",borderLeft:"var(--border-base)",borderBottom:"none",transform:"translateY(4px)"},tabBtnActive:{background:"var(--gradient-tab-active)",color:"white",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.12), 0 12px 26px rgba(0,0,0,0.42)",borderTop:"var(--border-active)",borderRight:"var(--border-active)",borderLeft:"var(--border-active)",borderBottom:"none",transform:"translateY(-4px)",zIndex:1},modeViewport:{overflow:"hidden",width:"100%",position:"relative",flex:1,minHeight:0,height:0},modeTrack:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",width:"300%",height:"100%",transition:"transform 220ms ease"},modePane:{width:"100%",height:"100%",paddingRight:4,overflowY:"auto",overflowX:"hidden",scrollbarGutter:"stable",minHeight:0,maxHeight:"100%"},sectionTitle:{fontSize:13,fontWeight:700,color:"var(--text-primary)",letterSpacing:.3,textTransform:"uppercase"},paramGrid:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},range:{width:"100%",background:"var(--bg-transparent)",appearance:"none",WebkitAppearance:"none",height:10,outline:"none",padding:0,margin:0},resolutionRow:{display:"flex",alignItems:"center",gap:12},resolutionValue:{fontSize:12.5,color:"var(--text-secondary)",minWidth:60,textAlign:"right"},chartPanel:{width:"min(1200px, 100%)",background:"transparent",border:"none",borderRadius:0,padding:0,boxShadow:"none",backdropFilter:"none"},chartHeader:{textAlign:"center",marginBottom:12},chartTitle:{fontSize:18,fontWeight:800,color:"var(--text-primary)"},chartPlotWrapper:{width:"100%",minHeight:360,background:"transparent",border:"none",borderRadius:0,padding:0,position:"relative"},chartEmpty:{textAlign:"center",color:"var(--text-secondary)",padding:"40px 16px",lineHeight:1.6},chartError:{color:"#fca5a5",background:"rgba(248,113,113,0.08)",border:"1px solid rgba(248,113,113,0.35)",borderRadius:12,padding:14,fontSize:13,lineHeight:1.5},chipRow:{display:"flex",flexWrap:"wrap",gap:8},chip:{padding:"8px 10px",borderRadius:12,border:"1px solid var(--border-medium)",background:"rgba(255,255,255,0.04)",color:"var(--text-primary)",cursor:"pointer",fontSize:12.5,fontWeight:700,letterSpacing:.2,transition:"all 140ms ease"},chipActive:{borderColor:"rgba(167,139,250,0.65)",background:"rgba(167,139,250,0.16)",boxShadow:"0 0 0 1px rgba(167,139,250,0.35)"},chartLegend:{display:"flex",gap:12,flexWrap:"wrap",alignItems:"center",marginTop:10,fontSize:12,color:"var(--text-secondary)"}},n={mode:"Explore",panelTab:"Manual",sidebarOpen:!0,canvasView:"map",scenario:Me[0],model:me[0],variable:Le[0],date:"2000-01-01",palette:de[0].name,resolution:2,selectedUnit:Pe(Le[0]).label,chartMode:"single",chartDate:"2026-01-16",chartRangeStart:"2015-01-01",chartRangeEnd:"2099-01-01",chartVariable:Le[0],chartUnit:Pe(Le[0]).label,chartScenarios:["SSP245","SSP370","SSP585"],chartModels:[...me],chartDropdown:{scenariosOpen:!1,modelsOpen:!1},chartLoadingProgress:{total:0,done:0},chartSamples:[],chartBoxes:null,chartRangeSeries:null,chartLoading:!1,chartError:null,chartLocation:"World",chartLocationName:null,chartLocationSearchQuery:"",chartLocationSearchResults:[],chartLocationSearchLoading:!1,chartLocationSearchError:null,mapLocationSearchQuery:"",mapLocationSearchResults:[],mapLocationSearchLoading:!1,mapLocationSearchError:null,mapLocationSearchSelection:null,mapLocationSearchFocused:!1,mapLocationSearchCursor:{start:0,end:0},mapMarker:null,mapInfoSamples:[],mapInfoBoxes:null,mapInfoLoading:!1,mapInfoError:null,mapInfoLoadingProgress:{total:0,done:0},mapInfoOpen:!1,mapRangeSamples:[],mapRangeSeries:null,mapRangeLoading:!1,mapRangeError:null,mapRangeLoadingProgress:{total:0,done:0},mapRangeOpen:!1,mapRangeStart:"2015-01-01",mapRangeEnd:"2099-01-01",mapPolygon:null,chartPolygon:null,chartPoint:null,drawState:{active:!1,points:[],previewPoint:null},pointSelectActive:!1,chatInput:"",chatMessages:[],chatIsLoading:!1,compareMode:"Scenarios",availableModels:[],compareScenarioA:"SSP245",compareScenarioB:"SSP585",compareModelA:me[0],compareModelB:me[1]??me[0],compareDateStart:"1962-06-28",compareDateEnd:"2007-06-28",masks:[],ensembleScenarios:["SSP245","SSP370","SSP585"],ensembleModels:[...me],ensembleDropdown:{scenariosOpen:!1,modelsOpen:!1},ensembleStatistic:"mean",ensembleDate:"2000-01-01",ensembleVariable:Le[0],ensembleUnit:Pe(Le[0]).label,ensembleStatistics:null,ensembleStatisticRanges:new Map,isLoading:!1,loadingProgress:0,dataError:null,currentData:null,apiAvailable:null,dataMin:null,dataMax:null,dataMean:null,timeRange:null,metaData:void 0,compareInfoOpen:!1,maskVariableData:new Map,maskVariableRanges:new Map,chartRequestId:0};let Se=null,Kt=null,ee=null,Fn=null,wt=null,ft=null,St=null,Ze=null,Et=null,Un=0,Rt=null,Vn=0,$t=0,mt=null,kt=0,gt=null;const wo=500;function xh(e){return e.replace(/[A-Z]/g,t=>`-${t.toLowerCase()}`)}function g(e){return Object.entries(e).filter(([,t])=>t!=null).map(([t,a])=>{const r=t.startsWith("--")?t:xh(t),o=typeof a=="number"?`${a}px`:String(a);return`${r}:${o}`}).join(";")}function be(...e){return e.reduce((t,a)=>a?{...t,...a}:t,{})}function $e(e){return e.replace(/[&<>"']/g,t=>{switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return t}})}function yt(e){const t=new Date(e);return Number.isNaN(t.getTime())?e:t.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}function an(e,t){return t?.variable_metadata?.[e]?.name||t?.variable_metadata?.[e]?.description||e}function je(){return n.mode==="Ensemble"?{variable:n.ensembleVariable,unit:n.ensembleUnit}:{variable:n.variable,unit:n.selectedUnit}}function Nt(){return je()}function bn(e){const t=n.ensembleStatisticRanges.get(e);let a=null,r=null;if(t&&Number.isFinite(t.min)&&Number.isFinite(t.max)?(a=t.min,r=t.max):e===n.ensembleStatistic&&n.dataMin!==null&&n.dataMax!==null&&(a=n.dataMin,r=n.dataMax),a===null||r===null)return{min:null,max:null};const o=Da(a,r,n.ensembleVariable,n.ensembleUnit,{isDifference:e!=="mean"});return{min:o.min,max:o.max}}function wh(e){const t=an(e.variable,e.metaData),a=e.selectedUnit||e.metaData?.variable_metadata?.[e.variable]?.unit||"",r=a?`${a}`:"the dataset's native units";switch(e.compareMode){case"Dates":{const o=yt(e.compareDateStart),s=yt(e.compareDateEnd);return{title:"Comparing two dates",paragraphs:[`We are comparing ${t} on ${o} versus ${s} under the ${e.scenario} scenario using the ${e.model} model.`,`Values on the map represent ${s} minus ${o} in ${r}. A value of X means ${t} was X ${a||""} higher on ${s} than on ${o} (negative values mean it was lower).`]}}case"Models":{const o=yt(e.date);return{title:"Comparing two models",paragraphs:[`We are comparing ${t} between ${e.compareModelB} and ${e.compareModelA} on ${o} within the ${e.scenario} scenario.`,`Each value shows ${e.compareModelB} minus ${e.compareModelA} in ${r}. Positive numbers mean ${t} is higher in ${e.compareModelB}; negative means it is higher in ${e.compareModelA}.`]}}default:{const o=yt(e.date),s=e.compareScenarioA,i=e.compareScenarioB;return{title:"Comparing two scenarios",paragraphs:[`We are comparing ${t} for ${i} versus ${s} on ${o} using the ${e.model} model.`,`Values show ${i} minus ${s} in ${r}. A value of X means ${t} is X ${a||""} higher under ${i} than under ${s}; negative values mean it is lower.`]}}}}function Sh(e){if(e.mode!=="Compare"||e.canvasView!=="map")return"";const t=wh(e),a=t.paragraphs.map((c,d)=>{const f=d===t.paragraphs.length-1?"0":"0 0 12px 0",h=c.replace(/(\bX\b|ΔX)/g,'<span style="color: var(--accent-purple);">$1</span>');return`<p style="display:block; margin:${f}; line-height:1.6; white-space: normal; word-break: break-word;">${h}</p>`}).join(""),r=e.sidebarOpen?Ee+24:24,o=e.mode==="Compare"&&e.compareMode==="Dates"?120:88,s=be(M.infoModalOverlay,{left:"0",right:"0",width:"100%",justifyContent:"center",paddingLeft:0}),i=be(M.infoModal,{alignSelf:"center",marginLeft:"auto",marginRight:"auto"}),l=e.compareInfoOpen?`
      <div data-role="compare-info-overlay" class="compare-info-overlay" style="${g(s)}">
        <div style="${g(i)}" role="dialog" aria-modal="true" aria-label="${t.title}">
          <div style="${g(M.infoModalHeader)}">
            <div style="${g(M.infoModalTitle)}">${t.title}</div>
            <button type="button" data-action="close-compare-info" style="${g(M.infoModalClose)}" aria-label="Close info dialog">✕</button>
          </div>
          <div style="${g(M.infoModalBody)}">
            ${a}
          </div>
          <div style="${g(M.infoModalFooter)}">
            <button type="button" data-action="close-compare-info" style="${g(M.infoModalConfirm)}">Got it</button>
          </div>
        </div>
      </div>
    `:"";return`
      <div data-role="compare-info-trigger" style="${g(be(M.compareInfoWrap,{right:r,bottom:o}))}">
        <button type="button" data-action="open-compare-info" style="${g(M.compareInfoButton)}">
          What am I seeing?
        </button>
      </div>
      ${l}
    `}async function Mh(){try{const e=await th();n.apiAvailable=e}catch{n.apiAvailable=!1}}function $h(e){if(e.toLowerCase()==="historical")return"2000-01-01";const t=new Date,a=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0");return a<2015?"2015-01-01":a>2100?"2100-12-31":`${a}-${r}-${o}`}function Ne(e){return e.toLowerCase()==="historical"?{start:"1950-01-01",end:"2014-12-31"}:{start:"2015-01-01",end:"2099-12-31"}}function Ct(e,t){const a=Ne(t),r=new Date(e),o=new Date(a.start),s=new Date(a.end);return r<o?a.start:r>s?a.end:e}function So(e){let t=1/0,a=-1/0;for(let r=0;r<e.length;r++){const o=e[r];isFinite(o)&&(t=Math.min(t,o),a=Math.max(a,o))}if(!isFinite(t)||!isFinite(a))throw new Error("No valid numeric values returned from dataset.");return{min:t,max:a}}function zt(e){return e===null||!Number.isFinite(e)?"":e.toFixed(2)}function Qn(e,t){let a=null,r=null;if(e===n.variable)a=n.dataMin,r=n.dataMax;else{const s=n.maskVariableRanges.get(e);s&&(a=s.min,r=s.max)}if(a===null||r===null)return null;const o=Da(a,r,e,t);return{min:o.min,max:o.max}}function Zn(e,t){let a=0,r=0;for(let o=0;o<e.length;o++){const s=e[o];if(!isFinite(s))continue;const i=t==="hurs"?Math.min(s,100):s;a+=i,r+=1}if(!r)throw new Error("No valid numeric values returned from dataset.");return a/r}function Ci(e,t){let a=!1;for(let r=0,o=t.length-1;r<t.length;o=r++){const s=t[r].lon,i=t[r].lat,l=t[o].lon,c=t[o].lat;i>e.lat!=c>e.lat&&e.lon<(l-s)*(e.lat-i)/(c-i+Number.EPSILON)+s&&(a=!a)}return a}function Jn(e,t,a,r){const[o,s]=a,i=360/s,l=150/o;let c=0,d=0;for(let u=0;u<o;u++){const f=90-u*l-l/2;for(let h=0;h<s;h++){const p=h*i+i/2,x=p>180?p-360:p,T=(o-1-u)*s+h,k=e[T];if(!isFinite(k))continue;const w=t==="hurs"?Math.min(k,100):k;Ci({lat:f,lon:x},r)&&(c+=w,d+=1)}}if(!d)throw new Error("The selected region does not contain valid data points.");return c/d}function kh(e,t,a=.75){const r=e.lat-t.lat,o=e.lon-t.lon;return Math.hypot(r,o)<=a}function xn(e,t,a,r){const[o,s]=a,l=((r.lon+360)%360+360)%360/360*s-.5,c=(90-r.lat)/150*o-.5,d=(k,w,v)=>Math.min(v,Math.max(w,k)),u=d(Math.round(l),0,s-1),f=d(Math.round(c),0,o-1),h=(k,w)=>(o-1-w)*s+k,p=(k,w)=>{const v=(k%s+s)%s,L=d(w,0,o-1),R=h(v,L),$=e[R];return Number.isFinite($)?$:null};let x=p(u,f);if(x===null){let w=null;for(let v=1;v<=3&&w===null;v++)for(let L=-v;L<=v;L++){for(let R=-v;R<=v;R++){if(Math.abs(R)!==v&&Math.abs(L)!==v)continue;const $=p(u+R,f+L);if($!==null){w=$;break}}if(w!==null)break}x=w}if(x===null)throw new Error("No valid data at the selected point.");const T=t==="hurs"?Math.min(x,100):x;if(!Number.isFinite(T))throw new Error(`Invalid value at point: ${T}`);return T}function xt(){return{active:!1,points:[],previewPoint:null}}function Pi(e){Kt||(Kt=t=>{t.key==="Enter"&&n.drawState.active&&(t.preventDefault(),e())},window.addEventListener("keydown",Kt))}function La(){Kt&&(window.removeEventListener("keydown",Kt),Kt=null)}function pa(e){const t=n.drawState.active||n.pointSelectActive,a=n.mode==="Ensemble"?n.ensembleVariable:n.variable,r=n.mode==="Ensemble"?n.ensembleUnit:n.selectedUnit,o=n.metaData?.variable_metadata[a]?.unit||"";lh(e,n.currentData,o,a,r,{drawMode:t,onDrawClick:n.pointSelectActive?zh:qh,onDrawMove:n.drawState.active?Oh:void 0,onMapClick:Fh,onTransform:()=>{Ea(),Mo(),ma()}}),Mo(),ma()}function Ea(){if(!ee)return;const e=ee.querySelector("#draw-overlay-canvas"),t=Se||ee.querySelector("#map-canvas");if(!e||!t)return;const a=t.getBoundingClientRect(),r=window.devicePixelRatio||1;e.width=a.width*r,e.height=a.height*r,e.style.width=`${a.width}px`,e.style.height=`${a.height}px`;const o=e.getContext("2d");if(!o)return;o.save(),o.scale(r,r),o.clearRect(0,0,a.width,a.height);let s=[];if(n.drawState.active){const l=[...n.drawState.points];s=n.drawState.previewPoint?[...l,n.drawState.previewPoint]:l}else if(n.mapPolygon&&n.mapPolygon.length>=3)s=n.mapPolygon;else{o.restore();return}const i=[];if(s.forEach(l=>{const c=Kn(t,l.lon,l.lat);c&&i.push(c)}),!i.length){o.restore();return}o.lineWidth=2,o.strokeStyle="#34d399",o.fillStyle="rgba(52,211,153,0.18)",o.beginPath(),o.moveTo(i[0].x,i[0].y);for(let l=1;l<i.length;l++)o.lineTo(i[l].x,i[l].y);i.length>2&&(o.closePath(),o.fill()),o.stroke(),n.drawState.active&&i.forEach(({x:l,y:c},d)=>{o.beginPath(),o.fillStyle=d===0?"#10b981":"#34d399",o.arc(l,c,4,0,Math.PI*2),o.fill(),o.strokeStyle="#0f172a",o.lineWidth=1,o.stroke()}),o.restore()}function Dh(){return n.drawState.active||n.mapPolygon!==null&&n.mapPolygon.length>=3?`
      <canvas
        id="draw-overlay-canvas"
        style="${g(M.drawOverlayCanvas)}"
      ></canvas>
    `:""}function Mo(){if(!ee)return;const e=ee.querySelector("#point-overlay-marker"),t=Se||ee.querySelector("#map-canvas");!e||!t||!n.pointSelectActive||(e.style.left="0px",e.style.top="0px",e.style.right="0px",e.style.bottom="0px",e.style.width="100%",e.style.height="100%")}function ma(){if(!ee)return;const e=ee.querySelector("#map-location-marker"),t=ee.querySelector("#map-info-panel"),a=Se||ee.querySelector("#map-canvas");if(!a)return;const r=n.mapPolygon!==null&&n.mapPolygon.length>=3;if(e)if(!n.mapMarker)e.style.opacity="0",e.style.transform="translate(-9999px, -9999px)",e.title="Selected location";else{const o=Kn(a,n.mapMarker.lon,n.mapMarker.lat);e.title=n.mapMarker.name?n.mapMarker.name:`Pixel ${n.mapMarker.pixel.x}, ${n.mapMarker.pixel.y}`,o?(e.style.opacity="1",e.style.transform=`translate(${o.x}px, ${o.y}px) translate(-50%, -100%)`):(e.style.opacity="0",e.style.transform="translate(-9999px, -9999px)")}if(t&&n.mapInfoOpen){const o=a.getBoundingClientRect(),s=t.offsetWidth||360,i=t.offsetHeight||240,l=12;let c,d;if(n.mapMarker){const h=Kn(a,n.mapMarker.lon,n.mapMarker.lat);if(!h){t.style.opacity="0",t.style.transform="translate(-9999px, -9999px)",t.style.pointerEvents="none",t.style.visibility="hidden";return}c=h.x-s-24,c<l&&(c=h.x+24),d=h.y-i/2}else if(r&&n.mapPolygon){let h=n.mapPolygon[0];for(const x of n.mapPolygon)x.lon<h.lon&&(h=x);const p=Kn(a,h.lon,h.lat);p?(c=p.x-s-24,c<l&&(c=p.x+24),d=p.y-i/2):(c=o.width-s-l-24,d=o.height/2-i/2)}else{t.style.opacity="0",t.style.transform="translate(-9999px, -9999px)",t.style.pointerEvents="none",t.style.visibility="hidden";return}c=Math.max(l,Math.min(c,o.width-s-l)),d=Math.max(l,Math.min(d,o.height-i-l));const u=t.style.left,f=t.style.top;(!u||u==="0px"||!f||f==="0px")&&(t.style.left=`${c}px`,t.style.top=`${d}px`),t.style.opacity="1",t.style.transform="translate(0, 0)",t.style.pointerEvents="none",t.style.visibility="visible"}else t&&!n.mapInfoOpen&&(t.style.opacity="0",t.style.transform="translate(-9999px, -9999px)",t.style.pointerEvents="none",t.style.visibility="hidden")}function _i(){if(!ee)return;const e=ee.querySelector('[data-role="map-location-search"]');if(!e)return;const t=n.sidebarOpen?-Ee/2:0;e.style.transform=`translateX(calc(-50% + ${t}px))`}function Th(){return n.pointSelectActive?`
      <div style="${g(M.drawOverlay)}"></div>
      <div
        id="point-overlay-marker"
        style="${g({position:"absolute",inset:0,pointerEvents:"none",zIndex:9})}"
      ></div>
      <div style="${g(M.drawPrompt)}">
        <div>Click a point to sample</div>
        <div style="${g(M.drawPromptSub)}">
          The chart will load data for this single location
        </div>
      </div>
    `:""}function Lh(){const e=n.mapMarker,t=e?.name?$e(e.name):e?`Pixel ${e.pixel.x}, ${e.pixel.y}`:"Selected location";return`
      <div
        id="map-location-marker"
        style="${g(M.mapMarker)}"
        aria-hidden="true"
        title="${t}"
      >
        <svg
          viewBox="0 0 28 36"
          width="28"
          height="36"
          aria-hidden="true"
          focusable="false"
        >
          <defs>
            <linearGradient id="map-marker-gradient" x1="0" x2="1">
              <stop offset="0%" stop-color="var(--accent-blue)" />
              <stop offset="100%" stop-color="var(--accent-purple)" />
            </linearGradient>
          </defs>
          <path
            d="M14 2C8.48 2 4 6.48 4 12c0 7.72 8.4 19.3 9.1 20.25.5.68 1.3.68 1.8 0C15.6 31.3 24 19.72 24 12 24 6.48 19.52 2 14 2Z"
            fill="url(#map-marker-gradient)"
          />
          <circle cx="14" cy="12" r="4.5" fill="rgba(9, 14, 28, 0.9)" />
          <circle cx="14" cy="12" r="3" fill="white" opacity="0.9" />
        </svg>
      </div>
    `}function Ii(){const e=n.mapMarker!==null,t=n.mapPolygon!==null&&n.mapPolygon.length>=3;if(!e&&!t)return`<div style="${g(M.chartEmpty)}">Click a location or draw a region to load boxplots.</div>`;if(n.mapInfoLoading){const{unit:a}=je(),r=n.mapInfoLoadingProgress.total>0?`${n.mapInfoLoadingProgress.done}/${n.mapInfoLoadingProgress.total} datasets loaded`:"Preparing datasets",o=n.mapInfoBoxes&&n.mapInfoBoxes.length?Lo(n.mapInfoBoxes,a):`<div style="${g(M.chartEmpty)}">Loading boxplots...</div>`;return`
          <div style="${g(M.mapInfoLoadingRow)}">
            <div style="${g(M.mapInfoLoadingSpinner)}"></div>
            <div>${r}</div>
          </div>
          ${o}
        `}return n.mapInfoError?`<div style="${g(M.chartError)}">${$e(n.mapInfoError)}</div>`:!n.mapInfoBoxes||!n.mapInfoBoxes.length?`<div style="${g(M.chartEmpty)}">Click a location to load boxplots.</div>`:Lo(n.mapInfoBoxes,je().unit)}function Eh(){if(!n.mapInfoOpen)return"";const e=n.mapMarker,a=n.mapPolygon!==null&&n.mapPolygon.length>=3?"Drawn Region":e?.name?e.name:e?`Pixel ${e.pixel.x}, ${e.pixel.y}`:"Selected location",{variable:r,unit:o}=je(),s=an(r,n.metaData),i=`${a} · ${s}`,l=`${yt(n.date)} · ${o}`;return`
      <div id="map-info-panel" class="custom-select-info-panel map-info-panel" style="${g(M.mapInfoPanel)}">
        <div style="${g(M.mapInfoHeader)}">
          <div style="${g(M.mapInfoTitleGroup)}">
            <div class="custom-select-info-panel-title">${$e(i)}</div>
            <div style="${g(M.mapInfoSubtitle)}">${$e(l)}</div>
          </div>
          <div style="${g(M.mapInfoActions)}">
            <button
              type="button"
              data-action="close-map-info"
              aria-label="Close info"
              style="${g(M.mapInfoActionBtn)}"
              onmouseover="this.style.color='var(--text-primary)';this.style.background='rgba(15, 23, 42, 0.85)';"
              onmouseout="this.style.color='var(--text-secondary)';this.style.background='transparent';"
            >
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M6 6l12 12M18 6l-12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </button>
          </div>
        </div>
        <div class="map-info-body" style="${g(M.mapInfoBody)}">
          ${Ii()}
        </div>
        <button
          type="button"
          data-action="open-map-info-chart"
          aria-label="Open chart view"
          style="${g({...M.mapInfoActionBtn,...M.mapInfoExpandBtn})}"
          onmouseover="this.style.color='var(--text-primary)';this.style.background='rgba(15, 23, 42, 0.85)';"
          onmouseout="this.style.color='var(--text-secondary)';this.style.background='transparent';"
        >
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M9 5H5v4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M15 5h4v4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M9 19H5v-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M15 19h4v-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    `}function Ai(){const{unit:e}=Nt();if(n.mapRangeLoading){const t=n.mapRangeLoadingProgress.total>0?`${n.mapRangeLoadingProgress.done}/${n.mapRangeLoadingProgress.total} datasets loaded`:"Preparing datasets",a=n.mapRangeSeries&&n.mapRangeSeries.length?`<div style="${g(M.mapRangeChartWrap)}">${ba(n.mapRangeSeries,{compact:!0,unitLabel:e})}</div>`:`<div style="${g(M.chartEmpty)}">Loading range view...</div>`;return`
          <div style="${g(M.mapRangeLoadingRow)}">
            <div style="${g(M.mapRangeLoadingSpinner)}"></div>
            <div>${t}</div>
          </div>
          ${a}
        `}return n.mapRangeError?`<div style="${g(M.chartError)}">${$e(n.mapRangeError)}</div>`:!n.mapRangeSeries||!n.mapRangeSeries.length?`<div style="${g(M.chartEmpty)}">Click a location to load the range view.</div>`:`<div style="${g(M.mapRangeChartWrap)}">${ba(n.mapRangeSeries,{compact:!0,unitLabel:e})}</div>`}function Rh(){if(n.canvasView!=="map"||!n.mapRangeOpen||!n.mapMarker||n.mapPolygon!==null&&n.mapPolygon.length>=3)return"";const{variable:e}=Nt(),a=`${an(e,n.metaData)}`,r=n.sidebarOpen?Ee:0;return`
      <div id="map-range-overlay" style="${g({...M.mapRangeOverlay,right:r})}">
        <div style="${g(M.mapRangePanel)}">
          <div style="${g(M.mapRangeHeader)}">
            <div style="${g(M.mapRangeTitleGroup)}">
              <div class="map-range-title" style="${g(M.mapRangeTitle)}">${$e(a)}</div>
            </div>
            <button
              type="button"
              data-action="close-map-range"
              aria-label="Close range view"
              style="${g(M.mapInfoActionBtn)}"
              onmouseover="this.style.color='var(--text-primary)';this.style.background='rgba(15, 23, 42, 0.85)';"
              onmouseout="this.style.color='var(--text-secondary)';this.style.background='transparent';"
            >
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M6 6l12 12M18 6l-12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </button>
          </div>
          <div class="map-range-body" style="${g(M.mapRangeBody)}">
            ${Ai()}
          </div>
        </div>
      </div>
    `}function $o(){n.chartLocation="Draw",n.chartPolygon=null,n.chartLocationName=null,n.chartLocationSearchResults=[],n.chartLocationSearchQuery="",n.chartLocationSearchError=null,n.chartLocationSearchLoading=!1,n.chartError=null,n.pointSelectActive=!1,n.drawState={active:!0,points:[],previewPoint:null},n.canvasView="map",Pi(Oi),q(),Ce()}function ga(){n.drawState=xt(),La()}function Ch(){n.canvasView==="map"&&(n.mapPolygon=null,n.mapMarker=null,n.mapInfoOpen=!1,Ir(),n.drawState={active:!0,points:[],previewPoint:null},n.pointSelectActive=!1,Pi(Ni),q())}function Ph(){n.drawState=xt(),La()}function Ni(){if(n.drawState.active){if(n.drawState.points.length<3){n.mapInfoError="Draw at least three points to define a region.",n.mapInfoOpen=!0,q();return}n.mapPolygon=n.drawState.points,n.mapMarker=null,Ir(),n.drawState=xt(),La(),n.mapInfoError=null,n.mapInfoOpen=!0,q(),Tt()}}function ko(){n.chartLocation="Point",n.chartPolygon=null,n.chartPoint=null,n.chartLocationName=null,n.chartLocationSearchResults=[],n.chartLocationSearchQuery="",n.chartLocationSearchError=null,n.chartLocationSearchLoading=!1,n.chartError=null,n.drawState=xt(),n.chartUnit=Pe(n.chartVariable).label,n.pointSelectActive=!0,n.canvasView="map",q(),Ce()}function ya(){n.pointSelectActive=!1}async function Bi(e){const t=e.trim();if(!t)return[];const a=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(t)}&limit=5&addressdetails=1`,r=await fetch(a,{headers:{Accept:"application/json","User-Agent":"climate-visualization-app/1.0"}});if(!r.ok)throw new Error("Location search failed. Please try again.");return(await r.json()).map(s=>({displayName:s.display_name,lat:Number(s.lat),lon:Number(s.lon)})).filter(s=>Number.isFinite(s.lat)&&Number.isFinite(s.lon))}async function _h(e,t){const a=`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${t}&addressdetails=1`,r=await fetch(a,{headers:{Accept:"application/json","User-Agent":"climate-visualization-app/1.0"}});return r.ok&&(await r.json()).display_name||null}function Do(e){Et!==null&&(window.clearTimeout(Et),Et=null),n.chartLocation="Search",n.chartPoint={lat:e.lat,lon:e.lon},n.chartLocationName=e.displayName,n.chartLocationSearchError=null,n.chartLocationSearchResults=[],n.chartLocationSearchLoading=!1,n.chartLocationSearchQuery="",n.chartError=null,n.chartPolygon=null,n.pointSelectActive=!1,n.drawState=xt(),n.canvasView="chart",ga(),ya(),q(),Ye()}async function Ih(e){const t=e.trim(),a=++Un;if(n.chartLocation="Search",n.chartLocationSearchQuery=e,n.chartLocationSearchError=null,n.chartLocationSearchResults=[],n.chartLocationName=null,n.chartPoint=null,n.chartError=null,n.chartPolygon=null,n.pointSelectActive=!1,n.drawState=xt(),n.canvasView="chart",ga(),ya(),!t){n.chartLocationSearchLoading=!1,n.chartLocationSearchResults=[],n.chartLocationSearchError=null,q();return}n.chartLocationSearchLoading=!0,q();try{const r=await Bi(t);if(a!==Un)return;n.chartLocationSearchResults=r,r.length||(n.chartLocationSearchError="No places found for that query.")}catch(r){if(a!==Un)return;n.chartLocationSearchError=r instanceof Error?r.message:"Search failed."}finally{if(a!==Un)return;n.chartLocationSearchLoading=!1,q()}}function Fi(e,t,a){const[r,o]=Pn(e,t);n.mapMarker={lat:e,lon:t,name:a,pixel:{x:r,y:o}}}function Ah(e){if(Rt!==null&&(window.clearTimeout(Rt),Rt=null),n.mapLocationSearchError=null,n.mapLocationSearchResults=[],n.mapLocationSearchLoading=!1,n.mapLocationSearchQuery=e.displayName,n.mapLocationSearchSelection=e.displayName,n.mapLocationSearchFocused=!0,Fi(e.lat,e.lon,e.displayName),q(),Se){const t=Math.max(Ti(),3.2);Li(Se,e.lon,e.lat,t),ma()}Ui(),Vi()}async function Nh(e){const t=e.trim(),a=++Vn;if(n.mapLocationSearchQuery=e,n.mapLocationSearchError=null,n.mapLocationSearchResults=[],n.mapLocationSearchSelection=null,!t){n.mapLocationSearchLoading=!1,n.mapLocationSearchResults=[],n.mapLocationSearchError=null,q();return}n.mapLocationSearchLoading=!0,q();try{const r=await Bi(t);if(a!==Vn)return;n.mapLocationSearchResults=r,r.length||(n.mapLocationSearchError="No places found for that query.")}catch(r){if(a!==Vn)return;n.mapLocationSearchError=r instanceof Error?r.message:"Search failed."}finally{if(a!==Vn)return;n.mapLocationSearchLoading=!1,q()}}function Bh(e){if(n.mapMarker&&(n.mapMarker.name=e),!ee)return;const t=ee.querySelector("#map-location-marker");if(t&&n.mapMarker&&(t.title=e),n.mapInfoOpen&&n.mapMarker){const a=ee.querySelector(".custom-select-info-panel-title");if(a){const{variable:r}=je(),o=an(r,n.metaData),i=`${e} · ${o}`;a.textContent=i}}if(n.mapRangeOpen&&n.mapMarker){const a=ee.querySelector(".map-range-title");if(a){const{variable:r}=Nt(),o=an(r,n.metaData),s=`${e} · ${o}`;a.textContent=s}}}async function Fh(e){if(n.canvasView==="map"&&!(n.drawState.active||n.pointSelectActive)){if(n.mapPolygon=null,Fi(e.lat,e.lon,null),Se){const t=Math.max(Ti(),3.2);Li(Se,e.lon,e.lat,t),ma()}Ui(),Vi();try{const t=await _h(e.lat,e.lon);t&&Bh(t)}catch(t){console.error("Failed to fetch reverse geocode:",t)}}}function Ui(e=700){mt!==null&&(window.clearTimeout(mt),mt=null);const t=n.mapInfoOpen;if(n.mapInfoOpen=!1,t&&ee){const a=ee.querySelector("#map-info-panel");a&&(a.style.opacity="0",a.style.transform="translate(-9999px, -9999px)",a.style.pointerEvents="none",a.style.visibility="hidden")}mt=window.setTimeout(()=>{mt=null;const a=n.mapMarker!==null,r=n.mapPolygon!==null&&n.mapPolygon.length>=3;!a&&!r||(n.mapInfoOpen=!0,q(),Tt())},e)}function Uh(){mt!==null&&(window.clearTimeout(mt),mt=null),$t+=1,n.mapInfoOpen=!1,n.mapInfoLoading=!1,q()}function Wa(e){n.mapInfoSamples=e;try{const{variable:a,unit:r}=je();n.mapInfoBoxes=Gt(e,a,r)}catch{return}if(!ee){q();return}const t=ee.querySelector("#map-info-panel");if(t){const a=t.querySelector(".map-info-body");if(a){a.innerHTML=Ii();return}}q()}function Vi(e=560){!n.mapMarker||n.mapPolygon||(gt!==null&&(window.clearTimeout(gt),gt=null),gt=window.setTimeout(()=>{if(gt=null,!n.mapMarker||n.mapPolygon)return;const t=Ri(n.date);n.mapRangeStart=t.start,n.mapRangeEnd=t.end,n.mapRangeOpen=!0,q(),mn()},e))}function Ir(){gt!==null&&(window.clearTimeout(gt),gt=null),kt+=1,n.mapRangeOpen=!1,n.mapRangeLoading=!1,n.mapRangeError=null,n.mapRangeSamples=[],n.mapRangeSeries=null,n.mapRangeLoadingProgress={total:0,done:0},q()}function Vh(e){const{variable:t,unit:a}=Nt();n.mapRangeSamples=e;try{n.mapRangeSeries=vt(e,t,a)}catch{return}if(!ee){q();return}const r=ee.querySelector("#map-range-overlay");if(r){const o=r.querySelector(".map-range-body");if(o){o.innerHTML=Ai();return}}q()}async function mn(){if(n.canvasView!=="map")return;const e=n.mapMarker!==null,t=n.mapPolygon!==null&&n.mapPolygon.length>=3;if(!e||t||!n.mapMarker){n.mapRangeLoading=!1,n.mapRangeError=null,n.mapRangeSamples=[],n.mapRangeSeries=null,n.mapRangeLoadingProgress={total:0,done:0},n.mapRangeOpen=!1,q();return}const a=++kt,r=Ri(n.date),{variable:o,unit:s}=Nt();n.mapRangeStart=r.start,n.mapRangeEnd=r.end,n.mapRangeLoading=!0,n.mapRangeError=null,n.mapRangeSamples=[],n.mapRangeSeries=null,n.mapRangeLoadingProgress={total:0,done:0},n.mapRangeOpen=!0,q();try{const i=n.metaData??await Ta();n.metaData||(n.metaData=i);const l=i?.scenarios?.length?Array.from(new Set(i.scenarios.map(ut))):Me,c=i?.models?.length?i.models:me,d=(n.chartScenarios.length?n.chartScenarios:l).filter(T=>l.includes(T)),u=(n.chartModels.length?n.chartModels:c).filter(T=>c.includes(T));if(!d.length||!u.length){n.mapRangeError="Select at least one scenario and one model.",n.mapRangeLoading=!1,n.mapRangeLoadingProgress={total:0,done:0},q();return}const f=d.length*u.length;n.mapRangeLoadingProgress={total:f,done:0},q();const h=[],p=zi(r.start,r.end),x=r.start;for(const T of u)for(const k of d){if(a!==kt)return;const w=await Wi({variable:o,model:T,scenario:k,point:n.mapMarker,rangeStart:r.start,rangeEnd:r.end,useFixedAnnualSamples:p,fixedReferenceDate:x});if(a!==kt)return;h.push(...w),n.mapRangeLoadingProgress={total:f,done:n.mapRangeLoadingProgress.done+1},Vh(h)}if(a!==kt)return;n.mapRangeSamples=h,n.mapRangeSeries=vt(h,o,s),n.mapRangeLoadingProgress={total:f,done:f}}catch(i){if(a!==kt)return;n.mapRangeError=i instanceof Error?i.message:"Failed to load range data.",n.mapRangeSamples=[],n.mapRangeSeries=null,n.mapRangeLoadingProgress={total:0,done:0}}finally{if(a!==kt)return;n.mapRangeLoading=!1,q()}}async function Tt(){if(n.canvasView!=="map")return;const{variable:e}=je(),t=n.mapMarker!==null,a=n.mapPolygon!==null&&n.mapPolygon.length>=3;if(!t&&!a){n.mapInfoLoading=!1,n.mapInfoError=null,n.mapInfoSamples=[],n.mapInfoBoxes=null,n.mapInfoLoadingProgress={total:0,done:0},n.mapInfoOpen=!1,q();return}const r=++$t;n.mapInfoLoading=!0,n.mapInfoError=null,n.mapInfoSamples=[],n.mapInfoBoxes=null,n.mapInfoLoadingProgress={total:0,done:0},q();try{const o=n.metaData??await Ta();n.metaData||(n.metaData=o);const s=o?.scenarios?.length?Array.from(new Set(o.scenarios.map(ut))):Me,i=s.filter(f=>va(n.date,Ne(f))),l=i.length?i.includes("Historical")?["Historical"]:i:s,c=o?.models?.length?o.models:me;if(!s.length||!c.length){n.mapInfoError="Select at least one scenario and one model.",n.mapInfoLoading=!1,n.mapInfoLoadingProgress={total:0,done:0},q();return}const d=l.length*c.length;n.mapInfoLoadingProgress={total:d,done:0},q();const u=[];for(const f of l){if(r!==$t)return;const h=ve(n.date,Ne(f));if(t&&n.mapMarker){const[p,x]=Pn(n.mapMarker.lat,n.mapMarker.lon),T=c.map(w=>_r({variable:e,model:w,x0:p,x1:p,y0:x,y1:x,start_date:h,end_date:h,scenario:st(f),resolution:"low",step_days:1}).catch(v=>{console.warn(`Pixel API failed for model ${w}, falling back:`,v);const L=pe({variable:e,date:h,model:w,scenario:f,resolution:1});return _e(L).then(R=>{const $=Re(R);if(!$)throw new Error("No data returned for map info request.");const D=xn($,e,R.shape,{lat:n.mapMarker.lat,lon:n.mapMarker.lon});return{model:w,value:D,fallback:!0}})})),k=await Promise.allSettled(T);if(r!==$t)return;for(const w of k)if(w.status==="fulfilled"){const v=w.value;if(typeof v=="object"&&"fallback"in v&&v.fallback)u.push({scenario:f,model:v.model,rawValue:v.value,dateUsed:h});else{const L=v,R=L.values[0];if(R!==null&&isFinite(R)){const $=e==="hurs"?Math.min(R,100):R;u.push({scenario:f,model:L.model,rawValue:$,dateUsed:h})}}}else console.warn("Failed to fetch pixel data for map info:",w.reason);n.mapInfoLoadingProgress={total:d,done:n.mapInfoLoadingProgress.done+c.length},Wa(u)}else if(a&&n.mapPolygon){const[p,x,T,k]=fr(n.mapPolygon),w=hr(n.mapPolygon,p,x,T,k);try{const v=await ir({variable:e,models:c,x0:p,x1:x,y0:T,y1:k,start_date:h,end_date:h,scenario:st(f),resolution:"low",step_days:1,mask:w});for(const L of c){const R=v.models[L];if(R){const $=R.values[0];if($!==null&&isFinite($)){const D=e==="hurs"?Math.min($,100):$;u.push({scenario:f,model:L,rawValue:D,dateUsed:h})}}}n.mapInfoLoadingProgress={total:d,done:n.mapInfoLoadingProgress.done+c.length},Wa(u)}catch(v){console.warn(`Aggregate API failed for scenario ${f}, falling back to full map load:`,v);for(const L of c){if(r!==$t)return;const R=pe({variable:e,date:h,model:L,scenario:f,resolution:1});try{const $=await _e(R),D=Re($);if(D){const F=Jn(D,e,$.shape,n.mapPolygon);u.push({scenario:f,model:L,rawValue:F,dateUsed:h})}}catch($){console.warn(`Failed to load data for model ${L}:`,$)}n.mapInfoLoadingProgress={total:d,done:n.mapInfoLoadingProgress.done+1},Wa(u)}}}}if(r!==$t)return;n.mapInfoLoading=!1,q()}catch(o){if(r!==$t)return;n.mapInfoError=o instanceof Error?o.message:"Failed to load map chart data.",n.mapInfoLoading=!1,n.mapInfoLoadingProgress={total:0,done:0},q()}}function Oh(e){n.drawState.active&&(n.drawState={...n.drawState,previewPoint:e},Ea())}function qh(e){if(!n.drawState.active)return;const t=n.drawState.points;if(t.length>=3&&kh(e,t[0])){n.canvasView==="chart"||n.chartLocation==="Draw"?Oi():n.canvasView==="map"&&Ni();return}n.drawState={...n.drawState,points:[...t,e],previewPoint:e},Ea()}function zh(e){n.pointSelectActive&&(n.chartPoint=e,n.pointSelectActive=!1,n.chartError=null,n.canvasView="chart",q(),Ye())}function Oi(){if(n.drawState.active){if(n.drawState.points.length<3){n.chartError="Draw at least three points to define a region.",q();return}n.chartPolygon=n.drawState.points,n.drawState=xt(),La(),n.chartError=null,n.canvasView="chart",q(),Ye()}}function qi(e){const t=e.filter(i=>Number.isFinite(i)).sort((i,l)=>i-l);if(!t.length)throw new Error("No valid values available to build chart statistics.");const a=_a(t,.25)??t[0],r=_a(t,.5)??t[Math.floor(t.length/2)],o=_a(t,.75)??t[t.length-1],s=is(t)??t[0];return{min:t[0],q1:a,median:r,q3:o,max:t[t.length-1],mean:s,count:t.length}}function Gt(e,t,a){const r=new Map;return e.forEach(o=>{const s=r.get(o.scenario)??[];s.push(o),r.set(o.scenario,s)}),Array.from(r.entries()).map(([o,s])=>{const i=s.map(c=>{const d=jt(c.rawValue,t,a);return{...c,value:d}}),l=qi(i.map(c=>c.value));return{scenario:o,dateUsed:s[0]?.dateUsed??"",samples:i,stats:l}})}function Hh(e,t,a=50){const r=J(e),o=J(t);if(Number.isNaN(r.getTime())||Number.isNaN(o.getTime())||a<=0)return[];let s=r,i=o;s>i&&([s,i]=[i,s]);const l=1440*60*1e3,d=Math.floor((i.getTime()-s.getTime())/l)+1,u=[];if(d<=a){for(let p=0;p<d;p++){const x=new Date(s.getTime()+p*l);u.push(x.toISOString().slice(0,10))}return u}const f=(i.getTime()-s.getTime())/(a-1),h=new Set;for(let p=0;p<a;p++){const x=new Date(s.getTime()+f*p);h.add(x.toISOString().slice(0,10))}return h.add(i.toISOString().slice(0,10)),Array.from(h).sort((p,x)=>J(p).getTime()-J(x).getTime())}function dr(e,t,a=50){const r=J(e),o=J(t);if(Number.isNaN(r.getTime())||Number.isNaN(o.getTime())||a<=0)return[];let s=r,i=o;s>i&&([s,i]=[i,s]);const l=1440*60*1e3,c=Math.floor((i.getTime()-s.getTime())/l),d=i.getFullYear()-s.getFullYear();if(c<=120)return Hh(s.toISOString().slice(0,10),i.toISOString().slice(0,10),a);const u=s.getDate(),f=s.getMonth(),h=s.getFullYear(),p=i.getFullYear(),x=p-h+1,T=Math.min(a,x),k=new Set;if(T===1)k.add(h);else{const L=(x-1)/(T-1);for(let R=0;R<T;R++){const $=Math.round(h+L*R);k.add(Math.min(p,Math.max(h,$)))}}const w=[];return Array.from(k).sort((L,R)=>L-R).forEach(L=>{const R=new Date(L,f+1,0).getDate(),$=Math.min(u,R),D=new Date(L,f,$);if(d>=20){if(D<s||D>i)return;w.push(D.toISOString().slice(0,10));return}let F=D;D<s&&(F=s),D>i&&(F=i),w.push(F.toISOString().slice(0,10))}),Array.from(new Set(w)).sort((L,R)=>J(L).getTime()-J(R).getTime())}function zi(e,t){const a=J(e),r=J(t);if(Number.isNaN(a.getTime())||Number.isNaN(r.getTime()))return!1;const o=1440*60*1e3;return Math.abs(r.getTime()-a.getTime())/o/365.25>=20}function Hi(e,t){const a=J(t),r=J(e);return Number.isNaN(a.getTime())||Number.isNaN(r.getTime())?!1:r.getMonth()===a.getMonth()&&r.getDate()===a.getDate()}function va(e,t){const a=J(e),r=J(t.start),o=J(t.end);return Number.isNaN(a.getTime())||Number.isNaN(r.getTime())||Number.isNaN(o.getTime())?!1:a>=r&&a<=o}function ur(e,t,a,r=50){const o=J(e),s=J(t),i=J(a);if(Number.isNaN(o.getTime())||Number.isNaN(s.getTime())||Number.isNaN(i.getTime())||r<=0)return[];const l=o.getMonth(),c=o.getDate(),d=s.getFullYear(),u=i.getFullYear(),f=u-d+1,h=Math.min(r,f),p=new Set;if(h===1)p.add(d);else{const k=(f-1)/(h-1);for(let w=0;w<h;w++){const v=Math.round(d+k*w);p.add(Math.min(u,Math.max(d,v)))}}const x=[];return Array.from(p).sort((k,w)=>k-w).forEach(k=>{const w=new Date(k,l+1,0).getDate(),v=Math.min(c,w),L=new Date(k,l,v);L<s||L>i||x.push(L.toISOString().slice(0,10))}),Array.from(new Set(x)).sort((k,w)=>J(k).getTime()-J(w).getTime())}async function Wi(e){const{variable:t,model:a,scenario:r,point:o,rangeStart:s,rangeEnd:i,useFixedAnnualSamples:l,fixedReferenceDate:c}=e,d=Ne(r),u=ve(s,d),f=ve(i,d);if(J(u)>J(f))return[];try{const[h,p]=Pn(o.lat,o.lon),x=await _r({variable:t,model:a,x0:h,x1:h,y0:p,y1:p,start_date:u,end_date:f,scenario:st(r),resolution:"low",step_days:1}),T=[];for(let k=0;k<x.timestamps.length;k++){const w=x.timestamps[k];if(l&&!Hi(w,c))continue;const v=x.values[k];if(v!==null&&isFinite(v)){const L=t==="hurs"?Math.min(v,100):v;T.push({scenario:r,model:a,rawValue:L,dateUsed:w})}}return T}catch(h){console.warn("Range point pixel API failed, falling back:",h);const p=l?ur(c,u,f,50):dr(u,f,50),x=[];for(const T of p){const k=l?T:ve(T,d);if(l&&!va(k,d))continue;const w=pe({variable:t,date:k,model:a,scenario:r,resolution:1});let v=null;try{v=await _e(w)}catch($){console.warn("Range point request failed, skipping date:",$);continue}const L=Re(v);if(!L)continue;const R=xn(L,t,v.shape,o);x.push({scenario:r,model:a,rawValue:R,dateUsed:k})}return x}}function vt(e,t,a){const r=new Map;return e.forEach(o=>{const s=r.get(o.scenario)??[];s.push(o),r.set(o.scenario,s)}),Array.from(r.entries()).map(([o,s])=>{const i=new Map;s.forEach(c=>{const d=jt(c.rawValue,t,a),u=i.get(c.dateUsed)??[];u.push({...c,value:d}),i.set(c.dateUsed,u)});const l=Array.from(i.entries()).map(([c,d])=>({date:c,samples:d,stats:qi(d.map(u=>u.value))})).sort((c,d)=>J(c.date).getTime()-J(d.date).getTime());return{scenario:o,points:l}})}function Wh(e,t,a,r){const o=Re(e),s=Re(t);if(!o||!s)throw new Error("Comparison data is missing numeric values.");if(o.length!==s.length||e.shape[0]!==t.shape[0]||e.shape[1]!==t.shape[1])throw new Error("Comparison datasets have mismatched shapes.");const i=new Float32Array(o.length);let l=1/0,c=-1/0,d=0,u=0;for(let p=0;p<o.length;p++){const x=o[p],T=s[p];if(!isFinite(x)||!isFinite(T)){i[p]=NaN;continue}const k=T-x;i[p]=k,isFinite(k)&&(l=Math.min(l,k),c=Math.max(c,k),d+=k,u+=1)}if(!isFinite(l)||!isFinite(c))throw new Error("Comparison produced no valid numeric values.");const f=u>0?d/u:NaN;return{data:{...e,data:i,data_encoding:"none",dtype:"float32",model:`${r} minus ${a}`,time:`${t.time} minus ${e.time}`,scenario:`${t.scenario} minus ${e.scenario}`,metadata:{...e.metadata,comparison:{labelA:a,labelB:r}}},min:l,max:c,mean:f}}function ce(e,t=!1){const a=Math.max(0,Math.min(100,Math.round(e)));a!==n.loadingProgress&&(n.loadingProgress=a,(n.isLoading||t)&&q())}async function Yh(e,t){let a=pe({variable:n.variable,date:n.date,model:n.model,scenario:n.scenario,resolution:n.resolution}),r=a,o="",s="";switch(n.compareMode){case"Scenarios":{const c=n.compareScenarioA,d=n.compareScenarioB,u=Ct(n.date,e);u!==n.date&&(n.date=u),a=pe({variable:n.variable,date:u,model:n.model,scenario:c,resolution:n.resolution}),r=pe({variable:n.variable,date:u,model:n.model,scenario:d,resolution:n.resolution}),o=c,s=d;break}case"Models":{const c=Ct(n.date,e);c!==n.date&&(n.date=c),a=pe({variable:n.variable,date:c,model:n.compareModelA,scenario:n.scenario,resolution:n.resolution}),r=pe({variable:n.variable,date:c,model:n.compareModelB,scenario:n.scenario,resolution:n.resolution}),o=n.compareModelA,s=n.compareModelB;break}case"Dates":{const c=Ct(n.compareDateStart,n.scenario),d=Ct(n.compareDateEnd,n.scenario);c!==n.compareDateStart&&(n.compareDateStart=c),d!==n.compareDateEnd&&(n.compareDateEnd=d),a=pe({variable:n.variable,date:c,model:n.model,scenario:n.scenario,resolution:n.resolution}),r=pe({variable:n.variable,date:d,model:n.model,scenario:n.scenario,resolution:n.resolution}),o=c,s=d;break}}const i=await _e(a);t?.(65);const l=await _e(r);return t?.(85),Wh(i,l,o,s)}function fn(e,t){if(e.length===0)return NaN;if(e.length===1)return e[0];const a=t/100*(e.length-1),r=Math.floor(a),o=Math.ceil(a),s=a-r;return r===o?e[r]:e[r]*(1-s)+e[o]*s}async function Xh(e){const t=n.ensembleScenarios.length>0?n.ensembleScenarios:Me.filter(N=>N!=="Historical"),a=n.ensembleModels.length>0?n.ensembleModels:me;if(t.length===0||a.length===0)throw new Error("Please select at least one scenario and one model.");const r=nn(t),o=ve(n.ensembleDate,r);o!==n.ensembleDate&&(n.ensembleDate=o);const s=t.length*a.length,i=[],l=[];e?.(10);for(let N=0;N<t.length;N++){const X=t[N];for(let j=0;j<a.length;j++){const O=a[j],Q=10+Math.round((N*a.length+j)/s*80);e?.(Q);const Y=pe({variable:n.ensembleVariable,date:o,model:O,scenario:X,resolution:n.resolution});try{const y=await _e(Y),B=Re(y);B&&(i.push(B),l.push(y.shape))}catch(y){console.warn(`Failed to fetch data for ${X}/${O}:`,y)}}}if(i.length===0)throw new Error("No valid data could be loaded for the selected scenarios and models.");e?.(90);const c=l[0];for(let N=1;N<l.length;N++)if(l[N][0]!==c[0]||l[N][1]!==c[1])throw new Error("Ensemble datasets have mismatched shapes. Cannot compute statistics.");const d=i[0].length,u=new Float32Array(d);let f=1/0,h=-1/0,p=0,x=0;const T=new Set([n.ensembleStatistic]);if(n.masks&&n.masks.length>0)for(const N of n.masks)N.statistic&&T.add(N.statistic);const k=new Map,w=new Map;for(const N of T)k.set(N,new Float32Array(d)),w.set(N,{min:1/0,max:-1/0});for(let N=0;N<d;N++){const X=[];for(const Y of i){const y=Y[N];if(isFinite(y)){const B=n.ensembleVariable==="hurs"?Math.min(y,100):y;X.push(B)}}if(X.length===0){u[N]=NaN;for(const Y of T)k.get(Y)[N]=NaN;continue}const j=T.has("median")||T.has("iqr")||T.has("percentile")?[...X].sort((Y,y)=>Y-y):null,O=T.has("mean")||T.has("std")?X.reduce((Y,y)=>Y+y,0)/X.length:0;for(const Y of T){let y;if(Y==="mean")y=O;else if(Y==="median")y=fn(j,50);else if(Y==="std"){const B=X.reduce((E,m)=>E+Math.pow(m-O,2),0)/X.length;y=Math.sqrt(B)}else if(Y==="iqr"){const B=fn(j,75),E=fn(j,25);y=B-E}else if(Y==="percentile"){const B=fn(j,90),E=fn(j,10);y=B-E}else Y==="extremes"?y=Math.max(...X)-Math.min(...X):y=O;if(k.get(Y)[N]=y,isFinite(y)){const B=w.get(Y);B.min=Math.min(B.min,y),B.max=Math.max(B.max,y)}}const Q=k.get(n.ensembleStatistic)[N];u[N]=Q,isFinite(Q)&&(f=Math.min(f,Q),h=Math.max(h,Q),p+=Q,x+=1)}if(n.ensembleStatistics=k,n.ensembleStatisticRanges=w,n.masks.length>0)for(const N of n.masks){if(!N.statistic)continue;const X=bn(N.statistic);N.lowerEdited||(N.lowerBound=X.min),N.upperEdited||(N.upperBound=X.max)}if(!isFinite(f)||!isFinite(h))throw new Error("Ensemble computation produced no valid numeric values.");const v=x>0?p/x:NaN,L=pe({variable:n.ensembleVariable,date:o,model:a[0],scenario:t[0],resolution:n.resolution}),R=await _e(L),D=n.ensembleStatistic!=="mean"?{...R.metadata||{},comparison:{labelA:"Ensemble",labelB:n.ensembleStatistic==="std"?"Std Dev":n.ensembleStatistic==="median"?"Median":n.ensembleStatistic==="iqr"?"IQR":n.ensembleStatistic==="percentile"?"Percentile Band":"Extremes"}}:R.metadata,F={...R,data:u,data_encoding:"none",metadata:D};return e?.(100),{data:F,min:f,max:h,mean:v}}const kn=600,Dn=1440;function Pn(e,t){const r=((t+360)%360+360)%360/360*Dn-.5,o=(90-e)/150*kn-.5,s=(c,d,u)=>Math.min(u,Math.max(d,c)),i=s(Math.round(r),0,Dn-1),l=s(Math.round(o),0,kn-1);return[i,l]}function fr(e){if(!e||e.length<3)throw new Error("Polygon must have at least 3 points");let t=1/0,a=-1/0,r=1/0,o=-1/0;for(const s of e){const[i,l]=Pn(s.lat,s.lon);t=Math.min(t,i),a=Math.max(a,i),r=Math.min(r,l),o=Math.max(o,l)}return t=Math.max(0,Math.min(t,Dn-1)),a=Math.max(0,Math.min(a,Dn-1)),r=Math.max(0,Math.min(r,kn-1)),o=Math.max(0,Math.min(o,kn-1)),[t,a,r,o]}function hr(e,t,a,r,o){const s=[],i=360/Dn,l=150/kn;for(let c=r;c<=o;c++){const d=[],u=90-(c+.5)*l;for(let f=t;f<=a;f++){const h=(f+.5)*i,p=h>180?h-360:h,x=Ci({lat:u,lon:p},e);d.push(x?1:0)}s.push(d)}return s}function Fe(){const e=document.querySelector("[data-role='chart-container']");if(!e)return;const t=n.chartMode==="range";let a="";if(n.chartLoading)a=`
          <div style="position:absolute; inset:0; pointer-events:none;">
            <div style="${g(be(M.loadingIndicator,{position:"absolute",left:18,bottom:-95,pointerEvents:"auto"}))}">
              <div style="${g(M.loadingSpinner)}"></div>
              <div style="${g(M.loadingTextGroup)}">
                <div style="${g(M.loadingText)}">Loading data</div>
                <div style="${g(M.loadingBar)}">
                  <div style="${g({...M.loadingBarFill,width:`${Math.max(0,Math.min(100,Math.round(n.loadingProgress||25)))}%`})}"></div>
                </div>
                <div style="${g(M.loadingSubtext)}">${n.chartLoadingProgress.total>0?`${n.chartLoadingProgress.done}/${n.chartLoadingProgress.total} datasets loaded`:"Preparing datasets"}</div>
              </div>
            </div>
            ${Qh()}
          </div>
          ${!t&&n.chartBoxes?To(n.chartBoxes):t&&n.chartRangeSeries?ba(n.chartRangeSeries):""}
        `;else if(n.chartError)a=`<div style="${g(M.chartError)}">${n.chartError}</div>`;else if(!t&&(!n.chartBoxes||!n.chartBoxes.length)||t&&(!n.chartRangeSeries||!n.chartRangeSeries.length)){const s=t?"Select scenarios, models, and a date range to see how the distribution evolves over time.":"Select scenarios and models to fetch the global box plot.";a=`<div style="${g(M.chartEmpty)}">${s}</div>`}else a=t?ba(n.chartRangeSeries??[]):To(n.chartBoxes??[]);const r=n.chartLocationName||(n.chartLocation==="Point"&&n.chartPoint?`Point (${n.chartPoint.lat.toFixed(2)}, ${n.chartPoint.lon.toFixed(2)})`:n.chartLocation==="Draw"?"Custom region":n.chartLocation==="World"?"Global":""),o=n.chartMode==="range"?`${yt(n.chartRangeStart)} – ${yt(n.chartRangeEnd)}`:yt(n.chartDate);e.innerHTML=`
        <div style="${g(M.chartPanel)}">
          <div style="${g(M.chartHeader)}">
            <div style="${g(M.chartTitle)}">${an(n.chartVariable,n.metaData)}</div>
            <div style="${g(M.mapSubtitle)}">${r?`${$e(r)} · ${o}`:o}</div>
          </div>
          <div style="${g(be(M.chartPlotWrapper,{display:"flex",alignItems:"center",justifyContent:"center"}))}">
            ${a}
          </div>
        </div>
      `,!t&&n.chartBoxes&&n.chartBoxes.length>0&&setTimeout(()=>{jh()},0)}function jh(){const e=document.querySelector("[data-role='chart-container'] svg");if(!e)return;const t=e.querySelector(".boxplot-hover-overlay");if(!t)return;const a=e.querySelectorAll(".boxplot-hover-area"),r=e.querySelectorAll(".model-indicator");a.length!==0&&(r.forEach(o=>{o.style.opacity="0"}),a.forEach(o=>{const s=o.closest(".boxplot-group");if(!s)return;const i=s.getAttribute("data-boxplot-idx");i!==null&&(o.addEventListener("mouseenter",()=>{t.style.opacity="1",t.style.pointerEvents="auto",r.forEach(l=>{const c=l;c.getAttribute("data-boxplot-idx")===i?c.style.opacity="1":c.style.opacity="0"})}),o.addEventListener("mouseleave",()=>{t.style.opacity="0",t.style.pointerEvents="none",r.forEach(l=>{l.style.opacity="0"})}))}))}async function Ye(){if(n.canvasView!=="chart")return;const e=t=>{if(n.chartSamples=t,n.chartMode==="single")try{n.chartBoxes=Gt(t,n.chartVariable,n.chartUnit),n.chartRangeSeries=null}catch{return}else try{n.chartRangeSeries=vt(t,n.chartVariable,n.chartUnit),n.chartBoxes=null}catch{return}Fe()};if(n.chartLocation==="Draw"&&(!n.chartPolygon||n.chartPolygon.length<3)){n.chartError="Draw a region on the map to load chart data.",n.chartBoxes=null,n.chartRangeSeries=null,n.chartSamples=[],n.chartLoading=!1,n.chartLoadingProgress={total:0,done:0},Fe();return}if(n.chartLocation==="Point"&&!n.chartPoint){n.chartError="Click a point on the map to load chart data.",n.chartBoxes=null,n.chartRangeSeries=null,n.chartSamples=[],n.chartLoading=!1,n.chartLoadingProgress={total:0,done:0},Fe();return}if(n.chartLocation==="Search"&&!n.chartPoint){n.chartError=n.chartLocationSearchLoading?"Searching for a place...":"Search for a place and pick a result.",n.chartBoxes=null,n.chartRangeSeries=null,n.chartSamples=[],n.chartLoading=!1,n.chartLoadingProgress={total:0,done:0},Fe();return}n.chartLoading=!0,n.chartError=null,ce(5,!0),n.chartLoadingProgress={total:0,done:0},n.chartSamples=[],n.chartBoxes=null,n.chartRangeSeries=null,Fe();try{const t=n.metaData??await Ta();n.metaData||(n.metaData=t);const a=t?.scenarios?.length?Array.from(new Set(t.scenarios.map(ut))):Me,r=t?.models?.length?t.models:me,o=(n.chartScenarios.length?n.chartScenarios:a).filter(l=>a.includes(l)),s=(n.chartModels.length?n.chartModels:r).filter(l=>r.includes(l));if(!o.length||!s.length){n.chartError="Select at least one scenario and one model.",n.chartSamples=[],n.chartBoxes=null,n.chartRangeSeries=null,n.chartLoading=!1,n.chartLoadingProgress={total:0,done:0},Fe();return}const i=nn(o);if(n.chartMode==="single"){const l=ve(n.chartDate,i);l!==n.chartDate&&(n.chartDate=l);const c=o.length*s.length;n.chartLoadingProgress={total:c,done:0},n.chartRangeSeries=null,Fe();const d=[];if((n.chartLocation==="Point"||n.chartLocation==="Search")&&n.chartPoint?!0:n.chartLocation==="Draw"&&n.chartPolygon&&n.chartPolygon.length>=3){console.log("Using pixel-data API for efficient loading");for(const f of o){const h=ve(n.chartDate,Ne(f));try{if((n.chartLocation==="Point"||n.chartLocation==="Search")&&n.chartPoint){const[p,x]=Pn(n.chartPoint.lat,n.chartPoint.lon);console.log(`Fetching pixel data for point (${p}, ${x}) for ${s.length} models`);const T=s.map(w=>_r({variable:n.chartVariable,model:w,x0:p,x1:p,y0:x,y1:x,start_date:h,end_date:h,scenario:st(f),resolution:"low",step_days:1}).catch(v=>{if(console.warn(`Pixel API failed for model ${w}, falling back:`,v),!n.chartPoint)throw v;const L=pe({variable:n.chartVariable,date:h,model:w,scenario:f,resolution:1});return _e(L).then(R=>{const $=Re(R);if(!$)throw new Error("No data returned for chart request.");if(!n.chartPoint)throw new Error("No chart point selected");const D=xn($,n.chartVariable,R.shape,n.chartPoint);return{model:w,value:D,fallback:!0}})})),k=await Promise.allSettled(T);for(const w of k)if(w.status==="fulfilled"){const v=w.value;if(typeof v=="object"&&"fallback"in v&&v.fallback)d.push({scenario:f,model:v.model,rawValue:v.value,dateUsed:h});else{const L=v,R=L.values[0];if(R!==null&&isFinite(R)){const $=n.chartVariable==="hurs"?Math.min(R,100):R;d.push({scenario:f,model:L.model,rawValue:$,dateUsed:h})}}}else console.warn("Failed to fetch pixel data:",w.reason);n.chartLoadingProgress={total:c,done:n.chartLoadingProgress.done+s.length},ce(Math.min(98,Math.round(n.chartLoadingProgress.done/c*100))),e(d)}else if(n.chartLocation==="Draw"&&n.chartPolygon&&n.chartPolygon.length>=3){const[p,x,T,k]=fr(n.chartPolygon),w=hr(n.chartPolygon,p,x,T,k);console.log(`Fetching aggregate data for polygon window [${p},${x},${T},${k}] for ${s.length} models`);try{const v=await ir({variable:n.chartVariable,models:s,x0:p,x1:x,y0:T,y1:k,start_date:h,end_date:h,scenario:st(f),resolution:"low",step_days:1,mask:w});for(const L of s){const R=v.models[L];if(R){const $=R.values[0];if($!==null&&isFinite($)){const D=n.chartVariable==="hurs"?Math.min($,100):$;d.push({scenario:f,model:L,rawValue:D,dateUsed:h})}}}n.chartLoadingProgress={total:c,done:n.chartLoadingProgress.done+s.length},ce(Math.min(98,Math.round(n.chartLoadingProgress.done/c*100))),e(d)}catch(v){console.warn("Batch aggregate API failed, falling back to full map load:",v);for(const L of s){const R=pe({variable:n.chartVariable,date:h,model:L,scenario:f,resolution:1}),$=await _e(R),D=Re($);if(!D)continue;const F=Jn(D,n.chartVariable,$.shape,n.chartPolygon);d.push({scenario:f,model:L,rawValue:F,dateUsed:h})}e(d)}}}catch(p){throw console.error("Error in pixel API path:",p),p}}}else for(const f of o){const h=ve(n.chartDate,Ne(f));for(const p of s){const x=n.chartLoadingProgress.done;ce(Math.min(95,Math.round((x+.1)/c*100)));const T=pe({variable:n.chartVariable,date:h,model:p,scenario:f,resolution:1}),k=await _e(T),w=n.chartLoadingProgress.done+1;n.chartLoadingProgress={total:c,done:w},ce(Math.min(98,Math.round(w/c*100))),e(d);const v=Re(k);if(!v)throw new Error("No data returned for chart request.");const L=Zn(v,n.chartVariable);d.push({scenario:f,model:p,rawValue:L,dateUsed:h})}}n.chartSamples=d,n.chartBoxes=Gt(d,n.chartVariable,n.chartUnit),n.chartLoadingProgress={total:c,done:c},ce(100)}else{let l=ve(n.chartRangeStart,i),c=ve(n.chartRangeEnd,i);J(l)>J(c)&&([l,c]=[c,l]),n.chartRangeStart=l,n.chartRangeEnd=c;const d=zi(l,c),u=l;if(!ph)if((n.chartLocation==="Point"||n.chartLocation==="Search")&&n.chartPoint?!0:n.chartLocation==="Draw"&&n.chartPolygon&&n.chartPolygon.length>=3){console.log("Using pixel-data API for range mode");const h=o.length*s.length;n.chartLoadingProgress={total:h,done:0},n.chartBoxes=null,Fe();const p=[];for(const x of s)for(const T of o){const k=Ne(T),w=ve(l,k),v=ve(c,k);if(J(w)>J(v))continue;const L=n.chartLoadingProgress.done;ce(Math.min(95,Math.round((L+.1)/h*100)));try{if((n.chartLocation==="Point"||n.chartLocation==="Search")&&n.chartPoint){const $=await Wi({variable:n.chartVariable,model:x,scenario:T,point:n.chartPoint,rangeStart:l,rangeEnd:c,useFixedAnnualSamples:d,fixedReferenceDate:u});p.push(...$),e(p)}else if(n.chartLocation==="Draw"&&n.chartPolygon&&n.chartPolygon.length>=3){const[$,D,F,N]=fr(n.chartPolygon),X=hr(n.chartPolygon,$,D,F,N),O=(await ir({variable:n.chartVariable,models:[x],x0:$,x1:D,y0:F,y1:N,start_date:w,end_date:v,scenario:st(T),resolution:"low",step_days:1,mask:X})).models[x];if(O)for(let Q=0;Q<O.timestamps.length;Q++){const Y=O.timestamps[Q];if(d&&!Hi(Y,u))continue;const y=O.values[Q];if(y!==null&&isFinite(y)){const B=n.chartVariable==="hurs"?Math.min(y,100):y;p.push({scenario:T,model:x,rawValue:B,dateUsed:Y})}}e(p)}}catch($){console.warn("Pixel API failed, falling back to full map load:",$);const D=d?ur(u,w,v,50):dr(w,v,50);for(const F of D){const N=d?F:ve(F,k);if(d&&!va(N,k))continue;const X=pe({variable:n.chartVariable,date:N,model:x,scenario:T,resolution:1});let j=null;try{j=await _e(X)}catch(Y){console.warn("Range fallback request failed, skipping date:",Y);continue}const O=Re(j);if(!O)continue;const Q=n.chartLocation==="Draw"&&n.chartPolygon&&n.chartPolygon.length>=3?Jn(O,n.chartVariable,j.shape,n.chartPolygon):(n.chartLocation==="Point"||n.chartLocation==="Search")&&n.chartPoint?xn(O,n.chartVariable,j.shape,n.chartPoint):Zn(O,n.chartVariable);p.push({scenario:T,model:x,rawValue:Q,dateUsed:N})}e(p)}const R=n.chartLoadingProgress.done+1;n.chartLoadingProgress={total:h,done:R},ce(Math.min(98,Math.round(R/h*100))),e(p)}n.chartSamples=p,n.chartRangeSeries=vt(p,n.chartVariable,n.chartUnit),n.chartLoadingProgress={total:h,done:h},ce(100)}else{const h=d?ur(u,l,c,50):dr(l,c,50);if(!h.length){n.chartError="Enter a valid date range within the selected scenarios.",n.chartSamples=[],n.chartBoxes=null,n.chartRangeSeries=null,n.chartLoading=!1,n.chartLoadingProgress={total:0,done:0},Fe();return}const p=o.length*s.length*h.length;n.chartLoadingProgress={total:p,done:0},n.chartBoxes=null,Fe();const x=[];for(const T of s)for(const k of o){const w=Ne(k);for(const v of h){const L=d?v:ve(v,w);if(d&&!va(L,w))continue;const R=n.chartLoadingProgress.done;ce(Math.min(95,Math.round((R+.1)/p*100)));const $=pe({variable:n.chartVariable,date:L,model:T,scenario:k,resolution:1});let D=null;try{D=await _e($)}catch(j){console.warn("Range request failed, skipping date:",j);continue}const F=n.chartLoadingProgress.done+1;n.chartLoadingProgress={total:p,done:F},ce(Math.min(98,Math.round(F/p*100))),e(x);const N=Re(D);if(!N)throw new Error("No data returned for chart request.");const X=n.chartLocation==="Draw"&&n.chartPolygon&&n.chartPolygon.length>=3?Jn(N,n.chartVariable,D.shape,n.chartPolygon):(n.chartLocation==="Point"||n.chartLocation==="Search")&&n.chartPoint?xn(N,n.chartVariable,D.shape,n.chartPoint):Zn(N,n.chartVariable);x.push({scenario:k,model:T,rawValue:X,dateUsed:L})}}n.chartSamples=x,n.chartRangeSeries=vt(x,n.chartVariable,n.chartUnit),n.chartLoadingProgress={total:p,done:p},ce(100)}}}catch(t){n.chartError=t instanceof Ae&&t.statusCode||t instanceof Error?t.message:String(t),n.chartSamples=[],n.chartBoxes=null,n.chartRangeSeries=null,n.chartLoadingProgress={total:1,done:1}}finally{n.chartLoading=!1,Fe()}}async function Ce(){if(n.__updatingMask){console.log("Skipping loadClimateData - mask update in progress");return}if(console.log("fetching"),n.canvasView==="map"){n.isLoading=!0,ce(5,!0),n.dataError=null;try{const e=await Ta();n.metaData=e,n.availableModels=e.models,ce(20);const t=n.mode==="Compare"&&n.compareMode==="Scenarios"?n.compareScenarioA:n.mode==="Ensemble"&&n.ensembleScenarios.length>0?n.ensembleScenarios[0]:n.scenario;n.timeRange=Ne(t),ce(30);const a=n.mode==="Compare"?await Yh(t,ce):n.mode==="Ensemble"?await Xh(ce):await(async()=>{ce(40);const r=Ct(n.date,t);r!==n.date&&(n.date=r);const o=pe({variable:n.variable,date:r,model:n.model,scenario:n.scenario,resolution:n.resolution});ce(55);let s=await _e(o);ce(80);let i=Re(s);if(!i)throw new Error("No data returned for the selected parameters.");if(n.variable==="hurs"){const u=new Float32Array(i.length);let f=1/0,h=-1/0,p=0,x=0;for(let k=0;k<i.length;k++){const w=i[k];if(!isFinite(w)){u[k]=NaN;continue}const v=Math.min(w,100);u[k]=v,f=Math.min(f,v),h=Math.max(h,v),p+=v,x+=1}const T=x>0?p/x:NaN;return s={...s,data:u,data_encoding:"none"},i=u,{data:s,min:f,max:h,mean:T}}const{min:l,max:c}=So(i),d=Zn(i,n.variable);return ce(95),{data:s,min:l,max:c,mean:d}})();if(n.currentData=a.data,n.dataMin=a.min,n.dataMax=a.max,n.dataMean=a.mean,n.mode==="Explore"&&n.masks&&n.masks.length>0){const r=Ct(n.date,t),o=new Set;for(const s of n.masks)s.variable&&s.variable!==n.variable&&o.add(s.variable);n.maskVariableData.clear(),n.maskVariableRanges.clear();for(const s of o)try{const i=pe({variable:s,date:r,model:n.model,scenario:n.scenario,resolution:n.resolution}),l=await _e(i);let c=Re(l);if(s==="hurs")if(c){const d=new Float32Array(c.length);for(let u=0;u<c.length;u++){const f=c[u];isFinite(f)?d[u]=Math.min(f,100):d[u]=NaN}c=d,n.maskVariableData.set(s,{...l,data:d,data_encoding:"none"})}else n.maskVariableData.set(s,l);else n.maskVariableData.set(s,l);if(c){const{min:d,max:u}=So(c);n.maskVariableRanges.set(s,{min:d,max:u})}}catch(i){console.warn(`Failed to load data for mask variable ${s}:`,i)}}if(ce(100),n.isLoading=!1,q(),ee){const r=ee.querySelector("#map-canvas");r&&pa(r)}}catch(e){e instanceof Ae&&e.statusCode?n.dataError=e.message:n.dataError=e instanceof Error?e.message:String(e),n.isLoading=!1,ce(0,!0),n.currentData=null,n.dataMin=null,n.dataMax=null,n.dataMean=null,q()}}}function Kh(){return`
      <div style="${g(M.branding)}">
        <div data-role="brand-eye" style="${g(M.brandIcon)}">
          <svg viewBox="0 0 120 80" style="${g(M.brandSvg)}" aria-hidden="true">
            <defs>
              <clipPath id="brand-eye-clip">
                <rect x="0" y="0" width="120" height="80" style="${g(M.brandClipRect)}" />
              </clipPath>
            </defs>
            <g style="${g(M.brandLids)}">
              <path
                d="M10 40c10-15 30-30 50-30s40 15 50 30c-10 15-30 30-50 30S20 55 10 40Z"
                style="${g(M.brandOutline)}"
              />
            </g>
            <g data-role="brand-iris" style="${g(be(M.brandIrisGroup,M.brandEyeContent))}">
              <circle cx="60" cy="40" r="20" style="${g(M.brandIris)}" />
              <g data-role="brand-pupil" style="${g(M.brandPupilGroup)}">
                <circle cx="60" cy="40" r="10" style="${g(M.brandPupil)}" />
                <circle cx="72" cy="30" r="4" style="${g(M.brandHighlight)}" />
              </g>
            </g>
          </svg>
        </div>
        <span style="${g(M.brandName)}">Polyoracle</span>
      </div>
    `}function q(){if(!ee)return;const e=ee,t=Array.from(e.querySelectorAll(".custom-select-wrapper.open")).map(u=>u.getAttribute("data-key")).filter(u=>!!u),a=(n.resolution-1)/2*100,r=n.mode==="Explore"?"translateX(0%)":n.mode==="Compare"?"translateX(-33.333%)":"translateX(-66.666%)",o=n.mode==="Explore"?"translateX(0%)":n.mode==="Compare"?"translateX(100%)":"translateX(200%)",s=n.canvasView==="map"?"translateX(0%)":"translateX(100%)",i=n.panelTab==="Manual"?"translateX(0%)":"translateX(-50%)";e.innerHTML=`
    <div style="${g(M.page)}">
      <div style="${g(M.bgLayer1)}"></div>
      <div style="${g(M.bgLayer2)}"></div>
      <div style="${g(M.bgOverlay)}"></div>
      ${Kh()}
        ${n.canvasView==="map"&&n.dataMin!==null&&n.dataMax!==null?Kf(n.mode==="Ensemble"?n.ensembleVariable:n.variable,n.dataMin,n.dataMax,n.metaData,n.mode==="Ensemble"?n.ensembleUnit:n.selectedUnit,n.mode==="Compare"||n.mode==="Ensemble"&&n.ensembleStatistic!=="mean",n.mapRangeOpen?70:0):""}
      <div style="${g(M.mapArea)}">
        ${n.canvasView==="map"?`
              <canvas
                id="map-canvas"
                style="position: absolute; inset: 0; width: 100%; height: 100%; object-fit: contain; pointer-events: auto;"
              ></canvas>
              ${ep()}
              ${Dh()}
              ${Th()}
              ${Lh()}
              ${Eh()}
              ${Gh()}
              ${n.dataError?`<div style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.8); z-index: 10;">
                      <div style="text-align: center; max-width: 600px; padding: 20px;">
                        <div style="${g(M.mapTitle)}">Error loading data</div>
                        <div style="${g(M.mapSubtitle)}">${n.dataError}</div>
                        ${n.apiAvailable===!1?`<div style="${g(be(M.mapSubtitle,{marginTop:12,fontSize:12}))}">
                                Make sure the Python API server is running. Check the terminal for connection details.
                              </div>`:""}
                      </div>
                    </div>`:""}
              ${!n.isLoading&&!n.dataError&&!n.currentData?`<div style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.5); z-index: 5;">
                      <div style="text-align: center;">
                        <div style="${g(M.mapTitle)}">No data loaded</div>
                        <div style="${g(M.mapSubtitle)}">
                          Adjust parameters to load climate data
                        </div>
                      </div>
                    </div>`:""}
            `:'<div data-role="chart-container" style="pointer-events:auto; width:100%; display:flex; align-items:center; justify-content:center; padding:24px;"></div>'}
      </div>

      ${Rh()}

      <aside data-role="sidebar" class="sidebar" style="width: ${Ee}px; transform: ${n.sidebarOpen?"translateX(0)":`translateX(${Ee+24}px)`}; pointer-events: ${n.sidebarOpen?"auto":"none"}" aria-hidden="${!n.sidebarOpen}">
        <div class="sidebar-top">
          <div class="sidebar-brand">
            <div class="logo-dot"></div>
          </div>
          <div class="tab-switch" style="${g(M.tabSwitch)}">
            ${["Manual","Chat"].map(u=>Zh(u,n.panelTab===u?M.tabBtnActive:void 0,"panel-tab")).join("")}
          </div>
        </div>

        <div class="sidebar-content">
          <div class="tab-viewport">
            <div data-role="tab-track" class="tab-track" style="transform: ${i}">
              <div class="tab-pane">
                ${n.canvasView==="map"?Jh({modeTransform:r,resolutionFill:a,modeIndicatorTransform:o}):tp()}
              </div>
              <div class="tab-pane">
                ${np()}
              </div>
            </div>
          </div>
        </div>
      </aside>

      <div data-role="canvas-toggle" style="${g({...M.canvasToggle,right:n.sidebarOpen?Ee+24:24})}">
        <div style="${g(M.canvasSwitch)}">
          <div data-role="canvas-indicator" style="${g({...M.canvasIndicator,transform:s})}"></div>
          <button
            type="button"
            aria-label="Show map canvas"
            data-action="set-canvas"
            data-value="map"
            style="${g(be(M.canvasBtn,n.canvasView==="map"?M.canvasBtnActive:void 0))}"
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.6">
              <path d="M4 6.5 9 4l6 2.5L20 4v14l-5 2.5L9 18 4 20.5V6.5Z" />
              <path d="m9 4v14m6-11.5v14" />
            </svg>
          </button>
          <button
            type="button"
            aria-label="Show chart canvas"
            data-action="set-canvas"
            data-value="chart"
            style="${g(be(M.canvasBtn,n.canvasView==="chart"?M.canvasBtnActive:void 0))}"
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.8">
              <path d="M4 18h16" />
              <path d="M6 18 11 9l4 5 3-6" />
              <circle cx="6" cy="18" r="1.2" />
              <circle cx="11" cy="9" r="1.2" />
              <circle cx="15" cy="14" r="1.2" />
              <circle cx="18" cy="8" r="1.2" />
            </svg>
          </button>
        </div>
      </div>

      ${Sh(n)}

      ${Nf(n.sidebarOpen)}

      ${n.canvasView==="map"&&!n.mapRangeOpen?uh({date:n.date,timeRange:n.timeRange,sidebarOpen:n.sidebarOpen,sidebarWidth:Ee,mode:n.mode,compareMode:n.compareMode,compareDateStart:n.compareDateStart,compareDateEnd:n.compareDateEnd}):""}

      ${qf()}
      ${Of(et())}
    </div>
  `,rp();const l=e.querySelector(".tutorial-box");if(l){const u=l.getBoundingClientRect(),f=16;let h=0,p=0;if(u.right>window.innerWidth-f?h=window.innerWidth-f-u.right:u.left<f&&(h=f-u.left),u.bottom>window.innerHeight-f?p=window.innerHeight-f-u.bottom:u.top<f&&(p=f-u.top),h!==0||p!==0){const x=l.style.transform||"";l.style.transform=`${x} translate(${h}px, ${p}px)`}}if(t.forEach(u=>{const f=e.querySelector(`.custom-select-wrapper[data-key="${u}"]`);f&&f.classList.add("open")}),Se=ee.querySelector("#map-canvas"),Se&&n.currentData&&!n.dataError&&n.dataMin!==null&&n.dataMax!==null)try{pa(Se),Gn(n.currentData,Se,de,n.palette,n.dataMin,n.dataMax,n.mode==="Ensemble"?n.ensembleVariable:n.variable,n.mode==="Ensemble"?n.ensembleUnit:n.selectedUnit,n.masks,n.mode==="Ensemble"?n.ensembleStatistics:null,n.mode==="Ensemble",n.mode==="Explore"?n.maskVariableData:void 0);const u=de.find(f=>f.name===n.palette)||de[0];Yn("legend-gradient-canvas",u.colors),(n.drawState.active||n.mapPolygon!==null&&n.mapPolygon.length>=3)&&requestAnimationFrame(Ea)}catch(u){console.error("Map render failed (e.g. changing display variable with masks):",u)}const c=(n.sidebarOpen?Ee+24:24)+8,d=n.sidebarOpen?1:.9;Ei(c,d),_i(),n.canvasView==="chart"&&Fe()}function Gh(){if(!n.isLoading)return"";const e=Math.max(0,Math.min(100,Math.round(n.loadingProgress)));return`
      <div style="${g(M.loadingIndicator)}">
        <div style="${g(M.loadingSpinner)}"></div>
        <div style="${g(M.loadingTextGroup)}">
          <div style="${g(M.loadingText)}">Loading data · ${e}%</div>
          <div style="${g(M.loadingBar)}">
            <div style="${g({...M.loadingBarFill,width:`${e}%`})}"></div>
          </div>
          <div style="${g(M.loadingSubtext)}">Fetching climate tiles</div>
        </div>
      </div>
    `}function Qh(){return`
      <div style="position:absolute; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none;">
      </div>
    `}function Ar(e){if(!Number.isFinite(e))return"-";const t=Math.abs(e);return t>=1e3?e.toFixed(0):t>=100?e.toFixed(1):t>=1?e.toFixed(2):e.toPrecision(2)}function To(e){if(!e.length)return`<div style="${g(M.chartEmpty)}">No chart data loaded yet.</div>`;const t=[...e].sort(($,D)=>Me.indexOf($.scenario)-Me.indexOf(D.scenario)),r=(de.find($=>$.name===n.palette)||de[0]).colors,o=900,s=440,i={top:26,right:36,bottom:70,left:86},l=o-i.left-i.right,c=s-i.top-i.bottom,d=t.flatMap($=>[$.stats.min,$.stats.max]),u=Math.min(...d),f=Math.max(...d),h=Math.max(Math.abs(f-u)*.12,1e-6),p=Ma().domain([u-h,f+h]).range([c,0]),x=p.ticks(6),T=l/(t.length+1),k=x.map($=>{const D=p($)+i.top;return`
        <g>
          <line x1="${i.left}" x2="${o-i.right}" y1="${D}" y2="${D}" stroke="rgba(255,255,255,0.08)" />
          <text x="${i.left-10}" y="${D+4}" fill="var(--text-secondary)" font-size="11" text-anchor="end">
            ${Ar($)}
          </text>
        </g>
      `}).join(""),w=t.map(($,D)=>{const F=i.left+T*(D+1),N=r[D%r.length],{min:X,q1:j,median:O,q3:Q,max:Y,mean:y}=$.stats,B=p(Q)+i.top,E=p(j)+i.top,m=Math.max(2,E-B),b=p(X)+i.top,S=p(Y)+i.top;return`
        <g data-boxplot-idx="${D}" class="boxplot-group">
          <line x1="${F}" x2="${F}" y1="${b}" y2="${S}" stroke="${N}" stroke-width="2" stroke-linecap="round" />
          <rect x="${F-24}" y="${B}" width="48" height="${m}" fill="rgba(255,255,255,0.06)" stroke="${N}" stroke-width="2" rx="6" />
          <line x1="${F-24}" x2="${F+24}" y1="${p(O)+i.top}" y2="${p(O)+i.top}" stroke="${N}" stroke-width="2.4" />
          <circle cx="${F}" cy="${p(y)+i.top}" r="4" fill="${N}" stroke="rgba(0,0,0,0.55)" stroke-width="1" />
          <text x="${F}" y="${s-i.bottom+32}" fill="var(--text-primary)" font-weight="700" font-size="12" text-anchor="middle">${$.scenario}</text>
          <text x="${F}" y="${s-i.bottom+48}" fill="var(--text-secondary)" font-size="11" text-anchor="middle">${$.samples.length} model${$.samples.length===1?"":"s"}</text>
          <rect x="${F-35}" y="${i.top}" width="70" height="${c}" fill="transparent" class="boxplot-hover-area" style="cursor: pointer; pointer-events: all;" />
        </g>
      `}).join(""),v=t.map(($,D)=>{const N=i.left+T*(D+1)+30,X=N,j=N+6,O=j+6,Q=$.samples.map(E=>{const m=p(E.value)+i.top;return{model:E.model,value:E.value,y:m}}).sort((E,m)=>E.y-m.y),Y=12,y=[];return Q.forEach((E,m)=>{if(m===0)y.push({...E,adjustedY:E.y});else{const S=y[m-1].adjustedY+Y;y.push({...E,adjustedY:Math.max(E.y,S)})}}),y.map(E=>{const m=E.adjustedY||E.y;return`
                    <g class="model-indicator" data-boxplot-idx="${D}">
                      <line x1="${X}" x2="${j}" y1="${E.y}" y2="${E.y}" stroke="white" stroke-width="1" stroke-linecap="round" />
                      <text x="${O}" y="${m+4}" fill="white" font-size="10" font-weight="300" opacity="0.95">${E.model}</text>
                    </g>
                  `}).join("")}).join(""),L=`
      <line
        x1="${i.left}"
        x2="${i.left}"
        y1="${i.top}"
        y2="${s-i.bottom}"
        stroke="rgba(255,255,255,0.65)"
        stroke-width="1.2"
      />
    `,R=`
      <text
        x="${i.left-70}"
        y="${i.top+c/2}"
        fill="var(--text-secondary)"
        font-size="12"
        text-anchor="middle"
        transform="rotate(-90 ${i.left-70} ${i.top+c/2})"
      >
        ${n.chartUnit}
      </text>
    `;return`
      <svg viewBox="0 0 ${o} ${s}" role="img" aria-label="Global box plots" preserveAspectRatio="xMidYMid meet" style="width:100%; height:auto;">
        ${L}
        ${k}
        ${w}
        <g class="boxplot-hover-overlay" style="opacity: 0; pointer-events: none;">
          ${v}
        </g>
        ${R}
      </svg>
    `}function Lo(e,t){if(!e.length)return`<div style="${g(M.chartEmpty)}">No chart data loaded yet.</div>`;const a=[...e].sort((R,$)=>Me.indexOf(R.scenario)-Me.indexOf($.scenario)),o=(de.find(R=>R.name===n.palette)||de[0]).colors,s=560,i=300,l={top:18,right:16,bottom:52,left:48},c=s-l.left-l.right,d=i-l.top-l.bottom,u=a.flatMap(R=>[R.stats.min,R.stats.max]),f=Math.min(...u),h=Math.max(...u),p=Math.max(Math.abs(h-f)*.12,1e-6),x=Ma().domain([f-p,h+p]).range([d,0]),T=x.ticks(4),k=c/(a.length+1),w=T.map(R=>{const $=x(R)+l.top;return`
        <g>
          <line x1="${l.left}" x2="${s-l.right}" y1="${$}" y2="${$}" stroke="rgba(255,255,255,0.06)" />
          <text x="${l.left-8}" y="${$+3}" fill="var(--text-secondary)" font-size="9" text-anchor="end">
            ${Ar(R)}
          </text>
        </g>
      `}).join(""),v=a.map((R,$)=>{const D=l.left+k*($+1),F=o[$%o.length],{min:N,q1:X,median:j,q3:O,max:Q,mean:Y}=R.stats,y=x(O)+l.top,B=x(X)+l.top,E=Math.max(2,B-y);return`
        <g>
          <line x1="${D}" x2="${D}" y1="${x(N)+l.top}" y2="${x(Q)+l.top}" stroke="${F}" stroke-width="1.6" stroke-linecap="round" />
          <rect x="${D-16}" y="${y}" width="32" height="${E}" fill="rgba(255,255,255,0.06)" stroke="${F}" stroke-width="1.6" rx="5" />
          <line x1="${D-16}" x2="${D+16}" y1="${x(j)+l.top}" y2="${x(j)+l.top}" stroke="${F}" stroke-width="2" />
          <circle cx="${D}" cy="${x(Y)+l.top}" r="3.2" fill="${F}" stroke="rgba(0,0,0,0.55)" stroke-width="0.8" />
          <text x="${D}" y="${i-l.bottom+26}" fill="var(--text-primary)" font-weight="700" font-size="10" text-anchor="middle">${R.scenario}</text>
          <text x="${D}" y="${i-l.bottom+40}" fill="var(--text-secondary)" font-size="9" text-anchor="middle">${R.samples.length} model${R.samples.length===1?"":"s"}</text>
        </g>
      `}).join(""),L=`
      <line
        x1="${l.left}"
        x2="${l.left}"
        y1="${l.top}"
        y2="${i-l.bottom}"
        stroke="rgba(255,255,255,0.55)"
        stroke-width="1"
      />
    `;return`
      <svg viewBox="0 0 ${s} ${i}" role="img" aria-label="Mini box plots" preserveAspectRatio="xMidYMid meet" style="width:100%; height:auto;">
        ${L}
        ${w}
        ${v}
        <text x="${l.left}" y="${l.top-6}" fill="var(--text-secondary)" font-size="9">${$e(t)}</text>
      </svg>
    `}function ba(e,t){if(!e.length)return`<div style="${g(M.chartEmpty)}">No chart data loaded yet.</div>`;const r=(de.find(S=>S.name===n.palette)||de[0]).colors,o=t?.compact??!1,s=t?.unitLabel??n.chartUnit,i=960,l=o?220:460,c=o?{top:24,right:26,bottom:64,left:70}:{top:28,right:32,bottom:82,left:86},d=i-c.left-c.right,u=l-c.top-c.bottom,f=o?10:11,h=o?10.5:11.5,p=o?54:70,x=e.flatMap(S=>S.points),T=x.map(S=>J(S.date)),k=os(T),w=rs(T);if(!k||!w)return`<div style="${g(M.chartEmpty)}">No chart data loaded yet.</div>`;const v=1440*60*1e3,L=new Date(k.getTime()-v*.25),R=new Date(w.getTime()+v*.25),$=bf().domain([L,R]).range([0,d]),D=$.ticks(o?5:6),F=Rr("%b %Y"),N=x.flatMap(S=>[S.stats.min,S.stats.max]),X=Math.min(...N),j=Math.max(...N),O=Math.max(Math.abs(j-X)*.12,1e-6),Q=Ma().domain([X-O,j+O]).range([u,0]),y=Q.ticks(6).map(S=>{const _=Q(S)+c.top;return`
        <g>
          <line x1="${c.left}" x2="${i-c.right}" y1="${_}" y2="${_}" stroke="rgba(255,255,255,0.08)" />
          <text x="${c.left-10}" y="${_+4}" fill="var(--text-secondary)" font-size="${f}" text-anchor="end">
            ${Ar(S)}
          </text>
        </g>
      `}).join(""),B=D.map(S=>{const _=$(S)+c.left;return`
        <g>
          <line x1="${_}" x2="${_}" y1="${c.top}" y2="${l-c.bottom}" stroke="rgba(255,255,255,0.06)" />
          <text x="${_}" y="${l-c.bottom+26}" fill="var(--text-secondary)" font-size="${f}" text-anchor="middle">
            ${F(S)}
          </text>
        </g>
      `}).join(""),E=Math.max(Le.length,4),m=e.map((S,_)=>{if(!S.points.length)return"";const U=r[_%r.length],I=S.points.map(W=>{const H=Array.from({length:E+1},(P,z)=>{const G=z/E;return W.stats.min+(W.stats.max-W.stats.min)*G});return{point:W,levels:H}}),C=W=>{const H=I.map(({point:z,levels:G})=>{const A=$(J(z.date))+c.left,ie=Q(G[W+1])+c.top;return`${A},${ie}`}).join(" L "),P=[...I].reverse().map(({point:z,levels:G})=>{const A=$(J(z.date))+c.left,ie=Q(G[W])+c.top;return`${A},${ie}`}).join(" L ");return`M ${H} L ${P} Z`},V=Array.from({length:E},(W,H)=>{const P=C(H),z=E/2,A=.55*(1-Math.min(Math.abs(H+.5-z)/z,1))+.08;return`<path d="${P}" fill="${U}" fill-opacity="${A.toFixed(3)}" stroke="none" />`}).join(""),K=S.points.map((W,H)=>{const P=$(J(W.date))+c.left,z=Q(W.stats.median)+c.top;return`${H===0?"M":"L"} ${P} ${z}`}).join(" "),Z=S.points.map((W,H)=>{const P=$(J(W.date))+c.left,z=Q(W.stats.mean)+c.top;return`${H===0?"M":"L"} ${P} ${z}`}).join(" ");return`
        <g>
          ${V}
          <path d="${K}" fill="none" stroke="${U}" stroke-width="2.2" />
          <path d="${Z}" fill="none" stroke="${U}" stroke-width="1.6" stroke-dasharray="6 6" stroke-opacity="0.9" />
          <circle cx="${$(J(S.points[S.points.length-1].date))+c.left}" cy="${Q(S.points[S.points.length-1].stats.median)+c.top}" r="4" fill="${U}" stroke="rgba(0,0,0,0.4)" stroke-width="1" />
        </g>
      `}).join(""),b=`
      <text
        x="${c.left-p}"
        y="${c.top+u/2}"
        fill="var(--text-secondary)"
        font-size="${o?11:12}"
        text-anchor="middle"
        transform="rotate(-90 ${c.left-p} ${c.top+u/2})"
      >
        ${s}
      </text>
    `;return`
      <div style="width:100%; display:flex; flex-direction:column; gap:12px; align-items:center;">
        <div style="position:relative; width:100%; display:flex; justify-content:center;">
          <div style="position:absolute; top:10px; right:16px; display:flex; gap:12px; align-items:center; color:var(--text-secondary); font-size:${h}px; z-index:2;">
            <div style="display:flex; align-items:center; gap:6px;">
              <span style="display:inline-block; width:26px; height:0; border-top:1px solid var(--text-primary);"></span>
              <span>Median</span>
            </div>
            <div style="display:flex; align-items:center; gap:6px;">
              <span style="display:inline-block; width:26px; height:0; border-top:1px dashed var(--text-primary);"></span>
              <span>Mean</span>
            </div>
          </div>
          <svg viewBox="0 0 ${i} ${l}" role="img" aria-label="Distribution over time" preserveAspectRatio="xMidYMid meet" style="width:100%; height:${o?"100%":"auto"};">
            ${y}
            ${B}
            <path
              d="M ${c.left} ${c.top} L ${c.left} ${l-c.bottom} L ${i-c.right} ${l-c.bottom}"
              fill="none"
              stroke="rgba(255,255,255,0.6)"
              stroke-width="1.2"
              stroke-linecap="round"
            />
            ${m}
            ${b}
          </svg>
        </div>
        ${o?"":`<div style="${g(M.chartLegend)}">
          ${e.map((S,_)=>`
            <div style="display:flex; align-items:center; gap:8px; font-size:12; color:var(--text-secondary);">
              <span style="display:inline-block; width:16px; height:8px; background:${r[_%r.length]}; border-radius:999px;"></span>
              <span style="color:var(--text-primary); font-weight:700;">${S.scenario}</span>
            </div>
          `).join("")}
        </div>`}
      </div>
    `}function ae(e,t){return`
    <div style="${g(M.field)}">
      ${e?`<div style="${g(M.fieldLabel)}">${e}</div>`:""}
      ${t}
    </div>
  `}function tt(e,t,a){const r=a?.type??"date",o=a?.dataKey??e,s=a?.min?`min="${a.min}"`:"",i=a?.max?`max="${a.max}"`:"",l=a?.dataRole?`data-role="${a.dataRole}"`:"";return`
    <input
      type="${r}"
      value="${t}"
      data-action="update-input"
      data-key="${o}"
      ${s}
      ${i}
      ${l}
    />
  `}function ne(e,t,a,r){const o=r?.dataKey??e,s=r?.disabled?"disabled":"",i=`custom-select-${o}-${Math.random().toString(36).substr(2,9)}`,l=r?.infoType,c=$e(r?.selectedLabel??a),d=r?.extraContent??"",u=r?.dataRole?`data-role="${r.dataRole}"`:"";return`
    <div class="custom-select-container">
      <div class="custom-select-info-panel" id="${i}-info" role="tooltip"></div>
      <div class="custom-select-wrapper" ${u} data-key="${o}" ${s?'data-disabled="true"':""} ${l?`data-info-type="${l}"`:""}>
        <div class="custom-select-trigger" data-action="update-select" data-key="${o}" id="${i}-trigger" ${s?'aria-disabled="true"':""} tabindex="${s?"-1":"0"}">
          <span class="custom-select-value">${c}</span>
          <svg class="custom-select-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="custom-select-dropdown" id="${i}-dropdown" role="listbox">
          ${t.map(f=>`
                <div class="custom-select-option ${f===a?"selected":""}" 
                     data-value="${f}" 
                     data-action="update-select" 
                     data-key="${o}"
                     role="option"
                     ${f===a?'aria-selected="true"':""}
                     tabindex="0">
                  ${o==="ensembleStatistic"||o==="maskStatistic"?f==="mean"?"Mean":f==="median"?"Median":f==="std"?"Std":f==="iqr"?"IQR":f==="percentile"?"Percentile":f==="extremes"?"Extremes":f:f}
                </div>
              `).join("")}
          ${d}
        </div>
      </div>
    </div>
  `}function Zh(e,t,a="panel-tab"){return`
    <button
      type="button"
      data-action="set-tab"
      data-key="${a}"
      data-value="${e}"
      style="${g(be(M.tabBtn,t))}"
    >
      ${e}
    </button>
  `}function Jh(e){const{modeTransform:t,resolutionFill:a,modeIndicatorTransform:r}=e,o=(i,l,c,d,u)=>`
          <div style="${g({border:"1px solid var(--border-medium)",borderRadius:12,background:"var(--bg-subtle)",padding:"10px 12px"})}">
            <button
              type="button"
              data-action="toggle-collapse"
              data-key="${u}"
              style="${g({display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",background:"transparent",border:"none",color:"var(--text-primary)",fontWeight:700,fontSize:13,cursor:"pointer",padding:0})}"
            >
              <span>${i}</span>
              <span style="${g({color:"var(--text-secondary)",fontWeight:600,fontSize:12})}">${c} ${l?"▴":"▾"}</span>
            </button>
            ${l?`<div style="${g({marginTop:10,display:"flex",flexWrap:"wrap",gap:8})}">${d}</div>`:""}
          </div>
        `,s=n.compareMode==="Models"?[ae("Scenario",ne("scenario",Me,n.scenario,{infoType:"scenario"})),ae("Date",tt("date",n.date))]:n.compareMode==="Dates"?[ae("Scenario",ne("scenario",Me,n.scenario,{infoType:"scenario"})),ae("Model",ne("model",me,n.model,{infoType:"model"}))]:[ae("Model",ne("model",me,n.model,{infoType:"model"})),ae("Date",tt("date",n.date))];return`
    <div style="${g(M.modeSwitch)}">
      <div data-role="mode-indicator" style="${g({...M.modeIndicator,transform:r})}"></div>
      ${["Explore","Compare","Ensemble"].map(i=>`
            <button
              type="button"
              class="mode-btn"
              data-action="set-mode"
              data-value="${i}"
              style="${g(be(M.modeBtn,n.mode===i?M.modeBtnActive:void 0))}"
            >
              ${i}
            </button>
          `).join("")}
    </div>

    <div style="${g(M.modeViewport)}">
      <div data-role="mode-track" style="${g({...M.modeTrack,transform:t})}">
        <div class="mode-pane-scrollable" style="${g(M.modePane)}">
          <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
            <div style="${g(M.sectionTitle)}">Parameters</div>
            <div style="${g(M.paramGrid)}">
              ${ae("Scenario",ne("scenario",Me,n.scenario,{infoType:"scenario",dataRole:"scenario-selector"}))}
              ${ae("Model",ne("model",me,n.model,{infoType:"model",dataRole:"model-selector"}))}
              ${ae("Date",(()=>{const i=Ne(n.scenario);return tt("date",n.date,{min:i.start,max:i.end,dataRole:"date-picker"})})())}
              ${ae("Variable",ne("variable",Le,n.variable,{infoType:"variable",dataRole:"variable-selector"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${g(M.sectionTitle)}">Unit</div>
              ${ae("",ne("unit",Ue(n.variable).map(i=>i.label),n.selectedUnit,{dataKey:"unit",dataRole:"unit-selector"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${g(M.sectionTitle)}">Color palette</div>
              ${ae("",ne("palette",de.map(i=>i.name),n.palette,{dataKey:"palette",dataRole:"palette-selector"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${g(M.sectionTitle)}">Resolution</div>
              <div style="${g(M.resolutionRow)}">
                <input
                  type="range"
                  min="1"
                  max="3"
                  step="1"
                  value="${n.resolution}"
                  data-action="set-resolution"
                  class="resolution-slider"
                  style="${g(be(M.range,{"--slider-fill":`${a}%`}))}"
                />
                <div data-role="resolution-value" style="${g(M.resolutionValue)}">${n.resolution===1?"Low":n.resolution===2?"Medium":"High"}</div>
              </div>
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${g(M.sectionTitle)}">Mask</div>
              ${n.masks.length>0?`
                      <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
                        ${n.masks.map((i,l)=>{const c=i.variable||n.variable,d=i.unit||Pe(c).label,u=n.mode==="Explore"?Qn(c,d):null,f=n.mode==="Ensemble"?bn(i.statistic||"mean"):null,h=f?.min??u?.min??(c===n.variable?n.dataMin:null),p=f?.max??u?.max??(c===n.variable?n.dataMax:null);return`
                          ${n.mode==="Ensemble"?`
                                  <div style="${g({display:"flex",alignItems:"center",gap:8,marginBottom:4})}">
                                    ${ne("maskStatistic",["mean","std","median","iqr","percentile","extremes"],i.statistic||"mean",{dataKey:"maskStatistic",selectedLabel:i.statistic==="mean"?"Mean":i.statistic==="std"?"Std":i.statistic==="median"?"Median":i.statistic==="iqr"?"IQR":i.statistic==="percentile"?"Percentile":i.statistic==="extremes"?"Extremes":"Mean"}).replace('class="custom-select-wrapper"',`class="custom-select-wrapper" data-mask-index="${l}" style="width: 100px;"`)}
                                  </div>
                                  `:n.mode==="Explore"?`
                                  <div style="${g({display:"flex",alignItems:"center",gap:8,marginBottom:4})}">
                                    ${ne("maskVariable",Le,i.variable||n.variable,{dataKey:"maskVariable",infoType:"variable"}).replace('class="custom-select-wrapper"',`class="custom-select-wrapper" data-mask-index="${l}" style="width: 140px;"`)}
                                    ${ne("maskUnit",Ue(i.variable||n.variable).map(x=>x.label),i.unit||Pe(i.variable||n.variable).label,{dataKey:"maskUnit"}).replace('class="custom-select-wrapper"',`class="custom-select-wrapper" data-mask-index="${l}" style="width: 120px;"`)}
                                  </div>
                                  `:""}
                          <div style="${g({display:"flex",alignItems:"center",gap:8})}">
                            <input
                              type="number"
                              step="any"
                              value="${i.lowerEdited&&i.lowerBound!==null?i.lowerBound:""}"
                              data-action="update-mask-bound"
                              data-mask-index="${l}"
                              data-bound="lower"
                              placeholder="${zt(h)}"
                              style="${g({width:"90px",background:"var(--gradient-bg)",border:"1px solid var(--border-strong)",borderRadius:8,color:"var(--text-primary)",padding:"6px 10px",fontSize:12.5,fontWeight:600,fontFamily:"var(--font-geist-sans)",letterSpacing:.25,minHeight:32,boxShadow:"inset 0 1px 0 var(--inset-light)"})}"
                            />
                            <span style="${g({fontSize:12.5,color:"var(--text-secondary)",minWidth:"20px",textAlign:"center"})}">to</span>
                            <input
                              type="number"
                              step="any"
                              value="${i.upperEdited&&i.upperBound!==null?i.upperBound:""}"
                              data-action="update-mask-bound"
                              data-mask-index="${l}"
                              data-bound="upper"
                              placeholder="${zt(p)}"
                              style="${g({width:"90px",background:"var(--gradient-bg)",border:"1px solid var(--border-strong)",borderRadius:8,color:"var(--text-primary)",padding:"6px 10px",fontSize:12.5,fontWeight:600,fontFamily:"var(--font-geist-sans)",letterSpacing:.25,minHeight:32,boxShadow:"inset 0 1px 0 var(--inset-light)"})}"
                            />
                            <button
                              type="button"
                              data-action="remove-mask"
                              data-mask-index="${l}"
                              style="${g({width:28,height:28,padding:0,borderRadius:6,border:"1px solid var(--border-medium)",background:"var(--bg-transparent)",color:"var(--text-secondary)",fontSize:16,fontWeight:600,cursor:"pointer",transition:"all 0.15s ease",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0})}"
                              onmouseover="this.style.borderColor='var(--border-bright)'; this.style.background='var(--bg-medium)'"
                              onmouseout="this.style.borderColor='var(--border-medium)'; this.style.background='var(--bg-transparent)'"
                            >
                              −
                            </button>
                          </div>
                        `}).join("")}
                        <button
                          type="button"
                          data-action="apply-masks"
                          style="${g({padding:"10px 16px",borderRadius:10,border:"1px solid var(--border-strong)",background:"var(--gradient-primary)",color:"white",fontSize:12.5,fontWeight:700,cursor:"pointer",transition:"all 0.15s ease",textAlign:"center",width:"100%",marginTop:8,boxShadow:"var(--shadow-combined)"})}"
                          onmouseover="this.style.borderColor='var(--accent-border-bright)'; this.style.boxShadow='var(--shadow-elevated)'"
                          onmouseout="this.style.borderColor='var(--border-strong)'; this.style.boxShadow='var(--shadow-combined)'"
                        >
                          Apply Masks
                        </button>
                        <button
                          type="button"
                          data-action="add-mask"
                          style="${g({padding:"8px 14px",borderRadius:10,border:"1px solid var(--border-subtle)",background:"var(--bg-transparent)",color:"var(--text-secondary)",fontSize:12.5,fontWeight:600,cursor:"pointer",transition:"all 0.15s ease",textAlign:"left",width:"100%",marginTop:4})}"
                          onmouseover="this.style.borderColor='var(--border-medium)'; this.style.background='var(--bg-subtle)'"
                          onmouseout="this.style.borderColor='var(--border-subtle)'; this.style.background='var(--bg-transparent)'"
                        >
                          + Add Mask
                        </button>
                      </div>
                      `:`
                      <button
                        type="button"
                        data-action="add-mask"
                        style="${g({padding:"8px 14px",borderRadius:10,border:"1px solid var(--border-subtle)",background:"var(--bg-transparent)",color:"var(--text-secondary)",fontSize:12.5,fontWeight:600,cursor:"pointer",transition:"all 0.15s ease",textAlign:"left",width:"100%"})}"
                        onmouseover="this.style.borderColor='var(--border-medium)'; this.style.background='var(--bg-subtle)'"
                        onmouseout="this.style.borderColor='var(--border-subtle)'; this.style.background='var(--bg-transparent)'"
                      >
                        + Add Mask
                      </button>
                      `}
            </div>
          </div>
        </div>

                <div class="mode-pane-scrollable" style="${g(M.modePane)}">
                    <div data-role="compare-parameters" style="${g({display:"flex",flexDirection:"column",gap:14})}">
            <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${g(M.sectionTitle)}">Compare</div>
              <div style="${g(M.paramGrid)}">
                ${ae("What do you want to compare?",ne("compareMode",["Scenarios","Models","Dates"],n.compareMode,{dataKey:"compareMode"}))}
              </div>

              ${n.compareMode==="Scenarios"?`
                      <div style="${g(M.paramGrid)}">
                        ${ae("Scenario A",ne("compareScenarioA",["SSP245","SSP370","SSP585"],n.compareScenarioA,{dataKey:"compareScenarioA",infoType:"scenario"}))}
                        ${ae("Scenario B",ne("compareScenarioB",["SSP245","SSP370","SSP585"],n.compareScenarioB,{dataKey:"compareScenarioB",infoType:"scenario"}))}
                      </div>
                    `:""}

              ${n.compareMode==="Models"?`
                      <div style="${g(M.paramGrid)}">
                        ${ae("Model A",ne("compareModelA",(()=>{const i=me.filter(l=>l!==n.compareModelB);return i.includes(n.compareModelA)?i:[n.compareModelA,...i]})(),n.compareModelA,{dataKey:"compareModelA",infoType:"model"}))}
                        ${ae("Model B",ne("compareModelB",(()=>{const i=me.filter(l=>l!==n.compareModelA);return i.includes(n.compareModelB)?i:[n.compareModelB,...i]})(),n.compareModelB,{dataKey:"compareModelB",infoType:"model"}))}
                      </div>
                    `:""}

              ${n.compareMode==="Dates"?`
                      <div style="${g(M.paramGrid)}">
                        ${ae("Start date",tt("compareDateStart",n.compareDateStart,{dataKey:"compareDateStart"}))}
                        ${ae("End date",tt("compareDateEnd",n.compareDateEnd,{dataKey:"compareDateEnd"}))}
  </div>
`:""}

              <div style="${g(M.paramGrid)}">
                ${s.join("")}
                ${ae("Variable",ne("variable",Le,n.variable,{infoType:"variable"}))}
              </div>

              <div style="margin-top:14px">
                <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
                  <div style="${g(M.sectionTitle)}">Unit</div>
                  ${ae("",ne("unit",Ue(n.variable).map(i=>i.label),n.selectedUnit,{dataKey:"unit"}))}
                </div>
              </div>

              <div style="margin-top:14px">
                <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
                  <div style="${g(M.sectionTitle)}">Color palette</div>
                  ${ae("",ne("palette",de.map(i=>i.name),n.palette,{dataKey:"palette"}))}
                </div>
              </div>

              <div style="margin-top:14px">
                <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
                  <div style="${g(M.sectionTitle)}">Resolution</div>
                  <div style="${g(M.resolutionRow)}">
                    <input
                      type="range"
                      min="1"
                      max="3"
                      step="1"
                      value="${n.resolution}"
                      data-action="set-resolution"
                      class="resolution-slider"
                      style="${g(be(M.range,{"--slider-fill":`${a}%`}))}"
                    />
                    <div data-role="resolution-value" style="${g(M.resolutionValue)}">${n.resolution===1?"Low":n.resolution===2?"Medium":"High"}</div>
                  </div>
                </div>
              </div>

              <div style="margin-top:14px">
                <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
                  <div style="${g(M.sectionTitle)}">Mask</div>
                  ${n.masks.length>0?`
                          <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
                            ${n.masks.map((i,l)=>{const c=i.variable||n.variable,d=i.unit||Pe(c).label,u=n.mode==="Explore"?Qn(c,d):null,f=n.mode==="Ensemble"?bn(i.statistic||"mean"):null,h=f?.min??u?.min??(c===n.variable?n.dataMin:null),p=f?.max??u?.max??(c===n.variable?n.dataMax:null);return`
                              <div style="${g({display:"flex",alignItems:"center",gap:8})}">
                                ${n.mode==="Ensemble"?ne("maskStatistic",["mean","std","median","iqr","percentile","extremes"],i.statistic||"mean",{dataKey:"maskStatistic",selectedLabel:i.statistic==="mean"?"Mean":i.statistic==="std"?"Std":i.statistic==="median"?"Median":i.statistic==="iqr"?"IQR":i.statistic==="percentile"?"Percentile":i.statistic==="extremes"?"Extremes":"Mean"}).replace('data-key="maskStatistic"',`data-key="maskStatistic" data-mask-index="${l}"`).replace('class="custom-select-wrapper"',`class="custom-select-wrapper" data-mask-index="${l}"`):n.mode==="Explore"?`
                                            ${ne("maskVariable",Le,i.variable||n.variable,{dataKey:"maskVariable",infoType:"variable"}).replace('class="custom-select-wrapper"',`class="custom-select-wrapper" data-mask-index="${l}" style="width: 140px;"`)}
                                            ${ne("maskUnit",Ue(i.variable||n.variable).map(x=>x.label),i.unit||Pe(i.variable||n.variable).label,{dataKey:"maskUnit"}).replace('class="custom-select-wrapper"',`class="custom-select-wrapper" data-mask-index="${l}" style="width: 120px;"`)}
                                          `:""}
                                <input
                                  type="number"
                                  step="any"
                                  value="${i.lowerEdited&&i.lowerBound!==null?i.lowerBound:""}"
                                  data-action="update-mask-bound"
                                  data-mask-index="${l}"
                                  data-bound="lower"
                                  placeholder="${zt(h)}"
                                  style="${g({width:"90px",background:"var(--gradient-bg)",border:"1px solid var(--border-strong)",borderRadius:8,color:"var(--text-primary)",padding:"6px 10px",fontSize:12.5,fontWeight:600,fontFamily:"var(--font-geist-sans)",letterSpacing:.25,minHeight:32,boxShadow:"inset 0 1px 0 var(--inset-light)"})}"
                                />
                                <span style="${g({fontSize:12.5,color:"var(--text-secondary)",minWidth:"20px",textAlign:"center"})}">to</span>
                                <input
                                  type="number"
                                  step="any"
                                  value="${i.upperEdited&&i.upperBound!==null?i.upperBound:""}"
                                  data-action="update-mask-bound"
                                  data-mask-index="${l}"
                                  data-bound="upper"
                                  placeholder="${zt(p)}"
                                  style="${g({width:"90px",background:"var(--gradient-bg)",border:"1px solid var(--border-strong)",borderRadius:8,color:"var(--text-primary)",padding:"6px 10px",fontSize:12.5,fontWeight:600,fontFamily:"var(--font-geist-sans)",letterSpacing:.25,minHeight:32,boxShadow:"inset 0 1px 0 var(--inset-light)"})}"
                                />
                                <button
                                  type="button"
                                  data-action="remove-mask"
                                  data-mask-index="${l}"
                                  style="${g({width:28,height:28,padding:0,borderRadius:6,border:"1px solid var(--border-medium)",background:"var(--bg-transparent)",color:"var(--text-secondary)",fontSize:16,fontWeight:600,cursor:"pointer",transition:"all 0.15s ease",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0})}"
                                  onmouseover="this.style.borderColor='var(--border-bright)'; this.style.background='var(--bg-medium)'"
                                  onmouseout="this.style.borderColor='var(--border-medium)'; this.style.background='var(--bg-transparent)'"
                                >
                                  −
                                </button>
                              </div>
                            `}).join("")}
                            <button
                              type="button"
                              data-action="add-mask"
                              style="${g({padding:"8px 14px",borderRadius:10,border:"1px solid var(--border-subtle)",background:"var(--bg-transparent)",color:"var(--text-secondary)",fontSize:12.5,fontWeight:600,cursor:"pointer",transition:"all 0.15s ease",textAlign:"left",width:"100%",marginTop:4})}"
                              onmouseover="this.style.borderColor='var(--border-medium)'; this.style.background='var(--bg-subtle)'"
                              onmouseout="this.style.borderColor='var(--border-subtle)'; this.style.background='var(--bg-transparent)'"
                            >
                              + Add Mask
                            </button>
                          </div>
                          `:`
                          <button
                            type="button"
                            data-action="add-mask"
                            style="${g({padding:"8px 14px",borderRadius:10,border:"1px solid var(--border-subtle)",background:"var(--bg-transparent)",color:"var(--text-secondary)",fontSize:12.5,fontWeight:600,cursor:"pointer",transition:"all 0.15s ease",textAlign:"left",width:"100%"})}"
                            onmouseover="this.style.borderColor='var(--border-medium)'; this.style.background='var(--bg-subtle)'"
                            onmouseout="this.style.borderColor='var(--border-subtle)'; this.style.background='var(--bg-transparent)'"
                          >
                            + Add Mask
                          </button>
                          `}
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="mode-pane-scrollable" style="${g(M.modePane)}">
          <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
            <div style="${g(M.sectionTitle)}">Parameters</div>
            <div style="${g(M.paramGrid)}">
              ${ae("Date",(()=>{const i=nn(n.ensembleScenarios.length?n.ensembleScenarios:Me);return tt("ensembleDate",n.ensembleDate,{dataKey:"ensembleDate",min:i.start,max:i.end})})())}
              ${ae("Variable",ne("ensembleVariable",Le,n.ensembleVariable,{dataKey:"ensembleVariable",infoType:"variable"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${g(M.sectionTitle)}">Statistic</div>
              ${ae("",ne("ensembleStatistic",["mean","median","std","iqr","percentile","extremes"],n.ensembleStatistic,{dataKey:"ensembleStatistic",selectedLabel:n.ensembleStatistic==="mean"?"Mean":n.ensembleStatistic==="median"?"Median":n.ensembleStatistic==="std"?"Std Deviation":n.ensembleStatistic==="iqr"?"IQR (Interquartile Range)":n.ensembleStatistic==="percentile"?"Percentile Band (90th-10th)":"Extremes (Max-Min)"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            ${o("Scenarios",n.ensembleDropdown.scenariosOpen,`${n.ensembleScenarios.length} selected`,Yt(n.metaData?.scenarios?.length?Array.from(new Set(n.metaData.scenarios.map(ut))):Me,n.ensembleScenarios,"ensembleScenarios"),"ensembleScenarios")}
          </div>

          <div style="margin-top:14px">
            ${o("Models",n.ensembleDropdown.modelsOpen,`${n.ensembleModels.length} selected`,Yt(n.metaData?.models?.length?n.metaData.models:me,n.ensembleModels,"ensembleModels"),"ensembleModels")}
          </div>

          <div style="margin-top:14px">
            <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${g(M.sectionTitle)}">Unit</div>
              ${ae("",ne("ensembleUnit",Ue(n.ensembleVariable).map(i=>i.label),n.ensembleUnit,{dataKey:"ensembleUnit"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${g(M.sectionTitle)}">Color palette</div>
              ${ae("",ne("palette",de.map(i=>i.name),n.palette,{dataKey:"palette",dataRole:"palette-selector"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${g(M.sectionTitle)}">Resolution</div>
              <div style="${g(M.resolutionRow)}">
                <input
                  type="range"
                  min="1"
                  max="3"
                  step="1"
                  value="${n.resolution}"
                  data-action="set-resolution"
                  class="resolution-slider"
                  style="${g(be(M.range,{"--slider-fill":`${a}%`}))}"
                />
                <div data-role="resolution-value" style="${g(M.resolutionValue)}">${n.resolution===1?"Low":n.resolution===2?"Medium":"High"}</div>
              </div>
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${g(M.sectionTitle)}">Mask</div>
              ${n.masks.length>0?`
                      <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
                        ${n.masks.map((i,l)=>{const c=i.variable||n.variable,d=i.unit||Pe(c).label,u=n.mode==="Explore"?Qn(c,d):null,f=n.mode==="Ensemble"?bn(i.statistic||"mean"):null,h=f?.min??u?.min??(c===n.variable?n.dataMin:null),p=f?.max??u?.max??(c===n.variable?n.dataMax:null);return`
                          ${n.mode==="Ensemble"?`
                                  <div style="${g({display:"flex",alignItems:"center",gap:8,marginBottom:4})}">
                                    ${ne("maskStatistic",["mean","std","median","iqr","percentile","extremes"],i.statistic||"mean",{dataKey:"maskStatistic",selectedLabel:i.statistic==="mean"?"Mean":i.statistic==="std"?"Std":i.statistic==="median"?"Median":i.statistic==="iqr"?"IQR":i.statistic==="percentile"?"Percentile":i.statistic==="extremes"?"Extremes":"Mean"}).replace('class="custom-select-wrapper"',`class="custom-select-wrapper" data-mask-index="${l}" style="width: 100px;"`)}
                                  </div>
                                  `:n.mode==="Explore"?`
                                  <div style="${g({display:"flex",alignItems:"center",gap:8,marginBottom:4})}">
                                    ${ne("maskVariable",Le,i.variable||n.variable,{dataKey:"maskVariable",infoType:"variable"}).replace('class="custom-select-wrapper"',`class="custom-select-wrapper" data-mask-index="${l}" style="width: 140px;"`)}
                                    ${ne("maskUnit",Ue(i.variable||n.variable).map(x=>x.label),i.unit||Pe(i.variable||n.variable).label,{dataKey:"maskUnit"}).replace('class="custom-select-wrapper"',`class="custom-select-wrapper" data-mask-index="${l}" style="width: 120px;"`)}
                                  </div>
                                  `:""}
                          <div style="${g({display:"flex",alignItems:"center",gap:8})}">
                            <input
                              type="number"
                              step="any"
                              value="${i.lowerEdited&&i.lowerBound!==null?i.lowerBound:""}"
                              data-action="update-mask-bound"
                              data-mask-index="${l}"
                              data-bound="lower"
                              placeholder="${zt(h)}"
                              style="${g({width:"90px",background:"var(--gradient-bg)",border:"1px solid var(--border-strong)",borderRadius:8,color:"var(--text-primary)",padding:"6px 10px",fontSize:12.5,fontWeight:600,fontFamily:"var(--font-geist-sans)",letterSpacing:.25,minHeight:32,boxShadow:"inset 0 1px 0 var(--inset-light)"})}"
                            />
                            <span style="${g({fontSize:12.5,color:"var(--text-secondary)",minWidth:"20px",textAlign:"center"})}">to</span>
                            <input
                              type="number"
                              step="any"
                              value="${i.upperEdited&&i.upperBound!==null?i.upperBound:""}"
                              data-action="update-mask-bound"
                              data-mask-index="${l}"
                              data-bound="upper"
                              placeholder="${zt(p)}"
                              style="${g({width:"90px",background:"var(--gradient-bg)",border:"1px solid var(--border-strong)",borderRadius:8,color:"var(--text-primary)",padding:"6px 10px",fontSize:12.5,fontWeight:600,fontFamily:"var(--font-geist-sans)",letterSpacing:.25,minHeight:32,boxShadow:"inset 0 1px 0 var(--inset-light)"})}"
                            />
                            <button
                              type="button"
                              data-action="remove-mask"
                              data-mask-index="${l}"
                              style="${g({width:28,height:28,padding:0,borderRadius:6,border:"1px solid var(--border-medium)",background:"var(--bg-transparent)",color:"var(--text-secondary)",fontSize:16,fontWeight:600,cursor:"pointer",transition:"all 0.15s ease",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0})}"
                              onmouseover="this.style.borderColor='var(--border-bright)'; this.style.background='var(--bg-medium)'"
                              onmouseout="this.style.borderColor='var(--border-medium)'; this.style.background='var(--bg-transparent)'"
                            >
                              −
                            </button>
                          </div>
                        `}).join("")}
                        <button
                          type="button"
                          data-action="apply-masks"
                          style="${g({padding:"10px 16px",borderRadius:10,border:"1px solid var(--border-strong)",background:"var(--gradient-primary)",color:"white",fontSize:12.5,fontWeight:700,cursor:"pointer",transition:"all 0.15s ease",textAlign:"center",width:"100%",marginTop:8,boxShadow:"var(--shadow-combined)"})}"
                          onmouseover="this.style.borderColor='var(--accent-border-bright)'; this.style.boxShadow='var(--shadow-elevated)'"
                          onmouseout="this.style.borderColor='var(--border-strong)'; this.style.boxShadow='var(--shadow-combined)'"
                        >
                          Apply Masks
                        </button>
                        <button
                          type="button"
                          data-action="add-mask"
                          style="${g({padding:"8px 14px",borderRadius:10,border:"1px solid var(--border-subtle)",background:"var(--bg-transparent)",color:"var(--text-secondary)",fontSize:12.5,fontWeight:600,cursor:"pointer",transition:"all 0.15s ease",textAlign:"left",width:"100%",marginTop:4})}"
                          onmouseover="this.style.borderColor='var(--border-medium)'; this.style.background='var(--bg-subtle)'"
                          onmouseout="this.style.borderColor='var(--border-subtle)'; this.style.background='var(--bg-transparent)'"
                        >
                          + Add Mask
                        </button>
                      </div>
                      `:`
                      <button
                        type="button"
                        data-action="add-mask"
                        style="${g({padding:"8px 14px",borderRadius:10,border:"1px solid var(--border-subtle)",background:"var(--bg-transparent)",color:"var(--text-secondary)",fontSize:12.5,fontWeight:600,cursor:"pointer",transition:"all 0.15s ease",textAlign:"left",width:"100%"})}"
                        onmouseover="this.style.borderColor='var(--border-medium)'; this.style.background='var(--bg-subtle)'"
                        onmouseout="this.style.borderColor='var(--border-subtle)'; this.style.background='var(--bg-transparent)'"
                      >
                        + Add Mask
                      </button>
                      `}
            </div>
          </div>
        </div>
      </div>
    </div>
  `}function Yt(e,t,a){const r=new Set(t);return`
      <div style="${g(M.chipRow)}">
        ${e.map(o=>{const s=r.has(o);return`
                  <button
                    type="button"
                    data-action="toggle-multi"
                    data-key="${a}"
                    data-value="${o}"
                    style="${g(be(M.chip,s?M.chipActive:void 0))}"
                  >
                    ${o}
                  </button>
                `}).join("")}
      </div>
    `}function Eo(){const e=n.chartLocationSearchResults.length>0?n.chartLocationSearchResults.map(r=>`
                <button
                  type="button"
                  class="location-search-result"
                  data-role="location-search-result"
                  data-name="${$e(r.displayName)}"
                  data-lat="${r.lat}"
                  data-lon="${r.lon}"
                >
                  <div class="location-search-result-name">${$e(r.displayName)}</div>
                  <div class="location-search-result-coord">
                    ${r.lat.toFixed(3)}, ${r.lon.toFixed(3)}
                  </div>
                </button>
              `).join(""):"",t=n.chartLocationSearchQuery.trim().length>0,a=n.chartLocationSearchError?`<div class="location-search-error">${$e(n.chartLocationSearchError)}</div>`:n.chartLocationSearchLoading?'<div class="location-search-status">Searching...</div>':n.chartLocationSearchResults.length===0&&t?'<div class="location-search-status">No places found. Try refining your query.</div>':"";return`
      <div class="custom-select-extra" data-role="chart-location-search">
        <div class="location-search-row">
          <input
            type="text"
            class="location-search-input"
            value="${$e(n.chartLocationSearchQuery)}"
            placeholder="Search a place (e.g. Aachen)"
            data-role="location-search-input"
          />
        </div>
        ${a}
        <div class="location-search-results" data-role="location-search-results">
          ${e||""}
        </div>
      </div>
    `}function ep(){if(n.canvasView!=="map")return"";const e=n.mapLocationSearchResults.length>0?n.mapLocationSearchResults.map(i=>`
                <button
                  type="button"
                  class="location-search-result"
                  data-role="map-location-search-result"
                  data-name="${$e(i.displayName)}"
                  data-lat="${i.lat}"
                  data-lon="${i.lon}"
                >
                  <div class="location-search-result-name">${$e(i.displayName)}</div>
                  <div class="location-search-result-coord">
                    ${i.lat.toFixed(3)}, ${i.lon.toFixed(3)}
                  </div>
                </button>
              `).join(""):"",t=n.mapLocationSearchQuery.trim().length>0,a=n.mapLocationSearchError?`<div class="location-search-error">${$e(n.mapLocationSearchError)}</div>`:n.mapLocationSearchLoading?'<div class="location-search-status">Searching...</div>':n.mapLocationSearchResults.length===0&&t&&!n.mapLocationSearchSelection?'<div class="location-search-status">No places found. Try refining your query.</div>':"",r=!!(e||a&&!n.mapLocationSearchLoading),o=n.sidebarOpen?-Ee/2:0,s=be(M.mapSearchWrap,{top:18,transform:`translateX(calc(-50% + ${o}px))`});return`
      <div data-role="map-location-search" style="${g(s)}">
        <div class="location-search-row" style="display: flex; align-items: center; gap: 8px;">
          <input
            type="text"
            class="location-search-input"
            value="${$e(n.mapLocationSearchQuery)}"
            placeholder="Search a place (e.g. Aachen)"
            data-role="map-location-search-input"
            style="flex: 1;"
          />
          <button
            type="button"
            data-action="toggle-map-draw"
            aria-label="${n.drawState.active?"Stop drawing":"Start drawing"}"
            style="
              display: flex;
              align-items: center;
              justify-content: center;
              width: 36px;
              height: 36px;
              padding: 0;
              border: 1px solid rgba(148, 163, 184, 0.3);
              border-radius: 6px;
              background: ${n.drawState.active?"rgba(52, 211, 153, 0.1)":"rgba(15, 23, 42, 0.85)"};
              color: ${n.drawState.active?"#34d399":"var(--text-secondary)"};
              cursor: pointer;
              transition: all 0.2s ease;
            "
            onmouseover="this.style.background='rgba(52, 211, 153, 0.2)';this.style.color='#34d399';"
            onmouseout="this.style.background='${n.drawState.active?"rgba(52, 211, 153, 0.1)":"rgba(15, 23, 42, 0.85)"}';this.style.color='${n.drawState.active?"#34d399":"var(--text-secondary)"}';"
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
          </button>
        </div>
        ${n.mapLocationSearchLoading?a:""}
        ${r?`
        ${n.mapLocationSearchLoading?"":a}
        <div
          class="location-search-results"
          data-role="map-location-search-results"
          style="${g(M.mapSearchResults)}"
        >
          ${e||""}
        </div>`:""}
      </div>
    `}function tp(){console.log("Rendering chart section with state:",n);const e=n.chartMode==="single"?"translateX(0%)":"translateX(100%)",t=n.metaData?.scenarios?.length?Array.from(new Set(n.metaData.scenarios.map(ut))):Me,a=n.metaData?.models?.length?n.metaData.models:me,r=nn(n.chartScenarios.length?n.chartScenarios:t),o=(l,c,d,u,f)=>`
          <div style="${g({border:"1px solid var(--border-medium)",borderRadius:12,background:"var(--bg-subtle)",padding:"10px 12px"})}">
            <button
              type="button"
              data-action="toggle-collapse"
              data-key="${f}"
              style="${g({display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",background:"transparent",border:"none",color:"var(--text-primary)",fontWeight:700,fontSize:13,cursor:"pointer",padding:0})}"
            >
              <span>${l}</span>
              <span style="${g({color:"var(--text-secondary)",fontWeight:600,fontSize:12})}">${d} ${c?"▴":"▾"}</span>
            </button>
            ${c?`<div style="${g({marginTop:10,display:"flex",flexWrap:"wrap",gap:8})}">${u}</div>`:""}
          </div>
        `,s=`
      <div style="${g(M.paramGrid)}">
        ${ae("Date",tt("chartDate",n.chartDate,{dataKey:"chartDate",min:r.start,max:r.end}))}
        ${ae("Variable",ne("chartVariable",Le,n.chartVariable,{dataKey:"chartVariable",infoType:"variable"}))}
      </div>
    
      <div style="margin-top:10px">
        ${ae("Location",ne("chartLocation",["World","Draw","Point"],n.chartLocation,{dataKey:"chartLocation",selectedLabel:n.chartLocation==="Search"&&n.chartLocationName?`Search: ${n.chartLocationName}`:n.chartLocation,extraContent:Eo()}))}
      </div>

      <div style="margin-top:14px">
        ${o("Scenarios",n.chartDropdown.scenariosOpen,`${n.chartScenarios.length} selected`,Yt(t,n.chartScenarios,"chartScenarios"),"chartScenarios")}
      </div>

      <div style="margin-top:14px">
        ${o("Models",n.chartDropdown.modelsOpen,`${n.chartModels.length} selected`,Yt(a,n.chartModels,"chartModels"),"chartModels")}
      </div>

      <div style="margin-top:14px">
        <div style="${g(M.sectionTitle)}">Unit</div>
        ${ae("",ne("chartUnit",Ue(n.chartVariable).map(l=>l.label),n.chartUnit,{dataKey:"chartUnit"}))}
      </div>
    `,i=`
      <div style="${g(M.paramGrid)}">
        ${ae("Start date",tt("chartRangeStart",n.chartRangeStart,{dataKey:"chartRangeStart",min:r.start,max:r.end}))}
        ${ae("End date",tt("chartRangeEnd",n.chartRangeEnd,{dataKey:"chartRangeEnd",min:r.start,max:r.end}))}
      </div>

      <div style="${g(be(M.paramGrid,{marginTop:12}))}">
        ${ae("Variable",ne("chartVariable",Le,n.chartVariable,{dataKey:"chartVariable",infoType:"variable"}))}
      </div>

      <div style="margin-top:10px">
        ${ae("Location",ne("chartLocation",["World","Draw","Point"],n.chartLocation,{dataKey:"chartLocation",selectedLabel:n.chartLocation==="Search"&&n.chartLocationName?`Search: ${n.chartLocationName}`:n.chartLocation,extraContent:Eo()}))}
      </div>

      <div style="margin-top:14px">
        ${o("Scenarios",n.chartDropdown.scenariosOpen,`${n.chartScenarios.length} selected`,Yt(t,n.chartScenarios,"chartScenarios"),"chartScenarios")}
      </div>

      <div style="margin-top:14px">
        ${o("Models",n.chartDropdown.modelsOpen,`${n.chartModels.length} selected`,Yt(a,n.chartModels,"chartModels"),"chartModels")}
      </div>

      <div style="margin-top:14px">
        <div style="${g(M.sectionTitle)}">Unit</div>
        ${ae("",ne("chartUnit",Ue(n.chartVariable).map(l=>l.label),n.chartUnit,{dataKey:"chartUnit"}))}
      </div>
    `;return`
      <div style="${g(M.modeSwitch)}">
        <div data-role="chart-mode-indicator" style="${g({...M.modeIndicator,transform:e})}"></div>
        ${["single","range"].map(l=>{const c=l==="single"?"Single dates":"Range";return`
              <button
                type="button"
                class="mode-btn"
                data-action="set-chart-mode"
                data-value="${l}"
                style="${g(be(M.modeBtn,n.chartMode===l?M.modeBtnActive:void 0))}"
              >
                ${c}
              </button>
            `}).join("")}
      </div>

      <div class="mode-pane-scrollable" style="${g(M.modePane)}">
        ${n.chartMode==="single"?s:i}
      </div>
    `}function np(){return`
    <div data-role="chat-section" style="${g({display:"flex",flexDirection:"column",gap:8})}">
      <div style="${g(M.sectionTitle)}">Chat</div>
      ${Pf(n.chatMessages,n.chatInput)}
    </div>
  `}function Ro(e,t,a){const r=Math.hypot(e,t);if(!r||!isFinite(r)||a<=0)return{x:0,y:0};const o=Math.min(1,a/r);return{x:e*o,y:t*o}}function ap(e){Fn&&(Fn(),Fn=null),wt!==null&&(cancelAnimationFrame(wt),wt=null),ft!==null&&(cancelAnimationFrame(ft),ft=null),St!==null&&(clearTimeout(St),St=null),Ze!==null&&(clearTimeout(Ze),Ze=null);const t=e.querySelector('[data-role="brand-eye"]');if(!t)return;let a={x:0,y:0},r={x:0,y:0},o={x:0,y:0},s={x:0,y:0},i=1,l=!1;const c=3e4,d=(v,L)=>{const R=t.getBoundingClientRect(),$=R.left+R.width/2,D=R.top+R.height/2,F=v-$,N=L-D,j=Math.min(R.width,R.height)*.14,O=j*.6;a=Ro(F,N,j),r=Ro(F,N,O)},u=v=>{i=Math.max(0,Math.min(1,v)),t.style.setProperty("--blink-open",`${i}`)},f=()=>{Ze!==null&&clearTimeout(Ze),Ze=window.setTimeout(()=>{a={x:0,y:0},r={x:0,y:0}},c)},h=()=>{o.x+=(a.x-o.x)*.28,o.y+=(a.y-o.y)*.28,s.x+=(r.x-s.x)*.32,s.y+=(r.y-s.y)*.32,t.style.setProperty("--iris-x",`${o.x}px`),t.style.setProperty("--iris-y",`${o.y}px`),t.style.setProperty("--pupil-x",`${s.x}px`),t.style.setProperty("--pupil-y",`${s.y}px`),wt=requestAnimationFrame(h)},p=()=>{if(l)return;l=!0;const v=[{t:0,v:1},{t:.16,v:.08},{t:.26,v:.02},{t:.4,v:1}],L=350,R=performance.now(),$=D=>{const F=D-R,N=Math.min(1,F/L);let X=v[0],j=v[v.length-1];for(let B=0;B<v.length-1;B++){const E=v[B],m=v[B+1];if(N>=E.t&&N<=m.t){X=E,j=m;break}}const O=j.t-X.t||1,Q=Math.min(1,Math.max(0,(N-X.t)/O)),Y=1-Math.pow(1-Q,2),y=X.v+(j.v-X.v)*Y;u(y),N<1?ft=requestAnimationFrame($):(u(1),l=!1,x())};ft=requestAnimationFrame($)},x=()=>{const v=3e3+Math.random()*15e3;St=window.setTimeout(p,v)},T=()=>{const v=t.getBoundingClientRect();d(v.left+v.width/2,v.top+v.height/2)},k=v=>{d(v.clientX,v.clientY),f()},w=()=>T();T(),h(),x(),f(),window.addEventListener("pointermove",k),window.addEventListener("pointerleave",w),Fn=()=>{window.removeEventListener("pointermove",k),window.removeEventListener("pointerleave",w),wt!==null&&(cancelAnimationFrame(wt),wt=null),ft!==null&&(cancelAnimationFrame(ft),ft=null),St!==null&&(clearTimeout(St),St=null),Ze!==null&&(clearTimeout(Ze),Ze=null)}}function rp(e){if(!ee)return;const t=ee;ap(t),t.querySelectorAll('[data-action="update-mask-bound"]').forEach(m=>{m.__isMaskInput=!0;const b=S=>{S&&(S.stopPropagation(),S.preventDefault(),S.stopImmediatePropagation());const _=m.dataset.bound,U=m.dataset.maskIndex;if(!_||U===void 0)return;const I=Number.parseInt(U,10);if(Number.isNaN(I)||I<0||I>=n.masks.length)return;const C=m.value.trim(),V=C===""?null:Number.parseFloat(C);if(C===""||!Number.isNaN(V)){const K=n.masks[I];let Z=!1;_==="lower"?K.lowerBound!==V&&(K.lowerBound=V,K.lowerEdited=C!=="",Z=!0):K.upperBound!==V&&(K.upperBound=V,K.upperEdited=C!=="",Z=!0),Z&&(n.__updatingMask=!0,q(),setTimeout(()=>{n.__updatingMask=!1},0))}};m.addEventListener("blur",S=>{b(S)},{capture:!0}),m.addEventListener("keydown",S=>{S.key==="Enter"&&(S.preventDefault(),S.stopPropagation(),S.stopImmediatePropagation(),b(S),m.blur())},{capture:!0})}),Af({root:t,getSidebarOpen:()=>n.sidebarOpen,setSidebarOpen:m=>{n.sidebarOpen=m},onTimeSliderUpdate:m=>{hh(m,Ee)},onCanvasToggleUpdate:m=>{const b=n.sidebarOpen?1:.9;Ei(m+8,b),_i()}}),t.querySelectorAll('[data-action="set-canvas"]').forEach(m=>m.addEventListener("click",()=>{const b=m.dataset.value;if(b){if(b===n.canvasView)return;const _=n.canvasView==="map"?"translateX(0%)":"translateX(100%)",U=b==="map"?"translateX(0%)":"translateX(100%)";n.canvasView=b,b==="chart"&&(n.panelTab="Manual");const I=et();I.active&&I.currentStep===13&&b==="chart"&&Dt(),q(),b==="map"?Ce():Ye();const C=t.querySelector('[data-role="canvas-indicator"]');if(!C)return;C.style.removeProperty("transition"),C.style.transform=_,C.offsetHeight,C.getBoundingClientRect(),requestAnimationFrame(()=>{C.style.transition="transform 180ms ease",C.style.transform=U})}})),t.querySelectorAll('[data-action="set-mode"]').forEach(m=>m.addEventListener("click",()=>{const b=m.dataset.value;if(b){if(b===n.mode)return;const S=n.mode,_=S==="Explore"?"translateX(0%)":S==="Compare"?"translateX(-33.333%)":"translateX(-66.666%)",U=S==="Explore"?"translateX(0%)":S==="Compare"?"translateX(100%)":"translateX(200%)",I=b==="Explore"?"translateX(0%)":b==="Compare"?"translateX(-33.333%)":"translateX(-66.666%)",C=b==="Explore"?"translateX(0%)":b==="Compare"?"translateX(100%)":"translateX(200%)";n.mode=b;const V=et();V.active&&V.currentStep===9&&b==="Compare"&&Dt(),q();const K=t.querySelector('[data-role="mode-track"]'),Z=t.querySelector('[data-role="mode-indicator"]');if(!K||!Z)return;K.style.transition="none",Z.style.transition="none",K.style.transform=_,Z.style.transform=U,K.offsetHeight,K.style.transition="transform 220ms ease",Z.style.transition="transform 200ms ease",K.style.transform=I,Z.style.transform=C}n.canvasView==="map"&&Ce()})),t.querySelectorAll('[data-action="set-chart-mode"]').forEach(m=>m.addEventListener("click",()=>{const b=m.dataset.value;if(!b||b===n.chartMode)return;const _=n.chartMode==="single"?"translateX(0%)":"translateX(100%)",U=b==="single"?"translateX(0%)":"translateX(100%)";n.chartMode=b,q();const I=t.querySelector('[data-role="chart-mode-indicator"]');I&&(I.style.removeProperty("transition"),I.style.transform=_,I.offsetHeight,requestAnimationFrame(()=>{I.style.transition="transform 200ms ease",I.style.transform=U})),n.canvasView==="chart"&&Ye()})),t.querySelectorAll('[data-action="set-tab"]').forEach(m=>m.addEventListener("click",()=>{const b=m.dataset.value;if(b){if(b===n.panelTab)return;const _=n.panelTab==="Manual"?"translateX(0%)":"translateX(-50%)",U=b==="Manual"?"translateX(0%)":"translateX(-50%)";n.panelTab=b;const I=et();I.active&&I.currentStep===11&&b==="Chat"&&Dt(),q();const C=t.querySelector('[data-role="tab-track"]');if(!C)return;C.style.removeProperty("transition"),C.style.transform=_,C.offsetHeight,C.getBoundingClientRect(),requestAnimationFrame(()=>{C.style.transition="transform 220ms ease",C.style.transform=U})}}));const l=t.querySelectorAll(".custom-select-wrapper");let c=document.querySelector(".custom-select-info-panel-shared");c||(c=document.createElement("div"),c.className="custom-select-info-panel custom-select-info-panel-shared",c.setAttribute("role","tooltip"),document.body.appendChild(c));const d=m=>{m.target.closest(".custom-select-wrapper")||(l.forEach(S=>{S.classList.remove("open")}),c&&c.classList.remove("visible"))},u=m=>{m.key==="Escape"&&(l.forEach(b=>{b.classList.remove("open")}),c&&c.classList.remove("visible"))};document.addEventListener("click",d),document.addEventListener("keydown",u),l.forEach(m=>{const b=m.querySelector(".custom-select-trigger"),S=m.querySelector(".custom-select-dropdown"),_=m.querySelectorAll(".custom-select-option"),U=m.dataset.key,I=m.dataset.infoType,C=m.dataset.disabled==="true";if(!b||!S||C)return;const V=c,K=(H,P)=>{if(!V||!I)return;let z="",G=H;if(I==="scenario"?z=gh[H]||"":I==="variable"?(z=vh[H]||"",G=yh[H]||H):I==="model"&&(z=bh[H]||""),z){if(V.innerHTML=`
                    <div class="custom-select-info-panel-title">${G}</div>
                    <div class="custom-select-info-panel-content">${z}</div>
                `,P||b){const A=P||b;if(A){const ie=A.getBoundingClientRect();V.style.left=`${ie.left-272}px`,V.style.top=`${ie.top}px`}}V.classList.add("visible")}},Z=()=>{V&&V.classList.remove("visible")};b.addEventListener("click",H=>{if(H.stopPropagation(),C)return;const P=m.classList.contains("open");l.forEach(G=>{G!==m&&G.classList.remove("open")}),m.classList.toggle("open",!P),et().active&&setTimeout(()=>{q()},50)}),b.addEventListener("keydown",H=>{if(!C&&(H.key==="Enter"||H.key===" "||H.key==="ArrowDown")){H.preventDefault(),m.classList.add("open");const P=_[0];P&&P.focus()}}),_.forEach(H=>{H.addEventListener("click",P=>{P.stopPropagation();const z=H.dataset.value;if(!z||!U)return;_.forEach(re=>{re.classList.remove("selected"),re.removeAttribute("aria-selected")}),H.classList.add("selected"),H.setAttribute("aria-selected","true");const G=b.querySelector(".custom-select-value");G&&(G.textContent=z),m.classList.remove("open"),Z();const A=m.dataset.maskIndex;f(U,z,A);const ie=et();ie.active&&{1:"scenario",2:"model",4:"variable",5:"unit",6:"palette"}[ie.currentStep]===U&&setTimeout(()=>{Dt(),q()},100)}),I&&(H.addEventListener("mouseenter",()=>{const P=H.dataset.value;P&&K(P,H)}),H.addEventListener("mouseleave",()=>{Z()})),H.addEventListener("keydown",P=>{const z=Array.from(_).indexOf(H);if(P.key==="Enter"||P.key===" ")P.preventDefault(),H.click();else if(P.key==="ArrowDown"){P.preventDefault();const G=(z+1)%_.length;_[G]?.focus()}else if(P.key==="ArrowUp"){P.preventDefault();const G=z===0?_.length-1:z-1;_[G]?.focus()}else P.key==="Escape"?(P.preventDefault(),m.classList.remove("open"),Z(),b.focus()):P.key==="Home"?(P.preventDefault(),_[0]?.focus()):P.key==="End"&&(P.preventDefault(),_[_.length-1]?.focus())})}),new MutationObserver(H=>{H.forEach(P=>{P.type==="attributes"&&P.attributeName==="class"&&(m.classList.contains("open")||Z())})}).observe(m,{attributes:!0})});const f=async(m,b,S)=>{if(!m)return;let _=!1,U=!1;switch(m){case"scenario":n.scenario=b,n.date=$h(b),n.ensembleDate=n.date,n.timeRange=Ne(b),_=!0;break;case"model":n.model=b,_=!0;break;case"variable":n.variable=b,n.selectedUnit=Pe(b).label,_=!0;break;case"unit":if(n.selectedUnit=b,q(),n.currentData&&ee&&n.dataMin!==null&&n.dataMax!==null){const C=ee.querySelector("#map-canvas");if(C)try{Se=C,pa(C),Gn(n.currentData,Se,de,n.palette,n.dataMin,n.dataMax,n.variable,n.selectedUnit,n.masks,null,!1,n.mode==="Explore"?n.maskVariableData:void 0);const V=de.find(K=>K.name===n.palette)||de[0];Yn("legend-gradient-canvas",V.colors)}catch(V){console.error("Map redraw (unit change) failed:",V)}}if(n.mapMarker){if(n.mapInfoOpen)if(n.mapInfoSamples.length){const{variable:C,unit:V}=je();n.mapInfoBoxes=Gt(n.mapInfoSamples,C,V),q()}else n.mapInfoLoading||Tt();if(n.mapRangeOpen)if(n.mapRangeSamples.length){const{variable:C,unit:V}=Nt();n.mapRangeSeries=vt(n.mapRangeSamples,C,V),q()}else n.mapRangeLoading||mn()}return;case"palette":if(n.palette=b,q(),n.canvasView==="map"&&n.currentData&&ee&&n.dataMin!==null&&n.dataMax!==null){const C=ee.querySelector("#map-canvas");if(C){Se=C,Gn(n.currentData,Se,de,n.palette,n.dataMin,n.dataMax,n.variable,n.selectedUnit,n.masks,null,!1,n.mode==="Explore"?n.maskVariableData:void 0);const V=de.find(K=>K.name===n.palette)||de[0];Yn("legend-gradient-canvas",V.colors)}}return;case"compareMode":n.compareMode=b,_=!0;break;case"compareScenarioA":b===n.compareScenarioB&&(n.compareScenarioB=n.compareScenarioA),n.compareScenarioA=b,_=!0;break;case"compareScenarioB":b===n.compareScenarioA&&(n.compareScenarioA=n.compareScenarioB),n.compareScenarioB=b,_=!0;break;case"compareModelA":b===n.compareModelB&&(n.compareModelB=n.compareModelA),n.compareModelA=b,_=!0;break;case"compareModelB":b===n.compareModelA&&(n.compareModelA=n.compareModelB),n.compareModelB=b,_=!0;break;case"chartVariable":n.chartVariable=b,n.chartUnit=Pe(b).label,U=!0;break;case"chartUnit":n.chartUnit=b,n.chartSamples.length&&(n.chartMode==="range"?(n.chartRangeSeries=vt(n.chartSamples,n.chartVariable,n.chartUnit),n.chartBoxes=null):n.chartBoxes=Gt(n.chartSamples,n.chartVariable,n.chartUnit)),q();return;case"ensembleVariable":n.ensembleVariable=b,n.ensembleUnit=Pe(b).label,_=!0;break;case"ensembleUnit":if(n.ensembleUnit=b,q(),n.currentData&&ee&&n.dataMin!==null&&n.dataMax!==null&&n.mode==="Ensemble"){const C=ee.querySelector("#map-canvas");if(C){Se=C,pa(C),Gn(n.currentData,Se,de,n.palette,n.dataMin,n.dataMax,n.ensembleVariable,n.ensembleUnit,n.masks,n.ensembleStatistics,!0);const V=de.find(K=>K.name===n.palette)||de[0];Yn("legend-gradient-canvas",V.colors)}}if(n.mapMarker&&n.mapInfoOpen)if(n.mapInfoSamples.length){const{variable:C,unit:V}=je();n.mapInfoBoxes=Gt(n.mapInfoSamples,C,V),q()}else n.mapInfoLoading||Tt();if(n.mapRangeOpen)if(n.mapRangeSamples.length){const{variable:C,unit:V}=Nt();n.mapRangeSeries=vt(n.mapRangeSamples,C,V),q()}else n.mapRangeLoading||mn();return;case"ensembleStatistic":n.ensembleStatistic=b,_=!0;break;case"maskStatistic":{if(S!==void 0){const C=Number.parseInt(S,10);if(!Number.isNaN(C)&&C>=0&&C<n.masks.length){const V=b,K=n.masks[C];if(K.statistic=V,n.mode==="Ensemble"){const Z=bn(V);K.lowerBound=Z.min,K.upperBound=Z.max,K.lowerEdited=!1,K.upperEdited=!1}q()}}return}case"maskVariable":{if(S!==void 0){const C=Number.parseInt(S,10);if(!Number.isNaN(C)&&C>=0&&C<n.masks.length){const V=n.masks[C];V.variable=b,V.unit=Pe(b).label,V.lowerBound=null,V.upperBound=null,V.lowerEdited=!1,V.upperEdited=!1,q(),n.mode==="Explore"&&n.canvasView==="map"&&(Ce(),q())}}return}case"maskUnit":{if(S!==void 0){const C=Number.parseInt(S,10);!Number.isNaN(C)&&C>=0&&C<n.masks.length&&(n.masks[C].unit=b,q())}return}case"chartLocation":if(b==="Draw"){$o();return}if(b==="Point"){ko();return}if(b==="Search"){n.chartLocation="Search",n.chartPolygon=null,n.pointSelectActive=!1,n.drawState=xt(),n.chartError=null,n.chartLocationName=null,n.chartLocationSearchError=null,n.chartLocationSearchResults=[],n.chartLocationSearchQuery="",n.chartLocationSearchLoading=!1,n.canvasView="chart",ga(),ya(),q();return}n.chartLocation="World",n.chartPolygon=null,n.chartPoint=null,n.chartLocationName=null,n.chartLocationSearchError=null,n.chartLocationSearchResults=[],n.chartLocationSearchQuery="",n.chartLocationSearchLoading=!1,ga(),ya(),U=!0;break}const I=()=>{if(q(),n.canvasView==="map"&&_){Ce();const C=n.mapMarker!==null,V=n.mapPolygon!==null&&n.mapPolygon.length>=3;(C||V)&&n.mapInfoOpen&&Tt(),C&&n.mapRangeOpen&&mn()}n.canvasView==="chart"&&(U||_)&&Ye()};_||U?setTimeout(I,0):I()},h=t.querySelector('.custom-select-wrapper[data-key="chartLocation"]');if(h){let m=function(){const C=ee?.querySelector('.custom-select-wrapper[data-key="chartLocation"]');if(!C)return;const V=C.querySelector('[data-role="location-search-input"]');V&&(V.value=n.chartLocationSearchQuery);const K=C.querySelector('[data-role="location-search-results-container"]');if(K){if(K.innerHTML="",n.chartLocationSearchLoading)K.innerHTML='<div class="search-loading">Loading...</div>';else if(n.chartLocationSearchError)K.innerHTML=`<div class="search-error">${n.chartLocationSearchError}</div>`;else if(n.chartLocationSearchResults.length>0)for(const Z of n.chartLocationSearchResults){const W=document.createElement("div");W.className="custom-select-option search-result",W.setAttribute("data-role","location-search-result"),W.setAttribute("data-lat",String(Z.lat)),W.setAttribute("data-lon",String(Z.lon)),W.setAttribute("data-name",Z.displayName||"Selected place"),W.textContent=Z.displayName||`${Z.lat}, ${Z.lon}`,W.addEventListener("click",()=>{C.classList.remove("open"),Do({displayName:Z.displayName||"Selected place",lat:Z.lat,lon:Z.lon})}),K.appendChild(W)}}};h.querySelectorAll(".custom-select-option").forEach(C=>{C.addEventListener("click",()=>{const V=C.dataset.value;V==="Draw"&&n.chartLocation==="Draw"?$o():V==="Point"&&n.chartLocation==="Point"&&ko()})});const S=h.querySelectorAll('[data-role="location-search-input"]'),_=h.querySelectorAll('[data-role="location-search-result"]'),U=()=>{Et!==null&&(window.clearTimeout(Et),Et=null)},I=C=>{U(),Ih(C)};if(S.forEach(C=>{C.addEventListener("input",()=>{const V=n.chartLocationSearchResults.length>0,K=n.chartLocationSearchLoading,Z=!!n.chartLocationSearchError;if(n.chartLocationSearchQuery=C.value,n.chartLocationSearchError=null,U(),!C.value.trim()){n.chartLocationSearchResults=[],n.chartLocationSearchLoading=!1,m();return}(V||K||Z)&&(n.chartLocationSearchResults=[],n.chartLocationSearchLoading=!1,m()),Et=window.setTimeout(()=>{I(C.value)},wo)}),C.addEventListener("keydown",V=>{V.key==="Enter"&&(V.preventDefault(),U(),I(C.value))})}),_.forEach(C=>{C.addEventListener("click",()=>{const V=Number(C.dataset.lat),K=Number(C.dataset.lon),Z=C.dataset.name??"Selected place";!Number.isFinite(V)||!Number.isFinite(K)||(h.classList.remove("open"),Do({displayName:Z,lat:V,lon:K}))})}),n.chartLocation==="Search"){const C=h.querySelector('[data-role="location-search-input"]');C&&setTimeout(()=>C.focus(),0)}}const p=t.querySelectorAll('[data-role="map-location-search-input"]'),x=t.querySelectorAll('[data-role="map-location-search-result"]'),T=()=>{Rt!==null&&(window.clearTimeout(Rt),Rt=null)},k=m=>{T(),Nh(m)};if(p.forEach(m=>{m.addEventListener("focus",()=>{n.mapLocationSearchFocused=!0});const b=()=>{const S=m.selectionStart??m.value.length,_=m.selectionEnd??m.value.length;n.mapLocationSearchCursor={start:S,end:_}};m.addEventListener("input",()=>{const S=n.mapLocationSearchResults.length>0,_=n.mapLocationSearchLoading,U=!!n.mapLocationSearchError;if(n.mapLocationSearchQuery=m.value,n.mapLocationSearchError=null,n.mapLocationSearchSelection=null,n.mapLocationSearchFocused=!0,b(),T(),!m.value.trim()){n.mapLocationSearchResults=[],n.mapLocationSearchLoading=!1,q();return}(S||_||U)&&(n.mapLocationSearchResults=[],n.mapLocationSearchLoading=!1,q()),Rt=window.setTimeout(()=>{k(m.value)},wo)}),m.addEventListener("keyup",b),m.addEventListener("click",b),m.addEventListener("select",b),m.addEventListener("keydown",S=>{S.key==="Enter"&&(S.preventDefault(),T(),k(m.value))})}),x.forEach(m=>{m.addEventListener("click",()=>{const b=Number(m.dataset.lat),S=Number(m.dataset.lon),_=m.dataset.name??"Selected place";!Number.isFinite(b)||!Number.isFinite(S)||Ah({displayName:_,lat:b,lon:S})})}),n.mapLocationSearchFocused){const m=t.querySelector('[data-role="map-location-search-input"]');if(m){setTimeout(()=>m.focus(),0);const{start:b,end:S}=n.mapLocationSearchCursor,_=Math.min(b,m.value.length),U=Math.min(S,m.value.length);setTimeout(()=>m.setSelectionRange(_,U),0)}}t.querySelectorAll('select[data-action="update-select"]').forEach(m=>m.addEventListener("change",async()=>{const b=m.dataset.key,S=m.value;b&&await f(b,S)})),t.querySelectorAll('[data-action="toggle-multi"]').forEach(m=>m.addEventListener("click",()=>{const b=m.dataset.key,S=m.dataset.value;if(!(!b||!S)){if(b==="chartScenarios"){const _=n.metaData?.scenarios?.length&&n.metaData.scenarios?Array.from(new Set(n.metaData.scenarios.map(ut))):Me,U=S==="Historical",I=new Set(n.chartScenarios);I.has(S)?I.delete(S):U?(I.clear(),I.add("Historical")):(I.delete("Historical"),I.add(S)),I.size===0&&I.add(U?"Historical":S),n.chartScenarios=Array.from(I).filter(V=>_.includes(V));const C=nn(n.chartScenarios);n.chartDate=ve(n.chartDate,C),n.chartRangeStart=ve(n.chartRangeStart,C),n.chartRangeEnd=ve(n.chartRangeEnd,C)}if(b==="chartModels"){const _=n.metaData?.models?.length&&n.metaData.models?n.metaData.models:me,U=new Set(n.chartModels);U.has(S)?U.delete(S):U.add(S),n.chartModels=U.size?Array.from(U):[..._]}if(b==="ensembleScenarios"){const _=n.metaData?.scenarios?.length&&n.metaData.scenarios?Array.from(new Set(n.metaData.scenarios.map(ut))):Me,U=S==="Historical",I=new Set(n.ensembleScenarios);I.has(S)?I.delete(S):U?(I.clear(),I.add("Historical")):(I.delete("Historical"),I.add(S)),I.size===0&&I.add(U?"Historical":S),n.ensembleScenarios=Array.from(I).filter(V=>_.includes(V));const C=nn(n.ensembleScenarios);n.ensembleDate=ve(n.ensembleDate,C)}if(b==="ensembleModels"){const _=n.metaData?.models?.length?n.metaData.models:me,U=new Set(n.ensembleModels);U.has(S)?U.delete(S):U.add(S),n.ensembleModels=U.size?Array.from(U):[..._]}q(),n.canvasView==="chart"?Ye():n.canvasView==="map"&&n.mode==="Ensemble"&&Ce()}})),t.querySelectorAll('[data-action="toggle-collapse"]').forEach(m=>m.addEventListener("click",()=>{const b=m.dataset.key;b&&(b==="chartScenarios"&&(n.chartDropdown.scenariosOpen=!n.chartDropdown.scenariosOpen),b==="chartModels"&&(n.chartDropdown.modelsOpen=!n.chartDropdown.modelsOpen),b==="ensembleScenarios"&&(n.ensembleDropdown.scenariosOpen=!n.ensembleDropdown.scenariosOpen),b==="ensembleModels"&&(n.ensembleDropdown.modelsOpen=!n.ensembleDropdown.modelsOpen),q())})),t.querySelectorAll('[data-action="update-input"]').forEach(m=>{let b=!1,S=null;const _=()=>{const I=m.value;!(/^\d{4}-\d{2}-\d{2}$/.test(I)&&!isNaN(new Date(I).getTime()))&&I.length>0?m.style.borderColor="rgba(239, 68, 68, 0.6)":m.style.borderColor=""},U=()=>{const I=m.dataset.key;if(!I)return;const C=m.value;if(!(/^\d{4}-\d{2}-\d{2}$/.test(C)&&!isNaN(new Date(C).getTime()))){const z=I==="date"?n.date:I==="compareDateStart"?n.compareDateStart:I==="compareDateEnd"?n.compareDateEnd:I==="chartRangeStart"?n.chartRangeStart:I==="chartRangeEnd"?n.chartRangeEnd:n.chartDate;m.value=z,m.style.borderColor="";return}m.style.borderColor="";let W=C;if(I==="date"&&(W=Ct(C,n.scenario),W!==C&&(m.value=W)),(I==="date"?n.date:I==="compareDateStart"?n.compareDateStart:I==="compareDateEnd"?n.compareDateEnd:I==="chartRangeStart"?n.chartRangeStart:I==="chartRangeEnd"?n.chartRangeEnd:n.chartDate)===W)return;switch(I){case"date":n.date=W,n.ensembleDate=W;break;case"compareDateStart":n.compareDateStart=C;break;case"compareDateEnd":n.compareDateEnd=C;break;case"chartDate":n.chartDate=C;break;case"chartRangeStart":n.chartRangeStart=C;break;case"chartRangeEnd":n.chartRangeEnd=C;break;case"ensembleDate":n.ensembleDate=C;break}const P=et();if(I==="date"&&P.active&&P.currentStep===3&&setTimeout(()=>{Dt(),q()},100),q(),I==="date"||n.mode==="Compare"&&(I==="compareDateStart"||I==="compareDateEnd")||n.mode==="Ensemble"&&I==="ensembleDate"){Ce();const z=n.mapMarker!==null,G=n.mapPolygon!==null&&n.mapPolygon.length>=3;(z||G)&&n.mapInfoOpen&&Tt()}n.canvasView==="chart"&&(I==="chartDate"||I==="chartRangeStart"||I==="chartRangeEnd")&&Ye()};m.addEventListener("input",()=>{b=!0,_(),S!==null&&window.clearTimeout(S),S=window.setTimeout(()=>{b=!1},300)}),m.addEventListener("blur",I=>{I.target.__isMaskInput||(b=!1,S!==null&&(window.clearTimeout(S),S=null),U())}),m.addEventListener("keydown",I=>{I.key==="Enter"&&(I.preventDefault(),b=!1,S!==null&&(window.clearTimeout(S),S=null),U(),m.blur())}),m.addEventListener("change",()=>{b||U()})});const $=t.querySelectorAll('[data-action="set-resolution"]'),D=t.querySelectorAll('[data-role="resolution-value"]'),F=m=>{const b=(m-1)/2*100,S=m===1?"Low":m===2?"Medium":"High";$.forEach(_=>{_.value=String(m),_.style.setProperty("--slider-fill",`${b}%`)}),D.forEach(_=>{_.textContent=S})};$.forEach(m=>m.addEventListener("input",()=>{const b=Number.parseInt(m.value,10);Number.isNaN(b)||(n.resolution=b,F(b),n.canvasView==="map"&&Ce())})),t.querySelectorAll('[data-action="add-mask"]').forEach(m=>{m.addEventListener("click",()=>{let b=n.dataMin,S=n.dataMax;if(n.mode==="Explore"){const U=Qn(n.variable,n.selectedUnit);U&&(b=U.min,S=U.max)}const _={lowerBound:b,upperBound:S,lowerEdited:!1,upperEdited:!1};n.mode==="Ensemble"&&(_.statistic="mean"),n.mode==="Explore"&&(_.variable=n.variable,_.unit=n.selectedUnit),n.masks.push(_),q()})}),t.querySelectorAll('[data-action="remove-mask"]').forEach(m=>{m.addEventListener("click",()=>{const b=m.dataset.maskIndex;if(b===void 0)return;const S=Number.parseInt(b,10);!Number.isNaN(S)&&S>=0&&S<n.masks.length&&(n.masks.splice(S,1),q())})}),t.querySelector('[data-action="apply-masks"]')?.addEventListener("click",()=>{n.canvasView==="map"&&Ce()}),t.querySelector('[data-action="open-compare-info"]')?.addEventListener("click",()=>{n.compareInfoOpen=!0,q()}),t.querySelectorAll('[data-action="close-compare-info"]').forEach(m=>m.addEventListener("click",()=>{n.compareInfoOpen=!1,q()})),t.querySelector('[data-action="close-map-info"]')?.addEventListener("click",m=>{m.preventDefault(),Uh()}),t.querySelector('[data-action="close-map-range"]')?.addEventListener("click",m=>{m.preventDefault(),Ir()}),t.querySelector('[data-action="open-map-info-chart"]')?.addEventListener("click",m=>{if(m.preventDefault(),!n.mapMarker&&!n.mapPolygon)return;n.canvasView="chart",n.chartMode="single",n.mapPolygon&&n.mapPolygon.length>=3?(n.chartLocation="Draw",n.chartPolygon=n.mapPolygon,n.chartPoint=null,n.chartLocationName=null):n.mapMarker&&(n.chartLocation="Point",n.chartPoint={lat:n.mapMarker.lat,lon:n.mapMarker.lon},n.chartLocationName=n.mapMarker.name??null,n.chartPolygon=null);const{variable:b,unit:S}=je();n.chartVariable=b,n.chartUnit=S,n.chartDate=n.mode==="Ensemble"?n.ensembleDate:n.date,n.chartError=null,q(),Ye()}),t.querySelector('[data-action="toggle-map-draw"]')?.addEventListener("click",m=>{m.preventDefault(),n.drawState.active?Ph():Ch()}),fh({root:t,getTimeRange:()=>n.timeRange,onDateChange:m=>{n.date=m,n.ensembleDate=m,Ce();const b=n.mapMarker!==null,S=n.mapPolygon!==null&&n.mapPolygon.length>=3;(b||S)&&n.mapInfoOpen&&Tt(),b&&n.mapRangeOpen&&mn()},getMode:()=>n.mode,getCompareMode:()=>n.compareMode,getCompareDates:()=>({start:n.compareDateStart,end:n.compareDateEnd}),onDateRangeChange:(m,b)=>{n.compareDateStart=m,n.compareDateEnd=b,Ce()}}),_f(t,n)}async function Co(){if(ee=document.querySelector("#app"),!ee)throw new Error("Root element #app not found");Ef(e=>{Object.assign(n,e),q(),n.canvasView==="map"&&(e.date||e.model||e.scenario||e.variable)?Ce():n.canvasView==="map"&&e.palette&&n.currentData&&q(),n.canvasView==="chart"&&(e.chartDate||e.chartRangeStart||e.chartRangeEnd)&&Ye()}),q(),Mh().then(()=>{q()}),n.canvasView==="map"&&n.mode==="Explore"&&Ce(),ee.addEventListener("click",e=>{const t=e.target,a=t.closest("[data-action]"),r=a?.getAttribute("data-action");if(r==="tutorial-continue"){e.preventDefault(),e.stopPropagation();const o=et(),s=Rn[o.currentStep]?.id??"";if(s==="compare-switch"){const i=document.querySelector('[data-action="set-mode"][data-value="Compare"]');if(i){i.click();return}}if(s==="chat-switch"){const i=document.querySelector('[data-action="set-tab"][data-value="Chat"]');if(i){i.click();return}}if(s==="analysis-switch"){const i=document.querySelector('[data-action="set-canvas"][data-value="chart"]');if(i){i.click();return}}Dt(),q();return}if(r==="close-tutorial"){e.preventDefault(),e.stopPropagation(),yi(),q();return}if(r==="start-tutorial"){e.preventDefault(),e.stopPropagation(),n.canvasView="map",n.mode="Explore",n.panelTab="Manual",Bf(),q();return}if(r==="update-select"){const o=et();if(o.active){const s=a?.getAttribute("data-key");(t.classList.contains("custom-select-trigger")||t.closest(".custom-select-trigger"))&&setTimeout(()=>{q()},50),{1:"scenario",2:"model",4:"variable",5:"unit",6:"palette"}[o.currentStep]===s&&(t.classList.contains("custom-select-option")||t.closest(".custom-select-option"))&&setTimeout(()=>{Dt(),q()},100)}}})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Co):Co();
