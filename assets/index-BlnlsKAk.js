(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}})();function Se(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function pa(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function vr(t){let e,n,r;t.length!==2?(e=Se,n=(l,c)=>Se(t(l),c),r=(l,c)=>t(l)-c):(e=t===Se||t===pa?t:ma,n=t,r=t);function a(l,c,d=0,u=l.length){if(d<u){if(e(c,c)!==0)return u;do{const f=d+u>>>1;n(l[f],c)<0?d=f+1:u=f}while(d<u)}return d}function o(l,c,d=0,u=l.length){if(d<u){if(e(c,c)!==0)return u;do{const f=d+u>>>1;n(l[f],c)<=0?d=f+1:u=f}while(d<u)}return d}function s(l,c,d=0,u=l.length){const f=a(l,c,d,u-1);return f>d&&r(l[f-1],c)>-r(l[f],c)?f-1:f}return{left:a,center:s,right:o}}function ma(){return 0}function yr(t){return t===null?NaN:+t}const ga=vr(Se),va=ga.right;vr(yr).center;const ya=Math.sqrt(50),ba=Math.sqrt(10),xa=Math.sqrt(2);function Ee(t,e,n){const r=(e-t)/Math.max(0,n),a=Math.floor(Math.log10(r)),o=r/Math.pow(10,a),s=o>=ya?10:o>=ba?5:o>=xa?2:1;let l,c,d;return a<0?(d=Math.pow(10,-a)/s,l=Math.round(t*d),c=Math.round(e*d),l/d<t&&++l,c/d>e&&--c,d=-d):(d=Math.pow(10,a)*s,l=Math.round(t/d),c=Math.round(e/d),l*d<t&&++l,c*d>e&&--c),c<l&&.5<=n&&n<2?Ee(t,e,n*2):[l,c,d]}function wa(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const r=e<t,[a,o,s]=r?Ee(e,t,n):Ee(t,e,n);if(!(o>=a))return[];const l=o-a+1,c=new Array(l);if(r)if(s<0)for(let d=0;d<l;++d)c[d]=(o-d)/-s;else for(let d=0;d<l;++d)c[d]=(o-d)*s;else if(s<0)for(let d=0;d<l;++d)c[d]=(a+d)/-s;else for(let d=0;d<l;++d)c[d]=(a+d)*s;return c}function tn(t,e,n){return e=+e,t=+t,n=+n,Ee(t,e,n)[2]}function Sa(t,e,n){e=+e,t=+t,n=+n;const r=e<t,a=r?tn(e,t,n):tn(t,e,n);return(r?-1:1)*(a<0?1/-a:a)}function Ke(t,e,n=yr){if(!(!(r=t.length)||isNaN(e=+e))){if(e<=0||r<2)return+n(t[0],0,t);if(e>=1)return+n(t[r-1],r-1,t);var r,a=(r-1)*e,o=Math.floor(a),s=+n(t[o],o,t),l=+n(t[o+1],o+1,t);return s+(l-s)*(a-o)}}function $a(t,e){let n=0,r=0;for(let a of t)a!=null&&(a=+a)>=a&&(++n,r+=a);if(n)return r/n}var Ma={value:()=>{}};function br(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new $e(n)}function $e(t){this._=t}function _a(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",a=n.indexOf(".");if(a>=0&&(r=n.slice(a+1),n=n.slice(0,a)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}$e.prototype=br.prototype={constructor:$e,on:function(t,e){var n=this._,r=_a(t+"",n),a,o=-1,s=r.length;if(arguments.length<2){for(;++o<s;)if((a=(t=r[o]).type)&&(a=Da(n[a],t.name)))return a;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++o<s;)if(a=(t=r[o]).type)n[a]=Rn(n[a],t.name,e);else if(e==null)for(a in n)n[a]=Rn(n[a],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new $e(t)},call:function(t,e){if((a=arguments.length-2)>0)for(var n=new Array(a),r=0,a,o;r<a;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=this._[t],r=0,a=o.length;r<a;++r)o[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],a=0,o=r.length;a<o;++a)r[a].value.apply(e,n)}};function Da(t,e){for(var n=0,r=t.length,a;n<r;++n)if((a=t[n]).name===e)return a.value}function Rn(t,e,n){for(var r=0,a=t.length;r<a;++r)if(t[r].name===e){t[r]=Ma,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var en="http://www.w3.org/1999/xhtml";const Bn={svg:"http://www.w3.org/2000/svg",xhtml:en,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Ve(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),Bn.hasOwnProperty(e)?{space:Bn[e],local:t}:t}function Ea(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===en&&e.documentElement.namespaceURI===en?e.createElement(t):e.createElementNS(n,t)}}function La(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function xr(t){var e=Ve(t);return(e.local?La:Ea)(e)}function ka(){}function vn(t){return t==null?ka:function(){return this.querySelector(t)}}function Ta(t){typeof t!="function"&&(t=vn(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var o=e[a],s=o.length,l=r[a]=new Array(s),c,d,u=0;u<s;++u)(c=o[u])&&(d=t.call(c,c.__data__,u,o))&&("__data__"in c&&(d.__data__=c.__data__),l[u]=d);return new et(r,this._parents)}function Aa(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function Ca(){return[]}function wr(t){return t==null?Ca:function(){return this.querySelectorAll(t)}}function Na(t){return function(){return Aa(t.apply(this,arguments))}}function Ia(t){typeof t=="function"?t=Na(t):t=wr(t);for(var e=this._groups,n=e.length,r=[],a=[],o=0;o<n;++o)for(var s=e[o],l=s.length,c,d=0;d<l;++d)(c=s[d])&&(r.push(t.call(c,c.__data__,d,s)),a.push(c));return new et(r,a)}function Sr(t){return function(){return this.matches(t)}}function $r(t){return function(e){return e.matches(t)}}var Pa=Array.prototype.find;function Ra(t){return function(){return Pa.call(this.children,t)}}function Ba(){return this.firstElementChild}function Fa(t){return this.select(t==null?Ba:Ra(typeof t=="function"?t:$r(t)))}var Oa=Array.prototype.filter;function qa(){return Array.from(this.children)}function Va(t){return function(){return Oa.call(this.children,t)}}function Xa(t){return this.selectAll(t==null?qa:Va(typeof t=="function"?t:$r(t)))}function za(t){typeof t!="function"&&(t=Sr(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var o=e[a],s=o.length,l=r[a]=[],c,d=0;d<s;++d)(c=o[d])&&t.call(c,c.__data__,d,o)&&l.push(c);return new et(r,this._parents)}function Mr(t){return new Array(t.length)}function Ha(){return new et(this._enter||this._groups.map(Mr),this._parents)}function Le(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}Le.prototype={constructor:Le,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function Wa(t){return function(){return t}}function Ua(t,e,n,r,a,o){for(var s=0,l,c=e.length,d=o.length;s<d;++s)(l=e[s])?(l.__data__=o[s],r[s]=l):n[s]=new Le(t,o[s]);for(;s<c;++s)(l=e[s])&&(a[s]=l)}function Ya(t,e,n,r,a,o,s){var l,c,d=new Map,u=e.length,f=o.length,h=new Array(u),g;for(l=0;l<u;++l)(c=e[l])&&(h[l]=g=s.call(c,c.__data__,l,e)+"",d.has(g)?a[l]=c:d.set(g,c));for(l=0;l<f;++l)g=s.call(t,o[l],l,o)+"",(c=d.get(g))?(r[l]=c,c.__data__=o[l],d.delete(g)):n[l]=new Le(t,o[l]);for(l=0;l<u;++l)(c=e[l])&&d.get(h[l])===c&&(a[l]=c)}function Ka(t){return t.__data__}function Ga(t,e){if(!arguments.length)return Array.from(this,Ka);var n=e?Ya:Ua,r=this._parents,a=this._groups;typeof t!="function"&&(t=Wa(t));for(var o=a.length,s=new Array(o),l=new Array(o),c=new Array(o),d=0;d<o;++d){var u=r[d],f=a[d],h=f.length,g=ja(t.call(u,u&&u.__data__,d,r)),S=g.length,L=l[d]=new Array(S),_=s[d]=new Array(S),T=c[d]=new Array(h);n(u,f,L,_,T,g,e);for(var b=0,k=0,E,D;b<S;++b)if(E=L[b]){for(b>=k&&(k=b+1);!(D=_[k])&&++k<S;);E._next=D||null}}return s=new et(s,r),s._enter=l,s._exit=c,s}function ja(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function Qa(){return new et(this._exit||this._groups.map(Mr),this._parents)}function Za(t,e,n){var r=this.enter(),a=this,o=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(a=e(a),a&&(a=a.selection())),n==null?o.remove():n(o),r&&a?r.merge(a).order():a}function Ja(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,a=n.length,o=r.length,s=Math.min(a,o),l=new Array(a),c=0;c<s;++c)for(var d=n[c],u=r[c],f=d.length,h=l[c]=new Array(f),g,S=0;S<f;++S)(g=d[S]||u[S])&&(h[S]=g);for(;c<a;++c)l[c]=n[c];return new et(l,this._parents)}function ti(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],a=r.length-1,o=r[a],s;--a>=0;)(s=r[a])&&(o&&s.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(s,o),o=s);return this}function ei(t){t||(t=ni);function e(f,h){return f&&h?t(f.__data__,h.__data__):!f-!h}for(var n=this._groups,r=n.length,a=new Array(r),o=0;o<r;++o){for(var s=n[o],l=s.length,c=a[o]=new Array(l),d,u=0;u<l;++u)(d=s[u])&&(c[u]=d);c.sort(e)}return new et(a,this._parents).order()}function ni(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function ri(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function ai(){return Array.from(this)}function ii(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],a=0,o=r.length;a<o;++a){var s=r[a];if(s)return s}return null}function oi(){let t=0;for(const e of this)++t;return t}function si(){return!this.node()}function li(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var a=e[n],o=0,s=a.length,l;o<s;++o)(l=a[o])&&t.call(l,l.__data__,o,a);return this}function ci(t){return function(){this.removeAttribute(t)}}function di(t){return function(){this.removeAttributeNS(t.space,t.local)}}function ui(t,e){return function(){this.setAttribute(t,e)}}function fi(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function hi(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function pi(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function mi(t,e){var n=Ve(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?di:ci:typeof e=="function"?n.local?pi:hi:n.local?fi:ui)(n,e))}function _r(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function gi(t){return function(){this.style.removeProperty(t)}}function vi(t,e,n){return function(){this.style.setProperty(t,e,n)}}function yi(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function bi(t,e,n){return arguments.length>1?this.each((e==null?gi:typeof e=="function"?yi:vi)(t,e,n??"")):Kt(this.node(),t)}function Kt(t,e){return t.style.getPropertyValue(e)||_r(t).getComputedStyle(t,null).getPropertyValue(e)}function xi(t){return function(){delete this[t]}}function wi(t,e){return function(){this[t]=e}}function Si(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function $i(t,e){return arguments.length>1?this.each((e==null?xi:typeof e=="function"?Si:wi)(t,e)):this.node()[t]}function Dr(t){return t.trim().split(/^|\s+/)}function yn(t){return t.classList||new Er(t)}function Er(t){this._node=t,this._names=Dr(t.getAttribute("class")||"")}Er.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function Lr(t,e){for(var n=yn(t),r=-1,a=e.length;++r<a;)n.add(e[r])}function kr(t,e){for(var n=yn(t),r=-1,a=e.length;++r<a;)n.remove(e[r])}function Mi(t){return function(){Lr(this,t)}}function _i(t){return function(){kr(this,t)}}function Di(t,e){return function(){(e.apply(this,arguments)?Lr:kr)(this,t)}}function Ei(t,e){var n=Dr(t+"");if(arguments.length<2){for(var r=yn(this.node()),a=-1,o=n.length;++a<o;)if(!r.contains(n[a]))return!1;return!0}return this.each((typeof e=="function"?Di:e?Mi:_i)(n,e))}function Li(){this.textContent=""}function ki(t){return function(){this.textContent=t}}function Ti(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function Ai(t){return arguments.length?this.each(t==null?Li:(typeof t=="function"?Ti:ki)(t)):this.node().textContent}function Ci(){this.innerHTML=""}function Ni(t){return function(){this.innerHTML=t}}function Ii(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function Pi(t){return arguments.length?this.each(t==null?Ci:(typeof t=="function"?Ii:Ni)(t)):this.node().innerHTML}function Ri(){this.nextSibling&&this.parentNode.appendChild(this)}function Bi(){return this.each(Ri)}function Fi(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Oi(){return this.each(Fi)}function qi(t){var e=typeof t=="function"?t:xr(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function Vi(){return null}function Xi(t,e){var n=typeof t=="function"?t:xr(t),r=e==null?Vi:typeof e=="function"?e:vn(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function zi(){var t=this.parentNode;t&&t.removeChild(this)}function Hi(){return this.each(zi)}function Wi(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Ui(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Yi(t){return this.select(t?Ui:Wi)}function Ki(t){return arguments.length?this.property("__data__",t):this.node().__data__}function Gi(t){return function(e){t.call(this,e,this.__data__)}}function ji(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function Qi(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,a=e.length,o;n<a;++n)o=e[n],(!t.type||o.type===t.type)&&o.name===t.name?this.removeEventListener(o.type,o.listener,o.options):e[++r]=o;++r?e.length=r:delete this.__on}}}function Zi(t,e,n){return function(){var r=this.__on,a,o=Gi(e);if(r){for(var s=0,l=r.length;s<l;++s)if((a=r[s]).type===t.type&&a.name===t.name){this.removeEventListener(a.type,a.listener,a.options),this.addEventListener(a.type,a.listener=o,a.options=n),a.value=e;return}}this.addEventListener(t.type,o,n),a={type:t.type,name:t.name,value:e,listener:o,options:n},r?r.push(a):this.__on=[a]}}function Ji(t,e,n){var r=ji(t+""),a,o=r.length,s;if(arguments.length<2){var l=this.node().__on;if(l){for(var c=0,d=l.length,u;c<d;++c)for(a=0,u=l[c];a<o;++a)if((s=r[a]).type===u.type&&s.name===u.name)return u.value}return}for(l=e?Zi:Qi,a=0;a<o;++a)this.each(l(r[a],e,n));return this}function Tr(t,e,n){var r=_r(t),a=r.CustomEvent;typeof a=="function"?a=new a(e,n):(a=r.document.createEvent("Event"),n?(a.initEvent(e,n.bubbles,n.cancelable),a.detail=n.detail):a.initEvent(e,!1,!1)),t.dispatchEvent(a)}function to(t,e){return function(){return Tr(this,t,e)}}function eo(t,e){return function(){return Tr(this,t,e.apply(this,arguments))}}function no(t,e){return this.each((typeof e=="function"?eo:to)(t,e))}function*ro(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],a=0,o=r.length,s;a<o;++a)(s=r[a])&&(yield s)}var ao=[null];function et(t,e){this._groups=t,this._parents=e}function de(){return new et([[document.documentElement]],ao)}function io(){return this}et.prototype=de.prototype={constructor:et,select:Ta,selectAll:Ia,selectChild:Fa,selectChildren:Xa,filter:za,data:Ga,enter:Ha,exit:Qa,join:Za,merge:Ja,selection:io,order:ti,sort:ei,call:ri,nodes:ai,node:ii,size:oi,empty:si,each:li,attr:mi,style:bi,property:$i,classed:Ei,text:Ai,html:Pi,raise:Bi,lower:Oi,append:qi,insert:Xi,remove:Hi,clone:Yi,datum:Ki,on:Ji,dispatch:no,[Symbol.iterator]:ro};function oo(t){let e;for(;e=t.sourceEvent;)t=e;return t}function so(t,e){if(t=oo(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var a=e.getBoundingClientRect();return[t.clientX-a.left-e.clientLeft,t.clientY-a.top-e.clientTop]}}return[t.pageX,t.pageY]}function bn(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Ar(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function ue(){}var ae=.7,ke=1/ae,Ut="\\s*([+-]?\\d+)\\s*",ie="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ot="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",lo=/^#([0-9a-f]{3,8})$/,co=new RegExp(`^rgb\\(${Ut},${Ut},${Ut}\\)$`),uo=new RegExp(`^rgb\\(${ot},${ot},${ot}\\)$`),fo=new RegExp(`^rgba\\(${Ut},${Ut},${Ut},${ie}\\)$`),ho=new RegExp(`^rgba\\(${ot},${ot},${ot},${ie}\\)$`),po=new RegExp(`^hsl\\(${ie},${ot},${ot}\\)$`),mo=new RegExp(`^hsla\\(${ie},${ot},${ot},${ie}\\)$`),Fn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};bn(ue,Ct,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:On,formatHex:On,formatHex8:go,formatHsl:vo,formatRgb:qn,toString:qn});function On(){return this.rgb().formatHex()}function go(){return this.rgb().formatHex8()}function vo(){return Cr(this).formatHsl()}function qn(){return this.rgb().formatRgb()}function Ct(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=lo.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?Vn(e):n===3?new G(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?ge(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?ge(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=co.exec(t))?new G(e[1],e[2],e[3],1):(e=uo.exec(t))?new G(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=fo.exec(t))?ge(e[1],e[2],e[3],e[4]):(e=ho.exec(t))?ge(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=po.exec(t))?Hn(e[1],e[2]/100,e[3]/100,1):(e=mo.exec(t))?Hn(e[1],e[2]/100,e[3]/100,e[4]):Fn.hasOwnProperty(t)?Vn(Fn[t]):t==="transparent"?new G(NaN,NaN,NaN,0):null}function Vn(t){return new G(t>>16&255,t>>8&255,t&255,1)}function ge(t,e,n,r){return r<=0&&(t=e=n=NaN),new G(t,e,n,r)}function yo(t){return t instanceof ue||(t=Ct(t)),t?(t=t.rgb(),new G(t.r,t.g,t.b,t.opacity)):new G}function nn(t,e,n,r){return arguments.length===1?yo(t):new G(t,e,n,r??1)}function G(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}bn(G,nn,Ar(ue,{brighter(t){return t=t==null?ke:Math.pow(ke,t),new G(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?ae:Math.pow(ae,t),new G(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new G(At(this.r),At(this.g),At(this.b),Te(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Xn,formatHex:Xn,formatHex8:bo,formatRgb:zn,toString:zn}));function Xn(){return`#${Et(this.r)}${Et(this.g)}${Et(this.b)}`}function bo(){return`#${Et(this.r)}${Et(this.g)}${Et(this.b)}${Et((isNaN(this.opacity)?1:this.opacity)*255)}`}function zn(){const t=Te(this.opacity);return`${t===1?"rgb(":"rgba("}${At(this.r)}, ${At(this.g)}, ${At(this.b)}${t===1?")":`, ${t})`}`}function Te(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function At(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Et(t){return t=At(t),(t<16?"0":"")+t.toString(16)}function Hn(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new tt(t,e,n,r)}function Cr(t){if(t instanceof tt)return new tt(t.h,t.s,t.l,t.opacity);if(t instanceof ue||(t=Ct(t)),!t)return new tt;if(t instanceof tt)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,a=Math.min(e,n,r),o=Math.max(e,n,r),s=NaN,l=o-a,c=(o+a)/2;return l?(e===o?s=(n-r)/l+(n<r)*6:n===o?s=(r-e)/l+2:s=(e-n)/l+4,l/=c<.5?o+a:2-o-a,s*=60):l=c>0&&c<1?0:s,new tt(s,l,c,t.opacity)}function xo(t,e,n,r){return arguments.length===1?Cr(t):new tt(t,e,n,r??1)}function tt(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}bn(tt,xo,Ar(ue,{brighter(t){return t=t==null?ke:Math.pow(ke,t),new tt(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?ae:Math.pow(ae,t),new tt(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,a=2*n-r;return new G(Ge(t>=240?t-240:t+120,a,r),Ge(t,a,r),Ge(t<120?t+240:t-120,a,r),this.opacity)},clamp(){return new tt(Wn(this.h),ve(this.s),ve(this.l),Te(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Te(this.opacity);return`${t===1?"hsl(":"hsla("}${Wn(this.h)}, ${ve(this.s)*100}%, ${ve(this.l)*100}%${t===1?")":`, ${t})`}`}}));function Wn(t){return t=(t||0)%360,t<0?t+360:t}function ve(t){return Math.max(0,Math.min(1,t||0))}function Ge(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const xn=t=>()=>t;function wo(t,e){return function(n){return t+n*e}}function So(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function $o(t){return(t=+t)==1?Nr:function(e,n){return n-e?So(e,n,t):xn(isNaN(e)?n:e)}}function Nr(t,e){var n=e-t;return n?wo(t,n):xn(isNaN(t)?e:t)}const Ae=(function t(e){var n=$o(e);function r(a,o){var s=n((a=nn(a)).r,(o=nn(o)).r),l=n(a.g,o.g),c=n(a.b,o.b),d=Nr(a.opacity,o.opacity);return function(u){return a.r=s(u),a.g=l(u),a.b=c(u),a.opacity=d(u),a+""}}return r.gamma=t,r})(1);function Mo(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),a;return function(o){for(a=0;a<n;++a)r[a]=t[a]*(1-o)+e[a]*o;return r}}function _o(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Do(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,a=new Array(r),o=new Array(n),s;for(s=0;s<r;++s)a[s]=wn(t[s],e[s]);for(;s<n;++s)o[s]=e[s];return function(l){for(s=0;s<r;++s)o[s]=a[s](l);return o}}function Eo(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function J(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function Lo(t,e){var n={},r={},a;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(a in e)a in t?n[a]=wn(t[a],e[a]):r[a]=e[a];return function(o){for(a in n)r[a]=n[a](o);return r}}var rn=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,je=new RegExp(rn.source,"g");function ko(t){return function(){return t}}function To(t){return function(e){return t(e)+""}}function Ir(t,e){var n=rn.lastIndex=je.lastIndex=0,r,a,o,s=-1,l=[],c=[];for(t=t+"",e=e+"";(r=rn.exec(t))&&(a=je.exec(e));)(o=a.index)>n&&(o=e.slice(n,o),l[s]?l[s]+=o:l[++s]=o),(r=r[0])===(a=a[0])?l[s]?l[s]+=a:l[++s]=a:(l[++s]=null,c.push({i:s,x:J(r,a)})),n=je.lastIndex;return n<e.length&&(o=e.slice(n),l[s]?l[s]+=o:l[++s]=o),l.length<2?c[0]?To(c[0].x):ko(e):(e=c.length,function(d){for(var u=0,f;u<e;++u)l[(f=c[u]).i]=f.x(d);return l.join("")})}function wn(t,e){var n=typeof e,r;return e==null||n==="boolean"?xn(e):(n==="number"?J:n==="string"?(r=Ct(e))?(e=r,Ae):Ir:e instanceof Ct?Ae:e instanceof Date?Eo:_o(e)?Mo:Array.isArray(e)?Do:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?Lo:J)(t,e)}function Ao(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var Un=180/Math.PI,an={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Pr(t,e,n,r,a,o){var s,l,c;return(s=Math.sqrt(t*t+e*e))&&(t/=s,e/=s),(c=t*n+e*r)&&(n-=t*c,r-=e*c),(l=Math.sqrt(n*n+r*r))&&(n/=l,r/=l,c/=l),t*r<e*n&&(t=-t,e=-e,c=-c,s=-s),{translateX:a,translateY:o,rotate:Math.atan2(e,t)*Un,skewX:Math.atan(c)*Un,scaleX:s,scaleY:l}}var ye;function Co(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?an:Pr(e.a,e.b,e.c,e.d,e.e,e.f)}function No(t){return t==null||(ye||(ye=document.createElementNS("http://www.w3.org/2000/svg","g")),ye.setAttribute("transform",t),!(t=ye.transform.baseVal.consolidate()))?an:(t=t.matrix,Pr(t.a,t.b,t.c,t.d,t.e,t.f))}function Rr(t,e,n,r){function a(d){return d.length?d.pop()+" ":""}function o(d,u,f,h,g,S){if(d!==f||u!==h){var L=g.push("translate(",null,e,null,n);S.push({i:L-4,x:J(d,f)},{i:L-2,x:J(u,h)})}else(f||h)&&g.push("translate("+f+e+h+n)}function s(d,u,f,h){d!==u?(d-u>180?u+=360:u-d>180&&(d+=360),h.push({i:f.push(a(f)+"rotate(",null,r)-2,x:J(d,u)})):u&&f.push(a(f)+"rotate("+u+r)}function l(d,u,f,h){d!==u?h.push({i:f.push(a(f)+"skewX(",null,r)-2,x:J(d,u)}):u&&f.push(a(f)+"skewX("+u+r)}function c(d,u,f,h,g,S){if(d!==f||u!==h){var L=g.push(a(g)+"scale(",null,",",null,")");S.push({i:L-4,x:J(d,f)},{i:L-2,x:J(u,h)})}else(f!==1||h!==1)&&g.push(a(g)+"scale("+f+","+h+")")}return function(d,u){var f=[],h=[];return d=t(d),u=t(u),o(d.translateX,d.translateY,u.translateX,u.translateY,f,h),s(d.rotate,u.rotate,f,h),l(d.skewX,u.skewX,f,h),c(d.scaleX,d.scaleY,u.scaleX,u.scaleY,f,h),d=u=null,function(g){for(var S=-1,L=h.length,_;++S<L;)f[(_=h[S]).i]=_.x(g);return f.join("")}}}var Io=Rr(Co,"px, ","px)","deg)"),Po=Rr(No,", ",")",")"),Gt=0,te=0,Zt=0,Br=1e3,Ce,ee,Ne=0,Nt=0,Xe=0,oe=typeof performance=="object"&&performance.now?performance:Date,Fr=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Sn(){return Nt||(Fr(Ro),Nt=oe.now()+Xe)}function Ro(){Nt=0}function Ie(){this._call=this._time=this._next=null}Ie.prototype=Or.prototype={constructor:Ie,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?Sn():+n)+(e==null?0:+e),!this._next&&ee!==this&&(ee?ee._next=this:Ce=this,ee=this),this._call=t,this._time=n,on()},stop:function(){this._call&&(this._call=null,this._time=1/0,on())}};function Or(t,e,n){var r=new Ie;return r.restart(t,e,n),r}function Bo(){Sn(),++Gt;for(var t=Ce,e;t;)(e=Nt-t._time)>=0&&t._call.call(void 0,e),t=t._next;--Gt}function Yn(){Nt=(Ne=oe.now())+Xe,Gt=te=0;try{Bo()}finally{Gt=0,Oo(),Nt=0}}function Fo(){var t=oe.now(),e=t-Ne;e>Br&&(Xe-=e,Ne=t)}function Oo(){for(var t,e=Ce,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:Ce=n);ee=t,on(r)}function on(t){if(!Gt){te&&(te=clearTimeout(te));var e=t-Nt;e>24?(t<1/0&&(te=setTimeout(Yn,t-oe.now()-Xe)),Zt&&(Zt=clearInterval(Zt))):(Zt||(Ne=oe.now(),Zt=setInterval(Fo,Br)),Gt=1,Fr(Yn))}}function Kn(t,e,n){var r=new Ie;return e=e==null?0:+e,r.restart(a=>{r.stop(),t(a+e)},e,n),r}var qo=br("start","end","cancel","interrupt"),Vo=[],qr=0,Gn=1,sn=2,Me=3,jn=4,ln=5,_e=6;function ze(t,e,n,r,a,o){var s=t.__transition;if(!s)t.__transition={};else if(n in s)return;Xo(t,n,{name:e,index:r,group:a,on:qo,tween:Vo,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:qr})}function $n(t,e){var n=nt(t,e);if(n.state>qr)throw new Error("too late; already scheduled");return n}function st(t,e){var n=nt(t,e);if(n.state>Me)throw new Error("too late; already running");return n}function nt(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function Xo(t,e,n){var r=t.__transition,a;r[e]=n,n.timer=Or(o,0,n.time);function o(d){n.state=Gn,n.timer.restart(s,n.delay,n.time),n.delay<=d&&s(d-n.delay)}function s(d){var u,f,h,g;if(n.state!==Gn)return c();for(u in r)if(g=r[u],g.name===n.name){if(g.state===Me)return Kn(s);g.state===jn?(g.state=_e,g.timer.stop(),g.on.call("interrupt",t,t.__data__,g.index,g.group),delete r[u]):+u<e&&(g.state=_e,g.timer.stop(),g.on.call("cancel",t,t.__data__,g.index,g.group),delete r[u])}if(Kn(function(){n.state===Me&&(n.state=jn,n.timer.restart(l,n.delay,n.time),l(d))}),n.state=sn,n.on.call("start",t,t.__data__,n.index,n.group),n.state===sn){for(n.state=Me,a=new Array(h=n.tween.length),u=0,f=-1;u<h;++u)(g=n.tween[u].value.call(t,t.__data__,n.index,n.group))&&(a[++f]=g);a.length=f+1}}function l(d){for(var u=d<n.duration?n.ease.call(null,d/n.duration):(n.timer.restart(c),n.state=ln,1),f=-1,h=a.length;++f<h;)a[f].call(t,u);n.state===ln&&(n.on.call("end",t,t.__data__,n.index,n.group),c())}function c(){n.state=_e,n.timer.stop(),delete r[e];for(var d in r)return;delete t.__transition}}function zo(t,e){var n=t.__transition,r,a,o=!0,s;if(n){e=e==null?null:e+"";for(s in n){if((r=n[s]).name!==e){o=!1;continue}a=r.state>sn&&r.state<ln,r.state=_e,r.timer.stop(),r.on.call(a?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[s]}o&&delete t.__transition}}function Ho(t){return this.each(function(){zo(this,t)})}function Wo(t,e){var n,r;return function(){var a=st(this,t),o=a.tween;if(o!==n){r=n=o;for(var s=0,l=r.length;s<l;++s)if(r[s].name===e){r=r.slice(),r.splice(s,1);break}}a.tween=r}}function Uo(t,e,n){var r,a;if(typeof n!="function")throw new Error;return function(){var o=st(this,t),s=o.tween;if(s!==r){a=(r=s).slice();for(var l={name:e,value:n},c=0,d=a.length;c<d;++c)if(a[c].name===e){a[c]=l;break}c===d&&a.push(l)}o.tween=a}}function Yo(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=nt(this.node(),n).tween,a=0,o=r.length,s;a<o;++a)if((s=r[a]).name===t)return s.value;return null}return this.each((e==null?Wo:Uo)(n,t,e))}function Mn(t,e,n){var r=t._id;return t.each(function(){var a=st(this,r);(a.value||(a.value={}))[e]=n.apply(this,arguments)}),function(a){return nt(a,r).value[e]}}function Vr(t,e){var n;return(typeof e=="number"?J:e instanceof Ct?Ae:(n=Ct(e))?(e=n,Ae):Ir)(t,e)}function Ko(t){return function(){this.removeAttribute(t)}}function Go(t){return function(){this.removeAttributeNS(t.space,t.local)}}function jo(t,e,n){var r,a=n+"",o;return function(){var s=this.getAttribute(t);return s===a?null:s===r?o:o=e(r=s,n)}}function Qo(t,e,n){var r,a=n+"",o;return function(){var s=this.getAttributeNS(t.space,t.local);return s===a?null:s===r?o:o=e(r=s,n)}}function Zo(t,e,n){var r,a,o;return function(){var s,l=n(this),c;return l==null?void this.removeAttribute(t):(s=this.getAttribute(t),c=l+"",s===c?null:s===r&&c===a?o:(a=c,o=e(r=s,l)))}}function Jo(t,e,n){var r,a,o;return function(){var s,l=n(this),c;return l==null?void this.removeAttributeNS(t.space,t.local):(s=this.getAttributeNS(t.space,t.local),c=l+"",s===c?null:s===r&&c===a?o:(a=c,o=e(r=s,l)))}}function ts(t,e){var n=Ve(t),r=n==="transform"?Po:Vr;return this.attrTween(t,typeof e=="function"?(n.local?Jo:Zo)(n,r,Mn(this,"attr."+t,e)):e==null?(n.local?Go:Ko)(n):(n.local?Qo:jo)(n,r,e))}function es(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function ns(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function rs(t,e){var n,r;function a(){var o=e.apply(this,arguments);return o!==r&&(n=(r=o)&&ns(t,o)),n}return a._value=e,a}function as(t,e){var n,r;function a(){var o=e.apply(this,arguments);return o!==r&&(n=(r=o)&&es(t,o)),n}return a._value=e,a}function is(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=Ve(t);return this.tween(n,(r.local?rs:as)(r,e))}function os(t,e){return function(){$n(this,t).delay=+e.apply(this,arguments)}}function ss(t,e){return e=+e,function(){$n(this,t).delay=e}}function ls(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?os:ss)(e,t)):nt(this.node(),e).delay}function cs(t,e){return function(){st(this,t).duration=+e.apply(this,arguments)}}function ds(t,e){return e=+e,function(){st(this,t).duration=e}}function us(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?cs:ds)(e,t)):nt(this.node(),e).duration}function fs(t,e){if(typeof e!="function")throw new Error;return function(){st(this,t).ease=e}}function hs(t){var e=this._id;return arguments.length?this.each(fs(e,t)):nt(this.node(),e).ease}function ps(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;st(this,t).ease=n}}function ms(t){if(typeof t!="function")throw new Error;return this.each(ps(this._id,t))}function gs(t){typeof t!="function"&&(t=Sr(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var o=e[a],s=o.length,l=r[a]=[],c,d=0;d<s;++d)(c=o[d])&&t.call(c,c.__data__,d,o)&&l.push(c);return new vt(r,this._parents,this._name,this._id)}function vs(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,a=n.length,o=Math.min(r,a),s=new Array(r),l=0;l<o;++l)for(var c=e[l],d=n[l],u=c.length,f=s[l]=new Array(u),h,g=0;g<u;++g)(h=c[g]||d[g])&&(f[g]=h);for(;l<r;++l)s[l]=e[l];return new vt(s,this._parents,this._name,this._id)}function ys(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function bs(t,e,n){var r,a,o=ys(e)?$n:st;return function(){var s=o(this,t),l=s.on;l!==r&&(a=(r=l).copy()).on(e,n),s.on=a}}function xs(t,e){var n=this._id;return arguments.length<2?nt(this.node(),n).on.on(t):this.each(bs(n,t,e))}function ws(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function Ss(){return this.on("end.remove",ws(this._id))}function $s(t){var e=this._name,n=this._id;typeof t!="function"&&(t=vn(t));for(var r=this._groups,a=r.length,o=new Array(a),s=0;s<a;++s)for(var l=r[s],c=l.length,d=o[s]=new Array(c),u,f,h=0;h<c;++h)(u=l[h])&&(f=t.call(u,u.__data__,h,l))&&("__data__"in u&&(f.__data__=u.__data__),d[h]=f,ze(d[h],e,n,h,d,nt(u,n)));return new vt(o,this._parents,e,n)}function Ms(t){var e=this._name,n=this._id;typeof t!="function"&&(t=wr(t));for(var r=this._groups,a=r.length,o=[],s=[],l=0;l<a;++l)for(var c=r[l],d=c.length,u,f=0;f<d;++f)if(u=c[f]){for(var h=t.call(u,u.__data__,f,c),g,S=nt(u,n),L=0,_=h.length;L<_;++L)(g=h[L])&&ze(g,e,n,L,h,S);o.push(h),s.push(u)}return new vt(o,s,e,n)}var _s=de.prototype.constructor;function Ds(){return new _s(this._groups,this._parents)}function Es(t,e){var n,r,a;return function(){var o=Kt(this,t),s=(this.style.removeProperty(t),Kt(this,t));return o===s?null:o===n&&s===r?a:a=e(n=o,r=s)}}function Xr(t){return function(){this.style.removeProperty(t)}}function Ls(t,e,n){var r,a=n+"",o;return function(){var s=Kt(this,t);return s===a?null:s===r?o:o=e(r=s,n)}}function ks(t,e,n){var r,a,o;return function(){var s=Kt(this,t),l=n(this),c=l+"";return l==null&&(c=l=(this.style.removeProperty(t),Kt(this,t))),s===c?null:s===r&&c===a?o:(a=c,o=e(r=s,l))}}function Ts(t,e){var n,r,a,o="style."+e,s="end."+o,l;return function(){var c=st(this,t),d=c.on,u=c.value[o]==null?l||(l=Xr(e)):void 0;(d!==n||a!==u)&&(r=(n=d).copy()).on(s,a=u),c.on=r}}function As(t,e,n){var r=(t+="")=="transform"?Io:Vr;return e==null?this.styleTween(t,Es(t,r)).on("end.style."+t,Xr(t)):typeof e=="function"?this.styleTween(t,ks(t,r,Mn(this,"style."+t,e))).each(Ts(this._id,t)):this.styleTween(t,Ls(t,r,e),n).on("end.style."+t,null)}function Cs(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function Ns(t,e,n){var r,a;function o(){var s=e.apply(this,arguments);return s!==a&&(r=(a=s)&&Cs(t,s,n)),r}return o._value=e,o}function Is(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,Ns(t,e,n??""))}function Ps(t){return function(){this.textContent=t}}function Rs(t){return function(){var e=t(this);this.textContent=e??""}}function Bs(t){return this.tween("text",typeof t=="function"?Rs(Mn(this,"text",t)):Ps(t==null?"":t+""))}function Fs(t){return function(e){this.textContent=t.call(this,e)}}function Os(t){var e,n;function r(){var a=t.apply(this,arguments);return a!==n&&(e=(n=a)&&Fs(a)),e}return r._value=t,r}function qs(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,Os(t))}function Vs(){for(var t=this._name,e=this._id,n=zr(),r=this._groups,a=r.length,o=0;o<a;++o)for(var s=r[o],l=s.length,c,d=0;d<l;++d)if(c=s[d]){var u=nt(c,e);ze(c,t,n,d,s,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new vt(r,this._parents,t,n)}function Xs(){var t,e,n=this,r=n._id,a=n.size();return new Promise(function(o,s){var l={value:s},c={value:function(){--a===0&&o()}};n.each(function(){var d=st(this,r),u=d.on;u!==t&&(e=(t=u).copy(),e._.cancel.push(l),e._.interrupt.push(l),e._.end.push(c)),d.on=e}),a===0&&o()})}var zs=0;function vt(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function zr(){return++zs}var ct=de.prototype;vt.prototype={constructor:vt,select:$s,selectAll:Ms,selectChild:ct.selectChild,selectChildren:ct.selectChildren,filter:gs,merge:vs,selection:Ds,transition:Vs,call:ct.call,nodes:ct.nodes,node:ct.node,size:ct.size,empty:ct.empty,each:ct.each,on:xs,attr:ts,attrTween:is,style:As,styleTween:Is,text:Bs,textTween:qs,remove:Ss,tween:Yo,delay:ls,duration:us,ease:hs,easeVarying:ms,end:Xs,[Symbol.iterator]:ct[Symbol.iterator]};function Hs(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var Ws={time:null,delay:0,duration:250,ease:Hs};function Us(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function Ys(t){var e,n;t instanceof vt?(e=t._id,t=t._name):(e=zr(),(n=Ws).time=Sn(),t=t==null?null:t+"");for(var r=this._groups,a=r.length,o=0;o<a;++o)for(var s=r[o],l=s.length,c,d=0;d<l;++d)(c=s[d])&&ze(c,t,e,d,s,n||Us(c,e));return new vt(r,this._parents,t,e)}de.prototype.interrupt=Ho;de.prototype.transition=Ys;function Ks(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function Pe(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function jt(t){return t=Pe(Math.abs(t)),t?t[1]:NaN}function Gs(t,e){return function(n,r){for(var a=n.length,o=[],s=0,l=t[0],c=0;a>0&&l>0&&(c+l+1>r&&(l=Math.max(1,r-c)),o.push(n.substring(a-=l,a+l)),!((c+=l+1)>r));)l=t[s=(s+1)%t.length];return o.reverse().join(e)}}function js(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var Qs=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Re(t){if(!(e=Qs.exec(t)))throw new Error("invalid format: "+t);var e;return new _n({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Re.prototype=_n.prototype;function _n(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}_n.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Zs(t){t:for(var e=t.length,n=1,r=-1,a;n<e;++n)switch(t[n]){case".":r=a=n;break;case"0":r===0&&(r=n),a=n;break;default:if(!+t[n])break t;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(a+1):t}var Hr;function Js(t,e){var n=Pe(t,e);if(!n)return t+"";var r=n[0],a=n[1],o=a-(Hr=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,s=r.length;return o===s?r:o>s?r+new Array(o-s+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+Pe(t,Math.max(0,e+o-1))[0]}function Qn(t,e){var n=Pe(t,e);if(!n)return t+"";var r=n[0],a=n[1];return a<0?"0."+new Array(-a).join("0")+r:r.length>a+1?r.slice(0,a+1)+"."+r.slice(a+1):r+new Array(a-r.length+2).join("0")}const Zn={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:Ks,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Qn(t*100,e),r:Qn,s:Js,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Jn(t){return t}var tr=Array.prototype.map,er=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function tl(t){var e=t.grouping===void 0||t.thousands===void 0?Jn:Gs(tr.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",a=t.decimal===void 0?".":t.decimal+"",o=t.numerals===void 0?Jn:js(tr.call(t.numerals,String)),s=t.percent===void 0?"%":t.percent+"",l=t.minus===void 0?"−":t.minus+"",c=t.nan===void 0?"NaN":t.nan+"";function d(f){f=Re(f);var h=f.fill,g=f.align,S=f.sign,L=f.symbol,_=f.zero,T=f.width,b=f.comma,k=f.precision,E=f.trim,D=f.type;D==="n"?(b=!0,D="g"):Zn[D]||(k===void 0&&(k=12),E=!0,D="g"),(_||h==="0"&&g==="=")&&(_=!0,h="0",g="=");var C=L==="$"?n:L==="#"&&/[boxX]/.test(D)?"0"+D.toLowerCase():"",y=L==="$"?r:/[%p]/.test(D)?s:"",v=Zn[D],$=/[defgprs%]/.test(D);k=k===void 0?6:/[gprs]/.test(D)?Math.max(1,Math.min(21,k)):Math.max(0,Math.min(20,k));function M(w){var x=C,N=y,I,B,z;if(D==="c")N=v(w)+N,w="";else{w=+w;var rt=w<0||1/w<0;if(w=isNaN(w)?c:v(Math.abs(w),k),E&&(w=Zs(w)),rt&&+w==0&&S!=="+"&&(rt=!1),x=(rt?S==="("?S:l:S==="-"||S==="("?"":S)+x,N=(D==="s"?er[8+Hr/3]:"")+N+(rt&&S==="("?")":""),$){for(I=-1,B=w.length;++I<B;)if(z=w.charCodeAt(I),48>z||z>57){N=(z===46?a+w.slice(I+1):w.slice(I))+N,w=w.slice(0,I);break}}}b&&!_&&(w=e(w,1/0));var R=x.length+w.length+N.length,A=R<T?new Array(T-R+1).join(h):"";switch(b&&_&&(w=e(A+w,A.length?T-N.length:1/0),A=""),g){case"<":w=x+w+N+A;break;case"=":w=x+A+w+N;break;case"^":w=A.slice(0,R=A.length>>1)+x+w+N+A.slice(R);break;default:w=A+x+w+N;break}return o(w)}return M.toString=function(){return f+""},M}function u(f,h){var g=d((f=Re(f),f.type="f",f)),S=Math.max(-8,Math.min(8,Math.floor(jt(h)/3)))*3,L=Math.pow(10,-S),_=er[8+S/3];return function(T){return g(L*T)+_}}return{format:d,formatPrefix:u}}var be,Wr,Ur;el({thousands:",",grouping:[3],currency:["$",""]});function el(t){return be=tl(t),Wr=be.format,Ur=be.formatPrefix,be}function nl(t){return Math.max(0,-jt(Math.abs(t)))}function rl(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(jt(e)/3)))*3-jt(Math.abs(t)))}function al(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,jt(e)-jt(t))+1}function il(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function ol(t){return function(){return t}}function sl(t){return+t}var nr=[0,1];function qt(t){return t}function cn(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:ol(isNaN(e)?NaN:.5)}function ll(t,e){var n;return t>e&&(n=t,t=e,e=n),function(r){return Math.max(t,Math.min(e,r))}}function cl(t,e,n){var r=t[0],a=t[1],o=e[0],s=e[1];return a<r?(r=cn(a,r),o=n(s,o)):(r=cn(r,a),o=n(o,s)),function(l){return o(r(l))}}function dl(t,e,n){var r=Math.min(t.length,e.length)-1,a=new Array(r),o=new Array(r),s=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++s<r;)a[s]=cn(t[s],t[s+1]),o[s]=n(e[s],e[s+1]);return function(l){var c=va(t,l,1,r)-1;return o[c](a[c](l))}}function ul(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function fl(){var t=nr,e=nr,n=wn,r,a,o,s=qt,l,c,d;function u(){var h=Math.min(t.length,e.length);return s!==qt&&(s=ll(t[0],t[h-1])),l=h>2?dl:cl,c=d=null,f}function f(h){return h==null||isNaN(h=+h)?o:(c||(c=l(t.map(r),e,n)))(r(s(h)))}return f.invert=function(h){return s(a((d||(d=l(e,t.map(r),J)))(h)))},f.domain=function(h){return arguments.length?(t=Array.from(h,sl),u()):t.slice()},f.range=function(h){return arguments.length?(e=Array.from(h),u()):e.slice()},f.rangeRound=function(h){return e=Array.from(h),n=Ao,u()},f.clamp=function(h){return arguments.length?(s=h?!0:qt,u()):s!==qt},f.interpolate=function(h){return arguments.length?(n=h,u()):n},f.unknown=function(h){return arguments.length?(o=h,f):o},function(h,g){return r=h,a=g,u()}}function hl(){return fl()(qt,qt)}function pl(t,e,n,r){var a=Sa(t,e,n),o;switch(r=Re(r??",f"),r.type){case"s":{var s=Math.max(Math.abs(t),Math.abs(e));return r.precision==null&&!isNaN(o=rl(a,s))&&(r.precision=o),Ur(r,s)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(o=al(a,Math.max(Math.abs(t),Math.abs(e))))&&(r.precision=o-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(o=nl(a))&&(r.precision=o-(r.type==="%")*2);break}}return Wr(r)}function ml(t){var e=t.domain;return t.ticks=function(n){var r=e();return wa(r[0],r[r.length-1],n??10)},t.tickFormat=function(n,r){var a=e();return pl(a[0],a[a.length-1],n??10,r)},t.nice=function(n){n==null&&(n=10);var r=e(),a=0,o=r.length-1,s=r[a],l=r[o],c,d,u=10;for(l<s&&(d=s,s=l,l=d,d=a,a=o,o=d);u-- >0;){if(d=tn(s,l,n),d===c)return r[a]=s,r[o]=l,e(r);if(d>0)s=Math.floor(s/d)*d,l=Math.ceil(l/d)*d;else if(d<0)s=Math.ceil(s*d)/d,l=Math.floor(l*d)/d;else break;c=d}return t},t}function Yr(){var t=hl();return t.copy=function(){return ul(t,Yr())},il.apply(t,arguments),ml(t)}function ne(t,e,n){this.k=t,this.x=e,this.y=n}ne.prototype={constructor:ne,scale:function(t){return t===1?this:new ne(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new ne(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};ne.prototype;const Z=360;let Mt=null,ut=null;function gl(t){const{root:e,isOpen:n,onCanvasToggleUpdate:r,onTimeSliderUpdate:a}=t;Mt||(Mt=e.querySelector('[data-role="sidebar"]')),ut||(ut=e.querySelector('[data-action="toggle-sidebar"]'));const o=e.querySelector('[data-role="canvas-toggle"]'),s=e.querySelector('[data-role="compare-info-trigger"]'),l=e.querySelector('[data-role="compare-info-overlay"]');if(!Mt||!o||!ut)return;const c=n?"translateX(0)":`translateX(${Z+24}px)`;Mt.style.transform=c,Mt.style.pointerEvents=n?"auto":"none",Mt.setAttribute("aria-hidden",String(!n));const d=n?`${Z+10}px`:"14px";ut.style.right=d,ut.setAttribute("aria-label",n?"Collapse sidebar":"Expand sidebar"),ut.className=n?"sidebar-toggle open":"sidebar-toggle";const u=ut.querySelector("span");u&&(u.textContent=n?"›":"‹");const f=n?Z+24:24;o.style.right=`${f}px`,s&&(s.style.right=`${f}px`),l&&(l.style.left=n?`${Z}px`:"0",l.style.right="0"),r&&r(f),a&&a(n)}function vl(t){const{root:e,getSidebarOpen:n,setSidebarOpen:r,onCanvasToggleUpdate:a,onTimeSliderUpdate:o}=t;Mt=e.querySelector('[data-role="sidebar"]'),ut=e.querySelector('[data-action="toggle-sidebar"]'),ut?.addEventListener("click",()=>{const s=!n();r(s),gl({root:e,isOpen:s,onCanvasToggleUpdate:a,onTimeSliderUpdate:o})})}function yl(t){const e=t?Z+10:14;return`
      <button
        type="button"
        aria-label="${t?"Collapse sidebar":"Expand sidebar"}"
        data-action="toggle-sidebar"
        class="${t?"sidebar-toggle open":"sidebar-toggle"}"
        style="right: ${e}px"
      >
        <span class="sidebar-toggle-icon">${t?"›":"‹"}</span>
      </button>
    `}function Kr(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:{r:0,g:0,b:0}}const bl=t=>t-273.15,xl=t=>(t-273.15)*(9/5)+32,wl=t=>t*1e3,Sl=t=>t*3.6,$l=t=>t*2.237,Ml=t=>t/1e3,Bt=t=>t;function It(t){switch(t){case"tas":case"tasmin":case"tasmax":return[{label:"Kelvin (K)",unit:"K",convert:Bt},{label:"Celsius (°C)",unit:"°C",convert:bl},{label:"Fahrenheit (°F)",unit:"°F",convert:xl}];case"pr":return[{label:"g m⁻² s⁻¹",unit:"g m⁻² s⁻¹",convert:wl},{label:"kg m⁻² s⁻¹",unit:"kg m⁻² s⁻¹",convert:Bt}];case"rsds":case"rlds":return[{label:"W/m²",unit:"W/m²",convert:Bt},{label:"kW/m²",unit:"kW/m²",convert:Ml}];case"sfcWind":return[{label:"m/s",unit:"m/s",convert:Bt},{label:"km/h",unit:"km/h",convert:Sl},{label:"mph",unit:"mph",convert:$l}];case"hurs":return[{label:"Percent (%)",unit:"%",convert:Bt}];default:return[{label:"Default",unit:"",convert:Bt}]}}function se(t){return It(t)[0]}function re(t,e,n,r){const o=It(e).find(s=>s.label===n);return o?r?.isDifference&&["tas","tasmin","tasmax"].includes(e)?n.includes("Celsius")?t:n.includes("Fahrenheit")?t*(9/5):t:o.convert(t):t}function Gr(t,e){return It(t).find(a=>a.label===e)?.unit||""}function jr(t,e,n,r,a){const s=It(n).find(l=>l.label===r);return s?a?.isDifference&&["tas","tasmin","tasmax"].includes(n)?r.startsWith("Celsius")?{min:t,max:e}:r.startsWith("Fahrenheit")?{min:t*1.8,max:e*1.8}:{min:t,max:e}:{min:s.convert(t),max:s.convert(e)}:{min:t,max:e}}let pt=null,le=[];function Dn(t,e,n,r){const a=r.map(Kr);for(let o=0;o<n;o++){const l=(1-o/(n-1))*(a.length-1),c=Math.floor(l),d=Math.min(c+1,a.length-1),u=l-c,f=a[c],h=a[d],g=Math.round(f.r+(h.r-f.r)*u),S=Math.round(f.g+(h.g-f.g)*u),L=Math.round(f.b+(h.b-f.b)*u);t.fillStyle=`rgb(${g}, ${S}, ${L})`,t.fillRect(0,o,e,1)}}function _l(t,e,n,r,a,o){const s=r?.variable_metadata[t],l=s?.name||t;let c=e,d=n,u=s?.unit||"";if(a){const g=jr(e,n,t,a,{isDifference:o});c=g.min,d=g.max,u=Gr(t,a)}const f=(d-c)/4,h=[d,d-f,d-2*f,d-3*f,c];return`
      <div class="map-legend">
        <div class="legend-title">${l}</div>
        <div class="legend-container">
        <canvas id="legend-gradient-canvas" width="20" height="200" style="width: 20px; height: 200px; border-radius: 4px;"></canvas>
          <div class="legend-labels">
            ${h.map(g=>`<span>${g.toFixed(2)} ${u}</span>`).join("")}
          </div>
        </div>
      </div>
    `}function dn(t,e){const n=document.getElementById(t);if(!n){console.warn("Legend canvas not found");return}pt=n,le=e;const r=n.getContext("2d");if(!r)return;const a=n.width,o=n.height;Dn(r,a,o,e)}function Dl(t,e,n){if(!pt||le.length===0)return;const r=pt.getContext("2d");if(!r)return;const a=pt.width,o=pt.height;Dn(r,a,o,le);const s=(t-e)/(n-e),l=Math.round(o*(1-s));r.strokeStyle="rgba(255, 255, 255, 0.95)",r.lineWidth=2,r.shadowColor="rgba(0, 0, 0, 0.8)",r.shadowBlur=4,r.beginPath(),r.moveTo(0,l),r.lineTo(a,l),r.stroke(),r.shadowBlur=0}function El(){if(!pt||le.length===0)return;const t=pt.getContext("2d");if(!t)return;const e=pt.width,n=pt.height;Dn(t,e,n,le)}const En="http://localhost:8000";class wt extends Error{statusCode;details;constructor(e,n,r){super(e),this.name="DataClientError",this.statusCode=n,this.details=r}}function Ll(t){return{Historical:"historical",SSP245:"ssp245",SSP585:"ssp585"}[t]||t.toLowerCase()}function kl(t){return t===1?"low":t===2?"medium":"high"}function Tl(t,e,n="float32"){const r=atob(t),a=new Uint8Array(r.length);for(let o=0;o<r.length;o++)a[o]=r.charCodeAt(o);if(n.includes("float32"))return new Float32Array(a.buffer);if(n.includes("float64"))return new Float64Array(a.buffer);throw new Error(`Unsupported dtype: ${n}`)}function Al(t,e){const n=t.flat(),r=new Float32Array(n.length);for(let a=0;a<n.length;a++)r[a]=n[a];return r}async function Be(t,e){const r=`${En}/data`;try{const a=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...t,scenario:t.scenario?Ll(t.scenario):void 0,data_format:t.data_format||"base64"})});if(!a.ok){const o=await a.json().catch(()=>({detail:a.statusText}));throw new wt(o.detail||`HTTP ${a.status}: ${a.statusText}`,a.status,o)}return await a.json()}catch(a){throw a instanceof wt?a:new wt(`Failed to fetch data: ${a instanceof Error?a.message:String(a)}`,void 0,a)}}async function Qr(t){const n=`${En}/metadata`;try{const r=await fetch(n,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new wt(`HTTP ${r.status}: ${r.statusText}`,r.status);return await r.json()}catch(r){throw r instanceof wt?r:new wt(`Failed to fetch metadata: ${r instanceof Error?r.message:String(r)}`)}}function ce(t){return t.data?t.data instanceof Float32Array||t.data instanceof Float64Array?t.data:t.data_encoding==="none"?null:t.data_encoding==="base64"&&typeof t.data=="string"?Tl(t.data,t.shape,t.dtype):t.data_encoding==="list"&&Array.isArray(t.data)?Al(t.data,t.shape):null:null}function ft(t){return{variable:t.variable,time:t.date,model:t.model,scenario:t.scenario,resolution:kl(t.resolution),data_format:t.dataFormat||"base64"}}async function Cl(t){const n=`${En}/health`;try{return(await fetch(n,{method:"GET",signal:AbortSignal.timeout(5e3)})).ok}catch{return!1}}let Jt=null,un=0,fn=1,_t="",Dt="",De=!1;function Zr(){return Jt||(Jt=document.createElement("div"),Jt.className="map-tooltip",document.body.appendChild(Jt)),Jt}function Nl(t,e,n,r,a,o,s){const l=Zr();let c=a,d=o;Dt&&_t&&(c=re(a,_t,Dt,{isDifference:s??De}),d=Gr(_t,Dt)||o),l.textContent=`Lat: ${n.toFixed(2)}, Lon: ${r.toFixed(2)}, Value: ${c.toFixed(2)} ${d}`,l.style.display="block",l.style.left=`${t+10}px`,l.style.top=`${e+10}px`;let u=un,f=fn;if(Dt&&_t){const h=re(un,_t,Dt,{isDifference:s??De}),g=re(fn,_t,Dt,{isDifference:s??De});u=h,f=g}Dl(c,u,f)}function Vt(){const t=Zr();t.style.display="none",El()}function Il(t,e,n,r,a){un=t,fn=e,n!==void 0&&(_t=n),r!==void 0&&(Dt=r),a!==void 0&&(De=a)}let q=1,Q=0,mt=0,ht=!1,rr=0,ar=0,ir=0,or=0,U=null,Jr=null,ta=!1,Fe=null,ea,na,Xt=!1,hn=null,Qe=null;function Pl(t){const e=t.getContext("2d");if(!e)return null;const n=t.getBoundingClientRect();return t.width=n.width*window.devicePixelRatio,t.height=n.height*window.devicePixelRatio,e.scale(window.devicePixelRatio,window.devicePixelRatio),{ctx:e,rect:n,viewWidth:n.width,viewHeight:n.height}}function Rl(t,e,n,r){const a=360/n,o=180/r,s=t*a+a/2,l=s>180?s-360:s,c=90-e*o-o/2;return[l,c]}function Bl(t,e,n,r,a){if(t<0||t>=n||e<0||e>=r)return null;const s=(r-1-e)*n+t,l=a[s];return isFinite(l)?l:null}function Ze(t){Xt?t.style.cursor="crosshair":ht?t.style.cursor="grabbing":t.style.cursor="auto"}function sr(t,e,n){if(!U)return null;const r=t.getBoundingClientRect(),a=e-r.left,o=n-r.top;let s=(a+Q)/q;const l=(o+mt)/q,c=U.width,d=U.height;if(l<0||l>d)return null;let u=s;u=u%c,u<0&&(u+=c),u<0&&(u=0),u>=c&&(u=c*(1-Number.EPSILON));const f=u/c*360-180,h=90-l/d*180,g=Math.max(-180,Math.min(180,f)),S=Math.max(-90,Math.min(90,h));return!Number.isFinite(g)||!Number.isFinite(S)?null:{lat:S,lon:g}}function Fl(t,e){Xt=t,hn=t?e??null:null,t&&(ht=!1)}function Ol(t,e,n){if(!U)return null;const r=U.width,a=U.height;let o=e;for(;o>180;)o-=360;for(;o<-180;)o+=360;const s=(o+180)/360*r,l=(90-n)/180*a,c=s*q-Q,d=l*q-mt,u=t.getBoundingClientRect(),f=r*q,h=u.width/2;let g=c,S=Math.abs(c-h);for(let L=-f;L<=f;L+=f){const _=c+L,T=Math.abs(_-h);T<S&&(S=T,g=_)}return d<-a*q||d>u.height+a*q?null:{x:g,y:d}}function ql(t,e,n,r,a,o){Fl(o?.drawMode??!1,{onClick:o?.onDrawClick,onMove:o?.onDrawMove}),Qe=o?.onTransform??null,Ze(t),t.addEventListener("wheel",s=>{s.preventDefault();const l=t.getBoundingClientRect(),c=s.clientX-l.left,d=s.clientY-l.top,u=s.deltaY>0?.9:1.1,f=q*u;if(f>=.8&&f<=10){const S=(c+Q)/q,L=(d+mt)/q;q=f,Q=S*q-c,mt=L*q-d,e&&lr(t),Qe?.()}},{passive:!1}),t.addEventListener("mousedown",s=>{if(Xt&&s.button===0){const l=sr(t,s.clientX,s.clientY);l&&hn?.onClick?.(l);return}s.button===0&&(ht=!0,rr=s.clientX,ar=s.clientY,ir=Q,or=mt,t.style.cursor="grabbing")}),t.addEventListener("mousemove",s=>{if(Xt){const l=sr(t,s.clientX,s.clientY);l&&hn?.onMove?.(l),Vt();return}if(ht&&e){const l=s.clientX-rr,c=s.clientY-ar;Q=ir-l,mt=or-c,lr(t),Qe?.(),Vt()}else if(!ht&&Jr&&Fe&&U){const[l,c]=so(s,t);Vl(s.clientX,s.clientY,l,c,n,ea,na,ta)}}),t.addEventListener("mouseup",()=>{Xt||ht&&(ht=!1,Ze(t))}),t.addEventListener("mouseleave",()=>{if(Xt){Vt();return}ht&&(ht=!1,t.style.cursor="grab"),Vt()}),Ze(t)}function lr(t){if(!U)return;const e=t.getContext("2d");if(!e)return;const n=t.getBoundingClientRect();e.clearRect(0,0,n.width,n.height),e.save(),e.translate(-Q,-mt),e.scale(q,q),e.imageSmoothingEnabled=!1;const r=U.width,a=Q/q,o=(Q+n.width)/q,s=Math.floor(a/r)-1,l=Math.ceil(o/r)+1;for(let c=s;c<=l;c++)e.drawImage(U,c*r-.5,0);e.restore()}function pn(t,e,n,r,a,o,s,l){if(!e)return;const c=ce(t);if(!c){console.warn("No data to render");return}console.log("Rendering map data (full render)");const d=Pl(e);if(!d)return;const{ctx:u,rect:f,viewWidth:h,viewHeight:g}=d,[S,L]=t.shape;u.clearRect(0,0,f.width,f.height),u.save();const _=!!t?.metadata?.comparison||typeof t.model=="string"&&t.model.includes(" minus ");Jr=t,ea=s,na=l,ta=_;const T=new Array(g).fill(null).map(()=>new Float32Array(h).fill(NaN));let b=a,k=o;if(s&&l){const A=jr(a,o,s,l,{isDifference:_});b=A.min,k=A.max}Il(a,o,s,l,_);const C=(n.find(A=>A.name===r)||n[0]).colors.map(Kr);function y(A,O){const W=(A+180)/360*h,lt=(90-O)/180*g;return[W,lt]}const v=document.createElement("canvas");v.width=h,v.height=g;const $=v.getContext("2d");if(!$)return;const M=$.createImageData(h,g),w=M.data;console.log("Rendering map data");const x=Math.max(h/L,g/S)*.8,N=Math.ceil(x/2);for(let A=0;A<S;A++)for(let O=0;O<L;O++){const W=Bl(O,A,L,S,c);if(W===null)continue;const[lt,fe]=Rl(O,A,L,S),[An,Cn]=y(lt,fe);let Nn=W;s&&l&&(Nn=re(W,s,l,{isDifference:_}));const In=k-b,Pn=In===0?.5:Math.min(1,Math.max(0,(Nn-b)/In)),We=Math.floor(Pn*(C.length-1)),Rt=C[Math.min(We,C.length-1)],Ue=C[Math.min(We+1,C.length-1)],Ye=Pn*(C.length-1)-We,sa=Math.round(Rt.r+(Ue.r-Rt.r)*Ye),la=Math.round(Rt.g+(Ue.g-Rt.g)*Ye),ca=Math.round(Rt.b+(Ue.b-Rt.b)*Ye),da=Math.max(0,Math.floor(An-N)),ua=Math.min(h,Math.ceil(An+N)),fa=Math.max(0,Math.floor(Cn-N)),ha=Math.min(g,Math.ceil(Cn+N));for(let he=fa;he<ha;he++)for(let pe=da;pe<ua;pe++){const me=(he*h+pe)*4;w[me]=sa,w[me+1]=la,w[me+2]=ca,w[me+3]=255,T[he][pe]=W}}$.putImageData(M,0,0),U=v,Fe=T,u.clearRect(0,0,f.width,f.height),u.save(),u.translate(-Q,-mt),u.scale(q,q),u.imageSmoothingEnabled=!1;const I=U.width,B=Q/q,z=(Q+f.width)/q,rt=Math.floor(B/I)-1,R=Math.ceil(z/I)+1;for(let A=rt;A<=R;A++)u.drawImage(U,A*I,0);u.restore()}function Vl(t,e,n,r,a,o,s,l){if(!Fe||!U)return;let c=(n+Q)/q;const d=(r+mt)/q,u=U.width,f=U.height;c=(c%u+u)%u;const h=Math.floor(c),g=Math.floor(d);if(h>=0&&h<u&&g>=0&&g<f){const S=Fe?.[g]?.[h]??0;if(isFinite(S)){const L=c/u*360-180,_=90-d/f*180;Nl(t,e,_,L,S,a,l)}else Vt()}else Vt()}function bt(t){const e=new Date(t);return`${["January","February","March","April","May","June","July","August","September","October","November","December"][e.getMonth()]} ${e.getDate()}, ${e.getFullYear()}`}function Xl(t){const{date:e,timeRange:n,sidebarOpen:r,sidebarWidth:a,mode:o,compareMode:s,compareDateStart:l,compareDateEnd:c}=t;let d=0,u=0,f=0,h=0,g=0,S=0,L=0,_=100;if(n){const b=new Date(n.start),k=new Date(n.end),E=new Date(e);if(u=Math.floor((k.getTime()-b.getTime())/(1e3*60*60*24)),f=Math.floor((E.getTime()-b.getTime())/(1e3*60*60*24)),h=u>0?f/u*100:0,o==="Compare"&&s==="Dates"){const D=l?new Date(l):b,C=c?new Date(c):k;g=Math.max(0,Math.floor((D.getTime()-b.getTime())/(1e3*60*60*24))),S=Math.min(u,Math.floor((C.getTime()-b.getTime())/(1e3*60*60*24))),L=u>0?g/u*100:0,_=u>0?S/u*100:100}}const T=r?a+16:16;if(o==="Compare"&&s==="Dates"&&n){const b=bt(l||n.start),k=bt(c||n.end);return`
      <div class="time-slider-container" style="right: ${T}px">
        <div data-role="time-label" class="time-label">${b} – ${k}</div>
        <div class="time-slider-row dual-slider" data-role="dual-slider">
          <div
            class="dual-slider-track"
            aria-hidden="true"
          ></div>
          <div
            class="dual-slider-fill"
            data-role="dual-fill"
            style="--fill-start: ${L}%; --fill-end: ${_}%"
            aria-hidden="true"
          ></div>
          <input
            type="range"
            min="${d}"
            max="${u}"
            step="1"
            value="${g}"
            data-action="set-time-start"
            class="time-slider dual-thumb dual-thumb-start"
            aria-label="Start date"
          />
          <input
            type="range"
            min="${d}"
            max="${u}"
            step="1"
            value="${S}"
            data-action="set-time-end"
            class="time-slider dual-thumb dual-thumb-end"
            aria-label="End date"
          />
        </div>
      </div>
    `}return`
      <div class="time-slider-container" style="right: ${T}px">
        <div data-role="time-label" class="time-label">${bt(e)}</div>
        <div class="time-slider-row">
          <input
            type="range"
            min="${d}"
            max="${u}"
            step="1"
            value="${f}"
            data-action="set-time"
            class="time-slider"
            style="--slider-fill: ${h}%"
          />
        </div>
      </div>
    `}let Ft=null,mn=null;function zl(t){const{root:e,getTimeRange:n,onDateChange:r,getMode:a,getCompareMode:o,getCompareDates:s,onDateRangeChange:l}=t;mn=e.querySelector('[data-role="time-label"]')?.parentElement??null;const c=()=>a?.()==="Compare"&&o?.()==="Dates";e.querySelectorAll('[data-action="set-time"]').forEach(_=>_.addEventListener("input",()=>{if(c())return;const T=Number.parseInt(_.value,10),b=n();if(!Number.isNaN(T)&&b){const k=new Date(b.start);k.setDate(k.getDate()+T);const E=k.toISOString().split("T")[0],D=e.querySelector('[data-role="time-label"]');D&&(D.textContent=bt(E));const C=new Date(b.end),y=Math.floor((C.getTime()-new Date(b.start).getTime())/(1e3*60*60*24)),v=y>0?T/y*100:0;_.style.setProperty("--slider-fill",`${v}%`),Ft&&window.clearTimeout(Ft),Ft=window.setTimeout(()=>{r(E)},500)}}));const u=e.querySelectorAll('[data-action="set-time-start"]'),f=e.querySelectorAll('[data-action="set-time-end"]'),h=e.querySelector('[data-role="dual-fill"]'),g=(_,T,b,k,E)=>{const D=e.querySelector('[data-role="time-label"]'),C=new Date(b.start),y=new Date(b.start);C.setDate(C.getDate()+_),y.setDate(y.getDate()+T);const v=C.toISOString().split("T")[0],$=y.toISOString().split("T")[0];D&&(D.textContent=`${bt(v)} – ${bt($)}`);const M=new Date(b.end).getTime()-new Date(b.start).getTime(),w=Math.max(1,Math.floor(M/(1e3*60*60*24))),x=_/w*100,N=T/w*100;[h,k,E].forEach(B=>{B&&(B.style.setProperty("--fill-start",`${x}%`),B.style.setProperty("--fill-end",`${N}%`))})},S=(_,T,b)=>{_.addEventListener("input",()=>{if(!c())return;const k=n();if(!k)return;const E=Math.floor((new Date(k.end).getTime()-new Date(k.start).getTime())/(1e3*60*60*24));let D=Number.parseInt(b?_.value:T.value,10),C=Number.parseInt(b?T.value:_.value,10);if(Number.isNaN(D)||Number.isNaN(C))return;D=Math.max(0,Math.min(D,E)),C=Math.max(0,Math.min(C,E)),b&&D>C?(C=D,T.value=String(C)):!b&&C<D&&(D=C,T.value=String(D)),g(D,C,k,b?_:T,b?T:_);const y=new Date(k.start);y.setDate(y.getDate()+D);const v=new Date(k.start);v.setDate(v.getDate()+C);const $=y.toISOString().split("T")[0],M=v.toISOString().split("T")[0];Ft&&window.clearTimeout(Ft),Ft=window.setTimeout(()=>{l?.($,M)},300)})},L=_=>{const T=u[0],b=f[0];!T||!b||(_==="start"?(T.style.zIndex="4",b.style.zIndex="3"):(T.style.zIndex="3",b.style.zIndex="4"))};if(u.length&&f.length){u.forEach((b,k)=>{const E=f[k]||f[0];S(b,E,!0),b.addEventListener("pointerdown",()=>L("start"))}),f.forEach((b,k)=>{const E=u[k]||u[0];S(b,E,!1),b.addEventListener("pointerdown",()=>L("end"))}),u.forEach(b=>b.addEventListener("focus",()=>L("start"))),f.forEach(b=>b.addEventListener("focus",()=>L("end")));const _=(b,k)=>{b.addEventListener("pointerdown",E=>{if(!c())return;const D=n();if(!D)return;const C=b.getBoundingClientRect(),y=Math.min(1,Math.max(0,(E.clientX-C.left)/C.width)),v=Math.max(1,Math.floor((new Date(D.end).getTime()-new Date(D.start).getTime())/(1e3*60*60*24))),$=Number.parseInt(b.value,10),w=(Number.isNaN($)?0:Math.max(0,Math.min($,v)))/v;Math.abs(y-w)*C.width>14&&(E.preventDefault(),E.stopPropagation(),L(b===k?"end":"start"))})};if(_(u[0],f[0]),_(f[0],u[0]),c()){const b=n(),k=s?.();if(b&&k){const E=Math.max(0,Math.floor((new Date(k.start).getTime()-new Date(b.start).getTime())/864e5)),D=Math.max(0,Math.floor((new Date(k.end).getTime()-new Date(b.start).getTime())/(1e3*60*60*24))),C=u[0],y=f[0];C.value=String(E),y.value=String(Math.max(D,E)),g(E,Math.max(D,E),b,C,y)}}e.querySelectorAll(".dual-slider").forEach(b=>{b.addEventListener("pointermove",k=>{if(!c())return;const E=n();if(!E)return;const D=u[0],C=f[0];if(!D||!C)return;const y=b.getBoundingClientRect(),v=Math.min(1,Math.max(0,(k.clientX-y.left)/y.width)),$=Math.max(1,Math.floor((new Date(E.end).getTime()-new Date(E.start).getTime())/(1e3*60*60*24)));let M=Number.parseInt(D.value,10),w=Number.parseInt(C.value,10);Number.isNaN(M)&&(M=0),Number.isNaN(w)&&(w=$);const x=M/$,N=w/$,I=Math.abs(v-x)<=Math.abs(v-N);L(I?"start":"end")})})}}function Hl(t,e){if(mn){const n=t?e+16:16;mn.style.right=`${n}px`}}function Ln(t){const e=t.toLowerCase();return e==="historical"?"Historical":e==="ssp245"?"SSP245":e==="ssp370"?"SSP370":e==="ssp585"?"SSP585":t}function Lt(t){return new Date(t)}function kn(t){if(!t.length)return Pt("Historical");let e="1900-01-01",n="2100-12-31";return t.forEach((r,a)=>{const o=Pt(r);if(a===0){e=o.start,n=o.end;return}e=Lt(o.start)>Lt(e)?o.start:e,n=Lt(o.end)<Lt(n)?o.end:n}),{start:e,end:n}}function gn(t,e){const n=Lt(t),r=Lt(e.start),a=Lt(e.end);return n<r?e.start:n>a?e.end:t}const gt=["Historical","SSP245","SSP370","SSP585"],j=["ACCESS-CM2","CanESM5","CESM2","CMCC-CM2-SR5","EC-Earth3","GFDL-ESM4","INM-CM5-0","IPSL-CM6A-LR","MIROC6","MPI-ESM1-2-HR","MRI-ESM2-0"],kt=["tas","pr","rsds","hurs","rlds","sfcWind","tasmin","tasmax"],Wl={SSP245:"A moderate scenario (2015-2100) that assumes we take active measures against climate change. This represents a realistic path where significant climate protection policies are implemented, leading to moderate warming by the end of the century.",SSP370:"A moderate-to-high scenario (2015-2100) representing a middle ground. This path assumes some climate action is taken, but not enough to prevent substantial warming. It falls between optimistic and pessimistic outcomes.",SSP585:"A pessimistic scenario (2015-2100) representing a worst-case path with minimal climate action. This shows what happens if we continue with current trends and take little to no measures against climate change, leading to severe warming.",Historical:"Historical climate simulation (1950-2014) based on past conditions. This represents simulated climate data for the historical period, used as a baseline to compare against future projections."},Ul={tas:"Near-Surface Air Temperature",pr:"Precipitation",rsds:"Surface Downwelling Shortwave Radiation",hurs:"Near-Surface Relative Humidity",rlds:"Surface Downwelling Longwave Radiation",sfcWind:"Daily-Mean Near-Surface Wind Speed",tasmin:"Daily Minimum Near-Surface Air Temperature",tasmax:"Daily Maximum Near-Surface Air Temperature"},Yl={tas:"The air temperature near the Earth's surface, measured in Kelvin.",pr:"The amount of water that falls from the atmosphere to the surface, measured as mass per unit area per unit time.",rsds:"Incoming solar radiation reaching the Earth's surface, measured in Watts per square meter.",hurs:"The amount of moisture in the air relative to the maximum it can hold, expressed as a percentage.",rlds:"Incoming thermal radiation from the atmosphere, measured in Watts per square meter.",sfcWind:"The average wind speed near the surface over a day, measured in meters per second.",tasmin:"The lowest air temperature near the surface during a day, measured in Kelvin.",tasmax:"The highest air temperature near the surface during a day, measured in Kelvin."},Kl={"ACCESS-CM2":"Developed by Australia's research institutions. This model is part of the global CMIP6 ensemble, providing climate projections that contribute to our understanding of future climate patterns.",CanESM5:"The Canadian Earth System Model version 5, developed by Environment and Climate Change Canada. This model represents North American climate research and contributes valuable projections to the global climate science community.",CESM2:"The Community Earth System Model version 2, developed by the National Center for Atmospheric Research (NCAR) in the United States. One of the most widely used models in climate research, known for its comprehensive representation of Earth's climate system.","CMCC-CM2-SR5":"Developed by the Euro-Mediterranean Center on Climate Change (CMCC) in Italy. This model provides European perspectives on climate change and is particularly valuable for understanding Mediterranean and European climate patterns.","EC-Earth3":"A collaborative European climate model developed by multiple research institutions across Europe. This model combines expertise from various European countries to provide comprehensive climate projections.","GFDL-ESM4":"Developed by NOAA's Geophysical Fluid Dynamics Laboratory in the United States. This model is known for its advanced representation of ocean and atmosphere interactions, providing detailed climate projections.","INM-CM5-0":"Developed by the Institute of Numerical Mathematics in Russia. This model contributes a unique perspective from Russian climate research to the global ensemble of climate models.","IPSL-CM6A-LR":"Developed by the Institut Pierre-Simon Laplace in France. This model is part of a long-standing French climate modeling tradition and provides important contributions to understanding global climate dynamics.",MIROC6:"Developed by a Japanese research consortium. This model represents Asian climate research expertise and contributes valuable insights, particularly for understanding climate patterns in the Asia-Pacific region.","MPI-ESM1-2-HR":"Developed by the Max Planck Institute in Germany. This high-resolution model provides detailed climate projections and is known for its sophisticated representation of Earth's climate system.","MRI-ESM2-0":"Developed by Japan's Meteorological Research Institute. This model contributes Japanese climate research expertise to the global ensemble, providing valuable perspectives on climate change projections."},Y=[{name:"Viridis",colors:["#440154","#3b528b","#21908d","#5dc863","#fde725"]},{name:"Magma",colors:["#000004","#3b0f70","#8c2981","#de4968","#fe9f6d"]},{name:"Cividis",colors:["#00204c","#31456a","#6b6d7f","#a59c8f","#fdea9b"]},{name:"Thermal",colors:["#04142f","#155570","#1fa187","#f8c932","#f16623"]}],m={page:{position:"relative",minHeight:"100vh",color:"white",overflow:"hidden",fontFamily:"Inter, system-ui, sans-serif"},bgLayer1:{position:"absolute",inset:0,background:"linear-gradient(135deg, #05070f, #0b1326)"},bgLayer2:{position:"absolute",inset:0,background:"radial-gradient(circle at 20% 20%, rgba(56,189,248,0.12), transparent 32%), radial-gradient(circle at 80% 10%, rgba(139,92,246,0.15), transparent 30%), radial-gradient(circle at 50% 70%, rgba(34,197,94,0.08), transparent 28%)"},bgOverlay:{position:"absolute",inset:0,background:"#050505",opacity:.35},branding:{position:"fixed",top:16,left:16,display:"flex",alignItems:"center",gap:12,padding:"8px 0",background:"transparent",border:"none",borderRadius:0,zIndex:"9999",boxShadow:"none",backdropFilter:"none",pointerEvents:"auto"},brandIcon:{width:38,height:38,position:"relative",display:"grid",placeItems:"center",filter:"drop-shadow(0 8px 18px rgba(0, 0, 0, 0.42))",transition:"transform 160ms ease, filter 160ms ease","--iris-x":"0px","--iris-y":"0px","--pupil-x":"0px","--pupil-y":"0px","--blink-open":"1"},brandSvg:{width:"100%",height:"100%",display:"block"},brandOutline:{stroke:"white",strokeWidth:5,strokeLinecap:"round",strokeLinejoin:"round",fill:"none",opacity:.92},brandLids:{transform:"translate(60px, 40px) scaleY(var(--blink-open, 1)) translate(-60px, -40px)",transformOrigin:"60px 40px",transition:"none"},brandClipRect:{transform:"translate(60px, 40px) scaleY(var(--blink-open, 1)) translate(-60px, -40px)",transformOrigin:"60px 40px",transition:"none"},brandIrisGroup:{transform:"translate(var(--iris-x, 0px), var(--iris-y, 0px))",transition:"none",transformBox:"fill-box",transformOrigin:"center center"},brandIris:{stroke:"white",strokeWidth:5,fill:"rgba(255, 255, 255, 0.08)"},brandPupilGroup:{transform:"translate(var(--pupil-x, 0px), var(--pupil-y, 0px))",transition:"none",transformOrigin:"center center"},brandEyeContent:{clipPath:"url(#brand-eye-clip)"},brandPupil:{fill:"white"},brandHighlight:{fill:"white",opacity:.92},brandName:{fontSize:18,fontWeight:700,letterSpacing:.6,color:"white",textTransform:"none",textShadow:"0 8px 20px rgba(0, 0, 0, 0.45)"},field:{minWidth:0,display:"flex",flexDirection:"column",gap:4},fieldLabel:{fontSize:11,letterSpacing:.5,color:"var(--text-secondary)",textTransform:"uppercase"},mapArea:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:10,textAlign:"center",pointerEvents:"none",zIndex:1},drawOverlay:{position:"absolute",inset:0,background:"rgba(5, 10, 20, 0.28)",backdropFilter:"blur(1px)",pointerEvents:"none",zIndex:8},drawOverlayCanvas:{position:"absolute",inset:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:9},drawPrompt:{position:"absolute",top:16,left:"50%",transform:"translateX(-50%)",padding:"10px 14px",borderRadius:12,background:"rgba(15, 23, 42, 0.92)",border:"1px solid var(--border-medium)",boxShadow:"var(--shadow-elevated)",fontWeight:800,fontSize:13,color:"var(--text-primary)",pointerEvents:"none",zIndex:10,textAlign:"center"},drawPromptSub:{marginTop:4,fontSize:12,fontWeight:600,color:"var(--text-secondary)"},loadingIndicator:{position:"absolute",left:18,bottom:80,display:"flex",alignItems:"center",gap:12,padding:0,pointerEvents:"auto",zIndex:20,minWidth:160},loadingSpinner:{width:18,height:18,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.18)",borderTop:"2px solid #34d399",animation:"sv-spin 1s linear infinite",flexShrink:0},loadingTextGroup:{display:"flex",flexDirection:"column",gap:4,alignItems:"flex-start",minWidth:0},loadingText:{fontSize:12.5,fontWeight:700,color:"var(--text-primary)",letterSpacing:.3},loadingSubtext:{fontSize:11.5,color:"var(--text-secondary)",letterSpacing:.2},loadingBar:{position:"relative",width:120,height:6,borderRadius:999,background:"rgba(255, 255, 255, 0.08)",overflow:"hidden"},loadingBarFill:{position:"absolute",inset:0,borderRadius:999,background:"linear-gradient(90deg, rgba(52, 211, 153, 0.9), rgba(125, 211, 252, 0.9))",transition:"width 140ms ease",width:"0%"},compareInfoWrap:{position:"fixed",right:24,bottom:88,display:"flex",alignItems:"center",pointerEvents:"auto",zIndex:1e4},compareInfoButton:{padding:0,background:"transparent",border:"none",color:"var(--text-primary)",fontWeight:700,fontSize:13,letterSpacing:.2,cursor:"pointer",textDecoration:"underline"},infoModalOverlay:{position:"fixed",inset:0,background:"transparent",backdropFilter:"none",zIndex:200,display:"flex",alignItems:"center",justifyContent:"center",padding:16},infoModal:{width:"min(480px, 92vw)",background:"rgba(12, 16, 24, 0.98)",border:"1px solid var(--border-default)",borderRadius:14,boxShadow:"var(--shadow-elevated)",color:"var(--text-primary)",padding:20,position:"relative",maxWidth:"520px"},infoModalHeader:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,marginBottom:12},infoModalTitle:{fontSize:16,fontWeight:900,letterSpacing:.2,background:"var(--gradient-accent)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",color:"transparent"},infoModalClose:{width:32,height:32,borderRadius:8,border:"none",background:"transparent",color:"var(--text-secondary)",cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",fontWeight:700},infoModalBody:{fontSize:14,lineHeight:1.6,color:"var(--text-primary)",display:"block",textAlign:"left",whiteSpace:"normal",wordBreak:"break-word"},infoModalFooter:{marginTop:18,display:"flex",justifyContent:"center"},infoModalConfirm:{padding:"10px 16px",borderRadius:10,border:"1px solid var(--accent-border)",background:"var(--gradient-primary)",color:"white",fontWeight:700,cursor:"pointer",boxShadow:"var(--shadow-combined)"},canvasToggle:{position:"fixed",top:14,display:"flex",alignItems:"center",gap:8,pointerEvents:"auto",zIndex:100,transition:"right 0.25s ease"},canvasSwitch:{position:"relative",display:"grid",gridTemplateColumns:"1fr 1fr",gap:0,padding:3,borderRadius:11,background:"var(--dark-bg)",border:"var(--border-base)",boxShadow:"var(--shadow-elevated)",zIndex:101},canvasIndicator:{position:"absolute",top:3,bottom:3,left:3,width:"calc(50% - 3px)",borderRadius:9,background:"var(--gradient-indicator)",boxShadow:"var(--shadow-canvas), var(--shadow-inset)",transition:"transform 180ms ease",zIndex:0,pointerEvents:"none"},canvasBtn:{width:40,height:40,borderRadius:9,border:"1px solid transparent",background:"var(--bg-transparent)",color:"var(--text-secondary)",cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",transition:"color 120ms ease",position:"relative",zIndex:1},canvasBtnActive:{color:"white"},mapTitle:{fontSize:18,fontWeight:600},mapSubtitle:{fontSize:14,color:"var(--text-secondary)"},modeSwitch:{position:"relative",display:"grid",gridTemplateColumns:"1fr 1fr",gap:4,padding:2,borderRadius:10,border:"1px solid var(--border-subtle)",background:"var(--bg-subtle)",boxShadow:"none"},modeIndicator:{position:"absolute",top:2,bottom:2,left:2,width:"calc(50% - 2px)",borderRadius:8,background:"var(--gradient-mode-indicator)",boxShadow:"var(--shadow-combined)",transition:"transform 200ms ease",zIndex:0},modeBtn:{flex:1,padding:"8px 0",borderRadius:8,border:"none",color:"var(--text-secondary)",cursor:"pointer",transition:"all 0.15s ease",background:"var(--bg-transparent)",textAlign:"center",fontSize:12.5,fontWeight:700,letterSpacing:.2,outline:"none",boxShadow:"none",position:"relative",zIndex:1},modeBtnActive:{background:"var(--gradient-primary)",border:"none",color:"white",boxShadow:"var(--shadow-combined)"},tabSwitch:{position:"absolute",left:32,right:12,bottom:-8,display:"flex",gap:10,padding:"0 8px",alignItems:"flex-end",pointerEvents:"auto",zIndex:0},tabBtn:{borderRadius:"14px 14px 0 0",padding:"12px 18px",background:"var(--bg-strong)",color:"var(--text-secondary)",fontWeight:700,fontSize:13,letterSpacing:.35,cursor:"pointer",transition:"all 0.18s ease",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.06), 0 8px 18px rgba(0,0,0,0.32)",borderTop:"var(--border-base)",borderRight:"var(--border-base)",borderLeft:"var(--border-base)",borderBottom:"none",transform:"translateY(4px)"},tabBtnActive:{background:"var(--gradient-tab-active)",color:"white",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.12), 0 12px 26px rgba(0,0,0,0.42)",borderTop:"var(--border-active)",borderRight:"var(--border-active)",borderLeft:"var(--border-active)",borderBottom:"none",transform:"translateY(-4px)",zIndex:1},modeViewport:{overflow:"hidden",width:"100%",position:"relative",flex:1,minHeight:0,height:0},modeTrack:{display:"grid",gridTemplateColumns:"1fr 1fr",width:"200%",height:"100%",transition:"transform 220ms ease"},modePane:{width:"100%",height:"100%",paddingRight:4,overflowY:"auto",overflowX:"hidden",scrollbarGutter:"stable",minHeight:0,maxHeight:"100%"},chatBox:{display:"flex",alignItems:"center",gap:10,padding:"12px 14px",borderRadius:14,border:"1px solid var(--border-default)",background:"rgba(15,18,25,0.96)",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.05), 0 8px 20px rgba(0,0,0,0.38)"},chatInput:{flex:1,padding:"12px 0",borderRadius:8,border:"none",background:"var(--bg-transparent)",color:"white",fontSize:14,lineHeight:1.4,outline:"none",minHeight:24},chatSend:{padding:"10px 14px",borderRadius:12,border:"1px solid var(--accent-border-strong)",background:"var(--gradient-primary)",color:"white",fontWeight:700,fontSize:14,letterSpacing:.1,cursor:"pointer",boxShadow:"0 10px 22px rgba(0,0,0,0.38), var(--shadow-inset)",transition:"transform 120ms ease, box-shadow 120ms ease"},chatStack:{display:"flex",flexDirection:"column",gap:12},chatLead:{fontSize:13,color:"var(--text-secondary)",lineHeight:1.45,marginTop:10},chatMessages:{display:"flex",flexDirection:"column",gap:10,padding:"4px 0 6px",paddingRight:0,width:"100%",boxSizing:"border-box"},chatBubble:{maxWidth:"100%",width:"fit-content",padding:"16px 16px",borderRadius:12,fontSize:13,lineHeight:1.4,boxShadow:"0 6px 14px rgba(0,0,0,0.3)",boxSizing:"border-box"},chatBubbleUser:{alignSelf:"flex-end",background:"var(--gradient-chat-user)",border:"1px solid rgba(125,211,252,0.45)",color:"white",marginRight:26},chatBubbleAgent:{alignSelf:"flex-start",background:"rgba(20,24,31,0.95)",border:"1px solid var(--border-medium)",color:"var(--text-primary)"},sectionTitle:{fontSize:13,fontWeight:700,color:"var(--text-primary)",letterSpacing:.3,textTransform:"uppercase"},paramGrid:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},range:{width:"100%",background:"var(--bg-transparent)",appearance:"none",WebkitAppearance:"none",height:10,outline:"none",padding:0,margin:0},resolutionRow:{display:"flex",alignItems:"center",gap:12},resolutionValue:{fontSize:12.5,color:"var(--text-secondary)",minWidth:60,textAlign:"right"},chartPanel:{width:"min(1200px, 100%)",background:"transparent",border:"none",borderRadius:0,padding:0,boxShadow:"none",backdropFilter:"none"},chartHeader:{textAlign:"center",marginBottom:12},chartTitle:{fontSize:18,fontWeight:800,color:"var(--text-primary)"},chartPlotWrapper:{width:"100%",minHeight:360,background:"transparent",border:"none",borderRadius:0,padding:0,position:"relative"},chartEmpty:{textAlign:"center",color:"var(--text-secondary)",padding:"40px 16px",lineHeight:1.6},chartError:{color:"#fca5a5",background:"rgba(248,113,113,0.08)",border:"1px solid rgba(248,113,113,0.35)",borderRadius:12,padding:14,fontSize:13,lineHeight:1.5},chipRow:{display:"flex",flexWrap:"wrap",gap:8},chip:{padding:"8px 10px",borderRadius:12,border:"1px solid var(--border-medium)",background:"rgba(255,255,255,0.04)",color:"var(--text-primary)",cursor:"pointer",fontSize:12.5,fontWeight:700,letterSpacing:.2,transition:"all 140ms ease"},chipActive:{borderColor:"rgba(167,139,250,0.65)",background:"rgba(167,139,250,0.16)",boxShadow:"0 0 0 1px rgba(167,139,250,0.35)"}},i={mode:"Explore",panelTab:"Manual",sidebarOpen:!0,canvasView:"map",scenario:gt[0],model:j[0],variable:kt[0],date:"2000-01-01",palette:Y[0].name,resolution:2,selectedUnit:se(kt[0]).label,chartMode:"single",chartDate:"2026-01-16",chartVariable:kt[0],chartUnit:se(kt[0]).label,chartScenarios:["SSP245","SSP370","SSP585"],chartModels:[...j],chartDropdown:{scenariosOpen:!1,modelsOpen:!1},chartLoadingProgress:{total:0,done:0},chartSamples:[],chartBoxes:null,chartLoading:!1,chartError:null,chartLocation:"World",chartLocationName:null,chartLocationSearchQuery:"",chartLocationSearchResults:[],chartLocationSearchLoading:!1,chartLocationSearchError:null,chartPolygon:null,chartPoint:null,drawState:{active:!1,points:[],previewPoint:null},pointSelectActive:!1,chatInput:"",chatMessages:[],compareMode:"Scenarios",availableModels:[],compareScenarioA:"SSP245",compareScenarioB:"SSP585",compareModelA:j[0],compareModelB:j[1]??j[0],compareDateStart:"1962-06-28",compareDateEnd:"2007-06-28",isLoading:!1,loadingProgress:0,dataError:null,currentData:null,apiAvailable:null,dataMin:null,dataMax:null,timeRange:null,metaData:void 0,compareInfoOpen:!1};let Je=null,it=null,Yt=null,X=null,xe=null,St=null,yt=null,$t=null,dt=null,Tt=null,we=0;const Gl=500;function jl(t){return t.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}function p(t){return Object.entries(t).filter(([,e])=>e!=null).map(([e,n])=>{const r=e.startsWith("--")?e:jl(e),a=typeof n=="number"?`${n}px`:String(n);return`${r}:${a}`}).join(";")}function H(...t){return t.reduce((e,n)=>n?{...e,...n}:e,{})}function zt(t){return t.replace(/[&<>"']/g,e=>{switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return e}})}function Ht(t){const e=new Date(t);return Number.isNaN(e.getTime())?t:e.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}function ra(t,e){return e?.variable_metadata?.[t]?.name||e?.variable_metadata?.[t]?.description||t}function Ql(t){const e=ra(t.variable,t.metaData),n=t.selectedUnit||t.metaData?.variable_metadata?.[t.variable]?.unit||"",r=n?`${n}`:"the dataset's native units";switch(t.compareMode){case"Dates":{const a=Ht(t.compareDateStart),o=Ht(t.compareDateEnd);return{title:"Comparing two dates",paragraphs:[`We are comparing ${e} on ${a} versus ${o} under the ${t.scenario} scenario using the ${t.model} model.`,`Values on the map represent ${o} minus ${a} in ${r}. A value of X means ${e} was X ${n||""} higher on ${o} than on ${a} (negative values mean it was lower).`]}}case"Models":{const a=Ht(t.date);return{title:"Comparing two models",paragraphs:[`We are comparing ${e} between ${t.compareModelB} and ${t.compareModelA} on ${a} within the ${t.scenario} scenario.`,`Each value shows ${t.compareModelB} minus ${t.compareModelA} in ${r}. Positive numbers mean ${e} is higher in ${t.compareModelB}; negative means it is higher in ${t.compareModelA}.`]}}default:{const a=Ht(t.date),o=t.compareScenarioA,s=t.compareScenarioB;return{title:"Comparing two scenarios",paragraphs:[`We are comparing ${e} for ${s} versus ${o} on ${a} using the ${t.model} model.`,`Values show ${s} minus ${o} in ${r}. A value of X means ${e} is X ${n||""} higher under ${s} than under ${o}; negative values mean it is lower.`]}}}}function Zl(t){if(t.mode!=="Compare"||t.canvasView!=="map")return"";const e=Ql(t),n=e.paragraphs.map((c,d)=>{const f=d===e.paragraphs.length-1?"0":"0 0 12px 0",h=c.replace(/(\bX\b|ΔX)/g,'<span style="color: var(--accent-purple);">$1</span>');return`<p style="display:block; margin:${f}; line-height:1.6; white-space: normal; word-break: break-word;">${h}</p>`}).join(""),r=t.sidebarOpen?Z+24:24,a=t.mode==="Compare"&&t.compareMode==="Dates"?120:88,o=H(m.infoModalOverlay,{left:"0",right:"0",width:"100%",justifyContent:"center",paddingLeft:0}),s=H(m.infoModal,{alignSelf:"center",marginLeft:"auto",marginRight:"auto"}),l=t.compareInfoOpen?`
      <div data-role="compare-info-overlay" class="compare-info-overlay" style="${p(o)}">
        <div style="${p(s)}" role="dialog" aria-modal="true" aria-label="${e.title}">
          <div style="${p(m.infoModalHeader)}">
            <div style="${p(m.infoModalTitle)}">${e.title}</div>
            <button type="button" data-action="close-compare-info" style="${p(m.infoModalClose)}" aria-label="Close info dialog">✕</button>
          </div>
          <div style="${p(m.infoModalBody)}">
            ${n}
          </div>
          <div style="${p(m.infoModalFooter)}">
            <button type="button" data-action="close-compare-info" style="${p(m.infoModalConfirm)}">Got it</button>
          </div>
        </div>
      </div>
    `:"";return`
      <div data-role="compare-info-trigger" style="${p(H(m.compareInfoWrap,{right:r,bottom:a}))}">
        <button type="button" data-action="open-compare-info" style="${p(m.compareInfoButton)}">
          What am I seeing?
        </button>
      </div>
      ${l}
    `}async function Jl(){try{const t=await Cl();i.apiAvailable=t}catch{i.apiAvailable=!1}}function tc(t){if(t==="Historical")return"2000-01-01";const e=new Date,n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return n<2015?"2015-01-01":n>2100?"2100-12-31":`${n}-${r}-${a}`}function Pt(t){return t==="Historical"?{start:"1950-01-01",end:"2014-12-31"}:{start:"2015-01-01",end:"2100-12-31"}}function Wt(t,e){const n=Pt(e),r=new Date(t),a=new Date(n.start),o=new Date(n.end);return r<a?n.start:r>o?n.end:t}function ec(t){let e=1/0,n=-1/0;for(let r=0;r<t.length;r++){const a=t[r];isFinite(a)&&(e=Math.min(e,a),n=Math.max(n,a))}if(!isFinite(e)||!isFinite(n))throw new Error("No valid numeric values returned from dataset.");return{min:e,max:n}}function nc(t,e){let n=0,r=0;for(let a=0;a<t.length;a++){const o=t[a];if(!isFinite(o))continue;const s=e==="hurs"?Math.min(o,100):o;n+=s,r+=1}if(!r)throw new Error("No valid numeric values returned from dataset.");return n/r}function rc(t,e){let n=!1;for(let r=0,a=e.length-1;r<e.length;a=r++){const o=e[r].lon,s=e[r].lat,l=e[a].lon,c=e[a].lat;s>t.lat!=c>t.lat&&t.lon<(l-o)*(t.lat-s)/(c-s+Number.EPSILON)+o&&(n=!n)}return n}function ac(t,e,n,r){const[a,o]=n,s=360/o,l=180/a;let c=0,d=0;for(let u=0;u<a;u++){const f=90-u*l-l/2;for(let h=0;h<o;h++){const g=h*s+s/2,S=g>180?g-360:g,L=(a-1-u)*o+h,_=t[L];if(!isFinite(_))continue;const T=e==="hurs"?Math.min(_,100):_;rc({lat:f,lon:S},r)&&(c+=T,d+=1)}}if(!d)throw new Error("The selected region does not contain valid data points.");return c/d}function ic(t,e,n=.75){const r=t.lat-e.lat,a=t.lon-e.lon;return Math.hypot(r,a)<=n}function oc(t,e,n,r){const[a,o]=n,l=((r.lon+360)%360+360)%360/360*o-.5,c=(90-r.lat)/180*a-.5,d=(_,T,b)=>Math.min(b,Math.max(T,_)),u=d(Math.round(l),0,o-1),f=d(Math.round(c),0,a-1),h=(_,T)=>(a-1-T)*o+_,g=(_,T)=>{const b=(_%o+o)%o,k=d(T,0,a-1),E=h(b,k),D=t[E];return Number.isFinite(D)?D:null};let S=g(u,f);if(S===null){let T=null;for(let b=1;b<=3&&T===null;b++)for(let k=-b;k<=b;k++){for(let E=-b;E<=b;E++){if(Math.abs(E)!==b&&Math.abs(k)!==b)continue;const D=g(u+E,f+k);if(D!==null){T=D;break}}if(T!==null)break}S=T}if(S===null)throw new Error("No valid data at the selected point.");const L=e==="hurs"?Math.min(S,100):S;if(!Number.isFinite(L))throw new Error(`Invalid value at point: ${L}`);return L}function Qt(){return{active:!1,points:[],previewPoint:null}}function sc(t){Yt||(Yt=e=>{e.key==="Enter"&&i.drawState.active&&(e.preventDefault(),t())},window.addEventListener("keydown",Yt))}function aa(){Yt&&(window.removeEventListener("keydown",Yt),Yt=null)}function Tn(t){const e=i.drawState.active||i.pointSelectActive,n=i.metaData?.variable_metadata[i.variable]?.unit||"";ql(t,i.currentData,n,i.variable,i.selectedUnit,{drawMode:e,onDrawClick:i.pointSelectActive?mc:pc,onDrawMove:i.drawState.active?hc:void 0,onTransform:()=>{He(),cr()}}),cr()}function He(){if(!X)return;const t=X.querySelector("#draw-overlay-canvas"),e=it||X.querySelector("#map-canvas");if(!t||!e)return;const n=e.getBoundingClientRect(),r=window.devicePixelRatio||1;t.width=n.width*r,t.height=n.height*r,t.style.width=`${n.width}px`,t.style.height=`${n.height}px`;const a=t.getContext("2d");if(!a)return;a.save(),a.scale(r,r),a.clearRect(0,0,n.width,n.height);const o=[...i.drawState.points],s=i.drawState.previewPoint?[...o,i.drawState.previewPoint]:o,l=[];if(s.forEach(c=>{const d=Ol(e,c.lon,c.lat);d&&l.push(d)}),!l.length){a.restore();return}a.lineWidth=2,a.strokeStyle="#34d399",a.fillStyle="rgba(52,211,153,0.18)",a.beginPath(),a.moveTo(l[0].x,l[0].y);for(let c=1;c<l.length;c++)a.lineTo(l[c].x,l[c].y);l.length>2&&(a.closePath(),a.fill()),a.stroke(),l.forEach(({x:c,y:d},u)=>{a.beginPath(),a.fillStyle=u===0?"#10b981":"#34d399",a.arc(c,d,4,0,Math.PI*2),a.fill(),a.strokeStyle="#0f172a",a.lineWidth=1,a.stroke()}),a.restore()}function lc(){return i.drawState.active?`
      <div style="${p(m.drawOverlay)}"></div>
      <canvas
        id="draw-overlay-canvas"
        style="${p(m.drawOverlayCanvas)}"
      ></canvas>
      <div style="${p(m.drawPrompt)}">
        <div>Draw the region you want to explore</div>
        <div style="${p(m.drawPromptSub)}">
          Click to add points · Enter or click first point to finish
        </div>
      </div>
    `:""}function cr(){if(!X)return;const t=X.querySelector("#point-overlay-marker"),e=it||X.querySelector("#map-canvas");!t||!e||!i.pointSelectActive||(t.style.left="0px",t.style.top="0px",t.style.right="0px",t.style.bottom="0px",t.style.width="100%",t.style.height="100%")}function cc(){return i.pointSelectActive?`
      <div style="${p(m.drawOverlay)}"></div>
      <div
        id="point-overlay-marker"
        style="${p({position:"absolute",inset:0,pointerEvents:"none",zIndex:9})}"
      ></div>
      <div style="${p(m.drawPrompt)}">
        <div>Click a point to sample</div>
        <div style="${p(m.drawPromptSub)}">
          The chart will load data for this single location
        </div>
      </div>
    `:""}function dr(){i.chartLocation="Draw",i.chartPolygon=null,i.chartLocationName=null,i.chartLocationSearchResults=[],i.chartLocationSearchQuery="",i.chartLocationSearchError=null,i.chartLocationSearchLoading=!1,i.chartError=null,i.pointSelectActive=!1,i.drawState={active:!0,points:[],previewPoint:null},i.canvasView="map",sc(ia),P(),at()}function Oe(){i.drawState=Qt(),aa()}function ur(){i.chartLocation="Point",i.chartPolygon=null,i.chartPoint=null,i.chartLocationName=null,i.chartLocationSearchResults=[],i.chartLocationSearchQuery="",i.chartLocationSearchError=null,i.chartLocationSearchLoading=!1,i.chartError=null,i.drawState=Qt(),i.chartUnit=se(i.chartVariable).label,i.pointSelectActive=!0,i.canvasView="map",P(),at()}function qe(){i.pointSelectActive=!1}async function dc(t){const e=t.trim();if(!e)return[];const n=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(e)}&limit=5&addressdetails=1`,r=await fetch(n,{headers:{Accept:"application/json","User-Agent":"climate-visualization-app/1.0"}});if(!r.ok)throw new Error("Location search failed. Please try again.");return(await r.json()).map(o=>({displayName:o.display_name,lat:Number(o.lat),lon:Number(o.lon)})).filter(o=>Number.isFinite(o.lat)&&Number.isFinite(o.lon))}function uc(t){Tt!==null&&(window.clearTimeout(Tt),Tt=null),i.chartLocation="Search",i.chartPoint={lat:t.lat,lon:t.lon},i.chartLocationName=t.displayName,i.chartLocationSearchError=null,i.chartLocationSearchResults=[],i.chartLocationSearchLoading=!1,i.chartLocationSearchQuery="",i.chartError=null,i.chartPolygon=null,i.pointSelectActive=!1,i.drawState=Qt(),i.canvasView="chart",Oe(),qe(),P(),xt()}async function fc(t){const e=t.trim(),n=++we;if(i.chartLocation="Search",i.chartLocationSearchQuery=t,i.chartLocationSearchError=null,i.chartLocationSearchResults=[],i.chartLocationName=null,i.chartPoint=null,i.chartError=null,i.chartPolygon=null,i.pointSelectActive=!1,i.drawState=Qt(),i.canvasView="chart",Oe(),qe(),!e){i.chartLocationSearchLoading=!1,i.chartLocationSearchResults=[],i.chartLocationSearchError=null,P();return}i.chartLocationSearchLoading=!0,P();try{const r=await dc(e);if(n!==we)return;i.chartLocationSearchResults=r,r.length||(i.chartLocationSearchError="No places found for that query.")}catch(r){if(n!==we)return;i.chartLocationSearchError=r instanceof Error?r.message:"Search failed."}finally{if(n!==we)return;i.chartLocationSearchLoading=!1,P()}}function hc(t){i.drawState.active&&(i.drawState={...i.drawState,previewPoint:t},He())}function pc(t){if(!i.drawState.active)return;const e=i.drawState.points;if(e.length>=3&&ic(t,e[0])){ia();return}i.drawState={...i.drawState,points:[...e,t],previewPoint:t},He()}function mc(t){i.pointSelectActive&&(i.chartPoint=t,i.pointSelectActive=!1,i.chartError=null,i.canvasView="chart",P(),xt())}function ia(){if(i.drawState.active){if(i.drawState.points.length<3){i.chartError="Draw at least three points to define a region.",P();return}i.chartPolygon=i.drawState.points,i.drawState=Qt(),aa(),i.chartError=null,i.canvasView="chart",P(),xt()}}function gc(t){const e=t.filter(s=>Number.isFinite(s)).sort((s,l)=>s-l);if(!e.length)throw new Error("No valid values available to build chart statistics.");const n=Ke(e,.25)??e[0],r=Ke(e,.5)??e[Math.floor(e.length/2)],a=Ke(e,.75)??e[e.length-1],o=$a(e)??e[0];return{min:e[0],q1:n,median:r,q3:a,max:e[e.length-1],mean:o,count:e.length}}function oa(t,e,n){const r=new Map;return t.forEach(a=>{const o=r.get(a.scenario)??[];o.push(a),r.set(a.scenario,o)}),Array.from(r.entries()).map(([a,o])=>{const s=o.map(c=>{const d=re(c.rawValue,e,n);return{...c,value:d}}),l=gc(s.map(c=>c.value));return{scenario:a,dateUsed:o[0]?.dateUsed??"",samples:s,stats:l}})}function vc(t,e,n,r){const a=ce(t),o=ce(e);if(!a||!o)throw new Error("Comparison data is missing numeric values.");if(a.length!==o.length||t.shape[0]!==e.shape[0]||t.shape[1]!==e.shape[1])throw new Error("Comparison datasets have mismatched shapes.");const s=new Float32Array(a.length);let l=1/0,c=-1/0;for(let u=0;u<a.length;u++){const f=a[u],h=o[u];if(!isFinite(f)||!isFinite(h)){s[u]=NaN;continue}const g=h-f;s[u]=g,isFinite(g)&&(l=Math.min(l,g),c=Math.max(c,g))}if(!isFinite(l)||!isFinite(c))throw new Error("Comparison produced no valid numeric values.");return{data:{...t,data:s,data_encoding:"none",dtype:"float32",model:`${r} minus ${n}`,time:`${e.time} minus ${t.time}`,scenario:`${e.scenario} minus ${t.scenario}`,metadata:{...t.metadata,comparison:{labelA:n,labelB:r}}},min:l,max:c}}function K(t,e=!1){const n=Math.max(0,Math.min(100,Math.round(t)));n!==i.loadingProgress&&(i.loadingProgress=n,(i.isLoading||e)&&P())}async function yc(t,e){let n=ft({variable:i.variable,date:i.date,model:i.model,scenario:i.scenario,resolution:i.resolution}),r=n,a="",o="";switch(i.compareMode){case"Scenarios":{const c=i.compareScenarioA,d=i.compareScenarioB,u=Wt(i.date,t);u!==i.date&&(i.date=u),n=ft({variable:i.variable,date:u,model:i.model,scenario:c,resolution:i.resolution}),r=ft({variable:i.variable,date:u,model:i.model,scenario:d,resolution:i.resolution}),a=c,o=d;break}case"Models":{const c=Wt(i.date,t);c!==i.date&&(i.date=c),n=ft({variable:i.variable,date:c,model:i.compareModelA,scenario:i.scenario,resolution:i.resolution}),r=ft({variable:i.variable,date:c,model:i.compareModelB,scenario:i.scenario,resolution:i.resolution}),a=i.compareModelA,o=i.compareModelB;break}case"Dates":{const c=Wt(i.compareDateStart,i.scenario),d=Wt(i.compareDateEnd,i.scenario);c!==i.compareDateStart&&(i.compareDateStart=c),d!==i.compareDateEnd&&(i.compareDateEnd=d),n=ft({variable:i.variable,date:c,model:i.model,scenario:i.scenario,resolution:i.resolution}),r=ft({variable:i.variable,date:d,model:i.model,scenario:i.scenario,resolution:i.resolution}),a=c,o=d;break}}const s=await Be(n);e?.(65);const l=await Be(r);return e?.(85),vc(s,l,a,o)}async function xt(){if(i.canvasView==="chart"){if(i.chartMode==="range"){i.chartError="Range mode is not implemented yet.",i.chartBoxes=null,i.chartSamples=[],i.chartLoading=!1,i.chartLoadingProgress={total:0,done:0},P();return}if(i.chartLocation==="Draw"&&(!i.chartPolygon||i.chartPolygon.length<3)){i.chartError="Draw a region on the map to load chart data.",i.chartBoxes=null,i.chartSamples=[],i.chartLoading=!1,i.chartLoadingProgress={total:0,done:0},P();return}if(i.chartLocation==="Point"&&!i.chartPoint){i.chartError="Click a point on the map to load chart data.",i.chartBoxes=null,i.chartSamples=[],i.chartLoading=!1,i.chartLoadingProgress={total:0,done:0},P();return}if(i.chartLocation==="Search"&&!i.chartPoint){i.chartError=i.chartLocationSearchLoading?"Searching for a place...":"Search for a place and pick a result.",i.chartBoxes=null,i.chartSamples=[],i.chartLoading=!1,i.chartLoadingProgress={total:0,done:0},P();return}i.chartLoading=!0,i.chartError=null,K(5,!0),i.chartLoadingProgress={total:0,done:0},P();try{const t=i.metaData??await Qr();i.metaData||(i.metaData=t);const e=t?.scenarios?.length?Array.from(new Set(t.scenarios.map(Ln))):gt,n=t?.models?.length?t.models:j,r=(i.chartScenarios.length?i.chartScenarios:e).filter(d=>e.includes(d)),a=(i.chartModels.length?i.chartModels:n).filter(d=>n.includes(d));if(!r.length||!a.length){i.chartError="Select at least one scenario and one model.",i.chartSamples=[],i.chartBoxes=null,i.chartLoading=!1,i.chartLoadingProgress={total:0,done:0},P();return}const o=kn(r),s=gn(i.chartDate,o);s!==i.chartDate&&(i.chartDate=s);const l=r.length*a.length;i.chartLoadingProgress={total:l,done:0},P();const c=[];for(const d of r){const u=gn(i.chartDate,Pt(d));for(const f of a){const h=i.chartLoadingProgress.done;K(Math.min(95,Math.round((h+.1)/l*100)));const g=ft({variable:i.chartVariable,date:u,model:f,scenario:d,resolution:1}),S=await Be(g),L=i.chartLoadingProgress.done+1;i.chartLoadingProgress={total:l,done:L},K(Math.min(98,Math.round(L/l*100))),P();const _=ce(S);if(!_)throw new Error("No data returned for chart request.");const T=i.chartLocation==="Draw"&&i.chartPolygon&&i.chartPolygon.length>=3?ac(_,i.chartVariable,S.shape,i.chartPolygon):(i.chartLocation==="Point"||i.chartLocation==="Search")&&i.chartPoint?oc(_,i.chartVariable,S.shape,i.chartPoint):nc(_,i.chartVariable);c.push({scenario:d,model:f,rawValue:T,dateUsed:u})}}i.chartSamples=c,i.chartBoxes=oa(c,i.chartVariable,i.chartUnit),i.chartLoadingProgress={total:l,done:l},K(100)}catch(t){i.chartError=t instanceof wt&&t.statusCode||t instanceof Error?t.message:String(t),i.chartSamples=[],i.chartBoxes=null,i.chartLoadingProgress={total:1,done:1}}finally{i.chartLoading=!1,P()}}}async function at(){if(console.log("fetching"),i.canvasView==="map"){i.isLoading=!0,K(5,!0),i.dataError=null;try{const t=await Qr();i.metaData=t,i.availableModels=t.models,K(20);const e=i.mode==="Compare"&&i.compareMode==="Scenarios"?i.compareScenarioA:i.scenario;i.timeRange=Pt(e),K(30);const n=i.mode==="Compare"?await yc(e,K):await(async()=>{K(40);const r=Wt(i.date,e);r!==i.date&&(i.date=r);const a=ft({variable:i.variable,date:r,model:i.model,scenario:i.scenario,resolution:i.resolution});K(55);let o=await Be(a);K(80);let s=ce(o);if(!s)throw new Error("No data returned for the selected parameters.");if(i.variable==="hurs"){const d=new Float32Array(s.length);let u=1/0,f=-1/0;for(let h=0;h<s.length;h++){const g=s[h];if(!isFinite(g)){d[h]=NaN;continue}const S=Math.min(g,100);d[h]=S,u=Math.min(u,S),f=Math.max(f,S)}return o={...o,data:d,data_encoding:"none"},s=d,{data:o,min:u,max:f}}const{min:l,max:c}=ec(s);return K(95),{data:o,min:l,max:c}})();if(i.currentData=n.data,i.dataMin=n.min,i.dataMax=n.max,K(100),i.isLoading=!1,P(),X){const r=X.querySelector("#map-canvas");r&&Tn(r)}}catch(t){t instanceof wt&&t.statusCode?i.dataError=t.message:i.dataError=t instanceof Error?t.message:String(t),i.isLoading=!1,K(0,!0),i.currentData=null,i.dataMin=null,i.dataMax=null,P()}}}function bc(){return`
      <div style="${p(m.branding)}">
        <div data-role="brand-eye" style="${p(m.brandIcon)}">
          <svg viewBox="0 0 120 80" style="${p(m.brandSvg)}" aria-hidden="true">
            <defs>
              <clipPath id="brand-eye-clip">
                <rect x="0" y="0" width="120" height="80" style="${p(m.brandClipRect)}" />
              </clipPath>
            </defs>
            <g style="${p(m.brandLids)}">
              <path
                d="M10 40c10-15 30-30 50-30s40 15 50 30c-10 15-30 30-50 30S20 55 10 40Z"
                style="${p(m.brandOutline)}"
              />
            </g>
            <g data-role="brand-iris" style="${p(H(m.brandIrisGroup,m.brandEyeContent))}">
              <circle cx="60" cy="40" r="20" style="${p(m.brandIris)}" />
              <g data-role="brand-pupil" style="${p(m.brandPupilGroup)}">
                <circle cx="60" cy="40" r="10" style="${p(m.brandPupil)}" />
                <circle cx="72" cy="30" r="4" style="${p(m.brandHighlight)}" />
              </g>
            </g>
          </svg>
        </div>
        <span style="${p(m.brandName)}">Polyoracle</span>
      </div>
    `}function P(){if(!X)return;const t=!!X.querySelector('.custom-select-wrapper[data-key="chartLocation"]')?.classList.contains("open"),e=(i.resolution-1)/2*100,n=i.mode==="Explore"?"translateX(0%)":"translateX(-50%)",r=i.mode==="Explore"?"translateX(0%)":"translateX(100%)",a=i.canvasView==="map"?"translateX(0%)":"translateX(100%)",o=i.panelTab==="Manual"?"translateX(0%)":"translateX(-50%)";if(X.innerHTML=`
    <div style="${p(m.page)}">
      <div style="${p(m.bgLayer1)}"></div>
      <div style="${p(m.bgLayer2)}"></div>
      <div style="${p(m.bgOverlay)}"></div>
      ${bc()}
        ${i.canvasView==="map"&&i.dataMin!==null&&i.dataMax!==null?_l(i.variable,i.dataMin,i.dataMax,i.metaData,i.selectedUnit,i.mode==="Compare"):""}
      <div style="${p(m.mapArea)}">
        ${i.canvasView==="map"?`
              <canvas
                id="map-canvas"
                style="position: absolute; inset: 0; width: 100%; height: 100%; object-fit: contain; pointer-events: auto;"
              ></canvas>
              ${lc()}
              ${cc()}
              ${xc()}
              ${i.dataError?`<div style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.8); z-index: 10;">
                      <div style="text-align: center; max-width: 600px; padding: 20px;">
                        <div style="${p(m.mapTitle)}">Error loading data</div>
                        <div style="${p(m.mapSubtitle)}">${i.dataError}</div>
                        ${i.apiAvailable===!1?`<div style="${p(H(m.mapSubtitle,{marginTop:12,fontSize:12}))}">
                                Make sure the Python API server is running. Check the terminal for connection details.
                              </div>`:""}
                      </div>
                    </div>`:""}
              ${!i.isLoading&&!i.dataError&&!i.currentData?`<div style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.5); z-index: 5;">
                      <div style="text-align: center;">
                        <div style="${p(m.mapTitle)}">No data loaded</div>
                        <div style="${p(m.mapSubtitle)}">
                          Adjust parameters to load climate data
                        </div>
                      </div>
                    </div>`:""}
            `:$c()}
      </div>

      <aside data-role="sidebar" class="sidebar" style="width: ${Z}px; transform: ${i.sidebarOpen?"translateX(0)":`translateX(${Z+24}px)`}; pointer-events: ${i.sidebarOpen?"auto":"none"}" aria-hidden="${!i.sidebarOpen}">
        <div class="sidebar-top">
          <div class="sidebar-brand">
            <div class="logo-dot"></div>
          </div>
          <div class="tab-switch" style="${p(m.tabSwitch)}">
            ${["Manual","Chat"].map(s=>Mc(s,i.panelTab===s?m.tabBtnActive:void 0,"panel-tab")).join("")}
          </div>
        </div>

        <div class="sidebar-content">
          <div class="tab-viewport">
            <div data-role="tab-track" class="tab-track" style="transform: ${o}">
              <div class="tab-pane">
                ${i.canvasView==="map"?_c({modeTransform:n,resolutionFill:e,modeIndicatorTransform:r}):Ec()}
              </div>
              <div class="tab-pane">
                ${Lc()}
              </div>
            </div>
          </div>
        </div>
      </aside>

      <div data-role="canvas-toggle" style="${p({...m.canvasToggle,right:i.sidebarOpen?Z+24:24})}">
        <div style="${p(m.canvasSwitch)}">
          <div data-role="canvas-indicator" style="${p({...m.canvasIndicator,transform:a})}"></div>
          <button
            type="button"
            aria-label="Show map canvas"
            data-action="set-canvas"
            data-value="map"
            style="${p(H(m.canvasBtn,i.canvasView==="map"?m.canvasBtnActive:void 0))}"
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.6">
              <path d="M4 6.5 9 4l6 2.5L20 4v14l-5 2.5L9 18 4 20.5V6.5Z" />
              <path d="m9 4v14m6-11.5v14" />
            </svg>
          </button>
          <button
            type="button"
            aria-label="Show chart canvas"
            data-action="set-canvas"
            data-value="chart"
            style="${p(H(m.canvasBtn,i.canvasView==="chart"?m.canvasBtnActive:void 0))}"
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.8">
              <path d="M4 18h16" />
              <path d="M6 18 11 9l4 5 3-6" />
              <circle cx="6" cy="18" r="1.2" />
              <circle cx="11" cy="9" r="1.2" />
              <circle cx="15" cy="14" r="1.2" />
              <circle cx="18" cy="8" r="1.2" />
            </svg>
          </button>
        </div>
      </div>

      ${Zl(i)}

      ${yl(i.sidebarOpen)}

      ${i.canvasView==="map"?Xl({date:i.date,timeRange:i.timeRange,sidebarOpen:i.sidebarOpen,sidebarWidth:Z,mode:i.mode,compareMode:i.compareMode,compareDateStart:i.compareDateStart,compareDateEnd:i.compareDateEnd}):""}
    </div>
  `,Tc(),t){const s=X.querySelector('.custom-select-wrapper[data-key="chartLocation"]');s&&s.classList.add("open")}if(it=X.querySelector("#map-canvas"),it&&i.currentData&&!i.dataError&&i.dataMin!==null&&i.dataMax!==null){Tn(it),pn(i.currentData,it,Y,i.palette,i.dataMin,i.dataMax,i.variable,i.selectedUnit);const s=Y.find(l=>l.name===i.palette)||Y[0];dn("legend-gradient-canvas",s.colors),i.drawState.active&&requestAnimationFrame(He)}}function xc(){if(!i.isLoading)return"";const t=Math.max(0,Math.min(100,Math.round(i.loadingProgress)));return`
      <div style="${p(m.loadingIndicator)}">
        <div style="${p(m.loadingSpinner)}"></div>
        <div style="${p(m.loadingTextGroup)}">
          <div style="${p(m.loadingText)}">Loading data · ${t}%</div>
          <div style="${p(m.loadingBar)}">
            <div style="${p({...m.loadingBarFill,width:`${t}%`})}"></div>
          </div>
          <div style="${p(m.loadingSubtext)}">Fetching climate tiles</div>
        </div>
      </div>
    `}function wc(){return`
      <div style="position:absolute; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none;">
      </div>
    `}function Sc(t){if(!Number.isFinite(t))return"-";const e=Math.abs(t);return e>=1e3?t.toFixed(0):e>=100?t.toFixed(1):e>=1?t.toFixed(2):t.toPrecision(2)}function fr(t){if(!t.length)return`<div style="${p(m.chartEmpty)}">No chart data loaded yet.</div>`;const e=[...t].sort((E,D)=>gt.indexOf(E.scenario)-gt.indexOf(D.scenario)),r=(Y.find(E=>E.name===i.palette)||Y[0]).colors,a=900,o=440,s={top:26,right:36,bottom:70,left:86},l=a-s.left-s.right,c=o-s.top-s.bottom,d=e.flatMap(E=>[E.stats.min,E.stats.max]),u=Math.min(...d),f=Math.max(...d),h=Math.max(Math.abs(f-u)*.12,1e-6),g=Yr().domain([u-h,f+h]).range([c,0]),S=g.ticks(6),L=l/(e.length+1),_=S.map(E=>{const D=g(E)+s.top;return`
        <g>
          <line x1="${s.left}" x2="${a-s.right}" y1="${D}" y2="${D}" stroke="rgba(255,255,255,0.08)" />
          <text x="${s.left-10}" y="${D+4}" fill="var(--text-secondary)" font-size="11" text-anchor="end">
            ${Sc(E)}
          </text>
        </g>
      `}).join(""),T=e.map((E,D)=>{const C=s.left+L*(D+1),y=r[D%r.length],{min:v,q1:$,median:M,q3:w,max:x,mean:N}=E.stats,I=g(w)+s.top,B=g($)+s.top,z=Math.max(2,B-I);return`
        <g>
          <line x1="${C}" x2="${C}" y1="${g(v)+s.top}" y2="${g(x)+s.top}" stroke="${y}" stroke-width="2" stroke-linecap="round" />
          <rect x="${C-24}" y="${I}" width="48" height="${z}" fill="rgba(255,255,255,0.06)" stroke="${y}" stroke-width="2" rx="6" />
          <line x1="${C-24}" x2="${C+24}" y1="${g(M)+s.top}" y2="${g(M)+s.top}" stroke="${y}" stroke-width="2.4" />
          <circle cx="${C}" cy="${g(N)+s.top}" r="4" fill="${y}" stroke="rgba(0,0,0,0.55)" stroke-width="1" />
          <text x="${C}" y="${o-s.bottom+32}" fill="var(--text-primary)" font-weight="700" font-size="12" text-anchor="middle">${E.scenario}</text>
          <text x="${C}" y="${o-s.bottom+48}" fill="var(--text-secondary)" font-size="11" text-anchor="middle">${E.samples.length} model${E.samples.length===1?"":"s"}</text>
        </g>
      `}).join(""),b=`
      <line
        x1="${s.left}"
        x2="${s.left}"
        y1="${s.top}"
        y2="${o-s.bottom}"
        stroke="rgba(255,255,255,0.65)"
        stroke-width="1.2"
      />
    `,k=`
      <text
        x="${s.left-70}"
        y="${s.top+c/2}"
        fill="var(--text-secondary)"
        font-size="12"
        text-anchor="middle"
        transform="rotate(-90 ${s.left-70} ${s.top+c/2})"
      >
        ${i.chartUnit}
      </text>
    `;return`
      <svg viewBox="0 0 ${a} ${o}" role="img" aria-label="Global box plots" preserveAspectRatio="xMidYMid meet" style="width:100%; height:auto;">
        ${b}
        ${_}
        ${T}
        ${k}
      </svg>
    `}function $c(){let t="";i.chartLoading?t=`
          <div style="position:absolute; inset:0; pointer-events:none;">
            <div style="${p(H(m.loadingIndicator,{position:"absolute",left:18,bottom:-95,pointerEvents:"auto"}))}">
              <div style="${p(m.loadingSpinner)}"></div>
              <div style="${p(m.loadingTextGroup)}">
                <div style="${p(m.loadingText)}">Loading data</div>
                <div style="${p(m.loadingBar)}">
                  <div style="${p({...m.loadingBarFill,width:`${Math.max(0,Math.min(100,Math.round(i.loadingProgress||25)))}%`})}"></div>
                </div>
                <div style="${p(m.loadingSubtext)}">${i.chartLoadingProgress.total>0?`${i.chartLoadingProgress.done}/${i.chartLoadingProgress.total} datasets loaded`:"Preparing datasets"}</div>
              </div>
            </div>
            ${wc()}
          </div>
          ${i.chartBoxes?fr(i.chartBoxes):""}
        `:i.chartError?t=`<div style="${p(m.chartError)}">${i.chartError}</div>`:!i.chartBoxes||!i.chartBoxes.length?t=`
          <div style="${p(m.chartEmpty)}">
            Select scenarios and models to fetch the global box plot.
          </div>
        `:t=fr(i.chartBoxes);const e=i.chartLocationName||(i.chartLocation==="Point"&&i.chartPoint?`Point (${i.chartPoint.lat.toFixed(2)}, ${i.chartPoint.lon.toFixed(2)})`:i.chartLocation==="Draw"?"Custom region":i.chartLocation==="World"?"Global":"");return`
      <div style="pointer-events:auto; width:100%; display:flex; align-items:center; justify-content:center; padding:24px; padding-right:${i.sidebarOpen?Z+32:24}px;">
        <div style="${p(m.chartPanel)}">
          <div style="${p(m.chartHeader)}">
            <div style="${p(m.chartTitle)}">${ra(i.chartVariable,i.metaData)}</div>
            <div style="${p(m.mapSubtitle)}">${e?`${zt(e)} · ${Ht(i.chartDate)}`:Ht(i.chartDate)}</div>
          </div>
          <div style="${p(H(m.chartPlotWrapper,{display:"flex",alignItems:"center",justifyContent:"center"}))}">
            ${t}
          </div>
        </div>
      </div>
    `}function F(t,e){return`
    <div style="${p(m.field)}">
      ${t?`<div style="${p(m.fieldLabel)}">${t}</div>`:""}
      ${e}
    </div>
  `}function Ot(t,e,n){const r=n?.type??"date",a=n?.dataKey??t,o=n?.min?`min="${n.min}"`:"",s=n?.max?`max="${n.max}"`:"";return`
    <input
      type="${r}"
      value="${e}"
      data-action="update-input"
      data-key="${a}"
      ${o}
      ${s}
    />
  `}function V(t,e,n,r){const a=r?.dataKey??t,o=r?.disabled?"disabled":"",s=`custom-select-${a}-${Math.random().toString(36).substr(2,9)}`,l=r?.infoType,c=zt(r?.selectedLabel??n),d=r?.extraContent??"";return`
    <div class="custom-select-container">
      <div class="custom-select-info-panel" id="${s}-info" role="tooltip"></div>
      <div class="custom-select-wrapper" data-key="${a}" ${o?'data-disabled="true"':""} ${l?`data-info-type="${l}"`:""}>
        <div class="custom-select-trigger" data-action="update-select" data-key="${a}" id="${s}-trigger" ${o?'aria-disabled="true"':""} tabindex="${o?"-1":"0"}">
          <span class="custom-select-value">${c}</span>
          <svg class="custom-select-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="custom-select-dropdown" id="${s}-dropdown" role="listbox">
          ${e.map(u=>`
                <div class="custom-select-option ${u===n?"selected":""}" 
                     data-value="${u}" 
                     data-action="update-select" 
                     data-key="${a}"
                     role="option"
                     ${u===n?'aria-selected="true"':""}
                     tabindex="0">
                  ${u}
                </div>
              `).join("")}
          ${d}
        </div>
      </div>
    </div>
  `}function Mc(t,e,n="panel-tab"){return`
    <button
      type="button"
      data-action="set-tab"
      data-key="${n}"
      data-value="${t}"
      style="${p(H(m.tabBtn,e))}"
    >
      ${t}
    </button>
  `}function _c(t){const{modeTransform:e,resolutionFill:n,modeIndicatorTransform:r}=t,a=i.compareMode==="Models"?[F("Scenario",V("scenario",gt,i.scenario,{infoType:"scenario"})),F("Date",Ot("date",i.date))]:i.compareMode==="Dates"?[F("Scenario",V("scenario",gt,i.scenario,{infoType:"scenario"})),F("Model",V("model",j,i.model,{infoType:"model"}))]:[F("Model",V("model",j,i.model,{infoType:"model"})),F("Date",Ot("date",i.date))];return`
    <div style="${p(m.modeSwitch)}">
      <div data-role="mode-indicator" style="${p({...m.modeIndicator,transform:r})}"></div>
      ${["Explore","Compare"].map(o=>`
            <button
              type="button"
              class="mode-btn"
              data-action="set-mode"
              data-value="${o}"
              style="${p(H(m.modeBtn,i.mode===o?m.modeBtnActive:void 0))}"
            >
              ${o}
            </button>
          `).join("")}
    </div>

    <div style="${p(m.modeViewport)}">
      <div data-role="mode-track" style="${p({...m.modeTrack,transform:e})}">
        <div class="mode-pane-scrollable" style="${p(m.modePane)}">
          <div style="${p({display:"flex",flexDirection:"column",gap:8})}">
            <div style="${p(m.sectionTitle)}">Parameters</div>
            <div style="${p(m.paramGrid)}">
              ${F("Scenario",V("scenario",gt,i.scenario,{infoType:"scenario"}))}
              ${F("Model",V("model",j,i.model,{infoType:"model"}))}
              ${F("Date",(()=>{const o=Pt(i.scenario);return Ot("date",i.date,{min:o.start,max:o.end})})())}
              ${F("Variable",V("variable",kt,i.variable,{infoType:"variable"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${p({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${p(m.sectionTitle)}">Unit</div>
              ${F("",V("unit",It(i.variable).map(o=>o.label),i.selectedUnit,{dataKey:"unit"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${p({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${p(m.sectionTitle)}">Color palette</div>
              ${F("",V("palette",Y.map(o=>o.name),i.palette,{dataKey:"palette"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${p({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${p(m.sectionTitle)}">Resolution</div>
              <div style="${p(m.resolutionRow)}">
                <input
                  type="range"
                  min="1"
                  max="3"
                  step="1"
                  value="${i.resolution}"
                  data-action="set-resolution"
                  class="resolution-slider"
                  style="${p(H(m.range,{"--slider-fill":`${n}%`}))}"
                />
                <div data-role="resolution-value" style="${p(m.resolutionValue)}">${i.resolution===1?"Low":i.resolution===2?"Medium":"High"}</div>
              </div>
            </div>
          </div>
        </div>

        <div class="mode-pane-scrollable" style="${p(m.modePane)}">
          <div style="${p({display:"flex",flexDirection:"column",gap:14})}">
            <div style="${p({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${p(m.sectionTitle)}">Compare</div>
              <div style="${p(m.paramGrid)}">
                ${F("What do you want to compare?",V("compareMode",["Scenarios","Models","Dates"],i.compareMode,{dataKey:"compareMode"}))}
              </div>

              ${i.compareMode==="Scenarios"?`
                      <div style="${p(m.paramGrid)}">
                        ${F("Scenario A",V("compareScenarioA",["SSP245","SSP370","SSP585"],i.compareScenarioA,{dataKey:"compareScenarioA",infoType:"scenario"}))}
                        ${F("Scenario B",V("compareScenarioB",["SSP245","SSP370","SSP585"],i.compareScenarioB,{dataKey:"compareScenarioB",infoType:"scenario"}))}
                      </div>
                    `:""}

              ${i.compareMode==="Models"?`
                      <div style="${p(m.paramGrid)}">
                        ${F("Model A",V("compareModelA",(()=>{const o=j.filter(s=>s!==i.compareModelB);return o.includes(i.compareModelA)?o:[i.compareModelA,...o]})(),i.compareModelA,{dataKey:"compareModelA",infoType:"model"}))}
                        ${F("Model B",V("compareModelB",(()=>{const o=j.filter(s=>s!==i.compareModelA);return o.includes(i.compareModelB)?o:[i.compareModelB,...o]})(),i.compareModelB,{dataKey:"compareModelB",infoType:"model"}))}
                      </div>
                    `:""}

              ${i.compareMode==="Dates"?`
                      <div style="${p(m.paramGrid)}">
                        ${F("Start date",Ot("compareDateStart",i.compareDateStart,{dataKey:"compareDateStart"}))}
                        ${F("End date",Ot("compareDateEnd",i.compareDateEnd,{dataKey:"compareDateEnd"}))}
  </div>
`:""}

              <div style="${p(m.paramGrid)}">
                ${a.join("")}
                ${F("Variable",V("variable",kt,i.variable,{infoType:"variable"}))}
              </div>

              <div style="margin-top:14px">
                <div style="${p({display:"flex",flexDirection:"column",gap:8})}">
                  <div style="${p(m.sectionTitle)}">Unit</div>
                  ${F("",V("unit",It(i.variable).map(o=>o.label),i.selectedUnit,{dataKey:"unit"}))}
                </div>
              </div>

              <div style="margin-top:14px">
                <div style="${p({display:"flex",flexDirection:"column",gap:8})}">
                  <div style="${p(m.sectionTitle)}">Color palette</div>
                  ${F("",V("palette",Y.map(o=>o.name),i.palette,{dataKey:"palette"}))}
                </div>
              </div>

              <div style="margin-top:14px">
                <div style="${p({display:"flex",flexDirection:"column",gap:8})}">
                  <div style="${p(m.sectionTitle)}">Resolution</div>
                  <div style="${p(m.resolutionRow)}">
                    <input
                      type="range"
                      min="1"
                      max="3"
                      step="1"
                      value="${i.resolution}"
                      data-action="set-resolution"
                      class="resolution-slider"
                      style="${p(H(m.range,{"--slider-fill":`${n}%`}))}"
                    />
                    <div data-role="resolution-value" style="${p(m.resolutionValue)}">${i.resolution===1?"Low":i.resolution===2?"Medium":"High"}</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  `}function hr(t,e,n){const r=new Set(e);return`
      <div style="${p(m.chipRow)}">
        ${t.map(a=>{const o=r.has(a);return`
                  <button
                    type="button"
                    data-action="toggle-multi"
                    data-key="${n}"
                    data-value="${a}"
                    style="${p(H(m.chip,o?m.chipActive:void 0))}"
                  >
                    ${a}
                  </button>
                `}).join("")}
      </div>
    `}function Dc(){const t=i.chartLocationSearchResults.length>0?i.chartLocationSearchResults.map(r=>`
                <button
                  type="button"
                  class="location-search-result"
                  data-role="location-search-result"
                  data-name="${zt(r.displayName)}"
                  data-lat="${r.lat}"
                  data-lon="${r.lon}"
                >
                  <div class="location-search-result-name">${zt(r.displayName)}</div>
                  <div class="location-search-result-coord">
                    ${r.lat.toFixed(3)}, ${r.lon.toFixed(3)}
                  </div>
                </button>
              `).join(""):"",e=i.chartLocationSearchQuery.trim().length>0,n=i.chartLocationSearchError?`<div class="location-search-error">${zt(i.chartLocationSearchError)}</div>`:i.chartLocationSearchLoading?'<div class="location-search-status">Searching...</div>':i.chartLocationSearchResults.length===0&&e?'<div class="location-search-status">No places found. Try refining your query.</div>':"";return`
      <div class="custom-select-extra" data-role="chart-location-search">
        <div class="location-search-row">
          <input
            type="text"
            class="location-search-input"
            value="${zt(i.chartLocationSearchQuery)}"
            placeholder="Search a place (e.g. Aachen)"
            data-role="location-search-input"
          />
        </div>
        ${n}
        <div class="location-search-results" data-role="location-search-results">
          ${t||""}
        </div>
      </div>
    `}function Ec(){const t=i.chartMode==="single"?"translateX(0%)":"translateX(100%)",e=i.metaData?.scenarios?.length?Array.from(new Set(i.metaData.scenarios.map(Ln))):gt,n=i.metaData?.models?.length?i.metaData.models:j,r=kn(i.chartScenarios.length?i.chartScenarios:e),a=(l,c,d,u,f)=>`
          <div style="${p({border:"1px solid var(--border-medium)",borderRadius:12,background:"var(--bg-subtle)",padding:"10px 12px"})}">
            <button
              type="button"
              data-action="toggle-collapse"
              data-key="${f}"
              style="${p({display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",background:"transparent",border:"none",color:"var(--text-primary)",fontWeight:700,fontSize:13,cursor:"pointer",padding:0})}"
            >
              <span>${l}</span>
              <span style="${p({color:"var(--text-secondary)",fontWeight:600,fontSize:12})}">${d} ${c?"▴":"▾"}</span>
            </button>
            ${c?`<div style="${p({marginTop:10,display:"flex",flexWrap:"wrap",gap:8})}">${u}</div>`:""}
          </div>
        `,o=`
      <div style="${p(m.paramGrid)}">
        ${F("Date",Ot("chartDate",i.chartDate,{dataKey:"chartDate",min:r.start,max:r.end}))}
        ${F("Variable",V("chartVariable",kt,i.chartVariable,{dataKey:"chartVariable",infoType:"variable"}))}
      </div>

      <div style="margin-top:10px">
        ${F("Location",V("chartLocation",["World","Draw","Point"],i.chartLocation,{dataKey:"chartLocation",selectedLabel:i.chartLocation==="Search"&&i.chartLocationName?`Search: ${i.chartLocationName}`:i.chartLocation,extraContent:Dc()}))}
      </div>

      <div style="margin-top:14px">
        ${a("Scenarios",i.chartDropdown.scenariosOpen,`${i.chartScenarios.length} selected`,hr(e,i.chartScenarios,"chartScenarios"),"chartScenarios")}
      </div>

      <div style="margin-top:14px">
        ${a("Models",i.chartDropdown.modelsOpen,`${i.chartModels.length} selected`,hr(n,i.chartModels,"chartModels"),"chartModels")}
      </div>

      <div style="margin-top:14px">
        <div style="${p(m.sectionTitle)}">Unit</div>
        ${F("",V("chartUnit",It(i.chartVariable).map(l=>l.label),i.chartUnit,{dataKey:"chartUnit"}))}
      </div>

      <div style="margin-top:14px">
        <div style="${p(m.sectionTitle)}">Color palette</div>
        ${F("",V("palette",Y.map(l=>l.name),i.palette,{dataKey:"palette"}))}
      </div>
    `,s=`
      <div style="${p(m.chartEmpty)}">
        Range mode will be added later.
      </div>
    `;return`
      <div style="${p(m.modeSwitch)}">
        <div data-role="chart-mode-indicator" style="${p({...m.modeIndicator,transform:t})}"></div>
        ${["single","range"].map(l=>{const c=l==="single"?"Single dates":"Range";return`
              <button
                type="button"
                class="mode-btn"
                data-action="set-chart-mode"
                data-value="${l}"
                style="${p(H(m.modeBtn,i.chartMode===l?m.modeBtnActive:void 0))}"
              >
                ${c}
              </button>
            `}).join("")}
      </div>

      <div class="mode-pane-scrollable" style="${p(m.modePane)}">
        ${i.chartMode==="single"?o:s}
      </div>
    `}function Lc(){return`
    <div style="${p({display:"flex",flexDirection:"column",gap:8})}">
      <div style="${p(m.sectionTitle)}">Chat</div>
      <div style="${p(m.chatStack)}">
        <div style="${p(m.chatLead)}">Discuss the data with an agent, or ask questions.</div>

        <div style="${p(m.chatMessages)}">
          ${i.chatMessages.map(t=>{const e=t.sender==="user"?H(m.chatBubble,m.chatBubbleUser):H(m.chatBubble,m.chatBubbleAgent);return`<div style="${p(e)}">${t.text}</div>`}).join("")}
        </div>

        <div style="${p(m.chatBox)}">
          <input
            type="text"
            value="${i.chatInput}"
            data-action="chat-input"
            style="${p(m.chatInput)}"
            placeholder="Ask a question"
          />
          <button type="button" data-action="chat-send" aria-label="Send chat message" style="${p(m.chatSend)}">
            ➤
          </button>
        </div>
      </div>
    </div>
  `}function pr(t,e,n){const r=Math.hypot(t,e);if(!r||!isFinite(r)||n<=0)return{x:0,y:0};const a=Math.min(1,n/r);return{x:t*a,y:e*a}}function kc(t){xe&&(xe(),xe=null),St!==null&&(cancelAnimationFrame(St),St=null),yt!==null&&(cancelAnimationFrame(yt),yt=null),$t!==null&&(clearTimeout($t),$t=null),dt!==null&&(clearTimeout(dt),dt=null);const e=t.querySelector('[data-role="brand-eye"]');if(!e)return;let n={x:0,y:0},r={x:0,y:0},a={x:0,y:0},o={x:0,y:0},s=1,l=!1;const c=3e4,d=(b,k)=>{const E=e.getBoundingClientRect(),D=E.left+E.width/2,C=E.top+E.height/2,y=b-D,v=k-C,M=Math.min(E.width,E.height)*.14,w=M*.6;n=pr(y,v,M),r=pr(y,v,w)},u=b=>{s=Math.max(0,Math.min(1,b)),e.style.setProperty("--blink-open",`${s}`)},f=()=>{dt!==null&&clearTimeout(dt),dt=window.setTimeout(()=>{n={x:0,y:0},r={x:0,y:0}},c)},h=()=>{a.x+=(n.x-a.x)*.28,a.y+=(n.y-a.y)*.28,o.x+=(r.x-o.x)*.32,o.y+=(r.y-o.y)*.32,e.style.setProperty("--iris-x",`${a.x}px`),e.style.setProperty("--iris-y",`${a.y}px`),e.style.setProperty("--pupil-x",`${o.x}px`),e.style.setProperty("--pupil-y",`${o.y}px`),St=requestAnimationFrame(h)},g=()=>{if(l)return;l=!0;const b=[{t:0,v:1},{t:.16,v:.08},{t:.26,v:.02},{t:.4,v:1}],k=350,E=performance.now(),D=C=>{const y=C-E,v=Math.min(1,y/k);let $=b[0],M=b[b.length-1];for(let B=0;B<b.length-1;B++){const z=b[B],rt=b[B+1];if(v>=z.t&&v<=rt.t){$=z,M=rt;break}}const w=M.t-$.t||1,x=Math.min(1,Math.max(0,(v-$.t)/w)),N=1-Math.pow(1-x,2),I=$.v+(M.v-$.v)*N;u(I),v<1?yt=requestAnimationFrame(D):(u(1),l=!1,S())};yt=requestAnimationFrame(D)},S=()=>{const b=3e3+Math.random()*15e3;$t=window.setTimeout(g,b)},L=()=>{const b=e.getBoundingClientRect();d(b.left+b.width/2,b.top+b.height/2)},_=b=>{d(b.clientX,b.clientY),f()},T=()=>L();L(),h(),S(),f(),window.addEventListener("pointermove",_),window.addEventListener("pointerleave",T),xe=()=>{window.removeEventListener("pointermove",_),window.removeEventListener("pointerleave",T),St!==null&&(cancelAnimationFrame(St),St=null),yt!==null&&(cancelAnimationFrame(yt),yt=null),$t!==null&&(clearTimeout($t),$t=null),dt!==null&&(clearTimeout(dt),dt=null)}}function Tc(t){if(!X)return;const e=X;kc(e),vl({root:e,getSidebarOpen:()=>i.sidebarOpen,setSidebarOpen:y=>{i.sidebarOpen=y},onTimeSliderUpdate:y=>{Hl(y,Z)}}),e.querySelectorAll('[data-action="set-canvas"]').forEach(y=>y.addEventListener("click",()=>{const v=y.dataset.value;if(v){if(v===i.canvasView)return;const M=i.canvasView==="map"?"translateX(0%)":"translateX(100%)",w=v==="map"?"translateX(0%)":"translateX(100%)";i.canvasView=v,P(),v==="map"?at():xt();const x=e.querySelector('[data-role="canvas-indicator"]');if(!x)return;x.style.removeProperty("transition"),x.style.transform=M,x.offsetHeight,x.getBoundingClientRect(),requestAnimationFrame(()=>{x.style.transition="transform 180ms ease",x.style.transform=w})}})),e.querySelectorAll('[data-action="set-mode"]').forEach(y=>y.addEventListener("click",()=>{const v=y.dataset.value;if(v){if(v===i.mode)return;const $=i.mode,M=$==="Explore"?"translateX(0%)":"translateX(-50%)",w=$==="Explore"?"translateX(0%)":"translateX(100%)",x=v==="Explore"?"translateX(0%)":"translateX(-50%)",N=v==="Explore"?"translateX(0%)":"translateX(100%)";i.mode=v,P();const I=e.querySelector('[data-role="mode-track"]'),B=e.querySelector('[data-role="mode-indicator"]');if(!I||!B)return;I.style.transition="none",B.style.transition="none",I.style.transform=M,B.style.transform=w,I.offsetHeight,I.style.transition="transform 220ms ease",B.style.transition="transform 200ms ease",I.style.transform=x,B.style.transform=N}i.canvasView==="map"&&at()})),e.querySelectorAll('[data-action="set-chart-mode"]').forEach(y=>y.addEventListener("click",()=>{const v=y.dataset.value;if(!v||v===i.chartMode)return;const M=i.chartMode==="single"?"translateX(0%)":"translateX(100%)",w=v==="single"?"translateX(0%)":"translateX(100%)";i.chartMode=v,P();const x=e.querySelector('[data-role="chart-mode-indicator"]');x&&(x.style.removeProperty("transition"),x.style.transform=M,x.offsetHeight,requestAnimationFrame(()=>{x.style.transition="transform 200ms ease",x.style.transform=w})),i.canvasView==="chart"&&xt()})),e.querySelectorAll('[data-action="set-tab"]').forEach(y=>y.addEventListener("click",()=>{const v=y.dataset.value;if(v){if(v===i.panelTab)return;const M=i.panelTab==="Manual"?"translateX(0%)":"translateX(-50%)",w=v==="Manual"?"translateX(0%)":"translateX(-50%)";i.panelTab=v,P();const x=e.querySelector('[data-role="tab-track"]');if(!x)return;x.style.removeProperty("transition"),x.style.transform=M,x.offsetHeight,x.getBoundingClientRect(),requestAnimationFrame(()=>{x.style.transition="transform 220ms ease",x.style.transform=w})}}));const s=e.querySelectorAll(".custom-select-wrapper");let l=document.querySelector(".custom-select-info-panel-shared");l||(l=document.createElement("div"),l.className="custom-select-info-panel custom-select-info-panel-shared",l.setAttribute("role","tooltip"),document.body.appendChild(l));const c=y=>{y.target.closest(".custom-select-wrapper")||(s.forEach($=>{$.classList.remove("open")}),l&&l.classList.remove("visible"))},d=y=>{y.key==="Escape"&&(s.forEach(v=>{v.classList.remove("open")}),l&&l.classList.remove("visible"))};document.addEventListener("click",c),document.addEventListener("keydown",d),s.forEach(y=>{const v=y.querySelector(".custom-select-trigger"),$=y.querySelector(".custom-select-dropdown"),M=y.querySelectorAll(".custom-select-option"),w=y.dataset.key,x=y.dataset.infoType,N=y.dataset.disabled==="true";if(!v||!$||N)return;const I=l,B=(R,A)=>{if(!I||!x)return;let O="",W=R;if(x==="scenario"?O=Wl[R]||"":x==="variable"?(O=Yl[R]||"",W=Ul[R]||R):x==="model"&&(O=Kl[R]||""),O){if(I.innerHTML=`
                    <div class="custom-select-info-panel-title">${W}</div>
                    <div class="custom-select-info-panel-content">${O}</div>
                `,A||v){const lt=A||v;if(lt){const fe=lt.getBoundingClientRect();I.style.left=`${fe.left-272}px`,I.style.top=`${fe.top}px`}}I.classList.add("visible")}},z=()=>{I&&I.classList.remove("visible")};v.addEventListener("click",R=>{if(R.stopPropagation(),N)return;const A=y.classList.contains("open");s.forEach(O=>{O!==y&&O.classList.remove("open")}),y.classList.toggle("open",!A)}),v.addEventListener("keydown",R=>{if(!N&&(R.key==="Enter"||R.key===" "||R.key==="ArrowDown")){R.preventDefault(),y.classList.add("open");const A=M[0];A&&A.focus()}}),M.forEach(R=>{R.addEventListener("click",A=>{A.stopPropagation();const O=R.dataset.value;if(!O||!w)return;M.forEach(lt=>{lt.classList.remove("selected"),lt.removeAttribute("aria-selected")}),R.classList.add("selected"),R.setAttribute("aria-selected","true");const W=v.querySelector(".custom-select-value");W&&(W.textContent=O),y.classList.remove("open"),z(),u(w,O)}),x&&(R.addEventListener("mouseenter",()=>{const A=R.dataset.value;A&&B(A,R)}),R.addEventListener("mouseleave",()=>{z()})),R.addEventListener("keydown",A=>{const O=Array.from(M).indexOf(R);if(A.key==="Enter"||A.key===" ")A.preventDefault(),R.click();else if(A.key==="ArrowDown"){A.preventDefault();const W=(O+1)%M.length;M[W]?.focus()}else if(A.key==="ArrowUp"){A.preventDefault();const W=O===0?M.length-1:O-1;M[W]?.focus()}else A.key==="Escape"?(A.preventDefault(),y.classList.remove("open"),z(),v.focus()):A.key==="Home"?(A.preventDefault(),M[0]?.focus()):A.key==="End"&&(A.preventDefault(),M[M.length-1]?.focus())})}),new MutationObserver(R=>{R.forEach(A=>{A.type==="attributes"&&A.attributeName==="class"&&(y.classList.contains("open")||z())})}).observe(y,{attributes:!0})});const u=async(y,v)=>{if(!y)return;let $=!1,M=!1;switch(y){case"scenario":i.scenario=v,i.date=tc(v),i.timeRange=Pt(v),$=!0;break;case"model":i.model=v,$=!0;break;case"variable":i.variable=v,i.selectedUnit=se(v).label,$=!0;break;case"unit":if(i.selectedUnit=v,P(),i.currentData&&X&&i.dataMin!==null&&i.dataMax!==null){const w=X.querySelector("#map-canvas");if(w){it=w,Tn(w),pn(i.currentData,it,Y,i.palette,i.dataMin,i.dataMax,i.variable,i.selectedUnit);const x=Y.find(N=>N.name===i.palette)||Y[0];dn("legend-gradient-canvas",x.colors)}}return;case"palette":if(i.palette=v,P(),i.canvasView==="map"&&i.currentData&&X&&i.dataMin!==null&&i.dataMax!==null){const w=X.querySelector("#map-canvas");if(w){it=w,pn(i.currentData,it,Y,i.palette,i.dataMin,i.dataMax,i.variable,i.selectedUnit);const x=Y.find(N=>N.name===i.palette)||Y[0];dn("legend-gradient-canvas",x.colors)}}return;case"compareMode":i.compareMode=v,$=!0;break;case"compareScenarioA":v===i.compareScenarioB&&(i.compareScenarioB=i.compareScenarioA),i.compareScenarioA=v,$=!0;break;case"compareScenarioB":v===i.compareScenarioA&&(i.compareScenarioA=i.compareScenarioB),i.compareScenarioB=v,$=!0;break;case"compareModelA":v===i.compareModelB&&(i.compareModelB=i.compareModelA),i.compareModelA=v,$=!0;break;case"compareModelB":v===i.compareModelA&&(i.compareModelA=i.compareModelB),i.compareModelB=v,$=!0;break;case"chartVariable":i.chartVariable=v,i.chartUnit=se(v).label,M=!0;break;case"chartUnit":i.chartUnit=v,i.chartSamples.length&&(i.chartBoxes=oa(i.chartSamples,i.chartVariable,i.chartUnit)),P();return;case"chartLocation":if(v==="Draw"){dr();return}if(v==="Point"){ur();return}if(v==="Search"){i.chartLocation="Search",i.chartPolygon=null,i.pointSelectActive=!1,i.drawState=Qt(),i.chartError=null,i.chartLocationName=null,i.chartLocationSearchError=null,i.chartLocationSearchResults=[],i.chartLocationSearchQuery="",i.chartLocationSearchLoading=!1,i.canvasView="chart",Oe(),qe(),P();return}i.chartLocation="World",i.chartPolygon=null,i.chartPoint=null,i.chartLocationName=null,i.chartLocationSearchError=null,i.chartLocationSearchResults=[],i.chartLocationSearchQuery="",i.chartLocationSearchLoading=!1,Oe(),qe(),M=!0;break}P(),i.canvasView==="map"&&$&&at(),i.canvasView==="chart"&&(M||$)&&xt()},f=e.querySelector('.custom-select-wrapper[data-key="chartLocation"]');if(f){f.querySelectorAll(".custom-select-option").forEach(x=>{x.addEventListener("click",()=>{const N=x.dataset.value;N==="Draw"&&i.chartLocation==="Draw"?dr():N==="Point"&&i.chartLocation==="Point"&&ur()})});const v=f.querySelectorAll('[data-role="location-search-input"]'),$=f.querySelectorAll('[data-role="location-search-result"]'),M=()=>{Tt!==null&&(window.clearTimeout(Tt),Tt=null)},w=x=>{M(),fc(x)};if(v.forEach(x=>{x.addEventListener("input",()=>{const N=i.chartLocationSearchResults.length>0,I=i.chartLocationSearchLoading,B=!!i.chartLocationSearchError;if(i.chartLocationSearchQuery=x.value,i.chartLocationSearchError=null,M(),!x.value.trim()){i.chartLocationSearchResults=[],i.chartLocationSearchLoading=!1,P();return}(N||I||B)&&(i.chartLocationSearchResults=[],i.chartLocationSearchLoading=!1,P()),Tt=window.setTimeout(()=>{w(x.value)},Gl)}),x.addEventListener("keydown",N=>{N.key==="Enter"&&(N.preventDefault(),M(),w(x.value))})}),$.forEach(x=>{x.addEventListener("click",()=>{const N=Number(x.dataset.lat),I=Number(x.dataset.lon),B=x.dataset.name??"Selected place";!Number.isFinite(N)||!Number.isFinite(I)||(f.classList.remove("open"),uc({displayName:B,lat:N,lon:I}))})}),i.chartLocation==="Search"){const x=f.querySelector('[data-role="location-search-input"]');x&&setTimeout(()=>x.focus(),0)}}e.querySelectorAll('select[data-action="update-select"]').forEach(y=>y.addEventListener("change",async()=>{const v=y.dataset.key,$=y.value;v&&await u(v,$)})),e.querySelectorAll('[data-action="toggle-multi"]').forEach(y=>y.addEventListener("click",()=>{const v=y.dataset.key,$=y.dataset.value;if(!(!v||!$)){if(v==="chartScenarios"){const M=i.metaData?.scenarios?.length&&i.metaData.scenarios?Array.from(new Set(i.metaData.scenarios.map(Ln))):gt,w=$==="Historical",x=new Set(i.chartScenarios);x.has($)?x.delete($):w?(x.clear(),x.add("Historical")):(x.delete("Historical"),x.add($)),x.size===0&&x.add(w?"Historical":$),i.chartScenarios=Array.from(x).filter(I=>M.includes(I));const N=kn(i.chartScenarios);i.chartDate=gn(i.chartDate,N)}if(v==="chartModels"){const M=i.metaData?.models?.length&&i.metaData.models?i.metaData.models:j,w=new Set(i.chartModels);w.has($)?w.delete($):w.add($),i.chartModels=w.size?Array.from(w):[...M]}P(),i.canvasView==="chart"&&xt()}})),e.querySelectorAll('[data-action="toggle-collapse"]').forEach(y=>y.addEventListener("click",()=>{const v=y.dataset.key;v&&(v==="chartScenarios"&&(i.chartDropdown.scenariosOpen=!i.chartDropdown.scenariosOpen),v==="chartModels"&&(i.chartDropdown.modelsOpen=!i.chartDropdown.modelsOpen),P())})),e.querySelectorAll('[data-action="update-input"]').forEach(y=>{const v=()=>{const $=y.dataset.key;if(!$)return;const M=y.value;if(!(/^\d{4}-\d{2}-\d{2}$/.test(M)&&!isNaN(new Date(M).getTime()))){y.style.borderColor="rgba(239, 68, 68, 0.6)";return}y.style.borderColor="";let I=M;if($==="date"&&(I=Wt(M,i.scenario),I!==M&&(y.value=I)),($==="date"?i.date:$==="compareDateStart"?i.compareDateStart:$==="compareDateEnd"?i.compareDateEnd:i.chartDate)!==I){switch($){case"date":i.date=I;break;case"compareDateStart":i.compareDateStart=M;break;case"compareDateEnd":i.compareDateEnd=M;break;case"chartDate":i.chartDate=M;break}P(),($==="date"||i.mode==="Compare"&&($==="compareDateStart"||$==="compareDateEnd"))&&at(),$==="chartDate"&&i.canvasView==="chart"&&xt()}};y.addEventListener("blur",v),y.addEventListener("keydown",$=>{$.key==="Enter"&&($.preventDefault(),v(),y.blur())})});const _=e.querySelectorAll('[data-action="set-resolution"]'),T=e.querySelectorAll('[data-role="resolution-value"]'),b=y=>{const v=(y-1)/2*100,$=y===1?"Low":y===2?"Medium":"High";_.forEach(M=>{M.value=String(y),M.style.setProperty("--slider-fill",`${v}%`)}),T.forEach(M=>{M.textContent=$})};_.forEach(y=>y.addEventListener("input",()=>{const v=Number.parseInt(y.value,10);Number.isNaN(v)||(i.resolution=v,b(v),i.canvasView==="map"&&at())})),e.querySelector('[data-action="open-compare-info"]')?.addEventListener("click",()=>{i.compareInfoOpen=!0,P()}),e.querySelectorAll('[data-action="close-compare-info"]').forEach(y=>y.addEventListener("click",()=>{i.compareInfoOpen=!1,P()})),zl({root:e,getTimeRange:()=>i.timeRange,onDateChange:y=>{i.date=y,at()},getMode:()=>i.mode,getCompareMode:()=>i.compareMode,getCompareDates:()=>({start:i.compareDateStart,end:i.compareDateEnd}),onDateRangeChange:(y,v)=>{i.compareDateStart=y,i.compareDateEnd=v,at()}});const D=e.querySelector('[data-action="chat-input"]'),C=e.querySelector('[data-action="chat-send"]');D?.addEventListener("input",()=>{i.chatInput=D.value}),D?.addEventListener("keydown",y=>{y.key==="Enter"&&(y.preventDefault(),mr())}),C?.addEventListener("click",mr)}function mr(){const t=i.chatInput.trim();if(!t)return;const e={id:Date.now(),sender:"user",text:t};i.chatMessages=[...i.chatMessages,e],i.chatInput="",Je&&window.clearTimeout(Je),Je=window.setTimeout(()=>{const n={id:Date.now()+1,sender:"agent",text:"I don't work yet."};i.chatMessages=[...i.chatMessages,n],P()},1e3),P()}async function gr(){if(X=document.querySelector("#app"),!X)throw new Error("Root element #app not found");P(),Jl().then(()=>{P()}),i.canvasView==="map"&&i.mode==="Explore"&&at()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",gr):gr();
