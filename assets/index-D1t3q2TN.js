(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function a(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=a(o);fetch(o.href,i)}})();function En(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Ei(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Za(t){let e,a,r;t.length!==2?(e=En,a=(l,c)=>En(t(l),c),r=(l,c)=>t(l)-c):(e=t===En||t===Ei?t:Ci,a=t,r=t);function o(l,c,d=0,u=l.length){if(d<u){if(e(c,c)!==0)return u;do{const h=d+u>>>1;a(l[h],c)<0?d=h+1:u=h}while(d<u)}return d}function i(l,c,d=0,u=l.length){if(d<u){if(e(c,c)!==0)return u;do{const h=d+u>>>1;a(l[h],c)<=0?d=h+1:u=h}while(d<u)}return d}function s(l,c,d=0,u=l.length){const h=o(l,c,d,u-1);return h>d&&r(l[h-1],c)>-r(l[h],c)?h-1:h}return{left:o,center:s,right:i}}function Ci(){return 0}function vo(t){return t===null?NaN:+t}const _i=Za(En),Pi=_i.right;Za(vo).center;const Ii=Math.sqrt(50),Ai=Math.sqrt(10),Ri=Math.sqrt(2);function zn(t,e,a){const r=(e-t)/Math.max(0,a),o=Math.floor(Math.log10(r)),i=r/Math.pow(10,o),s=i>=Ii?10:i>=Ai?5:i>=Ri?2:1;let l,c,d;return o<0?(d=Math.pow(10,-o)/s,l=Math.round(t*d),c=Math.round(e*d),l/d<t&&++l,c/d>e&&--c,d=-d):(d=Math.pow(10,o)*s,l=Math.round(t/d),c=Math.round(e/d),l*d<t&&++l,c*d>e&&--c),c<l&&.5<=a&&a<2?zn(t,e,a*2):[l,c,d]}function Ni(t,e,a){if(e=+e,t=+t,a=+a,!(a>0))return[];if(t===e)return[t];const r=e<t,[o,i,s]=r?zn(e,t,a):zn(t,e,a);if(!(i>=o))return[];const l=i-o+1,c=new Array(l);if(r)if(s<0)for(let d=0;d<l;++d)c[d]=(i-d)/-s;else for(let d=0;d<l;++d)c[d]=(i-d)*s;else if(s<0)for(let d=0;d<l;++d)c[d]=(o+d)/-s;else for(let d=0;d<l;++d)c[d]=(o+d)*s;return c}function _a(t,e,a){return e=+e,t=+t,a=+a,zn(t,e,a)[2]}function Pa(t,e,a){e=+e,t=+t,a=+a;const r=e<t,o=r?_a(e,t,a):_a(t,e,a);return(r?-1:1)*(o<0?1/-o:o)}function Fi(t,e){let a;for(const r of t)r!=null&&(a<r||a===void 0&&r>=r)&&(a=r);return a}function Bi(t,e){let a;for(const r of t)r!=null&&(a>r||a===void 0&&r>=r)&&(a=r);return a}function va(t,e,a=vo){if(!(!(r=t.length)||isNaN(e=+e))){if(e<=0||r<2)return+a(t[0],0,t);if(e>=1)return+a(t[r-1],r-1,t);var r,o=(r-1)*e,i=Math.floor(o),s=+a(t[i],i,t),l=+a(t[i+1],i+1,t);return s+(l-s)*(o-i)}}function Ui(t,e){let a=0,r=0;for(let o of t)o!=null&&(o=+o)>=o&&(++a,r+=o);if(a)return r/a}var Oi={value:()=>{}};function Ja(){for(var t=0,e=arguments.length,a={},r;t<e;++t){if(!(r=arguments[t]+"")||r in a||/[\s.]/.test(r))throw new Error("illegal type: "+r);a[r]=[]}return new Cn(a)}function Cn(t){this._=t}function qi(t,e){return t.trim().split(/^|\s+/).map(function(a){var r="",o=a.indexOf(".");if(o>=0&&(r=a.slice(o+1),a=a.slice(0,o)),a&&!e.hasOwnProperty(a))throw new Error("unknown type: "+a);return{type:a,name:r}})}Cn.prototype=Ja.prototype={constructor:Cn,on:function(t,e){var a=this._,r=qi(t+"",a),o,i=-1,s=r.length;if(arguments.length<2){for(;++i<s;)if((o=(t=r[i]).type)&&(o=Vi(a[o],t.name)))return o;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++i<s;)if(o=(t=r[i]).type)a[o]=br(a[o],t.name,e);else if(e==null)for(o in a)a[o]=br(a[o],t.name,null);return this},copy:function(){var t={},e=this._;for(var a in e)t[a]=e[a].slice();return new Cn(t)},call:function(t,e){if((o=arguments.length-2)>0)for(var a=new Array(o),r=0,o,i;r<o;++r)a[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(i=this._[t],r=0,o=i.length;r<o;++r)i[r].value.apply(e,a)},apply:function(t,e,a){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],o=0,i=r.length;o<i;++o)r[o].value.apply(e,a)}};function Vi(t,e){for(var a=0,r=t.length,o;a<r;++a)if((o=t[a]).name===e)return o.value}function br(t,e,a){for(var r=0,o=t.length;r<o;++r)if(t[r].name===e){t[r]=Oi,t=t.slice(0,r).concat(t.slice(r+1));break}return a!=null&&t.push({name:e,value:a}),t}var Ia="http://www.w3.org/1999/xhtml";const xr={svg:"http://www.w3.org/2000/svg",xhtml:Ia,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function sa(t){var e=t+="",a=e.indexOf(":");return a>=0&&(e=t.slice(0,a))!=="xmlns"&&(t=t.slice(a+1)),xr.hasOwnProperty(e)?{space:xr[e],local:t}:t}function zi(t){return function(){var e=this.ownerDocument,a=this.namespaceURI;return a===Ia&&e.documentElement.namespaceURI===Ia?e.createElement(t):e.createElementNS(a,t)}}function Hi(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function bo(t){var e=sa(t);return(e.local?Hi:zi)(e)}function Wi(){}function tr(t){return t==null?Wi:function(){return this.querySelector(t)}}function Yi(t){typeof t!="function"&&(t=tr(t));for(var e=this._groups,a=e.length,r=new Array(a),o=0;o<a;++o)for(var i=e[o],s=i.length,l=r[o]=new Array(s),c,d,u=0;u<s;++u)(c=i[u])&&(d=t.call(c,c.__data__,u,i))&&("__data__"in c&&(d.__data__=c.__data__),l[u]=d);return new Et(r,this._parents)}function Xi(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function ji(){return[]}function xo(t){return t==null?ji:function(){return this.querySelectorAll(t)}}function Ki(t){return function(){return Xi(t.apply(this,arguments))}}function Gi(t){typeof t=="function"?t=Ki(t):t=xo(t);for(var e=this._groups,a=e.length,r=[],o=[],i=0;i<a;++i)for(var s=e[i],l=s.length,c,d=0;d<l;++d)(c=s[d])&&(r.push(t.call(c,c.__data__,d,s)),o.push(c));return new Et(r,o)}function wo(t){return function(){return this.matches(t)}}function So(t){return function(e){return e.matches(t)}}var Qi=Array.prototype.find;function Zi(t){return function(){return Qi.call(this.children,t)}}function Ji(){return this.firstElementChild}function ts(t){return this.select(t==null?Ji:Zi(typeof t=="function"?t:So(t)))}var es=Array.prototype.filter;function ns(){return Array.from(this.children)}function as(t){return function(){return es.call(this.children,t)}}function rs(t){return this.selectAll(t==null?ns:as(typeof t=="function"?t:So(t)))}function os(t){typeof t!="function"&&(t=wo(t));for(var e=this._groups,a=e.length,r=new Array(a),o=0;o<a;++o)for(var i=e[o],s=i.length,l=r[o]=[],c,d=0;d<s;++d)(c=i[d])&&t.call(c,c.__data__,d,i)&&l.push(c);return new Et(r,this._parents)}function Mo(t){return new Array(t.length)}function is(){return new Et(this._enter||this._groups.map(Mo),this._parents)}function Hn(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}Hn.prototype={constructor:Hn,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function ss(t){return function(){return t}}function ls(t,e,a,r,o,i){for(var s=0,l,c=e.length,d=i.length;s<d;++s)(l=e[s])?(l.__data__=i[s],r[s]=l):a[s]=new Hn(t,i[s]);for(;s<c;++s)(l=e[s])&&(o[s]=l)}function cs(t,e,a,r,o,i,s){var l,c,d=new Map,u=e.length,h=i.length,f=new Array(u),p;for(l=0;l<u;++l)(c=e[l])&&(f[l]=p=s.call(c,c.__data__,l,e)+"",d.has(p)?o[l]=c:d.set(p,c));for(l=0;l<h;++l)p=s.call(t,i[l],l,i)+"",(c=d.get(p))?(r[l]=c,c.__data__=i[l],d.delete(p)):a[l]=new Hn(t,i[l]);for(l=0;l<u;++l)(c=e[l])&&d.get(f[l])===c&&(o[l]=c)}function ds(t){return t.__data__}function us(t,e){if(!arguments.length)return Array.from(this,ds);var a=e?cs:ls,r=this._parents,o=this._groups;typeof t!="function"&&(t=ss(t));for(var i=o.length,s=new Array(i),l=new Array(i),c=new Array(i),d=0;d<i;++d){var u=r[d],h=o[d],f=h.length,p=hs(t.call(u,u&&u.__data__,d,r)),w=p.length,L=l[d]=new Array(w),$=s[d]=new Array(w),x=c[d]=new Array(f);a(u,h,L,$,x,p,e);for(var v=0,T=0,C,k;v<w;++v)if(C=L[v]){for(v>=T&&(T=v+1);!(k=$[T])&&++T<w;);C._next=k||null}}return s=new Et(s,r),s._enter=l,s._exit=c,s}function hs(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function fs(){return new Et(this._exit||this._groups.map(Mo),this._parents)}function ps(t,e,a){var r=this.enter(),o=this,i=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(o=e(o),o&&(o=o.selection())),a==null?i.remove():a(i),r&&o?r.merge(o).order():o}function ms(t){for(var e=t.selection?t.selection():t,a=this._groups,r=e._groups,o=a.length,i=r.length,s=Math.min(o,i),l=new Array(o),c=0;c<s;++c)for(var d=a[c],u=r[c],h=d.length,f=l[c]=new Array(h),p,w=0;w<h;++w)(p=d[w]||u[w])&&(f[w]=p);for(;c<o;++c)l[c]=a[c];return new Et(l,this._parents)}function gs(){for(var t=this._groups,e=-1,a=t.length;++e<a;)for(var r=t[e],o=r.length-1,i=r[o],s;--o>=0;)(s=r[o])&&(i&&s.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(s,i),i=s);return this}function ys(t){t||(t=vs);function e(h,f){return h&&f?t(h.__data__,f.__data__):!h-!f}for(var a=this._groups,r=a.length,o=new Array(r),i=0;i<r;++i){for(var s=a[i],l=s.length,c=o[i]=new Array(l),d,u=0;u<l;++u)(d=s[u])&&(c[u]=d);c.sort(e)}return new Et(o,this._parents).order()}function vs(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function bs(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function xs(){return Array.from(this)}function ws(){for(var t=this._groups,e=0,a=t.length;e<a;++e)for(var r=t[e],o=0,i=r.length;o<i;++o){var s=r[o];if(s)return s}return null}function Ss(){let t=0;for(const e of this)++t;return t}function Ms(){return!this.node()}function $s(t){for(var e=this._groups,a=0,r=e.length;a<r;++a)for(var o=e[a],i=0,s=o.length,l;i<s;++i)(l=o[i])&&t.call(l,l.__data__,i,o);return this}function ks(t){return function(){this.removeAttribute(t)}}function Ds(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Ts(t,e){return function(){this.setAttribute(t,e)}}function Ls(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Es(t,e){return function(){var a=e.apply(this,arguments);a==null?this.removeAttribute(t):this.setAttribute(t,a)}}function Cs(t,e){return function(){var a=e.apply(this,arguments);a==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,a)}}function _s(t,e){var a=sa(t);if(arguments.length<2){var r=this.node();return a.local?r.getAttributeNS(a.space,a.local):r.getAttribute(a)}return this.each((e==null?a.local?Ds:ks:typeof e=="function"?a.local?Cs:Es:a.local?Ls:Ts)(a,e))}function $o(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Ps(t){return function(){this.style.removeProperty(t)}}function Is(t,e,a){return function(){this.style.setProperty(t,e,a)}}function As(t,e,a){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,a)}}function Rs(t,e,a){return arguments.length>1?this.each((e==null?Ps:typeof e=="function"?As:Is)(t,e,a??"")):Oe(this.node(),t)}function Oe(t,e){return t.style.getPropertyValue(e)||$o(t).getComputedStyle(t,null).getPropertyValue(e)}function Ns(t){return function(){delete this[t]}}function Fs(t,e){return function(){this[t]=e}}function Bs(t,e){return function(){var a=e.apply(this,arguments);a==null?delete this[t]:this[t]=a}}function Us(t,e){return arguments.length>1?this.each((e==null?Ns:typeof e=="function"?Bs:Fs)(t,e)):this.node()[t]}function ko(t){return t.trim().split(/^|\s+/)}function er(t){return t.classList||new Do(t)}function Do(t){this._node=t,this._names=ko(t.getAttribute("class")||"")}Do.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function To(t,e){for(var a=er(t),r=-1,o=e.length;++r<o;)a.add(e[r])}function Lo(t,e){for(var a=er(t),r=-1,o=e.length;++r<o;)a.remove(e[r])}function Os(t){return function(){To(this,t)}}function qs(t){return function(){Lo(this,t)}}function Vs(t,e){return function(){(e.apply(this,arguments)?To:Lo)(this,t)}}function zs(t,e){var a=ko(t+"");if(arguments.length<2){for(var r=er(this.node()),o=-1,i=a.length;++o<i;)if(!r.contains(a[o]))return!1;return!0}return this.each((typeof e=="function"?Vs:e?Os:qs)(a,e))}function Hs(){this.textContent=""}function Ws(t){return function(){this.textContent=t}}function Ys(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function Xs(t){return arguments.length?this.each(t==null?Hs:(typeof t=="function"?Ys:Ws)(t)):this.node().textContent}function js(){this.innerHTML=""}function Ks(t){return function(){this.innerHTML=t}}function Gs(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function Qs(t){return arguments.length?this.each(t==null?js:(typeof t=="function"?Gs:Ks)(t)):this.node().innerHTML}function Zs(){this.nextSibling&&this.parentNode.appendChild(this)}function Js(){return this.each(Zs)}function tl(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function el(){return this.each(tl)}function nl(t){var e=typeof t=="function"?t:bo(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function al(){return null}function rl(t,e){var a=typeof t=="function"?t:bo(t),r=e==null?al:typeof e=="function"?e:tr(e);return this.select(function(){return this.insertBefore(a.apply(this,arguments),r.apply(this,arguments)||null)})}function ol(){var t=this.parentNode;t&&t.removeChild(this)}function il(){return this.each(ol)}function sl(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function ll(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function cl(t){return this.select(t?ll:sl)}function dl(t){return arguments.length?this.property("__data__",t):this.node().__data__}function ul(t){return function(e){t.call(this,e,this.__data__)}}function hl(t){return t.trim().split(/^|\s+/).map(function(e){var a="",r=e.indexOf(".");return r>=0&&(a=e.slice(r+1),e=e.slice(0,r)),{type:e,name:a}})}function fl(t){return function(){var e=this.__on;if(e){for(var a=0,r=-1,o=e.length,i;a<o;++a)i=e[a],(!t.type||i.type===t.type)&&i.name===t.name?this.removeEventListener(i.type,i.listener,i.options):e[++r]=i;++r?e.length=r:delete this.__on}}}function pl(t,e,a){return function(){var r=this.__on,o,i=ul(e);if(r){for(var s=0,l=r.length;s<l;++s)if((o=r[s]).type===t.type&&o.name===t.name){this.removeEventListener(o.type,o.listener,o.options),this.addEventListener(o.type,o.listener=i,o.options=a),o.value=e;return}}this.addEventListener(t.type,i,a),o={type:t.type,name:t.name,value:e,listener:i,options:a},r?r.push(o):this.__on=[o]}}function ml(t,e,a){var r=hl(t+""),o,i=r.length,s;if(arguments.length<2){var l=this.node().__on;if(l){for(var c=0,d=l.length,u;c<d;++c)for(o=0,u=l[c];o<i;++o)if((s=r[o]).type===u.type&&s.name===u.name)return u.value}return}for(l=e?pl:fl,o=0;o<i;++o)this.each(l(r[o],e,a));return this}function Eo(t,e,a){var r=$o(t),o=r.CustomEvent;typeof o=="function"?o=new o(e,a):(o=r.document.createEvent("Event"),a?(o.initEvent(e,a.bubbles,a.cancelable),o.detail=a.detail):o.initEvent(e,!1,!1)),t.dispatchEvent(o)}function gl(t,e){return function(){return Eo(this,t,e)}}function yl(t,e){return function(){return Eo(this,t,e.apply(this,arguments))}}function vl(t,e){return this.each((typeof e=="function"?yl:gl)(t,e))}function*bl(){for(var t=this._groups,e=0,a=t.length;e<a;++e)for(var r=t[e],o=0,i=r.length,s;o<i;++o)(s=r[o])&&(yield s)}var Co=[null];function Et(t,e){this._groups=t,this._parents=e}function mn(){return new Et([[document.documentElement]],Co)}function xl(){return this}Et.prototype=mn.prototype={constructor:Et,select:Yi,selectAll:Gi,selectChild:ts,selectChildren:rs,filter:os,data:us,enter:is,exit:fs,join:ps,merge:ms,selection:xl,order:gs,sort:ys,call:bs,nodes:xs,node:ws,size:Ss,empty:Ms,each:$s,attr:_s,style:Rs,property:Us,classed:zs,text:Xs,html:Qs,raise:Js,lower:el,append:nl,insert:rl,remove:il,clone:cl,datum:dl,on:ml,dispatch:vl,[Symbol.iterator]:bl};function Gt(t){return typeof t=="string"?new Et([[document.querySelector(t)]],[document.documentElement]):new Et([[t]],Co)}function wl(t){let e;for(;e=t.sourceEvent;)t=e;return t}function se(t,e){if(t=wl(t),e===void 0&&(e=t.currentTarget),e){var a=e.ownerSVGElement||e;if(a.createSVGPoint){var r=a.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var o=e.getBoundingClientRect();return[t.clientX-o.left-e.clientLeft,t.clientY-o.top-e.clientTop]}}return[t.pageX,t.pageY]}const Aa={capture:!0,passive:!1};function Ra(t){t.preventDefault(),t.stopImmediatePropagation()}function Sl(t){var e=t.document.documentElement,a=Gt(t).on("dragstart.drag",Ra,Aa);"onselectstart"in e?a.on("selectstart.drag",Ra,Aa):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function Ml(t,e){var a=t.document.documentElement,r=Gt(t).on("dragstart.drag",null);e&&(r.on("click.drag",Ra,Aa),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in a?r.on("selectstart.drag",null):(a.style.MozUserSelect=a.__noselect,delete a.__noselect)}function nr(t,e,a){t.prototype=e.prototype=a,a.constructor=t}function _o(t,e){var a=Object.create(t.prototype);for(var r in e)a[r]=e[r];return a}function gn(){}var on=.7,Wn=1/on,Be="\\s*([+-]?\\d+)\\s*",sn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Vt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",$l=/^#([0-9a-f]{3,8})$/,kl=new RegExp(`^rgb\\(${Be},${Be},${Be}\\)$`),Dl=new RegExp(`^rgb\\(${Vt},${Vt},${Vt}\\)$`),Tl=new RegExp(`^rgba\\(${Be},${Be},${Be},${sn}\\)$`),Ll=new RegExp(`^rgba\\(${Vt},${Vt},${Vt},${sn}\\)$`),El=new RegExp(`^hsl\\(${sn},${Vt},${Vt}\\)$`),Cl=new RegExp(`^hsla\\(${sn},${Vt},${Vt},${sn}\\)$`),wr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};nr(gn,Me,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Sr,formatHex:Sr,formatHex8:_l,formatHsl:Pl,formatRgb:Mr,toString:Mr});function Sr(){return this.rgb().formatHex()}function _l(){return this.rgb().formatHex8()}function Pl(){return Po(this).formatHsl()}function Mr(){return this.rgb().formatRgb()}function Me(t){var e,a;return t=(t+"").trim().toLowerCase(),(e=$l.exec(t))?(a=e[1].length,e=parseInt(e[1],16),a===6?$r(e):a===3?new kt(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):a===8?wn(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):a===4?wn(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=kl.exec(t))?new kt(e[1],e[2],e[3],1):(e=Dl.exec(t))?new kt(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Tl.exec(t))?wn(e[1],e[2],e[3],e[4]):(e=Ll.exec(t))?wn(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=El.exec(t))?Tr(e[1],e[2]/100,e[3]/100,1):(e=Cl.exec(t))?Tr(e[1],e[2]/100,e[3]/100,e[4]):wr.hasOwnProperty(t)?$r(wr[t]):t==="transparent"?new kt(NaN,NaN,NaN,0):null}function $r(t){return new kt(t>>16&255,t>>8&255,t&255,1)}function wn(t,e,a,r){return r<=0&&(t=e=a=NaN),new kt(t,e,a,r)}function Il(t){return t instanceof gn||(t=Me(t)),t?(t=t.rgb(),new kt(t.r,t.g,t.b,t.opacity)):new kt}function Na(t,e,a,r){return arguments.length===1?Il(t):new kt(t,e,a,r??1)}function kt(t,e,a,r){this.r=+t,this.g=+e,this.b=+a,this.opacity=+r}nr(kt,Na,_o(gn,{brighter(t){return t=t==null?Wn:Math.pow(Wn,t),new kt(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?on:Math.pow(on,t),new kt(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new kt(we(this.r),we(this.g),we(this.b),Yn(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:kr,formatHex:kr,formatHex8:Al,formatRgb:Dr,toString:Dr}));function kr(){return`#${ve(this.r)}${ve(this.g)}${ve(this.b)}`}function Al(){return`#${ve(this.r)}${ve(this.g)}${ve(this.b)}${ve((isNaN(this.opacity)?1:this.opacity)*255)}`}function Dr(){const t=Yn(this.opacity);return`${t===1?"rgb(":"rgba("}${we(this.r)}, ${we(this.g)}, ${we(this.b)}${t===1?")":`, ${t})`}`}function Yn(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function we(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function ve(t){return t=we(t),(t<16?"0":"")+t.toString(16)}function Tr(t,e,a,r){return r<=0?t=e=a=NaN:a<=0||a>=1?t=e=NaN:e<=0&&(t=NaN),new Ut(t,e,a,r)}function Po(t){if(t instanceof Ut)return new Ut(t.h,t.s,t.l,t.opacity);if(t instanceof gn||(t=Me(t)),!t)return new Ut;if(t instanceof Ut)return t;t=t.rgb();var e=t.r/255,a=t.g/255,r=t.b/255,o=Math.min(e,a,r),i=Math.max(e,a,r),s=NaN,l=i-o,c=(i+o)/2;return l?(e===i?s=(a-r)/l+(a<r)*6:a===i?s=(r-e)/l+2:s=(e-a)/l+4,l/=c<.5?i+o:2-i-o,s*=60):l=c>0&&c<1?0:s,new Ut(s,l,c,t.opacity)}function Rl(t,e,a,r){return arguments.length===1?Po(t):new Ut(t,e,a,r??1)}function Ut(t,e,a,r){this.h=+t,this.s=+e,this.l=+a,this.opacity=+r}nr(Ut,Rl,_o(gn,{brighter(t){return t=t==null?Wn:Math.pow(Wn,t),new Ut(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?on:Math.pow(on,t),new Ut(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,a=this.l,r=a+(a<.5?a:1-a)*e,o=2*a-r;return new kt(ba(t>=240?t-240:t+120,o,r),ba(t,o,r),ba(t<120?t+240:t-120,o,r),this.opacity)},clamp(){return new Ut(Lr(this.h),Sn(this.s),Sn(this.l),Yn(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Yn(this.opacity);return`${t===1?"hsl(":"hsla("}${Lr(this.h)}, ${Sn(this.s)*100}%, ${Sn(this.l)*100}%${t===1?")":`, ${t})`}`}}));function Lr(t){return t=(t||0)%360,t<0?t+360:t}function Sn(t){return Math.max(0,Math.min(1,t||0))}function ba(t,e,a){return(t<60?e+(a-e)*t/60:t<180?a:t<240?e+(a-e)*(240-t)/60:e)*255}const ar=t=>()=>t;function Nl(t,e){return function(a){return t+a*e}}function Fl(t,e,a){return t=Math.pow(t,a),e=Math.pow(e,a)-t,a=1/a,function(r){return Math.pow(t+r*e,a)}}function Bl(t){return(t=+t)==1?Io:function(e,a){return a-e?Fl(e,a,t):ar(isNaN(e)?a:e)}}function Io(t,e){var a=e-t;return a?Nl(t,a):ar(isNaN(t)?e:t)}const Xn=(function t(e){var a=Bl(e);function r(o,i){var s=a((o=Na(o)).r,(i=Na(i)).r),l=a(o.g,i.g),c=a(o.b,i.b),d=Io(o.opacity,i.opacity);return function(u){return o.r=s(u),o.g=l(u),o.b=c(u),o.opacity=d(u),o+""}}return r.gamma=t,r})(1);function Ul(t,e){e||(e=[]);var a=t?Math.min(e.length,t.length):0,r=e.slice(),o;return function(i){for(o=0;o<a;++o)r[o]=t[o]*(1-i)+e[o]*i;return r}}function Ol(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function ql(t,e){var a=e?e.length:0,r=t?Math.min(a,t.length):0,o=new Array(r),i=new Array(a),s;for(s=0;s<r;++s)o[s]=rr(t[s],e[s]);for(;s<a;++s)i[s]=e[s];return function(l){for(s=0;s<r;++s)i[s]=o[s](l);return i}}function Vl(t,e){var a=new Date;return t=+t,e=+e,function(r){return a.setTime(t*(1-r)+e*r),a}}function Bt(t,e){return t=+t,e=+e,function(a){return t*(1-a)+e*a}}function zl(t,e){var a={},r={},o;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(o in e)o in t?a[o]=rr(t[o],e[o]):r[o]=e[o];return function(i){for(o in a)r[o]=a[o](i);return r}}var Fa=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,xa=new RegExp(Fa.source,"g");function Hl(t){return function(){return t}}function Wl(t){return function(e){return t(e)+""}}function Ao(t,e){var a=Fa.lastIndex=xa.lastIndex=0,r,o,i,s=-1,l=[],c=[];for(t=t+"",e=e+"";(r=Fa.exec(t))&&(o=xa.exec(e));)(i=o.index)>a&&(i=e.slice(a,i),l[s]?l[s]+=i:l[++s]=i),(r=r[0])===(o=o[0])?l[s]?l[s]+=o:l[++s]=o:(l[++s]=null,c.push({i:s,x:Bt(r,o)})),a=xa.lastIndex;return a<e.length&&(i=e.slice(a),l[s]?l[s]+=i:l[++s]=i),l.length<2?c[0]?Wl(c[0].x):Hl(e):(e=c.length,function(d){for(var u=0,h;u<e;++u)l[(h=c[u]).i]=h.x(d);return l.join("")})}function rr(t,e){var a=typeof e,r;return e==null||a==="boolean"?ar(e):(a==="number"?Bt:a==="string"?(r=Me(e))?(e=r,Xn):Ao:e instanceof Me?Xn:e instanceof Date?Vl:Ol(e)?Ul:Array.isArray(e)?ql:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?zl:Bt)(t,e)}function Yl(t,e){return t=+t,e=+e,function(a){return Math.round(t*(1-a)+e*a)}}var Er=180/Math.PI,Ba={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Ro(t,e,a,r,o,i){var s,l,c;return(s=Math.sqrt(t*t+e*e))&&(t/=s,e/=s),(c=t*a+e*r)&&(a-=t*c,r-=e*c),(l=Math.sqrt(a*a+r*r))&&(a/=l,r/=l,c/=l),t*r<e*a&&(t=-t,e=-e,c=-c,s=-s),{translateX:o,translateY:i,rotate:Math.atan2(e,t)*Er,skewX:Math.atan(c)*Er,scaleX:s,scaleY:l}}var Mn;function Xl(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Ba:Ro(e.a,e.b,e.c,e.d,e.e,e.f)}function jl(t){return t==null||(Mn||(Mn=document.createElementNS("http://www.w3.org/2000/svg","g")),Mn.setAttribute("transform",t),!(t=Mn.transform.baseVal.consolidate()))?Ba:(t=t.matrix,Ro(t.a,t.b,t.c,t.d,t.e,t.f))}function No(t,e,a,r){function o(d){return d.length?d.pop()+" ":""}function i(d,u,h,f,p,w){if(d!==h||u!==f){var L=p.push("translate(",null,e,null,a);w.push({i:L-4,x:Bt(d,h)},{i:L-2,x:Bt(u,f)})}else(h||f)&&p.push("translate("+h+e+f+a)}function s(d,u,h,f){d!==u?(d-u>180?u+=360:u-d>180&&(d+=360),f.push({i:h.push(o(h)+"rotate(",null,r)-2,x:Bt(d,u)})):u&&h.push(o(h)+"rotate("+u+r)}function l(d,u,h,f){d!==u?f.push({i:h.push(o(h)+"skewX(",null,r)-2,x:Bt(d,u)}):u&&h.push(o(h)+"skewX("+u+r)}function c(d,u,h,f,p,w){if(d!==h||u!==f){var L=p.push(o(p)+"scale(",null,",",null,")");w.push({i:L-4,x:Bt(d,h)},{i:L-2,x:Bt(u,f)})}else(h!==1||f!==1)&&p.push(o(p)+"scale("+h+","+f+")")}return function(d,u){var h=[],f=[];return d=t(d),u=t(u),i(d.translateX,d.translateY,u.translateX,u.translateY,h,f),s(d.rotate,u.rotate,h,f),l(d.skewX,u.skewX,h,f),c(d.scaleX,d.scaleY,u.scaleX,u.scaleY,h,f),d=u=null,function(p){for(var w=-1,L=f.length,$;++w<L;)h[($=f[w]).i]=$.x(p);return h.join("")}}}var Kl=No(Xl,"px, ","px)","deg)"),Gl=No(jl,", ",")",")"),Ql=1e-12;function Cr(t){return((t=Math.exp(t))+1/t)/2}function Zl(t){return((t=Math.exp(t))-1/t)/2}function Jl(t){return((t=Math.exp(2*t))-1)/(t+1)}const tc=(function t(e,a,r){function o(i,s){var l=i[0],c=i[1],d=i[2],u=s[0],h=s[1],f=s[2],p=u-l,w=h-c,L=p*p+w*w,$,x;if(L<Ql)x=Math.log(f/d)/e,$=function(P){return[l+P*p,c+P*w,d*Math.exp(e*P*x)]};else{var v=Math.sqrt(L),T=(f*f-d*d+r*L)/(2*d*a*v),C=(f*f-d*d-r*L)/(2*f*a*v),k=Math.log(Math.sqrt(T*T+1)-T),S=Math.log(Math.sqrt(C*C+1)-C);x=(S-k)/e,$=function(P){var V=P*x,H=Cr(k),W=d/(a*v)*(H*Jl(e*V+k)-Zl(k));return[l+W*p,c+W*w,d*H/Cr(e*V+k)]}}return $.duration=x*1e3*e/Math.SQRT2,$}return o.rho=function(i){var s=Math.max(.001,+i),l=s*s,c=l*l;return t(s,l,c)},o})(Math.SQRT2,2,4);var qe=0,tn=0,Xe=0,Fo=1e3,jn,en,Kn=0,$e=0,la=0,ln=typeof performance=="object"&&performance.now?performance:Date,Bo=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function or(){return $e||(Bo(ec),$e=ln.now()+la)}function ec(){$e=0}function Gn(){this._call=this._time=this._next=null}Gn.prototype=Uo.prototype={constructor:Gn,restart:function(t,e,a){if(typeof t!="function")throw new TypeError("callback is not a function");a=(a==null?or():+a)+(e==null?0:+e),!this._next&&en!==this&&(en?en._next=this:jn=this,en=this),this._call=t,this._time=a,Ua()},stop:function(){this._call&&(this._call=null,this._time=1/0,Ua())}};function Uo(t,e,a){var r=new Gn;return r.restart(t,e,a),r}function nc(){or(),++qe;for(var t=jn,e;t;)(e=$e-t._time)>=0&&t._call.call(void 0,e),t=t._next;--qe}function _r(){$e=(Kn=ln.now())+la,qe=tn=0;try{nc()}finally{qe=0,rc(),$e=0}}function ac(){var t=ln.now(),e=t-Kn;e>Fo&&(la-=e,Kn=t)}function rc(){for(var t,e=jn,a,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(a=e._next,e._next=null,e=t?t._next=a:jn=a);en=t,Ua(r)}function Ua(t){if(!qe){tn&&(tn=clearTimeout(tn));var e=t-$e;e>24?(t<1/0&&(tn=setTimeout(_r,t-ln.now()-la)),Xe&&(Xe=clearInterval(Xe))):(Xe||(Kn=ln.now(),Xe=setInterval(ac,Fo)),qe=1,Bo(_r))}}function Pr(t,e,a){var r=new Gn;return e=e==null?0:+e,r.restart(o=>{r.stop(),t(o+e)},e,a),r}var oc=Ja("start","end","cancel","interrupt"),ic=[],Oo=0,Ir=1,Oa=2,_n=3,Ar=4,qa=5,Pn=6;function ca(t,e,a,r,o,i){var s=t.__transition;if(!s)t.__transition={};else if(a in s)return;sc(t,a,{name:e,index:r,group:o,on:oc,tween:ic,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:Oo})}function ir(t,e){var a=Ot(t,e);if(a.state>Oo)throw new Error("too late; already scheduled");return a}function zt(t,e){var a=Ot(t,e);if(a.state>_n)throw new Error("too late; already running");return a}function Ot(t,e){var a=t.__transition;if(!a||!(a=a[e]))throw new Error("transition not found");return a}function sc(t,e,a){var r=t.__transition,o;r[e]=a,a.timer=Uo(i,0,a.time);function i(d){a.state=Ir,a.timer.restart(s,a.delay,a.time),a.delay<=d&&s(d-a.delay)}function s(d){var u,h,f,p;if(a.state!==Ir)return c();for(u in r)if(p=r[u],p.name===a.name){if(p.state===_n)return Pr(s);p.state===Ar?(p.state=Pn,p.timer.stop(),p.on.call("interrupt",t,t.__data__,p.index,p.group),delete r[u]):+u<e&&(p.state=Pn,p.timer.stop(),p.on.call("cancel",t,t.__data__,p.index,p.group),delete r[u])}if(Pr(function(){a.state===_n&&(a.state=Ar,a.timer.restart(l,a.delay,a.time),l(d))}),a.state=Oa,a.on.call("start",t,t.__data__,a.index,a.group),a.state===Oa){for(a.state=_n,o=new Array(f=a.tween.length),u=0,h=-1;u<f;++u)(p=a.tween[u].value.call(t,t.__data__,a.index,a.group))&&(o[++h]=p);o.length=h+1}}function l(d){for(var u=d<a.duration?a.ease.call(null,d/a.duration):(a.timer.restart(c),a.state=qa,1),h=-1,f=o.length;++h<f;)o[h].call(t,u);a.state===qa&&(a.on.call("end",t,t.__data__,a.index,a.group),c())}function c(){a.state=Pn,a.timer.stop(),delete r[e];for(var d in r)return;delete t.__transition}}function In(t,e){var a=t.__transition,r,o,i=!0,s;if(a){e=e==null?null:e+"";for(s in a){if((r=a[s]).name!==e){i=!1;continue}o=r.state>Oa&&r.state<qa,r.state=Pn,r.timer.stop(),r.on.call(o?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete a[s]}i&&delete t.__transition}}function lc(t){return this.each(function(){In(this,t)})}function cc(t,e){var a,r;return function(){var o=zt(this,t),i=o.tween;if(i!==a){r=a=i;for(var s=0,l=r.length;s<l;++s)if(r[s].name===e){r=r.slice(),r.splice(s,1);break}}o.tween=r}}function dc(t,e,a){var r,o;if(typeof a!="function")throw new Error;return function(){var i=zt(this,t),s=i.tween;if(s!==r){o=(r=s).slice();for(var l={name:e,value:a},c=0,d=o.length;c<d;++c)if(o[c].name===e){o[c]=l;break}c===d&&o.push(l)}i.tween=o}}function uc(t,e){var a=this._id;if(t+="",arguments.length<2){for(var r=Ot(this.node(),a).tween,o=0,i=r.length,s;o<i;++o)if((s=r[o]).name===t)return s.value;return null}return this.each((e==null?cc:dc)(a,t,e))}function sr(t,e,a){var r=t._id;return t.each(function(){var o=zt(this,r);(o.value||(o.value={}))[e]=a.apply(this,arguments)}),function(o){return Ot(o,r).value[e]}}function qo(t,e){var a;return(typeof e=="number"?Bt:e instanceof Me?Xn:(a=Me(e))?(e=a,Xn):Ao)(t,e)}function hc(t){return function(){this.removeAttribute(t)}}function fc(t){return function(){this.removeAttributeNS(t.space,t.local)}}function pc(t,e,a){var r,o=a+"",i;return function(){var s=this.getAttribute(t);return s===o?null:s===r?i:i=e(r=s,a)}}function mc(t,e,a){var r,o=a+"",i;return function(){var s=this.getAttributeNS(t.space,t.local);return s===o?null:s===r?i:i=e(r=s,a)}}function gc(t,e,a){var r,o,i;return function(){var s,l=a(this),c;return l==null?void this.removeAttribute(t):(s=this.getAttribute(t),c=l+"",s===c?null:s===r&&c===o?i:(o=c,i=e(r=s,l)))}}function yc(t,e,a){var r,o,i;return function(){var s,l=a(this),c;return l==null?void this.removeAttributeNS(t.space,t.local):(s=this.getAttributeNS(t.space,t.local),c=l+"",s===c?null:s===r&&c===o?i:(o=c,i=e(r=s,l)))}}function vc(t,e){var a=sa(t),r=a==="transform"?Gl:qo;return this.attrTween(t,typeof e=="function"?(a.local?yc:gc)(a,r,sr(this,"attr."+t,e)):e==null?(a.local?fc:hc)(a):(a.local?mc:pc)(a,r,e))}function bc(t,e){return function(a){this.setAttribute(t,e.call(this,a))}}function xc(t,e){return function(a){this.setAttributeNS(t.space,t.local,e.call(this,a))}}function wc(t,e){var a,r;function o(){var i=e.apply(this,arguments);return i!==r&&(a=(r=i)&&xc(t,i)),a}return o._value=e,o}function Sc(t,e){var a,r;function o(){var i=e.apply(this,arguments);return i!==r&&(a=(r=i)&&bc(t,i)),a}return o._value=e,o}function Mc(t,e){var a="attr."+t;if(arguments.length<2)return(a=this.tween(a))&&a._value;if(e==null)return this.tween(a,null);if(typeof e!="function")throw new Error;var r=sa(t);return this.tween(a,(r.local?wc:Sc)(r,e))}function $c(t,e){return function(){ir(this,t).delay=+e.apply(this,arguments)}}function kc(t,e){return e=+e,function(){ir(this,t).delay=e}}function Dc(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?$c:kc)(e,t)):Ot(this.node(),e).delay}function Tc(t,e){return function(){zt(this,t).duration=+e.apply(this,arguments)}}function Lc(t,e){return e=+e,function(){zt(this,t).duration=e}}function Ec(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Tc:Lc)(e,t)):Ot(this.node(),e).duration}function Cc(t,e){if(typeof e!="function")throw new Error;return function(){zt(this,t).ease=e}}function _c(t){var e=this._id;return arguments.length?this.each(Cc(e,t)):Ot(this.node(),e).ease}function Pc(t,e){return function(){var a=e.apply(this,arguments);if(typeof a!="function")throw new Error;zt(this,t).ease=a}}function Ic(t){if(typeof t!="function")throw new Error;return this.each(Pc(this._id,t))}function Ac(t){typeof t!="function"&&(t=wo(t));for(var e=this._groups,a=e.length,r=new Array(a),o=0;o<a;++o)for(var i=e[o],s=i.length,l=r[o]=[],c,d=0;d<s;++d)(c=i[d])&&t.call(c,c.__data__,d,i)&&l.push(c);return new ae(r,this._parents,this._name,this._id)}function Rc(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,a=t._groups,r=e.length,o=a.length,i=Math.min(r,o),s=new Array(r),l=0;l<i;++l)for(var c=e[l],d=a[l],u=c.length,h=s[l]=new Array(u),f,p=0;p<u;++p)(f=c[p]||d[p])&&(h[p]=f);for(;l<r;++l)s[l]=e[l];return new ae(s,this._parents,this._name,this._id)}function Nc(t){return(t+"").trim().split(/^|\s+/).every(function(e){var a=e.indexOf(".");return a>=0&&(e=e.slice(0,a)),!e||e==="start"})}function Fc(t,e,a){var r,o,i=Nc(e)?ir:zt;return function(){var s=i(this,t),l=s.on;l!==r&&(o=(r=l).copy()).on(e,a),s.on=o}}function Bc(t,e){var a=this._id;return arguments.length<2?Ot(this.node(),a).on.on(t):this.each(Fc(a,t,e))}function Uc(t){return function(){var e=this.parentNode;for(var a in this.__transition)if(+a!==t)return;e&&e.removeChild(this)}}function Oc(){return this.on("end.remove",Uc(this._id))}function qc(t){var e=this._name,a=this._id;typeof t!="function"&&(t=tr(t));for(var r=this._groups,o=r.length,i=new Array(o),s=0;s<o;++s)for(var l=r[s],c=l.length,d=i[s]=new Array(c),u,h,f=0;f<c;++f)(u=l[f])&&(h=t.call(u,u.__data__,f,l))&&("__data__"in u&&(h.__data__=u.__data__),d[f]=h,ca(d[f],e,a,f,d,Ot(u,a)));return new ae(i,this._parents,e,a)}function Vc(t){var e=this._name,a=this._id;typeof t!="function"&&(t=xo(t));for(var r=this._groups,o=r.length,i=[],s=[],l=0;l<o;++l)for(var c=r[l],d=c.length,u,h=0;h<d;++h)if(u=c[h]){for(var f=t.call(u,u.__data__,h,c),p,w=Ot(u,a),L=0,$=f.length;L<$;++L)(p=f[L])&&ca(p,e,a,L,f,w);i.push(f),s.push(u)}return new ae(i,s,e,a)}var zc=mn.prototype.constructor;function Hc(){return new zc(this._groups,this._parents)}function Wc(t,e){var a,r,o;return function(){var i=Oe(this,t),s=(this.style.removeProperty(t),Oe(this,t));return i===s?null:i===a&&s===r?o:o=e(a=i,r=s)}}function Vo(t){return function(){this.style.removeProperty(t)}}function Yc(t,e,a){var r,o=a+"",i;return function(){var s=Oe(this,t);return s===o?null:s===r?i:i=e(r=s,a)}}function Xc(t,e,a){var r,o,i;return function(){var s=Oe(this,t),l=a(this),c=l+"";return l==null&&(c=l=(this.style.removeProperty(t),Oe(this,t))),s===c?null:s===r&&c===o?i:(o=c,i=e(r=s,l))}}function jc(t,e){var a,r,o,i="style."+e,s="end."+i,l;return function(){var c=zt(this,t),d=c.on,u=c.value[i]==null?l||(l=Vo(e)):void 0;(d!==a||o!==u)&&(r=(a=d).copy()).on(s,o=u),c.on=r}}function Kc(t,e,a){var r=(t+="")=="transform"?Kl:qo;return e==null?this.styleTween(t,Wc(t,r)).on("end.style."+t,Vo(t)):typeof e=="function"?this.styleTween(t,Xc(t,r,sr(this,"style."+t,e))).each(jc(this._id,t)):this.styleTween(t,Yc(t,r,e),a).on("end.style."+t,null)}function Gc(t,e,a){return function(r){this.style.setProperty(t,e.call(this,r),a)}}function Qc(t,e,a){var r,o;function i(){var s=e.apply(this,arguments);return s!==o&&(r=(o=s)&&Gc(t,s,a)),r}return i._value=e,i}function Zc(t,e,a){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,Qc(t,e,a??""))}function Jc(t){return function(){this.textContent=t}}function td(t){return function(){var e=t(this);this.textContent=e??""}}function ed(t){return this.tween("text",typeof t=="function"?td(sr(this,"text",t)):Jc(t==null?"":t+""))}function nd(t){return function(e){this.textContent=t.call(this,e)}}function ad(t){var e,a;function r(){var o=t.apply(this,arguments);return o!==a&&(e=(a=o)&&nd(o)),e}return r._value=t,r}function rd(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,ad(t))}function od(){for(var t=this._name,e=this._id,a=zo(),r=this._groups,o=r.length,i=0;i<o;++i)for(var s=r[i],l=s.length,c,d=0;d<l;++d)if(c=s[d]){var u=Ot(c,e);ca(c,t,a,d,s,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new ae(r,this._parents,t,a)}function id(){var t,e,a=this,r=a._id,o=a.size();return new Promise(function(i,s){var l={value:s},c={value:function(){--o===0&&i()}};a.each(function(){var d=zt(this,r),u=d.on;u!==t&&(e=(t=u).copy(),e._.cancel.push(l),e._.interrupt.push(l),e._.end.push(c)),d.on=e}),o===0&&i()})}var sd=0;function ae(t,e,a,r){this._groups=t,this._parents=e,this._name=a,this._id=r}function zo(){return++sd}var Wt=mn.prototype;ae.prototype={constructor:ae,select:qc,selectAll:Vc,selectChild:Wt.selectChild,selectChildren:Wt.selectChildren,filter:Ac,merge:Rc,selection:Hc,transition:od,call:Wt.call,nodes:Wt.nodes,node:Wt.node,size:Wt.size,empty:Wt.empty,each:Wt.each,on:Bc,attr:vc,attrTween:Mc,style:Kc,styleTween:Zc,text:ed,textTween:rd,remove:Oc,tween:uc,delay:Dc,duration:Ec,ease:_c,easeVarying:Ic,end:id,[Symbol.iterator]:Wt[Symbol.iterator]};function ld(t){return--t*t*t+1}function cd(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var dd={time:null,delay:0,duration:250,ease:cd};function ud(t,e){for(var a;!(a=t.__transition)||!(a=a[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return a}function hd(t){var e,a;t instanceof ae?(e=t._id,t=t._name):(e=zo(),(a=dd).time=or(),t=t==null?null:t+"");for(var r=this._groups,o=r.length,i=0;i<o;++i)for(var s=r[i],l=s.length,c,d=0;d<l;++d)(c=s[d])&&ca(c,t,e,d,s,a||ud(c,e));return new ae(r,this._parents,t,e)}mn.prototype.interrupt=lc;mn.prototype.transition=hd;function fd(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function Qn(t,e){if((a=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var a,r=t.slice(0,a);return[r.length>1?r[0]+r.slice(2):r,+t.slice(a+1)]}function Ve(t){return t=Qn(Math.abs(t)),t?t[1]:NaN}function pd(t,e){return function(a,r){for(var o=a.length,i=[],s=0,l=t[0],c=0;o>0&&l>0&&(c+l+1>r&&(l=Math.max(1,r-c)),i.push(a.substring(o-=l,o+l)),!((c+=l+1)>r));)l=t[s=(s+1)%t.length];return i.reverse().join(e)}}function md(t){return function(e){return e.replace(/[0-9]/g,function(a){return t[+a]})}}var gd=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Zn(t){if(!(e=gd.exec(t)))throw new Error("invalid format: "+t);var e;return new lr({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Zn.prototype=lr.prototype;function lr(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}lr.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function yd(t){t:for(var e=t.length,a=1,r=-1,o;a<e;++a)switch(t[a]){case".":r=o=a;break;case"0":r===0&&(r=a),o=a;break;default:if(!+t[a])break t;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(o+1):t}var Ho;function vd(t,e){var a=Qn(t,e);if(!a)return t+"";var r=a[0],o=a[1],i=o-(Ho=Math.max(-8,Math.min(8,Math.floor(o/3)))*3)+1,s=r.length;return i===s?r:i>s?r+new Array(i-s+1).join("0"):i>0?r.slice(0,i)+"."+r.slice(i):"0."+new Array(1-i).join("0")+Qn(t,Math.max(0,e+i-1))[0]}function Rr(t,e){var a=Qn(t,e);if(!a)return t+"";var r=a[0],o=a[1];return o<0?"0."+new Array(-o).join("0")+r:r.length>o+1?r.slice(0,o+1)+"."+r.slice(o+1):r+new Array(o-r.length+2).join("0")}const Nr={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:fd,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Rr(t*100,e),r:Rr,s:vd,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Fr(t){return t}var Br=Array.prototype.map,Ur=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function bd(t){var e=t.grouping===void 0||t.thousands===void 0?Fr:pd(Br.call(t.grouping,Number),t.thousands+""),a=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",o=t.decimal===void 0?".":t.decimal+"",i=t.numerals===void 0?Fr:md(Br.call(t.numerals,String)),s=t.percent===void 0?"%":t.percent+"",l=t.minus===void 0?"−":t.minus+"",c=t.nan===void 0?"NaN":t.nan+"";function d(h){h=Zn(h);var f=h.fill,p=h.align,w=h.sign,L=h.symbol,$=h.zero,x=h.width,v=h.comma,T=h.precision,C=h.trim,k=h.type;k==="n"?(v=!0,k="g"):Nr[k]||(T===void 0&&(T=12),C=!0,k="g"),($||f==="0"&&p==="=")&&($=!0,f="0",p="=");var S=L==="$"?a:L==="#"&&/[boxX]/.test(k)?"0"+k.toLowerCase():"",P=L==="$"?r:/[%p]/.test(k)?s:"",V=Nr[k],H=/[defgprs%]/.test(k);T=T===void 0?6:/[gprs]/.test(k)?Math.max(1,Math.min(21,T)):Math.max(0,Math.min(20,T));function W(q){var j=S,O=P,y,B,_;if(k==="c")O=V(q)+O,q="";else{q=+q;var m=q<0||1/q<0;if(q=isNaN(q)?c:V(Math.abs(q),T),C&&(q=yd(q)),m&&+q==0&&w!=="+"&&(m=!1),j=(m?w==="("?w:l:w==="-"||w==="("?"":w)+j,O=(k==="s"?Ur[8+Ho/3]:"")+O+(m&&w==="("?")":""),H){for(y=-1,B=q.length;++y<B;)if(_=q.charCodeAt(y),48>_||_>57){O=(_===46?o+q.slice(y+1):q.slice(y))+O,q=q.slice(0,y);break}}}v&&!$&&(q=e(q,1/0));var b=j.length+q.length+O.length,D=b<x?new Array(x-b+1).join(f):"";switch(v&&$&&(q=e(D+q,D.length?x-O.length:1/0),D=""),p){case"<":q=j+q+O+D;break;case"=":q=j+D+q+O;break;case"^":q=D.slice(0,b=D.length>>1)+j+q+O+D.slice(b);break;default:q=D+j+q+O;break}return i(q)}return W.toString=function(){return h+""},W}function u(h,f){var p=d((h=Zn(h),h.type="f",h)),w=Math.max(-8,Math.min(8,Math.floor(Ve(f)/3)))*3,L=Math.pow(10,-w),$=Ur[8+w/3];return function(x){return p(L*x)+$}}return{format:d,formatPrefix:u}}var $n,Wo,Yo;xd({thousands:",",grouping:[3],currency:["$",""]});function xd(t){return $n=bd(t),Wo=$n.format,Yo=$n.formatPrefix,$n}function wd(t){return Math.max(0,-Ve(Math.abs(t)))}function Sd(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Ve(e)/3)))*3-Ve(Math.abs(t)))}function Md(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Ve(e)-Ve(t))+1}function Xo(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function $d(t){return function(){return t}}function kd(t){return+t}var Or=[0,1];function Ie(t){return t}function Va(t,e){return(e-=t=+t)?function(a){return(a-t)/e}:$d(isNaN(e)?NaN:.5)}function Dd(t,e){var a;return t>e&&(a=t,t=e,e=a),function(r){return Math.max(t,Math.min(e,r))}}function Td(t,e,a){var r=t[0],o=t[1],i=e[0],s=e[1];return o<r?(r=Va(o,r),i=a(s,i)):(r=Va(r,o),i=a(i,s)),function(l){return i(r(l))}}function Ld(t,e,a){var r=Math.min(t.length,e.length)-1,o=new Array(r),i=new Array(r),s=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++s<r;)o[s]=Va(t[s],t[s+1]),i[s]=a(e[s],e[s+1]);return function(l){var c=Pi(t,l,1,r)-1;return i[c](o[c](l))}}function jo(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Ed(){var t=Or,e=Or,a=rr,r,o,i,s=Ie,l,c,d;function u(){var f=Math.min(t.length,e.length);return s!==Ie&&(s=Dd(t[0],t[f-1])),l=f>2?Ld:Td,c=d=null,h}function h(f){return f==null||isNaN(f=+f)?i:(c||(c=l(t.map(r),e,a)))(r(s(f)))}return h.invert=function(f){return s(o((d||(d=l(e,t.map(r),Bt)))(f)))},h.domain=function(f){return arguments.length?(t=Array.from(f,kd),u()):t.slice()},h.range=function(f){return arguments.length?(e=Array.from(f),u()):e.slice()},h.rangeRound=function(f){return e=Array.from(f),a=Yl,u()},h.clamp=function(f){return arguments.length?(s=f?!0:Ie,u()):s!==Ie},h.interpolate=function(f){return arguments.length?(a=f,u()):a},h.unknown=function(f){return arguments.length?(i=f,h):i},function(f,p){return r=f,o=p,u()}}function Ko(){return Ed()(Ie,Ie)}function Cd(t,e,a,r){var o=Pa(t,e,a),i;switch(r=Zn(r??",f"),r.type){case"s":{var s=Math.max(Math.abs(t),Math.abs(e));return r.precision==null&&!isNaN(i=Sd(o,s))&&(r.precision=i),Yo(r,s)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(i=Md(o,Math.max(Math.abs(t),Math.abs(e))))&&(r.precision=i-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(i=wd(o))&&(r.precision=i-(r.type==="%")*2);break}}return Wo(r)}function _d(t){var e=t.domain;return t.ticks=function(a){var r=e();return Ni(r[0],r[r.length-1],a??10)},t.tickFormat=function(a,r){var o=e();return Cd(o[0],o[o.length-1],a??10,r)},t.nice=function(a){a==null&&(a=10);var r=e(),o=0,i=r.length-1,s=r[o],l=r[i],c,d,u=10;for(l<s&&(d=s,s=l,l=d,d=o,o=i,i=d);u-- >0;){if(d=_a(s,l,a),d===c)return r[o]=s,r[i]=l,e(r);if(d>0)s=Math.floor(s/d)*d,l=Math.ceil(l/d)*d;else if(d<0)s=Math.ceil(s*d)/d,l=Math.floor(l*d)/d;else break;c=d}return t},t}function da(){var t=Ko();return t.copy=function(){return jo(t,da())},Xo.apply(t,arguments),_d(t)}function Pd(t,e){t=t.slice();var a=0,r=t.length-1,o=t[a],i=t[r],s;return i<o&&(s=a,a=r,r=s,s=o,o=i,i=s),t[a]=e.floor(o),t[r]=e.ceil(i),t}const wa=new Date,Sa=new Date;function ht(t,e,a,r){function o(i){return t(i=arguments.length===0?new Date:new Date(+i)),i}return o.floor=i=>(t(i=new Date(+i)),i),o.ceil=i=>(t(i=new Date(i-1)),e(i,1),t(i),i),o.round=i=>{const s=o(i),l=o.ceil(i);return i-s<l-i?s:l},o.offset=(i,s)=>(e(i=new Date(+i),s==null?1:Math.floor(s)),i),o.range=(i,s,l)=>{const c=[];if(i=o.ceil(i),l=l==null?1:Math.floor(l),!(i<s)||!(l>0))return c;let d;do c.push(d=new Date(+i)),e(i,l),t(i);while(d<i&&i<s);return c},o.filter=i=>ht(s=>{if(s>=s)for(;t(s),!i(s);)s.setTime(s-1)},(s,l)=>{if(s>=s)if(l<0)for(;++l<=0;)for(;e(s,-1),!i(s););else for(;--l>=0;)for(;e(s,1),!i(s););}),a&&(o.count=(i,s)=>(wa.setTime(+i),Sa.setTime(+s),t(wa),t(Sa),Math.floor(a(wa,Sa))),o.every=i=>(i=Math.floor(i),!isFinite(i)||!(i>0)?null:i>1?o.filter(r?s=>r(s)%i===0:s=>o.count(0,s)%i===0):o)),o}const Jn=ht(()=>{},(t,e)=>{t.setTime(+t+e)},(t,e)=>e-t);Jn.every=t=>(t=Math.floor(t),!isFinite(t)||!(t>0)?null:t>1?ht(e=>{e.setTime(Math.floor(e/t)*t)},(e,a)=>{e.setTime(+e+a*t)},(e,a)=>(a-e)/t):Jn);Jn.range;const Qt=1e3,Rt=Qt*60,Zt=Rt*60,re=Zt*24,cr=re*7,qr=re*30,Ma=re*365,Ae=ht(t=>{t.setTime(t-t.getMilliseconds())},(t,e)=>{t.setTime(+t+e*Qt)},(t,e)=>(e-t)/Qt,t=>t.getUTCSeconds());Ae.range;const dr=ht(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*Qt)},(t,e)=>{t.setTime(+t+e*Rt)},(t,e)=>(e-t)/Rt,t=>t.getMinutes());dr.range;const Id=ht(t=>{t.setUTCSeconds(0,0)},(t,e)=>{t.setTime(+t+e*Rt)},(t,e)=>(e-t)/Rt,t=>t.getUTCMinutes());Id.range;const ur=ht(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*Qt-t.getMinutes()*Rt)},(t,e)=>{t.setTime(+t+e*Zt)},(t,e)=>(e-t)/Zt,t=>t.getHours());ur.range;const Ad=ht(t=>{t.setUTCMinutes(0,0,0)},(t,e)=>{t.setTime(+t+e*Zt)},(t,e)=>(e-t)/Zt,t=>t.getUTCHours());Ad.range;const yn=ht(t=>t.setHours(0,0,0,0),(t,e)=>t.setDate(t.getDate()+e),(t,e)=>(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*Rt)/re,t=>t.getDate()-1);yn.range;const hr=ht(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/re,t=>t.getUTCDate()-1);hr.range;const Rd=ht(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/re,t=>Math.floor(t/re));Rd.range;function Te(t){return ht(e=>{e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)},(e,a)=>{e.setDate(e.getDate()+a*7)},(e,a)=>(a-e-(a.getTimezoneOffset()-e.getTimezoneOffset())*Rt)/cr)}const ua=Te(0),ta=Te(1),Nd=Te(2),Fd=Te(3),ze=Te(4),Bd=Te(5),Ud=Te(6);ua.range;ta.range;Nd.range;Fd.range;ze.range;Bd.range;Ud.range;function Le(t){return ht(e=>{e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)},(e,a)=>{e.setUTCDate(e.getUTCDate()+a*7)},(e,a)=>(a-e)/cr)}const Go=Le(0),ea=Le(1),Od=Le(2),qd=Le(3),He=Le(4),Vd=Le(5),zd=Le(6);Go.range;ea.range;Od.range;qd.range;He.range;Vd.range;zd.range;const fr=ht(t=>{t.setDate(1),t.setHours(0,0,0,0)},(t,e)=>{t.setMonth(t.getMonth()+e)},(t,e)=>e.getMonth()-t.getMonth()+(e.getFullYear()-t.getFullYear())*12,t=>t.getMonth());fr.range;const Hd=ht(t=>{t.setUTCDate(1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCMonth(t.getUTCMonth()+e)},(t,e)=>e.getUTCMonth()-t.getUTCMonth()+(e.getUTCFullYear()-t.getUTCFullYear())*12,t=>t.getUTCMonth());Hd.range;const oe=ht(t=>{t.setMonth(0,1),t.setHours(0,0,0,0)},(t,e)=>{t.setFullYear(t.getFullYear()+e)},(t,e)=>e.getFullYear()-t.getFullYear(),t=>t.getFullYear());oe.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:ht(e=>{e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)},(e,a)=>{e.setFullYear(e.getFullYear()+a*t)});oe.range;const ke=ht(t=>{t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCFullYear(t.getUTCFullYear()+e)},(t,e)=>e.getUTCFullYear()-t.getUTCFullYear(),t=>t.getUTCFullYear());ke.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:ht(e=>{e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,a)=>{e.setUTCFullYear(e.getUTCFullYear()+a*t)});ke.range;function Wd(t,e,a,r,o,i){const s=[[Ae,1,Qt],[Ae,5,5*Qt],[Ae,15,15*Qt],[Ae,30,30*Qt],[i,1,Rt],[i,5,5*Rt],[i,15,15*Rt],[i,30,30*Rt],[o,1,Zt],[o,3,3*Zt],[o,6,6*Zt],[o,12,12*Zt],[r,1,re],[r,2,2*re],[a,1,cr],[e,1,qr],[e,3,3*qr],[t,1,Ma]];function l(d,u,h){const f=u<d;f&&([d,u]=[u,d]);const p=h&&typeof h.range=="function"?h:c(d,u,h),w=p?p.range(d,+u+1):[];return f?w.reverse():w}function c(d,u,h){const f=Math.abs(u-d)/h,p=Za(([,,$])=>$).right(s,f);if(p===s.length)return t.every(Pa(d/Ma,u/Ma,h));if(p===0)return Jn.every(Math.max(Pa(d,u,h),1));const[w,L]=s[f/s[p-1][2]<s[p][2]/f?p-1:p];return w.every(L)}return[l,c]}const[Yd,Xd]=Wd(oe,fr,ua,yn,ur,dr);function $a(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function ka(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function je(t,e,a){return{y:t,m:e,d:a,H:0,M:0,S:0,L:0}}function jd(t){var e=t.dateTime,a=t.date,r=t.time,o=t.periods,i=t.days,s=t.shortDays,l=t.months,c=t.shortMonths,d=Ke(o),u=Ge(o),h=Ke(i),f=Ge(i),p=Ke(s),w=Ge(s),L=Ke(l),$=Ge(l),x=Ke(c),v=Ge(c),T={a:m,A:b,b:D,B:R,c:null,d:Xr,e:Xr,f:yu,g:Tu,G:Eu,H:pu,I:mu,j:gu,L:Qo,m:vu,M:bu,p:F,q:E,Q:Gr,s:Qr,S:xu,u:wu,U:Su,V:Mu,w:$u,W:ku,x:null,X:null,y:Du,Y:Lu,Z:Cu,"%":Kr},C={a:I,A:U,b:X,B:K,c:null,d:jr,e:jr,f:Au,g:Hu,G:Yu,H:_u,I:Pu,j:Iu,L:Jo,m:Ru,M:Nu,p:Z,q:Q,Q:Gr,s:Qr,S:Fu,u:Bu,U:Uu,V:Ou,w:qu,W:Vu,x:null,X:null,y:zu,Y:Wu,Z:Xu,"%":Kr},k={a:W,A:q,b:j,B:O,c:y,d:Wr,e:Wr,f:du,g:Hr,G:zr,H:Yr,I:Yr,j:iu,L:cu,m:ou,M:su,p:H,q:ru,Q:hu,s:fu,S:lu,u:Jd,U:tu,V:eu,w:Zd,W:nu,x:B,X:_,y:Hr,Y:zr,Z:au,"%":uu};T.x=S(a,T),T.X=S(r,T),T.c=S(e,T),C.x=S(a,C),C.X=S(r,C),C.c=S(e,C);function S(N,Y){return function(G){var A=[],it=-1,at=0,gt=N.length,xt,Ht,xn;for(G instanceof Date||(G=new Date(+G));++it<gt;)N.charCodeAt(it)===37&&(A.push(N.slice(at,it)),(Ht=Vr[xt=N.charAt(++it)])!=null?xt=N.charAt(++it):Ht=xt==="e"?" ":"0",(xn=Y[xt])&&(xt=xn(G,Ht)),A.push(xt),at=it+1);return A.push(N.slice(at,it)),A.join("")}}function P(N,Y){return function(G){var A=je(1900,void 0,1),it=V(A,N,G+="",0),at,gt;if(it!=G.length)return null;if("Q"in A)return new Date(A.Q);if("s"in A)return new Date(A.s*1e3+("L"in A?A.L:0));if(Y&&!("Z"in A)&&(A.Z=0),"p"in A&&(A.H=A.H%12+A.p*12),A.m===void 0&&(A.m="q"in A?A.q:0),"V"in A){if(A.V<1||A.V>53)return null;"w"in A||(A.w=1),"Z"in A?(at=ka(je(A.y,0,1)),gt=at.getUTCDay(),at=gt>4||gt===0?ea.ceil(at):ea(at),at=hr.offset(at,(A.V-1)*7),A.y=at.getUTCFullYear(),A.m=at.getUTCMonth(),A.d=at.getUTCDate()+(A.w+6)%7):(at=$a(je(A.y,0,1)),gt=at.getDay(),at=gt>4||gt===0?ta.ceil(at):ta(at),at=yn.offset(at,(A.V-1)*7),A.y=at.getFullYear(),A.m=at.getMonth(),A.d=at.getDate()+(A.w+6)%7)}else("W"in A||"U"in A)&&("w"in A||(A.w="u"in A?A.u%7:"W"in A?1:0),gt="Z"in A?ka(je(A.y,0,1)).getUTCDay():$a(je(A.y,0,1)).getDay(),A.m=0,A.d="W"in A?(A.w+6)%7+A.W*7-(gt+5)%7:A.w+A.U*7-(gt+6)%7);return"Z"in A?(A.H+=A.Z/100|0,A.M+=A.Z%100,ka(A)):$a(A)}}function V(N,Y,G,A){for(var it=0,at=Y.length,gt=G.length,xt,Ht;it<at;){if(A>=gt)return-1;if(xt=Y.charCodeAt(it++),xt===37){if(xt=Y.charAt(it++),Ht=k[xt in Vr?Y.charAt(it++):xt],!Ht||(A=Ht(N,G,A))<0)return-1}else if(xt!=G.charCodeAt(A++))return-1}return A}function H(N,Y,G){var A=d.exec(Y.slice(G));return A?(N.p=u.get(A[0].toLowerCase()),G+A[0].length):-1}function W(N,Y,G){var A=p.exec(Y.slice(G));return A?(N.w=w.get(A[0].toLowerCase()),G+A[0].length):-1}function q(N,Y,G){var A=h.exec(Y.slice(G));return A?(N.w=f.get(A[0].toLowerCase()),G+A[0].length):-1}function j(N,Y,G){var A=x.exec(Y.slice(G));return A?(N.m=v.get(A[0].toLowerCase()),G+A[0].length):-1}function O(N,Y,G){var A=L.exec(Y.slice(G));return A?(N.m=$.get(A[0].toLowerCase()),G+A[0].length):-1}function y(N,Y,G){return V(N,e,Y,G)}function B(N,Y,G){return V(N,a,Y,G)}function _(N,Y,G){return V(N,r,Y,G)}function m(N){return s[N.getDay()]}function b(N){return i[N.getDay()]}function D(N){return c[N.getMonth()]}function R(N){return l[N.getMonth()]}function F(N){return o[+(N.getHours()>=12)]}function E(N){return 1+~~(N.getMonth()/3)}function I(N){return s[N.getUTCDay()]}function U(N){return i[N.getUTCDay()]}function X(N){return c[N.getUTCMonth()]}function K(N){return l[N.getUTCMonth()]}function Z(N){return o[+(N.getUTCHours()>=12)]}function Q(N){return 1+~~(N.getUTCMonth()/3)}return{format:function(N){var Y=S(N+="",T);return Y.toString=function(){return N},Y},parse:function(N){var Y=P(N+="",!1);return Y.toString=function(){return N},Y},utcFormat:function(N){var Y=S(N+="",C);return Y.toString=function(){return N},Y},utcParse:function(N){var Y=P(N+="",!0);return Y.toString=function(){return N},Y}}}var Vr={"-":"",_:" ",0:"0"},mt=/^\s*\d+/,Kd=/^%/,Gd=/[\\^$*+?|[\]().{}]/g;function rt(t,e,a){var r=t<0?"-":"",o=(r?-t:t)+"",i=o.length;return r+(i<a?new Array(a-i+1).join(e)+o:o)}function Qd(t){return t.replace(Gd,"\\$&")}function Ke(t){return new RegExp("^(?:"+t.map(Qd).join("|")+")","i")}function Ge(t){return new Map(t.map((e,a)=>[e.toLowerCase(),a]))}function Zd(t,e,a){var r=mt.exec(e.slice(a,a+1));return r?(t.w=+r[0],a+r[0].length):-1}function Jd(t,e,a){var r=mt.exec(e.slice(a,a+1));return r?(t.u=+r[0],a+r[0].length):-1}function tu(t,e,a){var r=mt.exec(e.slice(a,a+2));return r?(t.U=+r[0],a+r[0].length):-1}function eu(t,e,a){var r=mt.exec(e.slice(a,a+2));return r?(t.V=+r[0],a+r[0].length):-1}function nu(t,e,a){var r=mt.exec(e.slice(a,a+2));return r?(t.W=+r[0],a+r[0].length):-1}function zr(t,e,a){var r=mt.exec(e.slice(a,a+4));return r?(t.y=+r[0],a+r[0].length):-1}function Hr(t,e,a){var r=mt.exec(e.slice(a,a+2));return r?(t.y=+r[0]+(+r[0]>68?1900:2e3),a+r[0].length):-1}function au(t,e,a){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(a,a+6));return r?(t.Z=r[1]?0:-(r[2]+(r[3]||"00")),a+r[0].length):-1}function ru(t,e,a){var r=mt.exec(e.slice(a,a+1));return r?(t.q=r[0]*3-3,a+r[0].length):-1}function ou(t,e,a){var r=mt.exec(e.slice(a,a+2));return r?(t.m=r[0]-1,a+r[0].length):-1}function Wr(t,e,a){var r=mt.exec(e.slice(a,a+2));return r?(t.d=+r[0],a+r[0].length):-1}function iu(t,e,a){var r=mt.exec(e.slice(a,a+3));return r?(t.m=0,t.d=+r[0],a+r[0].length):-1}function Yr(t,e,a){var r=mt.exec(e.slice(a,a+2));return r?(t.H=+r[0],a+r[0].length):-1}function su(t,e,a){var r=mt.exec(e.slice(a,a+2));return r?(t.M=+r[0],a+r[0].length):-1}function lu(t,e,a){var r=mt.exec(e.slice(a,a+2));return r?(t.S=+r[0],a+r[0].length):-1}function cu(t,e,a){var r=mt.exec(e.slice(a,a+3));return r?(t.L=+r[0],a+r[0].length):-1}function du(t,e,a){var r=mt.exec(e.slice(a,a+6));return r?(t.L=Math.floor(r[0]/1e3),a+r[0].length):-1}function uu(t,e,a){var r=Kd.exec(e.slice(a,a+1));return r?a+r[0].length:-1}function hu(t,e,a){var r=mt.exec(e.slice(a));return r?(t.Q=+r[0],a+r[0].length):-1}function fu(t,e,a){var r=mt.exec(e.slice(a));return r?(t.s=+r[0],a+r[0].length):-1}function Xr(t,e){return rt(t.getDate(),e,2)}function pu(t,e){return rt(t.getHours(),e,2)}function mu(t,e){return rt(t.getHours()%12||12,e,2)}function gu(t,e){return rt(1+yn.count(oe(t),t),e,3)}function Qo(t,e){return rt(t.getMilliseconds(),e,3)}function yu(t,e){return Qo(t,e)+"000"}function vu(t,e){return rt(t.getMonth()+1,e,2)}function bu(t,e){return rt(t.getMinutes(),e,2)}function xu(t,e){return rt(t.getSeconds(),e,2)}function wu(t){var e=t.getDay();return e===0?7:e}function Su(t,e){return rt(ua.count(oe(t)-1,t),e,2)}function Zo(t){var e=t.getDay();return e>=4||e===0?ze(t):ze.ceil(t)}function Mu(t,e){return t=Zo(t),rt(ze.count(oe(t),t)+(oe(t).getDay()===4),e,2)}function $u(t){return t.getDay()}function ku(t,e){return rt(ta.count(oe(t)-1,t),e,2)}function Du(t,e){return rt(t.getFullYear()%100,e,2)}function Tu(t,e){return t=Zo(t),rt(t.getFullYear()%100,e,2)}function Lu(t,e){return rt(t.getFullYear()%1e4,e,4)}function Eu(t,e){var a=t.getDay();return t=a>=4||a===0?ze(t):ze.ceil(t),rt(t.getFullYear()%1e4,e,4)}function Cu(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+rt(e/60|0,"0",2)+rt(e%60,"0",2)}function jr(t,e){return rt(t.getUTCDate(),e,2)}function _u(t,e){return rt(t.getUTCHours(),e,2)}function Pu(t,e){return rt(t.getUTCHours()%12||12,e,2)}function Iu(t,e){return rt(1+hr.count(ke(t),t),e,3)}function Jo(t,e){return rt(t.getUTCMilliseconds(),e,3)}function Au(t,e){return Jo(t,e)+"000"}function Ru(t,e){return rt(t.getUTCMonth()+1,e,2)}function Nu(t,e){return rt(t.getUTCMinutes(),e,2)}function Fu(t,e){return rt(t.getUTCSeconds(),e,2)}function Bu(t){var e=t.getUTCDay();return e===0?7:e}function Uu(t,e){return rt(Go.count(ke(t)-1,t),e,2)}function ti(t){var e=t.getUTCDay();return e>=4||e===0?He(t):He.ceil(t)}function Ou(t,e){return t=ti(t),rt(He.count(ke(t),t)+(ke(t).getUTCDay()===4),e,2)}function qu(t){return t.getUTCDay()}function Vu(t,e){return rt(ea.count(ke(t)-1,t),e,2)}function zu(t,e){return rt(t.getUTCFullYear()%100,e,2)}function Hu(t,e){return t=ti(t),rt(t.getUTCFullYear()%100,e,2)}function Wu(t,e){return rt(t.getUTCFullYear()%1e4,e,4)}function Yu(t,e){var a=t.getUTCDay();return t=a>=4||a===0?He(t):He.ceil(t),rt(t.getUTCFullYear()%1e4,e,4)}function Xu(){return"+0000"}function Kr(){return"%"}function Gr(t){return+t}function Qr(t){return Math.floor(+t/1e3)}var Ce,pr;ju({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function ju(t){return Ce=jd(t),pr=Ce.format,Ce.parse,Ce.utcFormat,Ce.utcParse,Ce}function Ku(t){return new Date(t)}function Gu(t){return t instanceof Date?+t:+new Date(+t)}function ei(t,e,a,r,o,i,s,l,c,d){var u=Ko(),h=u.invert,f=u.domain,p=d(".%L"),w=d(":%S"),L=d("%I:%M"),$=d("%I %p"),x=d("%a %d"),v=d("%b %d"),T=d("%B"),C=d("%Y");function k(S){return(c(S)<S?p:l(S)<S?w:s(S)<S?L:i(S)<S?$:r(S)<S?o(S)<S?x:v:a(S)<S?T:C)(S)}return u.invert=function(S){return new Date(h(S))},u.domain=function(S){return arguments.length?f(Array.from(S,Gu)):f().map(Ku)},u.ticks=function(S){var P=f();return t(P[0],P[P.length-1],S??10)},u.tickFormat=function(S,P){return P==null?k:d(P)},u.nice=function(S){var P=f();return(!S||typeof S.range!="function")&&(S=e(P[0],P[P.length-1],S??10)),S?f(Pd(P,S)):u},u.copy=function(){return jo(u,ei(t,e,a,r,o,i,s,l,c,d))},u}function Qu(){return Xo.apply(ei(Yd,Xd,oe,fr,ua,yn,ur,dr,Ae,pr).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}const kn=t=>()=>t;function Zu(t,{sourceEvent:e,target:a,transform:r,dispatch:o}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:a,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:o}})}function Jt(t,e,a){this.k=t,this.x=e,this.y=a}Jt.prototype={constructor:Jt,scale:function(t){return t===1?this:new Jt(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new Jt(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var ha=new Jt(1,0,0);Jt.prototype;function Da(t){t.stopImmediatePropagation()}function Qe(t){t.preventDefault(),t.stopImmediatePropagation()}function Ju(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function th(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function Zr(){return this.__zoom||ha}function eh(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function nh(){return navigator.maxTouchPoints||"ontouchstart"in this}function ah(t,e,a){var r=t.invertX(e[0][0])-a[0][0],o=t.invertX(e[1][0])-a[1][0],i=t.invertY(e[0][1])-a[0][1],s=t.invertY(e[1][1])-a[1][1];return t.translate(o>r?(r+o)/2:Math.min(0,r)||Math.max(0,o),s>i?(i+s)/2:Math.min(0,i)||Math.max(0,s))}function rh(){var t=Ju,e=th,a=ah,r=eh,o=nh,i=[0,1/0],s=[[-1/0,-1/0],[1/0,1/0]],l=250,c=tc,d=Ja("start","zoom","end"),u,h,f,p=500,w=150,L=0,$=10;function x(y){y.property("__zoom",Zr).on("wheel.zoom",V,{passive:!1}).on("mousedown.zoom",H).on("dblclick.zoom",W).filter(o).on("touchstart.zoom",q).on("touchmove.zoom",j).on("touchend.zoom touchcancel.zoom",O).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}x.transform=function(y,B,_,m){var b=y.selection?y.selection():y;b.property("__zoom",Zr),y!==b?k(y,B,_,m):b.interrupt().each(function(){S(this,arguments).event(m).start().zoom(null,typeof B=="function"?B.apply(this,arguments):B).end()})},x.scaleBy=function(y,B,_,m){x.scaleTo(y,function(){var b=this.__zoom.k,D=typeof B=="function"?B.apply(this,arguments):B;return b*D},_,m)},x.scaleTo=function(y,B,_,m){x.transform(y,function(){var b=e.apply(this,arguments),D=this.__zoom,R=_==null?C(b):typeof _=="function"?_.apply(this,arguments):_,F=D.invert(R),E=typeof B=="function"?B.apply(this,arguments):B;return a(T(v(D,E),R,F),b,s)},_,m)},x.translateBy=function(y,B,_,m){x.transform(y,function(){return a(this.__zoom.translate(typeof B=="function"?B.apply(this,arguments):B,typeof _=="function"?_.apply(this,arguments):_),e.apply(this,arguments),s)},null,m)},x.translateTo=function(y,B,_,m,b){x.transform(y,function(){var D=e.apply(this,arguments),R=this.__zoom,F=m==null?C(D):typeof m=="function"?m.apply(this,arguments):m;return a(ha.translate(F[0],F[1]).scale(R.k).translate(typeof B=="function"?-B.apply(this,arguments):-B,typeof _=="function"?-_.apply(this,arguments):-_),D,s)},m,b)};function v(y,B){return B=Math.max(i[0],Math.min(i[1],B)),B===y.k?y:new Jt(B,y.x,y.y)}function T(y,B,_){var m=B[0]-_[0]*y.k,b=B[1]-_[1]*y.k;return m===y.x&&b===y.y?y:new Jt(y.k,m,b)}function C(y){return[(+y[0][0]+ +y[1][0])/2,(+y[0][1]+ +y[1][1])/2]}function k(y,B,_,m){y.on("start.zoom",function(){S(this,arguments).event(m).start()}).on("interrupt.zoom end.zoom",function(){S(this,arguments).event(m).end()}).tween("zoom",function(){var b=this,D=arguments,R=S(b,D).event(m),F=e.apply(b,D),E=_==null?C(F):typeof _=="function"?_.apply(b,D):_,I=Math.max(F[1][0]-F[0][0],F[1][1]-F[0][1]),U=b.__zoom,X=typeof B=="function"?B.apply(b,D):B,K=c(U.invert(E).concat(I/U.k),X.invert(E).concat(I/X.k));return function(Z){if(Z===1)Z=X;else{var Q=K(Z),N=I/Q[2];Z=new Jt(N,E[0]-Q[0]*N,E[1]-Q[1]*N)}R.zoom(null,Z)}})}function S(y,B,_){return!_&&y.__zooming||new P(y,B)}function P(y,B){this.that=y,this.args=B,this.active=0,this.sourceEvent=null,this.extent=e.apply(y,B),this.taps=0}P.prototype={event:function(y){return y&&(this.sourceEvent=y),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(y,B){return this.mouse&&y!=="mouse"&&(this.mouse[1]=B.invert(this.mouse[0])),this.touch0&&y!=="touch"&&(this.touch0[1]=B.invert(this.touch0[0])),this.touch1&&y!=="touch"&&(this.touch1[1]=B.invert(this.touch1[0])),this.that.__zoom=B,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(y){var B=Gt(this.that).datum();d.call(y,this.that,new Zu(y,{sourceEvent:this.sourceEvent,target:x,transform:this.that.__zoom,dispatch:d}),B)}};function V(y,...B){if(!t.apply(this,arguments))return;var _=S(this,B).event(y),m=this.__zoom,b=Math.max(i[0],Math.min(i[1],m.k*Math.pow(2,r.apply(this,arguments)))),D=se(y);if(_.wheel)(_.mouse[0][0]!==D[0]||_.mouse[0][1]!==D[1])&&(_.mouse[1]=m.invert(_.mouse[0]=D)),clearTimeout(_.wheel);else{if(m.k===b)return;_.mouse=[D,m.invert(D)],In(this),_.start()}Qe(y),_.wheel=setTimeout(R,w),_.zoom("mouse",a(T(v(m,b),_.mouse[0],_.mouse[1]),_.extent,s));function R(){_.wheel=null,_.end()}}function H(y,...B){if(f||!t.apply(this,arguments))return;var _=y.currentTarget,m=S(this,B,!0).event(y),b=Gt(y.view).on("mousemove.zoom",E,!0).on("mouseup.zoom",I,!0),D=se(y,_),R=y.clientX,F=y.clientY;Sl(y.view),Da(y),m.mouse=[D,this.__zoom.invert(D)],In(this),m.start();function E(U){if(Qe(U),!m.moved){var X=U.clientX-R,K=U.clientY-F;m.moved=X*X+K*K>L}m.event(U).zoom("mouse",a(T(m.that.__zoom,m.mouse[0]=se(U,_),m.mouse[1]),m.extent,s))}function I(U){b.on("mousemove.zoom mouseup.zoom",null),Ml(U.view,m.moved),Qe(U),m.event(U).end()}}function W(y,...B){if(t.apply(this,arguments)){var _=this.__zoom,m=se(y.changedTouches?y.changedTouches[0]:y,this),b=_.invert(m),D=_.k*(y.shiftKey?.5:2),R=a(T(v(_,D),m,b),e.apply(this,B),s);Qe(y),l>0?Gt(this).transition().duration(l).call(k,R,m,y):Gt(this).call(x.transform,R,m,y)}}function q(y,...B){if(t.apply(this,arguments)){var _=y.touches,m=_.length,b=S(this,B,y.changedTouches.length===m).event(y),D,R,F,E;for(Da(y),R=0;R<m;++R)F=_[R],E=se(F,this),E=[E,this.__zoom.invert(E),F.identifier],b.touch0?!b.touch1&&b.touch0[2]!==E[2]&&(b.touch1=E,b.taps=0):(b.touch0=E,D=!0,b.taps=1+!!u);u&&(u=clearTimeout(u)),D&&(b.taps<2&&(h=E[0],u=setTimeout(function(){u=null},p)),In(this),b.start())}}function j(y,...B){if(this.__zooming){var _=S(this,B).event(y),m=y.changedTouches,b=m.length,D,R,F,E;for(Qe(y),D=0;D<b;++D)R=m[D],F=se(R,this),_.touch0&&_.touch0[2]===R.identifier?_.touch0[0]=F:_.touch1&&_.touch1[2]===R.identifier&&(_.touch1[0]=F);if(R=_.that.__zoom,_.touch1){var I=_.touch0[0],U=_.touch0[1],X=_.touch1[0],K=_.touch1[1],Z=(Z=X[0]-I[0])*Z+(Z=X[1]-I[1])*Z,Q=(Q=K[0]-U[0])*Q+(Q=K[1]-U[1])*Q;R=v(R,Math.sqrt(Z/Q)),F=[(I[0]+X[0])/2,(I[1]+X[1])/2],E=[(U[0]+K[0])/2,(U[1]+K[1])/2]}else if(_.touch0)F=_.touch0[0],E=_.touch0[1];else return;_.zoom("touch",a(T(R,F,E),_.extent,s))}}function O(y,...B){if(this.__zooming){var _=S(this,B).event(y),m=y.changedTouches,b=m.length,D,R;for(Da(y),f&&clearTimeout(f),f=setTimeout(function(){f=null},p),D=0;D<b;++D)R=m[D],_.touch0&&_.touch0[2]===R.identifier?delete _.touch0:_.touch1&&_.touch1[2]===R.identifier&&delete _.touch1;if(_.touch1&&!_.touch0&&(_.touch0=_.touch1,delete _.touch1),_.touch0)_.touch0[1]=this.__zoom.invert(_.touch0[0]);else if(_.end(),_.taps===2&&(R=se(R,this),Math.hypot(h[0]-R[0],h[1]-R[1])<$)){var F=Gt(this).on("dblclick.zoom");F&&F.apply(this,arguments)}}}return x.wheelDelta=function(y){return arguments.length?(r=typeof y=="function"?y:kn(+y),x):r},x.filter=function(y){return arguments.length?(t=typeof y=="function"?y:kn(!!y),x):t},x.touchable=function(y){return arguments.length?(o=typeof y=="function"?y:kn(!!y),x):o},x.extent=function(y){return arguments.length?(e=typeof y=="function"?y:kn([[+y[0][0],+y[0][1]],[+y[1][0],+y[1][1]]]),x):e},x.scaleExtent=function(y){return arguments.length?(i[0]=+y[0],i[1]=+y[1],x):[i[0],i[1]]},x.translateExtent=function(y){return arguments.length?(s[0][0]=+y[0][0],s[1][0]=+y[1][0],s[0][1]=+y[0][1],s[1][1]=+y[1][1],x):[[s[0][0],s[0][1]],[s[1][0],s[1][1]]]},x.constrain=function(y){return arguments.length?(a=y,x):a},x.duration=function(y){return arguments.length?(l=+y,x):l},x.interpolate=function(y){return arguments.length?(c=y,x):c},x.on=function(){var y=d.on.apply(d,arguments);return y===d?x:y},x.clickDistance=function(y){return arguments.length?(L=(y=+y)*y,x):Math.sqrt(L)},x.tapDistance=function(y){return arguments.length?($=+y,x):$},x}async function oh(t){const e="http://localhost:8000";try{const a=await fetch(`${e}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok){const o=await a.text();throw new Error(`Chat API error (${a.status}): ${o}`)}return await a.json()}catch(a){return console.error("Chat API error:",a),{message:`Fehler bei der Kommunikation mit dem Chat-Service: ${a instanceof Error?a.message:"Unbekannter Fehler"}`,success:!1,error:a instanceof Error?a.message:"Unknown error"}}}function ih(t){const e={mode:t.mode,canvasView:t.canvasView,selectedVariable:t.selectedVariable,selectedModel:t.selectedModel,selectedScenario:t.selectedScenario,selectedDate:t.selectedDate};return t.currentDataStats&&(e.dataStats={min:t.currentDataStats.min,max:t.currentDataStats.max,mean:t.currentDataStats.mean,median:t.currentDataStats.median,stddev:t.currentDataStats.stddev}),t.selectedLocation&&(e.selectedLocation={lat:t.selectedLocation.lat,lon:t.selectedLocation.lon,value:t.selectedLocation.value}),t.mode==="Compare"&&t.compareMode&&(e.compareMode=t.compareMode,t.compareMode==="Scenarios"?(e.scenario1=t.selectedScenario1,e.scenario2=t.selectedScenario2):t.compareMode==="Models"?(e.model1=t.selectedModel1,e.model2=t.selectedModel2):t.compareMode==="Dates"&&(e.date1=t.selectedDate1,e.date2=t.selectedDate2)),t.canvasView==="chart"&&t.chartMode&&(e.chartMode=t.chartMode),e}let za=null;function sh(t){za=t}function lh(t){if(!t||!za)return;const e={};t.mode&&(e.mode=t.mode),t.model&&(e.model=t.model),t.selectedScenario&&(e.scenario=t.selectedScenario),t.selectedDate&&(e.date=t.selectedDate),t.variable&&(e.variable=t.variable),t.palette&&(e.palette=t.palette),t.compareMode&&(e.compareMode=t.compareMode),t.scenario1&&(e.compareScenarioA=t.scenario1),t.scenario2&&(e.compareScenarioB=t.scenario2),t.model1&&(e.compareModelA=t.model1),t.model2&&(e.compareModelB=t.model2),t.date1&&(e.compareDateStart=t.date1),t.date2&&(e.compareDateEnd=t.date2),t.chartMode&&(e.chartMode=t.chartMode),t.chartDate&&(e.chartDate=t.chartDate),t.location&&(e.chartLocation=t.location),t.start_date&&(e.chartRangeStart=t.start_date),t.end_date&&(e.chartRangeEnd=t.end_date),t.models&&(e.chartModels=t.models),t.scenarios&&(e.chartScenarios=t.scenarios.map(a=>De(a))),t.colorPalette&&(e.palette=Yh(t.colorPalette)),t.canvasView&&(e.canvasView=t.canvasView.toLowerCase()),Object.keys(e).length>0&&(console.log("Applying state updates from backend:",e),za(e))}function ch(t){let e=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");e=e.replace(/```(.+?)```/gs,'<code style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px; font-family: monospace; display: inline-block; margin: 4px 0; line-height: 1.4;">$1</code>'),e=e.replace(/`(.+?)`/g,'<code style="background: rgba(255,255,255,0.1); padding: 2px 4px; border-radius: 3px; font-family: monospace; font-size: 0.9em; vertical-align: middle; line-height: 1.4;">$1</code>'),e=e.replace(/\*\*(.+?)\*\*/g,'<strong style="font-weight: 700;">$1</strong>'),e=e.replace(/__(.+?)__/g,'<strong style="font-weight: 700;">$1</strong>');const a=e.split(`
`),r=[];for(let o=0;o<a.length;o++){const i=a[o].trim();if(i.startsWith("- ")){const s=i.substring(2);r.push(`<div style="display: flex; gap: 8px; margin: 6px 0;"><span style="flex-shrink: 0;">•</span><span style="flex: 1; line-height: 1.6; word-break: break-word; overflow-wrap: break-word;">${s}</span></div>`)}else if(/^\d+\.\s/.test(i)){const s=i.match(/^(\d+)\.\s(.+)$/);if(s){const l=s[1],c=s[2];r.push(`<div style="display: flex; gap: 8px; margin: 6px 0;"><span style="flex-shrink: 0; font-weight: 600; line-height: 1.6;">${l}.</span><span style="flex: 1; line-height: 1.6; word-break: break-word; overflow-wrap: break-word;">${c}</span></div>`)}else r.push(i)}else i.length>0?r.push(`<div style="margin: 8px 0; line-height: 1.6;">${i}</div>`):r.push('<div style="height: 12px;"></div>')}return r.join("")}function ni(t){const e=t.sender==="user"?"chat-bubble chat-bubble-user":"chat-bubble chat-bubble-agent",a=t.sender==="user"?t.text:ch(t.text);return`<div class="${e}">${a}</div>`}function Ta(t,e){const a=t.querySelector(".chat-messages");if(!a)return;const r=ni(e);a.insertAdjacentHTML("beforeend",r),a.scrollTop=a.scrollHeight}function La(t,e){const a=t.querySelector(".chat-loading");a&&(a.style.display=e?"flex":"none")}function dh(t,e){return`
    <div class="chat-stack">
      <div class="chat-lead">Discuss the data with an agent, or ask questions.</div>

      <div class="chat-messages">
            ${t.map(a=>ni(a)).join("")}
      </div>
      <div class="chat-bubble chat-bubble-agent chat-loading" style="display: none">
        <span class="chat-loading-dot"></span><span class="chat-loading-dot"></span><span class="chat-loading-dot"></span>
      </div>
    

      <div class="chat-box">
        <input
          type="text"
          value="${e}"
          data-action="chat-input"
          class="chat-input"
          placeholder="Ask a question"
        />
        <button 
          type="button" 
          data-action="chat-send" 
          aria-label="Send chat message" 
          class="chat-send"
        >
          ➤
        </button>
      </div>
    </div>
  `}function uh(t,e,a){const r=t.querySelector('[data-action="chat-input"]'),o=t.querySelector('[data-action="chat-send"]');r?.addEventListener("input",i=>{e.chatInput=i.target.value}),r?.addEventListener("keydown",i=>{if(i.key==="ArrowUp"&&e.chatMessages.length>0){const s=[...e.chatMessages].reverse().find(l=>l.sender==="user");s&&(e.chatInput=s.text,r&&(r.value=s.text),setTimeout(()=>{r?.setSelectionRange(r.value.length,r.value.length)},0))}i.key==="Enter"&&Jr(t,e,a)}),o?.addEventListener("click",()=>{Jr(t,e,a)})}async function Jr(t,e,a){const r=e.chatInput.trim();if(!r)return;const o={id:Date.now(),sender:"user",text:r};e.chatMessages=[...e.chatMessages,o],e.chatInput="";const i=t.querySelector('[data-action="chat-input"]');i&&(i.value=""),Ta(t,o),La(t,!0);const s=e.chatMessages.slice(Math.max(0,e.chatMessages.length-11),-1).map(c=>({role:c.sender==="user"?"user":"assistant",content:c.text})),l=ih({mode:a.mode,canvasView:a.canvasView,selectedVariable:a.selectedVariable,selectedModel:a.selectedModel,selectedScenario:a.selectedScenario,selectedDate:a.selectedDate,compareMode:a.compareMode,chartMode:a.chartMode,selectedScenario1:a.selectedScenario1,selectedScenario2:a.selectedScenario2,selectedModel1:a.selectedModel1,selectedModel2:a.selectedModel2,selectedDate1:a.selectedDate1,selectedDate2:a.selectedDate2,currentDataStats:a.currentDataStats});try{const c=await oh({message:r,context:l,history:s}),d={id:Date.now()+1,sender:"agent",text:c.message,new_state:c.new_state};console.log("New state from agent:",d.new_state),e.chatMessages=[...e.chatMessages,d],d.new_state&&lh(d.new_state),La(t,!1),Ta(t,d)}catch(c){const d={id:Date.now()+1,sender:"agent",text:`Entschuldigung, es gab einen Fehler: ${c instanceof Error?c.message:"Unbekannter Fehler"}`};e.chatMessages=[...e.chatMessages,d],La(t,!1),Ta(t,d)}}const $t=360;let me=null,Xt=null;function hh(t){const{root:e,isOpen:a,onCanvasToggleUpdate:r,onTimeSliderUpdate:o}=t;me||(me=e.querySelector('[data-role="sidebar"]')),Xt||(Xt=e.querySelector('[data-action="toggle-sidebar"]'));const i=e.querySelector('[data-role="canvas-toggle"]'),s=e.querySelector('[data-role="compare-info-trigger"]'),l=e.querySelector('[data-role="compare-info-overlay"]');if(!me||!i||!Xt)return;const c=a?"translateX(0)":`translateX(${$t+24}px)`;me.style.transform=c,me.style.pointerEvents=a?"auto":"none",me.setAttribute("aria-hidden",String(!a));const d=a?`${$t+10}px`:"14px";Xt.style.right=d,Xt.setAttribute("aria-label",a?"Collapse sidebar":"Expand sidebar"),Xt.className=a?"sidebar-toggle open":"sidebar-toggle";const u=Xt.querySelector("span");u&&(u.textContent=a?"›":"‹");const h=a?$t+24:24;i.style.right=`${h}px`,s&&(s.style.right=`${h}px`),l&&(l.style.left=a?`${$t}px`:"0",l.style.right="0"),r&&r(h),o&&o(a)}function fh(t){const{root:e,getSidebarOpen:a,setSidebarOpen:r,onCanvasToggleUpdate:o,onTimeSliderUpdate:i}=t;me=e.querySelector('[data-role="sidebar"]'),Xt=e.querySelector('[data-action="toggle-sidebar"]'),Xt?.addEventListener("click",()=>{const s=!a();r(s),hh({root:e,isOpen:s,onCanvasToggleUpdate:o,onTimeSliderUpdate:i})})}function ph(t){const e=t?$t+10:14;return`
      <button
        type="button"
        aria-label="${t?"Collapse sidebar":"Expand sidebar"}"
        data-action="toggle-sidebar"
        class="${t?"sidebar-toggle open":"sidebar-toggle"}"
        style="right: ${e}px"
      >
        <span class="sidebar-toggle-icon">${t?"›":"‹"}</span>
      </button>
    `}const dt={map:"map",scenario:"scenario",models:"models",date:"date",variable:"variable",unit:"unit",palette:"palette",timeframe:"timeframe",mapReview:"map-review",compareSwitch:"compare-switch",compareParameters:"compare-parameters",chatSwitch:"chat-switch",chatOverview:"chat-overview",analysisSwitch:"analysis-switch",analysisOverview:"analysis-overview"},wt={map:"#map-canvas",scenario:'[data-role="scenario-selector"]',model:'[data-role="model-selector"]',date:'[data-role="date-picker"]',variable:'[data-role="variable-selector"]',unit:'[data-role="unit-selector"]',palette:'[data-role="palette-selector"]',timeSlider:'[data-role="time-slider"]',compareSwitch:'[data-action="set-mode"][data-value="Compare"]',compareParameters:'[data-role="compare-parameters"]',chatSwitch:'[data-action="set-tab"][data-value="Chat"]',chatSection:'[data-role="chat-section"]',analysisSwitch:'[data-action="set-canvas"][data-value="chart"]',analysisOverview:'[data-role="chart-container"]'},vn=[{id:dt.map,title:"Welcome to Climate Visualization",description:"This interactive map shows climate data across the globe. You can pan by dragging, zoom with your mouse wheel, and hover over any location to see detailed information.",targetSelector:wt.map,position:"center",requiresAction:{type:"none"}},{id:dt.scenario,title:"Climate Scenarios",description:"Choose a climate scenario: Historical (1950-2014) shows past data, while SSP245, SSP370, and SSP585 represent different future warming pathways. Select one to continue.",targetSelector:wt.scenario,position:"left",requiresAction:{type:"select",dataKey:"scenario"}},{id:dt.models,title:"Climate Models",description:"Select from 11 global climate models developed by research institutions worldwide. Each model provides unique projections. Choose a model to continue.",targetSelector:wt.model,position:"left",requiresAction:{type:"select",dataKey:"model"}},{id:dt.date,title:"Date Selection",description:"Pick a date to view climate data. The available range depends on your chosen scenario. Select a date to continue.",targetSelector:wt.date,position:"left",requiresAction:{type:"input",dataKey:"date"}},{id:dt.variable,title:"Climate Variable",description:"Select which climate variable to visualize, such as temperature or precipitation. Choose one to continue.",targetSelector:wt.variable,position:"left",requiresAction:{type:"select",dataKey:"variable"}},{id:dt.unit,title:"Unit Preferences",description:"Choose your preferred temperature unit: Celsius (°C), Fahrenheit (°F), or Kelvin (K). Select a unit to continue.",targetSelector:wt.unit,position:"left",requiresAction:{type:"select",dataKey:"unit"}},{id:dt.palette,title:"Color Palette",description:"Select a color scheme for the map. Different palettes can help visualize temperature variations. Choose a palette to continue.",targetSelector:wt.palette,position:"left",requiresAction:{type:"select",dataKey:"palette"}},{id:dt.timeframe,title:"Time Navigation",description:"Use this slider to quickly navigate through different dates and see how climate patterns change over time.",targetSelector:wt.timeSlider,position:"top",requiresAction:{type:"none"}},{id:dt.mapReview,title:"Review the Map",description:"Great! Your parameters are set. Take a quick look at the map with your chosen settings, then continue.",targetSelector:wt.map,position:"right",requiresAction:{type:"none"}},{id:dt.compareSwitch,title:"Compare Mode",description:"Now switch to Compare mode to explore differences side by side. Click Compare to continue.",targetSelector:wt.compareSwitch,position:"left",requiresAction:{type:"click"}},{id:dt.compareParameters,title:"Compare Parameters",description:"These settings control what you compare and how the differences are calculated. Review the options, then continue.",targetSelector:wt.compareParameters,position:"left",requiresAction:{type:"none"}},{id:dt.chatSwitch,title:"Chat",description:"Open the Chat tab to ask questions about the data and get insights. Click Chat to continue.",targetSelector:wt.chatSwitch,position:"left",requiresAction:{type:"click"}},{id:dt.chatOverview,title:"Chat Overview",description:"Use the chat to explore insights, ask about trends, or get help interpreting results. You can also change the parameters with the chat, e.g. 'Compare optimistic and pessimistic prediction of precipitation for 2050. Change the color for a good representation'.<br><br>When you're ready, continue.",targetSelector:wt.chatSection,position:"left",requiresAction:{type:"none"}},{id:dt.analysisSwitch,title:"Analysis Tools",description:"Switch to the Analysis view to see detailed charts and statistics. Click the Analysis button to continue.",targetSelector:wt.analysisSwitch,position:"left",requiresAction:{type:"click"}},{id:dt.analysisOverview,title:"Analysis Overview",description:"Here you can explore charts, compare scenarios, and analyze trends over time. This is where you dive deeper into the data. The tutorial is complete!",targetSelector:wt.analysisOverview,position:"center",requiresAction:{type:"none"}}];let ue={active:!1,currentStep:0,completed:!1};const mr=new Set;function jt(){return ue}function mh(){ue={active:!0,currentStep:0,completed:!1},mr.clear()}function ai(){ue={active:!1,currentStep:0,completed:!1},mr.clear(),document.querySelectorAll(".tutorial-target-active").forEach(t=>{t.classList.remove("tutorial-target-active")})}function gh(){ue.currentStep<vn.length-1?ue.currentStep++:ai()}function ye(){const t=vn[ue.currentStep];t&&mr.add(t.id),gh()}function yh(){return{current:ue.currentStep+1,total:vn.length}}function to(t,e,a=!0){if(e===dt.map)return null;const r=document.querySelector(t);if(r){if(e===dt.mapReview){const l=document.querySelector('[data-role="sidebar"]')?.getBoundingClientRect(),c=l?l.left:window.innerWidth;return new DOMRect(0,0,Math.max(c,0),window.innerHeight)}if(e===dt.chatOverview){const l=document.querySelector('[data-role="sidebar"]')?.getBoundingClientRect();if(l)return new DOMRect(l.left,0,l.width,window.innerHeight)}const o=r.getBoundingClientRect(),i=r.querySelector(".custom-select-dropdown");if(a&&i&&r.classList.contains("open")){const s=i.getBoundingClientRect(),l=Math.min(o.top,s.top),c=Math.max(o.bottom,s.bottom),d=Math.min(o.left,s.left),u=Math.max(o.right,s.right);return new DOMRect(d,l,u-d,c-l)}return o}return null}function vh(t,e,a){if(!t)return{top:"50%",left:"50%"};const r=20,o={};switch(e){case"top":o.bottom=`${window.innerHeight-t.top+r}px`,o.left=`${t.left+t.width/2}px`;break;case"bottom":o.top=`${t.bottom+r}px`,o.left=`${t.left+t.width/2}px`;break;case"left":if(o.top=`${t.top+t.height/2}px`,a===dt.chatSwitch||a===dt.chatOverview){const s=document.querySelector('[data-role="sidebar"]')?.getBoundingClientRect(),l=s?s.left:t.left;o.right=`${window.innerWidth-l+r}px`}else o.right=`${window.innerWidth-t.left+r}px`;break;case"right":o.top=`${t.top+t.height/2}px`,o.left=`${t.right+r}px`;break;default:o.top="50%",o.left="50%";break}return o}function bh(t){if(!t.active)return"";const e=vn[t.currentStep];if(!e)return"";const a=document.querySelector(e.targetSelector);if(a){document.querySelectorAll(".tutorial-target-active").forEach(f=>{f!==a&&f.classList.remove("tutorial-target-active")}),a.classList.add("tutorial-target-active");const u=a.closest(".custom-select-container");if(u){u.classList.add("tutorial-target-active");const f=u.querySelector(".custom-select-info-panel");f&&f.classList.add("tutorial-target-active")}const h=document.querySelector(".custom-select-info-panel-shared");h&&h.classList.add("tutorial-target-active")}const r=yh(),o=to(e.targetSelector,e.id,!0),i=to(e.targetSelector,e.id,!1),s=vh(i,e.position,e.id);let l="";e.position==="center"?l="transform: translate(-50%, -50%);":e.position==="top"||e.position==="bottom"?l="transform: translateX(-50%);":(e.position==="left"||e.position==="right")&&(l="transform: translateY(-50%);");const c=Object.entries(s).map(([u,h])=>`${u}: ${h};`).join(" ");let d="";if(o){const h=o.top-5,f=o.left-5,p=o.bottom+5,w=o.right+5;d=`clip-path: polygon(
            0% 0%, 
            0% 100%, 
            ${f}px 100%, 
            ${f}px ${h}px, 
            ${w}px ${h}px, 
            ${w}px ${p}px, 
            ${f}px ${p}px, 
            ${f}px 100%, 
            100% 100%, 
            100% 0%
        );`}return`
        <div class="tutorial-backdrop" style="${d}"></div>
        ${o?`<div class="tutorial-spotlight" style="
                    top: ${o.top}px;
                    left: ${o.left}px;
                    width: ${o.width}px;
                    height: ${o.height}px;
                "></div>`:""}
        <div class="tutorial-box" data-role="tutorial-box" style="${c} ${l}">
            <div class="tutorial-header">
                <div class="tutorial-progress">Step ${r.current} of ${r.total}</div>
                <button class="tutorial-close" data-action="close-tutorial" aria-label="Close tutorial">×</button>
            </div>
            <h3 class="tutorial-title">${e.title}</h3>
            <p class="tutorial-description">${e.description}</p>
            <div class="tutorial-actions">
                        <button class="tutorial-btn tutorial-btn-primary" data-action="tutorial-continue">Continue →</button>
                    </div>
        </div>
    `}function xh(){return ue.completed?"":`
        <button class="tutorial-start-btn" data-action="start-tutorial" aria-label="Start tutorial">
            ?
        </button>
    `}function ri(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:{r:0,g:0,b:0}}const wh=t=>t-273.15,Sh=t=>(t-273.15)*(9/5)+32,Mh=t=>t*1e3,$h=t=>t*3.6,kh=t=>t*2.237,Dh=t=>t/1e3,_e=t=>t;function ne(t){switch(t){case"tas":case"tasmin":case"tasmax":return[{label:"Kelvin (K)",unit:"K",convert:_e},{label:"Celsius (°C)",unit:"°C",convert:wh},{label:"Fahrenheit (°F)",unit:"°F",convert:Sh}];case"pr":return[{label:"g m⁻² s⁻¹",unit:"g m⁻² s⁻¹",convert:Mh},{label:"kg m⁻² s⁻¹",unit:"kg m⁻² s⁻¹",convert:_e}];case"rsds":case"rlds":return[{label:"W/m²",unit:"W/m²",convert:_e},{label:"kW/m²",unit:"kW/m²",convert:Dh}];case"sfcWind":return[{label:"m/s",unit:"m/s",convert:_e},{label:"km/h",unit:"km/h",convert:$h},{label:"mph",unit:"mph",convert:kh}];case"hurs":return[{label:"Percent (%)",unit:"%",convert:_e}];default:return[{label:"Default",unit:"",convert:_e}]}}function Se(t){return ne(t)[0]}function cn(t,e,a,r){const i=ne(e).find(s=>s.label===a);return i?r?.isDifference&&["tas","tasmin","tasmax"].includes(e)?a.includes("Celsius")?t:a.includes("Fahrenheit")?t*(9/5):t:i.convert(t):t}function oi(t,e){return ne(t).find(o=>o.label===e)?.unit||""}function ii(t,e,a,r,o){const s=ne(a).find(l=>l.label===r);return s?o?.isDifference&&["tas","tasmin","tasmax"].includes(a)?r.startsWith("Celsius")?{min:t,max:e}:r.startsWith("Fahrenheit")?{min:t*1.8,max:e*1.8}:{min:t,max:e}:{min:s.convert(t),max:s.convert(e)}:{min:t,max:e}}let te=null,dn=[];function gr(t,e,a,r){const o=r.map(ri);for(let i=0;i<a;i++){const l=(1-i/(a-1))*(o.length-1),c=Math.floor(l),d=Math.min(c+1,o.length-1),u=l-c,h=o[c],f=o[d],p=Math.round(h.r+(f.r-h.r)*u),w=Math.round(h.g+(f.g-h.g)*u),L=Math.round(h.b+(f.b-h.b)*u);t.fillStyle=`rgb(${p}, ${w}, ${L})`,t.fillRect(0,i,e,1)}}function Th(t,e,a,r,o,i){const s=r?.variable_metadata[t],l=s?.name||t;let c=e,d=a,u=s?.unit||"";if(o){const p=ii(e,a,t,o,{isDifference:i});c=p.min,d=p.max,u=oi(t,o)}const h=(d-c)/4,f=[d,d-h,d-2*h,d-3*h,c];return`
      <div class="map-legend">
        <div class="legend-title">${l}</div>
        <div class="legend-container">
        <canvas id="legend-gradient-canvas" width="20" height="200" style="width: 20px; height: 200px; border-radius: 4px;"></canvas>
          <div class="legend-labels">
            ${f.map(p=>`<span>${p.toFixed(2)} ${u}</span>`).join("")}
          </div>
        </div>
      </div>
    `}function An(t,e){const a=document.getElementById(t);if(!a){console.warn("Legend canvas not found");return}te=a,dn=e;const r=a.getContext("2d");if(!r)return;const o=a.width,i=a.height;gr(r,o,i,e)}function Lh(t,e,a){if(!te||dn.length===0)return;const r=te.getContext("2d");if(!r)return;const o=te.width,i=te.height;gr(r,o,i,dn);const s=(t-e)/(a-e),l=Math.round(i*(1-s));r.strokeStyle="rgba(255, 255, 255, 0.95)",r.lineWidth=2,r.shadowColor="rgba(0, 0, 0, 0.8)",r.shadowBlur=4,r.beginPath(),r.moveTo(0,l),r.lineTo(o,l),r.stroke(),r.shadowBlur=0}function Eh(){if(!te||dn.length===0)return;const t=te.getContext("2d");if(!t)return;const e=te.width,a=te.height;gr(t,e,a,dn)}const bn="http://localhost:8000";class Dt extends Error{statusCode;details;constructor(e,a,r){super(e),this.name="DataClientError",this.statusCode=a,this.details=r}}function ee(t){return{Historical:"historical",SSP245:"ssp245",SSP585:"ssp585"}[t]||t.toLowerCase()}function Ch(t){return t===1?"low":t===2?"medium":"high"}function _h(t,e,a="float32"){const r=atob(t),o=new Uint8Array(r.length);for(let i=0;i<r.length;i++)o[i]=r.charCodeAt(i);if(a.includes("float32"))return new Float32Array(o.buffer);if(a.includes("float64"))return new Float64Array(o.buffer);throw new Error(`Unsupported dtype: ${a}`)}function Ph(t,e){const a=t.flat(),r=new Float32Array(a.length);for(let o=0;o<a.length;o++)r[o]=a[o];return r}async function It(t,e){const r=`${bn}/data`;try{const o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...t,scenario:t.scenario?ee(t.scenario):void 0,data_format:t.data_format||"base64"})});if(!o.ok){const i=await o.json().catch(()=>({detail:o.statusText}));throw new Dt(i.detail||`HTTP ${o.status}: ${o.statusText}`,o.status,i)}return await o.json()}catch(o){throw o instanceof Dt?o:new Dt(`Failed to fetch data: ${o instanceof Error?o.message:String(o)}`,void 0,o)}}async function yr(t){const a=`${bn}/metadata`;try{const r=await fetch(a,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Dt(`HTTP ${r.status}: ${r.statusText}`,r.status);return await r.json()}catch(r){throw r instanceof Dt?r:new Dt(`Failed to fetch metadata: ${r instanceof Error?r.message:String(r)}`)}}function At(t){return t.data?t.data instanceof Float32Array||t.data instanceof Float64Array?t.data:t.data_encoding==="none"?null:t.data_encoding==="base64"&&typeof t.data=="string"?_h(t.data,t.shape,t.dtype):t.data_encoding==="list"&&Array.isArray(t.data)?Ph(t.data,t.shape):null:null}function yt(t){return{variable:t.variable,time:t.date,model:t.model,scenario:t.scenario,resolution:Ch(t.resolution),data_format:t.dataFormat||"base64"}}async function Ha(t,e){const r=`${bn}/pixel-data`;try{const o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...t,scenario:t.scenario?ee(t.scenario):void 0,resolution:t.resolution||"medium",step_days:t.step_days||1})});if(!o.ok){const i=await o.json().catch(()=>({detail:o.statusText}));throw new Dt(i.detail||`HTTP ${o.status}: ${o.statusText}`,o.status,i)}return await o.json()}catch(o){throw o instanceof Dt?o:new Dt(`Failed to fetch pixel data: ${o instanceof Error?o.message:String(o)}`,void 0,o)}}async function Wa(t,e){const r=`${bn}/aggregate-on-demand`;try{const o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...t,scenario:t.scenario?ee(t.scenario):void 0,resolution:t.resolution||"medium",step_days:t.step_days||1})});if(!o.ok){const i=await o.json().catch(()=>({detail:o.statusText}));throw new Dt(i.detail||`HTTP ${o.status}: ${o.statusText}`,o.status,i)}return await o.json()}catch(o){throw o instanceof Dt?o:new Dt(`Failed to fetch aggregate data: ${o instanceof Error?o.message:String(o)}`,void 0,o)}}async function Ih(t){const a=`${bn}/health`;try{return(await fetch(a,{method:"GET",signal:AbortSignal.timeout(5e3)})).ok}catch{return!1}}let Ze=null,si=0,li=1,Rn="",Nn="",ci=!1;function di(){return Ze||(Ze=document.createElement("div"),Ze.className="map-tooltip",document.body.appendChild(Ze)),Ze}function Ah(t,e,a,r,o,i,s){const l=di();let c=o,d=i;Nn&&Rn&&(c=cn(o,Rn,Nn,{isDifference:s??ci}),d=oi(Rn,Nn)||i),l.textContent=`Lat: ${a.toFixed(2)}, Lon: ${r.toFixed(2)}, Value: ${c.toFixed(2)} ${d}`,l.style.display="block",l.style.left=`${t+10}px`,l.style.top=`${e+10}px`,Lh(c,si,li)}function nn(){const t=di();t.style.display="none",Eh()}function Rh(t,e,a,r,o){si=t,li=e,a!==void 0&&(Rn=a),r!==void 0&&(Nn=r),o!==void 0&&(ci=o)}let tt=ha,an=null,ut=null,ui=null,hi=!1,na=null,fi,pi,rn=!1,Ya=null,Xa=null;function mi(){return tt.k}function Nh(t){const e=t.getContext("2d");if(!e)return null;const a=t.getBoundingClientRect();return t.width=a.width*window.devicePixelRatio,t.height=a.height*window.devicePixelRatio,e.scale(window.devicePixelRatio,window.devicePixelRatio),{ctx:e,rect:a,viewWidth:a.width,viewHeight:a.height}}function Fh(t,e,a,r){const o=t*a+a/2,i=o>180?o-360:o,s=90-(e*r+r/2);return[i,s]}function Bh(t,e,a,r,o){if(t<0||t>=a||e<0||e>=r)return null;const s=(r-1-e)*a+t,l=o[s];return isFinite(l)?l:null}function Ea(t){rn?t.style.cursor="crosshair":t.style.cursor="auto"}function eo(t,e,a){if(!ut)return null;const r=t.getBoundingClientRect(),o=e-r.left,i=a-r.top;let s=(o-tt.x)/tt.k;const l=(i-tt.y)/tt.k,c=ut.width,d=ut.height;if(l<0||l>d)return null;let u=s;u=u%c,u<0&&(u+=c),u<0&&(u=0),u>=c&&(u=c*(1-Number.EPSILON));const h=u/c*360-180,f=90-l/d*150,p=Math.max(-180,Math.min(180,h)),w=Math.max(-90,Math.min(90,f));return!Number.isFinite(p)||!Number.isFinite(w)?null:{lat:w,lon:p}}function Uh(t,e){rn=t,Ya=t?e??null:null}function Fn(t,e,a){if(!ut)return null;const r=ut.width,o=ut.height;let i=e;for(;i>180;)i-=360;for(;i<-180;)i+=360;const s=(i+180)/360*r,l=(90-a)/150*o,c=s*tt.k+tt.x,d=l*tt.k+tt.y,u=t.getBoundingClientRect(),h=r*tt.k,f=u.width/2;let p=c,w=Math.abs(c-f);for(let L=-h;L<=h;L+=h){const $=c+L,x=Math.abs($-f);x<w&&(w=x,p=$)}return d<-o*tt.k||d>u.height+o*tt.k?null:{x:p,y:d}}function Oh(t,e,a,r,o,i){Uh(i?.drawMode??!1,{onClick:i?.onDrawClick,onMove:i?.onDrawMove}),Xa=i?.onTransform??null,Ea(t);const s=Gt(t);an=rh().scaleExtent([.8,10]).filter(l=>rn?!1:!l.ctrlKey&&!l.button).on("zoom",l=>{tt=l.transform,(ut||e)&&no(t),Xa?.()}).on("start",()=>{t.style.cursor="grabbing",nn()}).on("end",()=>{Ea(t)}),s.call(an),s.call(an.transform,tt),s.on("click.draw",l=>{const c=eo(t,l.clientX,l.clientY);if(c){if(rn){Ya?.onClick?.(c);return}i?.onMapClick?.(c)}}),s.on("pointermove.tooltip",l=>{if(rn){const c=eo(t,l.clientX,l.clientY);c&&Ya?.onMove?.(c),nn();return}if(l.buttons===0&&ui&&na&&ut){const[c,d]=se(l,t);qh(l.clientX,l.clientY,c,d,a,fi,pi,hi)}}),s.on("pointerleave",()=>{nn()}),Ea(t)}function no(t){if(!ut)return;const e=t.getContext("2d");if(!e)return;const a=t.getBoundingClientRect();e.clearRect(0,0,a.width,a.height),e.save(),e.translate(tt.x,tt.y),e.scale(tt.k,tt.k),e.imageSmoothingEnabled=!1;const r=ut.width,o=-tt.x/tt.k,i=(a.width-tt.x)/tt.k,s=Math.floor(o/r)-1,l=Math.ceil(i/r)+1;for(let c=s;c<=l;c++)e.drawImage(ut,c*r,0);e.restore()}function Bn(t,e,a,r,o,i,s,l,c,d,u){if(!e)return;const h=At(t);if(!h){console.warn("No data to render");return}const f=Nh(e);if(!f)return;const{ctx:p,rect:w,viewWidth:L,viewHeight:$}=f,[x,v]=t.shape;p.clearRect(0,0,w.width,w.height),p.save();const T=!!t?.metadata?.comparison||typeof t.model=="string"&&t.model.includes(" minus ");ui=t,fi=s,pi=l,hi=T;const C=new Array($).fill(null).map(()=>new Float32Array(L).fill(NaN));let k=o,S=i;if(s&&l){const U=ii(o,i,s,l,{isDifference:T});k=U.min,S=U.max}Rh(k,S,s,l,T);const H=(a.find(U=>U.name===r)||a[0]).colors.map(ri);function W(U,X){const K=(U+180)/360*L,Z=(90-X)/150*$;return[K,Z]}const q=document.createElement("canvas");q.width=L,q.height=$;const j=q.getContext("2d");if(!j)return;const O=j.createImageData(L,$),y=O.data,B=Math.max(L/v,$/x),_=Math.ceil(B/2),m=360/v,b=150/x;for(let U=0;U<x;U++)for(let X=0;X<v;X++){const K=Bh(X,U,v,x,h);if(K===null)continue;const[Z,Q]=Fh(X,U,m,b),[N,Y]=W(Z,Q);let G=K;s&&l&&(G=cn(K,s,l,{isDifference:T}));let A=!1;if(c&&c.length>0)if(u&&d){A=!0;for(const lt of c){const Ft=!lt.lowerEdited,Ct=!lt.upperEdited,Tt=lt.statistic||"mean",Ee=d.get(Tt);if(!Ee)continue;const Ye=(x-1-U)*v+X,ga=Ee[Ye];if(!isFinite(ga)){A=!1;break}let ya=ga;if(s&&l&&(ya=cn(ga,s,l,{isDifference:Tt!=="mean"||T})),!Ft&&lt.lowerBound!==null&&ya<lt.lowerBound){A=!1;break}if(!Ct&&lt.upperBound!==null&&ya>lt.upperBound){A=!1;break}}}else for(const lt of c){const Ft=!lt.lowerEdited,Ct=!lt.upperEdited;let Tt=!0;if(!Ft&&lt.lowerBound!==null&&G<lt.lowerBound&&(Tt=!1),!Ct&&lt.upperBound!==null&&G>lt.upperBound&&(Tt=!1),Tt){A=!0;break}}else A=!0;let it,at,gt;if(!A&&c&&c.length>0)it=20,at=24,gt=32;else{const lt=S-k,Ft=lt===0?.5:Math.min(1,Math.max(0,(G-k)/lt)),Ct=Math.floor(Ft*(H.length-1)),Tt=H[Math.min(Ct,H.length-1)],Ee=H[Math.min(Ct+1,H.length-1)],Ye=Ft*(H.length-1)-Ct;it=Math.round(Tt.r+(Ee.r-Tt.r)*Ye),at=Math.round(Tt.g+(Ee.g-Tt.g)*Ye),gt=Math.round(Tt.b+(Ee.b-Tt.b)*Ye)}const xt=Math.max(0,Math.floor(N-_)),Ht=Math.min(L,Math.ceil(N+_)),xn=Math.max(0,Math.floor(Y-_)),Li=Math.min($,Math.ceil(Y+_));for(let lt=xn;lt<Li;lt++)for(let Ft=xt;Ft<Ht;Ft++){const Ct=(lt*L+Ft)*4;y[Ct]=it,y[Ct+1]=at,y[Ct+2]=gt,y[Ct+3]=255,C[lt][Ft]=K}}j.putImageData(O,0,0),ut=q,na=C,p.clearRect(0,0,w.width,w.height),p.save(),p.translate(tt.x,tt.y),p.scale(tt.k,tt.k),p.imageSmoothingEnabled=!1;const D=ut.width,R=-tt.x/tt.k,F=(w.width-tt.x)/tt.k,E=Math.floor(R/D)-1,I=Math.ceil(F/D)+1;for(let U=E;U<=I;U++)p.drawImage(ut,U*D,0);p.restore()}function gi(t,e,a,r=3.2,o=550){if(!ut||!an)return;const i=t.getBoundingClientRect(),s=ut.width,l=ut.height;let c=e;for(;c>180;)c-=360;for(;c<-180;)c+=360;const d=(c+180)/360*s,u=(90-a)/150*l,h=[d-s,d,d+s];let f=i.width/2-d*r,p=Math.abs(f-tt.x);for(const $ of h){const x=i.width/2-$*r,v=Math.abs(x-tt.x);v<p&&(p=v,f=x)}const w=i.height/2-u*r,L=ha.translate(f,w).scale(r);Gt(t).transition().duration(o).ease(ld).call(an.transform,L),tt=L,Xa?.()}function qh(t,e,a,r,o,i,s,l){if(!na||!ut)return;let c=(a-tt.x)/tt.k;const d=(r-tt.y)/tt.k,u=ut.width,h=ut.height;c=(c%u+u)%u;const f=Math.floor(c),p=Math.floor(d);if(f>=0&&f<u&&p>=0&&p<h){const w=na?.[p]?.[f]??0;if(isFinite(w)){const L=c/u*360-180,$=90-d/h*150;Ah(t,e,$,L,w,o,l)}else nn()}else nn()}function le(t){const e=new Date(t);return`${["January","February","March","April","May","June","July","August","September","October","November","December"][e.getMonth()]} ${e.getDate()}, ${e.getFullYear()}`}function Vh(t){const{date:e,timeRange:a,sidebarOpen:r,sidebarWidth:o,mode:i,compareMode:s,compareDateStart:l,compareDateEnd:c}=t;let d=0,u=0,h=0,f=0,p=0,w=0,L=0,$=100;if(a){const v=new Date(a.start),T=new Date(a.end),C=new Date(e);if(u=Math.floor((T.getTime()-v.getTime())/(1e3*60*60*24)),h=Math.floor((C.getTime()-v.getTime())/(1e3*60*60*24)),f=u>0?h/u*100:0,i==="Compare"&&s==="Dates"){const k=l?new Date(l):v,S=c?new Date(c):T;p=Math.max(0,Math.floor((k.getTime()-v.getTime())/(1e3*60*60*24))),w=Math.min(u,Math.floor((S.getTime()-v.getTime())/(1e3*60*60*24))),L=u>0?p/u*100:0,$=u>0?w/u*100:100}}const x=r?o+16:16;if(i==="Compare"&&s==="Dates"&&a){const v=le(l||a.start),T=le(c||a.end);return`
      <div class="time-slider-container" style="right: ${x}px">
        <div data-role="time-label" class="time-label">${v} – ${T}</div>
        <div class="time-slider-row dual-slider" data-role="dual-slider">
          <div
            class="dual-slider-track"
            aria-hidden="true"
          ></div>
          <div
            class="dual-slider-fill"
            data-role="dual-fill"
            style="--fill-start: ${L}%; --fill-end: ${$}%"
            aria-hidden="true"
          ></div>
          <input
            type="range"
            min="${d}"
            max="${u}"
            step="1"
            value="${p}"
            data-action="set-time-start"
            class="time-slider dual-thumb dual-thumb-start"
            aria-label="Start date"
          />
          <input
            type="range"
            min="${d}"
            max="${u}"
            step="1"
            value="${w}"
            data-action="set-time-end"
            class="time-slider dual-thumb dual-thumb-end"
            aria-label="End date"
          />
        </div>
      </div>
    `}return`
      <div class="time-slider-container" data-role="time-slider" style="right: ${x}px">
        <div data-role="time-label" class="time-label">${le(e)}</div>
        <div class="time-slider-row">
          <input
            type="range"
            min="${d}"
            max="${u}"
            step="1"
            value="${h}"
            data-action="set-time"
            class="time-slider"
            style="--slider-fill: ${f}%"
          />
        </div>
      </div>
    `}let Pe=null,ja=null;function zh(t){const{root:e,getTimeRange:a,onDateChange:r,getMode:o,getCompareMode:i,getCompareDates:s,onDateRangeChange:l}=t;ja=e.querySelector('[data-role="time-label"]')?.parentElement??null;const c=()=>o?.()==="Compare"&&i?.()==="Dates";e.querySelectorAll('[data-action="set-time"]').forEach($=>$.addEventListener("input",()=>{if(c())return;const x=Number.parseInt($.value,10),v=a();if(!Number.isNaN(x)&&v){const T=new Date(v.start);T.setDate(T.getDate()+x);const C=T.toISOString().split("T")[0],k=e.querySelector('[data-role="time-label"]');k&&(k.textContent=le(C));const S=new Date(v.end),P=Math.floor((S.getTime()-new Date(v.start).getTime())/(1e3*60*60*24)),V=P>0?x/P*100:0;$.style.setProperty("--slider-fill",`${V}%`),Pe&&window.clearTimeout(Pe),Pe=window.setTimeout(()=>{r(C)},500)}}));const u=e.querySelectorAll('[data-action="set-time-start"]'),h=e.querySelectorAll('[data-action="set-time-end"]'),f=e.querySelector('[data-role="dual-fill"]'),p=($,x,v,T,C)=>{const k=e.querySelector('[data-role="time-label"]'),S=new Date(v.start),P=new Date(v.start);S.setDate(S.getDate()+$),P.setDate(P.getDate()+x);const V=S.toISOString().split("T")[0],H=P.toISOString().split("T")[0];k&&(k.textContent=`${le(V)} – ${le(H)}`);const W=new Date(v.end).getTime()-new Date(v.start).getTime(),q=Math.max(1,Math.floor(W/(1e3*60*60*24))),j=$/q*100,O=x/q*100;[f,T,C].forEach(B=>{B&&(B.style.setProperty("--fill-start",`${j}%`),B.style.setProperty("--fill-end",`${O}%`))})},w=($,x,v)=>{$.addEventListener("input",()=>{if(!c())return;const T=a();if(!T)return;const C=Math.floor((new Date(T.end).getTime()-new Date(T.start).getTime())/(1e3*60*60*24));let k=Number.parseInt(v?$.value:x.value,10),S=Number.parseInt(v?x.value:$.value,10);if(Number.isNaN(k)||Number.isNaN(S))return;k=Math.max(0,Math.min(k,C)),S=Math.max(0,Math.min(S,C)),v&&k>S?(S=k,x.value=String(S)):!v&&S<k&&(k=S,x.value=String(k)),p(k,S,T,v?$:x,v?x:$);const P=new Date(T.start);P.setDate(P.getDate()+k);const V=new Date(T.start);V.setDate(V.getDate()+S);const H=P.toISOString().split("T")[0],W=V.toISOString().split("T")[0];Pe&&window.clearTimeout(Pe),Pe=window.setTimeout(()=>{l?.(H,W)},300)})},L=$=>{const x=u[0],v=h[0];!x||!v||($==="start"?(x.style.zIndex="4",v.style.zIndex="3"):(x.style.zIndex="3",v.style.zIndex="4"))};if(u.length&&h.length){u.forEach((v,T)=>{const C=h[T]||h[0];w(v,C,!0),v.addEventListener("pointerdown",()=>L("start"))}),h.forEach((v,T)=>{const C=u[T]||u[0];w(v,C,!1),v.addEventListener("pointerdown",()=>L("end"))}),u.forEach(v=>v.addEventListener("focus",()=>L("start"))),h.forEach(v=>v.addEventListener("focus",()=>L("end")));const $=(v,T)=>{v.addEventListener("pointerdown",C=>{if(!c())return;const k=a();if(!k)return;const S=v.getBoundingClientRect(),P=Math.min(1,Math.max(0,(C.clientX-S.left)/S.width)),V=Math.max(1,Math.floor((new Date(k.end).getTime()-new Date(k.start).getTime())/(1e3*60*60*24))),H=Number.parseInt(v.value,10),q=(Number.isNaN(H)?0:Math.max(0,Math.min(H,V)))/V;Math.abs(P-q)*S.width>14&&(C.preventDefault(),C.stopPropagation(),L(v===T?"end":"start"))})};if($(u[0],h[0]),$(h[0],u[0]),c()){const v=a(),T=s?.();if(v&&T){const C=Math.max(0,Math.floor((new Date(T.start).getTime()-new Date(v.start).getTime())/864e5)),k=Math.max(0,Math.floor((new Date(T.end).getTime()-new Date(v.start).getTime())/(1e3*60*60*24))),S=u[0],P=h[0];S.value=String(C),P.value=String(Math.max(k,C)),p(C,Math.max(k,C),v,S,P)}}e.querySelectorAll(".dual-slider").forEach(v=>{v.addEventListener("pointermove",T=>{if(!c())return;const C=a();if(!C)return;const k=u[0],S=h[0];if(!k||!S)return;const P=v.getBoundingClientRect(),V=Math.min(1,Math.max(0,(T.clientX-P.left)/P.width)),H=Math.max(1,Math.floor((new Date(C.end).getTime()-new Date(C.start).getTime())/(1e3*60*60*24)));let W=Number.parseInt(k.value,10),q=Number.parseInt(S.value,10);Number.isNaN(W)&&(W=0),Number.isNaN(q)&&(q=H);const j=W/H,O=q/H,y=Math.abs(V-j)<=Math.abs(V-O);L(y?"start":"end")})})}}function Hh(t,e){if(ja){const a=t?e+16:16;ja.style.right=`${a}px`}}const Wh=!1;function yi(t,e){document.querySelectorAll("[data-role='chart-container']").forEach(r=>{r.style.transition="padding 220ms ease, padding-right 220ms ease, transform 220ms ease",r.style.paddingRight=`${t}px`,typeof e=="number"&&(r.style.transform=`scale(${e})`,r.style.transformOrigin="center center")})}function De(t){const e=t.toLowerCase();return e==="historical"?"Historical":e==="ssp245"?"SSP245":e==="ssp370"?"SSP370":e==="ssp585"?"SSP585":t}function Yh(t){const e=t.toLowerCase();return e==="viridis"?"Viridis":e==="magma"?"Magma":e==="cividis"?"Cividis":e==="thermal"?"Thermal":t}function J(t){return new Date(t)}function We(t){if(!t.length)return Nt("Historical");let e="1900-01-01",a="2100-12-31";return t.forEach((r,o)=>{const i=Nt(r);if(o===0){e=i.start,a=i.end;return}e=J(i.start)>J(e)?i.start:e,a=J(i.end)<J(a)?i.end:a}),{start:e,end:a}}function St(t,e){const a=J(t),r=J(e.start),o=J(e.end);return a<r?e.start:a>o?e.end:t}const bt=["Historical","SSP245","SSP370","SSP585"],ft=["ACCESS-CM2","CanESM5","CESM2","CMCC-CM2-SR5","EC-Earth3","GFDL-ESM4","INM-CM5-0","IPSL-CM6A-LR","MIROC6","MPI-ESM1-2-HR","MRI-ESM2-0"],Pt=["tas","pr","rsds","hurs","rlds","sfcWind","tasmin","tasmax"],Xh={SSP245:"A moderate scenario (2015-2100) that assumes we take active measures against climate change. This represents a realistic path where significant climate protection policies are implemented, leading to moderate warming by the end of the century.",SSP370:"A moderate-to-high scenario (2015-2100) representing a middle ground. This path assumes some climate action is taken, but not enough to prevent substantial warming. It falls between optimistic and pessimistic outcomes.",SSP585:"A pessimistic scenario (2015-2100) representing a worst-case path with minimal climate action. This shows what happens if we continue with current trends and take little to no measures against climate change, leading to severe warming.",Historical:"Historical climate simulation (1950-2014) based on past conditions. This represents simulated climate data for the historical period, used as a baseline to compare against future projections."},jh={tas:"Near-Surface Air Temperature",pr:"Precipitation",rsds:"Surface Downwelling Shortwave Radiation",hurs:"Near-Surface Relative Humidity",rlds:"Surface Downwelling Longwave Radiation",sfcWind:"Daily-Mean Near-Surface Wind Speed",tasmin:"Daily Minimum Near-Surface Air Temperature",tasmax:"Daily Maximum Near-Surface Air Temperature"},Kh={tas:"The air temperature near the Earth's surface, measured in Kelvin.",pr:"The amount of water that falls from the atmosphere to the surface, measured as mass per unit area per unit time.",rsds:"Incoming solar radiation reaching the Earth's surface, measured in Watts per square meter.",hurs:"The amount of moisture in the air relative to the maximum it can hold, expressed as a percentage.",rlds:"Incoming thermal radiation from the atmosphere, measured in Watts per square meter.",sfcWind:"The average wind speed near the surface over a day, measured in meters per second.",tasmin:"The lowest air temperature near the surface during a day, measured in Kelvin.",tasmax:"The highest air temperature near the surface during a day, measured in Kelvin."},Gh={"ACCESS-CM2":"Developed by Australia's research institutions. This model is part of the global CMIP6 ensemble, providing climate projections that contribute to our understanding of future climate patterns.",CanESM5:"The Canadian Earth System Model version 5, developed by Environment and Climate Change Canada. This model represents North American climate research and contributes valuable projections to the global climate science community.",CESM2:"The Community Earth System Model version 2, developed by the National Center for Atmospheric Research (NCAR) in the United States. One of the most widely used models in climate research, known for its comprehensive representation of Earth's climate system.","CMCC-CM2-SR5":"Developed by the Euro-Mediterranean Center on Climate Change (CMCC) in Italy. This model provides European perspectives on climate change and is particularly valuable for understanding Mediterranean and European climate patterns.","EC-Earth3":"A collaborative European climate model developed by multiple research institutions across Europe. This model combines expertise from various European countries to provide comprehensive climate projections.","GFDL-ESM4":"Developed by NOAA's Geophysical Fluid Dynamics Laboratory in the United States. This model is known for its advanced representation of ocean and atmosphere interactions, providing detailed climate projections.","INM-CM5-0":"Developed by the Institute of Numerical Mathematics in Russia. This model contributes a unique perspective from Russian climate research to the global ensemble of climate models.","IPSL-CM6A-LR":"Developed by the Institut Pierre-Simon Laplace in France. This model is part of a long-standing French climate modeling tradition and provides important contributions to understanding global climate dynamics.",MIROC6:"Developed by a Japanese research consortium. This model represents Asian climate research expertise and contributes valuable insights, particularly for understanding climate patterns in the Asia-Pacific region.","MPI-ESM1-2-HR":"Developed by the Max Planck Institute in Germany. This high-resolution model provides detailed climate projections and is known for its sophisticated representation of Earth's climate system.","MRI-ESM2-0":"Developed by Japan's Meteorological Research Institute. This model contributes Japanese climate research expertise to the global ensemble, providing valuable perspectives on climate change projections."},ct=[{name:"Viridis",colors:["#440154","#3b528b","#21908d","#5dc863","#fde725"]},{name:"Magma",colors:["#000004","#3b0f70","#8c2981","#de4968","#fe9f6d"]},{name:"Cividis",colors:["#00204c","#31456a","#6b6d7f","#a59c8f","#fdea9b"]},{name:"Thermal",colors:["#04142f","#155570","#1fa187","#f8c932","#f16623"]}],M={page:{position:"relative",minHeight:"100vh",color:"white",overflow:"hidden",fontFamily:"Inter, system-ui, sans-serif"},bgLayer1:{position:"absolute",inset:0,background:"linear-gradient(135deg, #05070f, #0b1326)"},bgLayer2:{position:"absolute",inset:0,background:"radial-gradient(circle at 20% 20%, rgba(56,189,248,0.12), transparent 32%), radial-gradient(circle at 80% 10%, rgba(139,92,246,0.15), transparent 30%), radial-gradient(circle at 50% 70%, rgba(34,197,94,0.08), transparent 28%)"},bgOverlay:{position:"absolute",inset:0,background:"#050505",opacity:.35},branding:{position:"fixed",top:16,left:16,display:"flex",alignItems:"center",gap:12,padding:"8px 0",background:"transparent",border:"none",borderRadius:0,zIndex:"9999",boxShadow:"none",backdropFilter:"none",pointerEvents:"auto"},brandIcon:{width:38,height:38,position:"relative",display:"grid",placeItems:"center",filter:"drop-shadow(0 8px 18px rgba(0, 0, 0, 0.42))",transition:"transform 160ms ease, filter 160ms ease","--iris-x":"0px","--iris-y":"0px","--pupil-x":"0px","--pupil-y":"0px","--blink-open":"1"},brandSvg:{width:"100%",height:"100%",display:"block"},brandOutline:{stroke:"white",strokeWidth:5,strokeLinecap:"round",strokeLinejoin:"round",fill:"none",opacity:.92},brandLids:{transform:"translate(60px, 40px) scaleY(var(--blink-open, 1)) translate(-60px, -40px)",transformOrigin:"60px 40px",transition:"none"},brandClipRect:{transform:"translate(60px, 40px) scaleY(var(--blink-open, 1)) translate(-60px, -40px)",transformOrigin:"60px 40px",transition:"none"},brandIrisGroup:{transform:"translate(var(--iris-x, 0px), var(--iris-y, 0px))",transition:"none",transformBox:"fill-box",transformOrigin:"center center"},brandIris:{stroke:"white",strokeWidth:5,fill:"rgba(255, 255, 255, 0.08)"},brandPupilGroup:{transform:"translate(var(--pupil-x, 0px), var(--pupil-y, 0px))",transition:"none",transformOrigin:"center center"},brandEyeContent:{clipPath:"url(#brand-eye-clip)"},brandPupil:{fill:"white"},brandHighlight:{fill:"white",opacity:.92},brandName:{fontSize:18,fontWeight:700,letterSpacing:.6,color:"white",textTransform:"none",textShadow:"0 8px 20px rgba(0, 0, 0, 0.45)"},field:{minWidth:0,display:"flex",flexDirection:"column",gap:4},fieldLabel:{fontSize:11,letterSpacing:.5,color:"var(--text-secondary)",textTransform:"uppercase"},mapArea:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:10,textAlign:"center",pointerEvents:"none",zIndex:1},mapSearchWrap:{position:"absolute",top:18,left:"50%",transform:"translateX(-50%)",width:"min(360px, 70vw)",pointerEvents:"auto",zIndex:12,transition:"transform 220ms ease, width 220ms ease"},mapSearchResults:{maxHeight:220,overflowY:"auto"},mapMarker:{position:"absolute",left:0,top:0,width:28,height:36,pointerEvents:"none",zIndex:11,transform:"translate(-9999px, -9999px)",opacity:0,transition:"opacity 160ms ease",filter:"drop-shadow(0 10px 18px rgba(0,0,0,0.45))"},mapInfoPanel:{position:"absolute",left:0,top:0,width:360,maxWidth:"min(360px, 80vw)",opacity:0,userSelect:"none",transform:"translate(-9999px, -9999px)",transition:"opacity 160ms ease",zIndex:12},mapInfoHeader:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:8},mapInfoTitleGroup:{display:"flex",flexDirection:"column",gap:2,flex:1,minWidth:0},mapInfoActions:{display:"flex",gap:6,alignItems:"center"},mapInfoActionBtn:{width:30,height:30,borderRadius:8,border:"none",background:"transparent",color:"var(--text-secondary)",display:"inline-flex",alignItems:"center",justifyContent:"center",cursor:"pointer",pointerEvents:"auto",transition:"all 120ms ease"},mapInfoExpandBtn:{position:"absolute",right:12,bottom:12},mapInfoSubtitle:{fontSize:11.5,color:"var(--text-secondary)",marginTop:2},mapInfoBody:{marginTop:10,display:"flex",flexDirection:"column",gap:10,paddingBottom:36},mapInfoLoadingRow:{display:"flex",alignItems:"center",gap:8,fontSize:11,color:"var(--text-secondary)"},mapInfoLoadingSpinner:{width:14,height:14,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.18)",borderTop:"2px solid #34d399",animation:"sv-spin 1s linear infinite",flexShrink:0},drawOverlay:{position:"absolute",inset:0,background:"rgba(5, 10, 20, 0.28)",backdropFilter:"blur(1px)",pointerEvents:"none",zIndex:8},drawOverlayCanvas:{position:"absolute",inset:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:9},drawPrompt:{position:"absolute",top:16,left:"50%",transform:"translateX(-50%)",padding:"10px 14px",borderRadius:12,background:"rgba(15, 23, 42, 0.92)",border:"1px solid var(--border-medium)",boxShadow:"var(--shadow-elevated)",fontWeight:800,fontSize:13,color:"var(--text-primary)",pointerEvents:"none",zIndex:10,textAlign:"center"},drawPromptSub:{marginTop:4,fontSize:12,fontWeight:600,color:"var(--text-secondary)"},loadingIndicator:{position:"absolute",left:18,bottom:80,display:"flex",alignItems:"center",gap:12,padding:0,pointerEvents:"auto",zIndex:20,minWidth:160},loadingSpinner:{width:18,height:18,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.18)",borderTop:"2px solid #34d399",animation:"sv-spin 1s linear infinite",flexShrink:0},loadingTextGroup:{display:"flex",flexDirection:"column",gap:4,alignItems:"flex-start",minWidth:0},loadingText:{fontSize:12.5,fontWeight:700,color:"var(--text-primary)",letterSpacing:.3},loadingSubtext:{fontSize:11.5,color:"var(--text-secondary)",letterSpacing:.2},loadingBar:{position:"relative",width:120,height:6,borderRadius:999,background:"rgba(255, 255, 255, 0.08)",overflow:"hidden"},loadingBarFill:{position:"absolute",inset:0,borderRadius:999,background:"linear-gradient(90deg, rgba(52, 211, 153, 0.9), rgba(125, 211, 252, 0.9))",transition:"width 140ms ease",width:"0%"},compareInfoWrap:{position:"fixed",right:24,bottom:88,display:"flex",alignItems:"center",pointerEvents:"auto",zIndex:1e4},compareInfoButton:{padding:0,background:"transparent",border:"none",color:"var(--text-primary)",fontWeight:700,fontSize:13,letterSpacing:.2,cursor:"pointer",textDecoration:"underline"},infoModalOverlay:{position:"fixed",inset:0,background:"transparent",backdropFilter:"none",zIndex:200,display:"flex",alignItems:"center",justifyContent:"center",padding:16},infoModal:{width:"min(480px, 92vw)",background:"rgba(12, 16, 24, 0.98)",border:"1px solid var(--border-default)",borderRadius:14,boxShadow:"var(--shadow-elevated)",color:"var(--text-primary)",padding:20,position:"relative",maxWidth:"520px"},infoModalHeader:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,marginBottom:12},infoModalTitle:{fontSize:16,fontWeight:900,letterSpacing:.2,background:"var(--gradient-accent)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",color:"transparent"},infoModalClose:{width:32,height:32,borderRadius:8,border:"none",background:"transparent",color:"var(--text-secondary)",cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",fontWeight:700},infoModalBody:{fontSize:14,lineHeight:1.6,color:"var(--text-primary)",display:"block",textAlign:"left",whiteSpace:"normal",wordBreak:"break-word"},infoModalFooter:{marginTop:18,display:"flex",justifyContent:"center"},infoModalConfirm:{padding:"10px 16px",borderRadius:10,border:"1px solid var(--accent-border)",background:"var(--gradient-primary)",color:"white",fontWeight:700,cursor:"pointer",boxShadow:"var(--shadow-combined)"},canvasToggle:{position:"fixed",top:14,display:"flex",alignItems:"center",gap:8,pointerEvents:"auto",zIndex:100,transition:"right 0.25s ease"},canvasSwitch:{position:"relative",display:"grid",gridTemplateColumns:"1fr 1fr",gap:0,padding:3,borderRadius:11,background:"var(--dark-bg)",border:"var(--border-base)",boxShadow:"var(--shadow-elevated)",zIndex:101},canvasIndicator:{position:"absolute",top:3,bottom:3,left:3,width:"calc(50% - 3px)",borderRadius:9,background:"var(--gradient-indicator)",boxShadow:"var(--shadow-canvas), var(--shadow-inset)",transition:"transform 180ms ease",zIndex:0,pointerEvents:"none"},canvasBtn:{width:40,height:40,borderRadius:9,border:"1px solid transparent",background:"var(--bg-transparent)",color:"var(--text-secondary)",cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",transition:"color 120ms ease",position:"relative",zIndex:1},canvasBtnActive:{color:"white"},mapTitle:{fontSize:18,fontWeight:600},mapSubtitle:{fontSize:14,color:"var(--text-secondary)"},modeSwitch:{position:"relative",display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:4,padding:2,borderRadius:10,border:"1px solid var(--border-subtle)",background:"var(--bg-subtle)",boxShadow:"none"},modeIndicator:{position:"absolute",top:2,bottom:2,left:2,width:"calc(33.333% - 2px)",borderRadius:8,background:"var(--gradient-mode-indicator)",boxShadow:"var(--shadow-combined)",transition:"transform 200ms ease",zIndex:0},modeBtn:{flex:1,padding:"8px 0",borderRadius:8,border:"none",color:"var(--text-secondary)",cursor:"pointer",transition:"all 0.15s ease",background:"var(--bg-transparent)",textAlign:"center",fontSize:12.5,fontWeight:700,letterSpacing:.2,outline:"none",boxShadow:"none",position:"relative",zIndex:1},modeBtnActive:{background:"var(--gradient-primary)",border:"none",color:"white",boxShadow:"var(--shadow-combined)"},tabSwitch:{position:"absolute",left:32,right:12,bottom:-8,display:"flex",gap:10,padding:"0 8px",alignItems:"flex-end",pointerEvents:"auto",zIndex:0},tabBtn:{borderRadius:"14px 14px 0 0",padding:"12px 18px",background:"var(--bg-strong)",color:"var(--text-secondary)",fontWeight:700,fontSize:13,letterSpacing:.35,cursor:"pointer",transition:"all 0.18s ease",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.06), 0 8px 18px rgba(0,0,0,0.32)",borderTop:"var(--border-base)",borderRight:"var(--border-base)",borderLeft:"var(--border-base)",borderBottom:"none",transform:"translateY(4px)"},tabBtnActive:{background:"var(--gradient-tab-active)",color:"white",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.12), 0 12px 26px rgba(0,0,0,0.42)",borderTop:"var(--border-active)",borderRight:"var(--border-active)",borderLeft:"var(--border-active)",borderBottom:"none",transform:"translateY(-4px)",zIndex:1},modeViewport:{overflow:"hidden",width:"100%",position:"relative",flex:1,minHeight:0,height:0},modeTrack:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",width:"300%",height:"100%",transition:"transform 220ms ease"},modePane:{width:"100%",height:"100%",paddingRight:4,overflowY:"auto",overflowX:"hidden",scrollbarGutter:"stable",minHeight:0,maxHeight:"100%"},sectionTitle:{fontSize:13,fontWeight:700,color:"var(--text-primary)",letterSpacing:.3,textTransform:"uppercase"},paramGrid:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},range:{width:"100%",background:"var(--bg-transparent)",appearance:"none",WebkitAppearance:"none",height:10,outline:"none",padding:0,margin:0},resolutionRow:{display:"flex",alignItems:"center",gap:12},resolutionValue:{fontSize:12.5,color:"var(--text-secondary)",minWidth:60,textAlign:"right"},chartPanel:{width:"min(1200px, 100%)",background:"transparent",border:"none",borderRadius:0,padding:0,boxShadow:"none",backdropFilter:"none"},chartHeader:{textAlign:"center",marginBottom:12},chartTitle:{fontSize:18,fontWeight:800,color:"var(--text-primary)"},chartPlotWrapper:{width:"100%",minHeight:360,background:"transparent",border:"none",borderRadius:0,padding:0,position:"relative"},chartEmpty:{textAlign:"center",color:"var(--text-secondary)",padding:"40px 16px",lineHeight:1.6},chartError:{color:"#fca5a5",background:"rgba(248,113,113,0.08)",border:"1px solid rgba(248,113,113,0.35)",borderRadius:12,padding:14,fontSize:13,lineHeight:1.5},chipRow:{display:"flex",flexWrap:"wrap",gap:8},chip:{padding:"8px 10px",borderRadius:12,border:"1px solid var(--border-medium)",background:"rgba(255,255,255,0.04)",color:"var(--text-primary)",cursor:"pointer",fontSize:12.5,fontWeight:700,letterSpacing:.2,transition:"all 140ms ease"},chipActive:{borderColor:"rgba(167,139,250,0.65)",background:"rgba(167,139,250,0.16)",boxShadow:"0 0 0 1px rgba(167,139,250,0.35)"},chartLegend:{display:"flex",gap:12,flexWrap:"wrap",alignItems:"center",marginTop:10,fontSize:12,color:"var(--text-secondary)"}},n={mode:"Explore",panelTab:"Manual",sidebarOpen:!0,canvasView:"map",scenario:bt[0],model:ft[0],variable:Pt[0],date:"2000-01-01",palette:ct[0].name,resolution:2,selectedUnit:Se(Pt[0]).label,chartMode:"single",chartDate:"2026-01-16",chartRangeStart:"2015-01-01",chartRangeEnd:"2099-01-01",chartVariable:Pt[0],chartUnit:Se(Pt[0]).label,chartScenarios:["SSP245","SSP370","SSP585"],chartModels:[...ft],chartDropdown:{scenariosOpen:!1,modelsOpen:!1},chartLoadingProgress:{total:0,done:0},chartSamples:[],chartBoxes:null,chartRangeSeries:null,chartLoading:!1,chartError:null,chartLocation:"World",chartLocationName:null,chartLocationSearchQuery:"",chartLocationSearchResults:[],chartLocationSearchLoading:!1,chartLocationSearchError:null,mapLocationSearchQuery:"",mapLocationSearchResults:[],mapLocationSearchLoading:!1,mapLocationSearchError:null,mapLocationSearchSelection:null,mapLocationSearchFocused:!1,mapLocationSearchCursor:{start:0,end:0},mapMarker:null,mapInfoSamples:[],mapInfoBoxes:null,mapInfoLoading:!1,mapInfoError:null,mapInfoLoadingProgress:{total:0,done:0},mapInfoOpen:!1,mapPolygon:null,chartPolygon:null,chartPoint:null,drawState:{active:!1,points:[],previewPoint:null},pointSelectActive:!1,chatInput:"",chatMessages:[],chatIsLoading:!1,compareMode:"Scenarios",availableModels:[],compareScenarioA:"SSP245",compareScenarioB:"SSP585",compareModelA:ft[0],compareModelB:ft[1]??ft[0],compareDateStart:"1962-06-28",compareDateEnd:"2007-06-28",masks:[],ensembleScenarios:["SSP245","SSP370","SSP585"],ensembleModels:[...ft],ensembleDropdown:{scenariosOpen:!1,modelsOpen:!1},ensembleStatistic:"mean",ensembleDate:"2000-01-01",ensembleVariable:Pt[0],ensembleUnit:Se(Pt[0]).label,ensembleStatistics:null,isLoading:!1,loadingProgress:0,dataError:null,currentData:null,apiAvailable:null,dataMin:null,dataMax:null,dataMean:null,timeRange:null,metaData:void 0,compareInfoOpen:!1};let vt=null,Ue=null,nt=null,Dn=null,fe=null,ie=null,pe=null,Yt=null,be=null,Tn=0,xe=null,Ln=0,ge=0,ce=null;const ao=500;function Qh(t){return t.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}function g(t){return Object.entries(t).filter(([,e])=>e!=null).map(([e,a])=>{const r=e.startsWith("--")?e:Qh(e),o=typeof a=="number"?`${a}px`:String(a);return`${r}:${o}`}).join(";")}function pt(...t){return t.reduce((e,a)=>a?{...e,...a}:e,{})}function Mt(t){return t.replace(/[&<>"']/g,e=>{switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return e}})}function de(t){const e=new Date(t);return Number.isNaN(e.getTime())?t:e.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}function fa(t,e){return e?.variable_metadata?.[t]?.name||e?.variable_metadata?.[t]?.description||t}function Zh(t){const e=fa(t.variable,t.metaData),a=t.selectedUnit||t.metaData?.variable_metadata?.[t.variable]?.unit||"",r=a?`${a}`:"the dataset's native units";switch(t.compareMode){case"Dates":{const o=de(t.compareDateStart),i=de(t.compareDateEnd);return{title:"Comparing two dates",paragraphs:[`We are comparing ${e} on ${o} versus ${i} under the ${t.scenario} scenario using the ${t.model} model.`,`Values on the map represent ${i} minus ${o} in ${r}. A value of X means ${e} was X ${a||""} higher on ${i} than on ${o} (negative values mean it was lower).`]}}case"Models":{const o=de(t.date);return{title:"Comparing two models",paragraphs:[`We are comparing ${e} between ${t.compareModelB} and ${t.compareModelA} on ${o} within the ${t.scenario} scenario.`,`Each value shows ${t.compareModelB} minus ${t.compareModelA} in ${r}. Positive numbers mean ${e} is higher in ${t.compareModelB}; negative means it is higher in ${t.compareModelA}.`]}}default:{const o=de(t.date),i=t.compareScenarioA,s=t.compareScenarioB;return{title:"Comparing two scenarios",paragraphs:[`We are comparing ${e} for ${s} versus ${i} on ${o} using the ${t.model} model.`,`Values show ${s} minus ${i} in ${r}. A value of X means ${e} is X ${a||""} higher under ${s} than under ${i}; negative values mean it is lower.`]}}}}function Jh(t){if(t.mode!=="Compare"||t.canvasView!=="map")return"";const e=Zh(t),a=e.paragraphs.map((c,d)=>{const h=d===e.paragraphs.length-1?"0":"0 0 12px 0",f=c.replace(/(\bX\b|ΔX)/g,'<span style="color: var(--accent-purple);">$1</span>');return`<p style="display:block; margin:${h}; line-height:1.6; white-space: normal; word-break: break-word;">${f}</p>`}).join(""),r=t.sidebarOpen?$t+24:24,o=t.mode==="Compare"&&t.compareMode==="Dates"?120:88,i=pt(M.infoModalOverlay,{left:"0",right:"0",width:"100%",justifyContent:"center",paddingLeft:0}),s=pt(M.infoModal,{alignSelf:"center",marginLeft:"auto",marginRight:"auto"}),l=t.compareInfoOpen?`
      <div data-role="compare-info-overlay" class="compare-info-overlay" style="${g(i)}">
        <div style="${g(s)}" role="dialog" aria-modal="true" aria-label="${e.title}">
          <div style="${g(M.infoModalHeader)}">
            <div style="${g(M.infoModalTitle)}">${e.title}</div>
            <button type="button" data-action="close-compare-info" style="${g(M.infoModalClose)}" aria-label="Close info dialog">✕</button>
          </div>
          <div style="${g(M.infoModalBody)}">
            ${a}
          </div>
          <div style="${g(M.infoModalFooter)}">
            <button type="button" data-action="close-compare-info" style="${g(M.infoModalConfirm)}">Got it</button>
          </div>
        </div>
      </div>
    `:"";return`
      <div data-role="compare-info-trigger" style="${g(pt(M.compareInfoWrap,{right:r,bottom:o}))}">
        <button type="button" data-action="open-compare-info" style="${g(M.compareInfoButton)}">
          What am I seeing?
        </button>
      </div>
      ${l}
    `}async function tf(){try{const t=await Ih();n.apiAvailable=t}catch{n.apiAvailable=!1}}function ef(t){if(t==="Historical")return"2000-01-01";const e=new Date,a=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return a<2015?"2015-01-01":a>2100?"2100-12-31":`${a}-${r}-${o}`}function Nt(t){return t==="Historical"?{start:"1950-01-01",end:"2014-12-31"}:{start:"2015-01-01",end:"2099-12-31"}}function Re(t,e){const a=Nt(e),r=new Date(t),o=new Date(a.start),i=new Date(a.end);return r<o?a.start:r>i?a.end:t}function nf(t){let e=1/0,a=-1/0;for(let r=0;r<t.length;r++){const o=t[r];isFinite(o)&&(e=Math.min(e,o),a=Math.max(a,o))}if(!isFinite(e)||!isFinite(a))throw new Error("No valid numeric values returned from dataset.");return{min:e,max:a}}function Un(t,e){let a=0,r=0;for(let o=0;o<t.length;o++){const i=t[o];if(!isFinite(i))continue;const s=e==="hurs"?Math.min(i,100):i;a+=s,r+=1}if(!r)throw new Error("No valid numeric values returned from dataset.");return a/r}function vi(t,e){let a=!1;for(let r=0,o=e.length-1;r<e.length;o=r++){const i=e[r].lon,s=e[r].lat,l=e[o].lon,c=e[o].lat;s>t.lat!=c>t.lat&&t.lon<(l-i)*(t.lat-s)/(c-s+Number.EPSILON)+i&&(a=!a)}return a}function On(t,e,a,r){const[o,i]=a,s=360/i,l=150/o;let c=0,d=0;for(let u=0;u<o;u++){const h=90-u*l-l/2;for(let f=0;f<i;f++){const p=f*s+s/2,w=p>180?p-360:p,L=(o-1-u)*i+f,$=t[L];if(!isFinite($))continue;const x=e==="hurs"?Math.min($,100):$;vi({lat:h,lon:w},r)&&(c+=x,d+=1)}}if(!d)throw new Error("The selected region does not contain valid data points.");return c/d}function af(t,e,a=.75){const r=t.lat-e.lat,o=t.lon-e.lon;return Math.hypot(r,o)<=a}function qn(t,e,a,r){const[o,i]=a,l=((r.lon+360)%360+360)%360/360*i-.5,c=(90-r.lat)/150*o-.5,d=($,x,v)=>Math.min(v,Math.max(x,$)),u=d(Math.round(l),0,i-1),h=d(Math.round(c),0,o-1),f=($,x)=>(o-1-x)*i+$,p=($,x)=>{const v=($%i+i)%i,T=d(x,0,o-1),C=f(v,T),k=t[C];return Number.isFinite(k)?k:null};let w=p(u,h);if(w===null){let x=null;for(let v=1;v<=3&&x===null;v++)for(let T=-v;T<=v;T++){for(let C=-v;C<=v;C++){if(Math.abs(C)!==v&&Math.abs(T)!==v)continue;const k=p(u+C,h+T);if(k!==null){x=k;break}}if(x!==null)break}w=x}if(w===null)throw new Error("No valid data at the selected point.");const L=e==="hurs"?Math.min(w,100):w;if(!Number.isFinite(L))throw new Error(`Invalid value at point: ${L}`);return L}function he(){return{active:!1,points:[],previewPoint:null}}function bi(t){Ue||(Ue=e=>{e.key==="Enter"&&n.drawState.active&&(e.preventDefault(),t())},window.addEventListener("keydown",Ue))}function pa(){Ue&&(window.removeEventListener("keydown",Ue),Ue=null)}function aa(t){const e=n.drawState.active||n.pointSelectActive,a=n.mode==="Ensemble"?n.ensembleVariable:n.variable,r=n.mode==="Ensemble"?n.ensembleUnit:n.selectedUnit,o=n.metaData?.variable_metadata[a]?.unit||"";Oh(t,n.currentData,o,a,r,{drawMode:e,onDrawClick:n.pointSelectActive?xf:bf,onDrawMove:n.drawState.active?vf:void 0,onMapClick:gf,onTransform:()=>{ma(),ro(),ra()}}),ro(),ra()}function ma(){if(!nt)return;const t=nt.querySelector("#draw-overlay-canvas"),e=vt||nt.querySelector("#map-canvas");if(!t||!e)return;const a=e.getBoundingClientRect(),r=window.devicePixelRatio||1;t.width=a.width*r,t.height=a.height*r,t.style.width=`${a.width}px`,t.style.height=`${a.height}px`;const o=t.getContext("2d");if(!o)return;o.save(),o.scale(r,r),o.clearRect(0,0,a.width,a.height);let i=[];if(n.drawState.active){const l=[...n.drawState.points];i=n.drawState.previewPoint?[...l,n.drawState.previewPoint]:l}else if(n.mapPolygon&&n.mapPolygon.length>=3)i=n.mapPolygon;else{o.restore();return}const s=[];if(i.forEach(l=>{const c=Fn(e,l.lon,l.lat);c&&s.push(c)}),!s.length){o.restore();return}o.lineWidth=2,o.strokeStyle="#34d399",o.fillStyle="rgba(52,211,153,0.18)",o.beginPath(),o.moveTo(s[0].x,s[0].y);for(let l=1;l<s.length;l++)o.lineTo(s[l].x,s[l].y);s.length>2&&(o.closePath(),o.fill()),o.stroke(),n.drawState.active&&s.forEach(({x:l,y:c},d)=>{o.beginPath(),o.fillStyle=d===0?"#10b981":"#34d399",o.arc(l,c,4,0,Math.PI*2),o.fill(),o.strokeStyle="#0f172a",o.lineWidth=1,o.stroke()}),o.restore()}function rf(){return n.drawState.active||n.mapPolygon!==null&&n.mapPolygon.length>=3?`
      <canvas
        id="draw-overlay-canvas"
        style="${g(M.drawOverlayCanvas)}"
      ></canvas>
    `:""}function ro(){if(!nt)return;const t=nt.querySelector("#point-overlay-marker"),e=vt||nt.querySelector("#map-canvas");!t||!e||!n.pointSelectActive||(t.style.left="0px",t.style.top="0px",t.style.right="0px",t.style.bottom="0px",t.style.width="100%",t.style.height="100%")}function ra(){if(!nt)return;const t=nt.querySelector("#map-location-marker"),e=nt.querySelector("#map-info-panel"),a=vt||nt.querySelector("#map-canvas");if(!a)return;const r=n.mapPolygon!==null&&n.mapPolygon.length>=3;if(t)if(!n.mapMarker)t.style.opacity="0",t.style.transform="translate(-9999px, -9999px)",t.title="Selected location";else{const o=Fn(a,n.mapMarker.lon,n.mapMarker.lat);t.title=n.mapMarker.name?n.mapMarker.name:`Pixel ${n.mapMarker.pixel.x}, ${n.mapMarker.pixel.y}`,o?(t.style.opacity="1",t.style.transform=`translate(${o.x}px, ${o.y}px) translate(-50%, -100%)`):(t.style.opacity="0",t.style.transform="translate(-9999px, -9999px)")}if(e&&n.mapInfoOpen){const o=a.getBoundingClientRect(),i=e.offsetWidth||360,s=e.offsetHeight||240,l=12;let c,d;if(n.mapMarker){const f=Fn(a,n.mapMarker.lon,n.mapMarker.lat);if(!f){e.style.opacity="0",e.style.transform="translate(-9999px, -9999px)",e.style.pointerEvents="none",e.style.visibility="hidden";return}c=f.x-i-24,c<l&&(c=f.x+24),d=f.y-s/2}else if(r&&n.mapPolygon){let f=n.mapPolygon[0];for(const w of n.mapPolygon)w.lon<f.lon&&(f=w);const p=Fn(a,f.lon,f.lat);p?(c=p.x-i-24,c<l&&(c=p.x+24),d=p.y-s/2):(c=o.width-i-l-24,d=o.height/2-s/2)}else{e.style.opacity="0",e.style.transform="translate(-9999px, -9999px)",e.style.pointerEvents="none",e.style.visibility="hidden";return}c=Math.max(l,Math.min(c,o.width-i-l)),d=Math.max(l,Math.min(d,o.height-s-l));const u=e.style.left,h=e.style.top;(!u||u==="0px"||!h||h==="0px")&&(e.style.left=`${c}px`,e.style.top=`${d}px`),e.style.opacity="1",e.style.transform="translate(0, 0)",e.style.pointerEvents="none",e.style.visibility="visible"}else e&&!n.mapInfoOpen&&(e.style.opacity="0",e.style.transform="translate(-9999px, -9999px)",e.style.pointerEvents="none",e.style.visibility="hidden")}function xi(){if(!nt)return;const t=nt.querySelector('[data-role="map-location-search"]');if(!t)return;const e=n.sidebarOpen?-$t/2:0;t.style.transform=`translateX(calc(-50% + ${e}px))`}function of(){return n.pointSelectActive?`
      <div style="${g(M.drawOverlay)}"></div>
      <div
        id="point-overlay-marker"
        style="${g({position:"absolute",inset:0,pointerEvents:"none",zIndex:9})}"
      ></div>
      <div style="${g(M.drawPrompt)}">
        <div>Click a point to sample</div>
        <div style="${g(M.drawPromptSub)}">
          The chart will load data for this single location
        </div>
      </div>
    `:""}function sf(){const t=n.mapMarker,e=t?.name?Mt(t.name):t?`Pixel ${t.pixel.x}, ${t.pixel.y}`:"Selected location";return`
      <div
        id="map-location-marker"
        style="${g(M.mapMarker)}"
        aria-hidden="true"
        title="${e}"
      >
        <svg
          viewBox="0 0 28 36"
          width="28"
          height="36"
          aria-hidden="true"
          focusable="false"
        >
          <defs>
            <linearGradient id="map-marker-gradient" x1="0" x2="1">
              <stop offset="0%" stop-color="var(--accent-blue)" />
              <stop offset="100%" stop-color="var(--accent-purple)" />
            </linearGradient>
          </defs>
          <path
            d="M14 2C8.48 2 4 6.48 4 12c0 7.72 8.4 19.3 9.1 20.25.5.68 1.3.68 1.8 0C15.6 31.3 24 19.72 24 12 24 6.48 19.52 2 14 2Z"
            fill="url(#map-marker-gradient)"
          />
          <circle cx="14" cy="12" r="4.5" fill="rgba(9, 14, 28, 0.9)" />
          <circle cx="14" cy="12" r="3" fill="white" opacity="0.9" />
        </svg>
      </div>
    `}function wi(){const t=n.mapMarker!==null,e=n.mapPolygon!==null&&n.mapPolygon.length>=3;if(!t&&!e)return`<div style="${g(M.chartEmpty)}">Click a location or draw a region to load boxplots.</div>`;if(n.mapInfoLoading){const a=n.mapInfoLoadingProgress.total>0?`${n.mapInfoLoadingProgress.done}/${n.mapInfoLoadingProgress.total} datasets loaded`:"Preparing datasets",r=n.mapInfoBoxes&&n.mapInfoBoxes.length?fo(n.mapInfoBoxes,n.selectedUnit):`<div style="${g(M.chartEmpty)}">Loading boxplots...</div>`;return`
          <div style="${g(M.mapInfoLoadingRow)}">
            <div style="${g(M.mapInfoLoadingSpinner)}"></div>
            <div>${a}</div>
          </div>
          ${r}
        `}return n.mapInfoError?`<div style="${g(M.chartError)}">${Mt(n.mapInfoError)}</div>`:!n.mapInfoBoxes||!n.mapInfoBoxes.length?`<div style="${g(M.chartEmpty)}">Click a location to load boxplots.</div>`:fo(n.mapInfoBoxes,n.selectedUnit)}function lf(){if(!n.mapInfoOpen)return"";const t=n.mapMarker,a=n.mapPolygon!==null&&n.mapPolygon.length>=3?"Drawn Region":t?.name?t.name:t?`Pixel ${t.pixel.x}, ${t.pixel.y}`:"Selected location",r=fa(n.variable,n.metaData),o=`${a} · ${r}`,i=`${de(n.date)} · ${n.selectedUnit}`;return`
      <div id="map-info-panel" class="custom-select-info-panel map-info-panel" style="${g(M.mapInfoPanel)}">
        <div style="${g(M.mapInfoHeader)}">
          <div style="${g(M.mapInfoTitleGroup)}">
            <div class="custom-select-info-panel-title">${Mt(o)}</div>
            <div style="${g(M.mapInfoSubtitle)}">${Mt(i)}</div>
          </div>
          <div style="${g(M.mapInfoActions)}">
            <button
              type="button"
              data-action="close-map-info"
              aria-label="Close info"
              style="${g(M.mapInfoActionBtn)}"
              onmouseover="this.style.color='var(--text-primary)';this.style.background='rgba(15, 23, 42, 0.85)';"
              onmouseout="this.style.color='var(--text-secondary)';this.style.background='transparent';"
            >
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M6 6l12 12M18 6l-12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </button>
          </div>
        </div>
        <div class="map-info-body" style="${g(M.mapInfoBody)}">
          ${wi()}
        </div>
        <button
          type="button"
          data-action="open-map-info-chart"
          aria-label="Open chart view"
          style="${g({...M.mapInfoActionBtn,...M.mapInfoExpandBtn})}"
          onmouseover="this.style.color='var(--text-primary)';this.style.background='rgba(15, 23, 42, 0.85)';"
          onmouseout="this.style.color='var(--text-secondary)';this.style.background='transparent';"
        >
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M9 5H5v4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M15 5h4v4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M9 19H5v-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M15 19h4v-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    `}function oo(){n.chartLocation="Draw",n.chartPolygon=null,n.chartLocationName=null,n.chartLocationSearchResults=[],n.chartLocationSearchQuery="",n.chartLocationSearchError=null,n.chartLocationSearchLoading=!1,n.chartError=null,n.pointSelectActive=!1,n.drawState={active:!0,points:[],previewPoint:null},n.canvasView="map",bi(Di),z(),Lt()}function oa(){n.drawState=he(),pa()}function cf(){n.canvasView==="map"&&(n.mapPolygon=null,n.mapMarker=null,n.mapInfoOpen=!1,n.drawState={active:!0,points:[],previewPoint:null},n.pointSelectActive=!1,bi(Si),z())}function df(){n.drawState=he(),pa()}function Si(){if(n.drawState.active){if(n.drawState.points.length<3){n.mapInfoError="Draw at least three points to define a region.",n.mapInfoOpen=!0,z();return}n.mapPolygon=n.drawState.points,n.mapMarker=null,n.drawState=he(),pa(),n.mapInfoError=null,n.mapInfoOpen=!0,z(),Ne()}}function io(){n.chartLocation="Point",n.chartPolygon=null,n.chartPoint=null,n.chartLocationName=null,n.chartLocationSearchResults=[],n.chartLocationSearchQuery="",n.chartLocationSearchError=null,n.chartLocationSearchLoading=!1,n.chartError=null,n.drawState=he(),n.chartUnit=Se(n.chartVariable).label,n.pointSelectActive=!0,n.canvasView="map",z(),Lt()}function ia(){n.pointSelectActive=!1}async function Mi(t){const e=t.trim();if(!e)return[];const a=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(e)}&limit=5&addressdetails=1`,r=await fetch(a,{headers:{Accept:"application/json","User-Agent":"climate-visualization-app/1.0"}});if(!r.ok)throw new Error("Location search failed. Please try again.");return(await r.json()).map(i=>({displayName:i.display_name,lat:Number(i.lat),lon:Number(i.lon)})).filter(i=>Number.isFinite(i.lat)&&Number.isFinite(i.lon))}async function uf(t,e){const a=`https://nominatim.openstreetmap.org/reverse?format=json&lat=${t}&lon=${e}&addressdetails=1`,r=await fetch(a,{headers:{Accept:"application/json","User-Agent":"climate-visualization-app/1.0"}});return r.ok&&(await r.json()).display_name||null}function so(t){be!==null&&(window.clearTimeout(be),be=null),n.chartLocation="Search",n.chartPoint={lat:t.lat,lon:t.lon},n.chartLocationName=t.displayName,n.chartLocationSearchError=null,n.chartLocationSearchResults=[],n.chartLocationSearchLoading=!1,n.chartLocationSearchQuery="",n.chartError=null,n.chartPolygon=null,n.pointSelectActive=!1,n.drawState=he(),n.canvasView="chart",oa(),ia(),z(),qt()}async function hf(t){const e=t.trim(),a=++Tn;if(n.chartLocation="Search",n.chartLocationSearchQuery=t,n.chartLocationSearchError=null,n.chartLocationSearchResults=[],n.chartLocationName=null,n.chartPoint=null,n.chartError=null,n.chartPolygon=null,n.pointSelectActive=!1,n.drawState=he(),n.canvasView="chart",oa(),ia(),!e){n.chartLocationSearchLoading=!1,n.chartLocationSearchResults=[],n.chartLocationSearchError=null,z();return}n.chartLocationSearchLoading=!0,z();try{const r=await Mi(e);if(a!==Tn)return;n.chartLocationSearchResults=r,r.length||(n.chartLocationSearchError="No places found for that query.")}catch(r){if(a!==Tn)return;n.chartLocationSearchError=r instanceof Error?r.message:"Search failed."}finally{if(a!==Tn)return;n.chartLocationSearchLoading=!1,z()}}function $i(t,e,a){const[r,o]=pn(t,e);n.mapMarker={lat:t,lon:e,name:a,pixel:{x:r,y:o}}}function ff(t){if(xe!==null&&(window.clearTimeout(xe),xe=null),n.mapLocationSearchError=null,n.mapLocationSearchResults=[],n.mapLocationSearchLoading=!1,n.mapLocationSearchQuery=t.displayName,n.mapLocationSearchSelection=t.displayName,n.mapLocationSearchFocused=!0,$i(t.lat,t.lon,t.displayName),z(),vt){const e=Math.max(mi(),3.2);gi(vt,t.lon,t.lat,e),ra()}ki()}async function pf(t){const e=t.trim(),a=++Ln;if(n.mapLocationSearchQuery=t,n.mapLocationSearchError=null,n.mapLocationSearchResults=[],n.mapLocationSearchSelection=null,!e){n.mapLocationSearchLoading=!1,n.mapLocationSearchResults=[],n.mapLocationSearchError=null,z();return}n.mapLocationSearchLoading=!0,z();try{const r=await Mi(e);if(a!==Ln)return;n.mapLocationSearchResults=r,r.length||(n.mapLocationSearchError="No places found for that query.")}catch(r){if(a!==Ln)return;n.mapLocationSearchError=r instanceof Error?r.message:"Search failed."}finally{if(a!==Ln)return;n.mapLocationSearchLoading=!1,z()}}function mf(t){if(n.mapMarker&&(n.mapMarker.name=t),!nt)return;const e=nt.querySelector("#map-location-marker");if(e&&n.mapMarker&&(e.title=t),n.mapInfoOpen&&n.mapMarker){const a=nt.querySelector(".custom-select-info-panel-title");if(a){const r=fa(n.variable,n.metaData),i=`${t} · ${r}`;a.textContent=i}}}async function gf(t){if(n.canvasView==="map"&&!(n.drawState.active||n.pointSelectActive)){if(n.mapPolygon=null,$i(t.lat,t.lon,null),vt){const e=Math.max(mi(),3.2);gi(vt,t.lon,t.lat,e),ra()}ki();try{const e=await uf(t.lat,t.lon);e&&mf(e)}catch(e){console.error("Failed to fetch reverse geocode:",e)}}}function ki(t=700){ce!==null&&(window.clearTimeout(ce),ce=null);const e=n.mapInfoOpen;if(n.mapInfoOpen=!1,e&&nt){const a=nt.querySelector("#map-info-panel");a&&(a.style.opacity="0",a.style.transform="translate(-9999px, -9999px)",a.style.pointerEvents="none",a.style.visibility="hidden")}ce=window.setTimeout(()=>{ce=null;const a=n.mapMarker!==null,r=n.mapPolygon!==null&&n.mapPolygon.length>=3;!a&&!r||(n.mapInfoOpen=!0,z(),Ne())},t)}function yf(){ce!==null&&(window.clearTimeout(ce),ce=null),ge+=1,n.mapInfoOpen=!1,n.mapInfoLoading=!1,z()}function Ca(t){n.mapInfoSamples=t;try{n.mapInfoBoxes=un(t,n.variable,n.selectedUnit)}catch{return}if(!nt){z();return}const e=nt.querySelector("#map-info-panel");if(e){const a=e.querySelector(".map-info-body");if(a){a.innerHTML=wi();return}}z()}async function Ne(){if(n.canvasView!=="map")return;const t=n.mapMarker!==null,e=n.mapPolygon!==null&&n.mapPolygon.length>=3;if(!t&&!e){n.mapInfoLoading=!1,n.mapInfoError=null,n.mapInfoSamples=[],n.mapInfoBoxes=null,n.mapInfoLoadingProgress={total:0,done:0},n.mapInfoOpen=!1,z();return}const a=++ge;n.mapInfoLoading=!0,n.mapInfoError=null,n.mapInfoSamples=[],n.mapInfoBoxes=null,n.mapInfoLoadingProgress={total:0,done:0},z();try{const r=n.metaData??await yr();n.metaData||(n.metaData=r);const o=r?.scenarios?.length?Array.from(new Set(r.scenarios.map(De))):bt,i=o.filter(u=>Ka(n.date,Nt(u))),s=i.length?i.includes("Historical")?["Historical"]:i:o,l=r?.models?.length?r.models:ft;if(!o.length||!l.length){n.mapInfoError="Select at least one scenario and one model.",n.mapInfoLoading=!1,n.mapInfoLoadingProgress={total:0,done:0},z();return}const c=s.length*l.length;n.mapInfoLoadingProgress={total:c,done:0},z();const d=[];for(const u of s){if(a!==ge)return;const h=St(n.date,Nt(u));if(t&&n.mapMarker){const[f,p]=pn(n.mapMarker.lat,n.mapMarker.lon),w=l.map($=>Ha({variable:n.variable,model:$,x0:f,x1:f,y0:p,y1:p,start_date:h,end_date:h,scenario:ee(u),resolution:"low",step_days:1}).catch(x=>{console.warn(`Pixel API failed for model ${$}, falling back:`,x);const v=yt({variable:n.variable,date:h,model:$,scenario:u,resolution:1});return It(v).then(T=>{const C=At(T);if(!C)throw new Error("No data returned for map info request.");const k=qn(C,n.variable,T.shape,{lat:n.mapMarker.lat,lon:n.mapMarker.lon});return{model:$,value:k,fallback:!0}})})),L=await Promise.allSettled(w);if(a!==ge)return;for(const $ of L)if($.status==="fulfilled"){const x=$.value;if(typeof x=="object"&&"fallback"in x&&x.fallback)d.push({scenario:u,model:x.model,rawValue:x.value,dateUsed:h});else{const v=x,T=v.values[0];if(T!==null&&isFinite(T)){const C=n.variable==="hurs"?Math.min(T,100):T;d.push({scenario:u,model:v.model,rawValue:C,dateUsed:h})}}}else console.warn("Failed to fetch pixel data for map info:",$.reason);n.mapInfoLoadingProgress={total:c,done:n.mapInfoLoadingProgress.done+l.length},Ca(d)}else if(e&&n.mapPolygon){const[f,p,w,L]=Ga(n.mapPolygon),$=Qa(n.mapPolygon,f,p,w,L);try{const x=await Wa({variable:n.variable,models:l,x0:f,x1:p,y0:w,y1:L,start_date:h,end_date:h,scenario:ee(u),resolution:"low",step_days:1,mask:$});for(const v of l){const T=x.models[v];if(T){const C=T.values[0];if(C!==null&&isFinite(C)){const k=n.variable==="hurs"?Math.min(C,100):C;d.push({scenario:u,model:v,rawValue:k,dateUsed:h})}}}n.mapInfoLoadingProgress={total:c,done:n.mapInfoLoadingProgress.done+l.length},Ca(d)}catch(x){console.warn(`Aggregate API failed for scenario ${u}, falling back to full map load:`,x);for(const v of l){if(a!==ge)return;const T=yt({variable:n.variable,date:h,model:v,scenario:u,resolution:1});try{const C=await It(T),k=At(C);if(k){const S=On(k,n.variable,C.shape,n.mapPolygon);d.push({scenario:u,model:v,rawValue:S,dateUsed:h})}}catch(C){console.warn(`Failed to load data for model ${v}:`,C)}n.mapInfoLoadingProgress={total:c,done:n.mapInfoLoadingProgress.done+1},Ca(d)}}}}if(a!==ge)return;n.mapInfoLoading=!1,z()}catch(r){if(a!==ge)return;n.mapInfoError=r instanceof Error?r.message:"Failed to load map chart data.",n.mapInfoLoading=!1,n.mapInfoLoadingProgress={total:0,done:0},z()}}function vf(t){n.drawState.active&&(n.drawState={...n.drawState,previewPoint:t},ma())}function bf(t){if(!n.drawState.active)return;const e=n.drawState.points;if(e.length>=3&&af(t,e[0])){n.canvasView==="chart"||n.chartLocation==="Draw"?Di():n.canvasView==="map"&&Si();return}n.drawState={...n.drawState,points:[...e,t],previewPoint:t},ma()}function xf(t){n.pointSelectActive&&(n.chartPoint=t,n.pointSelectActive=!1,n.chartError=null,n.canvasView="chart",z(),qt())}function Di(){if(n.drawState.active){if(n.drawState.points.length<3){n.chartError="Draw at least three points to define a region.",z();return}n.chartPolygon=n.drawState.points,n.drawState=he(),pa(),n.chartError=null,n.canvasView="chart",z(),qt()}}function Ti(t){const e=t.filter(s=>Number.isFinite(s)).sort((s,l)=>s-l);if(!e.length)throw new Error("No valid values available to build chart statistics.");const a=va(e,.25)??e[0],r=va(e,.5)??e[Math.floor(e.length/2)],o=va(e,.75)??e[e.length-1],i=Ui(e)??e[0];return{min:e[0],q1:a,median:r,q3:o,max:e[e.length-1],mean:i,count:e.length}}function un(t,e,a){const r=new Map;return t.forEach(o=>{const i=r.get(o.scenario)??[];i.push(o),r.set(o.scenario,i)}),Array.from(r.entries()).map(([o,i])=>{const s=i.map(c=>{const d=cn(c.rawValue,e,a);return{...c,value:d}}),l=Ti(s.map(c=>c.value));return{scenario:o,dateUsed:i[0]?.dateUsed??"",samples:s,stats:l}})}function wf(t,e,a=50){const r=J(t),o=J(e);if(Number.isNaN(r.getTime())||Number.isNaN(o.getTime())||a<=0)return[];let i=r,s=o;i>s&&([i,s]=[s,i]);const l=1440*60*1e3,d=Math.floor((s.getTime()-i.getTime())/l)+1,u=[];if(d<=a){for(let p=0;p<d;p++){const w=new Date(i.getTime()+p*l);u.push(w.toISOString().slice(0,10))}return u}const h=(s.getTime()-i.getTime())/(a-1),f=new Set;for(let p=0;p<a;p++){const w=new Date(i.getTime()+h*p);f.add(w.toISOString().slice(0,10))}return f.add(s.toISOString().slice(0,10)),Array.from(f).sort((p,w)=>J(p).getTime()-J(w).getTime())}function lo(t,e,a=50){const r=J(t),o=J(e);if(Number.isNaN(r.getTime())||Number.isNaN(o.getTime())||a<=0)return[];let i=r,s=o;i>s&&([i,s]=[s,i]);const l=1440*60*1e3,c=Math.floor((s.getTime()-i.getTime())/l),d=s.getFullYear()-i.getFullYear();if(c<=120)return wf(i.toISOString().slice(0,10),s.toISOString().slice(0,10),a);const u=i.getDate(),h=i.getMonth(),f=i.getFullYear(),p=s.getFullYear(),w=p-f+1,L=Math.min(a,w),$=new Set;if(L===1)$.add(f);else{const T=(w-1)/(L-1);for(let C=0;C<L;C++){const k=Math.round(f+T*C);$.add(Math.min(p,Math.max(f,k)))}}const x=[];return Array.from($).sort((T,C)=>T-C).forEach(T=>{const C=new Date(T,h+1,0).getDate(),k=Math.min(u,C),S=new Date(T,h,k);if(d>=20){if(S<i||S>s)return;x.push(S.toISOString().slice(0,10));return}let P=S;S<i&&(P=i),S>s&&(P=s),x.push(P.toISOString().slice(0,10))}),Array.from(new Set(x)).sort((T,C)=>J(T).getTime()-J(C).getTime())}function Sf(t,e){const a=J(t),r=J(e);if(Number.isNaN(a.getTime())||Number.isNaN(r.getTime()))return!1;const o=1440*60*1e3;return Math.abs(r.getTime()-a.getTime())/o/365.25>=20}function co(t,e){const a=J(e),r=J(t);return Number.isNaN(a.getTime())||Number.isNaN(r.getTime())?!1:r.getMonth()===a.getMonth()&&r.getDate()===a.getDate()}function Ka(t,e){const a=J(t),r=J(e.start),o=J(e.end);return Number.isNaN(a.getTime())||Number.isNaN(r.getTime())||Number.isNaN(o.getTime())?!1:a>=r&&a<=o}function uo(t,e,a,r=50){const o=J(t),i=J(e),s=J(a);if(Number.isNaN(o.getTime())||Number.isNaN(i.getTime())||Number.isNaN(s.getTime())||r<=0)return[];const l=o.getMonth(),c=o.getDate(),d=i.getFullYear(),u=s.getFullYear(),h=u-d+1,f=Math.min(r,h),p=new Set;if(f===1)p.add(d);else{const $=(h-1)/(f-1);for(let x=0;x<f;x++){const v=Math.round(d+$*x);p.add(Math.min(u,Math.max(d,v)))}}const w=[];return Array.from(p).sort(($,x)=>$-x).forEach($=>{const x=new Date($,l+1,0).getDate(),v=Math.min(c,x),T=new Date($,l,v);T<i||T>s||w.push(T.toISOString().slice(0,10))}),Array.from(new Set(w)).sort(($,x)=>J($).getTime()-J(x).getTime())}function Vn(t,e,a){const r=new Map;return t.forEach(o=>{const i=r.get(o.scenario)??[];i.push(o),r.set(o.scenario,i)}),Array.from(r.entries()).map(([o,i])=>{const s=new Map;i.forEach(c=>{const d=cn(c.rawValue,e,a),u=s.get(c.dateUsed)??[];u.push({...c,value:d}),s.set(c.dateUsed,u)});const l=Array.from(s.entries()).map(([c,d])=>({date:c,samples:d,stats:Ti(d.map(u=>u.value))})).sort((c,d)=>J(c.date).getTime()-J(d.date).getTime());return{scenario:o,points:l}})}function Mf(t,e,a,r){const o=At(t),i=At(e);if(!o||!i)throw new Error("Comparison data is missing numeric values.");if(o.length!==i.length||t.shape[0]!==e.shape[0]||t.shape[1]!==e.shape[1])throw new Error("Comparison datasets have mismatched shapes.");const s=new Float32Array(o.length);let l=1/0,c=-1/0,d=0,u=0;for(let p=0;p<o.length;p++){const w=o[p],L=i[p];if(!isFinite(w)||!isFinite(L)){s[p]=NaN;continue}const $=L-w;s[p]=$,isFinite($)&&(l=Math.min(l,$),c=Math.max(c,$),d+=$,u+=1)}if(!isFinite(l)||!isFinite(c))throw new Error("Comparison produced no valid numeric values.");const h=u>0?d/u:NaN;return{data:{...t,data:s,data_encoding:"none",dtype:"float32",model:`${r} minus ${a}`,time:`${e.time} minus ${t.time}`,scenario:`${e.scenario} minus ${t.scenario}`,metadata:{...t.metadata,comparison:{labelA:a,labelB:r}}},min:l,max:c,mean:h}}function st(t,e=!1){const a=Math.max(0,Math.min(100,Math.round(t)));a!==n.loadingProgress&&(n.loadingProgress=a,(n.isLoading||e)&&z())}async function $f(t,e){let a=yt({variable:n.variable,date:n.date,model:n.model,scenario:n.scenario,resolution:n.resolution}),r=a,o="",i="";switch(n.compareMode){case"Scenarios":{const c=n.compareScenarioA,d=n.compareScenarioB,u=Re(n.date,t);u!==n.date&&(n.date=u),a=yt({variable:n.variable,date:u,model:n.model,scenario:c,resolution:n.resolution}),r=yt({variable:n.variable,date:u,model:n.model,scenario:d,resolution:n.resolution}),o=c,i=d;break}case"Models":{const c=Re(n.date,t);c!==n.date&&(n.date=c),a=yt({variable:n.variable,date:c,model:n.compareModelA,scenario:n.scenario,resolution:n.resolution}),r=yt({variable:n.variable,date:c,model:n.compareModelB,scenario:n.scenario,resolution:n.resolution}),o=n.compareModelA,i=n.compareModelB;break}case"Dates":{const c=Re(n.compareDateStart,n.scenario),d=Re(n.compareDateEnd,n.scenario);c!==n.compareDateStart&&(n.compareDateStart=c),d!==n.compareDateEnd&&(n.compareDateEnd=d),a=yt({variable:n.variable,date:c,model:n.model,scenario:n.scenario,resolution:n.resolution}),r=yt({variable:n.variable,date:d,model:n.model,scenario:n.scenario,resolution:n.resolution}),o=c,i=d;break}}const s=await It(a);e?.(65);const l=await It(r);return e?.(85),Mf(s,l,o,i)}function Je(t,e){if(t.length===0)return NaN;if(t.length===1)return t[0];const a=e/100*(t.length-1),r=Math.floor(a),o=Math.ceil(a),i=a-r;return r===o?t[r]:t[r]*(1-i)+t[o]*i}async function kf(t){const e=n.ensembleScenarios.length>0?n.ensembleScenarios:bt.filter(P=>P!=="Historical"),a=n.ensembleModels.length>0?n.ensembleModels:ft;if(e.length===0||a.length===0)throw new Error("Please select at least one scenario and one model.");const r=We(e),o=St(n.ensembleDate,r);o!==n.ensembleDate&&(n.ensembleDate=o);const i=e.length*a.length,s=[],l=[];t?.(10);for(let P=0;P<e.length;P++){const V=e[P];for(let H=0;H<a.length;H++){const W=a[H],q=10+Math.round((P*a.length+H)/i*80);t?.(q);const j=yt({variable:n.ensembleVariable,date:o,model:W,scenario:V,resolution:n.resolution});try{const O=await It(j),y=At(O);y&&(s.push(y),l.push(O.shape))}catch(O){console.warn(`Failed to fetch data for ${V}/${W}:`,O)}}}if(s.length===0)throw new Error("No valid data could be loaded for the selected scenarios and models.");t?.(90);const c=l[0];for(let P=1;P<l.length;P++)if(l[P][0]!==c[0]||l[P][1]!==c[1])throw new Error("Ensemble datasets have mismatched shapes. Cannot compute statistics.");const d=s[0].length,u=new Float32Array(d);let h=1/0,f=-1/0,p=0,w=0;const L=new Set([n.ensembleStatistic]);if(n.masks&&n.masks.length>0)for(const P of n.masks)P.statistic&&L.add(P.statistic);const $=new Map;for(const P of L)$.set(P,new Float32Array(d));for(let P=0;P<d;P++){const V=[];for(const j of s){const O=j[P];if(isFinite(O)){const y=n.ensembleVariable==="hurs"?Math.min(O,100):O;V.push(y)}}if(V.length===0){u[P]=NaN;for(const j of L)$.get(j)[P]=NaN;continue}const H=L.has("median")||L.has("iqr")||L.has("percentile")?[...V].sort((j,O)=>j-O):null,W=L.has("mean")||L.has("std")?V.reduce((j,O)=>j+O,0)/V.length:0;for(const j of L){let O;if(j==="mean")O=W;else if(j==="median")O=Je(H,50);else if(j==="std"){const y=V.reduce((B,_)=>B+Math.pow(_-W,2),0)/V.length;O=Math.sqrt(y)}else if(j==="iqr"){const y=Je(H,75),B=Je(H,25);O=y-B}else if(j==="percentile"){const y=Je(H,90),B=Je(H,10);O=y-B}else j==="extremes"?O=Math.max(...V)-Math.min(...V):O=W;$.get(j)[P]=O}const q=$.get(n.ensembleStatistic)[P];u[P]=q,isFinite(q)&&(h=Math.min(h,q),f=Math.max(f,q),p+=q,w+=1)}if(n.ensembleStatistics=$,!isFinite(h)||!isFinite(f))throw new Error("Ensemble computation produced no valid numeric values.");const x=w>0?p/w:NaN,v=yt({variable:n.ensembleVariable,date:o,model:a[0],scenario:e[0],resolution:n.resolution}),T=await It(v),k=n.ensembleStatistic!=="mean"?{...T.metadata||{},comparison:{labelA:"Ensemble",labelB:n.ensembleStatistic==="std"?"Std Dev":n.ensembleStatistic==="median"?"Median":n.ensembleStatistic==="iqr"?"IQR":n.ensembleStatistic==="percentile"?"Percentile Band":"Extremes"}}:T.metadata,S={...T,data:u,data_encoding:"none",metadata:k};return t?.(100),{data:S,min:h,max:f,mean:x}}const hn=600,fn=1440;function pn(t,e){const r=((e+360)%360+360)%360/360*fn-.5,o=(90-t)/150*hn-.5,i=(c,d,u)=>Math.min(u,Math.max(d,c)),s=i(Math.round(r),0,fn-1),l=i(Math.round(o),0,hn-1);return[s,l]}function Ga(t){if(!t||t.length<3)throw new Error("Polygon must have at least 3 points");let e=1/0,a=-1/0,r=1/0,o=-1/0;for(const i of t){const[s,l]=pn(i.lat,i.lon);e=Math.min(e,s),a=Math.max(a,s),r=Math.min(r,l),o=Math.max(o,l)}return e=Math.max(0,Math.min(e,fn-1)),a=Math.max(0,Math.min(a,fn-1)),r=Math.max(0,Math.min(r,hn-1)),o=Math.max(0,Math.min(o,hn-1)),[e,a,r,o]}function Qa(t,e,a,r,o){const i=[],s=360/fn,l=150/hn;for(let c=r;c<=o;c++){const d=[],u=90-(c+.5)*l;for(let h=e;h<=a;h++){const f=(h+.5)*s,p=f>180?f-360:f,w=vi({lat:u,lon:p},t);d.push(w?1:0)}i.push(d)}return i}function _t(){const t=document.querySelector("[data-role='chart-container']");if(!t)return;const e=n.chartMode==="range";let a="";if(n.chartLoading)a=`
          <div style="position:absolute; inset:0; pointer-events:none;">
            <div style="${g(pt(M.loadingIndicator,{position:"absolute",left:18,bottom:-95,pointerEvents:"auto"}))}">
              <div style="${g(M.loadingSpinner)}"></div>
              <div style="${g(M.loadingTextGroup)}">
                <div style="${g(M.loadingText)}">Loading data</div>
                <div style="${g(M.loadingBar)}">
                  <div style="${g({...M.loadingBarFill,width:`${Math.max(0,Math.min(100,Math.round(n.loadingProgress||25)))}%`})}"></div>
                </div>
                <div style="${g(M.loadingSubtext)}">${n.chartLoadingProgress.total>0?`${n.chartLoadingProgress.done}/${n.chartLoadingProgress.total} datasets loaded`:"Preparing datasets"}</div>
              </div>
            </div>
            ${Ef()}
          </div>
          ${!e&&n.chartBoxes?ho(n.chartBoxes):e&&n.chartRangeSeries?po(n.chartRangeSeries):""}
        `;else if(n.chartError)a=`<div style="${g(M.chartError)}">${n.chartError}</div>`;else if(!e&&(!n.chartBoxes||!n.chartBoxes.length)||e&&(!n.chartRangeSeries||!n.chartRangeSeries.length)){const i=e?"Select scenarios, models, and a date range to see how the distribution evolves over time.":"Select scenarios and models to fetch the global box plot.";a=`<div style="${g(M.chartEmpty)}">${i}</div>`}else a=e?po(n.chartRangeSeries??[]):ho(n.chartBoxes??[]);const r=n.chartLocationName||(n.chartLocation==="Point"&&n.chartPoint?`Point (${n.chartPoint.lat.toFixed(2)}, ${n.chartPoint.lon.toFixed(2)})`:n.chartLocation==="Draw"?"Custom region":n.chartLocation==="World"?"Global":""),o=n.chartMode==="range"?`${de(n.chartRangeStart)} – ${de(n.chartRangeEnd)}`:de(n.chartDate);t.innerHTML=`
        <div style="${g(M.chartPanel)}">
          <div style="${g(M.chartHeader)}">
            <div style="${g(M.chartTitle)}">${fa(n.chartVariable,n.metaData)}</div>
            <div style="${g(M.mapSubtitle)}">${r?`${Mt(r)} · ${o}`:o}</div>
          </div>
          <div style="${g(pt(M.chartPlotWrapper,{display:"flex",alignItems:"center",justifyContent:"center"}))}">
            ${a}
          </div>
        </div>
      `,!e&&n.chartBoxes&&n.chartBoxes.length>0&&setTimeout(()=>{Df()},0)}function Df(){const t=document.querySelector("[data-role='chart-container'] svg");if(!t)return;const e=t.querySelector(".boxplot-hover-overlay");if(!e)return;const a=t.querySelectorAll(".boxplot-hover-area"),r=t.querySelectorAll(".model-indicator");a.length!==0&&(r.forEach(o=>{o.style.opacity="0"}),a.forEach(o=>{const i=o.closest(".boxplot-group");if(!i)return;const s=i.getAttribute("data-boxplot-idx");s!==null&&(o.addEventListener("mouseenter",()=>{e.style.opacity="1",e.style.pointerEvents="auto",r.forEach(l=>{const c=l;c.getAttribute("data-boxplot-idx")===s?c.style.opacity="1":c.style.opacity="0"})}),o.addEventListener("mouseleave",()=>{e.style.opacity="0",e.style.pointerEvents="none",r.forEach(l=>{l.style.opacity="0"})}))}))}async function qt(){if(n.canvasView!=="chart")return;const t=e=>{if(n.chartSamples=e,n.chartMode==="single")try{n.chartBoxes=un(e,n.chartVariable,n.chartUnit),n.chartRangeSeries=null}catch{return}else try{n.chartRangeSeries=Vn(e,n.chartVariable,n.chartUnit),n.chartBoxes=null}catch{return}_t()};if(n.chartLocation==="Draw"&&(!n.chartPolygon||n.chartPolygon.length<3)){n.chartError="Draw a region on the map to load chart data.",n.chartBoxes=null,n.chartRangeSeries=null,n.chartSamples=[],n.chartLoading=!1,n.chartLoadingProgress={total:0,done:0},_t();return}if(n.chartLocation==="Point"&&!n.chartPoint){n.chartError="Click a point on the map to load chart data.",n.chartBoxes=null,n.chartRangeSeries=null,n.chartSamples=[],n.chartLoading=!1,n.chartLoadingProgress={total:0,done:0},_t();return}if(n.chartLocation==="Search"&&!n.chartPoint){n.chartError=n.chartLocationSearchLoading?"Searching for a place...":"Search for a place and pick a result.",n.chartBoxes=null,n.chartRangeSeries=null,n.chartSamples=[],n.chartLoading=!1,n.chartLoadingProgress={total:0,done:0},_t();return}n.chartLoading=!0,n.chartError=null,st(5,!0),n.chartLoadingProgress={total:0,done:0},n.chartSamples=[],n.chartBoxes=null,n.chartRangeSeries=null,_t();try{const e=n.metaData??await yr();n.metaData||(n.metaData=e);const a=e?.scenarios?.length?Array.from(new Set(e.scenarios.map(De))):bt,r=e?.models?.length?e.models:ft,o=(n.chartScenarios.length?n.chartScenarios:a).filter(l=>a.includes(l)),i=(n.chartModels.length?n.chartModels:r).filter(l=>r.includes(l));if(!o.length||!i.length){n.chartError="Select at least one scenario and one model.",n.chartSamples=[],n.chartBoxes=null,n.chartRangeSeries=null,n.chartLoading=!1,n.chartLoadingProgress={total:0,done:0},_t();return}const s=We(o);if(n.chartMode==="single"){const l=St(n.chartDate,s);l!==n.chartDate&&(n.chartDate=l);const c=o.length*i.length;n.chartLoadingProgress={total:c,done:0},n.chartRangeSeries=null,_t();const d=[];if((n.chartLocation==="Point"||n.chartLocation==="Search")&&n.chartPoint?!0:n.chartLocation==="Draw"&&n.chartPolygon&&n.chartPolygon.length>=3){console.log("Using pixel-data API for efficient loading");for(const h of o){const f=St(n.chartDate,Nt(h));try{if((n.chartLocation==="Point"||n.chartLocation==="Search")&&n.chartPoint){const[p,w]=pn(n.chartPoint.lat,n.chartPoint.lon);console.log(`Fetching pixel data for point (${p}, ${w}) for ${i.length} models`);const L=i.map(x=>Ha({variable:n.chartVariable,model:x,x0:p,x1:p,y0:w,y1:w,start_date:f,end_date:f,scenario:ee(h),resolution:"low",step_days:1}).catch(v=>{if(console.warn(`Pixel API failed for model ${x}, falling back:`,v),!n.chartPoint)throw v;const T=yt({variable:n.chartVariable,date:f,model:x,scenario:h,resolution:1});return It(T).then(C=>{const k=At(C);if(!k)throw new Error("No data returned for chart request.");if(!n.chartPoint)throw new Error("No chart point selected");const S=qn(k,n.chartVariable,C.shape,n.chartPoint);return{model:x,value:S,fallback:!0}})})),$=await Promise.allSettled(L);for(const x of $)if(x.status==="fulfilled"){const v=x.value;if(typeof v=="object"&&"fallback"in v&&v.fallback)d.push({scenario:h,model:v.model,rawValue:v.value,dateUsed:f});else{const T=v,C=T.values[0];if(C!==null&&isFinite(C)){const k=n.chartVariable==="hurs"?Math.min(C,100):C;d.push({scenario:h,model:T.model,rawValue:k,dateUsed:f})}}}else console.warn("Failed to fetch pixel data:",x.reason);n.chartLoadingProgress={total:c,done:n.chartLoadingProgress.done+i.length},st(Math.min(98,Math.round(n.chartLoadingProgress.done/c*100))),t(d)}else if(n.chartLocation==="Draw"&&n.chartPolygon&&n.chartPolygon.length>=3){const[p,w,L,$]=Ga(n.chartPolygon),x=Qa(n.chartPolygon,p,w,L,$);console.log(`Fetching aggregate data for polygon window [${p},${w},${L},${$}] for ${i.length} models`);try{const v=await Wa({variable:n.chartVariable,models:i,x0:p,x1:w,y0:L,y1:$,start_date:f,end_date:f,scenario:ee(h),resolution:"low",step_days:1,mask:x});for(const T of i){const C=v.models[T];if(C){const k=C.values[0];if(k!==null&&isFinite(k)){const S=n.chartVariable==="hurs"?Math.min(k,100):k;d.push({scenario:h,model:T,rawValue:S,dateUsed:f})}}}n.chartLoadingProgress={total:c,done:n.chartLoadingProgress.done+i.length},st(Math.min(98,Math.round(n.chartLoadingProgress.done/c*100))),t(d)}catch(v){console.warn("Batch aggregate API failed, falling back to full map load:",v);for(const T of i){const C=yt({variable:n.chartVariable,date:f,model:T,scenario:h,resolution:1}),k=await It(C),S=At(k);if(!S)continue;const P=On(S,n.chartVariable,k.shape,n.chartPolygon);d.push({scenario:h,model:T,rawValue:P,dateUsed:f})}t(d)}}}catch(p){throw console.error("Error in pixel API path:",p),p}}}else for(const h of o){const f=St(n.chartDate,Nt(h));for(const p of i){const w=n.chartLoadingProgress.done;st(Math.min(95,Math.round((w+.1)/c*100)));const L=yt({variable:n.chartVariable,date:f,model:p,scenario:h,resolution:1}),$=await It(L),x=n.chartLoadingProgress.done+1;n.chartLoadingProgress={total:c,done:x},st(Math.min(98,Math.round(x/c*100))),t(d);const v=At($);if(!v)throw new Error("No data returned for chart request.");const T=Un(v,n.chartVariable);d.push({scenario:h,model:p,rawValue:T,dateUsed:f})}}n.chartSamples=d,n.chartBoxes=un(d,n.chartVariable,n.chartUnit),n.chartLoadingProgress={total:c,done:c},st(100)}else{let l=St(n.chartRangeStart,s),c=St(n.chartRangeEnd,s);J(l)>J(c)&&([l,c]=[c,l]),n.chartRangeStart=l,n.chartRangeEnd=c;const d=Sf(l,c),u=l;if(!Wh)if((n.chartLocation==="Point"||n.chartLocation==="Search")&&n.chartPoint?!0:n.chartLocation==="Draw"&&n.chartPolygon&&n.chartPolygon.length>=3){console.log("Using pixel-data API for range mode");const f=o.length*i.length;n.chartLoadingProgress={total:f,done:0},n.chartBoxes=null,_t();const p=[];for(const w of i)for(const L of o){const $=Nt(L),x=St(l,$),v=St(c,$);if(J(x)>J(v))continue;const T=n.chartLoadingProgress.done;st(Math.min(95,Math.round((T+.1)/f*100)));try{if((n.chartLocation==="Point"||n.chartLocation==="Search")&&n.chartPoint){const[k,S]=pn(n.chartPoint.lat,n.chartPoint.lon),P=await Ha({variable:n.chartVariable,model:w,x0:k,x1:k,y0:S,y1:S,start_date:x,end_date:v,scenario:ee(L),resolution:"low",step_days:1});for(let V=0;V<P.timestamps.length;V++){const H=P.timestamps[V];if(d&&!co(H,u))continue;const W=P.values[V];if(W!==null&&isFinite(W)){const q=n.chartVariable==="hurs"?Math.min(W,100):W;p.push({scenario:L,model:w,rawValue:q,dateUsed:H})}}t(p)}else if(n.chartLocation==="Draw"&&n.chartPolygon&&n.chartPolygon.length>=3){const[k,S,P,V]=Ga(n.chartPolygon),H=Qa(n.chartPolygon,k,S,P,V),q=(await Wa({variable:n.chartVariable,models:[w],x0:k,x1:S,y0:P,y1:V,start_date:x,end_date:v,scenario:ee(L),resolution:"low",step_days:1,mask:H})).models[w];if(q)for(let j=0;j<q.timestamps.length;j++){const O=q.timestamps[j];if(d&&!co(O,u))continue;const y=q.values[j];if(y!==null&&isFinite(y)){const B=n.chartVariable==="hurs"?Math.min(y,100):y;p.push({scenario:L,model:w,rawValue:B,dateUsed:O})}}t(p)}}catch(k){console.warn("Pixel API failed, falling back to full map load:",k);const S=d?uo(u,x,v,50):lo(x,v,50);for(const P of S){const V=d?P:St(P,$);if(d&&!Ka(V,$))continue;const H=yt({variable:n.chartVariable,date:V,model:w,scenario:L,resolution:1});let W=null;try{W=await It(H)}catch(O){console.warn("Range fallback request failed, skipping date:",O);continue}const q=At(W);if(!q)continue;const j=n.chartLocation==="Draw"&&n.chartPolygon&&n.chartPolygon.length>=3?On(q,n.chartVariable,W.shape,n.chartPolygon):(n.chartLocation==="Point"||n.chartLocation==="Search")&&n.chartPoint?qn(q,n.chartVariable,W.shape,n.chartPoint):Un(q,n.chartVariable);p.push({scenario:L,model:w,rawValue:j,dateUsed:V})}t(p)}const C=n.chartLoadingProgress.done+1;n.chartLoadingProgress={total:f,done:C},st(Math.min(98,Math.round(C/f*100))),t(p)}n.chartSamples=p,n.chartRangeSeries=Vn(p,n.chartVariable,n.chartUnit),n.chartLoadingProgress={total:f,done:f},st(100)}else{const f=d?uo(u,l,c,50):lo(l,c,50);if(!f.length){n.chartError="Enter a valid date range within the selected scenarios.",n.chartSamples=[],n.chartBoxes=null,n.chartRangeSeries=null,n.chartLoading=!1,n.chartLoadingProgress={total:0,done:0},_t();return}const p=o.length*i.length*f.length;n.chartLoadingProgress={total:p,done:0},n.chartBoxes=null,_t();const w=[];for(const L of i)for(const $ of o){const x=Nt($);for(const v of f){const T=d?v:St(v,x);if(d&&!Ka(T,x))continue;const C=n.chartLoadingProgress.done;st(Math.min(95,Math.round((C+.1)/p*100)));const k=yt({variable:n.chartVariable,date:T,model:L,scenario:$,resolution:1});let S=null;try{S=await It(k)}catch(W){console.warn("Range request failed, skipping date:",W);continue}const P=n.chartLoadingProgress.done+1;n.chartLoadingProgress={total:p,done:P},st(Math.min(98,Math.round(P/p*100))),t(w);const V=At(S);if(!V)throw new Error("No data returned for chart request.");const H=n.chartLocation==="Draw"&&n.chartPolygon&&n.chartPolygon.length>=3?On(V,n.chartVariable,S.shape,n.chartPolygon):(n.chartLocation==="Point"||n.chartLocation==="Search")&&n.chartPoint?qn(V,n.chartVariable,S.shape,n.chartPoint):Un(V,n.chartVariable);w.push({scenario:$,model:L,rawValue:H,dateUsed:T})}}n.chartSamples=w,n.chartRangeSeries=Vn(w,n.chartVariable,n.chartUnit),n.chartLoadingProgress={total:p,done:p},st(100)}}}catch(e){n.chartError=e instanceof Dt&&e.statusCode||e instanceof Error?e.message:String(e),n.chartSamples=[],n.chartBoxes=null,n.chartRangeSeries=null,n.chartLoadingProgress={total:1,done:1}}finally{n.chartLoading=!1,_t()}}async function Lt(){if(n.__updatingMask){console.log("Skipping loadClimateData - mask update in progress");return}if(console.log("fetching"),n.canvasView==="map"){n.isLoading=!0,st(5,!0),n.dataError=null;try{const t=await yr();n.metaData=t,n.availableModels=t.models,st(20);const e=n.mode==="Compare"&&n.compareMode==="Scenarios"?n.compareScenarioA:n.mode==="Ensemble"&&n.ensembleScenarios.length>0?n.ensembleScenarios[0]:n.scenario;n.timeRange=Nt(e),st(30);const a=n.mode==="Compare"?await $f(e,st):n.mode==="Ensemble"?await kf(st):await(async()=>{st(40);const r=Re(n.date,e);r!==n.date&&(n.date=r);const o=yt({variable:n.variable,date:r,model:n.model,scenario:n.scenario,resolution:n.resolution});st(55);let i=await It(o);st(80);let s=At(i);if(!s)throw new Error("No data returned for the selected parameters.");if(n.variable==="hurs"){const u=new Float32Array(s.length);let h=1/0,f=-1/0,p=0,w=0;for(let $=0;$<s.length;$++){const x=s[$];if(!isFinite(x)){u[$]=NaN;continue}const v=Math.min(x,100);u[$]=v,h=Math.min(h,v),f=Math.max(f,v),p+=v,w+=1}const L=w>0?p/w:NaN;return i={...i,data:u,data_encoding:"none"},s=u,{data:i,min:h,max:f,mean:L}}const{min:l,max:c}=nf(s),d=Un(s,n.variable);return st(95),{data:i,min:l,max:c,mean:d}})();if(n.currentData=a.data,n.dataMin=a.min,n.dataMax=a.max,n.dataMean=a.mean,st(100),n.isLoading=!1,z(),nt){const r=nt.querySelector("#map-canvas");r&&aa(r)}}catch(t){t instanceof Dt&&t.statusCode?n.dataError=t.message:n.dataError=t instanceof Error?t.message:String(t),n.isLoading=!1,st(0,!0),n.currentData=null,n.dataMin=null,n.dataMax=null,n.dataMean=null,z()}}}function Tf(){return`
      <div style="${g(M.branding)}">
        <div data-role="brand-eye" style="${g(M.brandIcon)}">
          <svg viewBox="0 0 120 80" style="${g(M.brandSvg)}" aria-hidden="true">
            <defs>
              <clipPath id="brand-eye-clip">
                <rect x="0" y="0" width="120" height="80" style="${g(M.brandClipRect)}" />
              </clipPath>
            </defs>
            <g style="${g(M.brandLids)}">
              <path
                d="M10 40c10-15 30-30 50-30s40 15 50 30c-10 15-30 30-50 30S20 55 10 40Z"
                style="${g(M.brandOutline)}"
              />
            </g>
            <g data-role="brand-iris" style="${g(pt(M.brandIrisGroup,M.brandEyeContent))}">
              <circle cx="60" cy="40" r="20" style="${g(M.brandIris)}" />
              <g data-role="brand-pupil" style="${g(M.brandPupilGroup)}">
                <circle cx="60" cy="40" r="10" style="${g(M.brandPupil)}" />
                <circle cx="72" cy="30" r="4" style="${g(M.brandHighlight)}" />
              </g>
            </g>
          </svg>
        </div>
        <span style="${g(M.brandName)}">Polyoracle</span>
      </div>
    `}function z(){if(!nt)return;const t=nt,e=Array.from(t.querySelectorAll(".custom-select-wrapper.open")).map(u=>u.getAttribute("data-key")).filter(u=>!!u),a=(n.resolution-1)/2*100,r=n.mode==="Explore"?"translateX(0%)":n.mode==="Compare"?"translateX(-33.333%)":"translateX(-66.666%)",o=n.mode==="Explore"?"translateX(0%)":n.mode==="Compare"?"translateX(100%)":"translateX(200%)",i=n.canvasView==="map"?"translateX(0%)":"translateX(100%)",s=n.panelTab==="Manual"?"translateX(0%)":"translateX(-50%)";t.innerHTML=`
    <div style="${g(M.page)}">
      <div style="${g(M.bgLayer1)}"></div>
      <div style="${g(M.bgLayer2)}"></div>
      <div style="${g(M.bgOverlay)}"></div>
      ${Tf()}
        ${n.canvasView==="map"&&n.dataMin!==null&&n.dataMax!==null?Th(n.mode==="Ensemble"?n.ensembleVariable:n.variable,n.dataMin,n.dataMax,n.metaData,n.mode==="Ensemble"?n.ensembleUnit:n.selectedUnit,n.mode==="Compare"||n.mode==="Ensemble"&&n.ensembleStatistic!=="mean"):""}
      <div style="${g(M.mapArea)}">
        ${n.canvasView==="map"?`
              <canvas
                id="map-canvas"
                style="position: absolute; inset: 0; width: 100%; height: 100%; object-fit: contain; pointer-events: auto;"
              ></canvas>
              ${Pf()}
              ${rf()}
              ${of()}
              ${sf()}
              ${lf()}
              ${Lf()}
              ${n.dataError?`<div style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.8); z-index: 10;">
                      <div style="text-align: center; max-width: 600px; padding: 20px;">
                        <div style="${g(M.mapTitle)}">Error loading data</div>
                        <div style="${g(M.mapSubtitle)}">${n.dataError}</div>
                        ${n.apiAvailable===!1?`<div style="${g(pt(M.mapSubtitle,{marginTop:12,fontSize:12}))}">
                                Make sure the Python API server is running. Check the terminal for connection details.
                              </div>`:""}
                      </div>
                    </div>`:""}
              ${!n.isLoading&&!n.dataError&&!n.currentData?`<div style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.5); z-index: 5;">
                      <div style="text-align: center;">
                        <div style="${g(M.mapTitle)}">No data loaded</div>
                        <div style="${g(M.mapSubtitle)}">
                          Adjust parameters to load climate data
                        </div>
                      </div>
                    </div>`:""}
            `:'<div data-role="chart-container" style="pointer-events:auto; width:100%; display:flex; align-items:center; justify-content:center; padding:24px;"></div>'}
      </div>

      <aside data-role="sidebar" class="sidebar" style="width: ${$t}px; transform: ${n.sidebarOpen?"translateX(0)":`translateX(${$t+24}px)`}; pointer-events: ${n.sidebarOpen?"auto":"none"}" aria-hidden="${!n.sidebarOpen}">
        <div class="sidebar-top">
          <div class="sidebar-brand">
            <div class="logo-dot"></div>
          </div>
          <div class="tab-switch" style="${g(M.tabSwitch)}">
            ${["Manual","Chat"].map(u=>Cf(u,n.panelTab===u?M.tabBtnActive:void 0,"panel-tab")).join("")}
          </div>
        </div>

        <div class="sidebar-content">
          <div class="tab-viewport">
            <div data-role="tab-track" class="tab-track" style="transform: ${s}">
              <div class="tab-pane">
                ${n.canvasView==="map"?_f({modeTransform:r,resolutionFill:a,modeIndicatorTransform:o}):If()}
              </div>
              <div class="tab-pane">
                ${Af()}
              </div>
            </div>
          </div>
        </div>
      </aside>

      <div data-role="canvas-toggle" style="${g({...M.canvasToggle,right:n.sidebarOpen?$t+24:24})}">
        <div style="${g(M.canvasSwitch)}">
          <div data-role="canvas-indicator" style="${g({...M.canvasIndicator,transform:i})}"></div>
          <button
            type="button"
            aria-label="Show map canvas"
            data-action="set-canvas"
            data-value="map"
            style="${g(pt(M.canvasBtn,n.canvasView==="map"?M.canvasBtnActive:void 0))}"
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.6">
              <path d="M4 6.5 9 4l6 2.5L20 4v14l-5 2.5L9 18 4 20.5V6.5Z" />
              <path d="m9 4v14m6-11.5v14" />
            </svg>
          </button>
          <button
            type="button"
            aria-label="Show chart canvas"
            data-action="set-canvas"
            data-value="chart"
            style="${g(pt(M.canvasBtn,n.canvasView==="chart"?M.canvasBtnActive:void 0))}"
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.8">
              <path d="M4 18h16" />
              <path d="M6 18 11 9l4 5 3-6" />
              <circle cx="6" cy="18" r="1.2" />
              <circle cx="11" cy="9" r="1.2" />
              <circle cx="15" cy="14" r="1.2" />
              <circle cx="18" cy="8" r="1.2" />
            </svg>
          </button>
        </div>
      </div>

      ${Jh(n)}

      ${ph(n.sidebarOpen)}

      ${n.canvasView==="map"?Vh({date:n.date,timeRange:n.timeRange,sidebarOpen:n.sidebarOpen,sidebarWidth:$t,mode:n.mode,compareMode:n.compareMode,compareDateStart:n.compareDateStart,compareDateEnd:n.compareDateEnd}):""}

      ${xh()}
      ${bh(jt())}
    </div>
  `,Nf();const l=t.querySelector(".tutorial-box");if(l){const u=l.getBoundingClientRect(),h=16;let f=0,p=0;if(u.right>window.innerWidth-h?f=window.innerWidth-h-u.right:u.left<h&&(f=h-u.left),u.bottom>window.innerHeight-h?p=window.innerHeight-h-u.bottom:u.top<h&&(p=h-u.top),f!==0||p!==0){const w=l.style.transform||"";l.style.transform=`${w} translate(${f}px, ${p}px)`}}if(e.forEach(u=>{const h=t.querySelector(`.custom-select-wrapper[data-key="${u}"]`);h&&h.classList.add("open")}),vt=nt.querySelector("#map-canvas"),vt&&n.currentData&&!n.dataError&&n.dataMin!==null&&n.dataMax!==null){aa(vt),Bn(n.currentData,vt,ct,n.palette,n.dataMin,n.dataMax,n.mode==="Ensemble"?n.ensembleVariable:n.variable,n.mode==="Ensemble"?n.ensembleUnit:n.selectedUnit,n.masks,n.mode==="Ensemble"?n.ensembleStatistics:null,n.mode==="Ensemble");const u=ct.find(h=>h.name===n.palette)||ct[0];An("legend-gradient-canvas",u.colors),(n.drawState.active||n.mapPolygon!==null&&n.mapPolygon.length>=3)&&requestAnimationFrame(ma)}const c=(n.sidebarOpen?$t+24:24)+8,d=n.sidebarOpen?1:.9;yi(c,d),xi(),n.canvasView==="chart"&&_t()}function Lf(){if(!n.isLoading)return"";const t=Math.max(0,Math.min(100,Math.round(n.loadingProgress)));return`
      <div style="${g(M.loadingIndicator)}">
        <div style="${g(M.loadingSpinner)}"></div>
        <div style="${g(M.loadingTextGroup)}">
          <div style="${g(M.loadingText)}">Loading data · ${t}%</div>
          <div style="${g(M.loadingBar)}">
            <div style="${g({...M.loadingBarFill,width:`${t}%`})}"></div>
          </div>
          <div style="${g(M.loadingSubtext)}">Fetching climate tiles</div>
        </div>
      </div>
    `}function Ef(){return`
      <div style="position:absolute; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none;">
      </div>
    `}function vr(t){if(!Number.isFinite(t))return"-";const e=Math.abs(t);return e>=1e3?t.toFixed(0):e>=100?t.toFixed(1):e>=1?t.toFixed(2):t.toPrecision(2)}function ho(t){if(!t.length)return`<div style="${g(M.chartEmpty)}">No chart data loaded yet.</div>`;const e=[...t].sort((k,S)=>bt.indexOf(k.scenario)-bt.indexOf(S.scenario)),r=(ct.find(k=>k.name===n.palette)||ct[0]).colors,o=900,i=440,s={top:26,right:36,bottom:70,left:86},l=o-s.left-s.right,c=i-s.top-s.bottom,d=e.flatMap(k=>[k.stats.min,k.stats.max]),u=Math.min(...d),h=Math.max(...d),f=Math.max(Math.abs(h-u)*.12,1e-6),p=da().domain([u-f,h+f]).range([c,0]),w=p.ticks(6),L=l/(e.length+1),$=w.map(k=>{const S=p(k)+s.top;return`
        <g>
          <line x1="${s.left}" x2="${o-s.right}" y1="${S}" y2="${S}" stroke="rgba(255,255,255,0.08)" />
          <text x="${s.left-10}" y="${S+4}" fill="var(--text-secondary)" font-size="11" text-anchor="end">
            ${vr(k)}
          </text>
        </g>
      `}).join(""),x=e.map((k,S)=>{const P=s.left+L*(S+1),V=r[S%r.length],{min:H,q1:W,median:q,q3:j,max:O,mean:y}=k.stats,B=p(j)+s.top,_=p(W)+s.top,m=Math.max(2,_-B),b=p(H)+s.top,D=p(O)+s.top;return`
        <g data-boxplot-idx="${S}" class="boxplot-group">
          <line x1="${P}" x2="${P}" y1="${b}" y2="${D}" stroke="${V}" stroke-width="2" stroke-linecap="round" />
          <rect x="${P-24}" y="${B}" width="48" height="${m}" fill="rgba(255,255,255,0.06)" stroke="${V}" stroke-width="2" rx="6" />
          <line x1="${P-24}" x2="${P+24}" y1="${p(q)+s.top}" y2="${p(q)+s.top}" stroke="${V}" stroke-width="2.4" />
          <circle cx="${P}" cy="${p(y)+s.top}" r="4" fill="${V}" stroke="rgba(0,0,0,0.55)" stroke-width="1" />
          <text x="${P}" y="${i-s.bottom+32}" fill="var(--text-primary)" font-weight="700" font-size="12" text-anchor="middle">${k.scenario}</text>
          <text x="${P}" y="${i-s.bottom+48}" fill="var(--text-secondary)" font-size="11" text-anchor="middle">${k.samples.length} model${k.samples.length===1?"":"s"}</text>
          <rect x="${P-35}" y="${s.top}" width="70" height="${c}" fill="transparent" class="boxplot-hover-area" style="cursor: pointer; pointer-events: all;" />
        </g>
      `}).join(""),v=e.map((k,S)=>{const V=s.left+L*(S+1)+30,H=V,W=V+6,q=W+6,j=k.samples.map(_=>{const m=p(_.value)+s.top;return{model:_.model,value:_.value,y:m}}).sort((_,m)=>_.y-m.y),O=12,y=[];return j.forEach((_,m)=>{if(m===0)y.push({..._,adjustedY:_.y});else{const D=y[m-1].adjustedY+O;y.push({..._,adjustedY:Math.max(_.y,D)})}}),y.map(_=>{const m=_.adjustedY||_.y;return`
                    <g class="model-indicator" data-boxplot-idx="${S}">
                      <line x1="${H}" x2="${W}" y1="${_.y}" y2="${_.y}" stroke="white" stroke-width="1" stroke-linecap="round" />
                      <text x="${q}" y="${m+4}" fill="white" font-size="10" font-weight="300" opacity="0.95">${_.model}</text>
                    </g>
                  `}).join("")}).join(""),T=`
      <line
        x1="${s.left}"
        x2="${s.left}"
        y1="${s.top}"
        y2="${i-s.bottom}"
        stroke="rgba(255,255,255,0.65)"
        stroke-width="1.2"
      />
    `,C=`
      <text
        x="${s.left-70}"
        y="${s.top+c/2}"
        fill="var(--text-secondary)"
        font-size="12"
        text-anchor="middle"
        transform="rotate(-90 ${s.left-70} ${s.top+c/2})"
      >
        ${n.chartUnit}
      </text>
    `;return`
      <svg viewBox="0 0 ${o} ${i}" role="img" aria-label="Global box plots" preserveAspectRatio="xMidYMid meet" style="width:100%; height:auto;">
        ${T}
        ${$}
        ${x}
        <g class="boxplot-hover-overlay" style="opacity: 0; pointer-events: none;">
          ${v}
        </g>
        ${C}
      </svg>
    `}function fo(t,e){if(!t.length)return`<div style="${g(M.chartEmpty)}">No chart data loaded yet.</div>`;const a=[...t].sort((C,k)=>bt.indexOf(C.scenario)-bt.indexOf(k.scenario)),o=(ct.find(C=>C.name===n.palette)||ct[0]).colors,i=560,s=300,l={top:18,right:16,bottom:52,left:48},c=i-l.left-l.right,d=s-l.top-l.bottom,u=a.flatMap(C=>[C.stats.min,C.stats.max]),h=Math.min(...u),f=Math.max(...u),p=Math.max(Math.abs(f-h)*.12,1e-6),w=da().domain([h-p,f+p]).range([d,0]),L=w.ticks(4),$=c/(a.length+1),x=L.map(C=>{const k=w(C)+l.top;return`
        <g>
          <line x1="${l.left}" x2="${i-l.right}" y1="${k}" y2="${k}" stroke="rgba(255,255,255,0.06)" />
          <text x="${l.left-8}" y="${k+3}" fill="var(--text-secondary)" font-size="9" text-anchor="end">
            ${vr(C)}
          </text>
        </g>
      `}).join(""),v=a.map((C,k)=>{const S=l.left+$*(k+1),P=o[k%o.length],{min:V,q1:H,median:W,q3:q,max:j,mean:O}=C.stats,y=w(q)+l.top,B=w(H)+l.top,_=Math.max(2,B-y);return`
        <g>
          <line x1="${S}" x2="${S}" y1="${w(V)+l.top}" y2="${w(j)+l.top}" stroke="${P}" stroke-width="1.6" stroke-linecap="round" />
          <rect x="${S-16}" y="${y}" width="32" height="${_}" fill="rgba(255,255,255,0.06)" stroke="${P}" stroke-width="1.6" rx="5" />
          <line x1="${S-16}" x2="${S+16}" y1="${w(W)+l.top}" y2="${w(W)+l.top}" stroke="${P}" stroke-width="2" />
          <circle cx="${S}" cy="${w(O)+l.top}" r="3.2" fill="${P}" stroke="rgba(0,0,0,0.55)" stroke-width="0.8" />
          <text x="${S}" y="${s-l.bottom+26}" fill="var(--text-primary)" font-weight="700" font-size="10" text-anchor="middle">${C.scenario}</text>
          <text x="${S}" y="${s-l.bottom+40}" fill="var(--text-secondary)" font-size="9" text-anchor="middle">${C.samples.length} model${C.samples.length===1?"":"s"}</text>
        </g>
      `}).join(""),T=`
      <line
        x1="${l.left}"
        x2="${l.left}"
        y1="${l.top}"
        y2="${s-l.bottom}"
        stroke="rgba(255,255,255,0.55)"
        stroke-width="1"
      />
    `;return`
      <svg viewBox="0 0 ${i} ${s}" role="img" aria-label="Mini box plots" preserveAspectRatio="xMidYMid meet" style="width:100%; height:auto;">
        ${T}
        ${x}
        ${v}
        <text x="${l.left}" y="${l.top-6}" fill="var(--text-secondary)" font-size="9">${Mt(e)}</text>
      </svg>
    `}function po(t){if(!t.length)return`<div style="${g(M.chartEmpty)}">No chart data loaded yet.</div>`;const a=(ct.find(O=>O.name===n.palette)||ct[0]).colors,r=960,o=460,i={top:28,right:32,bottom:82,left:86},s=r-i.left-i.right,l=o-i.top-i.bottom,c=t.flatMap(O=>O.points),d=c.map(O=>J(O.date)),u=Bi(d),h=Fi(d);if(!u||!h)return`<div style="${g(M.chartEmpty)}">No chart data loaded yet.</div>`;const f=1440*60*1e3,p=new Date(u.getTime()-f*.25),w=new Date(h.getTime()+f*.25),L=Qu().domain([p,w]).range([0,s]),$=L.ticks(6),x=pr("%b %Y"),v=c.flatMap(O=>[O.stats.min,O.stats.max]),T=Math.min(...v),C=Math.max(...v),k=Math.max(Math.abs(C-T)*.12,1e-6),S=da().domain([T-k,C+k]).range([l,0]),V=S.ticks(6).map(O=>{const y=S(O)+i.top;return`
        <g>
          <line x1="${i.left}" x2="${r-i.right}" y1="${y}" y2="${y}" stroke="rgba(255,255,255,0.08)" />
          <text x="${i.left-10}" y="${y+4}" fill="var(--text-secondary)" font-size="11" text-anchor="end">
            ${vr(O)}
          </text>
        </g>
      `}).join(""),H=$.map(O=>{const y=L(O)+i.left;return`
        <g>
          <line x1="${y}" x2="${y}" y1="${i.top}" y2="${o-i.bottom}" stroke="rgba(255,255,255,0.06)" />
          <text x="${y}" y="${o-i.bottom+26}" fill="var(--text-secondary)" font-size="11" text-anchor="middle">
            ${x(O)}
          </text>
        </g>
      `}).join(""),W=Math.max(Pt.length,4),q=t.map((O,y)=>{if(!O.points.length)return"";const B=a[y%a.length],_=O.points.map(F=>{const E=Array.from({length:W+1},(I,U)=>{const X=U/W;return F.stats.min+(F.stats.max-F.stats.min)*X});return{point:F,levels:E}}),m=F=>{const E=_.map(({point:U,levels:X})=>{const K=L(J(U.date))+i.left,Z=S(X[F+1])+i.top;return`${K},${Z}`}).join(" L "),I=[..._].reverse().map(({point:U,levels:X})=>{const K=L(J(U.date))+i.left,Z=S(X[F])+i.top;return`${K},${Z}`}).join(" L ");return`M ${E} L ${I} Z`},b=Array.from({length:W},(F,E)=>{const I=m(E),U=W/2,K=.55*(1-Math.min(Math.abs(E+.5-U)/U,1))+.08;return`<path d="${I}" fill="${B}" fill-opacity="${K.toFixed(3)}" stroke="none" />`}).join(""),D=O.points.map((F,E)=>{const I=L(J(F.date))+i.left,U=S(F.stats.median)+i.top;return`${E===0?"M":"L"} ${I} ${U}`}).join(" "),R=O.points.map((F,E)=>{const I=L(J(F.date))+i.left,U=S(F.stats.mean)+i.top;return`${E===0?"M":"L"} ${I} ${U}`}).join(" ");return`
        <g>
          ${b}
          <path d="${D}" fill="none" stroke="${B}" stroke-width="2.2" />
          <path d="${R}" fill="none" stroke="${B}" stroke-width="1.6" stroke-dasharray="6 6" stroke-opacity="0.9" />
          <circle cx="${L(J(O.points[O.points.length-1].date))+i.left}" cy="${S(O.points[O.points.length-1].stats.median)+i.top}" r="4" fill="${B}" stroke="rgba(0,0,0,0.4)" stroke-width="1" />
        </g>
      `}).join(""),j=`
      <text
        x="${i.left-70}"
        y="${i.top+l/2}"
        fill="var(--text-secondary)"
        font-size="12"
        text-anchor="middle"
        transform="rotate(-90 ${i.left-70} ${i.top+l/2})"
      >
        ${n.chartUnit}
      </text>
    `;return`
      <div style="width:100%; display:flex; flex-direction:column; gap:12px; align-items:center;">
        <div style="position:relative; width:100%; display:flex; justify-content:center;">
          <div style="position:absolute; top:10px; right:16px; display:flex; gap:12px; align-items:center; color:var(--text-secondary); font-size:11.5px; z-index:2;">
            <div style="display:flex; align-items:center; gap:6px;">
              <span style="display:inline-block; width:26px; height:0; border-top:1px solid var(--text-primary);"></span>
              <span>Median</span>
            </div>
            <div style="display:flex; align-items:center; gap:6px;">
              <span style="display:inline-block; width:26px; height:0; border-top:1px dashed var(--text-primary);"></span>
              <span>Mean</span>
            </div>
          </div>
          <svg viewBox="0 0 ${r} ${o}" role="img" aria-label="Distribution over time" preserveAspectRatio="xMidYMid meet" style="width:100%; height:auto;">
            ${V}
            ${H}
            <path
              d="M ${i.left} ${i.top} L ${i.left} ${o-i.bottom} L ${r-i.right} ${o-i.bottom}"
              fill="none"
              stroke="rgba(255,255,255,0.6)"
              stroke-width="1.2"
              stroke-linecap="round"
            />
            ${q}
            ${j}
          </svg>
        </div>
        <div style="${g(M.chartLegend)}">
          ${t.map((O,y)=>`
            <div style="display:flex; align-items:center; gap:8px; font-size:12; color:var(--text-secondary);">
              <span style="display:inline-block; width:16px; height:8px; background:${a[y%a.length]}; border-radius:999px;"></span>
              <span style="color:var(--text-primary); font-weight:700;">${O.scenario}</span>
            </div>
          `).join("")}
        </div>
      </div>
    `}function et(t,e){return`
    <div style="${g(M.field)}">
      ${t?`<div style="${g(M.fieldLabel)}">${t}</div>`:""}
      ${e}
    </div>
  `}function Kt(t,e,a){const r=a?.type??"date",o=a?.dataKey??t,i=a?.min?`min="${a.min}"`:"",s=a?.max?`max="${a.max}"`:"",l=a?.dataRole?`data-role="${a.dataRole}"`:"";return`
    <input
      type="${r}"
      value="${e}"
      data-action="update-input"
      data-key="${o}"
      ${i}
      ${s}
      ${l}
    />
  `}function ot(t,e,a,r){const o=r?.dataKey??t,i=r?.disabled?"disabled":"",s=`custom-select-${o}-${Math.random().toString(36).substr(2,9)}`,l=r?.infoType,c=Mt(r?.selectedLabel??a),d=r?.extraContent??"",u=r?.dataRole?`data-role="${r.dataRole}"`:"";return`
    <div class="custom-select-container">
      <div class="custom-select-info-panel" id="${s}-info" role="tooltip"></div>
      <div class="custom-select-wrapper" ${u} data-key="${o}" ${i?'data-disabled="true"':""} ${l?`data-info-type="${l}"`:""}>
        <div class="custom-select-trigger" data-action="update-select" data-key="${o}" id="${s}-trigger" ${i?'aria-disabled="true"':""} tabindex="${i?"-1":"0"}">
          <span class="custom-select-value">${c}</span>
          <svg class="custom-select-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="custom-select-dropdown" id="${s}-dropdown" role="listbox">
          ${e.map(h=>`
                <div class="custom-select-option ${h===a?"selected":""}" 
                     data-value="${h}" 
                     data-action="update-select" 
                     data-key="${o}"
                     role="option"
                     ${h===a?'aria-selected="true"':""}
                     tabindex="0">
                  ${o==="ensembleStatistic"||o==="maskStatistic"?h==="mean"?"Mean":h==="median"?"Median":h==="std"?"Std":h==="iqr"?"IQR":h==="percentile"?"Percentile":h==="extremes"?"Extremes":h:h}
                </div>
              `).join("")}
          ${d}
        </div>
      </div>
    </div>
  `}function Cf(t,e,a="panel-tab"){return`
    <button
      type="button"
      data-action="set-tab"
      data-key="${a}"
      data-value="${t}"
      style="${g(pt(M.tabBtn,e))}"
    >
      ${t}
    </button>
  `}function _f(t){const{modeTransform:e,resolutionFill:a,modeIndicatorTransform:r}=t,o=(s,l,c,d,u)=>`
          <div style="${g({border:"1px solid var(--border-medium)",borderRadius:12,background:"var(--bg-subtle)",padding:"10px 12px"})}">
            <button
              type="button"
              data-action="toggle-collapse"
              data-key="${u}"
              style="${g({display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",background:"transparent",border:"none",color:"var(--text-primary)",fontWeight:700,fontSize:13,cursor:"pointer",padding:0})}"
            >
              <span>${s}</span>
              <span style="${g({color:"var(--text-secondary)",fontWeight:600,fontSize:12})}">${c} ${l?"▴":"▾"}</span>
            </button>
            ${l?`<div style="${g({marginTop:10,display:"flex",flexWrap:"wrap",gap:8})}">${d}</div>`:""}
          </div>
        `,i=n.compareMode==="Models"?[et("Scenario",ot("scenario",bt,n.scenario,{infoType:"scenario"})),et("Date",Kt("date",n.date))]:n.compareMode==="Dates"?[et("Scenario",ot("scenario",bt,n.scenario,{infoType:"scenario"})),et("Model",ot("model",ft,n.model,{infoType:"model"}))]:[et("Model",ot("model",ft,n.model,{infoType:"model"})),et("Date",Kt("date",n.date))];return`
    <div style="${g(M.modeSwitch)}">
      <div data-role="mode-indicator" style="${g({...M.modeIndicator,transform:r})}"></div>
      ${["Explore","Compare","Ensemble"].map(s=>`
            <button
              type="button"
              class="mode-btn"
              data-action="set-mode"
              data-value="${s}"
              style="${g(pt(M.modeBtn,n.mode===s?M.modeBtnActive:void 0))}"
            >
              ${s}
            </button>
          `).join("")}
    </div>

    <div style="${g(M.modeViewport)}">
      <div data-role="mode-track" style="${g({...M.modeTrack,transform:e})}">
        <div class="mode-pane-scrollable" style="${g(M.modePane)}">
          <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
            <div style="${g(M.sectionTitle)}">Parameters</div>
            <div style="${g(M.paramGrid)}">
              ${et("Scenario",ot("scenario",bt,n.scenario,{infoType:"scenario",dataRole:"scenario-selector"}))}
              ${et("Model",ot("model",ft,n.model,{infoType:"model",dataRole:"model-selector"}))}
              ${et("Date",(()=>{const s=Nt(n.scenario);return Kt("date",n.date,{min:s.start,max:s.end,dataRole:"date-picker"})})())}
              ${et("Variable",ot("variable",Pt,n.variable,{infoType:"variable",dataRole:"variable-selector"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${g(M.sectionTitle)}">Unit</div>
              ${et("",ot("unit",ne(n.variable).map(s=>s.label),n.selectedUnit,{dataKey:"unit",dataRole:"unit-selector"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${g(M.sectionTitle)}">Color palette</div>
              ${et("",ot("palette",ct.map(s=>s.name),n.palette,{dataKey:"palette",dataRole:"palette-selector"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${g(M.sectionTitle)}">Resolution</div>
              <div style="${g(M.resolutionRow)}">
                <input
                  type="range"
                  min="1"
                  max="3"
                  step="1"
                  value="${n.resolution}"
                  data-action="set-resolution"
                  class="resolution-slider"
                  style="${g(pt(M.range,{"--slider-fill":`${a}%`}))}"
                />
                <div data-role="resolution-value" style="${g(M.resolutionValue)}">${n.resolution===1?"Low":n.resolution===2?"Medium":"High"}</div>
              </div>
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${g(M.sectionTitle)}">Mask</div>
              ${n.masks.length>0?`
                      <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
                        ${n.masks.map((s,l)=>`
                          ${n.mode==="Ensemble"?`
                                  <div style="${g({display:"flex",alignItems:"center",gap:8,marginBottom:4})}">
                                    ${ot("maskStatistic",["mean","std","median","iqr","percentile","extremes"],s.statistic||"mean",{dataKey:"maskStatistic",selectedLabel:s.statistic==="mean"?"Mean":s.statistic==="std"?"Std":s.statistic==="median"?"Median":s.statistic==="iqr"?"IQR":s.statistic==="percentile"?"Percentile":s.statistic==="extremes"?"Extremes":"Mean"}).replace('class="custom-select-wrapper"',`class="custom-select-wrapper" data-mask-index="${l}" style="width: 100px;"`)}
                                  </div>
                                  `:""}
                          <div style="${g({display:"flex",alignItems:"center",gap:8})}">
                            <input
                              type="number"
                              step="any"
                              value="${s.lowerEdited&&s.lowerBound!==null?s.lowerBound:""}"
                              data-action="update-mask-bound"
                              data-mask-index="${l}"
                              data-bound="lower"
                              placeholder="${n.dataMin!==null?n.dataMin.toFixed(2):""}"
                              style="${g({width:"90px",background:"var(--gradient-bg)",border:"1px solid var(--border-strong)",borderRadius:8,color:"var(--text-primary)",padding:"6px 10px",fontSize:12.5,fontWeight:600,fontFamily:"var(--font-geist-sans)",letterSpacing:.25,minHeight:32,boxShadow:"inset 0 1px 0 var(--inset-light)"})}"
                            />
                            <span style="${g({fontSize:12.5,color:"var(--text-secondary)",minWidth:"20px",textAlign:"center"})}">to</span>
                            <input
                              type="number"
                              step="any"
                              value="${s.upperEdited&&s.upperBound!==null?s.upperBound:""}"
                              data-action="update-mask-bound"
                              data-mask-index="${l}"
                              data-bound="upper"
                              placeholder="${n.dataMax!==null?n.dataMax.toFixed(2):""}"
                              style="${g({width:"90px",background:"var(--gradient-bg)",border:"1px solid var(--border-strong)",borderRadius:8,color:"var(--text-primary)",padding:"6px 10px",fontSize:12.5,fontWeight:600,fontFamily:"var(--font-geist-sans)",letterSpacing:.25,minHeight:32,boxShadow:"inset 0 1px 0 var(--inset-light)"})}"
                            />
                            <button
                              type="button"
                              data-action="remove-mask"
                              data-mask-index="${l}"
                              style="${g({width:28,height:28,padding:0,borderRadius:6,border:"1px solid var(--border-medium)",background:"var(--bg-transparent)",color:"var(--text-secondary)",fontSize:16,fontWeight:600,cursor:"pointer",transition:"all 0.15s ease",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0})}"
                              onmouseover="this.style.borderColor='var(--border-bright)'; this.style.background='var(--bg-medium)'"
                              onmouseout="this.style.borderColor='var(--border-medium)'; this.style.background='var(--bg-transparent)'"
                            >
                              −
                            </button>
                          </div>
                        `).join("")}
                        <button
                          type="button"
                          data-action="apply-masks"
                          style="${g({padding:"10px 16px",borderRadius:10,border:"1px solid var(--border-strong)",background:"var(--gradient-primary)",color:"white",fontSize:12.5,fontWeight:700,cursor:"pointer",transition:"all 0.15s ease",textAlign:"center",width:"100%",marginTop:8,boxShadow:"var(--shadow-combined)"})}"
                          onmouseover="this.style.borderColor='var(--accent-border-bright)'; this.style.boxShadow='var(--shadow-elevated)'"
                          onmouseout="this.style.borderColor='var(--border-strong)'; this.style.boxShadow='var(--shadow-combined)'"
                        >
                          Apply Masks
                        </button>
                        <button
                          type="button"
                          data-action="add-mask"
                          style="${g({padding:"8px 14px",borderRadius:10,border:"1px solid var(--border-subtle)",background:"var(--bg-transparent)",color:"var(--text-secondary)",fontSize:12.5,fontWeight:600,cursor:"pointer",transition:"all 0.15s ease",textAlign:"left",width:"100%",marginTop:4})}"
                          onmouseover="this.style.borderColor='var(--border-medium)'; this.style.background='var(--bg-subtle)'"
                          onmouseout="this.style.borderColor='var(--border-subtle)'; this.style.background='var(--bg-transparent)'"
                        >
                          + Add Mask
                        </button>
                      </div>
                      `:`
                      <button
                        type="button"
                        data-action="add-mask"
                        style="${g({padding:"8px 14px",borderRadius:10,border:"1px solid var(--border-subtle)",background:"var(--bg-transparent)",color:"var(--text-secondary)",fontSize:12.5,fontWeight:600,cursor:"pointer",transition:"all 0.15s ease",textAlign:"left",width:"100%"})}"
                        onmouseover="this.style.borderColor='var(--border-medium)'; this.style.background='var(--bg-subtle)'"
                        onmouseout="this.style.borderColor='var(--border-subtle)'; this.style.background='var(--bg-transparent)'"
                      >
                        + Add Mask
                      </button>
                      `}
            </div>
          </div>
        </div>

                <div class="mode-pane-scrollable" style="${g(M.modePane)}">
                    <div data-role="compare-parameters" style="${g({display:"flex",flexDirection:"column",gap:14})}">
            <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${g(M.sectionTitle)}">Compare</div>
              <div style="${g(M.paramGrid)}">
                ${et("What do you want to compare?",ot("compareMode",["Scenarios","Models","Dates"],n.compareMode,{dataKey:"compareMode"}))}
              </div>

              ${n.compareMode==="Scenarios"?`
                      <div style="${g(M.paramGrid)}">
                        ${et("Scenario A",ot("compareScenarioA",["SSP245","SSP370","SSP585"],n.compareScenarioA,{dataKey:"compareScenarioA",infoType:"scenario"}))}
                        ${et("Scenario B",ot("compareScenarioB",["SSP245","SSP370","SSP585"],n.compareScenarioB,{dataKey:"compareScenarioB",infoType:"scenario"}))}
                      </div>
                    `:""}

              ${n.compareMode==="Models"?`
                      <div style="${g(M.paramGrid)}">
                        ${et("Model A",ot("compareModelA",(()=>{const s=ft.filter(l=>l!==n.compareModelB);return s.includes(n.compareModelA)?s:[n.compareModelA,...s]})(),n.compareModelA,{dataKey:"compareModelA",infoType:"model"}))}
                        ${et("Model B",ot("compareModelB",(()=>{const s=ft.filter(l=>l!==n.compareModelA);return s.includes(n.compareModelB)?s:[n.compareModelB,...s]})(),n.compareModelB,{dataKey:"compareModelB",infoType:"model"}))}
                      </div>
                    `:""}

              ${n.compareMode==="Dates"?`
                      <div style="${g(M.paramGrid)}">
                        ${et("Start date",Kt("compareDateStart",n.compareDateStart,{dataKey:"compareDateStart"}))}
                        ${et("End date",Kt("compareDateEnd",n.compareDateEnd,{dataKey:"compareDateEnd"}))}
  </div>
`:""}

              <div style="${g(M.paramGrid)}">
                ${i.join("")}
                ${et("Variable",ot("variable",Pt,n.variable,{infoType:"variable"}))}
              </div>

              <div style="margin-top:14px">
                <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
                  <div style="${g(M.sectionTitle)}">Unit</div>
                  ${et("",ot("unit",ne(n.variable).map(s=>s.label),n.selectedUnit,{dataKey:"unit"}))}
                </div>
              </div>

              <div style="margin-top:14px">
                <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
                  <div style="${g(M.sectionTitle)}">Color palette</div>
                  ${et("",ot("palette",ct.map(s=>s.name),n.palette,{dataKey:"palette"}))}
                </div>
              </div>

              <div style="margin-top:14px">
                <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
                  <div style="${g(M.sectionTitle)}">Resolution</div>
                  <div style="${g(M.resolutionRow)}">
                    <input
                      type="range"
                      min="1"
                      max="3"
                      step="1"
                      value="${n.resolution}"
                      data-action="set-resolution"
                      class="resolution-slider"
                      style="${g(pt(M.range,{"--slider-fill":`${a}%`}))}"
                    />
                    <div data-role="resolution-value" style="${g(M.resolutionValue)}">${n.resolution===1?"Low":n.resolution===2?"Medium":"High"}</div>
                  </div>
                </div>
              </div>

              <div style="margin-top:14px">
                <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
                  <div style="${g(M.sectionTitle)}">Mask</div>
                  ${n.masks.length>0?`
                          <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
                            ${n.masks.map((s,l)=>`
                              <div style="${g({display:"flex",alignItems:"center",gap:8})}">
                                ${n.mode==="Ensemble"?ot("maskStatistic",["mean","std","median","iqr","percentile","extremes"],s.statistic||"mean",{dataKey:"maskStatistic",selectedLabel:s.statistic==="mean"?"Mean":s.statistic==="std"?"Std":s.statistic==="median"?"Median":s.statistic==="iqr"?"IQR":s.statistic==="percentile"?"Percentile":s.statistic==="extremes"?"Extremes":"Mean"}).replace('data-key="maskStatistic"',`data-key="maskStatistic" data-mask-index="${l}"`).replace('class="custom-select-wrapper"',`class="custom-select-wrapper" data-mask-index="${l}"`):""}
                                <input
                                  type="number"
                                  step="any"
                                  value="${s.lowerEdited&&s.lowerBound!==null?s.lowerBound:""}"
                                  data-action="update-mask-bound"
                                  data-mask-index="${l}"
                                  data-bound="lower"
                                  placeholder="${n.dataMin!==null?n.dataMin.toFixed(2):""}"
                                  style="${g({width:"90px",background:"var(--gradient-bg)",border:"1px solid var(--border-strong)",borderRadius:8,color:"var(--text-primary)",padding:"6px 10px",fontSize:12.5,fontWeight:600,fontFamily:"var(--font-geist-sans)",letterSpacing:.25,minHeight:32,boxShadow:"inset 0 1px 0 var(--inset-light)"})}"
                                />
                                <span style="${g({fontSize:12.5,color:"var(--text-secondary)",minWidth:"20px",textAlign:"center"})}">to</span>
                                <input
                                  type="number"
                                  step="any"
                                  value="${s.upperEdited&&s.upperBound!==null?s.upperBound:""}"
                                  data-action="update-mask-bound"
                                  data-mask-index="${l}"
                                  data-bound="upper"
                                  placeholder="${n.dataMax!==null?n.dataMax.toFixed(2):""}"
                                  style="${g({width:"90px",background:"var(--gradient-bg)",border:"1px solid var(--border-strong)",borderRadius:8,color:"var(--text-primary)",padding:"6px 10px",fontSize:12.5,fontWeight:600,fontFamily:"var(--font-geist-sans)",letterSpacing:.25,minHeight:32,boxShadow:"inset 0 1px 0 var(--inset-light)"})}"
                                />
                                <button
                                  type="button"
                                  data-action="remove-mask"
                                  data-mask-index="${l}"
                                  style="${g({width:28,height:28,padding:0,borderRadius:6,border:"1px solid var(--border-medium)",background:"var(--bg-transparent)",color:"var(--text-secondary)",fontSize:16,fontWeight:600,cursor:"pointer",transition:"all 0.15s ease",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0})}"
                                  onmouseover="this.style.borderColor='var(--border-bright)'; this.style.background='var(--bg-medium)'"
                                  onmouseout="this.style.borderColor='var(--border-medium)'; this.style.background='var(--bg-transparent)'"
                                >
                                  −
                                </button>
                              </div>
                            `).join("")}
                            <button
                              type="button"
                              data-action="add-mask"
                              style="${g({padding:"8px 14px",borderRadius:10,border:"1px solid var(--border-subtle)",background:"var(--bg-transparent)",color:"var(--text-secondary)",fontSize:12.5,fontWeight:600,cursor:"pointer",transition:"all 0.15s ease",textAlign:"left",width:"100%",marginTop:4})}"
                              onmouseover="this.style.borderColor='var(--border-medium)'; this.style.background='var(--bg-subtle)'"
                              onmouseout="this.style.borderColor='var(--border-subtle)'; this.style.background='var(--bg-transparent)'"
                            >
                              + Add Mask
                            </button>
                          </div>
                          `:`
                          <button
                            type="button"
                            data-action="add-mask"
                            style="${g({padding:"8px 14px",borderRadius:10,border:"1px solid var(--border-subtle)",background:"var(--bg-transparent)",color:"var(--text-secondary)",fontSize:12.5,fontWeight:600,cursor:"pointer",transition:"all 0.15s ease",textAlign:"left",width:"100%"})}"
                            onmouseover="this.style.borderColor='var(--border-medium)'; this.style.background='var(--bg-subtle)'"
                            onmouseout="this.style.borderColor='var(--border-subtle)'; this.style.background='var(--bg-transparent)'"
                          >
                            + Add Mask
                          </button>
                          `}
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="mode-pane-scrollable" style="${g(M.modePane)}">
          <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
            <div style="${g(M.sectionTitle)}">Parameters</div>
            <div style="${g(M.paramGrid)}">
              ${et("Date",(()=>{const s=We(n.ensembleScenarios.length?n.ensembleScenarios:bt);return Kt("ensembleDate",n.ensembleDate,{dataKey:"ensembleDate",min:s.start,max:s.end})})())}
              ${et("Variable",ot("ensembleVariable",Pt,n.ensembleVariable,{dataKey:"ensembleVariable",infoType:"variable"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${g(M.sectionTitle)}">Statistic</div>
              ${et("",ot("ensembleStatistic",["mean","median","std","iqr","percentile","extremes"],n.ensembleStatistic,{dataKey:"ensembleStatistic",selectedLabel:n.ensembleStatistic==="mean"?"Mean":n.ensembleStatistic==="median"?"Median":n.ensembleStatistic==="std"?"Std Deviation":n.ensembleStatistic==="iqr"?"IQR (Interquartile Range)":n.ensembleStatistic==="percentile"?"Percentile Band (90th-10th)":"Extremes (Max-Min)"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            ${o("Scenarios",n.ensembleDropdown.scenariosOpen,`${n.ensembleScenarios.length} selected`,Fe(n.metaData?.scenarios?.length?Array.from(new Set(n.metaData.scenarios.map(De))):bt,n.ensembleScenarios,"ensembleScenarios"),"ensembleScenarios")}
          </div>

          <div style="margin-top:14px">
            ${o("Models",n.ensembleDropdown.modelsOpen,`${n.ensembleModels.length} selected`,Fe(n.metaData?.models?.length?n.metaData.models:ft,n.ensembleModels,"ensembleModels"),"ensembleModels")}
          </div>

          <div style="margin-top:14px">
            <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${g(M.sectionTitle)}">Unit</div>
              ${et("",ot("ensembleUnit",ne(n.ensembleVariable).map(s=>s.label),n.ensembleUnit,{dataKey:"ensembleUnit"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${g(M.sectionTitle)}">Color palette</div>
              ${et("",ot("palette",ct.map(s=>s.name),n.palette,{dataKey:"palette",dataRole:"palette-selector"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${g(M.sectionTitle)}">Resolution</div>
              <div style="${g(M.resolutionRow)}">
                <input
                  type="range"
                  min="1"
                  max="3"
                  step="1"
                  value="${n.resolution}"
                  data-action="set-resolution"
                  class="resolution-slider"
                  style="${g(pt(M.range,{"--slider-fill":`${a}%`}))}"
                />
                <div data-role="resolution-value" style="${g(M.resolutionValue)}">${n.resolution===1?"Low":n.resolution===2?"Medium":"High"}</div>
              </div>
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${g(M.sectionTitle)}">Mask</div>
              ${n.masks.length>0?`
                      <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
                        ${n.masks.map((s,l)=>`
                          ${n.mode==="Ensemble"?`
                                  <div style="${g({display:"flex",alignItems:"center",gap:8,marginBottom:4})}">
                                    ${ot("maskStatistic",["mean","std","median","iqr","percentile","extremes"],s.statistic||"mean",{dataKey:"maskStatistic",selectedLabel:s.statistic==="mean"?"Mean":s.statistic==="std"?"Std":s.statistic==="median"?"Median":s.statistic==="iqr"?"IQR":s.statistic==="percentile"?"Percentile":s.statistic==="extremes"?"Extremes":"Mean"}).replace('class="custom-select-wrapper"',`class="custom-select-wrapper" data-mask-index="${l}" style="width: 100px;"`)}
                                  </div>
                                  `:""}
                          <div style="${g({display:"flex",alignItems:"center",gap:8})}">
                            <input
                              type="number"
                              step="any"
                              value="${s.lowerEdited&&s.lowerBound!==null?s.lowerBound:""}"
                              data-action="update-mask-bound"
                              data-mask-index="${l}"
                              data-bound="lower"
                              placeholder="${n.dataMin!==null?n.dataMin.toFixed(2):""}"
                              style="${g({width:"90px",background:"var(--gradient-bg)",border:"1px solid var(--border-strong)",borderRadius:8,color:"var(--text-primary)",padding:"6px 10px",fontSize:12.5,fontWeight:600,fontFamily:"var(--font-geist-sans)",letterSpacing:.25,minHeight:32,boxShadow:"inset 0 1px 0 var(--inset-light)"})}"
                            />
                            <span style="${g({fontSize:12.5,color:"var(--text-secondary)",minWidth:"20px",textAlign:"center"})}">to</span>
                            <input
                              type="number"
                              step="any"
                              value="${s.upperEdited&&s.upperBound!==null?s.upperBound:""}"
                              data-action="update-mask-bound"
                              data-mask-index="${l}"
                              data-bound="upper"
                              placeholder="${n.dataMax!==null?n.dataMax.toFixed(2):""}"
                              style="${g({width:"90px",background:"var(--gradient-bg)",border:"1px solid var(--border-strong)",borderRadius:8,color:"var(--text-primary)",padding:"6px 10px",fontSize:12.5,fontWeight:600,fontFamily:"var(--font-geist-sans)",letterSpacing:.25,minHeight:32,boxShadow:"inset 0 1px 0 var(--inset-light)"})}"
                            />
                            <button
                              type="button"
                              data-action="remove-mask"
                              data-mask-index="${l}"
                              style="${g({width:28,height:28,padding:0,borderRadius:6,border:"1px solid var(--border-medium)",background:"var(--bg-transparent)",color:"var(--text-secondary)",fontSize:16,fontWeight:600,cursor:"pointer",transition:"all 0.15s ease",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0})}"
                              onmouseover="this.style.borderColor='var(--border-bright)'; this.style.background='var(--bg-medium)'"
                              onmouseout="this.style.borderColor='var(--border-medium)'; this.style.background='var(--bg-transparent)'"
                            >
                              −
                            </button>
                          </div>
                        `).join("")}
                        <button
                          type="button"
                          data-action="apply-masks"
                          style="${g({padding:"10px 16px",borderRadius:10,border:"1px solid var(--border-strong)",background:"var(--gradient-primary)",color:"white",fontSize:12.5,fontWeight:700,cursor:"pointer",transition:"all 0.15s ease",textAlign:"center",width:"100%",marginTop:8,boxShadow:"var(--shadow-combined)"})}"
                          onmouseover="this.style.borderColor='var(--accent-border-bright)'; this.style.boxShadow='var(--shadow-elevated)'"
                          onmouseout="this.style.borderColor='var(--border-strong)'; this.style.boxShadow='var(--shadow-combined)'"
                        >
                          Apply Masks
                        </button>
                        <button
                          type="button"
                          data-action="add-mask"
                          style="${g({padding:"8px 14px",borderRadius:10,border:"1px solid var(--border-subtle)",background:"var(--bg-transparent)",color:"var(--text-secondary)",fontSize:12.5,fontWeight:600,cursor:"pointer",transition:"all 0.15s ease",textAlign:"left",width:"100%",marginTop:4})}"
                          onmouseover="this.style.borderColor='var(--border-medium)'; this.style.background='var(--bg-subtle)'"
                          onmouseout="this.style.borderColor='var(--border-subtle)'; this.style.background='var(--bg-transparent)'"
                        >
                          + Add Mask
                        </button>
                      </div>
                      `:`
                      <button
                        type="button"
                        data-action="add-mask"
                        style="${g({padding:"8px 14px",borderRadius:10,border:"1px solid var(--border-subtle)",background:"var(--bg-transparent)",color:"var(--text-secondary)",fontSize:12.5,fontWeight:600,cursor:"pointer",transition:"all 0.15s ease",textAlign:"left",width:"100%"})}"
                        onmouseover="this.style.borderColor='var(--border-medium)'; this.style.background='var(--bg-subtle)'"
                        onmouseout="this.style.borderColor='var(--border-subtle)'; this.style.background='var(--bg-transparent)'"
                      >
                        + Add Mask
                      </button>
                      `}
            </div>
          </div>
        </div>
      </div>
    </div>
  `}function Fe(t,e,a){const r=new Set(e);return`
      <div style="${g(M.chipRow)}">
        ${t.map(o=>{const i=r.has(o);return`
                  <button
                    type="button"
                    data-action="toggle-multi"
                    data-key="${a}"
                    data-value="${o}"
                    style="${g(pt(M.chip,i?M.chipActive:void 0))}"
                  >
                    ${o}
                  </button>
                `}).join("")}
      </div>
    `}function mo(){const t=n.chartLocationSearchResults.length>0?n.chartLocationSearchResults.map(r=>`
                <button
                  type="button"
                  class="location-search-result"
                  data-role="location-search-result"
                  data-name="${Mt(r.displayName)}"
                  data-lat="${r.lat}"
                  data-lon="${r.lon}"
                >
                  <div class="location-search-result-name">${Mt(r.displayName)}</div>
                  <div class="location-search-result-coord">
                    ${r.lat.toFixed(3)}, ${r.lon.toFixed(3)}
                  </div>
                </button>
              `).join(""):"",e=n.chartLocationSearchQuery.trim().length>0,a=n.chartLocationSearchError?`<div class="location-search-error">${Mt(n.chartLocationSearchError)}</div>`:n.chartLocationSearchLoading?'<div class="location-search-status">Searching...</div>':n.chartLocationSearchResults.length===0&&e?'<div class="location-search-status">No places found. Try refining your query.</div>':"";return`
      <div class="custom-select-extra" data-role="chart-location-search">
        <div class="location-search-row">
          <input
            type="text"
            class="location-search-input"
            value="${Mt(n.chartLocationSearchQuery)}"
            placeholder="Search a place (e.g. Aachen)"
            data-role="location-search-input"
          />
        </div>
        ${a}
        <div class="location-search-results" data-role="location-search-results">
          ${t||""}
        </div>
      </div>
    `}function Pf(){if(n.canvasView!=="map")return"";const t=n.mapLocationSearchResults.length>0?n.mapLocationSearchResults.map(s=>`
                <button
                  type="button"
                  class="location-search-result"
                  data-role="map-location-search-result"
                  data-name="${Mt(s.displayName)}"
                  data-lat="${s.lat}"
                  data-lon="${s.lon}"
                >
                  <div class="location-search-result-name">${Mt(s.displayName)}</div>
                  <div class="location-search-result-coord">
                    ${s.lat.toFixed(3)}, ${s.lon.toFixed(3)}
                  </div>
                </button>
              `).join(""):"",e=n.mapLocationSearchQuery.trim().length>0,a=n.mapLocationSearchError?`<div class="location-search-error">${Mt(n.mapLocationSearchError)}</div>`:n.mapLocationSearchLoading?'<div class="location-search-status">Searching...</div>':n.mapLocationSearchResults.length===0&&e&&!n.mapLocationSearchSelection?'<div class="location-search-status">No places found. Try refining your query.</div>':"",r=!!(t||a&&!n.mapLocationSearchLoading),o=n.sidebarOpen?-$t/2:0,i=pt(M.mapSearchWrap,{top:18,transform:`translateX(calc(-50% + ${o}px))`});return`
      <div data-role="map-location-search" style="${g(i)}">
        <div class="location-search-row" style="display: flex; align-items: center; gap: 8px;">
          <input
            type="text"
            class="location-search-input"
            value="${Mt(n.mapLocationSearchQuery)}"
            placeholder="Search a place (e.g. Aachen)"
            data-role="map-location-search-input"
            style="flex: 1;"
          />
          <button
            type="button"
            data-action="toggle-map-draw"
            aria-label="${n.drawState.active?"Stop drawing":"Start drawing"}"
            style="
              display: flex;
              align-items: center;
              justify-content: center;
              width: 36px;
              height: 36px;
              padding: 0;
              border: 1px solid rgba(148, 163, 184, 0.3);
              border-radius: 6px;
              background: ${n.drawState.active?"rgba(52, 211, 153, 0.1)":"rgba(15, 23, 42, 0.85)"};
              color: ${n.drawState.active?"#34d399":"var(--text-secondary)"};
              cursor: pointer;
              transition: all 0.2s ease;
            "
            onmouseover="this.style.background='rgba(52, 211, 153, 0.2)';this.style.color='#34d399';"
            onmouseout="this.style.background='${n.drawState.active?"rgba(52, 211, 153, 0.1)":"rgba(15, 23, 42, 0.85)"}';this.style.color='${n.drawState.active?"#34d399":"var(--text-secondary)"}';"
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
          </button>
        </div>
        ${n.mapLocationSearchLoading?a:""}
        ${r?`
        ${n.mapLocationSearchLoading?"":a}
        <div
          class="location-search-results"
          data-role="map-location-search-results"
          style="${g(M.mapSearchResults)}"
        >
          ${t||""}
        </div>`:""}
      </div>
    `}function If(){console.log("Rendering chart section with state:",n);const t=n.chartMode==="single"?"translateX(0%)":"translateX(100%)",e=n.metaData?.scenarios?.length?Array.from(new Set(n.metaData.scenarios.map(De))):bt,a=n.metaData?.models?.length?n.metaData.models:ft,r=We(n.chartScenarios.length?n.chartScenarios:e),o=(l,c,d,u,h)=>`
          <div style="${g({border:"1px solid var(--border-medium)",borderRadius:12,background:"var(--bg-subtle)",padding:"10px 12px"})}">
            <button
              type="button"
              data-action="toggle-collapse"
              data-key="${h}"
              style="${g({display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",background:"transparent",border:"none",color:"var(--text-primary)",fontWeight:700,fontSize:13,cursor:"pointer",padding:0})}"
            >
              <span>${l}</span>
              <span style="${g({color:"var(--text-secondary)",fontWeight:600,fontSize:12})}">${d} ${c?"▴":"▾"}</span>
            </button>
            ${c?`<div style="${g({marginTop:10,display:"flex",flexWrap:"wrap",gap:8})}">${u}</div>`:""}
          </div>
        `,i=`
      <div style="${g(M.paramGrid)}">
        ${et("Date",Kt("chartDate",n.chartDate,{dataKey:"chartDate",min:r.start,max:r.end}))}
        ${et("Variable",ot("chartVariable",Pt,n.chartVariable,{dataKey:"chartVariable",infoType:"variable"}))}
      </div>
    
      <div style="margin-top:10px">
        ${et("Location",ot("chartLocation",["World","Draw","Point"],n.chartLocation,{dataKey:"chartLocation",selectedLabel:n.chartLocation==="Search"&&n.chartLocationName?`Search: ${n.chartLocationName}`:n.chartLocation,extraContent:mo()}))}
      </div>

      <div style="margin-top:14px">
        ${o("Scenarios",n.chartDropdown.scenariosOpen,`${n.chartScenarios.length} selected`,Fe(e,n.chartScenarios,"chartScenarios"),"chartScenarios")}
      </div>

      <div style="margin-top:14px">
        ${o("Models",n.chartDropdown.modelsOpen,`${n.chartModels.length} selected`,Fe(a,n.chartModels,"chartModels"),"chartModels")}
      </div>

      <div style="margin-top:14px">
        <div style="${g(M.sectionTitle)}">Unit</div>
        ${et("",ot("chartUnit",ne(n.chartVariable).map(l=>l.label),n.chartUnit,{dataKey:"chartUnit"}))}
      </div>
    `,s=`
      <div style="${g(M.paramGrid)}">
        ${et("Start date",Kt("chartRangeStart",n.chartRangeStart,{dataKey:"chartRangeStart",min:r.start,max:r.end}))}
        ${et("End date",Kt("chartRangeEnd",n.chartRangeEnd,{dataKey:"chartRangeEnd",min:r.start,max:r.end}))}
      </div>

      <div style="${g(pt(M.paramGrid,{marginTop:12}))}">
        ${et("Variable",ot("chartVariable",Pt,n.chartVariable,{dataKey:"chartVariable",infoType:"variable"}))}
      </div>

      <div style="margin-top:10px">
        ${et("Location",ot("chartLocation",["World","Draw","Point"],n.chartLocation,{dataKey:"chartLocation",selectedLabel:n.chartLocation==="Search"&&n.chartLocationName?`Search: ${n.chartLocationName}`:n.chartLocation,extraContent:mo()}))}
      </div>

      <div style="margin-top:14px">
        ${o("Scenarios",n.chartDropdown.scenariosOpen,`${n.chartScenarios.length} selected`,Fe(e,n.chartScenarios,"chartScenarios"),"chartScenarios")}
      </div>

      <div style="margin-top:14px">
        ${o("Models",n.chartDropdown.modelsOpen,`${n.chartModels.length} selected`,Fe(a,n.chartModels,"chartModels"),"chartModels")}
      </div>

      <div style="margin-top:14px">
        <div style="${g(M.sectionTitle)}">Unit</div>
        ${et("",ot("chartUnit",ne(n.chartVariable).map(l=>l.label),n.chartUnit,{dataKey:"chartUnit"}))}
      </div>
    `;return`
      <div style="${g(M.modeSwitch)}">
        <div data-role="chart-mode-indicator" style="${g({...M.modeIndicator,transform:t})}"></div>
        ${["single","range"].map(l=>{const c=l==="single"?"Single dates":"Range";return`
              <button
                type="button"
                class="mode-btn"
                data-action="set-chart-mode"
                data-value="${l}"
                style="${g(pt(M.modeBtn,n.chartMode===l?M.modeBtnActive:void 0))}"
              >
                ${c}
              </button>
            `}).join("")}
      </div>

      <div class="mode-pane-scrollable" style="${g(M.modePane)}">
        ${n.chartMode==="single"?i:s}
      </div>
    `}function Af(){return`
    <div data-role="chat-section" style="${g({display:"flex",flexDirection:"column",gap:8})}">
      <div style="${g(M.sectionTitle)}">Chat</div>
      ${dh(n.chatMessages,n.chatInput)}
    </div>
  `}function go(t,e,a){const r=Math.hypot(t,e);if(!r||!isFinite(r)||a<=0)return{x:0,y:0};const o=Math.min(1,a/r);return{x:t*o,y:e*o}}function Rf(t){Dn&&(Dn(),Dn=null),fe!==null&&(cancelAnimationFrame(fe),fe=null),ie!==null&&(cancelAnimationFrame(ie),ie=null),pe!==null&&(clearTimeout(pe),pe=null),Yt!==null&&(clearTimeout(Yt),Yt=null);const e=t.querySelector('[data-role="brand-eye"]');if(!e)return;let a={x:0,y:0},r={x:0,y:0},o={x:0,y:0},i={x:0,y:0},s=1,l=!1;const c=3e4,d=(v,T)=>{const C=e.getBoundingClientRect(),k=C.left+C.width/2,S=C.top+C.height/2,P=v-k,V=T-S,W=Math.min(C.width,C.height)*.14,q=W*.6;a=go(P,V,W),r=go(P,V,q)},u=v=>{s=Math.max(0,Math.min(1,v)),e.style.setProperty("--blink-open",`${s}`)},h=()=>{Yt!==null&&clearTimeout(Yt),Yt=window.setTimeout(()=>{a={x:0,y:0},r={x:0,y:0}},c)},f=()=>{o.x+=(a.x-o.x)*.28,o.y+=(a.y-o.y)*.28,i.x+=(r.x-i.x)*.32,i.y+=(r.y-i.y)*.32,e.style.setProperty("--iris-x",`${o.x}px`),e.style.setProperty("--iris-y",`${o.y}px`),e.style.setProperty("--pupil-x",`${i.x}px`),e.style.setProperty("--pupil-y",`${i.y}px`),fe=requestAnimationFrame(f)},p=()=>{if(l)return;l=!0;const v=[{t:0,v:1},{t:.16,v:.08},{t:.26,v:.02},{t:.4,v:1}],T=350,C=performance.now(),k=S=>{const P=S-C,V=Math.min(1,P/T);let H=v[0],W=v[v.length-1];for(let B=0;B<v.length-1;B++){const _=v[B],m=v[B+1];if(V>=_.t&&V<=m.t){H=_,W=m;break}}const q=W.t-H.t||1,j=Math.min(1,Math.max(0,(V-H.t)/q)),O=1-Math.pow(1-j,2),y=H.v+(W.v-H.v)*O;u(y),V<1?ie=requestAnimationFrame(k):(u(1),l=!1,w())};ie=requestAnimationFrame(k)},w=()=>{const v=3e3+Math.random()*15e3;pe=window.setTimeout(p,v)},L=()=>{const v=e.getBoundingClientRect();d(v.left+v.width/2,v.top+v.height/2)},$=v=>{d(v.clientX,v.clientY),h()},x=()=>L();L(),f(),w(),h(),window.addEventListener("pointermove",$),window.addEventListener("pointerleave",x),Dn=()=>{window.removeEventListener("pointermove",$),window.removeEventListener("pointerleave",x),fe!==null&&(cancelAnimationFrame(fe),fe=null),ie!==null&&(cancelAnimationFrame(ie),ie=null),pe!==null&&(clearTimeout(pe),pe=null),Yt!==null&&(clearTimeout(Yt),Yt=null)}}function Nf(t){if(!nt)return;const e=nt;Rf(e),e.querySelectorAll('[data-action="update-mask-bound"]').forEach(m=>{m.__isMaskInput=!0;const b=D=>{D&&(D.stopPropagation(),D.preventDefault(),D.stopImmediatePropagation());const R=m.dataset.bound,F=m.dataset.maskIndex;if(!R||F===void 0)return;const E=Number.parseInt(F,10);if(Number.isNaN(E)||E<0||E>=n.masks.length)return;const I=m.value.trim(),U=I===""?null:Number.parseFloat(I);if(I===""||!Number.isNaN(U)){const X=n.masks[E];let K=!1;R==="lower"?X.lowerBound!==U&&(X.lowerBound=U,X.lowerEdited=I!=="",K=!0):X.upperBound!==U&&(X.upperBound=U,X.upperEdited=I!=="",K=!0),K&&(n.__updatingMask=!0,z(),setTimeout(()=>{n.__updatingMask=!1},0))}};m.addEventListener("blur",D=>{b(D)},{capture:!0}),m.addEventListener("keydown",D=>{D.key==="Enter"&&(D.preventDefault(),D.stopPropagation(),D.stopImmediatePropagation(),b(D),m.blur())},{capture:!0})}),fh({root:e,getSidebarOpen:()=>n.sidebarOpen,setSidebarOpen:m=>{n.sidebarOpen=m},onTimeSliderUpdate:m=>{Hh(m,$t)},onCanvasToggleUpdate:m=>{const b=n.sidebarOpen?1:.9;yi(m+8,b),xi()}}),e.querySelectorAll('[data-action="set-canvas"]').forEach(m=>m.addEventListener("click",()=>{const b=m.dataset.value;if(b){if(b===n.canvasView)return;const R=n.canvasView==="map"?"translateX(0%)":"translateX(100%)",F=b==="map"?"translateX(0%)":"translateX(100%)";n.canvasView=b,b==="chart"&&(n.panelTab="Manual");const E=jt();E.active&&E.currentStep===13&&b==="chart"&&ye(),z(),b==="map"?Lt():qt();const I=e.querySelector('[data-role="canvas-indicator"]');if(!I)return;I.style.removeProperty("transition"),I.style.transform=R,I.offsetHeight,I.getBoundingClientRect(),requestAnimationFrame(()=>{I.style.transition="transform 180ms ease",I.style.transform=F})}})),e.querySelectorAll('[data-action="set-mode"]').forEach(m=>m.addEventListener("click",()=>{const b=m.dataset.value;if(b){if(b===n.mode)return;const D=n.mode,R=D==="Explore"?"translateX(0%)":D==="Compare"?"translateX(-33.333%)":"translateX(-66.666%)",F=D==="Explore"?"translateX(0%)":D==="Compare"?"translateX(100%)":"translateX(200%)",E=b==="Explore"?"translateX(0%)":b==="Compare"?"translateX(-33.333%)":"translateX(-66.666%)",I=b==="Explore"?"translateX(0%)":b==="Compare"?"translateX(100%)":"translateX(200%)";n.mode=b;const U=jt();U.active&&U.currentStep===9&&b==="Compare"&&ye(),z();const X=e.querySelector('[data-role="mode-track"]'),K=e.querySelector('[data-role="mode-indicator"]');if(!X||!K)return;X.style.transition="none",K.style.transition="none",X.style.transform=R,K.style.transform=F,X.offsetHeight,X.style.transition="transform 220ms ease",K.style.transition="transform 200ms ease",X.style.transform=E,K.style.transform=I}n.canvasView==="map"&&Lt()})),e.querySelectorAll('[data-action="set-chart-mode"]').forEach(m=>m.addEventListener("click",()=>{const b=m.dataset.value;if(!b||b===n.chartMode)return;const R=n.chartMode==="single"?"translateX(0%)":"translateX(100%)",F=b==="single"?"translateX(0%)":"translateX(100%)";n.chartMode=b,z();const E=e.querySelector('[data-role="chart-mode-indicator"]');E&&(E.style.removeProperty("transition"),E.style.transform=R,E.offsetHeight,requestAnimationFrame(()=>{E.style.transition="transform 200ms ease",E.style.transform=F})),n.canvasView==="chart"&&qt()})),e.querySelectorAll('[data-action="set-tab"]').forEach(m=>m.addEventListener("click",()=>{const b=m.dataset.value;if(b){if(b===n.panelTab)return;const R=n.panelTab==="Manual"?"translateX(0%)":"translateX(-50%)",F=b==="Manual"?"translateX(0%)":"translateX(-50%)";n.panelTab=b;const E=jt();E.active&&E.currentStep===11&&b==="Chat"&&ye(),z();const I=e.querySelector('[data-role="tab-track"]');if(!I)return;I.style.removeProperty("transition"),I.style.transform=R,I.offsetHeight,I.getBoundingClientRect(),requestAnimationFrame(()=>{I.style.transition="transform 220ms ease",I.style.transform=F})}}));const l=e.querySelectorAll(".custom-select-wrapper");let c=document.querySelector(".custom-select-info-panel-shared");c||(c=document.createElement("div"),c.className="custom-select-info-panel custom-select-info-panel-shared",c.setAttribute("role","tooltip"),document.body.appendChild(c));const d=m=>{m.target.closest(".custom-select-wrapper")||(l.forEach(D=>{D.classList.remove("open")}),c&&c.classList.remove("visible"))},u=m=>{m.key==="Escape"&&(l.forEach(b=>{b.classList.remove("open")}),c&&c.classList.remove("visible"))};document.addEventListener("click",d),document.addEventListener("keydown",u),l.forEach(m=>{const b=m.querySelector(".custom-select-trigger"),D=m.querySelector(".custom-select-dropdown"),R=m.querySelectorAll(".custom-select-option"),F=m.dataset.key,E=m.dataset.infoType,I=m.dataset.disabled==="true";if(!b||!D||I)return;const U=c,X=(Q,N)=>{if(!U||!E)return;let Y="",G=Q;if(E==="scenario"?Y=Xh[Q]||"":E==="variable"?(Y=Kh[Q]||"",G=jh[Q]||Q):E==="model"&&(Y=Gh[Q]||""),Y){if(U.innerHTML=`
                    <div class="custom-select-info-panel-title">${G}</div>
                    <div class="custom-select-info-panel-content">${Y}</div>
                `,N||b){const A=N||b;if(A){const it=A.getBoundingClientRect();U.style.left=`${it.left-272}px`,U.style.top=`${it.top}px`}}U.classList.add("visible")}},K=()=>{U&&U.classList.remove("visible")};b.addEventListener("click",Q=>{if(Q.stopPropagation(),I)return;const N=m.classList.contains("open");l.forEach(G=>{G!==m&&G.classList.remove("open")}),m.classList.toggle("open",!N),jt().active&&setTimeout(()=>{z()},50)}),b.addEventListener("keydown",Q=>{if(!I&&(Q.key==="Enter"||Q.key===" "||Q.key==="ArrowDown")){Q.preventDefault(),m.classList.add("open");const N=R[0];N&&N.focus()}}),R.forEach(Q=>{Q.addEventListener("click",N=>{N.stopPropagation();const Y=Q.dataset.value;if(!Y||!F)return;R.forEach(at=>{at.classList.remove("selected"),at.removeAttribute("aria-selected")}),Q.classList.add("selected"),Q.setAttribute("aria-selected","true");const G=b.querySelector(".custom-select-value");G&&(G.textContent=Y),m.classList.remove("open"),K();const A=m.dataset.maskIndex;h(F,Y,A);const it=jt();it.active&&{1:"scenario",2:"model",4:"variable",5:"unit",6:"palette"}[it.currentStep]===F&&setTimeout(()=>{ye(),z()},100)}),E&&(Q.addEventListener("mouseenter",()=>{const N=Q.dataset.value;N&&X(N,Q)}),Q.addEventListener("mouseleave",()=>{K()})),Q.addEventListener("keydown",N=>{const Y=Array.from(R).indexOf(Q);if(N.key==="Enter"||N.key===" ")N.preventDefault(),Q.click();else if(N.key==="ArrowDown"){N.preventDefault();const G=(Y+1)%R.length;R[G]?.focus()}else if(N.key==="ArrowUp"){N.preventDefault();const G=Y===0?R.length-1:Y-1;R[G]?.focus()}else N.key==="Escape"?(N.preventDefault(),m.classList.remove("open"),K(),b.focus()):N.key==="Home"?(N.preventDefault(),R[0]?.focus()):N.key==="End"&&(N.preventDefault(),R[R.length-1]?.focus())})}),new MutationObserver(Q=>{Q.forEach(N=>{N.type==="attributes"&&N.attributeName==="class"&&(m.classList.contains("open")||K())})}).observe(m,{attributes:!0})});const h=async(m,b,D)=>{if(!m)return;let R=!1,F=!1;switch(m){case"scenario":n.scenario=b,n.date=ef(b),n.ensembleDate=n.date,n.timeRange=Nt(b),R=!0;break;case"model":n.model=b,R=!0;break;case"variable":n.variable=b,n.selectedUnit=Se(b).label,R=!0;break;case"unit":if(n.selectedUnit=b,z(),n.currentData&&nt&&n.dataMin!==null&&n.dataMax!==null){const E=nt.querySelector("#map-canvas");if(E){vt=E,aa(E),Bn(n.currentData,vt,ct,n.palette,n.dataMin,n.dataMax,n.variable,n.selectedUnit,n.masks,null,!1);const I=ct.find(U=>U.name===n.palette)||ct[0];An("legend-gradient-canvas",I.colors)}}n.mapMarker&&n.mapInfoOpen&&(n.mapInfoSamples.length?(n.mapInfoBoxes=un(n.mapInfoSamples,n.variable,n.selectedUnit),z()):n.mapInfoLoading||Ne());return;case"palette":if(n.palette=b,z(),n.canvasView==="map"&&n.currentData&&nt&&n.dataMin!==null&&n.dataMax!==null){const E=nt.querySelector("#map-canvas");if(E){vt=E,Bn(n.currentData,vt,ct,n.palette,n.dataMin,n.dataMax,n.variable,n.selectedUnit,n.masks,null,!1);const I=ct.find(U=>U.name===n.palette)||ct[0];An("legend-gradient-canvas",I.colors)}}return;case"compareMode":n.compareMode=b,R=!0;break;case"compareScenarioA":b===n.compareScenarioB&&(n.compareScenarioB=n.compareScenarioA),n.compareScenarioA=b,R=!0;break;case"compareScenarioB":b===n.compareScenarioA&&(n.compareScenarioA=n.compareScenarioB),n.compareScenarioB=b,R=!0;break;case"compareModelA":b===n.compareModelB&&(n.compareModelB=n.compareModelA),n.compareModelA=b,R=!0;break;case"compareModelB":b===n.compareModelA&&(n.compareModelA=n.compareModelB),n.compareModelB=b,R=!0;break;case"chartVariable":n.chartVariable=b,n.chartUnit=Se(b).label,F=!0;break;case"chartUnit":n.chartUnit=b,n.chartSamples.length&&(n.chartMode==="range"?(n.chartRangeSeries=Vn(n.chartSamples,n.chartVariable,n.chartUnit),n.chartBoxes=null):n.chartBoxes=un(n.chartSamples,n.chartVariable,n.chartUnit)),z();return;case"ensembleVariable":n.ensembleVariable=b,n.ensembleUnit=Se(b).label,R=!0;break;case"ensembleUnit":if(n.ensembleUnit=b,z(),n.currentData&&nt&&n.dataMin!==null&&n.dataMax!==null&&n.mode==="Ensemble"){const E=nt.querySelector("#map-canvas");if(E){vt=E,aa(E),Bn(n.currentData,vt,ct,n.palette,n.dataMin,n.dataMax,n.ensembleVariable,n.ensembleUnit,n.masks,n.ensembleStatistics,!0);const I=ct.find(U=>U.name===n.palette)||ct[0];An("legend-gradient-canvas",I.colors)}}return;case"ensembleStatistic":n.ensembleStatistic=b,R=!0;break;case"maskStatistic":{if(D!==void 0){const E=Number.parseInt(D,10);!Number.isNaN(E)&&E>=0&&E<n.masks.length&&(n.masks[E].statistic=b,z())}return}case"chartLocation":if(b==="Draw"){oo();return}if(b==="Point"){io();return}if(b==="Search"){n.chartLocation="Search",n.chartPolygon=null,n.pointSelectActive=!1,n.drawState=he(),n.chartError=null,n.chartLocationName=null,n.chartLocationSearchError=null,n.chartLocationSearchResults=[],n.chartLocationSearchQuery="",n.chartLocationSearchLoading=!1,n.canvasView="chart",oa(),ia(),z();return}n.chartLocation="World",n.chartPolygon=null,n.chartPoint=null,n.chartLocationName=null,n.chartLocationSearchError=null,n.chartLocationSearchResults=[],n.chartLocationSearchQuery="",n.chartLocationSearchLoading=!1,oa(),ia(),F=!0;break}if(z(),n.canvasView==="map"&&R){Lt();const E=n.mapMarker!==null,I=n.mapPolygon!==null&&n.mapPolygon.length>=3;(E||I)&&n.mapInfoOpen&&Ne()}n.canvasView==="chart"&&(F||R)&&qt()},f=e.querySelector('.custom-select-wrapper[data-key="chartLocation"]');if(f){let m=function(){const I=nt?.querySelector('.custom-select-wrapper[data-key="chartLocation"]');if(!I)return;const U=I.querySelector('[data-role="location-search-input"]');U&&(U.value=n.chartLocationSearchQuery);const X=I.querySelector('[data-role="location-search-results-container"]');if(X){if(X.innerHTML="",n.chartLocationSearchLoading)X.innerHTML='<div class="search-loading">Loading...</div>';else if(n.chartLocationSearchError)X.innerHTML=`<div class="search-error">${n.chartLocationSearchError}</div>`;else if(n.chartLocationSearchResults.length>0)for(const K of n.chartLocationSearchResults){const Z=document.createElement("div");Z.className="custom-select-option search-result",Z.setAttribute("data-role","location-search-result"),Z.setAttribute("data-lat",String(K.lat)),Z.setAttribute("data-lon",String(K.lon)),Z.setAttribute("data-name",K.displayName||"Selected place"),Z.textContent=K.displayName||`${K.lat}, ${K.lon}`,Z.addEventListener("click",()=>{I.classList.remove("open"),so({displayName:K.displayName||"Selected place",lat:K.lat,lon:K.lon})}),X.appendChild(Z)}}};f.querySelectorAll(".custom-select-option").forEach(I=>{I.addEventListener("click",()=>{const U=I.dataset.value;U==="Draw"&&n.chartLocation==="Draw"?oo():U==="Point"&&n.chartLocation==="Point"&&io()})});const D=f.querySelectorAll('[data-role="location-search-input"]'),R=f.querySelectorAll('[data-role="location-search-result"]'),F=()=>{be!==null&&(window.clearTimeout(be),be=null)},E=I=>{F(),hf(I)};if(D.forEach(I=>{I.addEventListener("input",()=>{const U=n.chartLocationSearchResults.length>0,X=n.chartLocationSearchLoading,K=!!n.chartLocationSearchError;if(n.chartLocationSearchQuery=I.value,n.chartLocationSearchError=null,F(),!I.value.trim()){n.chartLocationSearchResults=[],n.chartLocationSearchLoading=!1,m();return}(U||X||K)&&(n.chartLocationSearchResults=[],n.chartLocationSearchLoading=!1,m()),be=window.setTimeout(()=>{E(I.value)},ao)}),I.addEventListener("keydown",U=>{U.key==="Enter"&&(U.preventDefault(),F(),E(I.value))})}),R.forEach(I=>{I.addEventListener("click",()=>{const U=Number(I.dataset.lat),X=Number(I.dataset.lon),K=I.dataset.name??"Selected place";!Number.isFinite(U)||!Number.isFinite(X)||(f.classList.remove("open"),so({displayName:K,lat:U,lon:X}))})}),n.chartLocation==="Search"){const I=f.querySelector('[data-role="location-search-input"]');I&&setTimeout(()=>I.focus(),0)}}const p=e.querySelectorAll('[data-role="map-location-search-input"]'),w=e.querySelectorAll('[data-role="map-location-search-result"]'),L=()=>{xe!==null&&(window.clearTimeout(xe),xe=null)},$=m=>{L(),pf(m)};if(p.forEach(m=>{m.addEventListener("focus",()=>{n.mapLocationSearchFocused=!0});const b=()=>{const D=m.selectionStart??m.value.length,R=m.selectionEnd??m.value.length;n.mapLocationSearchCursor={start:D,end:R}};m.addEventListener("input",()=>{const D=n.mapLocationSearchResults.length>0,R=n.mapLocationSearchLoading,F=!!n.mapLocationSearchError;if(n.mapLocationSearchQuery=m.value,n.mapLocationSearchError=null,n.mapLocationSearchSelection=null,n.mapLocationSearchFocused=!0,b(),L(),!m.value.trim()){n.mapLocationSearchResults=[],n.mapLocationSearchLoading=!1,z();return}(D||R||F)&&(n.mapLocationSearchResults=[],n.mapLocationSearchLoading=!1,z()),xe=window.setTimeout(()=>{$(m.value)},ao)}),m.addEventListener("keyup",b),m.addEventListener("click",b),m.addEventListener("select",b),m.addEventListener("keydown",D=>{D.key==="Enter"&&(D.preventDefault(),L(),$(m.value))})}),w.forEach(m=>{m.addEventListener("click",()=>{const b=Number(m.dataset.lat),D=Number(m.dataset.lon),R=m.dataset.name??"Selected place";!Number.isFinite(b)||!Number.isFinite(D)||ff({displayName:R,lat:b,lon:D})})}),n.mapLocationSearchFocused){const m=e.querySelector('[data-role="map-location-search-input"]');if(m){setTimeout(()=>m.focus(),0);const{start:b,end:D}=n.mapLocationSearchCursor,R=Math.min(b,m.value.length),F=Math.min(D,m.value.length);setTimeout(()=>m.setSelectionRange(R,F),0)}}e.querySelectorAll('select[data-action="update-select"]').forEach(m=>m.addEventListener("change",async()=>{const b=m.dataset.key,D=m.value;b&&await h(b,D)})),e.querySelectorAll('[data-action="toggle-multi"]').forEach(m=>m.addEventListener("click",()=>{const b=m.dataset.key,D=m.dataset.value;if(!(!b||!D)){if(b==="chartScenarios"){const R=n.metaData?.scenarios?.length&&n.metaData.scenarios?Array.from(new Set(n.metaData.scenarios.map(De))):bt,F=D==="Historical",E=new Set(n.chartScenarios);E.has(D)?E.delete(D):F?(E.clear(),E.add("Historical")):(E.delete("Historical"),E.add(D)),E.size===0&&E.add(F?"Historical":D),n.chartScenarios=Array.from(E).filter(U=>R.includes(U));const I=We(n.chartScenarios);n.chartDate=St(n.chartDate,I),n.chartRangeStart=St(n.chartRangeStart,I),n.chartRangeEnd=St(n.chartRangeEnd,I)}if(b==="chartModels"){const R=n.metaData?.models?.length&&n.metaData.models?n.metaData.models:ft,F=new Set(n.chartModels);F.has(D)?F.delete(D):F.add(D),n.chartModels=F.size?Array.from(F):[...R]}if(b==="ensembleScenarios"){const R=n.metaData?.scenarios?.length&&n.metaData.scenarios?Array.from(new Set(n.metaData.scenarios.map(De))):bt,F=D==="Historical",E=new Set(n.ensembleScenarios);E.has(D)?E.delete(D):F?(E.clear(),E.add("Historical")):(E.delete("Historical"),E.add(D)),E.size===0&&E.add(F?"Historical":D),n.ensembleScenarios=Array.from(E).filter(U=>R.includes(U));const I=We(n.ensembleScenarios);n.ensembleDate=St(n.ensembleDate,I)}if(b==="ensembleModels"){const R=n.metaData?.models?.length?n.metaData.models:ft,F=new Set(n.ensembleModels);F.has(D)?F.delete(D):F.add(D),n.ensembleModels=F.size?Array.from(F):[...R]}z(),n.canvasView==="chart"?qt():n.canvasView==="map"&&n.mode==="Ensemble"&&Lt()}})),e.querySelectorAll('[data-action="toggle-collapse"]').forEach(m=>m.addEventListener("click",()=>{const b=m.dataset.key;b&&(b==="chartScenarios"&&(n.chartDropdown.scenariosOpen=!n.chartDropdown.scenariosOpen),b==="chartModels"&&(n.chartDropdown.modelsOpen=!n.chartDropdown.modelsOpen),b==="ensembleScenarios"&&(n.ensembleDropdown.scenariosOpen=!n.ensembleDropdown.scenariosOpen),b==="ensembleModels"&&(n.ensembleDropdown.modelsOpen=!n.ensembleDropdown.modelsOpen),z())})),e.querySelectorAll('[data-action="update-input"]').forEach(m=>{let b=!1,D=null;const R=()=>{const E=m.value;!(/^\d{4}-\d{2}-\d{2}$/.test(E)&&!isNaN(new Date(E).getTime()))&&E.length>0?m.style.borderColor="rgba(239, 68, 68, 0.6)":m.style.borderColor=""},F=()=>{const E=m.dataset.key;if(!E)return;const I=m.value;if(!(/^\d{4}-\d{2}-\d{2}$/.test(I)&&!isNaN(new Date(I).getTime()))){const Y=E==="date"?n.date:E==="compareDateStart"?n.compareDateStart:E==="compareDateEnd"?n.compareDateEnd:E==="chartRangeStart"?n.chartRangeStart:E==="chartRangeEnd"?n.chartRangeEnd:n.chartDate;m.value=Y,m.style.borderColor="";return}m.style.borderColor="";let Z=I;if(E==="date"&&(Z=Re(I,n.scenario),Z!==I&&(m.value=Z)),(E==="date"?n.date:E==="compareDateStart"?n.compareDateStart:E==="compareDateEnd"?n.compareDateEnd:E==="chartRangeStart"?n.chartRangeStart:E==="chartRangeEnd"?n.chartRangeEnd:n.chartDate)===Z)return;switch(E){case"date":n.date=Z,n.ensembleDate=Z;break;case"compareDateStart":n.compareDateStart=I;break;case"compareDateEnd":n.compareDateEnd=I;break;case"chartDate":n.chartDate=I;break;case"chartRangeStart":n.chartRangeStart=I;break;case"chartRangeEnd":n.chartRangeEnd=I;break;case"ensembleDate":n.ensembleDate=I;break}const N=jt();if(E==="date"&&N.active&&N.currentStep===3&&setTimeout(()=>{ye(),z()},100),z(),E==="date"||n.mode==="Compare"&&(E==="compareDateStart"||E==="compareDateEnd")||n.mode==="Ensemble"&&E==="ensembleDate"){Lt();const Y=n.mapMarker!==null,G=n.mapPolygon!==null&&n.mapPolygon.length>=3;(Y||G)&&n.mapInfoOpen&&Ne()}n.canvasView==="chart"&&(E==="chartDate"||E==="chartRangeStart"||E==="chartRangeEnd")&&qt()};m.addEventListener("input",()=>{b=!0,R(),D!==null&&window.clearTimeout(D),D=window.setTimeout(()=>{b=!1},300)}),m.addEventListener("blur",E=>{E.target.__isMaskInput||(b=!1,D!==null&&(window.clearTimeout(D),D=null),F())}),m.addEventListener("keydown",E=>{E.key==="Enter"&&(E.preventDefault(),b=!1,D!==null&&(window.clearTimeout(D),D=null),F(),m.blur())}),m.addEventListener("change",()=>{b||F()})});const k=e.querySelectorAll('[data-action="set-resolution"]'),S=e.querySelectorAll('[data-role="resolution-value"]'),P=m=>{const b=(m-1)/2*100,D=m===1?"Low":m===2?"Medium":"High";k.forEach(R=>{R.value=String(m),R.style.setProperty("--slider-fill",`${b}%`)}),S.forEach(R=>{R.textContent=D})};k.forEach(m=>m.addEventListener("input",()=>{const b=Number.parseInt(m.value,10);Number.isNaN(b)||(n.resolution=b,P(b),n.canvasView==="map"&&Lt())})),e.querySelectorAll('[data-action="add-mask"]').forEach(m=>{m.addEventListener("click",()=>{const b={lowerBound:n.dataMin,upperBound:n.dataMax,lowerEdited:!1,upperEdited:!1};n.mode==="Ensemble"&&(b.statistic="mean"),n.masks.push(b),z()})}),e.querySelectorAll('[data-action="remove-mask"]').forEach(m=>{m.addEventListener("click",()=>{const b=m.dataset.maskIndex;if(b===void 0)return;const D=Number.parseInt(b,10);!Number.isNaN(D)&&D>=0&&D<n.masks.length&&(n.masks.splice(D,1),z())})}),e.querySelector('[data-action="apply-masks"]')?.addEventListener("click",()=>{n.canvasView==="map"&&Lt()}),e.querySelector('[data-action="open-compare-info"]')?.addEventListener("click",()=>{n.compareInfoOpen=!0,z()}),e.querySelectorAll('[data-action="close-compare-info"]').forEach(m=>m.addEventListener("click",()=>{n.compareInfoOpen=!1,z()})),e.querySelector('[data-action="close-map-info"]')?.addEventListener("click",m=>{m.preventDefault(),yf()}),e.querySelector('[data-action="open-map-info-chart"]')?.addEventListener("click",m=>{m.preventDefault(),!(!n.mapMarker&&!n.mapPolygon)&&(n.canvasView="chart",n.chartMode="single",n.mapPolygon&&n.mapPolygon.length>=3?(n.chartLocation="Draw",n.chartPolygon=n.mapPolygon,n.chartPoint=null,n.chartLocationName=null):n.mapMarker&&(n.chartLocation="Point",n.chartPoint={lat:n.mapMarker.lat,lon:n.mapMarker.lon},n.chartLocationName=n.mapMarker.name??null,n.chartPolygon=null),n.chartVariable=n.variable,n.chartUnit=n.selectedUnit,n.chartDate=n.date,n.chartError=null,z(),qt())}),e.querySelector('[data-action="toggle-map-draw"]')?.addEventListener("click",m=>{m.preventDefault(),n.drawState.active?df():cf()}),zh({root:e,getTimeRange:()=>n.timeRange,onDateChange:m=>{n.date=m,n.ensembleDate=m,Lt();const b=n.mapMarker!==null,D=n.mapPolygon!==null&&n.mapPolygon.length>=3;(b||D)&&n.mapInfoOpen&&Ne()},getMode:()=>n.mode,getCompareMode:()=>n.compareMode,getCompareDates:()=>({start:n.compareDateStart,end:n.compareDateEnd}),onDateRangeChange:(m,b)=>{n.compareDateStart=m,n.compareDateEnd=b,Lt()}});const _={mode:n.mode,canvasView:n.canvasView,selectedVariable:n.variable,selectedModel:n.model,selectedScenario:n.scenario,selectedDate:n.date,compareMode:n.compareMode,chartMode:n.chartMode,selectedScenario1:n.compareScenarioA,selectedScenario2:n.compareScenarioB,selectedModel1:n.compareModelA,selectedModel2:n.compareModelB,selectedDate1:n.compareDateStart,selectedDate2:n.compareDateEnd,currentDataStats:n.dataMin!==null&&n.dataMax!==null?{min:n.dataMin,max:n.dataMax,mean:n.dataMean??void 0}:void 0};uh(e,n,_)}async function yo(){if(nt=document.querySelector("#app"),!nt)throw new Error("Root element #app not found");sh(t=>{Object.assign(n,t),z(),n.canvasView==="map"&&(t.date||t.model||t.scenario||t.variable)?Lt():n.canvasView==="map"&&t.palette&&n.currentData&&z(),n.canvasView==="chart"&&(t.chartDate||t.chartRangeStart||t.chartRangeEnd)&&qt()}),z(),tf().then(()=>{z()}),n.canvasView==="map"&&n.mode==="Explore"&&Lt(),nt.addEventListener("click",t=>{const e=t.target,a=e.closest("[data-action]"),r=a?.getAttribute("data-action");if(r==="tutorial-continue"){t.preventDefault(),t.stopPropagation();const o=jt(),i=vn[o.currentStep]?.id??"";if(i==="compare-switch"){const s=document.querySelector('[data-action="set-mode"][data-value="Compare"]');if(s){s.click();return}}if(i==="chat-switch"){const s=document.querySelector('[data-action="set-tab"][data-value="Chat"]');if(s){s.click();return}}if(i==="analysis-switch"){const s=document.querySelector('[data-action="set-canvas"][data-value="chart"]');if(s){s.click();return}}ye(),z();return}if(r==="close-tutorial"){t.preventDefault(),t.stopPropagation(),ai(),z();return}if(r==="start-tutorial"){t.preventDefault(),t.stopPropagation(),n.canvasView="map",n.mode="Explore",n.panelTab="Manual",mh(),z();return}if(r==="update-select"){const o=jt();if(o.active){const i=a?.getAttribute("data-key");(e.classList.contains("custom-select-trigger")||e.closest(".custom-select-trigger"))&&setTimeout(()=>{z()},50),{1:"scenario",2:"model",4:"variable",5:"unit",6:"palette"}[o.currentStep]===i&&(e.classList.contains("custom-select-option")||e.closest(".custom-select-option"))&&setTimeout(()=>{ye(),z()},100)}}})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",yo):yo();
