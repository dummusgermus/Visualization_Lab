(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=n(i);fetch(i.href,a)}})();function Oe(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function ha(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function di(t){let e,n,r;t.length!==2?(e=Oe,n=(l,u)=>Oe(t(l),u),r=(l,u)=>t(l)-u):(e=t===Oe||t===ha?t:pa,n=t,r=t);function i(l,u,d=0,c=l.length){if(d<c){if(e(u,u)!==0)return c;do{const f=d+c>>>1;n(l[f],u)<0?d=f+1:c=f}while(d<c)}return d}function a(l,u,d=0,c=l.length){if(d<c){if(e(u,u)!==0)return c;do{const f=d+c>>>1;n(l[f],u)<=0?d=f+1:c=f}while(d<c)}return d}function o(l,u,d=0,c=l.length){const f=i(l,u,d,c-1);return f>d&&r(l[f-1],u)>-r(l[f],u)?f-1:f}return{left:i,center:o,right:a}}function pa(){return 0}function fi(t){return t===null?NaN:+t}const ga=di(Oe),ma=ga.right;di(fi).center;class va{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const n=this._partials;let r=0;for(let i=0;i<this._n&&i<32;i++){const a=n[i],o=e+a,l=Math.abs(e)<Math.abs(a)?e-(o-a):a-(o-e);l&&(n[r++]=l),e=o}return n[r]=e,this._n=r+1,this}valueOf(){const e=this._partials;let n=this._n,r,i,a,o=0;if(n>0){for(o=e[--n];n>0&&(r=o,i=e[--n],o=r+i,a=i-(o-r),!a););n>0&&(a<0&&e[n-1]<0||a>0&&e[n-1]>0)&&(i=a*2,r=o+i,i==r-o&&(o=r))}return o}}const ya=Math.sqrt(50),wa=Math.sqrt(10),xa=Math.sqrt(2);function We(t,e,n){const r=(e-t)/Math.max(0,n),i=Math.floor(Math.log10(r)),a=r/Math.pow(10,i),o=a>=ya?10:a>=wa?5:a>=xa?2:1;let l,u,d;return i<0?(d=Math.pow(10,-i)/o,l=Math.round(t*d),u=Math.round(e*d),l/d<t&&++l,u/d>e&&--u,d=-d):(d=Math.pow(10,i)*o,l=Math.round(t/d),u=Math.round(e/d),l*d<t&&++l,u*d>e&&--u),u<l&&.5<=n&&n<2?We(t,e,n*2):[l,u,d]}function ba(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const r=e<t,[i,a,o]=r?We(e,t,n):We(t,e,n);if(!(a>=i))return[];const l=a-i+1,u=new Array(l);if(r)if(o<0)for(let d=0;d<l;++d)u[d]=(a-d)/-o;else for(let d=0;d<l;++d)u[d]=(a-d)*o;else if(o<0)for(let d=0;d<l;++d)u[d]=(i+d)/-o;else for(let d=0;d<l;++d)u[d]=(i+d)*o;return u}function Dn(t,e,n){return e=+e,t=+t,n=+n,We(t,e,n)[2]}function Sa(t,e,n){e=+e,t=+t,n=+n;const r=e<t,i=r?Dn(e,t,n):Dn(t,e,n);return(r?-1:1)*(i<0?1/-i:i)}function vn(t,e,n=fi){if(!(!(r=t.length)||isNaN(e=+e))){if(e<=0||r<2)return+n(t[0],0,t);if(e>=1)return+n(t[r-1],r-1,t);var r,i=(r-1)*e,a=Math.floor(i),o=+n(t[a],a,t),l=+n(t[a+1],a+1,t);return o+(l-o)*(i-a)}}function $a(t,e){let n=0,r=0;for(let i of t)i!=null&&(i=+i)>=i&&(++n,r+=i);if(n)return r/n}function*Ma(t){for(const e of t)yield*e}function hi(t){return Array.from(Ma(t))}var _a={value:()=>{}};function pi(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new Ve(n)}function Ve(t){this._=t}function Ea(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}Ve.prototype=pi.prototype={constructor:Ve,on:function(t,e){var n=this._,r=Ea(t+"",n),i,a=-1,o=r.length;if(arguments.length<2){for(;++a<o;)if((i=(t=r[a]).type)&&(i=Da(n[i],t.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++a<o;)if(i=(t=r[a]).type)n[i]=vr(n[i],t.name,e);else if(e==null)for(i in n)n[i]=vr(n[i],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Ve(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,a;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=this._[t],r=0,i=a.length;r<i;++r)a[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,a=r.length;i<a;++i)r[i].value.apply(e,n)}};function Da(t,e){for(var n=0,r=t.length,i;n<r;++n)if((i=t[n]).name===e)return i.value}function vr(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=_a,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var kn="http://www.w3.org/1999/xhtml";const yr={svg:"http://www.w3.org/2000/svg",xhtml:kn,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function cn(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),yr.hasOwnProperty(e)?{space:yr[e],local:t}:t}function ka(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===kn&&e.documentElement.namespaceURI===kn?e.createElement(t):e.createElementNS(n,t)}}function Ta(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function gi(t){var e=cn(t);return(e.local?Ta:ka)(e)}function Aa(){}function Zn(t){return t==null?Aa:function(){return this.querySelector(t)}}function Ca(t){typeof t!="function"&&(t=Zn(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var a=e[i],o=a.length,l=r[i]=new Array(o),u,d,c=0;c<o;++c)(u=a[c])&&(d=t.call(u,u.__data__,c,a))&&("__data__"in u&&(d.__data__=u.__data__),l[c]=d);return new ct(r,this._parents)}function Pa(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function Ia(){return[]}function mi(t){return t==null?Ia:function(){return this.querySelectorAll(t)}}function Na(t){return function(){return Pa(t.apply(this,arguments))}}function Ra(t){typeof t=="function"?t=Na(t):t=mi(t);for(var e=this._groups,n=e.length,r=[],i=[],a=0;a<n;++a)for(var o=e[a],l=o.length,u,d=0;d<l;++d)(u=o[d])&&(r.push(t.call(u,u.__data__,d,o)),i.push(u));return new ct(r,i)}function vi(t){return function(){return this.matches(t)}}function yi(t){return function(e){return e.matches(t)}}var La=Array.prototype.find;function Ba(t){return function(){return La.call(this.children,t)}}function Fa(){return this.firstElementChild}function Oa(t){return this.select(t==null?Fa:Ba(typeof t=="function"?t:yi(t)))}var Va=Array.prototype.filter;function qa(){return Array.from(this.children)}function Xa(t){return function(){return Va.call(this.children,t)}}function za(t){return this.selectAll(t==null?qa:Xa(typeof t=="function"?t:yi(t)))}function Ha(t){typeof t!="function"&&(t=vi(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var a=e[i],o=a.length,l=r[i]=[],u,d=0;d<o;++d)(u=a[d])&&t.call(u,u.__data__,d,a)&&l.push(u);return new ct(r,this._parents)}function wi(t){return new Array(t.length)}function Wa(){return new ct(this._enter||this._groups.map(wi),this._parents)}function Ue(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}Ue.prototype={constructor:Ue,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function Ua(t){return function(){return t}}function Ya(t,e,n,r,i,a){for(var o=0,l,u=e.length,d=a.length;o<d;++o)(l=e[o])?(l.__data__=a[o],r[o]=l):n[o]=new Ue(t,a[o]);for(;o<u;++o)(l=e[o])&&(i[o]=l)}function Ga(t,e,n,r,i,a,o){var l,u,d=new Map,c=e.length,f=a.length,h=new Array(c),p;for(l=0;l<c;++l)(u=e[l])&&(h[l]=p=o.call(u,u.__data__,l,e)+"",d.has(p)?i[l]=u:d.set(p,u));for(l=0;l<f;++l)p=o.call(t,a[l],l,a)+"",(u=d.get(p))?(r[l]=u,u.__data__=a[l],d.delete(p)):n[l]=new Ue(t,a[l]);for(l=0;l<c;++l)(u=e[l])&&d.get(h[l])===u&&(i[l]=u)}function Ka(t){return t.__data__}function Za(t,e){if(!arguments.length)return Array.from(this,Ka);var n=e?Ga:Ya,r=this._parents,i=this._groups;typeof t!="function"&&(t=Ua(t));for(var a=i.length,o=new Array(a),l=new Array(a),u=new Array(a),d=0;d<a;++d){var c=r[d],f=i[d],h=f.length,p=Ja(t.call(c,c&&c.__data__,d,r)),y=p.length,D=l[d]=new Array(y),$=o[d]=new Array(y),T=u[d]=new Array(h);n(c,f,D,$,T,p,e);for(var w=0,v=0,g,m;w<y;++w)if(g=D[w]){for(w>=v&&(v=w+1);!(m=$[v])&&++v<y;);g._next=m||null}}return o=new ct(o,r),o._enter=l,o._exit=u,o}function Ja(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function Qa(){return new ct(this._exit||this._groups.map(wi),this._parents)}function ja(t,e,n){var r=this.enter(),i=this,a=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(i=e(i),i&&(i=i.selection())),n==null?a.remove():n(a),r&&i?r.merge(i).order():i}function to(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,a=r.length,o=Math.min(i,a),l=new Array(i),u=0;u<o;++u)for(var d=n[u],c=r[u],f=d.length,h=l[u]=new Array(f),p,y=0;y<f;++y)(p=d[y]||c[y])&&(h[y]=p);for(;u<i;++u)l[u]=n[u];return new ct(l,this._parents)}function eo(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],i=r.length-1,a=r[i],o;--i>=0;)(o=r[i])&&(a&&o.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(o,a),a=o);return this}function no(t){t||(t=ro);function e(f,h){return f&&h?t(f.__data__,h.__data__):!f-!h}for(var n=this._groups,r=n.length,i=new Array(r),a=0;a<r;++a){for(var o=n[a],l=o.length,u=i[a]=new Array(l),d,c=0;c<l;++c)(d=o[c])&&(u[c]=d);u.sort(e)}return new ct(i,this._parents).order()}function ro(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function io(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function ao(){return Array.from(this)}function oo(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,a=r.length;i<a;++i){var o=r[i];if(o)return o}return null}function so(){let t=0;for(const e of this)++t;return t}function lo(){return!this.node()}function co(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i=e[n],a=0,o=i.length,l;a<o;++a)(l=i[a])&&t.call(l,l.__data__,a,i);return this}function uo(t){return function(){this.removeAttribute(t)}}function fo(t){return function(){this.removeAttributeNS(t.space,t.local)}}function ho(t,e){return function(){this.setAttribute(t,e)}}function po(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function go(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function mo(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function vo(t,e){var n=cn(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?fo:uo:typeof e=="function"?n.local?mo:go:n.local?po:ho)(n,e))}function xi(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function yo(t){return function(){this.style.removeProperty(t)}}function wo(t,e,n){return function(){this.style.setProperty(t,e,n)}}function xo(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function bo(t,e,n){return arguments.length>1?this.each((e==null?yo:typeof e=="function"?xo:wo)(t,e,n??"")):ie(this.node(),t)}function ie(t,e){return t.style.getPropertyValue(e)||xi(t).getComputedStyle(t,null).getPropertyValue(e)}function So(t){return function(){delete this[t]}}function $o(t,e){return function(){this[t]=e}}function Mo(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function _o(t,e){return arguments.length>1?this.each((e==null?So:typeof e=="function"?Mo:$o)(t,e)):this.node()[t]}function bi(t){return t.trim().split(/^|\s+/)}function Jn(t){return t.classList||new Si(t)}function Si(t){this._node=t,this._names=bi(t.getAttribute("class")||"")}Si.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function $i(t,e){for(var n=Jn(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function Mi(t,e){for(var n=Jn(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function Eo(t){return function(){$i(this,t)}}function Do(t){return function(){Mi(this,t)}}function ko(t,e){return function(){(e.apply(this,arguments)?$i:Mi)(this,t)}}function To(t,e){var n=bi(t+"");if(arguments.length<2){for(var r=Jn(this.node()),i=-1,a=n.length;++i<a;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof e=="function"?ko:e?Eo:Do)(n,e))}function Ao(){this.textContent=""}function Co(t){return function(){this.textContent=t}}function Po(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function Io(t){return arguments.length?this.each(t==null?Ao:(typeof t=="function"?Po:Co)(t)):this.node().textContent}function No(){this.innerHTML=""}function Ro(t){return function(){this.innerHTML=t}}function Lo(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function Bo(t){return arguments.length?this.each(t==null?No:(typeof t=="function"?Lo:Ro)(t)):this.node().innerHTML}function Fo(){this.nextSibling&&this.parentNode.appendChild(this)}function Oo(){return this.each(Fo)}function Vo(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function qo(){return this.each(Vo)}function Xo(t){var e=typeof t=="function"?t:gi(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function zo(){return null}function Ho(t,e){var n=typeof t=="function"?t:gi(t),r=e==null?zo:typeof e=="function"?e:Zn(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function Wo(){var t=this.parentNode;t&&t.removeChild(this)}function Uo(){return this.each(Wo)}function Yo(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Go(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Ko(t){return this.select(t?Go:Yo)}function Zo(t){return arguments.length?this.property("__data__",t):this.node().__data__}function Jo(t){return function(e){t.call(this,e,this.__data__)}}function Qo(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function jo(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,i=e.length,a;n<i;++n)a=e[n],(!t.type||a.type===t.type)&&a.name===t.name?this.removeEventListener(a.type,a.listener,a.options):e[++r]=a;++r?e.length=r:delete this.__on}}}function ts(t,e,n){return function(){var r=this.__on,i,a=Jo(e);if(r){for(var o=0,l=r.length;o<l;++o)if((i=r[o]).type===t.type&&i.name===t.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=a,i.options=n),i.value=e;return}}this.addEventListener(t.type,a,n),i={type:t.type,name:t.name,value:e,listener:a,options:n},r?r.push(i):this.__on=[i]}}function es(t,e,n){var r=Qo(t+""),i,a=r.length,o;if(arguments.length<2){var l=this.node().__on;if(l){for(var u=0,d=l.length,c;u<d;++u)for(i=0,c=l[u];i<a;++i)if((o=r[i]).type===c.type&&o.name===c.name)return c.value}return}for(l=e?ts:jo,i=0;i<a;++i)this.each(l(r[i],e,n));return this}function _i(t,e,n){var r=xi(t),i=r.CustomEvent;typeof i=="function"?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function ns(t,e){return function(){return _i(this,t,e)}}function rs(t,e){return function(){return _i(this,t,e.apply(this,arguments))}}function is(t,e){return this.each((typeof e=="function"?rs:ns)(t,e))}function*as(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,a=r.length,o;i<a;++i)(o=r[i])&&(yield o)}var os=[null];function ct(t,e){this._groups=t,this._parents=e}function _e(){return new ct([[document.documentElement]],os)}function ss(){return this}ct.prototype=_e.prototype={constructor:ct,select:Ca,selectAll:Ra,selectChild:Oa,selectChildren:za,filter:Ha,data:Za,enter:Wa,exit:Qa,join:ja,merge:to,selection:ss,order:eo,sort:no,call:io,nodes:ao,node:oo,size:so,empty:lo,each:co,attr:vo,style:bo,property:_o,classed:To,text:Io,html:Bo,raise:Oo,lower:qo,append:Xo,insert:Ho,remove:Uo,clone:Ko,datum:Zo,on:es,dispatch:is,[Symbol.iterator]:as};function ls(t){let e;for(;e=t.sourceEvent;)t=e;return t}function cs(t,e){if(t=ls(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}}return[t.pageX,t.pageY]}function Qn(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Ei(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Ee(){}var ve=.7,Ye=1/ve,ee="\\s*([+-]?\\d+)\\s*",ye="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",gt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",us=/^#([0-9a-f]{3,8})$/,ds=new RegExp(`^rgb\\(${ee},${ee},${ee}\\)$`),fs=new RegExp(`^rgb\\(${gt},${gt},${gt}\\)$`),hs=new RegExp(`^rgba\\(${ee},${ee},${ee},${ye}\\)$`),ps=new RegExp(`^rgba\\(${gt},${gt},${gt},${ye}\\)$`),gs=new RegExp(`^hsl\\(${ye},${gt},${gt}\\)$`),ms=new RegExp(`^hsla\\(${ye},${gt},${gt},${ye}\\)$`),wr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Qn(Ee,zt,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:xr,formatHex:xr,formatHex8:vs,formatHsl:ys,formatRgb:br,toString:br});function xr(){return this.rgb().formatHex()}function vs(){return this.rgb().formatHex8()}function ys(){return Di(this).formatHsl()}function br(){return this.rgb().formatRgb()}function zt(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=us.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?Sr(e):n===3?new tt(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Ae(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Ae(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=ds.exec(t))?new tt(e[1],e[2],e[3],1):(e=fs.exec(t))?new tt(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=hs.exec(t))?Ae(e[1],e[2],e[3],e[4]):(e=ps.exec(t))?Ae(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=gs.exec(t))?_r(e[1],e[2]/100,e[3]/100,1):(e=ms.exec(t))?_r(e[1],e[2]/100,e[3]/100,e[4]):wr.hasOwnProperty(t)?Sr(wr[t]):t==="transparent"?new tt(NaN,NaN,NaN,0):null}function Sr(t){return new tt(t>>16&255,t>>8&255,t&255,1)}function Ae(t,e,n,r){return r<=0&&(t=e=n=NaN),new tt(t,e,n,r)}function ws(t){return t instanceof Ee||(t=zt(t)),t?(t=t.rgb(),new tt(t.r,t.g,t.b,t.opacity)):new tt}function Tn(t,e,n,r){return arguments.length===1?ws(t):new tt(t,e,n,r??1)}function tt(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}Qn(tt,Tn,Ei(Ee,{brighter(t){return t=t==null?Ye:Math.pow(Ye,t),new tt(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?ve:Math.pow(ve,t),new tt(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new tt(Xt(this.r),Xt(this.g),Xt(this.b),Ge(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:$r,formatHex:$r,formatHex8:xs,formatRgb:Mr,toString:Mr}));function $r(){return`#${Ot(this.r)}${Ot(this.g)}${Ot(this.b)}`}function xs(){return`#${Ot(this.r)}${Ot(this.g)}${Ot(this.b)}${Ot((isNaN(this.opacity)?1:this.opacity)*255)}`}function Mr(){const t=Ge(this.opacity);return`${t===1?"rgb(":"rgba("}${Xt(this.r)}, ${Xt(this.g)}, ${Xt(this.b)}${t===1?")":`, ${t})`}`}function Ge(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Xt(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Ot(t){return t=Xt(t),(t<16?"0":"")+t.toString(16)}function _r(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new lt(t,e,n,r)}function Di(t){if(t instanceof lt)return new lt(t.h,t.s,t.l,t.opacity);if(t instanceof Ee||(t=zt(t)),!t)return new lt;if(t instanceof lt)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),a=Math.max(e,n,r),o=NaN,l=a-i,u=(a+i)/2;return l?(e===a?o=(n-r)/l+(n<r)*6:n===a?o=(r-e)/l+2:o=(e-n)/l+4,l/=u<.5?a+i:2-a-i,o*=60):l=u>0&&u<1?0:o,new lt(o,l,u,t.opacity)}function bs(t,e,n,r){return arguments.length===1?Di(t):new lt(t,e,n,r??1)}function lt(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}Qn(lt,bs,Ei(Ee,{brighter(t){return t=t==null?Ye:Math.pow(Ye,t),new lt(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?ve:Math.pow(ve,t),new lt(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new tt(yn(t>=240?t-240:t+120,i,r),yn(t,i,r),yn(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new lt(Er(this.h),Ce(this.s),Ce(this.l),Ge(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Ge(this.opacity);return`${t===1?"hsl(":"hsla("}${Er(this.h)}, ${Ce(this.s)*100}%, ${Ce(this.l)*100}%${t===1?")":`, ${t})`}`}}));function Er(t){return t=(t||0)%360,t<0?t+360:t}function Ce(t){return Math.max(0,Math.min(1,t||0))}function yn(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const jn=t=>()=>t;function Ss(t,e){return function(n){return t+n*e}}function $s(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function Ms(t){return(t=+t)==1?ki:function(e,n){return n-e?$s(e,n,t):jn(isNaN(e)?n:e)}}function ki(t,e){var n=e-t;return n?Ss(t,n):jn(isNaN(t)?e:t)}const Ke=(function t(e){var n=Ms(e);function r(i,a){var o=n((i=Tn(i)).r,(a=Tn(a)).r),l=n(i.g,a.g),u=n(i.b,a.b),d=ki(i.opacity,a.opacity);return function(c){return i.r=o(c),i.g=l(c),i.b=u(c),i.opacity=d(c),i+""}}return r.gamma=t,r})(1);function _s(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),i;return function(a){for(i=0;i<n;++i)r[i]=t[i]*(1-a)+e[i]*a;return r}}function Es(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Ds(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,i=new Array(r),a=new Array(n),o;for(o=0;o<r;++o)i[o]=tr(t[o],e[o]);for(;o<n;++o)a[o]=e[o];return function(l){for(o=0;o<r;++o)a[o]=i[o](l);return a}}function ks(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function st(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function Ts(t,e){var n={},r={},i;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in t?n[i]=tr(t[i],e[i]):r[i]=e[i];return function(a){for(i in n)r[i]=n[i](a);return r}}var An=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,wn=new RegExp(An.source,"g");function As(t){return function(){return t}}function Cs(t){return function(e){return t(e)+""}}function Ti(t,e){var n=An.lastIndex=wn.lastIndex=0,r,i,a,o=-1,l=[],u=[];for(t=t+"",e=e+"";(r=An.exec(t))&&(i=wn.exec(e));)(a=i.index)>n&&(a=e.slice(n,a),l[o]?l[o]+=a:l[++o]=a),(r=r[0])===(i=i[0])?l[o]?l[o]+=i:l[++o]=i:(l[++o]=null,u.push({i:o,x:st(r,i)})),n=wn.lastIndex;return n<e.length&&(a=e.slice(n),l[o]?l[o]+=a:l[++o]=a),l.length<2?u[0]?Cs(u[0].x):As(e):(e=u.length,function(d){for(var c=0,f;c<e;++c)l[(f=u[c]).i]=f.x(d);return l.join("")})}function tr(t,e){var n=typeof e,r;return e==null||n==="boolean"?jn(e):(n==="number"?st:n==="string"?(r=zt(e))?(e=r,Ke):Ti:e instanceof zt?Ke:e instanceof Date?ks:Es(e)?_s:Array.isArray(e)?Ds:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?Ts:st)(t,e)}function Ps(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var Dr=180/Math.PI,Cn={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Ai(t,e,n,r,i,a){var o,l,u;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(u=t*n+e*r)&&(n-=t*u,r-=e*u),(l=Math.sqrt(n*n+r*r))&&(n/=l,r/=l,u/=l),t*r<e*n&&(t=-t,e=-e,u=-u,o=-o),{translateX:i,translateY:a,rotate:Math.atan2(e,t)*Dr,skewX:Math.atan(u)*Dr,scaleX:o,scaleY:l}}var Pe;function Is(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Cn:Ai(e.a,e.b,e.c,e.d,e.e,e.f)}function Ns(t){return t==null||(Pe||(Pe=document.createElementNS("http://www.w3.org/2000/svg","g")),Pe.setAttribute("transform",t),!(t=Pe.transform.baseVal.consolidate()))?Cn:(t=t.matrix,Ai(t.a,t.b,t.c,t.d,t.e,t.f))}function Ci(t,e,n,r){function i(d){return d.length?d.pop()+" ":""}function a(d,c,f,h,p,y){if(d!==f||c!==h){var D=p.push("translate(",null,e,null,n);y.push({i:D-4,x:st(d,f)},{i:D-2,x:st(c,h)})}else(f||h)&&p.push("translate("+f+e+h+n)}function o(d,c,f,h){d!==c?(d-c>180?c+=360:c-d>180&&(d+=360),h.push({i:f.push(i(f)+"rotate(",null,r)-2,x:st(d,c)})):c&&f.push(i(f)+"rotate("+c+r)}function l(d,c,f,h){d!==c?h.push({i:f.push(i(f)+"skewX(",null,r)-2,x:st(d,c)}):c&&f.push(i(f)+"skewX("+c+r)}function u(d,c,f,h,p,y){if(d!==f||c!==h){var D=p.push(i(p)+"scale(",null,",",null,")");y.push({i:D-4,x:st(d,f)},{i:D-2,x:st(c,h)})}else(f!==1||h!==1)&&p.push(i(p)+"scale("+f+","+h+")")}return function(d,c){var f=[],h=[];return d=t(d),c=t(c),a(d.translateX,d.translateY,c.translateX,c.translateY,f,h),o(d.rotate,c.rotate,f,h),l(d.skewX,c.skewX,f,h),u(d.scaleX,d.scaleY,c.scaleX,c.scaleY,f,h),d=c=null,function(p){for(var y=-1,D=h.length,$;++y<D;)f[($=h[y]).i]=$.x(p);return f.join("")}}}var Rs=Ci(Is,"px, ","px)","deg)"),Ls=Ci(Ns,", ",")",")"),ae=0,de=0,ce=0,Pi=1e3,Ze,fe,Je=0,Ht=0,un=0,we=typeof performance=="object"&&performance.now?performance:Date,Ii=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function er(){return Ht||(Ii(Bs),Ht=we.now()+un)}function Bs(){Ht=0}function Qe(){this._call=this._time=this._next=null}Qe.prototype=Ni.prototype={constructor:Qe,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?er():+n)+(e==null?0:+e),!this._next&&fe!==this&&(fe?fe._next=this:Ze=this,fe=this),this._call=t,this._time=n,Pn()},stop:function(){this._call&&(this._call=null,this._time=1/0,Pn())}};function Ni(t,e,n){var r=new Qe;return r.restart(t,e,n),r}function Fs(){er(),++ae;for(var t=Ze,e;t;)(e=Ht-t._time)>=0&&t._call.call(void 0,e),t=t._next;--ae}function kr(){Ht=(Je=we.now())+un,ae=de=0;try{Fs()}finally{ae=0,Vs(),Ht=0}}function Os(){var t=we.now(),e=t-Je;e>Pi&&(un-=e,Je=t)}function Vs(){for(var t,e=Ze,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:Ze=n);fe=t,Pn(r)}function Pn(t){if(!ae){de&&(de=clearTimeout(de));var e=t-Ht;e>24?(t<1/0&&(de=setTimeout(kr,t-we.now()-un)),ce&&(ce=clearInterval(ce))):(ce||(Je=we.now(),ce=setInterval(Os,Pi)),ae=1,Ii(kr))}}function Tr(t,e,n){var r=new Qe;return e=e==null?0:+e,r.restart(i=>{r.stop(),t(i+e)},e,n),r}var qs=pi("start","end","cancel","interrupt"),Xs=[],Ri=0,Ar=1,In=2,qe=3,Cr=4,Nn=5,Xe=6;function dn(t,e,n,r,i,a){var o=t.__transition;if(!o)t.__transition={};else if(n in o)return;zs(t,n,{name:e,index:r,group:i,on:qs,tween:Xs,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:Ri})}function nr(t,e){var n=dt(t,e);if(n.state>Ri)throw new Error("too late; already scheduled");return n}function mt(t,e){var n=dt(t,e);if(n.state>qe)throw new Error("too late; already running");return n}function dt(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function zs(t,e,n){var r=t.__transition,i;r[e]=n,n.timer=Ni(a,0,n.time);function a(d){n.state=Ar,n.timer.restart(o,n.delay,n.time),n.delay<=d&&o(d-n.delay)}function o(d){var c,f,h,p;if(n.state!==Ar)return u();for(c in r)if(p=r[c],p.name===n.name){if(p.state===qe)return Tr(o);p.state===Cr?(p.state=Xe,p.timer.stop(),p.on.call("interrupt",t,t.__data__,p.index,p.group),delete r[c]):+c<e&&(p.state=Xe,p.timer.stop(),p.on.call("cancel",t,t.__data__,p.index,p.group),delete r[c])}if(Tr(function(){n.state===qe&&(n.state=Cr,n.timer.restart(l,n.delay,n.time),l(d))}),n.state=In,n.on.call("start",t,t.__data__,n.index,n.group),n.state===In){for(n.state=qe,i=new Array(h=n.tween.length),c=0,f=-1;c<h;++c)(p=n.tween[c].value.call(t,t.__data__,n.index,n.group))&&(i[++f]=p);i.length=f+1}}function l(d){for(var c=d<n.duration?n.ease.call(null,d/n.duration):(n.timer.restart(u),n.state=Nn,1),f=-1,h=i.length;++f<h;)i[f].call(t,c);n.state===Nn&&(n.on.call("end",t,t.__data__,n.index,n.group),u())}function u(){n.state=Xe,n.timer.stop(),delete r[e];for(var d in r)return;delete t.__transition}}function Hs(t,e){var n=t.__transition,r,i,a=!0,o;if(n){e=e==null?null:e+"";for(o in n){if((r=n[o]).name!==e){a=!1;continue}i=r.state>In&&r.state<Nn,r.state=Xe,r.timer.stop(),r.on.call(i?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[o]}a&&delete t.__transition}}function Ws(t){return this.each(function(){Hs(this,t)})}function Us(t,e){var n,r;return function(){var i=mt(this,t),a=i.tween;if(a!==n){r=n=a;for(var o=0,l=r.length;o<l;++o)if(r[o].name===e){r=r.slice(),r.splice(o,1);break}}i.tween=r}}function Ys(t,e,n){var r,i;if(typeof n!="function")throw new Error;return function(){var a=mt(this,t),o=a.tween;if(o!==r){i=(r=o).slice();for(var l={name:e,value:n},u=0,d=i.length;u<d;++u)if(i[u].name===e){i[u]=l;break}u===d&&i.push(l)}a.tween=i}}function Gs(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=dt(this.node(),n).tween,i=0,a=r.length,o;i<a;++i)if((o=r[i]).name===t)return o.value;return null}return this.each((e==null?Us:Ys)(n,t,e))}function rr(t,e,n){var r=t._id;return t.each(function(){var i=mt(this,r);(i.value||(i.value={}))[e]=n.apply(this,arguments)}),function(i){return dt(i,r).value[e]}}function Li(t,e){var n;return(typeof e=="number"?st:e instanceof zt?Ke:(n=zt(e))?(e=n,Ke):Ti)(t,e)}function Ks(t){return function(){this.removeAttribute(t)}}function Zs(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Js(t,e,n){var r,i=n+"",a;return function(){var o=this.getAttribute(t);return o===i?null:o===r?a:a=e(r=o,n)}}function Qs(t,e,n){var r,i=n+"",a;return function(){var o=this.getAttributeNS(t.space,t.local);return o===i?null:o===r?a:a=e(r=o,n)}}function js(t,e,n){var r,i,a;return function(){var o,l=n(this),u;return l==null?void this.removeAttribute(t):(o=this.getAttribute(t),u=l+"",o===u?null:o===r&&u===i?a:(i=u,a=e(r=o,l)))}}function tl(t,e,n){var r,i,a;return function(){var o,l=n(this),u;return l==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),u=l+"",o===u?null:o===r&&u===i?a:(i=u,a=e(r=o,l)))}}function el(t,e){var n=cn(t),r=n==="transform"?Ls:Li;return this.attrTween(t,typeof e=="function"?(n.local?tl:js)(n,r,rr(this,"attr."+t,e)):e==null?(n.local?Zs:Ks)(n):(n.local?Qs:Js)(n,r,e))}function nl(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function rl(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function il(t,e){var n,r;function i(){var a=e.apply(this,arguments);return a!==r&&(n=(r=a)&&rl(t,a)),n}return i._value=e,i}function al(t,e){var n,r;function i(){var a=e.apply(this,arguments);return a!==r&&(n=(r=a)&&nl(t,a)),n}return i._value=e,i}function ol(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=cn(t);return this.tween(n,(r.local?il:al)(r,e))}function sl(t,e){return function(){nr(this,t).delay=+e.apply(this,arguments)}}function ll(t,e){return e=+e,function(){nr(this,t).delay=e}}function cl(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?sl:ll)(e,t)):dt(this.node(),e).delay}function ul(t,e){return function(){mt(this,t).duration=+e.apply(this,arguments)}}function dl(t,e){return e=+e,function(){mt(this,t).duration=e}}function fl(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?ul:dl)(e,t)):dt(this.node(),e).duration}function hl(t,e){if(typeof e!="function")throw new Error;return function(){mt(this,t).ease=e}}function pl(t){var e=this._id;return arguments.length?this.each(hl(e,t)):dt(this.node(),e).ease}function gl(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;mt(this,t).ease=n}}function ml(t){if(typeof t!="function")throw new Error;return this.each(gl(this._id,t))}function vl(t){typeof t!="function"&&(t=vi(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var a=e[i],o=a.length,l=r[i]=[],u,d=0;d<o;++d)(u=a[d])&&t.call(u,u.__data__,d,a)&&l.push(u);return new kt(r,this._parents,this._name,this._id)}function yl(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,a=Math.min(r,i),o=new Array(r),l=0;l<a;++l)for(var u=e[l],d=n[l],c=u.length,f=o[l]=new Array(c),h,p=0;p<c;++p)(h=u[p]||d[p])&&(f[p]=h);for(;l<r;++l)o[l]=e[l];return new kt(o,this._parents,this._name,this._id)}function wl(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function xl(t,e,n){var r,i,a=wl(e)?nr:mt;return function(){var o=a(this,t),l=o.on;l!==r&&(i=(r=l).copy()).on(e,n),o.on=i}}function bl(t,e){var n=this._id;return arguments.length<2?dt(this.node(),n).on.on(t):this.each(xl(n,t,e))}function Sl(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function $l(){return this.on("end.remove",Sl(this._id))}function Ml(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Zn(t));for(var r=this._groups,i=r.length,a=new Array(i),o=0;o<i;++o)for(var l=r[o],u=l.length,d=a[o]=new Array(u),c,f,h=0;h<u;++h)(c=l[h])&&(f=t.call(c,c.__data__,h,l))&&("__data__"in c&&(f.__data__=c.__data__),d[h]=f,dn(d[h],e,n,h,d,dt(c,n)));return new kt(a,this._parents,e,n)}function _l(t){var e=this._name,n=this._id;typeof t!="function"&&(t=mi(t));for(var r=this._groups,i=r.length,a=[],o=[],l=0;l<i;++l)for(var u=r[l],d=u.length,c,f=0;f<d;++f)if(c=u[f]){for(var h=t.call(c,c.__data__,f,u),p,y=dt(c,n),D=0,$=h.length;D<$;++D)(p=h[D])&&dn(p,e,n,D,h,y);a.push(h),o.push(c)}return new kt(a,o,e,n)}var El=_e.prototype.constructor;function Dl(){return new El(this._groups,this._parents)}function kl(t,e){var n,r,i;return function(){var a=ie(this,t),o=(this.style.removeProperty(t),ie(this,t));return a===o?null:a===n&&o===r?i:i=e(n=a,r=o)}}function Bi(t){return function(){this.style.removeProperty(t)}}function Tl(t,e,n){var r,i=n+"",a;return function(){var o=ie(this,t);return o===i?null:o===r?a:a=e(r=o,n)}}function Al(t,e,n){var r,i,a;return function(){var o=ie(this,t),l=n(this),u=l+"";return l==null&&(u=l=(this.style.removeProperty(t),ie(this,t))),o===u?null:o===r&&u===i?a:(i=u,a=e(r=o,l))}}function Cl(t,e){var n,r,i,a="style."+e,o="end."+a,l;return function(){var u=mt(this,t),d=u.on,c=u.value[a]==null?l||(l=Bi(e)):void 0;(d!==n||i!==c)&&(r=(n=d).copy()).on(o,i=c),u.on=r}}function Pl(t,e,n){var r=(t+="")=="transform"?Rs:Li;return e==null?this.styleTween(t,kl(t,r)).on("end.style."+t,Bi(t)):typeof e=="function"?this.styleTween(t,Al(t,r,rr(this,"style."+t,e))).each(Cl(this._id,t)):this.styleTween(t,Tl(t,r,e),n).on("end.style."+t,null)}function Il(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function Nl(t,e,n){var r,i;function a(){var o=e.apply(this,arguments);return o!==i&&(r=(i=o)&&Il(t,o,n)),r}return a._value=e,a}function Rl(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,Nl(t,e,n??""))}function Ll(t){return function(){this.textContent=t}}function Bl(t){return function(){var e=t(this);this.textContent=e??""}}function Fl(t){return this.tween("text",typeof t=="function"?Bl(rr(this,"text",t)):Ll(t==null?"":t+""))}function Ol(t){return function(e){this.textContent=t.call(this,e)}}function Vl(t){var e,n;function r(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&Ol(i)),e}return r._value=t,r}function ql(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,Vl(t))}function Xl(){for(var t=this._name,e=this._id,n=Fi(),r=this._groups,i=r.length,a=0;a<i;++a)for(var o=r[a],l=o.length,u,d=0;d<l;++d)if(u=o[d]){var c=dt(u,e);dn(u,t,n,d,o,{time:c.time+c.delay+c.duration,delay:0,duration:c.duration,ease:c.ease})}return new kt(r,this._parents,t,n)}function zl(){var t,e,n=this,r=n._id,i=n.size();return new Promise(function(a,o){var l={value:o},u={value:function(){--i===0&&a()}};n.each(function(){var d=mt(this,r),c=d.on;c!==t&&(e=(t=c).copy(),e._.cancel.push(l),e._.interrupt.push(l),e._.end.push(u)),d.on=e}),i===0&&a()})}var Hl=0;function kt(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function Fi(){return++Hl}var wt=_e.prototype;kt.prototype={constructor:kt,select:Ml,selectAll:_l,selectChild:wt.selectChild,selectChildren:wt.selectChildren,filter:vl,merge:yl,selection:Dl,transition:Xl,call:wt.call,nodes:wt.nodes,node:wt.node,size:wt.size,empty:wt.empty,each:wt.each,on:bl,attr:el,attrTween:ol,style:Pl,styleTween:Rl,text:Fl,textTween:ql,remove:$l,tween:Gs,delay:cl,duration:fl,ease:pl,easeVarying:ml,end:zl,[Symbol.iterator]:wt[Symbol.iterator]};function Wl(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var Ul={time:null,delay:0,duration:250,ease:Wl};function Yl(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function Gl(t){var e,n;t instanceof kt?(e=t._id,t=t._name):(e=Fi(),(n=Ul).time=er(),t=t==null?null:t+"");for(var r=this._groups,i=r.length,a=0;a<i;++a)for(var o=r[a],l=o.length,u,d=0;d<l;++d)(u=o[d])&&dn(u,t,e,d,o,n||Yl(u,e));return new kt(r,this._parents,t,e)}_e.prototype.interrupt=Ws;_e.prototype.transition=Gl;function Kl(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function je(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function oe(t){return t=je(Math.abs(t)),t?t[1]:NaN}function Zl(t,e){return function(n,r){for(var i=n.length,a=[],o=0,l=t[0],u=0;i>0&&l>0&&(u+l+1>r&&(l=Math.max(1,r-u)),a.push(n.substring(i-=l,i+l)),!((u+=l+1)>r));)l=t[o=(o+1)%t.length];return a.reverse().join(e)}}function Jl(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var Ql=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function tn(t){if(!(e=Ql.exec(t)))throw new Error("invalid format: "+t);var e;return new ir({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}tn.prototype=ir.prototype;function ir(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}ir.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function jl(t){t:for(var e=t.length,n=1,r=-1,i;n<e;++n)switch(t[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+t[n])break t;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(i+1):t}var Oi;function tc(t,e){var n=je(t,e);if(!n)return t+"";var r=n[0],i=n[1],a=i-(Oi=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return a===o?r:a>o?r+new Array(a-o+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+je(t,Math.max(0,e+a-1))[0]}function Pr(t,e){var n=je(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const Ir={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:Kl,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Pr(t*100,e),r:Pr,s:tc,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function Nr(t){return t}var Rr=Array.prototype.map,Lr=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function ec(t){var e=t.grouping===void 0||t.thousands===void 0?Nr:Zl(Rr.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",i=t.decimal===void 0?".":t.decimal+"",a=t.numerals===void 0?Nr:Jl(Rr.call(t.numerals,String)),o=t.percent===void 0?"%":t.percent+"",l=t.minus===void 0?"−":t.minus+"",u=t.nan===void 0?"NaN":t.nan+"";function d(f){f=tn(f);var h=f.fill,p=f.align,y=f.sign,D=f.symbol,$=f.zero,T=f.width,w=f.comma,v=f.precision,g=f.trim,m=f.type;m==="n"?(w=!0,m="g"):Ir[m]||(v===void 0&&(v=12),g=!0,m="g"),($||h==="0"&&p==="=")&&($=!0,h="0",p="=");var S=D==="$"?n:D==="#"&&/[boxX]/.test(m)?"0"+m.toLowerCase():"",k=D==="$"?r:/[%p]/.test(m)?o:"",_=Ir[m],C=/[defgprs%]/.test(m);v=v===void 0?6:/[gprs]/.test(m)?Math.max(1,Math.min(21,v)):Math.max(0,Math.min(20,v));function A(E){var L=S,P=k,N,M,I;if(m==="c")P=_(E)+P,E="";else{E=+E;var O=E<0||1/E<0;if(E=isNaN(E)?u:_(Math.abs(E),v),g&&(E=jl(E)),O&&+E==0&&y!=="+"&&(O=!1),L=(O?y==="("?y:l:y==="-"||y==="("?"":y)+L,P=(m==="s"?Lr[8+Oi/3]:"")+P+(O&&y==="("?")":""),C){for(N=-1,M=E.length;++N<M;)if(I=E.charCodeAt(N),48>I||I>57){P=(I===46?i+E.slice(N+1):E.slice(N))+P,E=E.slice(0,N);break}}}w&&!$&&(E=e(E,1/0));var H=L.length+E.length+P.length,R=H<T?new Array(T-H+1).join(h):"";switch(w&&$&&(E=e(R+E,R.length?T-P.length:1/0),R=""),p){case"<":E=L+E+P+R;break;case"=":E=L+R+E+P;break;case"^":E=R.slice(0,H=R.length>>1)+L+E+P+R.slice(H);break;default:E=R+L+E+P;break}return a(E)}return A.toString=function(){return f+""},A}function c(f,h){var p=d((f=tn(f),f.type="f",f)),y=Math.max(-8,Math.min(8,Math.floor(oe(h)/3)))*3,D=Math.pow(10,-y),$=Lr[8+y/3];return function(T){return p(D*T)+$}}return{format:d,formatPrefix:c}}var Ie,Vi,qi;nc({thousands:",",grouping:[3],currency:["$",""]});function nc(t){return Ie=ec(t),Vi=Ie.format,qi=Ie.formatPrefix,Ie}function rc(t){return Math.max(0,-oe(Math.abs(t)))}function ic(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(oe(e)/3)))*3-oe(Math.abs(t)))}function ac(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,oe(e)-oe(t))+1}var q=1e-6,F=Math.PI,it=F/2,Br=F/4,ut=F*2,xt=180/F,et=F/180,z=Math.abs,oc=Math.atan,xe=Math.atan2,U=Math.cos,Y=Math.sin,sc=Math.sign||function(t){return t>0?1:t<0?-1:0},fn=Math.sqrt;function lc(t){return t>1?0:t<-1?F:Math.acos(t)}function be(t){return t>1?it:t<-1?-it:Math.asin(t)}function he(){}function en(t,e){t&&Or.hasOwnProperty(t.type)&&Or[t.type](t,e)}var Fr={Feature:function(t,e){en(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,r=-1,i=n.length;++r<i;)en(n[r].geometry,e)}},Or={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)t=n[r],e.point(t[0],t[1],t[2])},LineString:function(t,e){Rn(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)Rn(n[r],e,0)},Polygon:function(t,e){Vr(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)Vr(n[r],e)},GeometryCollection:function(t,e){for(var n=t.geometries,r=-1,i=n.length;++r<i;)en(n[r],e)}};function Rn(t,e,n){var r=-1,i=t.length-n,a;for(e.lineStart();++r<i;)a=t[r],e.point(a[0],a[1],a[2]);e.lineEnd()}function Vr(t,e){var n=-1,r=t.length;for(e.polygonStart();++n<r;)Rn(t[n],e,1);e.polygonEnd()}function cc(t,e){t&&Fr.hasOwnProperty(t.type)?Fr[t.type](t,e):en(t,e)}function Ln(t){return[xe(t[1],t[0]),be(t[2])]}function se(t){var e=t[0],n=t[1],r=U(n);return[r*U(e),r*Y(e),Y(n)]}function Ne(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function nn(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function xn(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function Re(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function Bn(t){var e=fn(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function Fn(t,e){function n(r,i){return r=t(r,i),e(r[0],r[1])}return t.invert&&e.invert&&(n.invert=function(r,i){return r=e.invert(r,i),r&&t.invert(r[0],r[1])}),n}function On(t,e){return z(t)>F&&(t-=Math.round(t/ut)*ut),[t,e]}On.invert=On;function uc(t,e,n){return(t%=ut)?e||n?Fn(Xr(t),zr(e,n)):Xr(t):e||n?zr(e,n):On}function qr(t){return function(e,n){return e+=t,z(e)>F&&(e-=Math.round(e/ut)*ut),[e,n]}}function Xr(t){var e=qr(t);return e.invert=qr(-t),e}function zr(t,e){var n=U(t),r=Y(t),i=U(e),a=Y(e);function o(l,u){var d=U(u),c=U(l)*d,f=Y(l)*d,h=Y(u),p=h*n+c*r;return[xe(f*i-p*a,c*n-h*r),be(p*i+f*a)]}return o.invert=function(l,u){var d=U(u),c=U(l)*d,f=Y(l)*d,h=Y(u),p=h*i-f*a;return[xe(f*i+h*a,c*n+p*r),be(p*n-c*r)]},o}function dc(t,e,n,r,i,a){if(n){var o=U(e),l=Y(e),u=r*n;i==null?(i=e+r*ut,a=e-u/2):(i=Hr(o,i),a=Hr(o,a),(r>0?i<a:i>a)&&(i+=r*ut));for(var d,c=i;r>0?c>a:c<a;c-=u)d=Ln([o,-l*U(c),-l*Y(c)]),t.point(d[0],d[1])}}function Hr(t,e){e=se(e),e[0]-=t,Bn(e);var n=lc(-e[1]);return((-e[2]<0?-n:n)+ut-q)%ut}function Xi(){var t=[],e;return{point:function(n,r,i){e.push([n,r,i])},lineStart:function(){t.push(e=[])},lineEnd:he,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}}function ze(t,e){return z(t[0]-e[0])<q&&z(t[1]-e[1])<q}function Le(t,e,n,r){this.x=t,this.z=e,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function zi(t,e,n,r,i){var a=[],o=[],l,u;if(t.forEach(function(y){if(!((D=y.length-1)<=0)){var D,$=y[0],T=y[D],w;if(ze($,T)){if(!$[2]&&!T[2]){for(i.lineStart(),l=0;l<D;++l)i.point(($=y[l])[0],$[1]);i.lineEnd();return}T[0]+=2*q}a.push(w=new Le($,y,null,!0)),o.push(w.o=new Le($,null,w,!1)),a.push(w=new Le(T,y,null,!1)),o.push(w.o=new Le(T,null,w,!0))}}),!!a.length){for(o.sort(e),Wr(a),Wr(o),l=0,u=o.length;l<u;++l)o[l].e=n=!n;for(var d=a[0],c,f;;){for(var h=d,p=!0;h.v;)if((h=h.n)===d)return;c=h.z,i.lineStart();do{if(h.v=h.o.v=!0,h.e){if(p)for(l=0,u=c.length;l<u;++l)i.point((f=c[l])[0],f[1]);else r(h.x,h.n.x,1,i);h=h.n}else{if(p)for(c=h.p.z,l=c.length-1;l>=0;--l)i.point((f=c[l])[0],f[1]);else r(h.x,h.p.x,-1,i);h=h.p}h=h.o,c=h.z,p=!p}while(!h.v);i.lineEnd()}}}function Wr(t){if(e=t.length){for(var e,n=0,r=t[0],i;++n<e;)r.n=i=t[n],i.p=r,r=i;r.n=i=t[0],i.p=r}}function bn(t){return z(t[0])<=F?t[0]:sc(t[0])*((z(t[0])+F)%ut-F)}function fc(t,e){var n=bn(e),r=e[1],i=Y(r),a=[Y(n),-U(n),0],o=0,l=0,u=new va;i===1?r=it+q:i===-1&&(r=-it-q);for(var d=0,c=t.length;d<c;++d)if(h=(f=t[d]).length)for(var f,h,p=f[h-1],y=bn(p),D=p[1]/2+Br,$=Y(D),T=U(D),w=0;w<h;++w,y=g,$=S,T=k,p=v){var v=f[w],g=bn(v),m=v[1]/2+Br,S=Y(m),k=U(m),_=g-y,C=_>=0?1:-1,A=C*_,E=A>F,L=$*S;if(u.add(xe(L*C*Y(A),T*k+L*U(A))),o+=E?_+C*ut:_,E^y>=n^g>=n){var P=nn(se(p),se(v));Bn(P);var N=nn(a,P);Bn(N);var M=(E^_>=0?-1:1)*be(N[2]);(r>M||r===M&&(P[0]||P[1]))&&(l+=E^_>=0?1:-1)}}return(o<-q||o<q&&u<-1e-12)^l&1}function Hi(t,e,n,r){return function(i){var a=e(i),o=Xi(),l=e(o),u=!1,d,c,f,h={point:p,lineStart:D,lineEnd:$,polygonStart:function(){h.point=T,h.lineStart=w,h.lineEnd=v,c=[],d=[]},polygonEnd:function(){h.point=p,h.lineStart=D,h.lineEnd=$,c=hi(c);var g=fc(d,r);c.length?(u||(i.polygonStart(),u=!0),zi(c,pc,g,n,i)):g&&(u||(i.polygonStart(),u=!0),i.lineStart(),n(null,null,1,i),i.lineEnd()),u&&(i.polygonEnd(),u=!1),c=d=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function p(g,m){t(g,m)&&i.point(g,m)}function y(g,m){a.point(g,m)}function D(){h.point=y,a.lineStart()}function $(){h.point=p,a.lineEnd()}function T(g,m){f.push([g,m]),l.point(g,m)}function w(){l.lineStart(),f=[]}function v(){T(f[0][0],f[0][1]),l.lineEnd();var g=l.clean(),m=o.result(),S,k=m.length,_,C,A;if(f.pop(),d.push(f),f=null,!!k){if(g&1){if(C=m[0],(_=C.length-1)>0){for(u||(i.polygonStart(),u=!0),i.lineStart(),S=0;S<_;++S)i.point((A=C[S])[0],A[1]);i.lineEnd()}return}k>1&&g&2&&m.push(m.pop().concat(m.shift())),c.push(m.filter(hc))}}return h}}function hc(t){return t.length>1}function pc(t,e){return((t=t.x)[0]<0?t[1]-it-q:it-t[1])-((e=e.x)[0]<0?e[1]-it-q:it-e[1])}const Ur=Hi(function(){return!0},gc,vc,[-F,-it]);function gc(t){var e=NaN,n=NaN,r=NaN,i;return{lineStart:function(){t.lineStart(),i=1},point:function(a,o){var l=a>0?F:-F,u=z(a-e);z(u-F)<q?(t.point(e,n=(n+o)/2>0?it:-it),t.point(r,n),t.lineEnd(),t.lineStart(),t.point(l,n),t.point(a,n),i=0):r!==l&&u>=F&&(z(e-r)<q&&(e-=r*q),z(a-l)<q&&(a-=l*q),n=mc(e,n,a,o),t.point(r,n),t.lineEnd(),t.lineStart(),t.point(l,n),i=0),t.point(e=a,n=o),r=l},lineEnd:function(){t.lineEnd(),e=n=NaN},clean:function(){return 2-i}}}function mc(t,e,n,r){var i,a,o=Y(t-n);return z(o)>q?oc((Y(e)*(a=U(r))*Y(n)-Y(r)*(i=U(e))*Y(t))/(i*a*o)):(e+r)/2}function vc(t,e,n,r){var i;if(t==null)i=n*it,r.point(-F,i),r.point(0,i),r.point(F,i),r.point(F,0),r.point(F,-i),r.point(0,-i),r.point(-F,-i),r.point(-F,0),r.point(-F,i);else if(z(t[0]-e[0])>q){var a=t[0]<e[0]?F:-F;i=n*a/2,r.point(-a,i),r.point(0,i),r.point(a,i)}else r.point(e[0],e[1])}function yc(t){var e=U(t),n=2*et,r=e>0,i=z(e)>q;function a(c,f,h,p){dc(p,t,n,h,c,f)}function o(c,f){return U(c)*U(f)>e}function l(c){var f,h,p,y,D;return{lineStart:function(){y=p=!1,D=1},point:function($,T){var w=[$,T],v,g=o($,T),m=r?g?0:d($,T):g?d($+($<0?F:-F),T):0;if(!f&&(y=p=g)&&c.lineStart(),g!==p&&(v=u(f,w),(!v||ze(f,v)||ze(w,v))&&(w[2]=1)),g!==p)D=0,g?(c.lineStart(),v=u(w,f),c.point(v[0],v[1])):(v=u(f,w),c.point(v[0],v[1],2),c.lineEnd()),f=v;else if(i&&f&&r^g){var S;!(m&h)&&(S=u(w,f,!0))&&(D=0,r?(c.lineStart(),c.point(S[0][0],S[0][1]),c.point(S[1][0],S[1][1]),c.lineEnd()):(c.point(S[1][0],S[1][1]),c.lineEnd(),c.lineStart(),c.point(S[0][0],S[0][1],3)))}g&&(!f||!ze(f,w))&&c.point(w[0],w[1]),f=w,p=g,h=m},lineEnd:function(){p&&c.lineEnd(),f=null},clean:function(){return D|(y&&p)<<1}}}function u(c,f,h){var p=se(c),y=se(f),D=[1,0,0],$=nn(p,y),T=Ne($,$),w=$[0],v=T-w*w;if(!v)return!h&&c;var g=e*T/v,m=-e*w/v,S=nn(D,$),k=Re(D,g),_=Re($,m);xn(k,_);var C=S,A=Ne(k,C),E=Ne(C,C),L=A*A-E*(Ne(k,k)-1);if(!(L<0)){var P=fn(L),N=Re(C,(-A-P)/E);if(xn(N,k),N=Ln(N),!h)return N;var M=c[0],I=f[0],O=c[1],H=f[1],R;I<M&&(R=M,M=I,I=R);var ft=I-M,Q=z(ft-F)<q,vt=Q||ft<q;if(!Q&&H<O&&(R=O,O=H,H=R),vt?Q?O+H>0^N[1]<(z(N[0]-M)<q?O:H):O<=N[1]&&N[1]<=H:ft>F^(M<=N[0]&&N[0]<=I)){var ot=Re(C,(-A+P)/E);return xn(ot,k),[N,Ln(ot)]}}}function d(c,f){var h=r?t:F-t,p=0;return c<-h?p|=1:c>h&&(p|=2),f<-h?p|=4:f>h&&(p|=8),p}return Hi(o,l,a,r?[0,-t]:[-F,t-F])}function wc(t,e,n,r,i,a){var o=t[0],l=t[1],u=e[0],d=e[1],c=0,f=1,h=u-o,p=d-l,y;if(y=n-o,!(!h&&y>0)){if(y/=h,h<0){if(y<c)return;y<f&&(f=y)}else if(h>0){if(y>f)return;y>c&&(c=y)}if(y=i-o,!(!h&&y<0)){if(y/=h,h<0){if(y>f)return;y>c&&(c=y)}else if(h>0){if(y<c)return;y<f&&(f=y)}if(y=r-l,!(!p&&y>0)){if(y/=p,p<0){if(y<c)return;y<f&&(f=y)}else if(p>0){if(y>f)return;y>c&&(c=y)}if(y=a-l,!(!p&&y<0)){if(y/=p,p<0){if(y>f)return;y>c&&(c=y)}else if(p>0){if(y<c)return;y<f&&(f=y)}return c>0&&(t[0]=o+c*h,t[1]=l+c*p),f<1&&(e[0]=o+f*h,e[1]=l+f*p),!0}}}}}var pe=1e9,Be=-pe;function xc(t,e,n,r){function i(d,c){return t<=d&&d<=n&&e<=c&&c<=r}function a(d,c,f,h){var p=0,y=0;if(d==null||(p=o(d,f))!==(y=o(c,f))||u(d,c)<0^f>0)do h.point(p===0||p===3?t:n,p>1?r:e);while((p=(p+f+4)%4)!==y);else h.point(c[0],c[1])}function o(d,c){return z(d[0]-t)<q?c>0?0:3:z(d[0]-n)<q?c>0?2:1:z(d[1]-e)<q?c>0?1:0:c>0?3:2}function l(d,c){return u(d.x,c.x)}function u(d,c){var f=o(d,1),h=o(c,1);return f!==h?f-h:f===0?c[1]-d[1]:f===1?d[0]-c[0]:f===2?d[1]-c[1]:c[0]-d[0]}return function(d){var c=d,f=Xi(),h,p,y,D,$,T,w,v,g,m,S,k={point:_,lineStart:L,lineEnd:P,polygonStart:A,polygonEnd:E};function _(M,I){i(M,I)&&c.point(M,I)}function C(){for(var M=0,I=0,O=p.length;I<O;++I)for(var H=p[I],R=1,ft=H.length,Q=H[0],vt,ot,Pt=Q[0],yt=Q[1];R<ft;++R)vt=Pt,ot=yt,Q=H[R],Pt=Q[0],yt=Q[1],ot<=r?yt>r&&(Pt-vt)*(r-ot)>(yt-ot)*(t-vt)&&++M:yt<=r&&(Pt-vt)*(r-ot)<(yt-ot)*(t-vt)&&--M;return M}function A(){c=f,h=[],p=[],S=!0}function E(){var M=C(),I=S&&M,O=(h=hi(h)).length;(I||O)&&(d.polygonStart(),I&&(d.lineStart(),a(null,null,1,d),d.lineEnd()),O&&zi(h,l,M,a,d),d.polygonEnd()),c=d,h=p=y=null}function L(){k.point=N,p&&p.push(y=[]),m=!0,g=!1,w=v=NaN}function P(){h&&(N(D,$),T&&g&&f.rejoin(),h.push(f.result())),k.point=_,g&&c.lineEnd()}function N(M,I){var O=i(M,I);if(p&&y.push([M,I]),m)D=M,$=I,T=O,m=!1,O&&(c.lineStart(),c.point(M,I));else if(O&&g)c.point(M,I);else{var H=[w=Math.max(Be,Math.min(pe,w)),v=Math.max(Be,Math.min(pe,v))],R=[M=Math.max(Be,Math.min(pe,M)),I=Math.max(Be,Math.min(pe,I))];wc(H,R,t,e,n,r)?(g||(c.lineStart(),c.point(H[0],H[1])),c.point(R[0],R[1]),O||c.lineEnd(),S=!1):O&&(c.lineStart(),c.point(M,I),S=!1)}w=M,v=I,g=O}return k}}const Yr=t=>t;var le=1/0,rn=le,Se=-le,an=Se,Gr={point:bc,lineStart:he,lineEnd:he,polygonStart:he,polygonEnd:he,result:function(){var t=[[le,rn],[Se,an]];return Se=an=-(rn=le=1/0),t}};function bc(t,e){t<le&&(le=t),t>Se&&(Se=t),e<rn&&(rn=e),e>an&&(an=e)}function ar(t){return function(e){var n=new Vn;for(var r in t)n[r]=t[r];return n.stream=e,n}}function Vn(){}Vn.prototype={constructor:Vn,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function or(t,e,n){var r=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),r!=null&&t.clipExtent(null),cc(n,t.stream(Gr)),e(Gr.result()),r!=null&&t.clipExtent(r),t}function Wi(t,e,n){return or(t,function(r){var i=e[1][0]-e[0][0],a=e[1][1]-e[0][1],o=Math.min(i/(r[1][0]-r[0][0]),a/(r[1][1]-r[0][1])),l=+e[0][0]+(i-o*(r[1][0]+r[0][0]))/2,u=+e[0][1]+(a-o*(r[1][1]+r[0][1]))/2;t.scale(150*o).translate([l,u])},n)}function Sc(t,e,n){return Wi(t,[[0,0],e],n)}function $c(t,e,n){return or(t,function(r){var i=+e,a=i/(r[1][0]-r[0][0]),o=(i-a*(r[1][0]+r[0][0]))/2,l=-a*r[0][1];t.scale(150*a).translate([o,l])},n)}function Mc(t,e,n){return or(t,function(r){var i=+e,a=i/(r[1][1]-r[0][1]),o=-a*r[0][0],l=(i-a*(r[1][1]+r[0][1]))/2;t.scale(150*a).translate([o,l])},n)}var Kr=16,_c=U(30*et);function Zr(t,e){return+e?Dc(t,e):Ec(t)}function Ec(t){return ar({point:function(e,n){e=t(e,n),this.stream.point(e[0],e[1])}})}function Dc(t,e){function n(r,i,a,o,l,u,d,c,f,h,p,y,D,$){var T=d-r,w=c-i,v=T*T+w*w;if(v>4*e&&D--){var g=o+h,m=l+p,S=u+y,k=fn(g*g+m*m+S*S),_=be(S/=k),C=z(z(S)-1)<q||z(a-f)<q?(a+f)/2:xe(m,g),A=t(C,_),E=A[0],L=A[1],P=E-r,N=L-i,M=w*P-T*N;(M*M/v>e||z((T*P+w*N)/v-.5)>.3||o*h+l*p+u*y<_c)&&(n(r,i,a,o,l,u,E,L,C,g/=k,m/=k,S,D,$),$.point(E,L),n(E,L,C,g,m,S,d,c,f,h,p,y,D,$))}}return function(r){var i,a,o,l,u,d,c,f,h,p,y,D,$={point:T,lineStart:w,lineEnd:g,polygonStart:function(){r.polygonStart(),$.lineStart=m},polygonEnd:function(){r.polygonEnd(),$.lineStart=w}};function T(_,C){_=t(_,C),r.point(_[0],_[1])}function w(){f=NaN,$.point=v,r.lineStart()}function v(_,C){var A=se([_,C]),E=t(_,C);n(f,h,c,p,y,D,f=E[0],h=E[1],c=_,p=A[0],y=A[1],D=A[2],Kr,r),r.point(f,h)}function g(){$.point=T,r.lineEnd()}function m(){w(),$.point=S,$.lineEnd=k}function S(_,C){v(i=_,C),a=f,o=h,l=p,u=y,d=D,$.point=v}function k(){n(f,h,c,p,y,D,a,o,i,l,u,d,Kr,r),$.lineEnd=g,g()}return $}}var kc=ar({point:function(t,e){this.stream.point(t*et,e*et)}});function Tc(t){return ar({point:function(e,n){var r=t(e,n);return this.stream.point(r[0],r[1])}})}function Ac(t,e,n,r,i){function a(o,l){return o*=r,l*=i,[e+t*o,n-t*l]}return a.invert=function(o,l){return[(o-e)/t*r,(n-l)/t*i]},a}function Jr(t,e,n,r,i,a){if(!a)return Ac(t,e,n,r,i);var o=U(a),l=Y(a),u=o*t,d=l*t,c=o/t,f=l/t,h=(l*n-o*e)/t,p=(l*e+o*n)/t;function y(D,$){return D*=r,$*=i,[u*D-d*$+e,n-d*D-u*$]}return y.invert=function(D,$){return[r*(c*D-f*$+h),i*(p-f*D-c*$)]},y}function Cc(t){return Pc(function(){return t})()}function Pc(t){var e,n=150,r=480,i=250,a=0,o=0,l=0,u=0,d=0,c,f=0,h=1,p=1,y=null,D=Ur,$=null,T,w,v,g=Yr,m=.5,S,k,_,C,A;function E(M){return _(M[0]*et,M[1]*et)}function L(M){return M=_.invert(M[0],M[1]),M&&[M[0]*xt,M[1]*xt]}E.stream=function(M){return C&&A===M?C:C=kc(Tc(c)(D(S(g(A=M)))))},E.preclip=function(M){return arguments.length?(D=M,y=void 0,N()):D},E.postclip=function(M){return arguments.length?(g=M,$=T=w=v=null,N()):g},E.clipAngle=function(M){return arguments.length?(D=+M?yc(y=M*et):(y=null,Ur),N()):y*xt},E.clipExtent=function(M){return arguments.length?(g=M==null?($=T=w=v=null,Yr):xc($=+M[0][0],T=+M[0][1],w=+M[1][0],v=+M[1][1]),N()):$==null?null:[[$,T],[w,v]]},E.scale=function(M){return arguments.length?(n=+M,P()):n},E.translate=function(M){return arguments.length?(r=+M[0],i=+M[1],P()):[r,i]},E.center=function(M){return arguments.length?(a=M[0]%360*et,o=M[1]%360*et,P()):[a*xt,o*xt]},E.rotate=function(M){return arguments.length?(l=M[0]%360*et,u=M[1]%360*et,d=M.length>2?M[2]%360*et:0,P()):[l*xt,u*xt,d*xt]},E.angle=function(M){return arguments.length?(f=M%360*et,P()):f*xt},E.reflectX=function(M){return arguments.length?(h=M?-1:1,P()):h<0},E.reflectY=function(M){return arguments.length?(p=M?-1:1,P()):p<0},E.precision=function(M){return arguments.length?(S=Zr(k,m=M*M),N()):fn(m)},E.fitExtent=function(M,I){return Wi(E,M,I)},E.fitSize=function(M,I){return Sc(E,M,I)},E.fitWidth=function(M,I){return $c(E,M,I)},E.fitHeight=function(M,I){return Mc(E,M,I)};function P(){var M=Jr(n,0,0,h,p,f).apply(null,e(a,o)),I=Jr(n,r-M[0],i-M[1],h,p,f);return c=uc(l,u,d),k=Fn(e,I),_=Fn(c,k),S=Zr(k,m),N()}function N(){return C=A=null,E}return function(){return e=t.apply(this,arguments),E.invert=e.invert&&L,P()}}function qn(t,e){return[t,e]}qn.invert=qn;function Ic(){return Cc(qn).scale(152.63)}function Nc(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function Rc(t){return function(){return t}}function Lc(t){return+t}var Qr=[0,1];function Jt(t){return t}function Xn(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:Rc(isNaN(e)?NaN:.5)}function Bc(t,e){var n;return t>e&&(n=t,t=e,e=n),function(r){return Math.max(t,Math.min(e,r))}}function Fc(t,e,n){var r=t[0],i=t[1],a=e[0],o=e[1];return i<r?(r=Xn(i,r),a=n(o,a)):(r=Xn(r,i),a=n(a,o)),function(l){return a(r(l))}}function Oc(t,e,n){var r=Math.min(t.length,e.length)-1,i=new Array(r),a=new Array(r),o=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<r;)i[o]=Xn(t[o],t[o+1]),a[o]=n(e[o],e[o+1]);return function(l){var u=ma(t,l,1,r)-1;return a[u](i[u](l))}}function Vc(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function qc(){var t=Qr,e=Qr,n=tr,r,i,a,o=Jt,l,u,d;function c(){var h=Math.min(t.length,e.length);return o!==Jt&&(o=Bc(t[0],t[h-1])),l=h>2?Oc:Fc,u=d=null,f}function f(h){return h==null||isNaN(h=+h)?a:(u||(u=l(t.map(r),e,n)))(r(o(h)))}return f.invert=function(h){return o(i((d||(d=l(e,t.map(r),st)))(h)))},f.domain=function(h){return arguments.length?(t=Array.from(h,Lc),c()):t.slice()},f.range=function(h){return arguments.length?(e=Array.from(h),c()):e.slice()},f.rangeRound=function(h){return e=Array.from(h),n=Ps,c()},f.clamp=function(h){return arguments.length?(o=h?!0:Jt,c()):o!==Jt},f.interpolate=function(h){return arguments.length?(n=h,c()):n},f.unknown=function(h){return arguments.length?(a=h,f):a},function(h,p){return r=h,i=p,c()}}function Xc(){return qc()(Jt,Jt)}function zc(t,e,n,r){var i=Sa(t,e,n),a;switch(r=tn(r??",f"),r.type){case"s":{var o=Math.max(Math.abs(t),Math.abs(e));return r.precision==null&&!isNaN(a=ic(i,o))&&(r.precision=a),qi(r,o)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(a=ac(i,Math.max(Math.abs(t),Math.abs(e))))&&(r.precision=a-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(a=rc(i))&&(r.precision=a-(r.type==="%")*2);break}}return Vi(r)}function Hc(t){var e=t.domain;return t.ticks=function(n){var r=e();return ba(r[0],r[r.length-1],n??10)},t.tickFormat=function(n,r){var i=e();return zc(i[0],i[i.length-1],n??10,r)},t.nice=function(n){n==null&&(n=10);var r=e(),i=0,a=r.length-1,o=r[i],l=r[a],u,d,c=10;for(l<o&&(d=o,o=l,l=d,d=i,i=a,a=d);c-- >0;){if(d=Dn(o,l,n),d===u)return r[i]=o,r[a]=l,e(r);if(d>0)o=Math.floor(o/d)*d,l=Math.ceil(l/d)*d;else if(d<0)o=Math.ceil(o*d)/d,l=Math.floor(l*d)/d;else break;u=d}return t},t}function Ui(){var t=Xc();return t.copy=function(){return Vc(t,Ui())},Nc.apply(t,arguments),Hc(t)}function ge(t,e,n){this.k=t,this.x=e,this.y=n}ge.prototype={constructor:ge,scale:function(t){return t===1?this:new ge(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new ge(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};ge.prototype;const at=360;let Rt=null,St=null;function Wc(t){const{root:e,isOpen:n,onCanvasToggleUpdate:r,onTimeSliderUpdate:i}=t;Rt||(Rt=e.querySelector('[data-role="sidebar"]')),St||(St=e.querySelector('[data-action="toggle-sidebar"]'));const a=e.querySelector('[data-role="canvas-toggle"]'),o=e.querySelector('[data-role="compare-info-trigger"]'),l=e.querySelector('[data-role="compare-info-overlay"]');if(!Rt||!a||!St)return;const u=n?"translateX(0)":`translateX(${at+24}px)`;Rt.style.transform=u,Rt.style.pointerEvents=n?"auto":"none",Rt.setAttribute("aria-hidden",String(!n));const d=n?`${at+10}px`:"14px";St.style.right=d,St.setAttribute("aria-label",n?"Collapse sidebar":"Expand sidebar"),St.className=n?"sidebar-toggle open":"sidebar-toggle";const c=St.querySelector("span");c&&(c.textContent=n?"›":"‹");const f=n?at+24:24;a.style.right=`${f}px`,o&&(o.style.right=`${f}px`),l&&(l.style.left=n?`${at}px`:"0",l.style.right="0"),r&&r(f),i&&i(n)}function Uc(t){const{root:e,getSidebarOpen:n,setSidebarOpen:r,onCanvasToggleUpdate:i,onTimeSliderUpdate:a}=t;Rt=e.querySelector('[data-role="sidebar"]'),St=e.querySelector('[data-action="toggle-sidebar"]'),St?.addEventListener("click",()=>{const o=!n();r(o),Wc({root:e,isOpen:o,onCanvasToggleUpdate:i,onTimeSliderUpdate:a})})}function Yc(t){const e=t?at+10:14;return`
      <button
        type="button"
        aria-label="${t?"Collapse sidebar":"Expand sidebar"}"
        data-action="toggle-sidebar"
        class="${t?"sidebar-toggle open":"sidebar-toggle"}"
        style="right: ${e}px"
      >
        <span class="sidebar-toggle-icon">${t?"›":"‹"}</span>
      </button>
    `}function Yi(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:{r:0,g:0,b:0}}const Gc=t=>t-273.15,Kc=t=>(t-273.15)*(9/5)+32,Zc=t=>t*1e3,Jc=t=>t*3.6,Qc=t=>t*2.237,jc=t=>t/1e3,Gt=t=>t;function Wt(t){switch(t){case"tas":case"tasmin":case"tasmax":return[{label:"Kelvin (K)",unit:"K",convert:Gt},{label:"Celsius (°C)",unit:"°C",convert:Gc},{label:"Fahrenheit (°F)",unit:"°F",convert:Kc}];case"pr":return[{label:"g m⁻² s⁻¹",unit:"g m⁻² s⁻¹",convert:Zc},{label:"kg m⁻² s⁻¹",unit:"kg m⁻² s⁻¹",convert:Gt}];case"rsds":case"rlds":return[{label:"W/m²",unit:"W/m²",convert:Gt},{label:"kW/m²",unit:"kW/m²",convert:jc}];case"sfcWind":return[{label:"m/s",unit:"m/s",convert:Gt},{label:"km/h",unit:"km/h",convert:Jc},{label:"mph",unit:"mph",convert:Qc}];case"hurs":return[{label:"Percent (%)",unit:"%",convert:Gt}];default:return[{label:"Default",unit:"",convert:Gt}]}}function on(t){return Wt(t)[0]}function ne(t,e,n,r){const a=Wt(e).find(o=>o.label===n);return a?r?.isDifference&&["tas","tasmin","tasmax"].includes(e)?n.includes("Celsius")?t:n.includes("Fahrenheit")?t*(9/5):t:a.convert(t):t}function Gi(t,e){return Wt(t).find(i=>i.label===e)?.unit||""}function Ki(t,e,n,r,i){const o=Wt(n).find(l=>l.label===r);return o?i?.isDifference&&["tas","tasmin","tasmax"].includes(n)?r.startsWith("Celsius")?{min:t,max:e}:r.startsWith("Fahrenheit")?{min:t*1.8,max:e*1.8}:{min:t,max:e}:{min:o.convert(t),max:o.convert(e)}:{min:t,max:e}}let _t=null,$e=[];function sr(t,e,n,r){const i=r.map(Yi);for(let a=0;a<n;a++){const l=(1-a/(n-1))*(i.length-1),u=Math.floor(l),d=Math.min(u+1,i.length-1),c=l-u,f=i[u],h=i[d],p=Math.round(f.r+(h.r-f.r)*c),y=Math.round(f.g+(h.g-f.g)*c),D=Math.round(f.b+(h.b-f.b)*c);t.fillStyle=`rgb(${p}, ${y}, ${D})`,t.fillRect(0,a,e,1)}}function tu(t,e,n,r,i,a){const o=r?.variable_metadata[t],l=o?.name||t;let u=e,d=n,c=o?.unit||"";if(i){const p=Ki(e,n,t,i,{isDifference:a});u=p.min,d=p.max,c=Gi(t,i)}const f=(d-u)/4,h=[d,d-f,d-2*f,d-3*f,u];return`
      <div class="map-legend">
        <div class="legend-title">${l}</div>
        <div class="legend-container">
        <canvas id="legend-gradient-canvas" width="20" height="200" style="width: 20px; height: 200px; border-radius: 4px;"></canvas>
          <div class="legend-labels">
            ${h.map(p=>`<span>${p.toFixed(2)} ${c}</span>`).join("")}
          </div>
        </div>
      </div>
    `}function zn(t,e){const n=document.getElementById(t);if(!n){console.warn("Legend canvas not found");return}_t=n,$e=e;const r=n.getContext("2d");if(!r)return;const i=n.width,a=n.height;sr(r,i,a,e)}function eu(t,e,n){if(!_t||$e.length===0)return;const r=_t.getContext("2d");if(!r)return;const i=_t.width,a=_t.height;sr(r,i,a,$e);const o=(t-e)/(n-e),l=Math.round(a*(1-o));r.strokeStyle="rgba(255, 255, 255, 0.95)",r.lineWidth=2,r.shadowColor="rgba(0, 0, 0, 0.8)",r.shadowBlur=4,r.beginPath(),r.moveTo(0,l),r.lineTo(i,l),r.stroke(),r.shadowBlur=0}function nu(){if(!_t||$e.length===0)return;const t=_t.getContext("2d");if(!t)return;const e=_t.width,n=_t.height;sr(t,e,n,$e)}const lr="http://localhost:8000";class Ct extends Error{statusCode;details;constructor(e,n,r){super(e),this.name="DataClientError",this.statusCode=n,this.details=r}}function ru(t){return{Historical:"historical",SSP245:"ssp245",SSP585:"ssp585"}[t]||t.toLowerCase()}function iu(t){return t===1?"low":t===2?"medium":"high"}function au(t,e,n="float32"){const r=atob(t),i=new Uint8Array(r.length);for(let a=0;a<r.length;a++)i[a]=r.charCodeAt(a);if(n.includes("float32"))return new Float32Array(i.buffer);if(n.includes("float64"))return new Float64Array(i.buffer);throw new Error(`Unsupported dtype: ${n}`)}function ou(t,e){const n=t.flat(),r=new Float32Array(n.length);for(let i=0;i<n.length;i++)r[i]=n[i];return r}async function sn(t,e){const r=`${lr}/data`;try{const i=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...t,scenario:t.scenario?ru(t.scenario):void 0,data_format:t.data_format||"base64"})});if(!i.ok){const a=await i.json().catch(()=>({detail:i.statusText}));throw new Ct(a.detail||`HTTP ${i.status}: ${i.statusText}`,i.status,a)}return await i.json()}catch(i){throw i instanceof Ct?i:new Ct(`Failed to fetch data: ${i instanceof Error?i.message:String(i)}`,void 0,i)}}async function Zi(t){const n=`${lr}/metadata`;try{const r=await fetch(n,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Ct(`HTTP ${r.status}: ${r.statusText}`,r.status);return await r.json()}catch(r){throw r instanceof Ct?r:new Ct(`Failed to fetch metadata: ${r instanceof Error?r.message:String(r)}`)}}function Me(t){return t.data?t.data instanceof Float32Array||t.data instanceof Float64Array?t.data:t.data_encoding==="none"?null:t.data_encoding==="base64"&&typeof t.data=="string"?au(t.data,t.shape,t.dtype):t.data_encoding==="list"&&Array.isArray(t.data)?ou(t.data,t.shape):null:null}function $t(t){return{variable:t.variable,time:t.date,model:t.model,scenario:t.scenario,resolution:iu(t.resolution),data_format:t.dataFormat||"base64"}}async function su(t){const n=`${lr}/health`;try{return(await fetch(n,{method:"GET",signal:AbortSignal.timeout(5e3)})).ok}catch{return!1}}let ue=null,Hn=0,Wn=1,Lt="",Bt="",He=!1;function Ji(){return ue||(ue=document.createElement("div"),ue.className="map-tooltip",document.body.appendChild(ue)),ue}function lu(t,e,n,r,i,a,o){const l=Ji();let u=i,d=a;Bt&&Lt&&(u=ne(i,Lt,Bt,{isDifference:o??He}),d=Gi(Lt,Bt)||a),l.textContent=`Lat: ${n.toFixed(2)}, Lon: ${r.toFixed(2)}, Value: ${u.toFixed(2)} ${d}`,l.style.display="block",l.style.left=`${t+10}px`,l.style.top=`${e+10}px`;let c=Hn,f=Wn;if(Bt&&Lt){const h=ne(Hn,Lt,Bt,{isDifference:o??He}),p=ne(Wn,Lt,Bt,{isDifference:o??He});c=h,f=p}eu(u,c,f)}function Qt(){const t=Ji();t.style.display="none",nu()}function cu(t,e,n,r,i){Hn=t,Wn=e,n!==void 0&&(Lt=n),r!==void 0&&(Bt=r),i!==void 0&&(He=i)}let X=1,rt=0,Et=0,Mt=!1,jr=0,ti=0,ei=0,ni=0,Z=null,Qi=null,ji=!1,ln=null,ta,ea,jt=!1,Un=null,Sn=null;function uu(t){const e=t.getContext("2d");if(!e)return null;const n=t.getBoundingClientRect();return t.width=n.width*window.devicePixelRatio,t.height=n.height*window.devicePixelRatio,e.scale(window.devicePixelRatio,window.devicePixelRatio),{ctx:e,rect:n,viewWidth:n.width,viewHeight:n.height}}function du(t,e,n,r){const i=360/n,a=180/r,o=-180+t*i+i/2,l=90-e*a-a/2;return[o,l]}function fu(t,e,n,r,i){if(t<0||t>=n||e<0||e>=r)return null;const o=(r-1-e)*n+t,l=i[o];return isFinite(l)?l:null}function $n(t){jt?t.style.cursor="crosshair":Mt?t.style.cursor="grabbing":t.style.cursor="auto"}function ri(t,e,n){if(!Z)return null;const r=t.getBoundingClientRect(),i=e-r.left,a=n-r.top;let o=(i+rt)/X;const l=(a+Et)/X,u=Z.width,d=Z.height;if(o=(o%u+u)%u,o<0||o>u||l<0||l>d)return null;const c=o/u*360-180;return{lat:90-l/d*180,lon:c}}function hu(t,e){jt=t,Un=t?e??null:null,t&&(Mt=!1)}function pu(t,e,n){if(!Z)return null;const r=Z.width,i=Z.height,a=(e+180)/360*r,o=(90-n)/180*i,l=a*X-rt,u=o*X-Et,d=t.getBoundingClientRect(),c=r*X;let f=l;for(;f<-c;)f+=c;for(;f>d.width+c;)f-=c;return u<-i*X||u>d.height+i*X?null:{x:f,y:u}}function gu(t,e,n,r,i,a){hu(a?.drawMode??!1,{onClick:a?.onDrawClick,onMove:a?.onDrawMove}),Sn=a?.onTransform??null,$n(t),t.addEventListener("wheel",o=>{o.preventDefault();const l=t.getBoundingClientRect(),u=o.clientX-l.left,d=o.clientY-l.top,c=o.deltaY>0?.9:1.1,f=X*c;if(f>=.8&&f<=10){const y=(u+rt)/X,D=(d+Et)/X;X=f,rt=y*X-u,Et=D*X-d,e&&ii(t),Sn?.()}},{passive:!1}),t.addEventListener("mousedown",o=>{if(jt&&o.button===0){const l=ri(t,o.clientX,o.clientY);l&&Un?.onClick?.(l);return}o.button===0&&(Mt=!0,jr=o.clientX,ti=o.clientY,ei=rt,ni=Et,t.style.cursor="grabbing")}),t.addEventListener("mousemove",o=>{if(jt){const l=ri(t,o.clientX,o.clientY);l&&Un?.onMove?.(l),Qt();return}if(Mt&&e){const l=o.clientX-jr,u=o.clientY-ti;rt=ei-l,Et=ni-u,ii(t),Sn?.(),Qt()}else if(!Mt&&Qi&&ln&&Z){const[l,u]=cs(o,t);mu(o.clientX,o.clientY,l,u,n,ta,ea,ji)}}),t.addEventListener("mouseup",()=>{jt||Mt&&(Mt=!1,$n(t))}),t.addEventListener("mouseleave",()=>{if(jt){Qt();return}Mt&&(Mt=!1,t.style.cursor="grab"),Qt()}),$n(t)}function ii(t){if(!Z)return;const e=t.getContext("2d");if(!e)return;const n=t.getBoundingClientRect();e.clearRect(0,0,n.width,n.height),e.save(),e.translate(-rt,-Et),e.scale(X,X),e.imageSmoothingEnabled=!0;const r=Z.width,i=rt/X,a=(rt+n.width)/X,o=Math.floor(i/r)-1,l=Math.ceil(a/r)+1;for(let u=o;u<=l;u++)e.drawImage(Z,u*r-.5,0);e.restore()}function Yn(t,e,n,r,i,a,o,l){if(!e)return;const u=Me(t);if(!u){console.warn("No data to render");return}console.log("Rendering map data (full render)");const d=uu(e);if(!d)return;const{ctx:c,rect:f,viewWidth:h,viewHeight:p}=d,[y,D]=t.shape;c.clearRect(0,0,f.width,f.height),c.save();const $=!!t?.metadata?.comparison||typeof t.model=="string"&&t.model.includes(" minus ");Qi=t,ta=o,ea=l,ji=$;const T=new Array(p).fill(null).map(()=>new Float32Array(h).fill(NaN));let w=i,v=a;if(o&&l){const R=Ki(i,a,o,l,{isDifference:$});w=R.min,v=R.max}cu(i,a,o,l,$);const S=(n.find(R=>R.name===r)||n[0]).colors.map(Yi),k=Ic().scale(h/(2*Math.PI)).translate([h/2,p/2]),_=document.createElement("canvas");_.width=h,_.height=p;const C=_.getContext("2d");if(!C)return;const A=C.createImageData(h,p),E=A.data;console.log("Rendering map data");const L=Math.max(h/D,p/y)*.8,P=Math.ceil(L/2);for(let R=0;R<y;R++)for(let ft=0;ft<D;ft++){const Q=fu(ft,R,D,y,u);if(Q===null)continue;const[vt,ot]=du(ft,R,D,y),Pt=k([vt,ot]);if(!Pt)continue;const[yt,hr]=Pt;let pr=Q;o&&l&&(pr=ne(Q,o,l,{isDifference:$}));const gr=v-w,mr=gr===0?.5:Math.min(1,Math.max(0,(pr-w)/gr)),pn=Math.floor(mr*(S.length-1)),Yt=S[Math.min(pn,S.length-1)],gn=S[Math.min(pn+1,S.length-1)],mn=mr*(S.length-1)-pn,oa=Math.round(Yt.r+(gn.r-Yt.r)*mn),sa=Math.round(Yt.g+(gn.g-Yt.g)*mn),la=Math.round(Yt.b+(gn.b-Yt.b)*mn),ca=Math.max(0,Math.floor(yt-P)),ua=Math.min(h,Math.ceil(yt+P)),da=Math.max(0,Math.floor(hr-P)),fa=Math.min(p,Math.ceil(hr+P));for(let De=da;De<fa;De++)for(let ke=ca;ke<ua;ke++){const Te=(De*h+ke)*4;E[Te]=oa,E[Te+1]=sa,E[Te+2]=la,E[Te+3]=255,T[De][ke]=Q}}C.putImageData(A,0,0),Z=_,ln=T,c.clearRect(0,0,f.width,f.height),c.save(),c.translate(-rt,-Et),c.scale(X,X),c.imageSmoothingEnabled=!0;const N=Z.width,M=rt/X,I=(rt+f.width)/X,O=Math.floor(M/N)-1,H=Math.ceil(I/N)+1;for(let R=O;R<=H;R++)c.drawImage(Z,R*N,0);c.restore()}function mu(t,e,n,r,i,a,o,l){if(!ln||!Z)return;let u=(n+rt)/X;const d=(r+Et)/X,c=Z.width,f=Z.height;u=(u%c+c)%c;const h=Math.floor(u),p=Math.floor(d);if(h>=0&&h<c&&p>=0&&p<f){const y=ln?.[p]?.[h]??0;if(isFinite(y)){const D=u/c*360-180,$=90-d/f*180;lu(t,e,$,D,y,i,l)}else Qt()}else Qt()}function At(t){const e=new Date(t);return`${["January","February","March","April","May","June","July","August","September","October","November","December"][e.getMonth()]} ${e.getDate()}, ${e.getFullYear()}`}function vu(t){const{date:e,timeRange:n,sidebarOpen:r,sidebarWidth:i,mode:a,compareMode:o,compareDateStart:l,compareDateEnd:u}=t;let d=0,c=0,f=0,h=0,p=0,y=0,D=0,$=100;if(n){const w=new Date(n.start),v=new Date(n.end),g=new Date(e);if(c=Math.floor((v.getTime()-w.getTime())/(1e3*60*60*24)),f=Math.floor((g.getTime()-w.getTime())/(1e3*60*60*24)),h=c>0?f/c*100:0,a==="Compare"&&o==="Dates"){const m=l?new Date(l):w,S=u?new Date(u):v;p=Math.max(0,Math.floor((m.getTime()-w.getTime())/(1e3*60*60*24))),y=Math.min(c,Math.floor((S.getTime()-w.getTime())/(1e3*60*60*24))),D=c>0?p/c*100:0,$=c>0?y/c*100:100}}const T=r?i+16:16;if(a==="Compare"&&o==="Dates"&&n){const w=At(l||n.start),v=At(u||n.end);return`
      <div class="time-slider-container" style="right: ${T}px">
        <div data-role="time-label" class="time-label">${w} – ${v}</div>
        <div class="time-slider-row dual-slider" data-role="dual-slider">
          <div
            class="dual-slider-track"
            aria-hidden="true"
          ></div>
          <div
            class="dual-slider-fill"
            data-role="dual-fill"
            style="--fill-start: ${D}%; --fill-end: ${$}%"
            aria-hidden="true"
          ></div>
          <input
            type="range"
            min="${d}"
            max="${c}"
            step="1"
            value="${p}"
            data-action="set-time-start"
            class="time-slider dual-thumb dual-thumb-start"
            aria-label="Start date"
          />
          <input
            type="range"
            min="${d}"
            max="${c}"
            step="1"
            value="${y}"
            data-action="set-time-end"
            class="time-slider dual-thumb dual-thumb-end"
            aria-label="End date"
          />
        </div>
      </div>
    `}return`
      <div class="time-slider-container" style="right: ${T}px">
        <div data-role="time-label" class="time-label">${At(e)}</div>
        <div class="time-slider-row">
          <input
            type="range"
            min="${d}"
            max="${c}"
            step="1"
            value="${f}"
            data-action="set-time"
            class="time-slider"
            style="--slider-fill: ${h}%"
          />
        </div>
      </div>
    `}let Kt=null,Gn=null;function yu(t){const{root:e,getTimeRange:n,onDateChange:r,getMode:i,getCompareMode:a,getCompareDates:o,onDateRangeChange:l}=t;Gn=e.querySelector('[data-role="time-label"]')?.parentElement??null;const u=()=>i?.()==="Compare"&&a?.()==="Dates";e.querySelectorAll('[data-action="set-time"]').forEach($=>$.addEventListener("input",()=>{if(u())return;const T=Number.parseInt($.value,10),w=n();if(!Number.isNaN(T)&&w){const v=new Date(w.start);v.setDate(v.getDate()+T);const g=v.toISOString().split("T")[0],m=e.querySelector('[data-role="time-label"]');m&&(m.textContent=At(g));const S=new Date(w.end),k=Math.floor((S.getTime()-new Date(w.start).getTime())/(1e3*60*60*24)),_=k>0?T/k*100:0;$.style.setProperty("--slider-fill",`${_}%`),Kt&&window.clearTimeout(Kt),Kt=window.setTimeout(()=>{r(g)},500)}}));const c=e.querySelectorAll('[data-action="set-time-start"]'),f=e.querySelectorAll('[data-action="set-time-end"]'),h=e.querySelector('[data-role="dual-fill"]'),p=($,T,w,v,g)=>{const m=e.querySelector('[data-role="time-label"]'),S=new Date(w.start),k=new Date(w.start);S.setDate(S.getDate()+$),k.setDate(k.getDate()+T);const _=S.toISOString().split("T")[0],C=k.toISOString().split("T")[0];m&&(m.textContent=`${At(_)} – ${At(C)}`);const A=new Date(w.end).getTime()-new Date(w.start).getTime(),E=Math.max(1,Math.floor(A/(1e3*60*60*24))),L=$/E*100,P=T/E*100;[h,v,g].forEach(M=>{M&&(M.style.setProperty("--fill-start",`${L}%`),M.style.setProperty("--fill-end",`${P}%`))})},y=($,T,w)=>{$.addEventListener("input",()=>{if(!u())return;const v=n();if(!v)return;const g=Math.floor((new Date(v.end).getTime()-new Date(v.start).getTime())/(1e3*60*60*24));let m=Number.parseInt(w?$.value:T.value,10),S=Number.parseInt(w?T.value:$.value,10);if(Number.isNaN(m)||Number.isNaN(S))return;m=Math.max(0,Math.min(m,g)),S=Math.max(0,Math.min(S,g)),w&&m>S?(S=m,T.value=String(S)):!w&&S<m&&(m=S,T.value=String(m)),p(m,S,v,w?$:T,w?T:$);const k=new Date(v.start);k.setDate(k.getDate()+m);const _=new Date(v.start);_.setDate(_.getDate()+S);const C=k.toISOString().split("T")[0],A=_.toISOString().split("T")[0];Kt&&window.clearTimeout(Kt),Kt=window.setTimeout(()=>{l?.(C,A)},300)})},D=$=>{const T=c[0],w=f[0];!T||!w||($==="start"?(T.style.zIndex="4",w.style.zIndex="3"):(T.style.zIndex="3",w.style.zIndex="4"))};if(c.length&&f.length){c.forEach((w,v)=>{const g=f[v]||f[0];y(w,g,!0),w.addEventListener("pointerdown",()=>D("start"))}),f.forEach((w,v)=>{const g=c[v]||c[0];y(w,g,!1),w.addEventListener("pointerdown",()=>D("end"))}),c.forEach(w=>w.addEventListener("focus",()=>D("start"))),f.forEach(w=>w.addEventListener("focus",()=>D("end")));const $=(w,v)=>{w.addEventListener("pointerdown",g=>{if(!u())return;const m=n();if(!m)return;const S=w.getBoundingClientRect(),k=Math.min(1,Math.max(0,(g.clientX-S.left)/S.width)),_=Math.max(1,Math.floor((new Date(m.end).getTime()-new Date(m.start).getTime())/(1e3*60*60*24))),C=Number.parseInt(w.value,10),E=(Number.isNaN(C)?0:Math.max(0,Math.min(C,_)))/_;Math.abs(k-E)*S.width>14&&(g.preventDefault(),g.stopPropagation(),D(w===v?"end":"start"))})};if($(c[0],f[0]),$(f[0],c[0]),u()){const w=n(),v=o?.();if(w&&v){const g=Math.max(0,Math.floor((new Date(v.start).getTime()-new Date(w.start).getTime())/864e5)),m=Math.max(0,Math.floor((new Date(v.end).getTime()-new Date(w.start).getTime())/(1e3*60*60*24))),S=c[0],k=f[0];S.value=String(g),k.value=String(Math.max(m,g)),p(g,Math.max(m,g),w,S,k)}}e.querySelectorAll(".dual-slider").forEach(w=>{w.addEventListener("pointermove",v=>{if(!u())return;const g=n();if(!g)return;const m=c[0],S=f[0];if(!m||!S)return;const k=w.getBoundingClientRect(),_=Math.min(1,Math.max(0,(v.clientX-k.left)/k.width)),C=Math.max(1,Math.floor((new Date(g.end).getTime()-new Date(g.start).getTime())/(1e3*60*60*24)));let A=Number.parseInt(m.value,10),E=Number.parseInt(S.value,10);Number.isNaN(A)&&(A=0),Number.isNaN(E)&&(E=C);const L=A/C,P=E/C,N=Math.abs(_-L)<=Math.abs(_-P);D(N?"start":"end")})})}}function wu(t,e){if(Gn){const n=t?e+16:16;Gn.style.right=`${n}px`}}function cr(t){const e=t.toLowerCase();return e==="historical"?"Historical":e==="ssp245"?"SSP245":e==="ssp370"?"SSP370":e==="ssp585"?"SSP585":t}function Vt(t){return new Date(t)}function ur(t){if(!t.length)return Ut("Historical");let e="1900-01-01",n="2100-12-31";return t.forEach((r,i)=>{const a=Ut(r);if(i===0){e=a.start,n=a.end;return}e=Vt(a.start)>Vt(e)?a.start:e,n=Vt(a.end)<Vt(n)?a.end:n}),{start:e,end:n}}function Kn(t,e){const n=Vt(t),r=Vt(e.start),i=Vt(e.end);return n<r?e.start:n>i?e.end:t}const Dt=["Historical","SSP245","SSP370","SSP585"],nt=["ACCESS-CM2","CanESM5","CESM2","CMCC-CM2-SR5","EC-Earth3","GFDL-ESM4","INM-CM5-0","IPSL-CM6A-LR","MIROC6","MPI-ESM1-2-HR","MRI-ESM2-0"],qt=["tas","pr","rsds","hurs","rlds","sfcWind","tasmin","tasmax"],J=[{name:"Viridis",colors:["#440154","#3b528b","#21908d","#5dc863","#fde725"]},{name:"Magma",colors:["#000004","#3b0f70","#8c2981","#de4968","#fe9f6d"]},{name:"Cividis",colors:["#00204c","#31456a","#6b6d7f","#a59c8f","#fdea9b"]},{name:"Thermal",colors:["#04142f","#155570","#1fa187","#f8c932","#f16623"]}],b={page:{position:"relative",minHeight:"100vh",color:"white",overflow:"hidden",fontFamily:"Inter, system-ui, sans-serif"},bgLayer1:{position:"absolute",inset:0,background:"linear-gradient(135deg, #05070f, #0b1326)"},bgLayer2:{position:"absolute",inset:0,background:"radial-gradient(circle at 20% 20%, rgba(56,189,248,0.12), transparent 32%), radial-gradient(circle at 80% 10%, rgba(139,92,246,0.15), transparent 30%), radial-gradient(circle at 50% 70%, rgba(34,197,94,0.08), transparent 28%)"},bgOverlay:{position:"absolute",inset:0,background:"#050505",opacity:.35},branding:{position:"fixed",top:16,left:16,display:"flex",alignItems:"center",gap:12,padding:"8px 0",background:"transparent",border:"none",borderRadius:0,zIndex:"9999",boxShadow:"none",backdropFilter:"none",pointerEvents:"auto"},brandIcon:{width:38,height:38,position:"relative",display:"grid",placeItems:"center",filter:"drop-shadow(0 8px 18px rgba(0, 0, 0, 0.42))",transition:"transform 160ms ease, filter 160ms ease","--iris-x":"0px","--iris-y":"0px","--pupil-x":"0px","--pupil-y":"0px","--blink-open":"1"},brandSvg:{width:"100%",height:"100%",display:"block"},brandOutline:{stroke:"white",strokeWidth:5,strokeLinecap:"round",strokeLinejoin:"round",fill:"none",opacity:.92},brandLids:{transform:"translate(60px, 40px) scaleY(var(--blink-open, 1)) translate(-60px, -40px)",transformOrigin:"60px 40px",transition:"none"},brandClipRect:{transform:"translate(60px, 40px) scaleY(var(--blink-open, 1)) translate(-60px, -40px)",transformOrigin:"60px 40px",transition:"none"},brandIrisGroup:{transform:"translate(var(--iris-x, 0px), var(--iris-y, 0px))",transition:"none",transformBox:"fill-box",transformOrigin:"center center"},brandIris:{stroke:"white",strokeWidth:5,fill:"rgba(255, 255, 255, 0.08)"},brandPupilGroup:{transform:"translate(var(--pupil-x, 0px), var(--pupil-y, 0px))",transition:"none",transformOrigin:"center center"},brandEyeContent:{clipPath:"url(#brand-eye-clip)"},brandPupil:{fill:"white"},brandHighlight:{fill:"white",opacity:.92},brandName:{fontSize:18,fontWeight:700,letterSpacing:.6,color:"white",textTransform:"none",textShadow:"0 8px 20px rgba(0, 0, 0, 0.45)"},field:{minWidth:0,display:"flex",flexDirection:"column",gap:4},fieldLabel:{fontSize:11,letterSpacing:.5,color:"var(--text-secondary)",textTransform:"uppercase"},mapArea:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:10,textAlign:"center",pointerEvents:"none",zIndex:1},drawOverlay:{position:"absolute",inset:0,background:"rgba(5, 10, 20, 0.28)",backdropFilter:"blur(1px)",pointerEvents:"none",zIndex:8},drawOverlayCanvas:{position:"absolute",inset:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:9},drawPrompt:{position:"absolute",top:16,left:"50%",transform:"translateX(-50%)",padding:"10px 14px",borderRadius:12,background:"rgba(15, 23, 42, 0.92)",border:"1px solid var(--border-medium)",boxShadow:"var(--shadow-elevated)",fontWeight:800,fontSize:13,color:"var(--text-primary)",pointerEvents:"none",zIndex:10,textAlign:"center"},drawPromptSub:{marginTop:4,fontSize:12,fontWeight:600,color:"var(--text-secondary)"},loadingIndicator:{position:"absolute",left:18,bottom:80,display:"flex",alignItems:"center",gap:12,padding:0,pointerEvents:"auto",zIndex:20,minWidth:160},loadingSpinner:{width:18,height:18,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.18)",borderTop:"2px solid #34d399",animation:"sv-spin 1s linear infinite",flexShrink:0},loadingTextGroup:{display:"flex",flexDirection:"column",gap:4,alignItems:"flex-start",minWidth:0},loadingText:{fontSize:12.5,fontWeight:700,color:"var(--text-primary)",letterSpacing:.3},loadingSubtext:{fontSize:11.5,color:"var(--text-secondary)",letterSpacing:.2},loadingBar:{position:"relative",width:120,height:6,borderRadius:999,background:"rgba(255, 255, 255, 0.08)",overflow:"hidden"},loadingBarFill:{position:"absolute",inset:0,borderRadius:999,background:"linear-gradient(90deg, rgba(52, 211, 153, 0.9), rgba(125, 211, 252, 0.9))",transition:"width 140ms ease",width:"0%"},compareInfoWrap:{position:"fixed",right:24,bottom:88,display:"flex",alignItems:"center",pointerEvents:"auto",zIndex:1e4},compareInfoButton:{padding:0,background:"transparent",border:"none",color:"var(--text-primary)",fontWeight:700,fontSize:13,letterSpacing:.2,cursor:"pointer",textDecoration:"underline"},infoModalOverlay:{position:"fixed",inset:0,background:"transparent",backdropFilter:"none",zIndex:200,display:"flex",alignItems:"center",justifyContent:"center",padding:16},infoModal:{width:"min(480px, 92vw)",background:"rgba(12, 16, 24, 0.98)",border:"1px solid var(--border-default)",borderRadius:14,boxShadow:"var(--shadow-elevated)",color:"var(--text-primary)",padding:20,position:"relative",maxWidth:"520px"},infoModalHeader:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,marginBottom:12},infoModalTitle:{fontSize:16,fontWeight:900,letterSpacing:.2,background:"var(--gradient-accent)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",color:"transparent"},infoModalClose:{width:32,height:32,borderRadius:8,border:"none",background:"transparent",color:"var(--text-secondary)",cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",fontWeight:700},infoModalBody:{fontSize:14,lineHeight:1.6,color:"var(--text-primary)",display:"block",textAlign:"left",whiteSpace:"normal",wordBreak:"break-word"},infoModalFooter:{marginTop:18,display:"flex",justifyContent:"center"},infoModalConfirm:{padding:"10px 16px",borderRadius:10,border:"1px solid var(--accent-border)",background:"var(--gradient-primary)",color:"white",fontWeight:700,cursor:"pointer",boxShadow:"var(--shadow-combined)"},canvasToggle:{position:"fixed",top:14,display:"flex",alignItems:"center",gap:8,pointerEvents:"auto",zIndex:100,transition:"right 0.25s ease"},canvasSwitch:{position:"relative",display:"grid",gridTemplateColumns:"1fr 1fr",gap:0,padding:3,borderRadius:11,background:"var(--dark-bg)",border:"var(--border-base)",boxShadow:"var(--shadow-elevated)",zIndex:101},canvasIndicator:{position:"absolute",top:3,bottom:3,left:3,width:"calc(50% - 3px)",borderRadius:9,background:"var(--gradient-indicator)",boxShadow:"var(--shadow-canvas), var(--shadow-inset)",transition:"transform 180ms ease",zIndex:0,pointerEvents:"none"},canvasBtn:{width:40,height:40,borderRadius:9,border:"1px solid transparent",background:"var(--bg-transparent)",color:"var(--text-secondary)",cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",transition:"color 120ms ease",position:"relative",zIndex:1},canvasBtnActive:{color:"white"},mapTitle:{fontSize:18,fontWeight:600},mapSubtitle:{fontSize:14,color:"var(--text-secondary)"},modeSwitch:{position:"relative",display:"grid",gridTemplateColumns:"1fr 1fr",gap:4,padding:2,borderRadius:10,border:"1px solid var(--border-subtle)",background:"var(--bg-subtle)",boxShadow:"none"},modeIndicator:{position:"absolute",top:2,bottom:2,left:2,width:"calc(50% - 2px)",borderRadius:8,background:"var(--gradient-mode-indicator)",boxShadow:"var(--shadow-combined)",transition:"transform 200ms ease",zIndex:0},modeBtn:{flex:1,padding:"8px 0",borderRadius:8,border:"none",color:"var(--text-secondary)",cursor:"pointer",transition:"all 0.15s ease",background:"var(--bg-transparent)",textAlign:"center",fontSize:12.5,fontWeight:700,letterSpacing:.2,outline:"none",boxShadow:"none",position:"relative",zIndex:1},modeBtnActive:{background:"var(--gradient-primary)",border:"none",color:"white",boxShadow:"var(--shadow-combined)"},tabSwitch:{position:"absolute",left:32,right:12,bottom:-8,display:"flex",gap:10,padding:"0 8px",alignItems:"flex-end",pointerEvents:"auto",zIndex:0},tabBtn:{borderRadius:"14px 14px 0 0",padding:"12px 18px",background:"var(--bg-strong)",color:"var(--text-secondary)",fontWeight:700,fontSize:13,letterSpacing:.35,cursor:"pointer",transition:"all 0.18s ease",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.06), 0 8px 18px rgba(0,0,0,0.32)",borderTop:"var(--border-base)",borderRight:"var(--border-base)",borderLeft:"var(--border-base)",borderBottom:"none",transform:"translateY(4px)"},tabBtnActive:{background:"var(--gradient-tab-active)",color:"white",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.12), 0 12px 26px rgba(0,0,0,0.42)",borderTop:"var(--border-active)",borderRight:"var(--border-active)",borderLeft:"var(--border-active)",borderBottom:"none",transform:"translateY(-4px)",zIndex:1},modeViewport:{overflow:"hidden",width:"100%",position:"relative",flex:1,minHeight:0,height:0},modeTrack:{display:"grid",gridTemplateColumns:"1fr 1fr",width:"200%",height:"100%",transition:"transform 220ms ease"},modePane:{width:"100%",height:"100%",paddingRight:4,overflowY:"auto",overflowX:"hidden",scrollbarGutter:"stable",minHeight:0,maxHeight:"100%"},chatBox:{display:"flex",alignItems:"center",gap:10,padding:"12px 14px",borderRadius:14,border:"1px solid var(--border-default)",background:"rgba(15,18,25,0.96)",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.05), 0 8px 20px rgba(0,0,0,0.38)"},chatInput:{flex:1,padding:"12px 0",borderRadius:8,border:"none",background:"var(--bg-transparent)",color:"white",fontSize:14,lineHeight:1.4,outline:"none",minHeight:24},chatSend:{padding:"10px 14px",borderRadius:12,border:"1px solid var(--accent-border-strong)",background:"var(--gradient-primary)",color:"white",fontWeight:700,fontSize:14,letterSpacing:.1,cursor:"pointer",boxShadow:"0 10px 22px rgba(0,0,0,0.38), var(--shadow-inset)",transition:"transform 120ms ease, box-shadow 120ms ease"},chatStack:{display:"flex",flexDirection:"column",gap:12},chatLead:{fontSize:13,color:"var(--text-secondary)",lineHeight:1.45,marginTop:10},chatMessages:{display:"flex",flexDirection:"column",gap:10,padding:"4px 0 6px",paddingRight:0,width:"100%",boxSizing:"border-box"},chatBubble:{maxWidth:"100%",width:"fit-content",padding:"16px 16px",borderRadius:12,fontSize:13,lineHeight:1.4,boxShadow:"0 6px 14px rgba(0,0,0,0.3)",boxSizing:"border-box"},chatBubbleUser:{alignSelf:"flex-end",background:"var(--gradient-chat-user)",border:"1px solid rgba(125,211,252,0.45)",color:"white",marginRight:26},chatBubbleAgent:{alignSelf:"flex-start",background:"rgba(20,24,31,0.95)",border:"1px solid var(--border-medium)",color:"var(--text-primary)"},sectionTitle:{fontSize:13,fontWeight:700,color:"var(--text-primary)",letterSpacing:.3,textTransform:"uppercase"},paramGrid:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},range:{width:"100%",background:"var(--bg-transparent)",appearance:"none",WebkitAppearance:"none",height:10,outline:"none",padding:0,margin:0},resolutionRow:{display:"flex",alignItems:"center",gap:12},resolutionValue:{fontSize:12.5,color:"var(--text-secondary)",minWidth:60,textAlign:"right"},chartPanel:{width:"min(1200px, 100%)",background:"transparent",border:"none",borderRadius:0,padding:0,boxShadow:"none",backdropFilter:"none"},chartHeader:{textAlign:"center",marginBottom:12},chartTitle:{fontSize:18,fontWeight:800,color:"var(--text-primary)"},chartPlotWrapper:{width:"100%",minHeight:360,background:"transparent",border:"none",borderRadius:0,padding:0,position:"relative"},chartEmpty:{textAlign:"center",color:"var(--text-secondary)",padding:"40px 16px",lineHeight:1.6},chartError:{color:"#fca5a5",background:"rgba(248,113,113,0.08)",border:"1px solid rgba(248,113,113,0.35)",borderRadius:12,padding:14,fontSize:13,lineHeight:1.5},chipRow:{display:"flex",flexWrap:"wrap",gap:8},chip:{padding:"8px 10px",borderRadius:12,border:"1px solid var(--border-medium)",background:"rgba(255,255,255,0.04)",color:"var(--text-primary)",cursor:"pointer",fontSize:12.5,fontWeight:700,letterSpacing:.2,transition:"all 140ms ease"},chipActive:{borderColor:"rgba(167,139,250,0.65)",background:"rgba(167,139,250,0.16)",boxShadow:"0 0 0 1px rgba(167,139,250,0.35)"}},s={mode:"Explore",panelTab:"Manual",sidebarOpen:!0,canvasView:"map",scenario:Dt[0],model:nt[0],variable:qt[0],date:"2000-01-01",palette:J[0].name,resolution:2,selectedUnit:on(qt[0]).label,chartMode:"single",chartDate:"2026-01-16",chartVariable:qt[0],chartUnit:on(qt[0]).label,chartScenarios:["SSP245","SSP370","SSP585"],chartModels:[...nt],chartDropdown:{scenariosOpen:!1,modelsOpen:!1},chartLoadingProgress:{total:0,done:0},chartSamples:[],chartBoxes:null,chartLoading:!1,chartError:null,chartLocation:"World",chartPolygon:null,chartPoint:null,drawState:{active:!1,points:[],previewPoint:null},pointSelectActive:!1,chatInput:"",chatMessages:[],compareMode:"Scenarios",availableModels:[],compareModelA:nt[0],compareModelB:nt[1]??nt[0],compareDateStart:"1962-06-28",compareDateEnd:"2007-06-28",isLoading:!1,loadingProgress:0,dataError:null,currentData:null,apiAvailable:null,dataMin:null,dataMax:null,timeRange:null,metaData:void 0,compareInfoOpen:!1};let Mn=null,pt=null,re=null,G=null,Fe=null,It=null,Tt=null,Nt=null,bt=null;function xu(t){return t.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}function x(t){return Object.entries(t).filter(([,e])=>e!=null).map(([e,n])=>{const r=e.startsWith("--")?e:xu(e),i=typeof n=="number"?`${n}px`:String(n);return`${r}:${i}`}).join(";")}function K(...t){return t.reduce((e,n)=>n?{...e,...n}:e,{})}function me(t){const e=new Date(t);return Number.isNaN(e.getTime())?t:e.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}function na(t,e){return e?.variable_metadata?.[t]?.name||e?.variable_metadata?.[t]?.description||t}function bu(t){const e=na(t.variable,t.metaData),n=t.selectedUnit||t.metaData?.variable_metadata?.[t.variable]?.unit||"",r=n?`${n}`:"the dataset's native units";switch(t.compareMode){case"Dates":{const i=me(t.compareDateStart),a=me(t.compareDateEnd);return{title:"Comparing two dates",paragraphs:[`We are comparing ${e} on ${i} versus ${a} under the ${t.scenario} scenario using the ${t.model} model.`,`Values on the map represent ${a} minus ${i} in ${r}. A value of X means ${e} was X ${n||""} higher on ${a} than on ${i} (negative values mean it was lower).`]}}case"Models":{const i=me(t.date);return{title:"Comparing two models",paragraphs:[`We are comparing ${e} between ${t.compareModelB} and ${t.compareModelA} on ${i} within the ${t.scenario} scenario.`,`Each value shows ${t.compareModelB} minus ${t.compareModelA} in ${r}. Positive numbers mean ${e} is higher in ${t.compareModelB}; negative means it is higher in ${t.compareModelA}.`]}}default:{const i=me(t.date),a="SSP245",o="SSP585";return{title:"Comparing two scenarios",paragraphs:[`We are comparing ${e} for ${o} versus ${a} on ${i} using the ${t.model} model.`,`Values show ${o} minus ${a} in ${r}. A value of X means ${e} is X ${n||""} higher under ${o} than under ${a}; negative values mean it is lower.`]}}}}function Su(t){if(t.mode!=="Compare"||t.canvasView!=="map")return"";const e=bu(t),n=e.paragraphs.map((u,d)=>{const f=d===e.paragraphs.length-1?"0":"0 0 12px 0",h=u.replace(/(\bX\b|ΔX)/g,'<span style="color: var(--accent-purple);">$1</span>');return`<p style="display:block; margin:${f}; line-height:1.6; white-space: normal; word-break: break-word;">${h}</p>`}).join(""),r=t.sidebarOpen?at+24:24,i=t.mode==="Compare"&&t.compareMode==="Dates"?120:88,a=K(b.infoModalOverlay,{left:"0",right:"0",width:"100%",justifyContent:"center",paddingLeft:0}),o=K(b.infoModal,{alignSelf:"center",marginLeft:"auto",marginRight:"auto"}),l=t.compareInfoOpen?`
      <div data-role="compare-info-overlay" class="compare-info-overlay" style="${x(a)}">
        <div style="${x(o)}" role="dialog" aria-modal="true" aria-label="${e.title}">
          <div style="${x(b.infoModalHeader)}">
            <div style="${x(b.infoModalTitle)}">${e.title}</div>
            <button type="button" data-action="close-compare-info" style="${x(b.infoModalClose)}" aria-label="Close info dialog">✕</button>
          </div>
          <div style="${x(b.infoModalBody)}">
            ${n}
          </div>
          <div style="${x(b.infoModalFooter)}">
            <button type="button" data-action="close-compare-info" style="${x(b.infoModalConfirm)}">Got it</button>
          </div>
        </div>
      </div>
    `:"";return`
      <div data-role="compare-info-trigger" style="${x(K(b.compareInfoWrap,{right:r,bottom:i}))}">
        <button type="button" data-action="open-compare-info" style="${x(b.compareInfoButton)}">
          What am I seeing?
        </button>
      </div>
      ${l}
    `}async function $u(){try{const t=await su();s.apiAvailable=t}catch{s.apiAvailable=!1}}function Mu(t){if(t==="Historical")return"2000-01-01";const e=new Date,n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return n<2015?"2015-01-01":n>2100?"2100-12-31":`${n}-${r}-${i}`}function Ut(t){return t==="Historical"?{start:"1950-01-01",end:"2014-12-31"}:{start:"2015-01-01",end:"2100-12-31"}}function te(t,e){const n=Ut(e),r=new Date(t),i=new Date(n.start),a=new Date(n.end);return r<i?n.start:r>a?n.end:t}function _u(t){let e=1/0,n=-1/0;for(let r=0;r<t.length;r++){const i=t[r];isFinite(i)&&(e=Math.min(e,i),n=Math.max(n,i))}if(!isFinite(e)||!isFinite(n))throw new Error("No valid numeric values returned from dataset.");return{min:e,max:n}}function Eu(t,e){let n=0,r=0;for(let i=0;i<t.length;i++){const a=t[i];if(!isFinite(a))continue;const o=e==="hurs"?Math.min(a,100):a;n+=o,r+=1}if(!r)throw new Error("No valid numeric values returned from dataset.");return n/r}function Du(t,e){let n=!1;for(let r=0,i=e.length-1;r<e.length;i=r++){const a=e[r].lon,o=e[r].lat,l=e[i].lon,u=e[i].lat;o>t.lat!=u>t.lat&&t.lon<(l-a)*(t.lat-o)/(u-o+Number.EPSILON)+a&&(n=!n)}return n}function ku(t,e,n,r){const[i,a]=n,o=360/a,l=180/i;let u=0,d=0;for(let c=0;c<i;c++){const f=90-c*l-l/2;for(let h=0;h<a;h++){const p=-180+h*o+o/2,y=(i-1-c)*a+h,D=t[y];if(!isFinite(D))continue;const $=e==="hurs"?Math.min(D,100):D;Du({lat:f,lon:p},r)&&(u+=$,d+=1)}}if(!d)throw new Error("The selected region does not contain valid data points.");return u/d}function Tu(t,e,n=.75){const r=t.lat-e.lat,i=t.lon-e.lon;return Math.hypot(r,i)<=n}function Au(t,e,n,r){const[i,a]=n,o=((r.lon+180)%360+360)%360,l=Math.min(a-1,Math.max(0,Math.floor(o/360*a))),u=Math.min(i-1,Math.max(0,Math.floor((90-r.lat)/180*i))),d=(i-1-u)*a+l,c=t[d];if(!Number.isFinite(c))throw new Error("No valid data at the selected point.");return ne(c,e,s.chartUnit)}function dr(){return{active:!1,points:[],previewPoint:null}}function Cu(t){re||(re=e=>{e.key==="Enter"&&s.drawState.active&&(e.preventDefault(),t())},window.addEventListener("keydown",re))}function ra(){re&&(window.removeEventListener("keydown",re),re=null)}function fr(t){const e=s.drawState.active||s.pointSelectActive,n=s.metaData?.variable_metadata[s.variable]?.unit||"";gu(t,s.currentData,n,s.variable,s.selectedUnit,{drawMode:e,onDrawClick:s.pointSelectActive?Fu:Bu,onDrawMove:s.drawState.active?Lu:void 0,onTransform:()=>{hn(),ai()}}),ai()}function hn(){if(!G)return;const t=G.querySelector("#draw-overlay-canvas"),e=pt||G.querySelector("#map-canvas");if(!t||!e)return;const n=e.getBoundingClientRect(),r=window.devicePixelRatio||1;t.width=n.width*r,t.height=n.height*r,t.style.width=`${n.width}px`,t.style.height=`${n.height}px`;const i=t.getContext("2d");if(!i)return;i.save(),i.scale(r,r),i.clearRect(0,0,n.width,n.height);const a=[...s.drawState.points],o=s.drawState.previewPoint?[...a,s.drawState.previewPoint]:a,l=[];if(o.forEach(u=>{const d=pu(e,u.lon,u.lat);d&&l.push(d)}),!l.length){i.restore();return}i.lineWidth=2,i.strokeStyle="#34d399",i.fillStyle="rgba(52,211,153,0.18)",i.beginPath(),i.moveTo(l[0].x,l[0].y);for(let u=1;u<l.length;u++)i.lineTo(l[u].x,l[u].y);l.length>2&&(i.closePath(),i.fill()),i.stroke(),l.forEach(({x:u,y:d},c)=>{i.beginPath(),i.fillStyle=c===0?"#10b981":"#34d399",i.arc(u,d,4,0,Math.PI*2),i.fill(),i.strokeStyle="#0f172a",i.lineWidth=1,i.stroke()}),i.restore()}function Pu(){return s.drawState.active?`
      <div style="${x(b.drawOverlay)}"></div>
      <canvas
        id="draw-overlay-canvas"
        style="${x(b.drawOverlayCanvas)}"
      ></canvas>
      <div style="${x(b.drawPrompt)}">
        <div>Draw the region you want to explore</div>
        <div style="${x(b.drawPromptSub)}">
          Click to add points · Enter or click first point to finish
        </div>
      </div>
    `:""}function ai(){if(!G)return;const t=G.querySelector("#point-overlay-marker"),e=pt||G.querySelector("#map-canvas");!t||!e||!s.pointSelectActive||(t.style.left="0px",t.style.top="0px",t.style.right="0px",t.style.bottom="0px",t.style.width="100%",t.style.height="100%")}function Iu(){return s.pointSelectActive?`
      <div style="${x(b.drawOverlay)}"></div>
      <div
        id="point-overlay-marker"
        style="${x({position:"absolute",inset:0,pointerEvents:"none",zIndex:9})}"
      ></div>
      <div style="${x(b.drawPrompt)}">
        <div>Click a point to sample</div>
        <div style="${x(b.drawPromptSub)}">
          The chart will load data for this single location
        </div>
      </div>
    `:""}function _n(){s.chartLocation="Draw",s.chartPolygon=null,s.chartError=null,s.pointSelectActive=!1,s.drawState={active:!0,points:[],previewPoint:null},s.canvasView="map",Cu(ia),B(),ht()}function Nu(){s.drawState=dr(),ra()}function En(){s.chartLocation="Point",s.chartPolygon=null,s.chartPoint=null,s.chartError=null,s.drawState=dr(),s.pointSelectActive=!0,s.canvasView="map",B(),ht()}function Ru(){s.pointSelectActive=!1}function Lu(t){s.drawState.active&&(s.drawState={...s.drawState,previewPoint:t},hn())}function Bu(t){if(!s.drawState.active)return;const e=s.drawState.points;if(e.length>=3&&Tu(t,e[0])){ia();return}s.drawState={...s.drawState,points:[...e,t],previewPoint:t},hn()}function Fu(t){s.pointSelectActive&&(s.chartPoint=t,s.pointSelectActive=!1,s.chartError=null,s.canvasView="chart",B(),Ft())}function ia(){if(s.drawState.active){if(s.drawState.points.length<3){s.chartError="Draw at least three points to define a region.",B();return}s.chartPolygon=s.drawState.points,s.drawState=dr(),ra(),s.chartError=null,s.canvasView="chart",B(),Ft()}}function Ou(t){const e=t.filter(o=>Number.isFinite(o)).sort((o,l)=>o-l);if(!e.length)throw new Error("No valid values available to build chart statistics.");const n=vn(e,.25)??e[0],r=vn(e,.5)??e[Math.floor(e.length/2)],i=vn(e,.75)??e[e.length-1],a=$a(e)??e[0];return{min:e[0],q1:n,median:r,q3:i,max:e[e.length-1],mean:a,count:e.length}}function aa(t,e,n){const r=new Map;return t.forEach(i=>{const a=r.get(i.scenario)??[];a.push(i),r.set(i.scenario,a)}),Array.from(r.entries()).map(([i,a])=>{const o=a.map(u=>{const d=ne(u.rawValue,e,n);return{...u,value:d}}),l=Ou(o.map(u=>u.value));return{scenario:i,dateUsed:a[0]?.dateUsed??"",samples:o,stats:l}})}function Vu(t,e,n,r){const i=Me(t),a=Me(e);if(!i||!a)throw new Error("Comparison data is missing numeric values.");if(i.length!==a.length||t.shape[0]!==e.shape[0]||t.shape[1]!==e.shape[1])throw new Error("Comparison datasets have mismatched shapes.");const o=new Float32Array(i.length);let l=1/0,u=-1/0;for(let c=0;c<i.length;c++){const f=i[c],h=a[c];if(!isFinite(f)||!isFinite(h)){o[c]=NaN;continue}const p=h-f;o[c]=p,isFinite(p)&&(l=Math.min(l,p),u=Math.max(u,p))}if(!isFinite(l)||!isFinite(u))throw new Error("Comparison produced no valid numeric values.");return{data:{...t,data:o,data_encoding:"none",dtype:"float32",model:`${r} minus ${n}`,time:`${e.time} minus ${t.time}`,scenario:`${e.scenario} minus ${t.scenario}`,metadata:{...t.metadata,comparison:{labelA:n,labelB:r}}},min:l,max:u}}function j(t,e=!1){const n=Math.max(0,Math.min(100,Math.round(t)));n!==s.loadingProgress&&(s.loadingProgress=n,(s.isLoading||e)&&B())}async function qu(t,e){let n=$t({variable:s.variable,date:s.date,model:s.model,scenario:s.scenario,resolution:s.resolution}),r=n,i="",a="";switch(s.compareMode){case"Scenarios":{const u="SSP245",d="SSP585",c=te(s.date,t);c!==s.date&&(s.date=c),n=$t({variable:s.variable,date:c,model:s.model,scenario:u,resolution:s.resolution}),r=$t({variable:s.variable,date:c,model:s.model,scenario:d,resolution:s.resolution}),i=u,a=d;break}case"Models":{const u=te(s.date,t);u!==s.date&&(s.date=u),n=$t({variable:s.variable,date:u,model:s.compareModelA,scenario:s.scenario,resolution:s.resolution}),r=$t({variable:s.variable,date:u,model:s.compareModelB,scenario:s.scenario,resolution:s.resolution}),i=s.compareModelA,a=s.compareModelB;break}case"Dates":{const u=te(s.compareDateStart,s.scenario),d=te(s.compareDateEnd,s.scenario);u!==s.compareDateStart&&(s.compareDateStart=u),d!==s.compareDateEnd&&(s.compareDateEnd=d),n=$t({variable:s.variable,date:u,model:s.model,scenario:s.scenario,resolution:s.resolution}),r=$t({variable:s.variable,date:d,model:s.model,scenario:s.scenario,resolution:s.resolution}),i=u,a=d;break}}const o=await sn(n);e?.(65);const l=await sn(r);return e?.(85),Vu(o,l,i,a)}async function Ft(){if(s.canvasView==="chart"){if(s.chartMode==="range"){s.chartError="Range mode is not implemented yet.",s.chartBoxes=null,s.chartSamples=[],s.chartLoading=!1,s.chartLoadingProgress={total:0,done:0},B();return}if(s.chartLocation==="Draw"&&(!s.chartPolygon||s.chartPolygon.length<3)){s.chartError="Draw a region on the map to load chart data.",s.chartBoxes=null,s.chartSamples=[],s.chartLoading=!1,s.chartLoadingProgress={total:0,done:0},B();return}if(s.chartLocation==="Point"&&!s.chartPoint){s.chartError="Click a point on the map to load chart data.",s.chartBoxes=null,s.chartSamples=[],s.chartLoading=!1,s.chartLoadingProgress={total:0,done:0},B();return}s.chartLoading=!0,s.chartError=null,j(5,!0),s.chartLoadingProgress={total:0,done:0},B();try{const t=s.metaData??await Zi();s.metaData||(s.metaData=t);const e=t?.scenarios?.length?Array.from(new Set(t.scenarios.map(cr))):Dt,n=t?.models?.length?t.models:nt,r=(s.chartScenarios.length?s.chartScenarios:e).filter(d=>e.includes(d)),i=(s.chartModels.length?s.chartModels:n).filter(d=>n.includes(d));if(!r.length||!i.length){s.chartError="Select at least one scenario and one model.",s.chartSamples=[],s.chartBoxes=null,s.chartLoading=!1,s.chartLoadingProgress={total:0,done:0},B();return}const a=ur(r),o=Kn(s.chartDate,a);o!==s.chartDate&&(s.chartDate=o);const l=r.length*i.length;s.chartLoadingProgress={total:l,done:0},B();const u=[];for(const d of r){const c=Kn(s.chartDate,Ut(d));for(const f of i){const h=s.chartLoadingProgress.done;j(Math.min(95,Math.round((h+.1)/l*100)));const p=$t({variable:s.chartVariable,date:c,model:f,scenario:d,resolution:1}),y=await sn(p),D=s.chartLoadingProgress.done+1;s.chartLoadingProgress={total:l,done:D},j(Math.min(98,Math.round(D/l*100))),B();const $=Me(y);if(!$)throw new Error("No data returned for chart request.");const T=s.chartLocation==="Draw"&&s.chartPolygon&&s.chartPolygon.length>=3?ku($,s.chartVariable,y.shape,s.chartPolygon):s.chartLocation==="Point"&&s.chartPoint?Au($,s.chartVariable,y.shape,s.chartPoint):Eu($,s.chartVariable);u.push({scenario:d,model:f,rawValue:T,dateUsed:c})}}s.chartSamples=u,s.chartBoxes=aa(u,s.chartVariable,s.chartUnit),s.chartLoadingProgress={total:l,done:l},j(100)}catch(t){s.chartError=t instanceof Ct&&t.statusCode||t instanceof Error?t.message:String(t),s.chartSamples=[],s.chartBoxes=null,s.chartLoadingProgress={total:1,done:1}}finally{s.chartLoading=!1,B()}}}async function ht(){if(console.log("fetching"),s.canvasView==="map"){s.isLoading=!0,j(5,!0),s.dataError=null;try{const t=await Zi();s.metaData=t,s.availableModels=t.models,j(20);const e=s.mode==="Compare"&&s.compareMode==="Scenarios"?"SSP245":s.scenario;s.timeRange=Ut(e),j(30);const n=s.mode==="Compare"?await qu(e,j):await(async()=>{j(40);const r=te(s.date,e);r!==s.date&&(s.date=r);const i=$t({variable:s.variable,date:r,model:s.model,scenario:s.scenario,resolution:s.resolution});j(55);let a=await sn(i);j(80);let o=Me(a);if(!o)throw new Error("No data returned for the selected parameters.");if(s.variable==="hurs"){const d=new Float32Array(o.length);let c=1/0,f=-1/0;for(let h=0;h<o.length;h++){const p=o[h];if(!isFinite(p)){d[h]=NaN;continue}const y=Math.min(p,100);d[h]=y,c=Math.min(c,y),f=Math.max(f,y)}return a={...a,data:d,data_encoding:"none"},o=d,{data:a,min:c,max:f}}const{min:l,max:u}=_u(o);return j(95),{data:a,min:l,max:u}})();if(s.currentData=n.data,s.dataMin=n.min,s.dataMax=n.max,j(100),s.isLoading=!1,B(),G){const r=G.querySelector("#map-canvas");r&&fr(r)}}catch(t){t instanceof Ct&&t.statusCode?s.dataError=t.message:s.dataError=t instanceof Error?t.message:String(t),s.isLoading=!1,j(0,!0),s.currentData=null,s.dataMin=null,s.dataMax=null,B()}}}function Xu(){return`
      <div style="${x(b.branding)}">
        <div data-role="brand-eye" style="${x(b.brandIcon)}">
          <svg viewBox="0 0 120 80" style="${x(b.brandSvg)}" aria-hidden="true">
            <defs>
              <clipPath id="brand-eye-clip">
                <rect x="0" y="0" width="120" height="80" style="${x(b.brandClipRect)}" />
              </clipPath>
            </defs>
            <g style="${x(b.brandLids)}">
              <path
                d="M10 40c10-15 30-30 50-30s40 15 50 30c-10 15-30 30-50 30S20 55 10 40Z"
                style="${x(b.brandOutline)}"
              />
            </g>
            <g data-role="brand-iris" style="${x(K(b.brandIrisGroup,b.brandEyeContent))}">
              <circle cx="60" cy="40" r="20" style="${x(b.brandIris)}" />
              <g data-role="brand-pupil" style="${x(b.brandPupilGroup)}">
                <circle cx="60" cy="40" r="10" style="${x(b.brandPupil)}" />
                <circle cx="72" cy="30" r="4" style="${x(b.brandHighlight)}" />
              </g>
            </g>
          </svg>
        </div>
        <span style="${x(b.brandName)}">Polyoracle</span>
      </div>
    `}function B(){if(!G)return;const t=(s.resolution-1)/2*100,e=s.mode==="Explore"?"translateX(0%)":"translateX(-50%)",n=s.mode==="Explore"?"translateX(0%)":"translateX(100%)",r=s.canvasView==="map"?"translateX(0%)":"translateX(100%)",i=s.panelTab==="Manual"?"translateX(0%)":"translateX(-50%)";if(G.innerHTML=`
    <div style="${x(b.page)}">
      <div style="${x(b.bgLayer1)}"></div>
      <div style="${x(b.bgLayer2)}"></div>
      <div style="${x(b.bgOverlay)}"></div>
      ${Xu()}
        ${s.canvasView==="map"&&s.dataMin!==null&&s.dataMax!==null?tu(s.variable,s.dataMin,s.dataMax,s.metaData,s.selectedUnit,s.mode==="Compare"):""}
      <div style="${x(b.mapArea)}">
        ${s.canvasView==="map"?`
              <canvas
                id="map-canvas"
                style="position: absolute; inset: 0; width: 100%; height: 100%; object-fit: contain; pointer-events: auto;"
              ></canvas>
              ${Pu()}
              ${Iu()}
              ${zu()}
              ${s.dataError?`<div style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.8); z-index: 10;">
                      <div style="text-align: center; max-width: 600px; padding: 20px;">
                        <div style="${x(b.mapTitle)}">Error loading data</div>
                        <div style="${x(b.mapSubtitle)}">${s.dataError}</div>
                        ${s.apiAvailable===!1?`<div style="${x(K(b.mapSubtitle,{marginTop:12,fontSize:12}))}">
                                Make sure the Python API server is running. Check the terminal for connection details.
                              </div>`:""}
                      </div>
                    </div>`:""}
              ${!s.isLoading&&!s.dataError&&!s.currentData?`<div style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.5); z-index: 5;">
                      <div style="text-align: center;">
                        <div style="${x(b.mapTitle)}">No data loaded</div>
                        <div style="${x(b.mapSubtitle)}">
                          Adjust parameters to load climate data
                        </div>
                      </div>
                    </div>`:""}
            `:Uu()}
      </div>

      <aside data-role="sidebar" class="sidebar" style="width: ${at}px; transform: ${s.sidebarOpen?"translateX(0)":`translateX(${at+24}px)`}; pointer-events: ${s.sidebarOpen?"auto":"none"}" aria-hidden="${!s.sidebarOpen}">
        <div class="sidebar-top">
          <div class="sidebar-brand">
            <div class="logo-dot"></div>
          </div>
          <div class="tab-switch" style="${x(b.tabSwitch)}">
            ${["Manual","Chat"].map(a=>Yu(a,s.panelTab===a?b.tabBtnActive:void 0,"panel-tab")).join("")}
          </div>
        </div>

        <div class="sidebar-content">
          <div class="tab-viewport">
            <div data-role="tab-track" class="tab-track" style="transform: ${i}">
              <div class="tab-pane">
                ${s.canvasView==="map"?Gu({modeTransform:e,resolutionFill:t,modeIndicatorTransform:n}):Ku()}
              </div>
              <div class="tab-pane">
                ${Zu()}
              </div>
            </div>
          </div>
        </div>
      </aside>

      <div data-role="canvas-toggle" style="${x({...b.canvasToggle,right:s.sidebarOpen?at+24:24})}">
        <div style="${x(b.canvasSwitch)}">
          <div data-role="canvas-indicator" style="${x({...b.canvasIndicator,transform:r})}"></div>
          <button
            type="button"
            aria-label="Show map canvas"
            data-action="set-canvas"
            data-value="map"
            style="${x(K(b.canvasBtn,s.canvasView==="map"?b.canvasBtnActive:void 0))}"
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.6">
              <path d="M4 6.5 9 4l6 2.5L20 4v14l-5 2.5L9 18 4 20.5V6.5Z" />
              <path d="m9 4v14m6-11.5v14" />
            </svg>
          </button>
          <button
            type="button"
            aria-label="Show chart canvas"
            data-action="set-canvas"
            data-value="chart"
            style="${x(K(b.canvasBtn,s.canvasView==="chart"?b.canvasBtnActive:void 0))}"
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.8">
              <path d="M4 18h16" />
              <path d="M6 18 11 9l4 5 3-6" />
              <circle cx="6" cy="18" r="1.2" />
              <circle cx="11" cy="9" r="1.2" />
              <circle cx="15" cy="14" r="1.2" />
              <circle cx="18" cy="8" r="1.2" />
            </svg>
          </button>
        </div>
      </div>

      ${Su(s)}

      ${Yc(s.sidebarOpen)}

      ${s.canvasView==="map"?vu({date:s.date,timeRange:s.timeRange,sidebarOpen:s.sidebarOpen,sidebarWidth:at,mode:s.mode,compareMode:s.compareMode,compareDateStart:s.compareDateStart,compareDateEnd:s.compareDateEnd}):""}
    </div>
  `,Qu(),pt=G.querySelector("#map-canvas"),pt&&s.currentData&&!s.dataError&&s.dataMin!==null&&s.dataMax!==null){fr(pt),Yn(s.currentData,pt,J,s.palette,s.dataMin,s.dataMax,s.variable,s.selectedUnit);const a=J.find(o=>o.name===s.palette)||J[0];zn("legend-gradient-canvas",a.colors),s.drawState.active&&requestAnimationFrame(hn)}}function zu(){if(!s.isLoading)return"";const t=Math.max(0,Math.min(100,Math.round(s.loadingProgress)));return`
      <div style="${x(b.loadingIndicator)}">
        <div style="${x(b.loadingSpinner)}"></div>
        <div style="${x(b.loadingTextGroup)}">
          <div style="${x(b.loadingText)}">Loading data · ${t}%</div>
          <div style="${x(b.loadingBar)}">
            <div style="${x({...b.loadingBarFill,width:`${t}%`})}"></div>
          </div>
          <div style="${x(b.loadingSubtext)}">Fetching climate tiles</div>
        </div>
      </div>
    `}function Hu(){return`
      <div style="position:absolute; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none;">
      </div>
    `}function Wu(t){if(!Number.isFinite(t))return"-";const e=Math.abs(t);return e>=1e3?t.toFixed(0):e>=100?t.toFixed(1):e>=1?t.toFixed(2):t.toPrecision(2)}function oi(t){if(!t.length)return`<div style="${x(b.chartEmpty)}">No chart data loaded yet.</div>`;const e=[...t].sort((g,m)=>Dt.indexOf(g.scenario)-Dt.indexOf(m.scenario)),r=(J.find(g=>g.name===s.palette)||J[0]).colors,i=900,a=440,o={top:26,right:36,bottom:70,left:86},l=i-o.left-o.right,u=a-o.top-o.bottom,d=e.flatMap(g=>[g.stats.min,g.stats.max]),c=Math.min(...d),f=Math.max(...d),h=Math.max(Math.abs(f-c)*.12,1e-6),p=Ui().domain([c-h,f+h]).range([u,0]),y=p.ticks(6),D=l/(e.length+1),$=y.map(g=>{const m=p(g)+o.top;return`
        <g>
          <line x1="${o.left}" x2="${i-o.right}" y1="${m}" y2="${m}" stroke="rgba(255,255,255,0.08)" />
          <text x="${o.left-10}" y="${m+4}" fill="var(--text-secondary)" font-size="11" text-anchor="end">
            ${Wu(g)}
          </text>
        </g>
      `}).join(""),T=e.map((g,m)=>{const S=o.left+D*(m+1),k=r[m%r.length],{min:_,q1:C,median:A,q3:E,max:L,mean:P}=g.stats,N=p(E)+o.top,M=p(C)+o.top,I=Math.max(2,M-N);return`
        <g>
          <line x1="${S}" x2="${S}" y1="${p(_)+o.top}" y2="${p(L)+o.top}" stroke="${k}" stroke-width="2" stroke-linecap="round" />
          <rect x="${S-24}" y="${N}" width="48" height="${I}" fill="rgba(255,255,255,0.06)" stroke="${k}" stroke-width="2" rx="6" />
          <line x1="${S-24}" x2="${S+24}" y1="${p(A)+o.top}" y2="${p(A)+o.top}" stroke="${k}" stroke-width="2.4" />
          <circle cx="${S}" cy="${p(P)+o.top}" r="4" fill="${k}" stroke="rgba(0,0,0,0.55)" stroke-width="1" />
          <text x="${S}" y="${a-o.bottom+32}" fill="var(--text-primary)" font-weight="700" font-size="12" text-anchor="middle">${g.scenario}</text>
          <text x="${S}" y="${a-o.bottom+48}" fill="var(--text-secondary)" font-size="11" text-anchor="middle">${g.samples.length} model${g.samples.length===1?"":"s"}</text>
        </g>
      `}).join(""),w=`
      <line
        x1="${o.left}"
        x2="${o.left}"
        y1="${o.top}"
        y2="${a-o.bottom}"
        stroke="rgba(255,255,255,0.65)"
        stroke-width="1.2"
      />
    `,v=`
      <text
        x="${o.left-70}"
        y="${o.top+u/2}"
        fill="var(--text-secondary)"
        font-size="12"
        text-anchor="middle"
        transform="rotate(-90 ${o.left-70} ${o.top+u/2})"
      >
        ${s.chartUnit}
      </text>
    `;return`
      <svg viewBox="0 0 ${i} ${a}" role="img" aria-label="Global box plots" preserveAspectRatio="xMidYMid meet" style="width:100%; height:auto;">
        ${w}
        ${$}
        ${T}
        ${v}
      </svg>
    `}function Uu(){let t="";return s.chartLoading?t=`
          <div style="position:absolute; inset:0; pointer-events:none;">
            <div style="${x(K(b.loadingIndicator,{position:"absolute",left:18,bottom:-95,pointerEvents:"auto"}))}">
              <div style="${x(b.loadingSpinner)}"></div>
              <div style="${x(b.loadingTextGroup)}">
                <div style="${x(b.loadingText)}">Loading data</div>
                <div style="${x(b.loadingBar)}">
                  <div style="${x({...b.loadingBarFill,width:`${Math.max(0,Math.min(100,Math.round(s.loadingProgress||25)))}%`})}"></div>
                </div>
                <div style="${x(b.loadingSubtext)}">${s.chartLoadingProgress.total>0?`${s.chartLoadingProgress.done}/${s.chartLoadingProgress.total} datasets loaded`:"Preparing datasets"}</div>
              </div>
            </div>
            ${Hu()}
          </div>
          ${s.chartBoxes?oi(s.chartBoxes):""}
        `:s.chartError?t=`<div style="${x(b.chartError)}">${s.chartError}</div>`:!s.chartBoxes||!s.chartBoxes.length?t=`
          <div style="${x(b.chartEmpty)}">
            Select scenarios and models to fetch the global box plot.
          </div>
        `:t=oi(s.chartBoxes),`
      <div style="pointer-events:auto; width:100%; display:flex; align-items:center; justify-content:center; padding:24px; padding-right:${s.sidebarOpen?at+32:24}px;">
        <div style="${x(b.chartPanel)}">
          <div style="${x(b.chartHeader)}">
            <div style="${x(b.chartTitle)}">${na(s.chartVariable,s.metaData)}</div>
            <div style="${x(b.mapSubtitle)}">${me(s.chartDate)}</div>
          </div>
          <div style="${x(K(b.chartPlotWrapper,{display:"flex",alignItems:"center",justifyContent:"center"}))}">
            ${t}
          </div>
        </div>
      </div>
    `}function V(t,e){return`
    <div style="${x(b.field)}">
      ${t?`<div style="${x(b.fieldLabel)}">${t}</div>`:""}
      ${e}
    </div>
  `}function Zt(t,e,n){const r=n?.type??"date",i=n?.dataKey??t,a=n?.min?`min="${n.min}"`:"",o=n?.max?`max="${n.max}"`:"";return`
    <input
      type="${r}"
      value="${e}"
      data-action="update-input"
      data-key="${i}"
      ${a}
      ${o}
    />
  `}function W(t,e,n,r){const i=r?.dataKey??t,a=r?.disabled?"disabled":"";return`
    <select data-action="update-select" data-key="${i}" ${a}>
      ${e.map(o=>`
            <option value="${o}" ${o===n?"selected":""}>
              ${o}
            </option>
          `).join("")}
    </select>
  `}function Yu(t,e,n="panel-tab"){return`
    <button
      type="button"
      data-action="set-tab"
      data-key="${n}"
      data-value="${t}"
      style="${x(K(b.tabBtn,e))}"
    >
      ${t}
    </button>
  `}function Gu(t){const{modeTransform:e,resolutionFill:n,modeIndicatorTransform:r}=t,i=s.compareMode==="Models"?[V("Scenario",W("scenario",Dt,s.scenario)),V("Date",Zt("date",s.date))]:s.compareMode==="Dates"?[V("Scenario",W("scenario",Dt,s.scenario)),V("Model",W("model",nt,s.model))]:[V("Model",W("model",nt,s.model)),V("Date",Zt("date",s.date))];return`
    <div style="${x(b.modeSwitch)}">
      <div data-role="mode-indicator" style="${x({...b.modeIndicator,transform:r})}"></div>
      ${["Explore","Compare"].map(a=>`
            <button
              type="button"
              class="mode-btn"
              data-action="set-mode"
              data-value="${a}"
              style="${x(K(b.modeBtn,s.mode===a?b.modeBtnActive:void 0))}"
            >
              ${a}
            </button>
          `).join("")}
    </div>

    <div style="${x(b.modeViewport)}">
      <div data-role="mode-track" style="${x({...b.modeTrack,transform:e})}">
        <div class="mode-pane-scrollable" style="${x(b.modePane)}">
          <div style="${x({display:"flex",flexDirection:"column",gap:8})}">
            <div style="${x(b.sectionTitle)}">Parameters</div>
            <div style="${x(b.paramGrid)}">
              ${V("Scenario",W("scenario",Dt,s.scenario))}
              ${V("Model",W("model",nt,s.model))}
              ${V("Date",(()=>{const a=Ut(s.scenario);return Zt("date",s.date,{min:a.start,max:a.end})})())}
              ${V("Variable",W("variable",qt,s.variable))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${x({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${x(b.sectionTitle)}">Unit</div>
              ${V("",W("unit",Wt(s.variable).map(a=>a.label),s.selectedUnit,{dataKey:"unit"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${x({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${x(b.sectionTitle)}">Color palette</div>
              ${V("",W("palette",J.map(a=>a.name),s.palette,{dataKey:"palette"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${x({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${x(b.sectionTitle)}">Resolution</div>
              <div style="${x(b.resolutionRow)}">
                <input
                  type="range"
                  min="1"
                  max="3"
                  step="1"
                  value="${s.resolution}"
                  data-action="set-resolution"
                  class="resolution-slider"
                  style="${x(K(b.range,{"--slider-fill":`${n}%`}))}"
                />
                <div data-role="resolution-value" style="${x(b.resolutionValue)}">${s.resolution===1?"Low":s.resolution===2?"Medium":"High"}</div>
              </div>
            </div>
          </div>
        </div>

        <div class="mode-pane-scrollable" style="${x(b.modePane)}">
          <div style="${x({display:"flex",flexDirection:"column",gap:14})}">
            <div style="${x({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${x(b.sectionTitle)}">Compare</div>
              <div style="${x(b.paramGrid)}">
                ${V("What do you want to compare?",W("compareMode",["Scenarios","Models","Dates"],s.compareMode,{dataKey:"compareMode"}))}
              </div>

              ${s.compareMode==="Scenarios"?`
                      <div style="${x(b.paramGrid)}">
                        ${V("Scenario A",W("compareScenarioA",["SSP245"],"SSP245",{disabled:!0}))}
                        ${V("Scenario B",W("compareScenarioB",["SSP585"],"SSP585",{disabled:!0}))}
                      </div>
                    `:""}

              ${s.compareMode==="Models"?`
                      <div style="${x(b.paramGrid)}">
                        ${V("Model A",W("compareModelA",nt,s.compareModelA,{dataKey:"compareModelA"}))}
                        ${V("Model B",W("compareModelB",nt,s.compareModelB,{dataKey:"compareModelB"}))}
                      </div>
                    `:""}

              ${s.compareMode==="Dates"?`
                      <div style="${x(b.paramGrid)}">
                        ${V("Start date",Zt("compareDateStart",s.compareDateStart,{dataKey:"compareDateStart"}))}
                        ${V("End date",Zt("compareDateEnd",s.compareDateEnd,{dataKey:"compareDateEnd"}))}
  </div>
`:""}

              <div style="${x(b.paramGrid)}">
                ${i.join("")}
                ${V("Variable",W("variable",qt,s.variable))}
              </div>

              <div style="margin-top:14px">
                <div style="${x({display:"flex",flexDirection:"column",gap:8})}">
                  <div style="${x(b.sectionTitle)}">Unit</div>
                  ${V("",W("unit",Wt(s.variable).map(a=>a.label),s.selectedUnit,{dataKey:"unit"}))}
                </div>
              </div>

              <div style="margin-top:14px">
                <div style="${x({display:"flex",flexDirection:"column",gap:8})}">
                  <div style="${x(b.sectionTitle)}">Color palette</div>
                  ${V("",W("palette",J.map(a=>a.name),s.palette,{dataKey:"palette"}))}
                </div>
              </div>

              <div style="margin-top:14px">
                <div style="${x({display:"flex",flexDirection:"column",gap:8})}">
                  <div style="${x(b.sectionTitle)}">Resolution</div>
                  <div style="${x(b.resolutionRow)}">
                    <input
                      type="range"
                      min="1"
                      max="3"
                      step="1"
                      value="${s.resolution}"
                      data-action="set-resolution"
                      class="resolution-slider"
                      style="${x(K(b.range,{"--slider-fill":`${n}%`}))}"
                    />
                    <div data-role="resolution-value" style="${x(b.resolutionValue)}">${s.resolution===1?"Low":s.resolution===2?"Medium":"High"}</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  `}function si(t,e,n){const r=new Set(e);return`
      <div style="${x(b.chipRow)}">
        ${t.map(i=>{const a=r.has(i);return`
                  <button
                    type="button"
                    data-action="toggle-multi"
                    data-key="${n}"
                    data-value="${i}"
                    style="${x(K(b.chip,a?b.chipActive:void 0))}"
                  >
                    ${i}
                  </button>
                `}).join("")}
      </div>
    `}function Ku(){const t=s.chartMode==="single"?"translateX(0%)":"translateX(100%)",e=s.metaData?.scenarios?.length?Array.from(new Set(s.metaData.scenarios.map(cr))):Dt,n=s.metaData?.models?.length?s.metaData.models:nt,r=ur(s.chartScenarios.length?s.chartScenarios:e),i=(l,u,d,c,f)=>`
          <div style="${x({border:"1px solid var(--border-medium)",borderRadius:12,background:"var(--bg-subtle)",padding:"10px 12px"})}">
            <button
              type="button"
              data-action="toggle-collapse"
              data-key="${f}"
              style="${x({display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",background:"transparent",border:"none",color:"var(--text-primary)",fontWeight:700,fontSize:13,cursor:"pointer",padding:0})}"
            >
              <span>${l}</span>
              <span style="${x({color:"var(--text-secondary)",fontWeight:600,fontSize:12})}">${d} ${u?"▴":"▾"}</span>
            </button>
            ${u?`<div style="${x({marginTop:10,display:"flex",flexWrap:"wrap",gap:8})}">${c}</div>`:""}
          </div>
        `,a=`
      <div style="${x(b.paramGrid)}">
        ${V("Date",Zt("chartDate",s.chartDate,{dataKey:"chartDate",min:r.start,max:r.end}))}
        ${V("Variable",W("chartVariable",qt,s.chartVariable,{dataKey:"chartVariable"}))}
      </div>

      <div style="margin-top:10px">
        ${V("Location",W("chartLocation",["World","Draw","Point"],s.chartLocation,{dataKey:"chartLocation"}))}
        ${s.chartLocation==="Draw"?`<div style="${x({marginTop:6,display:"flex",justifyContent:"flex-end"})}">
                    <button
                      type="button"
                      data-action="restart-draw"
                      style="${x({background:"var(--gradient-primary)",border:"none",borderRadius:10,padding:"6px 10px",color:"white",fontWeight:700,fontSize:12,cursor:"pointer",boxShadow:"var(--shadow-elevated)"})}"
                    >
                      Restart drawing
                    </button>
                  </div>`:s.chartLocation==="Point"?`<div style="${x({marginTop:6,display:"flex",justifyContent:"flex-end"})}">
                    <button
                      type="button"
                      data-action="restart-point"
                      style="${x({background:"var(--gradient-primary)",border:"none",borderRadius:10,padding:"6px 10px",color:"white",fontWeight:700,fontSize:12,cursor:"pointer",boxShadow:"var(--shadow-elevated)"})}"
                    >
                      Pick point again
                    </button>
                  </div>`:""}
      </div>

      <div style="margin-top:14px">
        ${i("Scenarios",s.chartDropdown.scenariosOpen,`${s.chartScenarios.length} selected`,si(e,s.chartScenarios,"chartScenarios"),"chartScenarios")}
      </div>

      <div style="margin-top:14px">
        ${i("Models",s.chartDropdown.modelsOpen,`${s.chartModels.length} selected`,si(n,s.chartModels,"chartModels"),"chartModels")}
      </div>

      <div style="margin-top:14px">
        <div style="${x(b.sectionTitle)}">Unit</div>
        ${V("",W("chartUnit",Wt(s.chartVariable).map(l=>l.label),s.chartUnit,{dataKey:"chartUnit"}))}
      </div>

      <div style="margin-top:14px">
        <div style="${x(b.sectionTitle)}">Color palette</div>
        ${V("",W("palette",J.map(l=>l.name),s.palette,{dataKey:"palette"}))}
      </div>
    `,o=`
      <div style="${x(b.chartEmpty)}">
        Range mode will be added later.
      </div>
    `;return`
      <div style="${x(b.modeSwitch)}">
        <div data-role="chart-mode-indicator" style="${x({...b.modeIndicator,transform:t})}"></div>
        ${["single","range"].map(l=>{const u=l==="single"?"Single dates":"Range";return`
              <button
                type="button"
                class="mode-btn"
                data-action="set-chart-mode"
                data-value="${l}"
                style="${x(K(b.modeBtn,s.chartMode===l?b.modeBtnActive:void 0))}"
              >
                ${u}
              </button>
            `}).join("")}
      </div>

      <div class="mode-pane-scrollable" style="${x(b.modePane)}">
        ${s.chartMode==="single"?a:o}
      </div>
    `}function Zu(){return`
    <div style="${x({display:"flex",flexDirection:"column",gap:8})}">
      <div style="${x(b.sectionTitle)}">Chat</div>
      <div style="${x(b.chatStack)}">
        <div style="${x(b.chatLead)}">Discuss the data with an agent, or ask questions.</div>

        <div style="${x(b.chatMessages)}">
          ${s.chatMessages.map(t=>{const e=t.sender==="user"?K(b.chatBubble,b.chatBubbleUser):K(b.chatBubble,b.chatBubbleAgent);return`<div style="${x(e)}">${t.text}</div>`}).join("")}
        </div>

        <div style="${x(b.chatBox)}">
          <input
            type="text"
            value="${s.chatInput}"
            data-action="chat-input"
            style="${x(b.chatInput)}"
            placeholder="Ask a question"
          />
          <button type="button" data-action="chat-send" aria-label="Send chat message" style="${x(b.chatSend)}">
            ➤
          </button>
        </div>
      </div>
    </div>
  `}function li(t,e,n){const r=Math.hypot(t,e);if(!r||!isFinite(r)||n<=0)return{x:0,y:0};const i=Math.min(1,n/r);return{x:t*i,y:e*i}}function Ju(t){Fe&&(Fe(),Fe=null),It!==null&&(cancelAnimationFrame(It),It=null),Tt!==null&&(cancelAnimationFrame(Tt),Tt=null),Nt!==null&&(clearTimeout(Nt),Nt=null),bt!==null&&(clearTimeout(bt),bt=null);const e=t.querySelector('[data-role="brand-eye"]');if(!e)return;let n={x:0,y:0},r={x:0,y:0},i={x:0,y:0},a={x:0,y:0},o=1,l=!1;const u=3e4,d=(w,v)=>{const g=e.getBoundingClientRect(),m=g.left+g.width/2,S=g.top+g.height/2,k=w-m,_=v-S,A=Math.min(g.width,g.height)*.14,E=A*.6;n=li(k,_,A),r=li(k,_,E)},c=w=>{o=Math.max(0,Math.min(1,w)),e.style.setProperty("--blink-open",`${o}`)},f=()=>{bt!==null&&clearTimeout(bt),bt=window.setTimeout(()=>{n={x:0,y:0},r={x:0,y:0}},u)},h=()=>{i.x+=(n.x-i.x)*.28,i.y+=(n.y-i.y)*.28,a.x+=(r.x-a.x)*.32,a.y+=(r.y-a.y)*.32,e.style.setProperty("--iris-x",`${i.x}px`),e.style.setProperty("--iris-y",`${i.y}px`),e.style.setProperty("--pupil-x",`${a.x}px`),e.style.setProperty("--pupil-y",`${a.y}px`),It=requestAnimationFrame(h)},p=()=>{if(l)return;l=!0;const w=[{t:0,v:1},{t:.16,v:.08},{t:.26,v:.02},{t:.4,v:1}],v=350,g=performance.now(),m=S=>{const k=S-g,_=Math.min(1,k/v);let C=w[0],A=w[w.length-1];for(let M=0;M<w.length-1;M++){const I=w[M],O=w[M+1];if(_>=I.t&&_<=O.t){C=I,A=O;break}}const E=A.t-C.t||1,L=Math.min(1,Math.max(0,(_-C.t)/E)),P=1-Math.pow(1-L,2),N=C.v+(A.v-C.v)*P;c(N),_<1?Tt=requestAnimationFrame(m):(c(1),l=!1,y())};Tt=requestAnimationFrame(m)},y=()=>{const w=5e3+Math.random()*15e3;Nt=window.setTimeout(p,w)},D=()=>{const w=e.getBoundingClientRect();d(w.left+w.width/2,w.top+w.height/2)},$=w=>{d(w.clientX,w.clientY),f()},T=()=>D();D(),h(),y(),f(),window.addEventListener("pointermove",$),window.addEventListener("pointerleave",T),Fe=()=>{window.removeEventListener("pointermove",$),window.removeEventListener("pointerleave",T),It!==null&&(cancelAnimationFrame(It),It=null),Tt!==null&&(cancelAnimationFrame(Tt),Tt=null),Nt!==null&&(clearTimeout(Nt),Nt=null),bt!==null&&(clearTimeout(bt),bt=null)}}function Qu(t){if(!G)return;const e=G;Ju(e),Uc({root:e,getSidebarOpen:()=>s.sidebarOpen,setSidebarOpen:v=>{s.sidebarOpen=v},onTimeSliderUpdate:v=>{wu(v,at)}}),e.querySelectorAll('[data-action="set-canvas"]').forEach(v=>v.addEventListener("click",()=>{const g=v.dataset.value;if(g){if(g===s.canvasView)return;const S=s.canvasView==="map"?"translateX(0%)":"translateX(100%)",k=g==="map"?"translateX(0%)":"translateX(100%)";s.canvasView=g,B(),g==="map"?ht():Ft();const _=e.querySelector('[data-role="canvas-indicator"]');if(!_)return;_.style.removeProperty("transition"),_.style.transform=S,_.offsetHeight,_.getBoundingClientRect(),requestAnimationFrame(()=>{_.style.transition="transform 180ms ease",_.style.transform=k})}})),e.querySelectorAll('[data-action="set-mode"]').forEach(v=>v.addEventListener("click",()=>{const g=v.dataset.value;if(g){if(g===s.mode)return;const m=s.mode,S=m==="Explore"?"translateX(0%)":"translateX(-50%)",k=m==="Explore"?"translateX(0%)":"translateX(100%)",_=g==="Explore"?"translateX(0%)":"translateX(-50%)",C=g==="Explore"?"translateX(0%)":"translateX(100%)";s.mode=g,B();const A=e.querySelector('[data-role="mode-track"]'),E=e.querySelector('[data-role="mode-indicator"]');if(!A||!E)return;A.style.transition="none",E.style.transition="none",A.style.transform=S,E.style.transform=k,A.offsetHeight,A.style.transition="transform 220ms ease",E.style.transition="transform 200ms ease",A.style.transform=_,E.style.transform=C}s.canvasView==="map"&&ht()})),e.querySelectorAll('[data-action="set-chart-mode"]').forEach(v=>v.addEventListener("click",()=>{const g=v.dataset.value;if(!g||g===s.chartMode)return;const S=s.chartMode==="single"?"translateX(0%)":"translateX(100%)",k=g==="single"?"translateX(0%)":"translateX(100%)";s.chartMode=g,B();const _=e.querySelector('[data-role="chart-mode-indicator"]');_&&(_.style.removeProperty("transition"),_.style.transform=S,_.offsetHeight,requestAnimationFrame(()=>{_.style.transition="transform 200ms ease",_.style.transform=k})),s.canvasView==="chart"&&Ft()})),e.querySelectorAll('[data-action="set-tab"]').forEach(v=>v.addEventListener("click",()=>{const g=v.dataset.value;if(g){if(g===s.panelTab)return;const S=s.panelTab==="Manual"?"translateX(0%)":"translateX(-50%)",k=g==="Manual"?"translateX(0%)":"translateX(-50%)";s.panelTab=g,B();const _=e.querySelector('[data-role="tab-track"]');if(!_)return;_.style.removeProperty("transition"),_.style.transform=S,_.offsetHeight,_.getBoundingClientRect(),requestAnimationFrame(()=>{_.style.transition="transform 220ms ease",_.style.transform=k})}}));const o=e.querySelectorAll('[data-action="update-select"]');o.forEach(v=>v.addEventListener("change",async()=>{const g=v.dataset.key,m=v.value;if(!g)return;let S=!1,k=!1;switch(g){case"scenario":s.scenario=m,s.date=Mu(m),s.timeRange=Ut(m),S=!0;break;case"model":s.model=m,S=!0;break;case"variable":s.variable=m,s.selectedUnit=on(m).label,S=!0;break;case"unit":if(s.selectedUnit=m,B(),s.currentData&&G&&s.dataMin!==null&&s.dataMax!==null){const _=G.querySelector("#map-canvas");if(_){pt=_,fr(_),Yn(s.currentData,pt,J,s.palette,s.dataMin,s.dataMax,s.variable,s.selectedUnit);const C=J.find(A=>A.name===s.palette)||J[0];zn("legend-gradient-canvas",C.colors)}}return;case"palette":if(s.palette=m,B(),s.canvasView==="map"&&s.currentData&&G&&s.dataMin!==null&&s.dataMax!==null){const _=G.querySelector("#map-canvas");if(_){pt=_,Yn(s.currentData,pt,J,s.palette,s.dataMin,s.dataMax,s.variable,s.selectedUnit);const C=J.find(A=>A.name===s.palette)||J[0];zn("legend-gradient-canvas",C.colors)}}return;case"compareMode":s.compareMode=m,S=!0;break;case"compareModelA":s.compareModelA=m,S=!0;break;case"compareModelB":s.compareModelB=m,S=!0;break;case"chartVariable":s.chartVariable=m,s.chartUnit=on(m).label,k=!0;break;case"chartUnit":s.chartUnit=m,s.chartSamples.length&&(s.chartBoxes=aa(s.chartSamples,s.chartVariable,s.chartUnit)),B();return;case"chartLocation":if(m==="Draw"){_n();return}if(m==="Point"){En();return}s.chartLocation="World",s.chartPolygon=null,s.chartPoint=null,Nu(),Ru(),k=!0;break}B(),s.canvasView==="map"&&S&&ht(),s.canvasView==="chart"&&(k||S)&&Ft()})),o.forEach(v=>{v.dataset.key==="chartLocation"&&v.addEventListener("click",g=>{const m=g.target.closest("option");m&&m instanceof HTMLOptionElement&&(m.value==="Draw"&&s.chartLocation==="Draw"||m.value==="Point"&&s.chartLocation==="Point")&&(m.value==="Draw"?_n():En())})}),e.querySelectorAll('[data-action="restart-draw"]').forEach(v=>v.addEventListener("click",()=>{_n()})),e.querySelectorAll('[data-action="restart-point"]').forEach(v=>v.addEventListener("click",()=>{En()})),e.querySelectorAll('[data-action="toggle-multi"]').forEach(v=>v.addEventListener("click",()=>{const g=v.dataset.key,m=v.dataset.value;if(!(!g||!m)){if(g==="chartScenarios"){const S=s.metaData?.scenarios?.length&&s.metaData.scenarios?Array.from(new Set(s.metaData.scenarios.map(cr))):Dt,k=m==="Historical",_=new Set(s.chartScenarios);_.has(m)?_.delete(m):k?(_.clear(),_.add("Historical")):(_.delete("Historical"),_.add(m)),_.size===0&&_.add(k?"Historical":m),s.chartScenarios=Array.from(_).filter(A=>S.includes(A));const C=ur(s.chartScenarios);s.chartDate=Kn(s.chartDate,C)}if(g==="chartModels"){const S=s.metaData?.models?.length&&s.metaData.models?s.metaData.models:nt,k=new Set(s.chartModels);k.has(m)?k.delete(m):k.add(m),s.chartModels=k.size?Array.from(k):[...S]}B(),s.canvasView==="chart"&&Ft()}})),e.querySelectorAll('[data-action="toggle-collapse"]').forEach(v=>v.addEventListener("click",()=>{const g=v.dataset.key;g&&(g==="chartScenarios"&&(s.chartDropdown.scenariosOpen=!s.chartDropdown.scenariosOpen),g==="chartModels"&&(s.chartDropdown.modelsOpen=!s.chartDropdown.modelsOpen),B())})),e.querySelectorAll('[data-action="update-input"]').forEach(v=>{const g=()=>{const m=v.dataset.key;if(!m)return;const S=v.value;if(!(/^\d{4}-\d{2}-\d{2}$/.test(S)&&!isNaN(new Date(S).getTime()))){v.style.borderColor="rgba(239, 68, 68, 0.6)";return}v.style.borderColor="";let A=S;if(m==="date"&&(A=te(S,s.scenario),A!==S&&(v.value=A)),(m==="date"?s.date:m==="compareDateStart"?s.compareDateStart:m==="compareDateEnd"?s.compareDateEnd:s.chartDate)!==A){switch(m){case"date":s.date=A;break;case"compareDateStart":s.compareDateStart=S;break;case"compareDateEnd":s.compareDateEnd=S;break;case"chartDate":s.chartDate=S;break}B(),(m==="date"||s.mode==="Compare"&&(m==="compareDateStart"||m==="compareDateEnd"))&&ht(),m==="chartDate"&&s.canvasView==="chart"&&Ft()}};v.addEventListener("blur",g),v.addEventListener("keydown",m=>{m.key==="Enter"&&(m.preventDefault(),g(),v.blur())})});const h=e.querySelectorAll('[data-action="set-resolution"]'),p=e.querySelectorAll('[data-role="resolution-value"]'),y=v=>{const g=(v-1)/2*100,m=v===1?"Low":v===2?"Medium":"High";h.forEach(S=>{S.value=String(v),S.style.setProperty("--slider-fill",`${g}%`)}),p.forEach(S=>{S.textContent=m})};h.forEach(v=>v.addEventListener("input",()=>{const g=Number.parseInt(v.value,10);Number.isNaN(g)||(s.resolution=g,y(g),s.canvasView==="map"&&ht())})),e.querySelector('[data-action="open-compare-info"]')?.addEventListener("click",()=>{s.compareInfoOpen=!0,B()}),e.querySelectorAll('[data-action="close-compare-info"]').forEach(v=>v.addEventListener("click",()=>{s.compareInfoOpen=!1,B()})),yu({root:e,getTimeRange:()=>s.timeRange,onDateChange:v=>{s.date=v,ht()},getMode:()=>s.mode,getCompareMode:()=>s.compareMode,getCompareDates:()=>({start:s.compareDateStart,end:s.compareDateEnd}),onDateRangeChange:(v,g)=>{s.compareDateStart=v,s.compareDateEnd=g,ht()}});const T=e.querySelector('[data-action="chat-input"]'),w=e.querySelector('[data-action="chat-send"]');T?.addEventListener("input",()=>{s.chatInput=T.value}),T?.addEventListener("keydown",v=>{v.key==="Enter"&&(v.preventDefault(),ci())}),w?.addEventListener("click",ci)}function ci(){const t=s.chatInput.trim();if(!t)return;const e={id:Date.now(),sender:"user",text:t};s.chatMessages=[...s.chatMessages,e],s.chatInput="",Mn&&window.clearTimeout(Mn),Mn=window.setTimeout(()=>{const n={id:Date.now()+1,sender:"agent",text:"I don't work yet."};s.chatMessages=[...s.chatMessages,n],B()},1e3),B()}async function ui(){if(G=document.querySelector("#app"),!G)throw new Error("Root element #app not found");B(),$u().then(()=>{B()}),s.canvasView==="map"&&s.mode==="Explore"&&ht()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ui):ui();
