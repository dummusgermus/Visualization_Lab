(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}})();function Le(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function xa(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Mr(t){let e,n,r;t.length!==2?(e=Le,n=(l,c)=>Le(t(l),c),r=(l,c)=>t(l)-c):(e=t===Le||t===xa?t:Sa,n=t,r=t);function a(l,c,u=0,d=l.length){if(u<d){if(e(c,c)!==0)return d;do{const f=u+d>>>1;n(l[f],c)<0?u=f+1:d=f}while(u<d)}return u}function o(l,c,u=0,d=l.length){if(u<d){if(e(c,c)!==0)return d;do{const f=u+d>>>1;n(l[f],c)<=0?u=f+1:d=f}while(u<d)}return u}function s(l,c,u=0,d=l.length){const f=a(l,c,u,d-1);return f>u&&r(l[f-1],c)>-r(l[f],c)?f-1:f}return{left:a,center:s,right:o}}function Sa(){return 0}function _r(t){return t===null?NaN:+t}const $a=Mr(Le),Ma=$a.right;Mr(_r).center;const _a=Math.sqrt(50),ka=Math.sqrt(10),Da=Math.sqrt(2);function Pe(t,e,n){const r=(e-t)/Math.max(0,n),a=Math.floor(Math.log10(r)),o=r/Math.pow(10,a),s=o>=_a?10:o>=ka?5:o>=Da?2:1;let l,c,u;return a<0?(u=Math.pow(10,-a)/s,l=Math.round(t*u),c=Math.round(e*u),l/u<t&&++l,c/u>e&&--c,u=-u):(u=Math.pow(10,a)*s,l=Math.round(t/u),c=Math.round(e/u),l*u<t&&++l,c*u>e&&--c),c<l&&.5<=n&&n<2?Pe(t,e,n*2):[l,c,u]}function Ea(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const r=e<t,[a,o,s]=r?Pe(e,t,n):Pe(t,e,n);if(!(o>=a))return[];const l=o-a+1,c=new Array(l);if(r)if(s<0)for(let u=0;u<l;++u)c[u]=(o-u)/-s;else for(let u=0;u<l;++u)c[u]=(o-u)*s;else if(s<0)for(let u=0;u<l;++u)c[u]=(a+u)/-s;else for(let u=0;u<l;++u)c[u]=(a+u)*s;return c}function cn(t,e,n){return e=+e,t=+t,n=+n,Pe(t,e,n)[2]}function La(t,e,n){e=+e,t=+t,n=+n;const r=e<t,a=r?cn(e,t,n):cn(t,e,n);return(r?-1:1)*(a<0?1/-a:a)}function nn(t,e,n=_r){if(!(!(r=t.length)||isNaN(e=+e))){if(e<=0||r<2)return+n(t[0],0,t);if(e>=1)return+n(t[r-1],r-1,t);var r,a=(r-1)*e,o=Math.floor(a),s=+n(t[o],o,t),l=+n(t[o+1],o+1,t);return s+(l-s)*(a-o)}}function Ta(t,e){let n=0,r=0;for(let a of t)a!=null&&(a=+a)>=a&&(++n,r+=a);if(n)return r/n}var Aa={value:()=>{}};function Dn(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new Te(n)}function Te(t){this._=t}function Ca(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",a=n.indexOf(".");if(a>=0&&(r=n.slice(a+1),n=n.slice(0,a)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}Te.prototype=Dn.prototype={constructor:Te,on:function(t,e){var n=this._,r=Ca(t+"",n),a,o=-1,s=r.length;if(arguments.length<2){for(;++o<s;)if((a=(t=r[o]).type)&&(a=Ia(n[a],t.name)))return a;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++o<s;)if(a=(t=r[o]).type)n[a]=Hn(n[a],t.name,e);else if(e==null)for(a in n)n[a]=Hn(n[a],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Te(t)},call:function(t,e){if((a=arguments.length-2)>0)for(var n=new Array(a),r=0,a,o;r<a;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=this._[t],r=0,a=o.length;r<a;++r)o[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],a=0,o=r.length;a<o;++a)r[a].value.apply(e,n)}};function Ia(t,e){for(var n=0,r=t.length,a;n<r;++n)if((a=t[n]).name===e)return a.value}function Hn(t,e,n){for(var r=0,a=t.length;r<a;++r)if(t[r].name===e){t[r]=Aa,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var un="http://www.w3.org/1999/xhtml";const Wn={svg:"http://www.w3.org/2000/svg",xhtml:un,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Ge(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),Wn.hasOwnProperty(e)?{space:Wn[e],local:t}:t}function Na(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===un&&e.documentElement.namespaceURI===un?e.createElement(t):e.createElementNS(n,t)}}function Pa(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function kr(t){var e=Ge(t);return(e.local?Pa:Na)(e)}function Ra(){}function En(t){return t==null?Ra:function(){return this.querySelector(t)}}function Ba(t){typeof t!="function"&&(t=En(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var o=e[a],s=o.length,l=r[a]=new Array(s),c,u,d=0;d<s;++d)(c=o[d])&&(u=t.call(c,c.__data__,d,o))&&("__data__"in c&&(u.__data__=c.__data__),l[d]=u);return new rt(r,this._parents)}function za(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function Fa(){return[]}function Dr(t){return t==null?Fa:function(){return this.querySelectorAll(t)}}function Oa(t){return function(){return za(t.apply(this,arguments))}}function qa(t){typeof t=="function"?t=Oa(t):t=Dr(t);for(var e=this._groups,n=e.length,r=[],a=[],o=0;o<n;++o)for(var s=e[o],l=s.length,c,u=0;u<l;++u)(c=s[u])&&(r.push(t.call(c,c.__data__,u,s)),a.push(c));return new rt(r,a)}function Er(t){return function(){return this.matches(t)}}function Lr(t){return function(e){return e.matches(t)}}var Va=Array.prototype.find;function Xa(t){return function(){return Va.call(this.children,t)}}function Ha(){return this.firstElementChild}function Wa(t){return this.select(t==null?Ha:Xa(typeof t=="function"?t:Lr(t)))}var Ua=Array.prototype.filter;function Ya(){return Array.from(this.children)}function Ka(t){return function(){return Ua.call(this.children,t)}}function Ga(t){return this.selectAll(t==null?Ya:Ka(typeof t=="function"?t:Lr(t)))}function ja(t){typeof t!="function"&&(t=Er(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var o=e[a],s=o.length,l=r[a]=[],c,u=0;u<s;++u)(c=o[u])&&t.call(c,c.__data__,u,o)&&l.push(c);return new rt(r,this._parents)}function Tr(t){return new Array(t.length)}function Qa(){return new rt(this._enter||this._groups.map(Tr),this._parents)}function Re(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}Re.prototype={constructor:Re,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function Ja(t){return function(){return t}}function Za(t,e,n,r,a,o){for(var s=0,l,c=e.length,u=o.length;s<u;++s)(l=e[s])?(l.__data__=o[s],r[s]=l):n[s]=new Re(t,o[s]);for(;s<c;++s)(l=e[s])&&(a[s]=l)}function ti(t,e,n,r,a,o,s){var l,c,u=new Map,d=e.length,f=o.length,p=new Array(d),g;for(l=0;l<d;++l)(c=e[l])&&(p[l]=g=s.call(c,c.__data__,l,e)+"",u.has(g)?a[l]=c:u.set(g,c));for(l=0;l<f;++l)g=s.call(t,o[l],l,o)+"",(c=u.get(g))?(r[l]=c,c.__data__=o[l],u.delete(g)):n[l]=new Re(t,o[l]);for(l=0;l<d;++l)(c=e[l])&&u.get(p[l])===c&&(a[l]=c)}function ei(t){return t.__data__}function ni(t,e){if(!arguments.length)return Array.from(this,ei);var n=e?ti:Za,r=this._parents,a=this._groups;typeof t!="function"&&(t=Ja(t));for(var o=a.length,s=new Array(o),l=new Array(o),c=new Array(o),u=0;u<o;++u){var d=r[u],f=a[u],p=f.length,g=ri(t.call(d,d&&d.__data__,u,r)),k=g.length,P=l[u]=new Array(k),E=s[u]=new Array(k),S=c[u]=new Array(p);n(d,f,P,E,S,g,e);for(var w=0,N=0,I,L;w<k;++w)if(I=P[w]){for(w>=N&&(N=w+1);!(L=E[N])&&++N<k;);I._next=L||null}}return s=new rt(s,r),s._enter=l,s._exit=c,s}function ri(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function ai(){return new rt(this._exit||this._groups.map(Tr),this._parents)}function ii(t,e,n){var r=this.enter(),a=this,o=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(a=e(a),a&&(a=a.selection())),n==null?o.remove():n(o),r&&a?r.merge(a).order():a}function oi(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,a=n.length,o=r.length,s=Math.min(a,o),l=new Array(a),c=0;c<s;++c)for(var u=n[c],d=r[c],f=u.length,p=l[c]=new Array(f),g,k=0;k<f;++k)(g=u[k]||d[k])&&(p[k]=g);for(;c<a;++c)l[c]=n[c];return new rt(l,this._parents)}function si(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],a=r.length-1,o=r[a],s;--a>=0;)(s=r[a])&&(o&&s.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(s,o),o=s);return this}function li(t){t||(t=ci);function e(f,p){return f&&p?t(f.__data__,p.__data__):!f-!p}for(var n=this._groups,r=n.length,a=new Array(r),o=0;o<r;++o){for(var s=n[o],l=s.length,c=a[o]=new Array(l),u,d=0;d<l;++d)(u=s[d])&&(c[d]=u);c.sort(e)}return new rt(a,this._parents).order()}function ci(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function ui(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function di(){return Array.from(this)}function fi(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],a=0,o=r.length;a<o;++a){var s=r[a];if(s)return s}return null}function hi(){let t=0;for(const e of this)++t;return t}function pi(){return!this.node()}function mi(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var a=e[n],o=0,s=a.length,l;o<s;++o)(l=a[o])&&t.call(l,l.__data__,o,a);return this}function gi(t){return function(){this.removeAttribute(t)}}function vi(t){return function(){this.removeAttributeNS(t.space,t.local)}}function yi(t,e){return function(){this.setAttribute(t,e)}}function bi(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function wi(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function xi(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function Si(t,e){var n=Ge(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?vi:gi:typeof e=="function"?n.local?xi:wi:n.local?bi:yi)(n,e))}function Ar(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function $i(t){return function(){this.style.removeProperty(t)}}function Mi(t,e,n){return function(){this.style.setProperty(t,e,n)}}function _i(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function ki(t,e,n){return arguments.length>1?this.each((e==null?$i:typeof e=="function"?_i:Mi)(t,e,n??"")):Zt(this.node(),t)}function Zt(t,e){return t.style.getPropertyValue(e)||Ar(t).getComputedStyle(t,null).getPropertyValue(e)}function Di(t){return function(){delete this[t]}}function Ei(t,e){return function(){this[t]=e}}function Li(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function Ti(t,e){return arguments.length>1?this.each((e==null?Di:typeof e=="function"?Li:Ei)(t,e)):this.node()[t]}function Cr(t){return t.trim().split(/^|\s+/)}function Ln(t){return t.classList||new Ir(t)}function Ir(t){this._node=t,this._names=Cr(t.getAttribute("class")||"")}Ir.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function Nr(t,e){for(var n=Ln(t),r=-1,a=e.length;++r<a;)n.add(e[r])}function Pr(t,e){for(var n=Ln(t),r=-1,a=e.length;++r<a;)n.remove(e[r])}function Ai(t){return function(){Nr(this,t)}}function Ci(t){return function(){Pr(this,t)}}function Ii(t,e){return function(){(e.apply(this,arguments)?Nr:Pr)(this,t)}}function Ni(t,e){var n=Cr(t+"");if(arguments.length<2){for(var r=Ln(this.node()),a=-1,o=n.length;++a<o;)if(!r.contains(n[a]))return!1;return!0}return this.each((typeof e=="function"?Ii:e?Ai:Ci)(n,e))}function Pi(){this.textContent=""}function Ri(t){return function(){this.textContent=t}}function Bi(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function zi(t){return arguments.length?this.each(t==null?Pi:(typeof t=="function"?Bi:Ri)(t)):this.node().textContent}function Fi(){this.innerHTML=""}function Oi(t){return function(){this.innerHTML=t}}function qi(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function Vi(t){return arguments.length?this.each(t==null?Fi:(typeof t=="function"?qi:Oi)(t)):this.node().innerHTML}function Xi(){this.nextSibling&&this.parentNode.appendChild(this)}function Hi(){return this.each(Xi)}function Wi(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Ui(){return this.each(Wi)}function Yi(t){var e=typeof t=="function"?t:kr(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function Ki(){return null}function Gi(t,e){var n=typeof t=="function"?t:kr(t),r=e==null?Ki:typeof e=="function"?e:En(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function ji(){var t=this.parentNode;t&&t.removeChild(this)}function Qi(){return this.each(ji)}function Ji(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Zi(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function to(t){return this.select(t?Zi:Ji)}function eo(t){return arguments.length?this.property("__data__",t):this.node().__data__}function no(t){return function(e){t.call(this,e,this.__data__)}}function ro(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function ao(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,a=e.length,o;n<a;++n)o=e[n],(!t.type||o.type===t.type)&&o.name===t.name?this.removeEventListener(o.type,o.listener,o.options):e[++r]=o;++r?e.length=r:delete this.__on}}}function io(t,e,n){return function(){var r=this.__on,a,o=no(e);if(r){for(var s=0,l=r.length;s<l;++s)if((a=r[s]).type===t.type&&a.name===t.name){this.removeEventListener(a.type,a.listener,a.options),this.addEventListener(a.type,a.listener=o,a.options=n),a.value=e;return}}this.addEventListener(t.type,o,n),a={type:t.type,name:t.name,value:e,listener:o,options:n},r?r.push(a):this.__on=[a]}}function oo(t,e,n){var r=ro(t+""),a,o=r.length,s;if(arguments.length<2){var l=this.node().__on;if(l){for(var c=0,u=l.length,d;c<u;++c)for(a=0,d=l[c];a<o;++a)if((s=r[a]).type===d.type&&s.name===d.name)return d.value}return}for(l=e?io:ao,a=0;a<o;++a)this.each(l(r[a],e,n));return this}function Rr(t,e,n){var r=Ar(t),a=r.CustomEvent;typeof a=="function"?a=new a(e,n):(a=r.document.createEvent("Event"),n?(a.initEvent(e,n.bubbles,n.cancelable),a.detail=n.detail):a.initEvent(e,!1,!1)),t.dispatchEvent(a)}function so(t,e){return function(){return Rr(this,t,e)}}function lo(t,e){return function(){return Rr(this,t,e.apply(this,arguments))}}function co(t,e){return this.each((typeof e=="function"?lo:so)(t,e))}function*uo(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],a=0,o=r.length,s;a<o;++a)(s=r[a])&&(yield s)}var Br=[null];function rt(t,e){this._groups=t,this._parents=e}function ve(){return new rt([[document.documentElement]],Br)}function fo(){return this}rt.prototype=ve.prototype={constructor:rt,select:Ba,selectAll:qa,selectChild:Wa,selectChildren:Ga,filter:ja,data:ni,enter:Qa,exit:ai,join:ii,merge:oi,selection:fo,order:si,sort:li,call:ui,nodes:di,node:fi,size:hi,empty:pi,each:mi,attr:Si,style:ki,property:Ti,classed:Ni,text:zi,html:Vi,raise:Hi,lower:Ui,append:Yi,insert:Gi,remove:Qi,clone:to,datum:eo,on:oo,dispatch:co,[Symbol.iterator]:uo};function Mt(t){return typeof t=="string"?new rt([[document.querySelector(t)]],[document.documentElement]):new rt([[t]],Br)}function ho(t){let e;for(;e=t.sourceEvent;)t=e;return t}function $t(t,e){if(t=ho(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var a=e.getBoundingClientRect();return[t.clientX-a.left-e.clientLeft,t.clientY-a.top-e.clientTop]}}return[t.pageX,t.pageY]}const dn={capture:!0,passive:!1};function fn(t){t.preventDefault(),t.stopImmediatePropagation()}function po(t){var e=t.document.documentElement,n=Mt(t).on("dragstart.drag",fn,dn);"onselectstart"in e?n.on("selectstart.drag",fn,dn):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function mo(t,e){var n=t.document.documentElement,r=Mt(t).on("dragstart.drag",null);e&&(r.on("click.drag",fn,dn),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}function Tn(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function zr(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function ye(){}var de=.7,Be=1/de,Qt="\\s*([+-]?\\d+)\\s*",fe="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ft="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",go=/^#([0-9a-f]{3,8})$/,vo=new RegExp(`^rgb\\(${Qt},${Qt},${Qt}\\)$`),yo=new RegExp(`^rgb\\(${ft},${ft},${ft}\\)$`),bo=new RegExp(`^rgba\\(${Qt},${Qt},${Qt},${fe}\\)$`),wo=new RegExp(`^rgba\\(${ft},${ft},${ft},${fe}\\)$`),xo=new RegExp(`^hsl\\(${fe},${ft},${ft}\\)$`),So=new RegExp(`^hsla\\(${fe},${ft},${ft},${fe}\\)$`),Un={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Tn(ye,zt,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Yn,formatHex:Yn,formatHex8:$o,formatHsl:Mo,formatRgb:Kn,toString:Kn});function Yn(){return this.rgb().formatHex()}function $o(){return this.rgb().formatHex8()}function Mo(){return Fr(this).formatHsl()}function Kn(){return this.rgb().formatRgb()}function zt(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=go.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?Gn(e):n===3?new tt(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Se(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Se(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=vo.exec(t))?new tt(e[1],e[2],e[3],1):(e=yo.exec(t))?new tt(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=bo.exec(t))?Se(e[1],e[2],e[3],e[4]):(e=wo.exec(t))?Se(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=xo.exec(t))?Jn(e[1],e[2]/100,e[3]/100,1):(e=So.exec(t))?Jn(e[1],e[2]/100,e[3]/100,e[4]):Un.hasOwnProperty(t)?Gn(Un[t]):t==="transparent"?new tt(NaN,NaN,NaN,0):null}function Gn(t){return new tt(t>>16&255,t>>8&255,t&255,1)}function Se(t,e,n,r){return r<=0&&(t=e=n=NaN),new tt(t,e,n,r)}function _o(t){return t instanceof ye||(t=zt(t)),t?(t=t.rgb(),new tt(t.r,t.g,t.b,t.opacity)):new tt}function hn(t,e,n,r){return arguments.length===1?_o(t):new tt(t,e,n,r??1)}function tt(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}Tn(tt,hn,zr(ye,{brighter(t){return t=t==null?Be:Math.pow(Be,t),new tt(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?de:Math.pow(de,t),new tt(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new tt(Bt(this.r),Bt(this.g),Bt(this.b),ze(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:jn,formatHex:jn,formatHex8:ko,formatRgb:Qn,toString:Qn}));function jn(){return`#${It(this.r)}${It(this.g)}${It(this.b)}`}function ko(){return`#${It(this.r)}${It(this.g)}${It(this.b)}${It((isNaN(this.opacity)?1:this.opacity)*255)}`}function Qn(){const t=ze(this.opacity);return`${t===1?"rgb(":"rgba("}${Bt(this.r)}, ${Bt(this.g)}, ${Bt(this.b)}${t===1?")":`, ${t})`}`}function ze(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Bt(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function It(t){return t=Bt(t),(t<16?"0":"")+t.toString(16)}function Jn(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new lt(t,e,n,r)}function Fr(t){if(t instanceof lt)return new lt(t.h,t.s,t.l,t.opacity);if(t instanceof ye||(t=zt(t)),!t)return new lt;if(t instanceof lt)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,a=Math.min(e,n,r),o=Math.max(e,n,r),s=NaN,l=o-a,c=(o+a)/2;return l?(e===o?s=(n-r)/l+(n<r)*6:n===o?s=(r-e)/l+2:s=(e-n)/l+4,l/=c<.5?o+a:2-o-a,s*=60):l=c>0&&c<1?0:s,new lt(s,l,c,t.opacity)}function Do(t,e,n,r){return arguments.length===1?Fr(t):new lt(t,e,n,r??1)}function lt(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}Tn(lt,Do,zr(ye,{brighter(t){return t=t==null?Be:Math.pow(Be,t),new lt(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?de:Math.pow(de,t),new lt(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,a=2*n-r;return new tt(rn(t>=240?t-240:t+120,a,r),rn(t,a,r),rn(t<120?t+240:t-120,a,r),this.opacity)},clamp(){return new lt(Zn(this.h),$e(this.s),$e(this.l),ze(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=ze(this.opacity);return`${t===1?"hsl(":"hsla("}${Zn(this.h)}, ${$e(this.s)*100}%, ${$e(this.l)*100}%${t===1?")":`, ${t})`}`}}));function Zn(t){return t=(t||0)%360,t<0?t+360:t}function $e(t){return Math.max(0,Math.min(1,t||0))}function rn(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const An=t=>()=>t;function Eo(t,e){return function(n){return t+n*e}}function Lo(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function To(t){return(t=+t)==1?Or:function(e,n){return n-e?Lo(e,n,t):An(isNaN(e)?n:e)}}function Or(t,e){var n=e-t;return n?Eo(t,n):An(isNaN(t)?e:t)}const Fe=(function t(e){var n=To(e);function r(a,o){var s=n((a=hn(a)).r,(o=hn(o)).r),l=n(a.g,o.g),c=n(a.b,o.b),u=Or(a.opacity,o.opacity);return function(d){return a.r=s(d),a.g=l(d),a.b=c(d),a.opacity=u(d),a+""}}return r.gamma=t,r})(1);function Ao(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),a;return function(o){for(a=0;a<n;++a)r[a]=t[a]*(1-o)+e[a]*o;return r}}function Co(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Io(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,a=new Array(r),o=new Array(n),s;for(s=0;s<r;++s)a[s]=Cn(t[s],e[s]);for(;s<n;++s)o[s]=e[s];return function(l){for(s=0;s<r;++s)o[s]=a[s](l);return o}}function No(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function st(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function Po(t,e){var n={},r={},a;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(a in e)a in t?n[a]=Cn(t[a],e[a]):r[a]=e[a];return function(o){for(a in n)r[a]=n[a](o);return r}}var pn=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,an=new RegExp(pn.source,"g");function Ro(t){return function(){return t}}function Bo(t){return function(e){return t(e)+""}}function qr(t,e){var n=pn.lastIndex=an.lastIndex=0,r,a,o,s=-1,l=[],c=[];for(t=t+"",e=e+"";(r=pn.exec(t))&&(a=an.exec(e));)(o=a.index)>n&&(o=e.slice(n,o),l[s]?l[s]+=o:l[++s]=o),(r=r[0])===(a=a[0])?l[s]?l[s]+=a:l[++s]=a:(l[++s]=null,c.push({i:s,x:st(r,a)})),n=an.lastIndex;return n<e.length&&(o=e.slice(n),l[s]?l[s]+=o:l[++s]=o),l.length<2?c[0]?Bo(c[0].x):Ro(e):(e=c.length,function(u){for(var d=0,f;d<e;++d)l[(f=c[d]).i]=f.x(u);return l.join("")})}function Cn(t,e){var n=typeof e,r;return e==null||n==="boolean"?An(e):(n==="number"?st:n==="string"?(r=zt(e))?(e=r,Fe):qr:e instanceof zt?Fe:e instanceof Date?No:Co(e)?Ao:Array.isArray(e)?Io:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?Po:st)(t,e)}function zo(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var tr=180/Math.PI,mn={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Vr(t,e,n,r,a,o){var s,l,c;return(s=Math.sqrt(t*t+e*e))&&(t/=s,e/=s),(c=t*n+e*r)&&(n-=t*c,r-=e*c),(l=Math.sqrt(n*n+r*r))&&(n/=l,r/=l,c/=l),t*r<e*n&&(t=-t,e=-e,c=-c,s=-s),{translateX:a,translateY:o,rotate:Math.atan2(e,t)*tr,skewX:Math.atan(c)*tr,scaleX:s,scaleY:l}}var Me;function Fo(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?mn:Vr(e.a,e.b,e.c,e.d,e.e,e.f)}function Oo(t){return t==null||(Me||(Me=document.createElementNS("http://www.w3.org/2000/svg","g")),Me.setAttribute("transform",t),!(t=Me.transform.baseVal.consolidate()))?mn:(t=t.matrix,Vr(t.a,t.b,t.c,t.d,t.e,t.f))}function Xr(t,e,n,r){function a(u){return u.length?u.pop()+" ":""}function o(u,d,f,p,g,k){if(u!==f||d!==p){var P=g.push("translate(",null,e,null,n);k.push({i:P-4,x:st(u,f)},{i:P-2,x:st(d,p)})}else(f||p)&&g.push("translate("+f+e+p+n)}function s(u,d,f,p){u!==d?(u-d>180?d+=360:d-u>180&&(u+=360),p.push({i:f.push(a(f)+"rotate(",null,r)-2,x:st(u,d)})):d&&f.push(a(f)+"rotate("+d+r)}function l(u,d,f,p){u!==d?p.push({i:f.push(a(f)+"skewX(",null,r)-2,x:st(u,d)}):d&&f.push(a(f)+"skewX("+d+r)}function c(u,d,f,p,g,k){if(u!==f||d!==p){var P=g.push(a(g)+"scale(",null,",",null,")");k.push({i:P-4,x:st(u,f)},{i:P-2,x:st(d,p)})}else(f!==1||p!==1)&&g.push(a(g)+"scale("+f+","+p+")")}return function(u,d){var f=[],p=[];return u=t(u),d=t(d),o(u.translateX,u.translateY,d.translateX,d.translateY,f,p),s(u.rotate,d.rotate,f,p),l(u.skewX,d.skewX,f,p),c(u.scaleX,u.scaleY,d.scaleX,d.scaleY,f,p),u=d=null,function(g){for(var k=-1,P=p.length,E;++k<P;)f[(E=p[k]).i]=E.x(g);return f.join("")}}}var qo=Xr(Fo,"px, ","px)","deg)"),Vo=Xr(Oo,", ",")",")"),Xo=1e-12;function er(t){return((t=Math.exp(t))+1/t)/2}function Ho(t){return((t=Math.exp(t))-1/t)/2}function Wo(t){return((t=Math.exp(2*t))-1)/(t+1)}const Uo=(function t(e,n,r){function a(o,s){var l=o[0],c=o[1],u=o[2],d=s[0],f=s[1],p=s[2],g=d-l,k=f-c,P=g*g+k*k,E,S;if(P<Xo)S=Math.log(p/u)/e,E=function(y){return[l+y*g,c+y*k,u*Math.exp(e*y*S)]};else{var w=Math.sqrt(P),N=(p*p-u*u+r*P)/(2*u*n*w),I=(p*p-u*u-r*P)/(2*p*n*w),L=Math.log(Math.sqrt(N*N+1)-N),R=Math.log(Math.sqrt(I*I+1)-I);S=(R-L)/e,E=function(y){var b=y*S,D=er(L),A=u/(n*w)*(D*Wo(e*b+L)-Ho(L));return[l+A*g,c+A*k,u*D/er(e*b+L)]}}return E.duration=S*1e3*e/Math.SQRT2,E}return a.rho=function(o){var s=Math.max(.001,+o),l=s*s,c=l*l;return t(s,l,c)},a})(Math.SQRT2,2,4);var te=0,oe=0,re=0,Hr=1e3,Oe,se,qe=0,Ft=0,je=0,he=typeof performance=="object"&&performance.now?performance:Date,Wr=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function In(){return Ft||(Wr(Yo),Ft=he.now()+je)}function Yo(){Ft=0}function Ve(){this._call=this._time=this._next=null}Ve.prototype=Ur.prototype={constructor:Ve,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?In():+n)+(e==null?0:+e),!this._next&&se!==this&&(se?se._next=this:Oe=this,se=this),this._call=t,this._time=n,gn()},stop:function(){this._call&&(this._call=null,this._time=1/0,gn())}};function Ur(t,e,n){var r=new Ve;return r.restart(t,e,n),r}function Ko(){In(),++te;for(var t=Oe,e;t;)(e=Ft-t._time)>=0&&t._call.call(void 0,e),t=t._next;--te}function nr(){Ft=(qe=he.now())+je,te=oe=0;try{Ko()}finally{te=0,jo(),Ft=0}}function Go(){var t=he.now(),e=t-qe;e>Hr&&(je-=e,qe=t)}function jo(){for(var t,e=Oe,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:Oe=n);se=t,gn(r)}function gn(t){if(!te){oe&&(oe=clearTimeout(oe));var e=t-Ft;e>24?(t<1/0&&(oe=setTimeout(nr,t-he.now()-je)),re&&(re=clearInterval(re))):(re||(qe=he.now(),re=setInterval(Go,Hr)),te=1,Wr(nr))}}function rr(t,e,n){var r=new Ve;return e=e==null?0:+e,r.restart(a=>{r.stop(),t(a+e)},e,n),r}var Qo=Dn("start","end","cancel","interrupt"),Jo=[],Yr=0,ar=1,vn=2,Ae=3,ir=4,yn=5,Ce=6;function Qe(t,e,n,r,a,o){var s=t.__transition;if(!s)t.__transition={};else if(n in s)return;Zo(t,n,{name:e,index:r,group:a,on:Qo,tween:Jo,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:Yr})}function Nn(t,e){var n=ct(t,e);if(n.state>Yr)throw new Error("too late; already scheduled");return n}function ht(t,e){var n=ct(t,e);if(n.state>Ae)throw new Error("too late; already running");return n}function ct(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function Zo(t,e,n){var r=t.__transition,a;r[e]=n,n.timer=Ur(o,0,n.time);function o(u){n.state=ar,n.timer.restart(s,n.delay,n.time),n.delay<=u&&s(u-n.delay)}function s(u){var d,f,p,g;if(n.state!==ar)return c();for(d in r)if(g=r[d],g.name===n.name){if(g.state===Ae)return rr(s);g.state===ir?(g.state=Ce,g.timer.stop(),g.on.call("interrupt",t,t.__data__,g.index,g.group),delete r[d]):+d<e&&(g.state=Ce,g.timer.stop(),g.on.call("cancel",t,t.__data__,g.index,g.group),delete r[d])}if(rr(function(){n.state===Ae&&(n.state=ir,n.timer.restart(l,n.delay,n.time),l(u))}),n.state=vn,n.on.call("start",t,t.__data__,n.index,n.group),n.state===vn){for(n.state=Ae,a=new Array(p=n.tween.length),d=0,f=-1;d<p;++d)(g=n.tween[d].value.call(t,t.__data__,n.index,n.group))&&(a[++f]=g);a.length=f+1}}function l(u){for(var d=u<n.duration?n.ease.call(null,u/n.duration):(n.timer.restart(c),n.state=yn,1),f=-1,p=a.length;++f<p;)a[f].call(t,d);n.state===yn&&(n.on.call("end",t,t.__data__,n.index,n.group),c())}function c(){n.state=Ce,n.timer.stop(),delete r[e];for(var u in r)return;delete t.__transition}}function Ie(t,e){var n=t.__transition,r,a,o=!0,s;if(n){e=e==null?null:e+"";for(s in n){if((r=n[s]).name!==e){o=!1;continue}a=r.state>vn&&r.state<yn,r.state=Ce,r.timer.stop(),r.on.call(a?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[s]}o&&delete t.__transition}}function ts(t){return this.each(function(){Ie(this,t)})}function es(t,e){var n,r;return function(){var a=ht(this,t),o=a.tween;if(o!==n){r=n=o;for(var s=0,l=r.length;s<l;++s)if(r[s].name===e){r=r.slice(),r.splice(s,1);break}}a.tween=r}}function ns(t,e,n){var r,a;if(typeof n!="function")throw new Error;return function(){var o=ht(this,t),s=o.tween;if(s!==r){a=(r=s).slice();for(var l={name:e,value:n},c=0,u=a.length;c<u;++c)if(a[c].name===e){a[c]=l;break}c===u&&a.push(l)}o.tween=a}}function rs(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=ct(this.node(),n).tween,a=0,o=r.length,s;a<o;++a)if((s=r[a]).name===t)return s.value;return null}return this.each((e==null?es:ns)(n,t,e))}function Pn(t,e,n){var r=t._id;return t.each(function(){var a=ht(this,r);(a.value||(a.value={}))[e]=n.apply(this,arguments)}),function(a){return ct(a,r).value[e]}}function Kr(t,e){var n;return(typeof e=="number"?st:e instanceof zt?Fe:(n=zt(e))?(e=n,Fe):qr)(t,e)}function as(t){return function(){this.removeAttribute(t)}}function is(t){return function(){this.removeAttributeNS(t.space,t.local)}}function os(t,e,n){var r,a=n+"",o;return function(){var s=this.getAttribute(t);return s===a?null:s===r?o:o=e(r=s,n)}}function ss(t,e,n){var r,a=n+"",o;return function(){var s=this.getAttributeNS(t.space,t.local);return s===a?null:s===r?o:o=e(r=s,n)}}function ls(t,e,n){var r,a,o;return function(){var s,l=n(this),c;return l==null?void this.removeAttribute(t):(s=this.getAttribute(t),c=l+"",s===c?null:s===r&&c===a?o:(a=c,o=e(r=s,l)))}}function cs(t,e,n){var r,a,o;return function(){var s,l=n(this),c;return l==null?void this.removeAttributeNS(t.space,t.local):(s=this.getAttributeNS(t.space,t.local),c=l+"",s===c?null:s===r&&c===a?o:(a=c,o=e(r=s,l)))}}function us(t,e){var n=Ge(t),r=n==="transform"?Vo:Kr;return this.attrTween(t,typeof e=="function"?(n.local?cs:ls)(n,r,Pn(this,"attr."+t,e)):e==null?(n.local?is:as)(n):(n.local?ss:os)(n,r,e))}function ds(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function fs(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function hs(t,e){var n,r;function a(){var o=e.apply(this,arguments);return o!==r&&(n=(r=o)&&fs(t,o)),n}return a._value=e,a}function ps(t,e){var n,r;function a(){var o=e.apply(this,arguments);return o!==r&&(n=(r=o)&&ds(t,o)),n}return a._value=e,a}function ms(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=Ge(t);return this.tween(n,(r.local?hs:ps)(r,e))}function gs(t,e){return function(){Nn(this,t).delay=+e.apply(this,arguments)}}function vs(t,e){return e=+e,function(){Nn(this,t).delay=e}}function ys(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?gs:vs)(e,t)):ct(this.node(),e).delay}function bs(t,e){return function(){ht(this,t).duration=+e.apply(this,arguments)}}function ws(t,e){return e=+e,function(){ht(this,t).duration=e}}function xs(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?bs:ws)(e,t)):ct(this.node(),e).duration}function Ss(t,e){if(typeof e!="function")throw new Error;return function(){ht(this,t).ease=e}}function $s(t){var e=this._id;return arguments.length?this.each(Ss(e,t)):ct(this.node(),e).ease}function Ms(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;ht(this,t).ease=n}}function _s(t){if(typeof t!="function")throw new Error;return this.each(Ms(this._id,t))}function ks(t){typeof t!="function"&&(t=Er(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var o=e[a],s=o.length,l=r[a]=[],c,u=0;u<s;++u)(c=o[u])&&t.call(c,c.__data__,u,o)&&l.push(c);return new xt(r,this._parents,this._name,this._id)}function Ds(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,a=n.length,o=Math.min(r,a),s=new Array(r),l=0;l<o;++l)for(var c=e[l],u=n[l],d=c.length,f=s[l]=new Array(d),p,g=0;g<d;++g)(p=c[g]||u[g])&&(f[g]=p);for(;l<r;++l)s[l]=e[l];return new xt(s,this._parents,this._name,this._id)}function Es(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function Ls(t,e,n){var r,a,o=Es(e)?Nn:ht;return function(){var s=o(this,t),l=s.on;l!==r&&(a=(r=l).copy()).on(e,n),s.on=a}}function Ts(t,e){var n=this._id;return arguments.length<2?ct(this.node(),n).on.on(t):this.each(Ls(n,t,e))}function As(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function Cs(){return this.on("end.remove",As(this._id))}function Is(t){var e=this._name,n=this._id;typeof t!="function"&&(t=En(t));for(var r=this._groups,a=r.length,o=new Array(a),s=0;s<a;++s)for(var l=r[s],c=l.length,u=o[s]=new Array(c),d,f,p=0;p<c;++p)(d=l[p])&&(f=t.call(d,d.__data__,p,l))&&("__data__"in d&&(f.__data__=d.__data__),u[p]=f,Qe(u[p],e,n,p,u,ct(d,n)));return new xt(o,this._parents,e,n)}function Ns(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Dr(t));for(var r=this._groups,a=r.length,o=[],s=[],l=0;l<a;++l)for(var c=r[l],u=c.length,d,f=0;f<u;++f)if(d=c[f]){for(var p=t.call(d,d.__data__,f,c),g,k=ct(d,n),P=0,E=p.length;P<E;++P)(g=p[P])&&Qe(g,e,n,P,p,k);o.push(p),s.push(d)}return new xt(o,s,e,n)}var Ps=ve.prototype.constructor;function Rs(){return new Ps(this._groups,this._parents)}function Bs(t,e){var n,r,a;return function(){var o=Zt(this,t),s=(this.style.removeProperty(t),Zt(this,t));return o===s?null:o===n&&s===r?a:a=e(n=o,r=s)}}function Gr(t){return function(){this.style.removeProperty(t)}}function zs(t,e,n){var r,a=n+"",o;return function(){var s=Zt(this,t);return s===a?null:s===r?o:o=e(r=s,n)}}function Fs(t,e,n){var r,a,o;return function(){var s=Zt(this,t),l=n(this),c=l+"";return l==null&&(c=l=(this.style.removeProperty(t),Zt(this,t))),s===c?null:s===r&&c===a?o:(a=c,o=e(r=s,l))}}function Os(t,e){var n,r,a,o="style."+e,s="end."+o,l;return function(){var c=ht(this,t),u=c.on,d=c.value[o]==null?l||(l=Gr(e)):void 0;(u!==n||a!==d)&&(r=(n=u).copy()).on(s,a=d),c.on=r}}function qs(t,e,n){var r=(t+="")=="transform"?qo:Kr;return e==null?this.styleTween(t,Bs(t,r)).on("end.style."+t,Gr(t)):typeof e=="function"?this.styleTween(t,Fs(t,r,Pn(this,"style."+t,e))).each(Os(this._id,t)):this.styleTween(t,zs(t,r,e),n).on("end.style."+t,null)}function Vs(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function Xs(t,e,n){var r,a;function o(){var s=e.apply(this,arguments);return s!==a&&(r=(a=s)&&Vs(t,s,n)),r}return o._value=e,o}function Hs(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,Xs(t,e,n??""))}function Ws(t){return function(){this.textContent=t}}function Us(t){return function(){var e=t(this);this.textContent=e??""}}function Ys(t){return this.tween("text",typeof t=="function"?Us(Pn(this,"text",t)):Ws(t==null?"":t+""))}function Ks(t){return function(e){this.textContent=t.call(this,e)}}function Gs(t){var e,n;function r(){var a=t.apply(this,arguments);return a!==n&&(e=(n=a)&&Ks(a)),e}return r._value=t,r}function js(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,Gs(t))}function Qs(){for(var t=this._name,e=this._id,n=jr(),r=this._groups,a=r.length,o=0;o<a;++o)for(var s=r[o],l=s.length,c,u=0;u<l;++u)if(c=s[u]){var d=ct(c,e);Qe(c,t,n,u,s,{time:d.time+d.delay+d.duration,delay:0,duration:d.duration,ease:d.ease})}return new xt(r,this._parents,t,n)}function Js(){var t,e,n=this,r=n._id,a=n.size();return new Promise(function(o,s){var l={value:s},c={value:function(){--a===0&&o()}};n.each(function(){var u=ht(this,r),d=u.on;d!==t&&(e=(t=d).copy(),e._.cancel.push(l),e._.interrupt.push(l),e._.end.push(c)),u.on=e}),a===0&&o()})}var Zs=0;function xt(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function jr(){return++Zs}var pt=ve.prototype;xt.prototype={constructor:xt,select:Is,selectAll:Ns,selectChild:pt.selectChild,selectChildren:pt.selectChildren,filter:ks,merge:Ds,selection:Rs,transition:Qs,call:pt.call,nodes:pt.nodes,node:pt.node,size:pt.size,empty:pt.empty,each:pt.each,on:Ts,attr:us,attrTween:ms,style:qs,styleTween:Hs,text:Ys,textTween:js,remove:Cs,tween:rs,delay:ys,duration:xs,ease:$s,easeVarying:_s,end:Js,[Symbol.iterator]:pt[Symbol.iterator]};function tl(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var el={time:null,delay:0,duration:250,ease:tl};function nl(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function rl(t){var e,n;t instanceof xt?(e=t._id,t=t._name):(e=jr(),(n=el).time=In(),t=t==null?null:t+"");for(var r=this._groups,a=r.length,o=0;o<a;++o)for(var s=r[o],l=s.length,c,u=0;u<l;++u)(c=s[u])&&Qe(c,t,e,u,s,n||nl(c,e));return new xt(r,this._parents,t,e)}ve.prototype.interrupt=ts;ve.prototype.transition=rl;function al(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function Xe(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function ee(t){return t=Xe(Math.abs(t)),t?t[1]:NaN}function il(t,e){return function(n,r){for(var a=n.length,o=[],s=0,l=t[0],c=0;a>0&&l>0&&(c+l+1>r&&(l=Math.max(1,r-c)),o.push(n.substring(a-=l,a+l)),!((c+=l+1)>r));)l=t[s=(s+1)%t.length];return o.reverse().join(e)}}function ol(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var sl=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function He(t){if(!(e=sl.exec(t)))throw new Error("invalid format: "+t);var e;return new Rn({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}He.prototype=Rn.prototype;function Rn(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}Rn.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function ll(t){t:for(var e=t.length,n=1,r=-1,a;n<e;++n)switch(t[n]){case".":r=a=n;break;case"0":r===0&&(r=n),a=n;break;default:if(!+t[n])break t;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(a+1):t}var Qr;function cl(t,e){var n=Xe(t,e);if(!n)return t+"";var r=n[0],a=n[1],o=a-(Qr=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,s=r.length;return o===s?r:o>s?r+new Array(o-s+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+Xe(t,Math.max(0,e+o-1))[0]}function or(t,e){var n=Xe(t,e);if(!n)return t+"";var r=n[0],a=n[1];return a<0?"0."+new Array(-a).join("0")+r:r.length>a+1?r.slice(0,a+1)+"."+r.slice(a+1):r+new Array(a-r.length+2).join("0")}const sr={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:al,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>or(t*100,e),r:or,s:cl,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function lr(t){return t}var cr=Array.prototype.map,ur=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function ul(t){var e=t.grouping===void 0||t.thousands===void 0?lr:il(cr.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",a=t.decimal===void 0?".":t.decimal+"",o=t.numerals===void 0?lr:ol(cr.call(t.numerals,String)),s=t.percent===void 0?"%":t.percent+"",l=t.minus===void 0?"−":t.minus+"",c=t.nan===void 0?"NaN":t.nan+"";function u(f){f=He(f);var p=f.fill,g=f.align,k=f.sign,P=f.symbol,E=f.zero,S=f.width,w=f.comma,N=f.precision,I=f.trim,L=f.type;L==="n"?(w=!0,L="g"):sr[L]||(N===void 0&&(N=12),I=!0,L="g"),(E||p==="0"&&g==="=")&&(E=!0,p="0",g="=");var R=P==="$"?n:P==="#"&&/[boxX]/.test(L)?"0"+L.toLowerCase():"",y=P==="$"?r:/[%p]/.test(L)?s:"",b=sr[L],D=/[defgprs%]/.test(L);N=N===void 0?6:/[gprs]/.test(L)?Math.max(1,Math.min(21,N)):Math.max(0,Math.min(20,N));function A(M){var $=R,F=y,h,_,x;if(L==="c")F=b(M)+F,M="";else{M=+M;var B=M<0||1/M<0;if(M=isNaN(M)?c:b(Math.abs(M),N),I&&(M=ll(M)),B&&+M==0&&k!=="+"&&(B=!1),$=(B?k==="("?k:l:k==="-"||k==="("?"":k)+$,F=(L==="s"?ur[8+Qr/3]:"")+F+(B&&k==="("?")":""),D){for(h=-1,_=M.length;++h<_;)if(x=M.charCodeAt(h),48>x||x>57){F=(x===46?a+M.slice(h+1):M.slice(h))+F,M=M.slice(0,h);break}}}w&&!E&&(M=e(M,1/0));var C=$.length+M.length+F.length,T=C<S?new Array(S-C+1).join(p):"";switch(w&&E&&(M=e(T+M,T.length?S-F.length:1/0),T=""),g){case"<":M=$+M+F+T;break;case"=":M=$+T+M+F;break;case"^":M=T.slice(0,C=T.length>>1)+$+M+F+T.slice(C);break;default:M=T+$+M+F;break}return o(M)}return A.toString=function(){return f+""},A}function d(f,p){var g=u((f=He(f),f.type="f",f)),k=Math.max(-8,Math.min(8,Math.floor(ee(p)/3)))*3,P=Math.pow(10,-k),E=ur[8+k/3];return function(S){return g(P*S)+E}}return{format:u,formatPrefix:d}}var _e,Jr,Zr;dl({thousands:",",grouping:[3],currency:["$",""]});function dl(t){return _e=ul(t),Jr=_e.format,Zr=_e.formatPrefix,_e}function fl(t){return Math.max(0,-ee(Math.abs(t)))}function hl(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(ee(e)/3)))*3-ee(Math.abs(t)))}function pl(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,ee(e)-ee(t))+1}function ml(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function gl(t){return function(){return t}}function vl(t){return+t}var dr=[0,1];function Yt(t){return t}function bn(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:gl(isNaN(e)?NaN:.5)}function yl(t,e){var n;return t>e&&(n=t,t=e,e=n),function(r){return Math.max(t,Math.min(e,r))}}function bl(t,e,n){var r=t[0],a=t[1],o=e[0],s=e[1];return a<r?(r=bn(a,r),o=n(s,o)):(r=bn(r,a),o=n(o,s)),function(l){return o(r(l))}}function wl(t,e,n){var r=Math.min(t.length,e.length)-1,a=new Array(r),o=new Array(r),s=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++s<r;)a[s]=bn(t[s],t[s+1]),o[s]=n(e[s],e[s+1]);return function(l){var c=Ma(t,l,1,r)-1;return o[c](a[c](l))}}function xl(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function Sl(){var t=dr,e=dr,n=Cn,r,a,o,s=Yt,l,c,u;function d(){var p=Math.min(t.length,e.length);return s!==Yt&&(s=yl(t[0],t[p-1])),l=p>2?wl:bl,c=u=null,f}function f(p){return p==null||isNaN(p=+p)?o:(c||(c=l(t.map(r),e,n)))(r(s(p)))}return f.invert=function(p){return s(a((u||(u=l(e,t.map(r),st)))(p)))},f.domain=function(p){return arguments.length?(t=Array.from(p,vl),d()):t.slice()},f.range=function(p){return arguments.length?(e=Array.from(p),d()):e.slice()},f.rangeRound=function(p){return e=Array.from(p),n=zo,d()},f.clamp=function(p){return arguments.length?(s=p?!0:Yt,d()):s!==Yt},f.interpolate=function(p){return arguments.length?(n=p,d()):n},f.unknown=function(p){return arguments.length?(o=p,f):o},function(p,g){return r=p,a=g,d()}}function $l(){return Sl()(Yt,Yt)}function Ml(t,e,n,r){var a=La(t,e,n),o;switch(r=He(r??",f"),r.type){case"s":{var s=Math.max(Math.abs(t),Math.abs(e));return r.precision==null&&!isNaN(o=hl(a,s))&&(r.precision=o),Zr(r,s)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(o=pl(a,Math.max(Math.abs(t),Math.abs(e))))&&(r.precision=o-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(o=fl(a))&&(r.precision=o-(r.type==="%")*2);break}}return Jr(r)}function _l(t){var e=t.domain;return t.ticks=function(n){var r=e();return Ea(r[0],r[r.length-1],n??10)},t.tickFormat=function(n,r){var a=e();return Ml(a[0],a[a.length-1],n??10,r)},t.nice=function(n){n==null&&(n=10);var r=e(),a=0,o=r.length-1,s=r[a],l=r[o],c,u,d=10;for(l<s&&(u=s,s=l,l=u,u=a,a=o,o=u);d-- >0;){if(u=cn(s,l,n),u===c)return r[a]=s,r[o]=l,e(r);if(u>0)s=Math.floor(s/u)*u,l=Math.ceil(l/u)*u;else if(u<0)s=Math.ceil(s*u)/u,l=Math.floor(l*u)/u;else break;c=u}return t},t}function ta(){var t=$l();return t.copy=function(){return xl(t,ta())},ml.apply(t,arguments),_l(t)}const ke=t=>()=>t;function kl(t,{sourceEvent:e,target:n,transform:r,dispatch:a}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:a}})}function yt(t,e,n){this.k=t,this.x=e,this.y=n}yt.prototype={constructor:yt,scale:function(t){return t===1?this:new yt(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new yt(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Bn=new yt(1,0,0);yt.prototype;function on(t){t.stopImmediatePropagation()}function ae(t){t.preventDefault(),t.stopImmediatePropagation()}function Dl(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function El(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function fr(){return this.__zoom||Bn}function Ll(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function Tl(){return navigator.maxTouchPoints||"ontouchstart"in this}function Al(t,e,n){var r=t.invertX(e[0][0])-n[0][0],a=t.invertX(e[1][0])-n[1][0],o=t.invertY(e[0][1])-n[0][1],s=t.invertY(e[1][1])-n[1][1];return t.translate(a>r?(r+a)/2:Math.min(0,r)||Math.max(0,a),s>o?(o+s)/2:Math.min(0,o)||Math.max(0,s))}function Cl(){var t=Dl,e=El,n=Al,r=Ll,a=Tl,o=[0,1/0],s=[[-1/0,-1/0],[1/0,1/0]],l=250,c=Uo,u=Dn("start","zoom","end"),d,f,p,g=500,k=150,P=0,E=10;function S(h){h.property("__zoom",fr).on("wheel.zoom",b,{passive:!1}).on("mousedown.zoom",D).on("dblclick.zoom",A).filter(a).on("touchstart.zoom",M).on("touchmove.zoom",$).on("touchend.zoom touchcancel.zoom",F).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}S.transform=function(h,_,x,B){var C=h.selection?h.selection():h;C.property("__zoom",fr),h!==C?L(h,_,x,B):C.interrupt().each(function(){R(this,arguments).event(B).start().zoom(null,typeof _=="function"?_.apply(this,arguments):_).end()})},S.scaleBy=function(h,_,x,B){S.scaleTo(h,function(){var C=this.__zoom.k,T=typeof _=="function"?_.apply(this,arguments):_;return C*T},x,B)},S.scaleTo=function(h,_,x,B){S.transform(h,function(){var C=e.apply(this,arguments),T=this.__zoom,z=x==null?I(C):typeof x=="function"?x.apply(this,arguments):x,O=T.invert(z),V=typeof _=="function"?_.apply(this,arguments):_;return n(N(w(T,V),z,O),C,s)},x,B)},S.translateBy=function(h,_,x,B){S.transform(h,function(){return n(this.__zoom.translate(typeof _=="function"?_.apply(this,arguments):_,typeof x=="function"?x.apply(this,arguments):x),e.apply(this,arguments),s)},null,B)},S.translateTo=function(h,_,x,B,C){S.transform(h,function(){var T=e.apply(this,arguments),z=this.__zoom,O=B==null?I(T):typeof B=="function"?B.apply(this,arguments):B;return n(Bn.translate(O[0],O[1]).scale(z.k).translate(typeof _=="function"?-_.apply(this,arguments):-_,typeof x=="function"?-x.apply(this,arguments):-x),T,s)},B,C)};function w(h,_){return _=Math.max(o[0],Math.min(o[1],_)),_===h.k?h:new yt(_,h.x,h.y)}function N(h,_,x){var B=_[0]-x[0]*h.k,C=_[1]-x[1]*h.k;return B===h.x&&C===h.y?h:new yt(h.k,B,C)}function I(h){return[(+h[0][0]+ +h[1][0])/2,(+h[0][1]+ +h[1][1])/2]}function L(h,_,x,B){h.on("start.zoom",function(){R(this,arguments).event(B).start()}).on("interrupt.zoom end.zoom",function(){R(this,arguments).event(B).end()}).tween("zoom",function(){var C=this,T=arguments,z=R(C,T).event(B),O=e.apply(C,T),V=x==null?I(O):typeof x=="function"?x.apply(C,T):x,K=Math.max(O[1][0]-O[0][0],O[1][1]-O[0][1]),W=C.__zoom,et=typeof _=="function"?_.apply(C,T):_,at=c(W.invert(V).concat(K/W.k),et.invert(V).concat(K/et.k));return function(J){if(J===1)J=et;else{var it=at(J),Vt=K/it[2];J=new yt(Vt,V[0]-it[0]*Vt,V[1]-it[1]*Vt)}z.zoom(null,J)}})}function R(h,_,x){return!x&&h.__zooming||new y(h,_)}function y(h,_){this.that=h,this.args=_,this.active=0,this.sourceEvent=null,this.extent=e.apply(h,_),this.taps=0}y.prototype={event:function(h){return h&&(this.sourceEvent=h),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(h,_){return this.mouse&&h!=="mouse"&&(this.mouse[1]=_.invert(this.mouse[0])),this.touch0&&h!=="touch"&&(this.touch0[1]=_.invert(this.touch0[0])),this.touch1&&h!=="touch"&&(this.touch1[1]=_.invert(this.touch1[0])),this.that.__zoom=_,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(h){var _=Mt(this.that).datum();u.call(h,this.that,new kl(h,{sourceEvent:this.sourceEvent,target:S,transform:this.that.__zoom,dispatch:u}),_)}};function b(h,..._){if(!t.apply(this,arguments))return;var x=R(this,_).event(h),B=this.__zoom,C=Math.max(o[0],Math.min(o[1],B.k*Math.pow(2,r.apply(this,arguments)))),T=$t(h);if(x.wheel)(x.mouse[0][0]!==T[0]||x.mouse[0][1]!==T[1])&&(x.mouse[1]=B.invert(x.mouse[0]=T)),clearTimeout(x.wheel);else{if(B.k===C)return;x.mouse=[T,B.invert(T)],Ie(this),x.start()}ae(h),x.wheel=setTimeout(z,k),x.zoom("mouse",n(N(w(B,C),x.mouse[0],x.mouse[1]),x.extent,s));function z(){x.wheel=null,x.end()}}function D(h,..._){if(p||!t.apply(this,arguments))return;var x=h.currentTarget,B=R(this,_,!0).event(h),C=Mt(h.view).on("mousemove.zoom",V,!0).on("mouseup.zoom",K,!0),T=$t(h,x),z=h.clientX,O=h.clientY;po(h.view),on(h),B.mouse=[T,this.__zoom.invert(T)],Ie(this),B.start();function V(W){if(ae(W),!B.moved){var et=W.clientX-z,at=W.clientY-O;B.moved=et*et+at*at>P}B.event(W).zoom("mouse",n(N(B.that.__zoom,B.mouse[0]=$t(W,x),B.mouse[1]),B.extent,s))}function K(W){C.on("mousemove.zoom mouseup.zoom",null),mo(W.view,B.moved),ae(W),B.event(W).end()}}function A(h,..._){if(t.apply(this,arguments)){var x=this.__zoom,B=$t(h.changedTouches?h.changedTouches[0]:h,this),C=x.invert(B),T=x.k*(h.shiftKey?.5:2),z=n(N(w(x,T),B,C),e.apply(this,_),s);ae(h),l>0?Mt(this).transition().duration(l).call(L,z,B,h):Mt(this).call(S.transform,z,B,h)}}function M(h,..._){if(t.apply(this,arguments)){var x=h.touches,B=x.length,C=R(this,_,h.changedTouches.length===B).event(h),T,z,O,V;for(on(h),z=0;z<B;++z)O=x[z],V=$t(O,this),V=[V,this.__zoom.invert(V),O.identifier],C.touch0?!C.touch1&&C.touch0[2]!==V[2]&&(C.touch1=V,C.taps=0):(C.touch0=V,T=!0,C.taps=1+!!d);d&&(d=clearTimeout(d)),T&&(C.taps<2&&(f=V[0],d=setTimeout(function(){d=null},g)),Ie(this),C.start())}}function $(h,..._){if(this.__zooming){var x=R(this,_).event(h),B=h.changedTouches,C=B.length,T,z,O,V;for(ae(h),T=0;T<C;++T)z=B[T],O=$t(z,this),x.touch0&&x.touch0[2]===z.identifier?x.touch0[0]=O:x.touch1&&x.touch1[2]===z.identifier&&(x.touch1[0]=O);if(z=x.that.__zoom,x.touch1){var K=x.touch0[0],W=x.touch0[1],et=x.touch1[0],at=x.touch1[1],J=(J=et[0]-K[0])*J+(J=et[1]-K[1])*J,it=(it=at[0]-W[0])*it+(it=at[1]-W[1])*it;z=w(z,Math.sqrt(J/it)),O=[(K[0]+et[0])/2,(K[1]+et[1])/2],V=[(W[0]+at[0])/2,(W[1]+at[1])/2]}else if(x.touch0)O=x.touch0[0],V=x.touch0[1];else return;x.zoom("touch",n(N(z,O,V),x.extent,s))}}function F(h,..._){if(this.__zooming){var x=R(this,_).event(h),B=h.changedTouches,C=B.length,T,z;for(on(h),p&&clearTimeout(p),p=setTimeout(function(){p=null},g),T=0;T<C;++T)z=B[T],x.touch0&&x.touch0[2]===z.identifier?delete x.touch0:x.touch1&&x.touch1[2]===z.identifier&&delete x.touch1;if(x.touch1&&!x.touch0&&(x.touch0=x.touch1,delete x.touch1),x.touch0)x.touch0[1]=this.__zoom.invert(x.touch0[0]);else if(x.end(),x.taps===2&&(z=$t(z,this),Math.hypot(f[0]-z[0],f[1]-z[1])<E)){var O=Mt(this).on("dblclick.zoom");O&&O.apply(this,arguments)}}}return S.wheelDelta=function(h){return arguments.length?(r=typeof h=="function"?h:ke(+h),S):r},S.filter=function(h){return arguments.length?(t=typeof h=="function"?h:ke(!!h),S):t},S.touchable=function(h){return arguments.length?(a=typeof h=="function"?h:ke(!!h),S):a},S.extent=function(h){return arguments.length?(e=typeof h=="function"?h:ke([[+h[0][0],+h[0][1]],[+h[1][0],+h[1][1]]]),S):e},S.scaleExtent=function(h){return arguments.length?(o[0]=+h[0],o[1]=+h[1],S):[o[0],o[1]]},S.translateExtent=function(h){return arguments.length?(s[0][0]=+h[0][0],s[1][0]=+h[1][0],s[0][1]=+h[0][1],s[1][1]=+h[1][1],S):[[s[0][0],s[0][1]],[s[1][0],s[1][1]]]},S.constrain=function(h){return arguments.length?(n=h,S):n},S.duration=function(h){return arguments.length?(l=+h,S):l},S.interpolate=function(h){return arguments.length?(c=h,S):c},S.on=function(){var h=u.on.apply(u,arguments);return h===u?S:h},S.clickDistance=function(h){return arguments.length?(P=(h=+h)*h,S):Math.sqrt(P)},S.tapDistance=function(h){return arguments.length?(E=+h,S):E},S}const ot=360;let Tt=null,gt=null;function Il(t){const{root:e,isOpen:n,onCanvasToggleUpdate:r,onTimeSliderUpdate:a}=t;Tt||(Tt=e.querySelector('[data-role="sidebar"]')),gt||(gt=e.querySelector('[data-action="toggle-sidebar"]'));const o=e.querySelector('[data-role="canvas-toggle"]'),s=e.querySelector('[data-role="compare-info-trigger"]'),l=e.querySelector('[data-role="compare-info-overlay"]');if(!Tt||!o||!gt)return;const c=n?"translateX(0)":`translateX(${ot+24}px)`;Tt.style.transform=c,Tt.style.pointerEvents=n?"auto":"none",Tt.setAttribute("aria-hidden",String(!n));const u=n?`${ot+10}px`:"14px";gt.style.right=u,gt.setAttribute("aria-label",n?"Collapse sidebar":"Expand sidebar"),gt.className=n?"sidebar-toggle open":"sidebar-toggle";const d=gt.querySelector("span");d&&(d.textContent=n?"›":"‹");const f=n?ot+24:24;o.style.right=`${f}px`,s&&(s.style.right=`${f}px`),l&&(l.style.left=n?`${ot}px`:"0",l.style.right="0"),r&&r(f),a&&a(n)}function Nl(t){const{root:e,getSidebarOpen:n,setSidebarOpen:r,onCanvasToggleUpdate:a,onTimeSliderUpdate:o}=t;Tt=e.querySelector('[data-role="sidebar"]'),gt=e.querySelector('[data-action="toggle-sidebar"]'),gt?.addEventListener("click",()=>{const s=!n();r(s),Il({root:e,isOpen:s,onCanvasToggleUpdate:a,onTimeSliderUpdate:o})})}function Pl(t){const e=t?ot+10:14;return`
      <button
        type="button"
        aria-label="${t?"Collapse sidebar":"Expand sidebar"}"
        data-action="toggle-sidebar"
        class="${t?"sidebar-toggle open":"sidebar-toggle"}"
        style="right: ${e}px"
      >
        <span class="sidebar-toggle-icon">${t?"›":"‹"}</span>
      </button>
    `}function ea(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:{r:0,g:0,b:0}}const Rl=t=>t-273.15,Bl=t=>(t-273.15)*(9/5)+32,zl=t=>t*1e3,Fl=t=>t*3.6,Ol=t=>t*2.237,ql=t=>t/1e3,Ht=t=>t;function Ot(t){switch(t){case"tas":case"tasmin":case"tasmax":return[{label:"Kelvin (K)",unit:"K",convert:Ht},{label:"Celsius (°C)",unit:"°C",convert:Rl},{label:"Fahrenheit (°F)",unit:"°F",convert:Bl}];case"pr":return[{label:"g m⁻² s⁻¹",unit:"g m⁻² s⁻¹",convert:zl},{label:"kg m⁻² s⁻¹",unit:"kg m⁻² s⁻¹",convert:Ht}];case"rsds":case"rlds":return[{label:"W/m²",unit:"W/m²",convert:Ht},{label:"kW/m²",unit:"kW/m²",convert:ql}];case"sfcWind":return[{label:"m/s",unit:"m/s",convert:Ht},{label:"km/h",unit:"km/h",convert:Fl},{label:"mph",unit:"mph",convert:Ol}];case"hurs":return[{label:"Percent (%)",unit:"%",convert:Ht}];default:return[{label:"Default",unit:"",convert:Ht}]}}function pe(t){return Ot(t)[0]}function le(t,e,n,r){const o=Ot(e).find(s=>s.label===n);return o?r?.isDifference&&["tas","tasmin","tasmax"].includes(e)?n.includes("Celsius")?t:n.includes("Fahrenheit")?t*(9/5):t:o.convert(t):t}function na(t,e){return Ot(t).find(a=>a.label===e)?.unit||""}function ra(t,e,n,r,a){const s=Ot(n).find(l=>l.label===r);return s?a?.isDifference&&["tas","tasmin","tasmax"].includes(n)?r.startsWith("Celsius")?{min:t,max:e}:r.startsWith("Fahrenheit")?{min:t*1.8,max:e*1.8}:{min:t,max:e}:{min:s.convert(t),max:s.convert(e)}:{min:t,max:e}}let bt=null,me=[];function zn(t,e,n,r){const a=r.map(ea);for(let o=0;o<n;o++){const l=(1-o/(n-1))*(a.length-1),c=Math.floor(l),u=Math.min(c+1,a.length-1),d=l-c,f=a[c],p=a[u],g=Math.round(f.r+(p.r-f.r)*d),k=Math.round(f.g+(p.g-f.g)*d),P=Math.round(f.b+(p.b-f.b)*d);t.fillStyle=`rgb(${g}, ${k}, ${P})`,t.fillRect(0,o,e,1)}}function Vl(t,e,n,r,a,o){const s=r?.variable_metadata[t],l=s?.name||t;let c=e,u=n,d=s?.unit||"";if(a){const g=ra(e,n,t,a,{isDifference:o});c=g.min,u=g.max,d=na(t,a)}const f=(u-c)/4,p=[u,u-f,u-2*f,u-3*f,c];return`
      <div class="map-legend">
        <div class="legend-title">${l}</div>
        <div class="legend-container">
        <canvas id="legend-gradient-canvas" width="20" height="200" style="width: 20px; height: 200px; border-radius: 4px;"></canvas>
          <div class="legend-labels">
            ${p.map(g=>`<span>${g.toFixed(2)} ${d}</span>`).join("")}
          </div>
        </div>
      </div>
    `}function wn(t,e){const n=document.getElementById(t);if(!n){console.warn("Legend canvas not found");return}bt=n,me=e;const r=n.getContext("2d");if(!r)return;const a=n.width,o=n.height;zn(r,a,o,e)}function Xl(t,e,n){if(!bt||me.length===0)return;const r=bt.getContext("2d");if(!r)return;const a=bt.width,o=bt.height;zn(r,a,o,me);const s=(t-e)/(n-e),l=Math.round(o*(1-s));r.strokeStyle="rgba(255, 255, 255, 0.95)",r.lineWidth=2,r.shadowColor="rgba(0, 0, 0, 0.8)",r.shadowBlur=4,r.beginPath(),r.moveTo(0,l),r.lineTo(a,l),r.stroke(),r.shadowBlur=0}function Hl(){if(!bt||me.length===0)return;const t=bt.getContext("2d");if(!t)return;const e=bt.width,n=bt.height;zn(t,e,n,me)}const Fn="http://localhost:8000";class Dt extends Error{statusCode;details;constructor(e,n,r){super(e),this.name="DataClientError",this.statusCode=n,this.details=r}}function Wl(t){return{Historical:"historical",SSP245:"ssp245",SSP585:"ssp585"}[t]||t.toLowerCase()}function Ul(t){return t===1?"low":t===2?"medium":"high"}function Yl(t,e,n="float32"){const r=atob(t),a=new Uint8Array(r.length);for(let o=0;o<r.length;o++)a[o]=r.charCodeAt(o);if(n.includes("float32"))return new Float32Array(a.buffer);if(n.includes("float64"))return new Float64Array(a.buffer);throw new Error(`Unsupported dtype: ${n}`)}function Kl(t,e){const n=t.flat(),r=new Float32Array(n.length);for(let a=0;a<n.length;a++)r[a]=n[a];return r}async function We(t,e){const r=`${Fn}/data`;try{const a=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...t,scenario:t.scenario?Wl(t.scenario):void 0,data_format:t.data_format||"base64"})});if(!a.ok){const o=await a.json().catch(()=>({detail:a.statusText}));throw new Dt(o.detail||`HTTP ${a.status}: ${a.statusText}`,a.status,o)}return await a.json()}catch(a){throw a instanceof Dt?a:new Dt(`Failed to fetch data: ${a instanceof Error?a.message:String(a)}`,void 0,a)}}async function aa(t){const n=`${Fn}/metadata`;try{const r=await fetch(n,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Dt(`HTTP ${r.status}: ${r.statusText}`,r.status);return await r.json()}catch(r){throw r instanceof Dt?r:new Dt(`Failed to fetch metadata: ${r instanceof Error?r.message:String(r)}`)}}function ge(t){return t.data?t.data instanceof Float32Array||t.data instanceof Float64Array?t.data:t.data_encoding==="none"?null:t.data_encoding==="base64"&&typeof t.data=="string"?Yl(t.data,t.shape,t.dtype):t.data_encoding==="list"&&Array.isArray(t.data)?Kl(t.data,t.shape):null:null}function vt(t){return{variable:t.variable,time:t.date,model:t.model,scenario:t.scenario,resolution:Ul(t.resolution),data_format:t.dataFormat||"base64"}}async function Gl(t){const n=`${Fn}/health`;try{return(await fetch(n,{method:"GET",signal:AbortSignal.timeout(5e3)})).ok}catch{return!1}}let ie=null,xn=0,Sn=1,At="",Ct="",Ne=!1;function ia(){return ie||(ie=document.createElement("div"),ie.className="map-tooltip",document.body.appendChild(ie)),ie}function jl(t,e,n,r,a,o,s){const l=ia();let c=a,u=o;Ct&&At&&(c=le(a,At,Ct,{isDifference:s??Ne}),u=na(At,Ct)||o),l.textContent=`Lat: ${n.toFixed(2)}, Lon: ${r.toFixed(2)}, Value: ${c.toFixed(2)} ${u}`,l.style.display="block",l.style.left=`${t+10}px`,l.style.top=`${e+10}px`;let d=xn,f=Sn;if(Ct&&At){const p=le(xn,At,Ct,{isDifference:s??Ne}),g=le(Sn,At,Ct,{isDifference:s??Ne});d=p,f=g}Xl(c,d,f)}function ce(){const t=ia();t.style.display="none",Hl()}function Ql(t,e,n,r,a){xn=t,Sn=e,n!==void 0&&(At=n),r!==void 0&&(Ct=r),a!==void 0&&(Ne=a)}let X=Bn,hr=null,j=null,oa=null,sa=!1,Ue=null,la,ca,ue=!1,$n=null,pr=null;function Jl(t){const e=t.getContext("2d");if(!e)return null;const n=t.getBoundingClientRect();return t.width=n.width*window.devicePixelRatio,t.height=n.height*window.devicePixelRatio,e.scale(window.devicePixelRatio,window.devicePixelRatio),{ctx:e,rect:n,viewWidth:n.width,viewHeight:n.height}}function Zl(t,e,n,r){const a=t*n+n/2,o=a>180?a-360:a,s=90-(e*r+r/2);return[o,s]}function tc(t,e,n,r,a){if(t<0||t>=n||e<0||e>=r)return null;const s=(r-1-e)*n+t,l=a[s];return isFinite(l)?l:null}function sn(t){ue?t.style.cursor="crosshair":t.style.cursor="auto"}function mr(t,e,n){if(!j)return null;const r=t.getBoundingClientRect(),a=e-r.left,o=n-r.top;let s=(a-X.x)/X.k;const l=(o-X.y)/X.k,c=j.width,u=j.height;if(l<0||l>u)return null;let d=s;d=d%c,d<0&&(d+=c),d<0&&(d=0),d>=c&&(d=c*(1-Number.EPSILON));const f=d/c*360-180,p=90-l/u*180,g=Math.max(-180,Math.min(180,f)),k=Math.max(-90,Math.min(90,p));return!Number.isFinite(g)||!Number.isFinite(k)?null:{lat:k,lon:g}}function ec(t,e){ue=t,$n=t?e??null:null}function nc(t,e,n){if(!j)return null;const r=j.width,a=j.height;let o=e;for(;o>180;)o-=360;for(;o<-180;)o+=360;const s=(o+180)/360*r,l=(90-n)/180*a,c=s*X.k+X.x,u=l*X.k+X.y,d=t.getBoundingClientRect(),f=r*X.k,p=d.width/2;let g=c,k=Math.abs(c-p);for(let P=-f;P<=f;P+=f){const E=c+P,S=Math.abs(E-p);S<k&&(k=S,g=E)}return u<-a*X.k||u>d.height+a*X.k?null:{x:g,y:u}}function rc(t,e,n,r,a,o){ec(o?.drawMode??!1,{onClick:o?.onDrawClick,onMove:o?.onDrawMove}),pr=o?.onTransform??null,sn(t);const s=Mt(t);hr=Cl().scaleExtent([.8,10]).filter(l=>ue?!1:!l.ctrlKey&&!l.button).on("zoom",l=>{X=l.transform,e&&ac(t),pr?.()}).on("start",()=>{t.style.cursor="grabbing",ce()}).on("end",()=>{sn(t)}),s.call(hr),s.on("click.draw",l=>{if(ue){const c=mr(t,l.clientX,l.clientY);c&&$n?.onClick?.(c)}}),s.on("pointermove.tooltip",l=>{if(ue){const c=mr(t,l.clientX,l.clientY);c&&$n?.onMove?.(c),ce();return}if(l.buttons===0&&oa&&Ue&&j){const[c,u]=$t(l,t);ic(l.clientX,l.clientY,c,u,n,la,ca,sa)}}),s.on("pointerleave",()=>{ce()}),sn(t)}function ac(t){if(!j)return;const e=t.getContext("2d");if(!e)return;const n=t.getBoundingClientRect();e.clearRect(0,0,n.width,n.height),e.save(),e.translate(X.x,X.y),e.scale(X.k,X.k),e.imageSmoothingEnabled=!1;const r=j.width,a=-X.x/X.k,o=(n.width-X.x)/X.k,s=Math.floor(a/r)-1,l=Math.ceil(o/r)+1;for(let c=s;c<=l;c++)e.drawImage(j,c*r,0);e.restore()}function Mn(t,e,n,r,a,o,s,l){if(!e)return;const c=ge(t);if(!c){console.warn("No data to render");return}console.log("Rendering map data (full render)");const u=Jl(e);if(!u)return;const{ctx:d,rect:f,viewWidth:p,viewHeight:g}=u,[k,P]=t.shape;d.clearRect(0,0,f.width,f.height),d.save();const E=!!t?.metadata?.comparison||typeof t.model=="string"&&t.model.includes(" minus ");oa=t,la=s,ca=l,sa=E;const S=new Array(g).fill(null).map(()=>new Float32Array(p).fill(NaN));let w=a,N=o;if(s&&l){const O=ra(a,o,s,l,{isDifference:E});w=O.min,N=O.max}Ql(a,o,s,l,E);const R=(n.find(O=>O.name===r)||n[0]).colors.map(ea);function y(O,V){const K=(O+180)/360*p,W=(90-V)/150*g;return[K,W]}const b=document.createElement("canvas");b.width=p,b.height=g;const D=b.getContext("2d");if(!D)return;const A=D.createImageData(p,g),M=A.data;console.log("Rendering map data");const $=Math.max(p/P,g/k)*.8,F=Math.ceil($/2),h=360/P,_=150/k;for(let O=0;O<k;O++)for(let V=0;V<P;V++){const K=tc(V,O,P,k,c);if(K===null)continue;const[W,et]=Zl(V,O,h,_),[at,J]=y(W,et);let it=K;s&&l&&(it=le(K,s,l,{isDifference:E}));const Vt=N-w,Xn=Vt===0?.5:Math.min(1,Math.max(0,(it-w)/Vt)),Ze=Math.floor(Xn*(R.length-1)),Xt=R[Math.min(Ze,R.length-1)],tn=R[Math.min(Ze+1,R.length-1)],en=Xn*(R.length-1)-Ze,pa=Math.round(Xt.r+(tn.r-Xt.r)*en),ma=Math.round(Xt.g+(tn.g-Xt.g)*en),ga=Math.round(Xt.b+(tn.b-Xt.b)*en),va=Math.max(0,Math.floor(at-F)),ya=Math.min(p,Math.ceil(at+F)),ba=Math.max(0,Math.floor(J-F)),wa=Math.min(g,Math.ceil(J+F));for(let be=ba;be<wa;be++)for(let we=va;we<ya;we++){const xe=(be*p+we)*4;M[xe]=pa,M[xe+1]=ma,M[xe+2]=ga,M[xe+3]=255,S[be][we]=K}}D.putImageData(A,0,0),j=b,Ue=S,d.clearRect(0,0,f.width,f.height),d.save(),d.translate(X.x,X.y),d.scale(X.k,X.k),d.imageSmoothingEnabled=!1;const x=j.width,B=-X.x/X.k,C=(f.width-X.x)/X.k,T=Math.floor(B/x)-1,z=Math.ceil(C/x)+1;for(let O=T;O<=z;O++)d.drawImage(j,O*x,0);d.restore()}function ic(t,e,n,r,a,o,s,l){if(!Ue||!j)return;let c=(n-X.x)/X.k;const u=(r-X.y)/X.k,d=j.width,f=j.height;c=(c%d+d)%d;const p=Math.floor(c),g=Math.floor(u);if(p>=0&&p<d&&g>=0&&g<f){const k=Ue?.[g]?.[p]??0;if(isFinite(k)){const P=c/d*360-180,E=90-u/f*150;jl(t,e,E,P,k,a,l)}else ce()}else ce()}function _t(t){const e=new Date(t);return`${["January","February","March","April","May","June","July","August","September","October","November","December"][e.getMonth()]} ${e.getDate()}, ${e.getFullYear()}`}function oc(t){const{date:e,timeRange:n,sidebarOpen:r,sidebarWidth:a,mode:o,compareMode:s,compareDateStart:l,compareDateEnd:c}=t;let u=0,d=0,f=0,p=0,g=0,k=0,P=0,E=100;if(n){const w=new Date(n.start),N=new Date(n.end),I=new Date(e);if(d=Math.floor((N.getTime()-w.getTime())/(1e3*60*60*24)),f=Math.floor((I.getTime()-w.getTime())/(1e3*60*60*24)),p=d>0?f/d*100:0,o==="Compare"&&s==="Dates"){const L=l?new Date(l):w,R=c?new Date(c):N;g=Math.max(0,Math.floor((L.getTime()-w.getTime())/(1e3*60*60*24))),k=Math.min(d,Math.floor((R.getTime()-w.getTime())/(1e3*60*60*24))),P=d>0?g/d*100:0,E=d>0?k/d*100:100}}const S=r?a+16:16;if(o==="Compare"&&s==="Dates"&&n){const w=_t(l||n.start),N=_t(c||n.end);return`
      <div class="time-slider-container" style="right: ${S}px">
        <div data-role="time-label" class="time-label">${w} – ${N}</div>
        <div class="time-slider-row dual-slider" data-role="dual-slider">
          <div
            class="dual-slider-track"
            aria-hidden="true"
          ></div>
          <div
            class="dual-slider-fill"
            data-role="dual-fill"
            style="--fill-start: ${P}%; --fill-end: ${E}%"
            aria-hidden="true"
          ></div>
          <input
            type="range"
            min="${u}"
            max="${d}"
            step="1"
            value="${g}"
            data-action="set-time-start"
            class="time-slider dual-thumb dual-thumb-start"
            aria-label="Start date"
          />
          <input
            type="range"
            min="${u}"
            max="${d}"
            step="1"
            value="${k}"
            data-action="set-time-end"
            class="time-slider dual-thumb dual-thumb-end"
            aria-label="End date"
          />
        </div>
      </div>
    `}return`
      <div class="time-slider-container" style="right: ${S}px">
        <div data-role="time-label" class="time-label">${_t(e)}</div>
        <div class="time-slider-row">
          <input
            type="range"
            min="${u}"
            max="${d}"
            step="1"
            value="${f}"
            data-action="set-time"
            class="time-slider"
            style="--slider-fill: ${p}%"
          />
        </div>
      </div>
    `}let Wt=null,_n=null;function sc(t){const{root:e,getTimeRange:n,onDateChange:r,getMode:a,getCompareMode:o,getCompareDates:s,onDateRangeChange:l}=t;_n=e.querySelector('[data-role="time-label"]')?.parentElement??null;const c=()=>a?.()==="Compare"&&o?.()==="Dates";e.querySelectorAll('[data-action="set-time"]').forEach(E=>E.addEventListener("input",()=>{if(c())return;const S=Number.parseInt(E.value,10),w=n();if(!Number.isNaN(S)&&w){const N=new Date(w.start);N.setDate(N.getDate()+S);const I=N.toISOString().split("T")[0],L=e.querySelector('[data-role="time-label"]');L&&(L.textContent=_t(I));const R=new Date(w.end),y=Math.floor((R.getTime()-new Date(w.start).getTime())/(1e3*60*60*24)),b=y>0?S/y*100:0;E.style.setProperty("--slider-fill",`${b}%`),Wt&&window.clearTimeout(Wt),Wt=window.setTimeout(()=>{r(I)},500)}}));const d=e.querySelectorAll('[data-action="set-time-start"]'),f=e.querySelectorAll('[data-action="set-time-end"]'),p=e.querySelector('[data-role="dual-fill"]'),g=(E,S,w,N,I)=>{const L=e.querySelector('[data-role="time-label"]'),R=new Date(w.start),y=new Date(w.start);R.setDate(R.getDate()+E),y.setDate(y.getDate()+S);const b=R.toISOString().split("T")[0],D=y.toISOString().split("T")[0];L&&(L.textContent=`${_t(b)} – ${_t(D)}`);const A=new Date(w.end).getTime()-new Date(w.start).getTime(),M=Math.max(1,Math.floor(A/(1e3*60*60*24))),$=E/M*100,F=S/M*100;[p,N,I].forEach(_=>{_&&(_.style.setProperty("--fill-start",`${$}%`),_.style.setProperty("--fill-end",`${F}%`))})},k=(E,S,w)=>{E.addEventListener("input",()=>{if(!c())return;const N=n();if(!N)return;const I=Math.floor((new Date(N.end).getTime()-new Date(N.start).getTime())/(1e3*60*60*24));let L=Number.parseInt(w?E.value:S.value,10),R=Number.parseInt(w?S.value:E.value,10);if(Number.isNaN(L)||Number.isNaN(R))return;L=Math.max(0,Math.min(L,I)),R=Math.max(0,Math.min(R,I)),w&&L>R?(R=L,S.value=String(R)):!w&&R<L&&(L=R,S.value=String(L)),g(L,R,N,w?E:S,w?S:E);const y=new Date(N.start);y.setDate(y.getDate()+L);const b=new Date(N.start);b.setDate(b.getDate()+R);const D=y.toISOString().split("T")[0],A=b.toISOString().split("T")[0];Wt&&window.clearTimeout(Wt),Wt=window.setTimeout(()=>{l?.(D,A)},300)})},P=E=>{const S=d[0],w=f[0];!S||!w||(E==="start"?(S.style.zIndex="4",w.style.zIndex="3"):(S.style.zIndex="3",w.style.zIndex="4"))};if(d.length&&f.length){d.forEach((w,N)=>{const I=f[N]||f[0];k(w,I,!0),w.addEventListener("pointerdown",()=>P("start"))}),f.forEach((w,N)=>{const I=d[N]||d[0];k(w,I,!1),w.addEventListener("pointerdown",()=>P("end"))}),d.forEach(w=>w.addEventListener("focus",()=>P("start"))),f.forEach(w=>w.addEventListener("focus",()=>P("end")));const E=(w,N)=>{w.addEventListener("pointerdown",I=>{if(!c())return;const L=n();if(!L)return;const R=w.getBoundingClientRect(),y=Math.min(1,Math.max(0,(I.clientX-R.left)/R.width)),b=Math.max(1,Math.floor((new Date(L.end).getTime()-new Date(L.start).getTime())/(1e3*60*60*24))),D=Number.parseInt(w.value,10),M=(Number.isNaN(D)?0:Math.max(0,Math.min(D,b)))/b;Math.abs(y-M)*R.width>14&&(I.preventDefault(),I.stopPropagation(),P(w===N?"end":"start"))})};if(E(d[0],f[0]),E(f[0],d[0]),c()){const w=n(),N=s?.();if(w&&N){const I=Math.max(0,Math.floor((new Date(N.start).getTime()-new Date(w.start).getTime())/864e5)),L=Math.max(0,Math.floor((new Date(N.end).getTime()-new Date(w.start).getTime())/(1e3*60*60*24))),R=d[0],y=f[0];R.value=String(I),y.value=String(Math.max(L,I)),g(I,Math.max(L,I),w,R,y)}}e.querySelectorAll(".dual-slider").forEach(w=>{w.addEventListener("pointermove",N=>{if(!c())return;const I=n();if(!I)return;const L=d[0],R=f[0];if(!L||!R)return;const y=w.getBoundingClientRect(),b=Math.min(1,Math.max(0,(N.clientX-y.left)/y.width)),D=Math.max(1,Math.floor((new Date(I.end).getTime()-new Date(I.start).getTime())/(1e3*60*60*24)));let A=Number.parseInt(L.value,10),M=Number.parseInt(R.value,10);Number.isNaN(A)&&(A=0),Number.isNaN(M)&&(M=D);const $=A/D,F=M/D,h=Math.abs(b-$)<=Math.abs(b-F);P(h?"start":"end")})})}}function lc(t,e){if(_n){const n=t?e+16:16;_n.style.right=`${n}px`}}function On(t){const e=t.toLowerCase();return e==="historical"?"Historical":e==="ssp245"?"SSP245":e==="ssp370"?"SSP370":e==="ssp585"?"SSP585":t}function Nt(t){return new Date(t)}function qn(t){if(!t.length)return qt("Historical");let e="1900-01-01",n="2100-12-31";return t.forEach((r,a)=>{const o=qt(r);if(a===0){e=o.start,n=o.end;return}e=Nt(o.start)>Nt(e)?o.start:e,n=Nt(o.end)<Nt(n)?o.end:n}),{start:e,end:n}}function kn(t,e){const n=Nt(t),r=Nt(e.start),a=Nt(e.end);return n<r?e.start:n>a?e.end:t}const wt=["Historical","SSP245","SSP370","SSP585"],nt=["ACCESS-CM2","CanESM5","CESM2","CMCC-CM2-SR5","EC-Earth3","GFDL-ESM4","INM-CM5-0","IPSL-CM6A-LR","MIROC6","MPI-ESM1-2-HR","MRI-ESM2-0"],Pt=["tas","pr","rsds","hurs","rlds","sfcWind","tasmin","tasmax"],cc={SSP245:"A moderate scenario (2015-2100) that assumes we take active measures against climate change. This represents a realistic path where significant climate protection policies are implemented, leading to moderate warming by the end of the century.",SSP370:"A moderate-to-high scenario (2015-2100) representing a middle ground. This path assumes some climate action is taken, but not enough to prevent substantial warming. It falls between optimistic and pessimistic outcomes.",SSP585:"A pessimistic scenario (2015-2100) representing a worst-case path with minimal climate action. This shows what happens if we continue with current trends and take little to no measures against climate change, leading to severe warming.",Historical:"Historical climate simulation (1950-2014) based on past conditions. This represents simulated climate data for the historical period, used as a baseline to compare against future projections."},uc={tas:"Near-Surface Air Temperature",pr:"Precipitation",rsds:"Surface Downwelling Shortwave Radiation",hurs:"Near-Surface Relative Humidity",rlds:"Surface Downwelling Longwave Radiation",sfcWind:"Daily-Mean Near-Surface Wind Speed",tasmin:"Daily Minimum Near-Surface Air Temperature",tasmax:"Daily Maximum Near-Surface Air Temperature"},dc={tas:"The air temperature near the Earth's surface, measured in Kelvin.",pr:"The amount of water that falls from the atmosphere to the surface, measured as mass per unit area per unit time.",rsds:"Incoming solar radiation reaching the Earth's surface, measured in Watts per square meter.",hurs:"The amount of moisture in the air relative to the maximum it can hold, expressed as a percentage.",rlds:"Incoming thermal radiation from the atmosphere, measured in Watts per square meter.",sfcWind:"The average wind speed near the surface over a day, measured in meters per second.",tasmin:"The lowest air temperature near the surface during a day, measured in Kelvin.",tasmax:"The highest air temperature near the surface during a day, measured in Kelvin."},fc={"ACCESS-CM2":"Developed by Australia's research institutions. This model is part of the global CMIP6 ensemble, providing climate projections that contribute to our understanding of future climate patterns.",CanESM5:"The Canadian Earth System Model version 5, developed by Environment and Climate Change Canada. This model represents North American climate research and contributes valuable projections to the global climate science community.",CESM2:"The Community Earth System Model version 2, developed by the National Center for Atmospheric Research (NCAR) in the United States. One of the most widely used models in climate research, known for its comprehensive representation of Earth's climate system.","CMCC-CM2-SR5":"Developed by the Euro-Mediterranean Center on Climate Change (CMCC) in Italy. This model provides European perspectives on climate change and is particularly valuable for understanding Mediterranean and European climate patterns.","EC-Earth3":"A collaborative European climate model developed by multiple research institutions across Europe. This model combines expertise from various European countries to provide comprehensive climate projections.","GFDL-ESM4":"Developed by NOAA's Geophysical Fluid Dynamics Laboratory in the United States. This model is known for its advanced representation of ocean and atmosphere interactions, providing detailed climate projections.","INM-CM5-0":"Developed by the Institute of Numerical Mathematics in Russia. This model contributes a unique perspective from Russian climate research to the global ensemble of climate models.","IPSL-CM6A-LR":"Developed by the Institut Pierre-Simon Laplace in France. This model is part of a long-standing French climate modeling tradition and provides important contributions to understanding global climate dynamics.",MIROC6:"Developed by a Japanese research consortium. This model represents Asian climate research expertise and contributes valuable insights, particularly for understanding climate patterns in the Asia-Pacific region.","MPI-ESM1-2-HR":"Developed by the Max Planck Institute in Germany. This high-resolution model provides detailed climate projections and is known for its sophisticated representation of Earth's climate system.","MRI-ESM2-0":"Developed by Japan's Meteorological Research Institute. This model contributes Japanese climate research expertise to the global ensemble, providing valuable perspectives on climate change projections."},Q=[{name:"Viridis",colors:["#440154","#3b528b","#21908d","#5dc863","#fde725"]},{name:"Magma",colors:["#000004","#3b0f70","#8c2981","#de4968","#fe9f6d"]},{name:"Cividis",colors:["#00204c","#31456a","#6b6d7f","#a59c8f","#fdea9b"]},{name:"Thermal",colors:["#04142f","#155570","#1fa187","#f8c932","#f16623"]}],v={page:{position:"relative",minHeight:"100vh",color:"white",overflow:"hidden",fontFamily:"Inter, system-ui, sans-serif"},bgLayer1:{position:"absolute",inset:0,background:"linear-gradient(135deg, #05070f, #0b1326)"},bgLayer2:{position:"absolute",inset:0,background:"radial-gradient(circle at 20% 20%, rgba(56,189,248,0.12), transparent 32%), radial-gradient(circle at 80% 10%, rgba(139,92,246,0.15), transparent 30%), radial-gradient(circle at 50% 70%, rgba(34,197,94,0.08), transparent 28%)"},bgOverlay:{position:"absolute",inset:0,background:"#050505",opacity:.35},branding:{position:"fixed",top:16,left:16,display:"flex",alignItems:"center",gap:12,padding:"8px 0",background:"transparent",border:"none",borderRadius:0,zIndex:"9999",boxShadow:"none",backdropFilter:"none",pointerEvents:"auto"},brandIcon:{width:38,height:38,position:"relative",display:"grid",placeItems:"center",filter:"drop-shadow(0 8px 18px rgba(0, 0, 0, 0.42))",transition:"transform 160ms ease, filter 160ms ease","--iris-x":"0px","--iris-y":"0px","--pupil-x":"0px","--pupil-y":"0px","--blink-open":"1"},brandSvg:{width:"100%",height:"100%",display:"block"},brandOutline:{stroke:"white",strokeWidth:5,strokeLinecap:"round",strokeLinejoin:"round",fill:"none",opacity:.92},brandLids:{transform:"translate(60px, 40px) scaleY(var(--blink-open, 1)) translate(-60px, -40px)",transformOrigin:"60px 40px",transition:"none"},brandClipRect:{transform:"translate(60px, 40px) scaleY(var(--blink-open, 1)) translate(-60px, -40px)",transformOrigin:"60px 40px",transition:"none"},brandIrisGroup:{transform:"translate(var(--iris-x, 0px), var(--iris-y, 0px))",transition:"none",transformBox:"fill-box",transformOrigin:"center center"},brandIris:{stroke:"white",strokeWidth:5,fill:"rgba(255, 255, 255, 0.08)"},brandPupilGroup:{transform:"translate(var(--pupil-x, 0px), var(--pupil-y, 0px))",transition:"none",transformOrigin:"center center"},brandEyeContent:{clipPath:"url(#brand-eye-clip)"},brandPupil:{fill:"white"},brandHighlight:{fill:"white",opacity:.92},brandName:{fontSize:18,fontWeight:700,letterSpacing:.6,color:"white",textTransform:"none",textShadow:"0 8px 20px rgba(0, 0, 0, 0.45)"},field:{minWidth:0,display:"flex",flexDirection:"column",gap:4},fieldLabel:{fontSize:11,letterSpacing:.5,color:"var(--text-secondary)",textTransform:"uppercase"},mapArea:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:10,textAlign:"center",pointerEvents:"none",zIndex:1},drawOverlay:{position:"absolute",inset:0,background:"rgba(5, 10, 20, 0.28)",backdropFilter:"blur(1px)",pointerEvents:"none",zIndex:8},drawOverlayCanvas:{position:"absolute",inset:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:9},drawPrompt:{position:"absolute",top:16,left:"50%",transform:"translateX(-50%)",padding:"10px 14px",borderRadius:12,background:"rgba(15, 23, 42, 0.92)",border:"1px solid var(--border-medium)",boxShadow:"var(--shadow-elevated)",fontWeight:800,fontSize:13,color:"var(--text-primary)",pointerEvents:"none",zIndex:10,textAlign:"center"},drawPromptSub:{marginTop:4,fontSize:12,fontWeight:600,color:"var(--text-secondary)"},loadingIndicator:{position:"absolute",left:18,bottom:80,display:"flex",alignItems:"center",gap:12,padding:0,pointerEvents:"auto",zIndex:20,minWidth:160},loadingSpinner:{width:18,height:18,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.18)",borderTop:"2px solid #34d399",animation:"sv-spin 1s linear infinite",flexShrink:0},loadingTextGroup:{display:"flex",flexDirection:"column",gap:4,alignItems:"flex-start",minWidth:0},loadingText:{fontSize:12.5,fontWeight:700,color:"var(--text-primary)",letterSpacing:.3},loadingSubtext:{fontSize:11.5,color:"var(--text-secondary)",letterSpacing:.2},loadingBar:{position:"relative",width:120,height:6,borderRadius:999,background:"rgba(255, 255, 255, 0.08)",overflow:"hidden"},loadingBarFill:{position:"absolute",inset:0,borderRadius:999,background:"linear-gradient(90deg, rgba(52, 211, 153, 0.9), rgba(125, 211, 252, 0.9))",transition:"width 140ms ease",width:"0%"},compareInfoWrap:{position:"fixed",right:24,bottom:88,display:"flex",alignItems:"center",pointerEvents:"auto",zIndex:1e4},compareInfoButton:{padding:0,background:"transparent",border:"none",color:"var(--text-primary)",fontWeight:700,fontSize:13,letterSpacing:.2,cursor:"pointer",textDecoration:"underline"},infoModalOverlay:{position:"fixed",inset:0,background:"transparent",backdropFilter:"none",zIndex:200,display:"flex",alignItems:"center",justifyContent:"center",padding:16},infoModal:{width:"min(480px, 92vw)",background:"rgba(12, 16, 24, 0.98)",border:"1px solid var(--border-default)",borderRadius:14,boxShadow:"var(--shadow-elevated)",color:"var(--text-primary)",padding:20,position:"relative",maxWidth:"520px"},infoModalHeader:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,marginBottom:12},infoModalTitle:{fontSize:16,fontWeight:900,letterSpacing:.2,background:"var(--gradient-accent)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",color:"transparent"},infoModalClose:{width:32,height:32,borderRadius:8,border:"none",background:"transparent",color:"var(--text-secondary)",cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",fontWeight:700},infoModalBody:{fontSize:14,lineHeight:1.6,color:"var(--text-primary)",display:"block",textAlign:"left",whiteSpace:"normal",wordBreak:"break-word"},infoModalFooter:{marginTop:18,display:"flex",justifyContent:"center"},infoModalConfirm:{padding:"10px 16px",borderRadius:10,border:"1px solid var(--accent-border)",background:"var(--gradient-primary)",color:"white",fontWeight:700,cursor:"pointer",boxShadow:"var(--shadow-combined)"},canvasToggle:{position:"fixed",top:14,display:"flex",alignItems:"center",gap:8,pointerEvents:"auto",zIndex:100,transition:"right 0.25s ease"},canvasSwitch:{position:"relative",display:"grid",gridTemplateColumns:"1fr 1fr",gap:0,padding:3,borderRadius:11,background:"var(--dark-bg)",border:"var(--border-base)",boxShadow:"var(--shadow-elevated)",zIndex:101},canvasIndicator:{position:"absolute",top:3,bottom:3,left:3,width:"calc(50% - 3px)",borderRadius:9,background:"var(--gradient-indicator)",boxShadow:"var(--shadow-canvas), var(--shadow-inset)",transition:"transform 180ms ease",zIndex:0,pointerEvents:"none"},canvasBtn:{width:40,height:40,borderRadius:9,border:"1px solid transparent",background:"var(--bg-transparent)",color:"var(--text-secondary)",cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",transition:"color 120ms ease",position:"relative",zIndex:1},canvasBtnActive:{color:"white"},mapTitle:{fontSize:18,fontWeight:600},mapSubtitle:{fontSize:14,color:"var(--text-secondary)"},modeSwitch:{position:"relative",display:"grid",gridTemplateColumns:"1fr 1fr",gap:4,padding:2,borderRadius:10,border:"1px solid var(--border-subtle)",background:"var(--bg-subtle)",boxShadow:"none"},modeIndicator:{position:"absolute",top:2,bottom:2,left:2,width:"calc(50% - 2px)",borderRadius:8,background:"var(--gradient-mode-indicator)",boxShadow:"var(--shadow-combined)",transition:"transform 200ms ease",zIndex:0},modeBtn:{flex:1,padding:"8px 0",borderRadius:8,border:"none",color:"var(--text-secondary)",cursor:"pointer",transition:"all 0.15s ease",background:"var(--bg-transparent)",textAlign:"center",fontSize:12.5,fontWeight:700,letterSpacing:.2,outline:"none",boxShadow:"none",position:"relative",zIndex:1},modeBtnActive:{background:"var(--gradient-primary)",border:"none",color:"white",boxShadow:"var(--shadow-combined)"},tabSwitch:{position:"absolute",left:32,right:12,bottom:-8,display:"flex",gap:10,padding:"0 8px",alignItems:"flex-end",pointerEvents:"auto",zIndex:0},tabBtn:{borderRadius:"14px 14px 0 0",padding:"12px 18px",background:"var(--bg-strong)",color:"var(--text-secondary)",fontWeight:700,fontSize:13,letterSpacing:.35,cursor:"pointer",transition:"all 0.18s ease",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.06), 0 8px 18px rgba(0,0,0,0.32)",borderTop:"var(--border-base)",borderRight:"var(--border-base)",borderLeft:"var(--border-base)",borderBottom:"none",transform:"translateY(4px)"},tabBtnActive:{background:"var(--gradient-tab-active)",color:"white",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.12), 0 12px 26px rgba(0,0,0,0.42)",borderTop:"var(--border-active)",borderRight:"var(--border-active)",borderLeft:"var(--border-active)",borderBottom:"none",transform:"translateY(-4px)",zIndex:1},modeViewport:{overflow:"hidden",width:"100%",position:"relative",flex:1,minHeight:0,height:0},modeTrack:{display:"grid",gridTemplateColumns:"1fr 1fr",width:"200%",height:"100%",transition:"transform 220ms ease"},modePane:{width:"100%",height:"100%",paddingRight:4,overflowY:"auto",overflowX:"hidden",scrollbarGutter:"stable",minHeight:0,maxHeight:"100%"},chatBox:{display:"flex",alignItems:"center",gap:10,padding:"12px 14px",borderRadius:14,border:"1px solid var(--border-default)",background:"rgba(15,18,25,0.96)",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.05), 0 8px 20px rgba(0,0,0,0.38)"},chatInput:{flex:1,padding:"12px 0",borderRadius:8,border:"none",background:"var(--bg-transparent)",color:"white",fontSize:14,lineHeight:1.4,outline:"none",minHeight:24},chatSend:{padding:"10px 14px",borderRadius:12,border:"1px solid var(--accent-border-strong)",background:"var(--gradient-primary)",color:"white",fontWeight:700,fontSize:14,letterSpacing:.1,cursor:"pointer",boxShadow:"0 10px 22px rgba(0,0,0,0.38), var(--shadow-inset)",transition:"transform 120ms ease, box-shadow 120ms ease"},chatStack:{display:"flex",flexDirection:"column",gap:12},chatLead:{fontSize:13,color:"var(--text-secondary)",lineHeight:1.45,marginTop:10},chatMessages:{display:"flex",flexDirection:"column",gap:10,padding:"4px 0 6px",paddingRight:0,width:"100%",boxSizing:"border-box"},chatBubble:{maxWidth:"100%",width:"fit-content",padding:"16px 16px",borderRadius:12,fontSize:13,lineHeight:1.4,boxShadow:"0 6px 14px rgba(0,0,0,0.3)",boxSizing:"border-box"},chatBubbleUser:{alignSelf:"flex-end",background:"var(--gradient-chat-user)",border:"1px solid rgba(125,211,252,0.45)",color:"white",marginRight:26},chatBubbleAgent:{alignSelf:"flex-start",background:"rgba(20,24,31,0.95)",border:"1px solid var(--border-medium)",color:"var(--text-primary)"},sectionTitle:{fontSize:13,fontWeight:700,color:"var(--text-primary)",letterSpacing:.3,textTransform:"uppercase"},paramGrid:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},range:{width:"100%",background:"var(--bg-transparent)",appearance:"none",WebkitAppearance:"none",height:10,outline:"none",padding:0,margin:0},resolutionRow:{display:"flex",alignItems:"center",gap:12},resolutionValue:{fontSize:12.5,color:"var(--text-secondary)",minWidth:60,textAlign:"right"},chartPanel:{width:"min(1200px, 100%)",background:"transparent",border:"none",borderRadius:0,padding:0,boxShadow:"none",backdropFilter:"none"},chartHeader:{textAlign:"center",marginBottom:12},chartTitle:{fontSize:18,fontWeight:800,color:"var(--text-primary)"},chartPlotWrapper:{width:"100%",minHeight:360,background:"transparent",border:"none",borderRadius:0,padding:0,position:"relative"},chartEmpty:{textAlign:"center",color:"var(--text-secondary)",padding:"40px 16px",lineHeight:1.6},chartError:{color:"#fca5a5",background:"rgba(248,113,113,0.08)",border:"1px solid rgba(248,113,113,0.35)",borderRadius:12,padding:14,fontSize:13,lineHeight:1.5},chipRow:{display:"flex",flexWrap:"wrap",gap:8},chip:{padding:"8px 10px",borderRadius:12,border:"1px solid var(--border-medium)",background:"rgba(255,255,255,0.04)",color:"var(--text-primary)",cursor:"pointer",fontSize:12.5,fontWeight:700,letterSpacing:.2,transition:"all 140ms ease"},chipActive:{borderColor:"rgba(167,139,250,0.65)",background:"rgba(167,139,250,0.16)",boxShadow:"0 0 0 1px rgba(167,139,250,0.35)"}},i={mode:"Explore",panelTab:"Manual",sidebarOpen:!0,canvasView:"map",scenario:wt[0],model:nt[0],variable:Pt[0],date:"2000-01-01",palette:Q[0].name,resolution:2,selectedUnit:pe(Pt[0]).label,chartMode:"single",chartDate:"2026-01-16",chartVariable:Pt[0],chartUnit:pe(Pt[0]).label,chartScenarios:["SSP245","SSP370","SSP585"],chartModels:[...nt],chartDropdown:{scenariosOpen:!1,modelsOpen:!1},chartLoadingProgress:{total:0,done:0},chartSamples:[],chartBoxes:null,chartLoading:!1,chartError:null,chartLocation:"World",chartLocationName:null,chartLocationSearchQuery:"",chartLocationSearchResults:[],chartLocationSearchLoading:!1,chartLocationSearchError:null,chartPolygon:null,chartPoint:null,drawState:{active:!1,points:[],previewPoint:null},pointSelectActive:!1,chatInput:"",chatMessages:[],compareMode:"Scenarios",availableModels:[],compareScenarioA:"SSP245",compareScenarioB:"SSP585",compareModelA:nt[0],compareModelB:nt[1]??nt[0],compareDateStart:"1962-06-28",compareDateEnd:"2007-06-28",isLoading:!1,loadingProgress:0,dataError:null,currentData:null,apiAvailable:null,dataMin:null,dataMax:null,timeRange:null,metaData:void 0,compareInfoOpen:!1};let ln=null,dt=null,Jt=null,Y=null,De=null,Et=null,St=null,Lt=null,mt=null,Rt=null,Ee=0;const hc=500;function pc(t){return t.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}function m(t){return Object.entries(t).filter(([,e])=>e!=null).map(([e,n])=>{const r=e.startsWith("--")?e:pc(e),a=typeof n=="number"?`${n}px`:String(n);return`${r}:${a}`}).join(";")}function G(...t){return t.reduce((e,n)=>n?{...e,...n}:e,{})}function Kt(t){return t.replace(/[&<>"']/g,e=>{switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return e}})}function Gt(t){const e=new Date(t);return Number.isNaN(e.getTime())?t:e.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}function ua(t,e){return e?.variable_metadata?.[t]?.name||e?.variable_metadata?.[t]?.description||t}function mc(t){const e=ua(t.variable,t.metaData),n=t.selectedUnit||t.metaData?.variable_metadata?.[t.variable]?.unit||"",r=n?`${n}`:"the dataset's native units";switch(t.compareMode){case"Dates":{const a=Gt(t.compareDateStart),o=Gt(t.compareDateEnd);return{title:"Comparing two dates",paragraphs:[`We are comparing ${e} on ${a} versus ${o} under the ${t.scenario} scenario using the ${t.model} model.`,`Values on the map represent ${o} minus ${a} in ${r}. A value of X means ${e} was X ${n||""} higher on ${o} than on ${a} (negative values mean it was lower).`]}}case"Models":{const a=Gt(t.date);return{title:"Comparing two models",paragraphs:[`We are comparing ${e} between ${t.compareModelB} and ${t.compareModelA} on ${a} within the ${t.scenario} scenario.`,`Each value shows ${t.compareModelB} minus ${t.compareModelA} in ${r}. Positive numbers mean ${e} is higher in ${t.compareModelB}; negative means it is higher in ${t.compareModelA}.`]}}default:{const a=Gt(t.date),o=t.compareScenarioA,s=t.compareScenarioB;return{title:"Comparing two scenarios",paragraphs:[`We are comparing ${e} for ${s} versus ${o} on ${a} using the ${t.model} model.`,`Values show ${s} minus ${o} in ${r}. A value of X means ${e} is X ${n||""} higher under ${s} than under ${o}; negative values mean it is lower.`]}}}}function gc(t){if(t.mode!=="Compare"||t.canvasView!=="map")return"";const e=mc(t),n=e.paragraphs.map((c,u)=>{const f=u===e.paragraphs.length-1?"0":"0 0 12px 0",p=c.replace(/(\bX\b|ΔX)/g,'<span style="color: var(--accent-purple);">$1</span>');return`<p style="display:block; margin:${f}; line-height:1.6; white-space: normal; word-break: break-word;">${p}</p>`}).join(""),r=t.sidebarOpen?ot+24:24,a=t.mode==="Compare"&&t.compareMode==="Dates"?120:88,o=G(v.infoModalOverlay,{left:"0",right:"0",width:"100%",justifyContent:"center",paddingLeft:0}),s=G(v.infoModal,{alignSelf:"center",marginLeft:"auto",marginRight:"auto"}),l=t.compareInfoOpen?`
      <div data-role="compare-info-overlay" class="compare-info-overlay" style="${m(o)}">
        <div style="${m(s)}" role="dialog" aria-modal="true" aria-label="${e.title}">
          <div style="${m(v.infoModalHeader)}">
            <div style="${m(v.infoModalTitle)}">${e.title}</div>
            <button type="button" data-action="close-compare-info" style="${m(v.infoModalClose)}" aria-label="Close info dialog">✕</button>
          </div>
          <div style="${m(v.infoModalBody)}">
            ${n}
          </div>
          <div style="${m(v.infoModalFooter)}">
            <button type="button" data-action="close-compare-info" style="${m(v.infoModalConfirm)}">Got it</button>
          </div>
        </div>
      </div>
    `:"";return`
      <div data-role="compare-info-trigger" style="${m(G(v.compareInfoWrap,{right:r,bottom:a}))}">
        <button type="button" data-action="open-compare-info" style="${m(v.compareInfoButton)}">
          What am I seeing?
        </button>
      </div>
      ${l}
    `}async function vc(){try{const t=await Gl();i.apiAvailable=t}catch{i.apiAvailable=!1}}function yc(t){if(t==="Historical")return"2000-01-01";const e=new Date,n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return n<2015?"2015-01-01":n>2100?"2100-12-31":`${n}-${r}-${a}`}function qt(t){return t==="Historical"?{start:"1950-01-01",end:"2014-12-31"}:{start:"2015-01-01",end:"2100-12-31"}}function jt(t,e){const n=qt(e),r=new Date(t),a=new Date(n.start),o=new Date(n.end);return r<a?n.start:r>o?n.end:t}function bc(t){let e=1/0,n=-1/0;for(let r=0;r<t.length;r++){const a=t[r];isFinite(a)&&(e=Math.min(e,a),n=Math.max(n,a))}if(!isFinite(e)||!isFinite(n))throw new Error("No valid numeric values returned from dataset.");return{min:e,max:n}}function wc(t,e){let n=0,r=0;for(let a=0;a<t.length;a++){const o=t[a];if(!isFinite(o))continue;const s=e==="hurs"?Math.min(o,100):o;n+=s,r+=1}if(!r)throw new Error("No valid numeric values returned from dataset.");return n/r}function xc(t,e){let n=!1;for(let r=0,a=e.length-1;r<e.length;a=r++){const o=e[r].lon,s=e[r].lat,l=e[a].lon,c=e[a].lat;s>t.lat!=c>t.lat&&t.lon<(l-o)*(t.lat-s)/(c-s+Number.EPSILON)+o&&(n=!n)}return n}function Sc(t,e,n,r){const[a,o]=n,s=360/o,l=150/a;let c=0,u=0;for(let d=0;d<a;d++){const f=90-d*l-l/2;for(let p=0;p<o;p++){const g=p*s+s/2,k=g>180?g-360:g,P=(a-1-d)*o+p,E=t[P];if(!isFinite(E))continue;const S=e==="hurs"?Math.min(E,100):E;xc({lat:f,lon:k},r)&&(c+=S,u+=1)}}if(!u)throw new Error("The selected region does not contain valid data points.");return c/u}function $c(t,e,n=.75){const r=t.lat-e.lat,a=t.lon-e.lon;return Math.hypot(r,a)<=n}function Mc(t,e,n,r){const[a,o]=n,l=((r.lon+360)%360+360)%360/360*o-.5,c=(90-r.lat)/150*a-.5,u=(E,S,w)=>Math.min(w,Math.max(S,E)),d=u(Math.round(l),0,o-1),f=u(Math.round(c),0,a-1),p=(E,S)=>(a-1-S)*o+E,g=(E,S)=>{const w=(E%o+o)%o,N=u(S,0,a-1),I=p(w,N),L=t[I];return Number.isFinite(L)?L:null};let k=g(d,f);if(k===null){let S=null;for(let w=1;w<=3&&S===null;w++)for(let N=-w;N<=w;N++){for(let I=-w;I<=w;I++){if(Math.abs(I)!==w&&Math.abs(N)!==w)continue;const L=g(d+I,f+N);if(L!==null){S=L;break}}if(S!==null)break}k=S}if(k===null)throw new Error("No valid data at the selected point.");const P=e==="hurs"?Math.min(k,100):k;if(!Number.isFinite(P))throw new Error(`Invalid value at point: ${P}`);return P}function ne(){return{active:!1,points:[],previewPoint:null}}function _c(t){Jt||(Jt=e=>{e.key==="Enter"&&i.drawState.active&&(e.preventDefault(),t())},window.addEventListener("keydown",Jt))}function da(){Jt&&(window.removeEventListener("keydown",Jt),Jt=null)}function Vn(t){const e=i.drawState.active||i.pointSelectActive,n=i.metaData?.variable_metadata[i.variable]?.unit||"";rc(t,i.currentData,n,i.variable,i.selectedUnit,{drawMode:e,onDrawClick:i.pointSelectActive?Ic:Cc,onDrawMove:i.drawState.active?Ac:void 0,onTransform:()=>{Je(),gr()}}),gr()}function Je(){if(!Y)return;const t=Y.querySelector("#draw-overlay-canvas"),e=dt||Y.querySelector("#map-canvas");if(!t||!e)return;const n=e.getBoundingClientRect(),r=window.devicePixelRatio||1;t.width=n.width*r,t.height=n.height*r,t.style.width=`${n.width}px`,t.style.height=`${n.height}px`;const a=t.getContext("2d");if(!a)return;a.save(),a.scale(r,r),a.clearRect(0,0,n.width,n.height);const o=[...i.drawState.points],s=i.drawState.previewPoint?[...o,i.drawState.previewPoint]:o,l=[];if(s.forEach(c=>{const u=nc(e,c.lon,c.lat);u&&l.push(u)}),!l.length){a.restore();return}a.lineWidth=2,a.strokeStyle="#34d399",a.fillStyle="rgba(52,211,153,0.18)",a.beginPath(),a.moveTo(l[0].x,l[0].y);for(let c=1;c<l.length;c++)a.lineTo(l[c].x,l[c].y);l.length>2&&(a.closePath(),a.fill()),a.stroke(),l.forEach(({x:c,y:u},d)=>{a.beginPath(),a.fillStyle=d===0?"#10b981":"#34d399",a.arc(c,u,4,0,Math.PI*2),a.fill(),a.strokeStyle="#0f172a",a.lineWidth=1,a.stroke()}),a.restore()}function kc(){return i.drawState.active?`
      <div style="${m(v.drawOverlay)}"></div>
      <canvas
        id="draw-overlay-canvas"
        style="${m(v.drawOverlayCanvas)}"
      ></canvas>
      <div style="${m(v.drawPrompt)}">
        <div>Draw the region you want to explore</div>
        <div style="${m(v.drawPromptSub)}">
          Click to add points · Enter or click first point to finish
        </div>
      </div>
    `:""}function gr(){if(!Y)return;const t=Y.querySelector("#point-overlay-marker"),e=dt||Y.querySelector("#map-canvas");!t||!e||!i.pointSelectActive||(t.style.left="0px",t.style.top="0px",t.style.right="0px",t.style.bottom="0px",t.style.width="100%",t.style.height="100%")}function Dc(){return i.pointSelectActive?`
      <div style="${m(v.drawOverlay)}"></div>
      <div
        id="point-overlay-marker"
        style="${m({position:"absolute",inset:0,pointerEvents:"none",zIndex:9})}"
      ></div>
      <div style="${m(v.drawPrompt)}">
        <div>Click a point to sample</div>
        <div style="${m(v.drawPromptSub)}">
          The chart will load data for this single location
        </div>
      </div>
    `:""}function vr(){i.chartLocation="Draw",i.chartPolygon=null,i.chartLocationName=null,i.chartLocationSearchResults=[],i.chartLocationSearchQuery="",i.chartLocationSearchError=null,i.chartLocationSearchLoading=!1,i.chartError=null,i.pointSelectActive=!1,i.drawState={active:!0,points:[],previewPoint:null},i.canvasView="map",_c(fa),q(),ut()}function Ye(){i.drawState=ne(),da()}function yr(){i.chartLocation="Point",i.chartPolygon=null,i.chartPoint=null,i.chartLocationName=null,i.chartLocationSearchResults=[],i.chartLocationSearchQuery="",i.chartLocationSearchError=null,i.chartLocationSearchLoading=!1,i.chartError=null,i.drawState=ne(),i.chartUnit=pe(i.chartVariable).label,i.pointSelectActive=!0,i.canvasView="map",q(),ut()}function Ke(){i.pointSelectActive=!1}async function Ec(t){const e=t.trim();if(!e)return[];const n=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(e)}&limit=5&addressdetails=1`,r=await fetch(n,{headers:{Accept:"application/json","User-Agent":"climate-visualization-app/1.0"}});if(!r.ok)throw new Error("Location search failed. Please try again.");return(await r.json()).map(o=>({displayName:o.display_name,lat:Number(o.lat),lon:Number(o.lon)})).filter(o=>Number.isFinite(o.lat)&&Number.isFinite(o.lon))}function Lc(t){Rt!==null&&(window.clearTimeout(Rt),Rt=null),i.chartLocation="Search",i.chartPoint={lat:t.lat,lon:t.lon},i.chartLocationName=t.displayName,i.chartLocationSearchError=null,i.chartLocationSearchResults=[],i.chartLocationSearchLoading=!1,i.chartLocationSearchQuery="",i.chartError=null,i.chartPolygon=null,i.pointSelectActive=!1,i.drawState=ne(),i.canvasView="chart",Ye(),Ke(),q(),kt()}async function Tc(t){const e=t.trim(),n=++Ee;if(i.chartLocation="Search",i.chartLocationSearchQuery=t,i.chartLocationSearchError=null,i.chartLocationSearchResults=[],i.chartLocationName=null,i.chartPoint=null,i.chartError=null,i.chartPolygon=null,i.pointSelectActive=!1,i.drawState=ne(),i.canvasView="chart",Ye(),Ke(),!e){i.chartLocationSearchLoading=!1,i.chartLocationSearchResults=[],i.chartLocationSearchError=null,q();return}i.chartLocationSearchLoading=!0,q();try{const r=await Ec(e);if(n!==Ee)return;i.chartLocationSearchResults=r,r.length||(i.chartLocationSearchError="No places found for that query.")}catch(r){if(n!==Ee)return;i.chartLocationSearchError=r instanceof Error?r.message:"Search failed."}finally{if(n!==Ee)return;i.chartLocationSearchLoading=!1,q()}}function Ac(t){i.drawState.active&&(i.drawState={...i.drawState,previewPoint:t},Je())}function Cc(t){if(!i.drawState.active)return;const e=i.drawState.points;if(e.length>=3&&$c(t,e[0])){fa();return}i.drawState={...i.drawState,points:[...e,t],previewPoint:t},Je()}function Ic(t){i.pointSelectActive&&(i.chartPoint=t,i.pointSelectActive=!1,i.chartError=null,i.canvasView="chart",q(),kt())}function fa(){if(i.drawState.active){if(i.drawState.points.length<3){i.chartError="Draw at least three points to define a region.",q();return}i.chartPolygon=i.drawState.points,i.drawState=ne(),da(),i.chartError=null,i.canvasView="chart",q(),kt()}}function Nc(t){const e=t.filter(s=>Number.isFinite(s)).sort((s,l)=>s-l);if(!e.length)throw new Error("No valid values available to build chart statistics.");const n=nn(e,.25)??e[0],r=nn(e,.5)??e[Math.floor(e.length/2)],a=nn(e,.75)??e[e.length-1],o=Ta(e)??e[0];return{min:e[0],q1:n,median:r,q3:a,max:e[e.length-1],mean:o,count:e.length}}function ha(t,e,n){const r=new Map;return t.forEach(a=>{const o=r.get(a.scenario)??[];o.push(a),r.set(a.scenario,o)}),Array.from(r.entries()).map(([a,o])=>{const s=o.map(c=>{const u=le(c.rawValue,e,n);return{...c,value:u}}),l=Nc(s.map(c=>c.value));return{scenario:a,dateUsed:o[0]?.dateUsed??"",samples:s,stats:l}})}function Pc(t,e,n,r){const a=ge(t),o=ge(e);if(!a||!o)throw new Error("Comparison data is missing numeric values.");if(a.length!==o.length||t.shape[0]!==e.shape[0]||t.shape[1]!==e.shape[1])throw new Error("Comparison datasets have mismatched shapes.");const s=new Float32Array(a.length);let l=1/0,c=-1/0;for(let d=0;d<a.length;d++){const f=a[d],p=o[d];if(!isFinite(f)||!isFinite(p)){s[d]=NaN;continue}const g=p-f;s[d]=g,isFinite(g)&&(l=Math.min(l,g),c=Math.max(c,g))}if(!isFinite(l)||!isFinite(c))throw new Error("Comparison produced no valid numeric values.");return{data:{...t,data:s,data_encoding:"none",dtype:"float32",model:`${r} minus ${n}`,time:`${e.time} minus ${t.time}`,scenario:`${e.scenario} minus ${t.scenario}`,metadata:{...t.metadata,comparison:{labelA:n,labelB:r}}},min:l,max:c}}function Z(t,e=!1){const n=Math.max(0,Math.min(100,Math.round(t)));n!==i.loadingProgress&&(i.loadingProgress=n,(i.isLoading||e)&&q())}async function Rc(t,e){let n=vt({variable:i.variable,date:i.date,model:i.model,scenario:i.scenario,resolution:i.resolution}),r=n,a="",o="";switch(i.compareMode){case"Scenarios":{const c=i.compareScenarioA,u=i.compareScenarioB,d=jt(i.date,t);d!==i.date&&(i.date=d),n=vt({variable:i.variable,date:d,model:i.model,scenario:c,resolution:i.resolution}),r=vt({variable:i.variable,date:d,model:i.model,scenario:u,resolution:i.resolution}),a=c,o=u;break}case"Models":{const c=jt(i.date,t);c!==i.date&&(i.date=c),n=vt({variable:i.variable,date:c,model:i.compareModelA,scenario:i.scenario,resolution:i.resolution}),r=vt({variable:i.variable,date:c,model:i.compareModelB,scenario:i.scenario,resolution:i.resolution}),a=i.compareModelA,o=i.compareModelB;break}case"Dates":{const c=jt(i.compareDateStart,i.scenario),u=jt(i.compareDateEnd,i.scenario);c!==i.compareDateStart&&(i.compareDateStart=c),u!==i.compareDateEnd&&(i.compareDateEnd=u),n=vt({variable:i.variable,date:c,model:i.model,scenario:i.scenario,resolution:i.resolution}),r=vt({variable:i.variable,date:u,model:i.model,scenario:i.scenario,resolution:i.resolution}),a=c,o=u;break}}const s=await We(n);e?.(65);const l=await We(r);return e?.(85),Pc(s,l,a,o)}async function kt(){if(i.canvasView==="chart"){if(i.chartMode==="range"){i.chartError="Range mode is not implemented yet.",i.chartBoxes=null,i.chartSamples=[],i.chartLoading=!1,i.chartLoadingProgress={total:0,done:0},q();return}if(i.chartLocation==="Draw"&&(!i.chartPolygon||i.chartPolygon.length<3)){i.chartError="Draw a region on the map to load chart data.",i.chartBoxes=null,i.chartSamples=[],i.chartLoading=!1,i.chartLoadingProgress={total:0,done:0},q();return}if(i.chartLocation==="Point"&&!i.chartPoint){i.chartError="Click a point on the map to load chart data.",i.chartBoxes=null,i.chartSamples=[],i.chartLoading=!1,i.chartLoadingProgress={total:0,done:0},q();return}if(i.chartLocation==="Search"&&!i.chartPoint){i.chartError=i.chartLocationSearchLoading?"Searching for a place...":"Search for a place and pick a result.",i.chartBoxes=null,i.chartSamples=[],i.chartLoading=!1,i.chartLoadingProgress={total:0,done:0},q();return}i.chartLoading=!0,i.chartError=null,Z(5,!0),i.chartLoadingProgress={total:0,done:0},q();try{const t=i.metaData??await aa();i.metaData||(i.metaData=t);const e=t?.scenarios?.length?Array.from(new Set(t.scenarios.map(On))):wt,n=t?.models?.length?t.models:nt,r=(i.chartScenarios.length?i.chartScenarios:e).filter(u=>e.includes(u)),a=(i.chartModels.length?i.chartModels:n).filter(u=>n.includes(u));if(!r.length||!a.length){i.chartError="Select at least one scenario and one model.",i.chartSamples=[],i.chartBoxes=null,i.chartLoading=!1,i.chartLoadingProgress={total:0,done:0},q();return}const o=qn(r),s=kn(i.chartDate,o);s!==i.chartDate&&(i.chartDate=s);const l=r.length*a.length;i.chartLoadingProgress={total:l,done:0},q();const c=[];for(const u of r){const d=kn(i.chartDate,qt(u));for(const f of a){const p=i.chartLoadingProgress.done;Z(Math.min(95,Math.round((p+.1)/l*100)));const g=vt({variable:i.chartVariable,date:d,model:f,scenario:u,resolution:1}),k=await We(g),P=i.chartLoadingProgress.done+1;i.chartLoadingProgress={total:l,done:P},Z(Math.min(98,Math.round(P/l*100))),q();const E=ge(k);if(!E)throw new Error("No data returned for chart request.");const S=i.chartLocation==="Draw"&&i.chartPolygon&&i.chartPolygon.length>=3?Sc(E,i.chartVariable,k.shape,i.chartPolygon):(i.chartLocation==="Point"||i.chartLocation==="Search")&&i.chartPoint?Mc(E,i.chartVariable,k.shape,i.chartPoint):wc(E,i.chartVariable);c.push({scenario:u,model:f,rawValue:S,dateUsed:d})}}i.chartSamples=c,i.chartBoxes=ha(c,i.chartVariable,i.chartUnit),i.chartLoadingProgress={total:l,done:l},Z(100)}catch(t){i.chartError=t instanceof Dt&&t.statusCode||t instanceof Error?t.message:String(t),i.chartSamples=[],i.chartBoxes=null,i.chartLoadingProgress={total:1,done:1}}finally{i.chartLoading=!1,q()}}}async function ut(){if(console.log("fetching"),i.canvasView==="map"){i.isLoading=!0,Z(5,!0),i.dataError=null;try{const t=await aa();i.metaData=t,i.availableModels=t.models,Z(20);const e=i.mode==="Compare"&&i.compareMode==="Scenarios"?i.compareScenarioA:i.scenario;i.timeRange=qt(e),Z(30);const n=i.mode==="Compare"?await Rc(e,Z):await(async()=>{Z(40);const r=jt(i.date,e);r!==i.date&&(i.date=r);const a=vt({variable:i.variable,date:r,model:i.model,scenario:i.scenario,resolution:i.resolution});Z(55);let o=await We(a);Z(80);let s=ge(o);if(!s)throw new Error("No data returned for the selected parameters.");if(i.variable==="hurs"){const u=new Float32Array(s.length);let d=1/0,f=-1/0;for(let p=0;p<s.length;p++){const g=s[p];if(!isFinite(g)){u[p]=NaN;continue}const k=Math.min(g,100);u[p]=k,d=Math.min(d,k),f=Math.max(f,k)}return o={...o,data:u,data_encoding:"none"},s=u,{data:o,min:d,max:f}}const{min:l,max:c}=bc(s);return Z(95),{data:o,min:l,max:c}})();if(i.currentData=n.data,i.dataMin=n.min,i.dataMax=n.max,Z(100),i.isLoading=!1,q(),Y){const r=Y.querySelector("#map-canvas");r&&Vn(r)}}catch(t){t instanceof Dt&&t.statusCode?i.dataError=t.message:i.dataError=t instanceof Error?t.message:String(t),i.isLoading=!1,Z(0,!0),i.currentData=null,i.dataMin=null,i.dataMax=null,q()}}}function Bc(){return`
      <div style="${m(v.branding)}">
        <div data-role="brand-eye" style="${m(v.brandIcon)}">
          <svg viewBox="0 0 120 80" style="${m(v.brandSvg)}" aria-hidden="true">
            <defs>
              <clipPath id="brand-eye-clip">
                <rect x="0" y="0" width="120" height="80" style="${m(v.brandClipRect)}" />
              </clipPath>
            </defs>
            <g style="${m(v.brandLids)}">
              <path
                d="M10 40c10-15 30-30 50-30s40 15 50 30c-10 15-30 30-50 30S20 55 10 40Z"
                style="${m(v.brandOutline)}"
              />
            </g>
            <g data-role="brand-iris" style="${m(G(v.brandIrisGroup,v.brandEyeContent))}">
              <circle cx="60" cy="40" r="20" style="${m(v.brandIris)}" />
              <g data-role="brand-pupil" style="${m(v.brandPupilGroup)}">
                <circle cx="60" cy="40" r="10" style="${m(v.brandPupil)}" />
                <circle cx="72" cy="30" r="4" style="${m(v.brandHighlight)}" />
              </g>
            </g>
          </svg>
        </div>
        <span style="${m(v.brandName)}">Polyoracle</span>
      </div>
    `}function q(){if(!Y)return;const t=!!Y.querySelector('.custom-select-wrapper[data-key="chartLocation"]')?.classList.contains("open"),e=(i.resolution-1)/2*100,n=i.mode==="Explore"?"translateX(0%)":"translateX(-50%)",r=i.mode==="Explore"?"translateX(0%)":"translateX(100%)",a=i.canvasView==="map"?"translateX(0%)":"translateX(100%)",o=i.panelTab==="Manual"?"translateX(0%)":"translateX(-50%)";if(Y.innerHTML=`
    <div style="${m(v.page)}">
      <div style="${m(v.bgLayer1)}"></div>
      <div style="${m(v.bgLayer2)}"></div>
      <div style="${m(v.bgOverlay)}"></div>
      ${Bc()}
        ${i.canvasView==="map"&&i.dataMin!==null&&i.dataMax!==null?Vl(i.variable,i.dataMin,i.dataMax,i.metaData,i.selectedUnit,i.mode==="Compare"):""}
      <div style="${m(v.mapArea)}">
        ${i.canvasView==="map"?`
              <canvas
                id="map-canvas"
                style="position: absolute; inset: 0; width: 100%; height: 100%; object-fit: contain; pointer-events: auto;"
              ></canvas>
              ${kc()}
              ${Dc()}
              ${zc()}
              ${i.dataError?`<div style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.8); z-index: 10;">
                      <div style="text-align: center; max-width: 600px; padding: 20px;">
                        <div style="${m(v.mapTitle)}">Error loading data</div>
                        <div style="${m(v.mapSubtitle)}">${i.dataError}</div>
                        ${i.apiAvailable===!1?`<div style="${m(G(v.mapSubtitle,{marginTop:12,fontSize:12}))}">
                                Make sure the Python API server is running. Check the terminal for connection details.
                              </div>`:""}
                      </div>
                    </div>`:""}
              ${!i.isLoading&&!i.dataError&&!i.currentData?`<div style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.5); z-index: 5;">
                      <div style="text-align: center;">
                        <div style="${m(v.mapTitle)}">No data loaded</div>
                        <div style="${m(v.mapSubtitle)}">
                          Adjust parameters to load climate data
                        </div>
                      </div>
                    </div>`:""}
            `:qc()}
      </div>

      <aside data-role="sidebar" class="sidebar" style="width: ${ot}px; transform: ${i.sidebarOpen?"translateX(0)":`translateX(${ot+24}px)`}; pointer-events: ${i.sidebarOpen?"auto":"none"}" aria-hidden="${!i.sidebarOpen}">
        <div class="sidebar-top">
          <div class="sidebar-brand">
            <div class="logo-dot"></div>
          </div>
          <div class="tab-switch" style="${m(v.tabSwitch)}">
            ${["Manual","Chat"].map(s=>Vc(s,i.panelTab===s?v.tabBtnActive:void 0,"panel-tab")).join("")}
          </div>
        </div>

        <div class="sidebar-content">
          <div class="tab-viewport">
            <div data-role="tab-track" class="tab-track" style="transform: ${o}">
              <div class="tab-pane">
                ${i.canvasView==="map"?Xc({modeTransform:n,resolutionFill:e,modeIndicatorTransform:r}):Wc()}
              </div>
              <div class="tab-pane">
                ${Uc()}
              </div>
            </div>
          </div>
        </div>
      </aside>

      <div data-role="canvas-toggle" style="${m({...v.canvasToggle,right:i.sidebarOpen?ot+24:24})}">
        <div style="${m(v.canvasSwitch)}">
          <div data-role="canvas-indicator" style="${m({...v.canvasIndicator,transform:a})}"></div>
          <button
            type="button"
            aria-label="Show map canvas"
            data-action="set-canvas"
            data-value="map"
            style="${m(G(v.canvasBtn,i.canvasView==="map"?v.canvasBtnActive:void 0))}"
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.6">
              <path d="M4 6.5 9 4l6 2.5L20 4v14l-5 2.5L9 18 4 20.5V6.5Z" />
              <path d="m9 4v14m6-11.5v14" />
            </svg>
          </button>
          <button
            type="button"
            aria-label="Show chart canvas"
            data-action="set-canvas"
            data-value="chart"
            style="${m(G(v.canvasBtn,i.canvasView==="chart"?v.canvasBtnActive:void 0))}"
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.8">
              <path d="M4 18h16" />
              <path d="M6 18 11 9l4 5 3-6" />
              <circle cx="6" cy="18" r="1.2" />
              <circle cx="11" cy="9" r="1.2" />
              <circle cx="15" cy="14" r="1.2" />
              <circle cx="18" cy="8" r="1.2" />
            </svg>
          </button>
        </div>
      </div>

      ${gc(i)}

      ${Pl(i.sidebarOpen)}

      ${i.canvasView==="map"?oc({date:i.date,timeRange:i.timeRange,sidebarOpen:i.sidebarOpen,sidebarWidth:ot,mode:i.mode,compareMode:i.compareMode,compareDateStart:i.compareDateStart,compareDateEnd:i.compareDateEnd}):""}
    </div>
  `,Kc(),t){const s=Y.querySelector('.custom-select-wrapper[data-key="chartLocation"]');s&&s.classList.add("open")}if(dt=Y.querySelector("#map-canvas"),dt&&i.currentData&&!i.dataError&&i.dataMin!==null&&i.dataMax!==null){Vn(dt),Mn(i.currentData,dt,Q,i.palette,i.dataMin,i.dataMax,i.variable,i.selectedUnit);const s=Q.find(l=>l.name===i.palette)||Q[0];wn("legend-gradient-canvas",s.colors),i.drawState.active&&requestAnimationFrame(Je)}}function zc(){if(!i.isLoading)return"";const t=Math.max(0,Math.min(100,Math.round(i.loadingProgress)));return`
      <div style="${m(v.loadingIndicator)}">
        <div style="${m(v.loadingSpinner)}"></div>
        <div style="${m(v.loadingTextGroup)}">
          <div style="${m(v.loadingText)}">Loading data · ${t}%</div>
          <div style="${m(v.loadingBar)}">
            <div style="${m({...v.loadingBarFill,width:`${t}%`})}"></div>
          </div>
          <div style="${m(v.loadingSubtext)}">Fetching climate tiles</div>
        </div>
      </div>
    `}function Fc(){return`
      <div style="position:absolute; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none;">
      </div>
    `}function Oc(t){if(!Number.isFinite(t))return"-";const e=Math.abs(t);return e>=1e3?t.toFixed(0):e>=100?t.toFixed(1):e>=1?t.toFixed(2):t.toPrecision(2)}function br(t){if(!t.length)return`<div style="${m(v.chartEmpty)}">No chart data loaded yet.</div>`;const e=[...t].sort((I,L)=>wt.indexOf(I.scenario)-wt.indexOf(L.scenario)),r=(Q.find(I=>I.name===i.palette)||Q[0]).colors,a=900,o=440,s={top:26,right:36,bottom:70,left:86},l=a-s.left-s.right,c=o-s.top-s.bottom,u=e.flatMap(I=>[I.stats.min,I.stats.max]),d=Math.min(...u),f=Math.max(...u),p=Math.max(Math.abs(f-d)*.12,1e-6),g=ta().domain([d-p,f+p]).range([c,0]),k=g.ticks(6),P=l/(e.length+1),E=k.map(I=>{const L=g(I)+s.top;return`
        <g>
          <line x1="${s.left}" x2="${a-s.right}" y1="${L}" y2="${L}" stroke="rgba(255,255,255,0.08)" />
          <text x="${s.left-10}" y="${L+4}" fill="var(--text-secondary)" font-size="11" text-anchor="end">
            ${Oc(I)}
          </text>
        </g>
      `}).join(""),S=e.map((I,L)=>{const R=s.left+P*(L+1),y=r[L%r.length],{min:b,q1:D,median:A,q3:M,max:$,mean:F}=I.stats,h=g(M)+s.top,_=g(D)+s.top,x=Math.max(2,_-h);return`
        <g>
          <line x1="${R}" x2="${R}" y1="${g(b)+s.top}" y2="${g($)+s.top}" stroke="${y}" stroke-width="2" stroke-linecap="round" />
          <rect x="${R-24}" y="${h}" width="48" height="${x}" fill="rgba(255,255,255,0.06)" stroke="${y}" stroke-width="2" rx="6" />
          <line x1="${R-24}" x2="${R+24}" y1="${g(A)+s.top}" y2="${g(A)+s.top}" stroke="${y}" stroke-width="2.4" />
          <circle cx="${R}" cy="${g(F)+s.top}" r="4" fill="${y}" stroke="rgba(0,0,0,0.55)" stroke-width="1" />
          <text x="${R}" y="${o-s.bottom+32}" fill="var(--text-primary)" font-weight="700" font-size="12" text-anchor="middle">${I.scenario}</text>
          <text x="${R}" y="${o-s.bottom+48}" fill="var(--text-secondary)" font-size="11" text-anchor="middle">${I.samples.length} model${I.samples.length===1?"":"s"}</text>
        </g>
      `}).join(""),w=`
      <line
        x1="${s.left}"
        x2="${s.left}"
        y1="${s.top}"
        y2="${o-s.bottom}"
        stroke="rgba(255,255,255,0.65)"
        stroke-width="1.2"
      />
    `,N=`
      <text
        x="${s.left-70}"
        y="${s.top+c/2}"
        fill="var(--text-secondary)"
        font-size="12"
        text-anchor="middle"
        transform="rotate(-90 ${s.left-70} ${s.top+c/2})"
      >
        ${i.chartUnit}
      </text>
    `;return`
      <svg viewBox="0 0 ${a} ${o}" role="img" aria-label="Global box plots" preserveAspectRatio="xMidYMid meet" style="width:100%; height:auto;">
        ${w}
        ${E}
        ${S}
        ${N}
      </svg>
    `}function qc(){let t="";i.chartLoading?t=`
          <div style="position:absolute; inset:0; pointer-events:none;">
            <div style="${m(G(v.loadingIndicator,{position:"absolute",left:18,bottom:-95,pointerEvents:"auto"}))}">
              <div style="${m(v.loadingSpinner)}"></div>
              <div style="${m(v.loadingTextGroup)}">
                <div style="${m(v.loadingText)}">Loading data</div>
                <div style="${m(v.loadingBar)}">
                  <div style="${m({...v.loadingBarFill,width:`${Math.max(0,Math.min(100,Math.round(i.loadingProgress||25)))}%`})}"></div>
                </div>
                <div style="${m(v.loadingSubtext)}">${i.chartLoadingProgress.total>0?`${i.chartLoadingProgress.done}/${i.chartLoadingProgress.total} datasets loaded`:"Preparing datasets"}</div>
              </div>
            </div>
            ${Fc()}
          </div>
          ${i.chartBoxes?br(i.chartBoxes):""}
        `:i.chartError?t=`<div style="${m(v.chartError)}">${i.chartError}</div>`:!i.chartBoxes||!i.chartBoxes.length?t=`
          <div style="${m(v.chartEmpty)}">
            Select scenarios and models to fetch the global box plot.
          </div>
        `:t=br(i.chartBoxes);const e=i.chartLocationName||(i.chartLocation==="Point"&&i.chartPoint?`Point (${i.chartPoint.lat.toFixed(2)}, ${i.chartPoint.lon.toFixed(2)})`:i.chartLocation==="Draw"?"Custom region":i.chartLocation==="World"?"Global":"");return`
      <div style="pointer-events:auto; width:100%; display:flex; align-items:center; justify-content:center; padding:24px; padding-right:${i.sidebarOpen?ot+32:24}px;">
        <div style="${m(v.chartPanel)}">
          <div style="${m(v.chartHeader)}">
            <div style="${m(v.chartTitle)}">${ua(i.chartVariable,i.metaData)}</div>
            <div style="${m(v.mapSubtitle)}">${e?`${Kt(e)} · ${Gt(i.chartDate)}`:Gt(i.chartDate)}</div>
          </div>
          <div style="${m(G(v.chartPlotWrapper,{display:"flex",alignItems:"center",justifyContent:"center"}))}">
            ${t}
          </div>
        </div>
      </div>
    `}function H(t,e){return`
    <div style="${m(v.field)}">
      ${t?`<div style="${m(v.fieldLabel)}">${t}</div>`:""}
      ${e}
    </div>
  `}function Ut(t,e,n){const r=n?.type??"date",a=n?.dataKey??t,o=n?.min?`min="${n.min}"`:"",s=n?.max?`max="${n.max}"`:"";return`
    <input
      type="${r}"
      value="${e}"
      data-action="update-input"
      data-key="${a}"
      ${o}
      ${s}
    />
  `}function U(t,e,n,r){const a=r?.dataKey??t,o=r?.disabled?"disabled":"",s=`custom-select-${a}-${Math.random().toString(36).substr(2,9)}`,l=r?.infoType,c=Kt(r?.selectedLabel??n),u=r?.extraContent??"";return`
    <div class="custom-select-container">
      <div class="custom-select-info-panel" id="${s}-info" role="tooltip"></div>
      <div class="custom-select-wrapper" data-key="${a}" ${o?'data-disabled="true"':""} ${l?`data-info-type="${l}"`:""}>
        <div class="custom-select-trigger" data-action="update-select" data-key="${a}" id="${s}-trigger" ${o?'aria-disabled="true"':""} tabindex="${o?"-1":"0"}">
          <span class="custom-select-value">${c}</span>
          <svg class="custom-select-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="custom-select-dropdown" id="${s}-dropdown" role="listbox">
          ${e.map(d=>`
                <div class="custom-select-option ${d===n?"selected":""}" 
                     data-value="${d}" 
                     data-action="update-select" 
                     data-key="${a}"
                     role="option"
                     ${d===n?'aria-selected="true"':""}
                     tabindex="0">
                  ${d}
                </div>
              `).join("")}
          ${u}
        </div>
      </div>
    </div>
  `}function Vc(t,e,n="panel-tab"){return`
    <button
      type="button"
      data-action="set-tab"
      data-key="${n}"
      data-value="${t}"
      style="${m(G(v.tabBtn,e))}"
    >
      ${t}
    </button>
  `}function Xc(t){const{modeTransform:e,resolutionFill:n,modeIndicatorTransform:r}=t,a=i.compareMode==="Models"?[H("Scenario",U("scenario",wt,i.scenario,{infoType:"scenario"})),H("Date",Ut("date",i.date))]:i.compareMode==="Dates"?[H("Scenario",U("scenario",wt,i.scenario,{infoType:"scenario"})),H("Model",U("model",nt,i.model,{infoType:"model"}))]:[H("Model",U("model",nt,i.model,{infoType:"model"})),H("Date",Ut("date",i.date))];return`
    <div style="${m(v.modeSwitch)}">
      <div data-role="mode-indicator" style="${m({...v.modeIndicator,transform:r})}"></div>
      ${["Explore","Compare"].map(o=>`
            <button
              type="button"
              class="mode-btn"
              data-action="set-mode"
              data-value="${o}"
              style="${m(G(v.modeBtn,i.mode===o?v.modeBtnActive:void 0))}"
            >
              ${o}
            </button>
          `).join("")}
    </div>

    <div style="${m(v.modeViewport)}">
      <div data-role="mode-track" style="${m({...v.modeTrack,transform:e})}">
        <div class="mode-pane-scrollable" style="${m(v.modePane)}">
          <div style="${m({display:"flex",flexDirection:"column",gap:8})}">
            <div style="${m(v.sectionTitle)}">Parameters</div>
            <div style="${m(v.paramGrid)}">
              ${H("Scenario",U("scenario",wt,i.scenario,{infoType:"scenario"}))}
              ${H("Model",U("model",nt,i.model,{infoType:"model"}))}
              ${H("Date",(()=>{const o=qt(i.scenario);return Ut("date",i.date,{min:o.start,max:o.end})})())}
              ${H("Variable",U("variable",Pt,i.variable,{infoType:"variable"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${m({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${m(v.sectionTitle)}">Unit</div>
              ${H("",U("unit",Ot(i.variable).map(o=>o.label),i.selectedUnit,{dataKey:"unit"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${m({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${m(v.sectionTitle)}">Color palette</div>
              ${H("",U("palette",Q.map(o=>o.name),i.palette,{dataKey:"palette"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${m({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${m(v.sectionTitle)}">Resolution</div>
              <div style="${m(v.resolutionRow)}">
                <input
                  type="range"
                  min="1"
                  max="3"
                  step="1"
                  value="${i.resolution}"
                  data-action="set-resolution"
                  class="resolution-slider"
                  style="${m(G(v.range,{"--slider-fill":`${n}%`}))}"
                />
                <div data-role="resolution-value" style="${m(v.resolutionValue)}">${i.resolution===1?"Low":i.resolution===2?"Medium":"High"}</div>
              </div>
            </div>
          </div>
        </div>

        <div class="mode-pane-scrollable" style="${m(v.modePane)}">
          <div style="${m({display:"flex",flexDirection:"column",gap:14})}">
            <div style="${m({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${m(v.sectionTitle)}">Compare</div>
              <div style="${m(v.paramGrid)}">
                ${H("What do you want to compare?",U("compareMode",["Scenarios","Models","Dates"],i.compareMode,{dataKey:"compareMode"}))}
              </div>

              ${i.compareMode==="Scenarios"?`
                      <div style="${m(v.paramGrid)}">
                        ${H("Scenario A",U("compareScenarioA",["SSP245","SSP370","SSP585"],i.compareScenarioA,{dataKey:"compareScenarioA",infoType:"scenario"}))}
                        ${H("Scenario B",U("compareScenarioB",["SSP245","SSP370","SSP585"],i.compareScenarioB,{dataKey:"compareScenarioB",infoType:"scenario"}))}
                      </div>
                    `:""}

              ${i.compareMode==="Models"?`
                      <div style="${m(v.paramGrid)}">
                        ${H("Model A",U("compareModelA",(()=>{const o=nt.filter(s=>s!==i.compareModelB);return o.includes(i.compareModelA)?o:[i.compareModelA,...o]})(),i.compareModelA,{dataKey:"compareModelA",infoType:"model"}))}
                        ${H("Model B",U("compareModelB",(()=>{const o=nt.filter(s=>s!==i.compareModelA);return o.includes(i.compareModelB)?o:[i.compareModelB,...o]})(),i.compareModelB,{dataKey:"compareModelB",infoType:"model"}))}
                      </div>
                    `:""}

              ${i.compareMode==="Dates"?`
                      <div style="${m(v.paramGrid)}">
                        ${H("Start date",Ut("compareDateStart",i.compareDateStart,{dataKey:"compareDateStart"}))}
                        ${H("End date",Ut("compareDateEnd",i.compareDateEnd,{dataKey:"compareDateEnd"}))}
  </div>
`:""}

              <div style="${m(v.paramGrid)}">
                ${a.join("")}
                ${H("Variable",U("variable",Pt,i.variable,{infoType:"variable"}))}
              </div>

              <div style="margin-top:14px">
                <div style="${m({display:"flex",flexDirection:"column",gap:8})}">
                  <div style="${m(v.sectionTitle)}">Unit</div>
                  ${H("",U("unit",Ot(i.variable).map(o=>o.label),i.selectedUnit,{dataKey:"unit"}))}
                </div>
              </div>

              <div style="margin-top:14px">
                <div style="${m({display:"flex",flexDirection:"column",gap:8})}">
                  <div style="${m(v.sectionTitle)}">Color palette</div>
                  ${H("",U("palette",Q.map(o=>o.name),i.palette,{dataKey:"palette"}))}
                </div>
              </div>

              <div style="margin-top:14px">
                <div style="${m({display:"flex",flexDirection:"column",gap:8})}">
                  <div style="${m(v.sectionTitle)}">Resolution</div>
                  <div style="${m(v.resolutionRow)}">
                    <input
                      type="range"
                      min="1"
                      max="3"
                      step="1"
                      value="${i.resolution}"
                      data-action="set-resolution"
                      class="resolution-slider"
                      style="${m(G(v.range,{"--slider-fill":`${n}%`}))}"
                    />
                    <div data-role="resolution-value" style="${m(v.resolutionValue)}">${i.resolution===1?"Low":i.resolution===2?"Medium":"High"}</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  `}function wr(t,e,n){const r=new Set(e);return`
      <div style="${m(v.chipRow)}">
        ${t.map(a=>{const o=r.has(a);return`
                  <button
                    type="button"
                    data-action="toggle-multi"
                    data-key="${n}"
                    data-value="${a}"
                    style="${m(G(v.chip,o?v.chipActive:void 0))}"
                  >
                    ${a}
                  </button>
                `}).join("")}
      </div>
    `}function Hc(){const t=i.chartLocationSearchResults.length>0?i.chartLocationSearchResults.map(r=>`
                <button
                  type="button"
                  class="location-search-result"
                  data-role="location-search-result"
                  data-name="${Kt(r.displayName)}"
                  data-lat="${r.lat}"
                  data-lon="${r.lon}"
                >
                  <div class="location-search-result-name">${Kt(r.displayName)}</div>
                  <div class="location-search-result-coord">
                    ${r.lat.toFixed(3)}, ${r.lon.toFixed(3)}
                  </div>
                </button>
              `).join(""):"",e=i.chartLocationSearchQuery.trim().length>0,n=i.chartLocationSearchError?`<div class="location-search-error">${Kt(i.chartLocationSearchError)}</div>`:i.chartLocationSearchLoading?'<div class="location-search-status">Searching...</div>':i.chartLocationSearchResults.length===0&&e?'<div class="location-search-status">No places found. Try refining your query.</div>':"";return`
      <div class="custom-select-extra" data-role="chart-location-search">
        <div class="location-search-row">
          <input
            type="text"
            class="location-search-input"
            value="${Kt(i.chartLocationSearchQuery)}"
            placeholder="Search a place (e.g. Aachen)"
            data-role="location-search-input"
          />
        </div>
        ${n}
        <div class="location-search-results" data-role="location-search-results">
          ${t||""}
        </div>
      </div>
    `}function Wc(){const t=i.chartMode==="single"?"translateX(0%)":"translateX(100%)",e=i.metaData?.scenarios?.length?Array.from(new Set(i.metaData.scenarios.map(On))):wt,n=i.metaData?.models?.length?i.metaData.models:nt,r=qn(i.chartScenarios.length?i.chartScenarios:e),a=(l,c,u,d,f)=>`
          <div style="${m({border:"1px solid var(--border-medium)",borderRadius:12,background:"var(--bg-subtle)",padding:"10px 12px"})}">
            <button
              type="button"
              data-action="toggle-collapse"
              data-key="${f}"
              style="${m({display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",background:"transparent",border:"none",color:"var(--text-primary)",fontWeight:700,fontSize:13,cursor:"pointer",padding:0})}"
            >
              <span>${l}</span>
              <span style="${m({color:"var(--text-secondary)",fontWeight:600,fontSize:12})}">${u} ${c?"▴":"▾"}</span>
            </button>
            ${c?`<div style="${m({marginTop:10,display:"flex",flexWrap:"wrap",gap:8})}">${d}</div>`:""}
          </div>
        `,o=`
      <div style="${m(v.paramGrid)}">
        ${H("Date",Ut("chartDate",i.chartDate,{dataKey:"chartDate",min:r.start,max:r.end}))}
        ${H("Variable",U("chartVariable",Pt,i.chartVariable,{dataKey:"chartVariable",infoType:"variable"}))}
      </div>

      <div style="margin-top:10px">
        ${H("Location",U("chartLocation",["World","Draw","Point"],i.chartLocation,{dataKey:"chartLocation",selectedLabel:i.chartLocation==="Search"&&i.chartLocationName?`Search: ${i.chartLocationName}`:i.chartLocation,extraContent:Hc()}))}
      </div>

      <div style="margin-top:14px">
        ${a("Scenarios",i.chartDropdown.scenariosOpen,`${i.chartScenarios.length} selected`,wr(e,i.chartScenarios,"chartScenarios"),"chartScenarios")}
      </div>

      <div style="margin-top:14px">
        ${a("Models",i.chartDropdown.modelsOpen,`${i.chartModels.length} selected`,wr(n,i.chartModels,"chartModels"),"chartModels")}
      </div>

      <div style="margin-top:14px">
        <div style="${m(v.sectionTitle)}">Unit</div>
        ${H("",U("chartUnit",Ot(i.chartVariable).map(l=>l.label),i.chartUnit,{dataKey:"chartUnit"}))}
      </div>

      <div style="margin-top:14px">
        <div style="${m(v.sectionTitle)}">Color palette</div>
        ${H("",U("palette",Q.map(l=>l.name),i.palette,{dataKey:"palette"}))}
      </div>
    `,s=`
      <div style="${m(v.chartEmpty)}">
        Range mode will be added later.
      </div>
    `;return`
      <div style="${m(v.modeSwitch)}">
        <div data-role="chart-mode-indicator" style="${m({...v.modeIndicator,transform:t})}"></div>
        ${["single","range"].map(l=>{const c=l==="single"?"Single dates":"Range";return`
              <button
                type="button"
                class="mode-btn"
                data-action="set-chart-mode"
                data-value="${l}"
                style="${m(G(v.modeBtn,i.chartMode===l?v.modeBtnActive:void 0))}"
              >
                ${c}
              </button>
            `}).join("")}
      </div>

      <div class="mode-pane-scrollable" style="${m(v.modePane)}">
        ${i.chartMode==="single"?o:s}
      </div>
    `}function Uc(){return`
    <div style="${m({display:"flex",flexDirection:"column",gap:8})}">
      <div style="${m(v.sectionTitle)}">Chat</div>
      <div style="${m(v.chatStack)}">
        <div style="${m(v.chatLead)}">Discuss the data with an agent, or ask questions.</div>

        <div style="${m(v.chatMessages)}">
          ${i.chatMessages.map(t=>{const e=t.sender==="user"?G(v.chatBubble,v.chatBubbleUser):G(v.chatBubble,v.chatBubbleAgent);return`<div style="${m(e)}">${t.text}</div>`}).join("")}
        </div>

        <div style="${m(v.chatBox)}">
          <input
            type="text"
            value="${i.chatInput}"
            data-action="chat-input"
            style="${m(v.chatInput)}"
            placeholder="Ask a question"
          />
          <button type="button" data-action="chat-send" aria-label="Send chat message" style="${m(v.chatSend)}">
            ➤
          </button>
        </div>
      </div>
    </div>
  `}function xr(t,e,n){const r=Math.hypot(t,e);if(!r||!isFinite(r)||n<=0)return{x:0,y:0};const a=Math.min(1,n/r);return{x:t*a,y:e*a}}function Yc(t){De&&(De(),De=null),Et!==null&&(cancelAnimationFrame(Et),Et=null),St!==null&&(cancelAnimationFrame(St),St=null),Lt!==null&&(clearTimeout(Lt),Lt=null),mt!==null&&(clearTimeout(mt),mt=null);const e=t.querySelector('[data-role="brand-eye"]');if(!e)return;let n={x:0,y:0},r={x:0,y:0},a={x:0,y:0},o={x:0,y:0},s=1,l=!1;const c=3e4,u=(w,N)=>{const I=e.getBoundingClientRect(),L=I.left+I.width/2,R=I.top+I.height/2,y=w-L,b=N-R,A=Math.min(I.width,I.height)*.14,M=A*.6;n=xr(y,b,A),r=xr(y,b,M)},d=w=>{s=Math.max(0,Math.min(1,w)),e.style.setProperty("--blink-open",`${s}`)},f=()=>{mt!==null&&clearTimeout(mt),mt=window.setTimeout(()=>{n={x:0,y:0},r={x:0,y:0}},c)},p=()=>{a.x+=(n.x-a.x)*.28,a.y+=(n.y-a.y)*.28,o.x+=(r.x-o.x)*.32,o.y+=(r.y-o.y)*.32,e.style.setProperty("--iris-x",`${a.x}px`),e.style.setProperty("--iris-y",`${a.y}px`),e.style.setProperty("--pupil-x",`${o.x}px`),e.style.setProperty("--pupil-y",`${o.y}px`),Et=requestAnimationFrame(p)},g=()=>{if(l)return;l=!0;const w=[{t:0,v:1},{t:.16,v:.08},{t:.26,v:.02},{t:.4,v:1}],N=350,I=performance.now(),L=R=>{const y=R-I,b=Math.min(1,y/N);let D=w[0],A=w[w.length-1];for(let _=0;_<w.length-1;_++){const x=w[_],B=w[_+1];if(b>=x.t&&b<=B.t){D=x,A=B;break}}const M=A.t-D.t||1,$=Math.min(1,Math.max(0,(b-D.t)/M)),F=1-Math.pow(1-$,2),h=D.v+(A.v-D.v)*F;d(h),b<1?St=requestAnimationFrame(L):(d(1),l=!1,k())};St=requestAnimationFrame(L)},k=()=>{const w=3e3+Math.random()*15e3;Lt=window.setTimeout(g,w)},P=()=>{const w=e.getBoundingClientRect();u(w.left+w.width/2,w.top+w.height/2)},E=w=>{u(w.clientX,w.clientY),f()},S=()=>P();P(),p(),k(),f(),window.addEventListener("pointermove",E),window.addEventListener("pointerleave",S),De=()=>{window.removeEventListener("pointermove",E),window.removeEventListener("pointerleave",S),Et!==null&&(cancelAnimationFrame(Et),Et=null),St!==null&&(cancelAnimationFrame(St),St=null),Lt!==null&&(clearTimeout(Lt),Lt=null),mt!==null&&(clearTimeout(mt),mt=null)}}function Kc(t){if(!Y)return;const e=Y;Yc(e),Nl({root:e,getSidebarOpen:()=>i.sidebarOpen,setSidebarOpen:y=>{i.sidebarOpen=y},onTimeSliderUpdate:y=>{lc(y,ot)}}),e.querySelectorAll('[data-action="set-canvas"]').forEach(y=>y.addEventListener("click",()=>{const b=y.dataset.value;if(b){if(b===i.canvasView)return;const A=i.canvasView==="map"?"translateX(0%)":"translateX(100%)",M=b==="map"?"translateX(0%)":"translateX(100%)";i.canvasView=b,q(),b==="map"?ut():kt();const $=e.querySelector('[data-role="canvas-indicator"]');if(!$)return;$.style.removeProperty("transition"),$.style.transform=A,$.offsetHeight,$.getBoundingClientRect(),requestAnimationFrame(()=>{$.style.transition="transform 180ms ease",$.style.transform=M})}})),e.querySelectorAll('[data-action="set-mode"]').forEach(y=>y.addEventListener("click",()=>{const b=y.dataset.value;if(b){if(b===i.mode)return;const D=i.mode,A=D==="Explore"?"translateX(0%)":"translateX(-50%)",M=D==="Explore"?"translateX(0%)":"translateX(100%)",$=b==="Explore"?"translateX(0%)":"translateX(-50%)",F=b==="Explore"?"translateX(0%)":"translateX(100%)";i.mode=b,q();const h=e.querySelector('[data-role="mode-track"]'),_=e.querySelector('[data-role="mode-indicator"]');if(!h||!_)return;h.style.transition="none",_.style.transition="none",h.style.transform=A,_.style.transform=M,h.offsetHeight,h.style.transition="transform 220ms ease",_.style.transition="transform 200ms ease",h.style.transform=$,_.style.transform=F}i.canvasView==="map"&&ut()})),e.querySelectorAll('[data-action="set-chart-mode"]').forEach(y=>y.addEventListener("click",()=>{const b=y.dataset.value;if(!b||b===i.chartMode)return;const A=i.chartMode==="single"?"translateX(0%)":"translateX(100%)",M=b==="single"?"translateX(0%)":"translateX(100%)";i.chartMode=b,q();const $=e.querySelector('[data-role="chart-mode-indicator"]');$&&($.style.removeProperty("transition"),$.style.transform=A,$.offsetHeight,requestAnimationFrame(()=>{$.style.transition="transform 200ms ease",$.style.transform=M})),i.canvasView==="chart"&&kt()})),e.querySelectorAll('[data-action="set-tab"]').forEach(y=>y.addEventListener("click",()=>{const b=y.dataset.value;if(b){if(b===i.panelTab)return;const A=i.panelTab==="Manual"?"translateX(0%)":"translateX(-50%)",M=b==="Manual"?"translateX(0%)":"translateX(-50%)";i.panelTab=b,q();const $=e.querySelector('[data-role="tab-track"]');if(!$)return;$.style.removeProperty("transition"),$.style.transform=A,$.offsetHeight,$.getBoundingClientRect(),requestAnimationFrame(()=>{$.style.transition="transform 220ms ease",$.style.transform=M})}}));const s=e.querySelectorAll(".custom-select-wrapper");let l=document.querySelector(".custom-select-info-panel-shared");l||(l=document.createElement("div"),l.className="custom-select-info-panel custom-select-info-panel-shared",l.setAttribute("role","tooltip"),document.body.appendChild(l));const c=y=>{y.target.closest(".custom-select-wrapper")||(s.forEach(D=>{D.classList.remove("open")}),l&&l.classList.remove("visible"))},u=y=>{y.key==="Escape"&&(s.forEach(b=>{b.classList.remove("open")}),l&&l.classList.remove("visible"))};document.addEventListener("click",c),document.addEventListener("keydown",u),s.forEach(y=>{const b=y.querySelector(".custom-select-trigger"),D=y.querySelector(".custom-select-dropdown"),A=y.querySelectorAll(".custom-select-option"),M=y.dataset.key,$=y.dataset.infoType,F=y.dataset.disabled==="true";if(!b||!D||F)return;const h=l,_=(C,T)=>{if(!h||!$)return;let z="",O=C;if($==="scenario"?z=cc[C]||"":$==="variable"?(z=dc[C]||"",O=uc[C]||C):$==="model"&&(z=fc[C]||""),z){if(h.innerHTML=`
                    <div class="custom-select-info-panel-title">${O}</div>
                    <div class="custom-select-info-panel-content">${z}</div>
                `,T||b){const V=T||b;if(V){const K=V.getBoundingClientRect();h.style.left=`${K.left-272}px`,h.style.top=`${K.top}px`}}h.classList.add("visible")}},x=()=>{h&&h.classList.remove("visible")};b.addEventListener("click",C=>{if(C.stopPropagation(),F)return;const T=y.classList.contains("open");s.forEach(z=>{z!==y&&z.classList.remove("open")}),y.classList.toggle("open",!T)}),b.addEventListener("keydown",C=>{if(!F&&(C.key==="Enter"||C.key===" "||C.key==="ArrowDown")){C.preventDefault(),y.classList.add("open");const T=A[0];T&&T.focus()}}),A.forEach(C=>{C.addEventListener("click",T=>{T.stopPropagation();const z=C.dataset.value;if(!z||!M)return;A.forEach(V=>{V.classList.remove("selected"),V.removeAttribute("aria-selected")}),C.classList.add("selected"),C.setAttribute("aria-selected","true");const O=b.querySelector(".custom-select-value");O&&(O.textContent=z),y.classList.remove("open"),x(),d(M,z)}),$&&(C.addEventListener("mouseenter",()=>{const T=C.dataset.value;T&&_(T,C)}),C.addEventListener("mouseleave",()=>{x()})),C.addEventListener("keydown",T=>{const z=Array.from(A).indexOf(C);if(T.key==="Enter"||T.key===" ")T.preventDefault(),C.click();else if(T.key==="ArrowDown"){T.preventDefault();const O=(z+1)%A.length;A[O]?.focus()}else if(T.key==="ArrowUp"){T.preventDefault();const O=z===0?A.length-1:z-1;A[O]?.focus()}else T.key==="Escape"?(T.preventDefault(),y.classList.remove("open"),x(),b.focus()):T.key==="Home"?(T.preventDefault(),A[0]?.focus()):T.key==="End"&&(T.preventDefault(),A[A.length-1]?.focus())})}),new MutationObserver(C=>{C.forEach(T=>{T.type==="attributes"&&T.attributeName==="class"&&(y.classList.contains("open")||x())})}).observe(y,{attributes:!0})});const d=async(y,b)=>{if(!y)return;let D=!1,A=!1;switch(y){case"scenario":i.scenario=b,i.date=yc(b),i.timeRange=qt(b),D=!0;break;case"model":i.model=b,D=!0;break;case"variable":i.variable=b,i.selectedUnit=pe(b).label,D=!0;break;case"unit":if(i.selectedUnit=b,q(),i.currentData&&Y&&i.dataMin!==null&&i.dataMax!==null){const M=Y.querySelector("#map-canvas");if(M){dt=M,Vn(M),Mn(i.currentData,dt,Q,i.palette,i.dataMin,i.dataMax,i.variable,i.selectedUnit);const $=Q.find(F=>F.name===i.palette)||Q[0];wn("legend-gradient-canvas",$.colors)}}return;case"palette":if(i.palette=b,q(),i.canvasView==="map"&&i.currentData&&Y&&i.dataMin!==null&&i.dataMax!==null){const M=Y.querySelector("#map-canvas");if(M){dt=M,Mn(i.currentData,dt,Q,i.palette,i.dataMin,i.dataMax,i.variable,i.selectedUnit);const $=Q.find(F=>F.name===i.palette)||Q[0];wn("legend-gradient-canvas",$.colors)}}return;case"compareMode":i.compareMode=b,D=!0;break;case"compareScenarioA":b===i.compareScenarioB&&(i.compareScenarioB=i.compareScenarioA),i.compareScenarioA=b,D=!0;break;case"compareScenarioB":b===i.compareScenarioA&&(i.compareScenarioA=i.compareScenarioB),i.compareScenarioB=b,D=!0;break;case"compareModelA":b===i.compareModelB&&(i.compareModelB=i.compareModelA),i.compareModelA=b,D=!0;break;case"compareModelB":b===i.compareModelA&&(i.compareModelA=i.compareModelB),i.compareModelB=b,D=!0;break;case"chartVariable":i.chartVariable=b,i.chartUnit=pe(b).label,A=!0;break;case"chartUnit":i.chartUnit=b,i.chartSamples.length&&(i.chartBoxes=ha(i.chartSamples,i.chartVariable,i.chartUnit)),q();return;case"chartLocation":if(b==="Draw"){vr();return}if(b==="Point"){yr();return}if(b==="Search"){i.chartLocation="Search",i.chartPolygon=null,i.pointSelectActive=!1,i.drawState=ne(),i.chartError=null,i.chartLocationName=null,i.chartLocationSearchError=null,i.chartLocationSearchResults=[],i.chartLocationSearchQuery="",i.chartLocationSearchLoading=!1,i.canvasView="chart",Ye(),Ke(),q();return}i.chartLocation="World",i.chartPolygon=null,i.chartPoint=null,i.chartLocationName=null,i.chartLocationSearchError=null,i.chartLocationSearchResults=[],i.chartLocationSearchQuery="",i.chartLocationSearchLoading=!1,Ye(),Ke(),A=!0;break}q(),i.canvasView==="map"&&D&&ut(),i.canvasView==="chart"&&(A||D)&&kt()},f=e.querySelector('.custom-select-wrapper[data-key="chartLocation"]');if(f){f.querySelectorAll(".custom-select-option").forEach($=>{$.addEventListener("click",()=>{const F=$.dataset.value;F==="Draw"&&i.chartLocation==="Draw"?vr():F==="Point"&&i.chartLocation==="Point"&&yr()})});const b=f.querySelectorAll('[data-role="location-search-input"]'),D=f.querySelectorAll('[data-role="location-search-result"]'),A=()=>{Rt!==null&&(window.clearTimeout(Rt),Rt=null)},M=$=>{A(),Tc($)};if(b.forEach($=>{$.addEventListener("input",()=>{const F=i.chartLocationSearchResults.length>0,h=i.chartLocationSearchLoading,_=!!i.chartLocationSearchError;if(i.chartLocationSearchQuery=$.value,i.chartLocationSearchError=null,A(),!$.value.trim()){i.chartLocationSearchResults=[],i.chartLocationSearchLoading=!1,q();return}(F||h||_)&&(i.chartLocationSearchResults=[],i.chartLocationSearchLoading=!1,q()),Rt=window.setTimeout(()=>{M($.value)},hc)}),$.addEventListener("keydown",F=>{F.key==="Enter"&&(F.preventDefault(),A(),M($.value))})}),D.forEach($=>{$.addEventListener("click",()=>{const F=Number($.dataset.lat),h=Number($.dataset.lon),_=$.dataset.name??"Selected place";!Number.isFinite(F)||!Number.isFinite(h)||(f.classList.remove("open"),Lc({displayName:_,lat:F,lon:h}))})}),i.chartLocation==="Search"){const $=f.querySelector('[data-role="location-search-input"]');$&&setTimeout(()=>$.focus(),0)}}e.querySelectorAll('select[data-action="update-select"]').forEach(y=>y.addEventListener("change",async()=>{const b=y.dataset.key,D=y.value;b&&await d(b,D)})),e.querySelectorAll('[data-action="toggle-multi"]').forEach(y=>y.addEventListener("click",()=>{const b=y.dataset.key,D=y.dataset.value;if(!(!b||!D)){if(b==="chartScenarios"){const A=i.metaData?.scenarios?.length&&i.metaData.scenarios?Array.from(new Set(i.metaData.scenarios.map(On))):wt,M=D==="Historical",$=new Set(i.chartScenarios);$.has(D)?$.delete(D):M?($.clear(),$.add("Historical")):($.delete("Historical"),$.add(D)),$.size===0&&$.add(M?"Historical":D),i.chartScenarios=Array.from($).filter(h=>A.includes(h));const F=qn(i.chartScenarios);i.chartDate=kn(i.chartDate,F)}if(b==="chartModels"){const A=i.metaData?.models?.length&&i.metaData.models?i.metaData.models:nt,M=new Set(i.chartModels);M.has(D)?M.delete(D):M.add(D),i.chartModels=M.size?Array.from(M):[...A]}q(),i.canvasView==="chart"&&kt()}})),e.querySelectorAll('[data-action="toggle-collapse"]').forEach(y=>y.addEventListener("click",()=>{const b=y.dataset.key;b&&(b==="chartScenarios"&&(i.chartDropdown.scenariosOpen=!i.chartDropdown.scenariosOpen),b==="chartModels"&&(i.chartDropdown.modelsOpen=!i.chartDropdown.modelsOpen),q())})),e.querySelectorAll('[data-action="update-input"]').forEach(y=>{const b=()=>{const D=y.dataset.key;if(!D)return;const A=y.value;if(!(/^\d{4}-\d{2}-\d{2}$/.test(A)&&!isNaN(new Date(A).getTime()))){y.style.borderColor="rgba(239, 68, 68, 0.6)";return}y.style.borderColor="";let h=A;if(D==="date"&&(h=jt(A,i.scenario),h!==A&&(y.value=h)),(D==="date"?i.date:D==="compareDateStart"?i.compareDateStart:D==="compareDateEnd"?i.compareDateEnd:i.chartDate)!==h){switch(D){case"date":i.date=h;break;case"compareDateStart":i.compareDateStart=A;break;case"compareDateEnd":i.compareDateEnd=A;break;case"chartDate":i.chartDate=A;break}q(),(D==="date"||i.mode==="Compare"&&(D==="compareDateStart"||D==="compareDateEnd"))&&ut(),D==="chartDate"&&i.canvasView==="chart"&&kt()}};y.addEventListener("blur",b),y.addEventListener("keydown",D=>{D.key==="Enter"&&(D.preventDefault(),b(),y.blur())})});const E=e.querySelectorAll('[data-action="set-resolution"]'),S=e.querySelectorAll('[data-role="resolution-value"]'),w=y=>{const b=(y-1)/2*100,D=y===1?"Low":y===2?"Medium":"High";E.forEach(A=>{A.value=String(y),A.style.setProperty("--slider-fill",`${b}%`)}),S.forEach(A=>{A.textContent=D})};E.forEach(y=>y.addEventListener("input",()=>{const b=Number.parseInt(y.value,10);Number.isNaN(b)||(i.resolution=b,w(b),i.canvasView==="map"&&ut())})),e.querySelector('[data-action="open-compare-info"]')?.addEventListener("click",()=>{i.compareInfoOpen=!0,q()}),e.querySelectorAll('[data-action="close-compare-info"]').forEach(y=>y.addEventListener("click",()=>{i.compareInfoOpen=!1,q()})),sc({root:e,getTimeRange:()=>i.timeRange,onDateChange:y=>{i.date=y,ut()},getMode:()=>i.mode,getCompareMode:()=>i.compareMode,getCompareDates:()=>({start:i.compareDateStart,end:i.compareDateEnd}),onDateRangeChange:(y,b)=>{i.compareDateStart=y,i.compareDateEnd=b,ut()}});const L=e.querySelector('[data-action="chat-input"]'),R=e.querySelector('[data-action="chat-send"]');L?.addEventListener("input",()=>{i.chatInput=L.value}),L?.addEventListener("keydown",y=>{y.key==="Enter"&&(y.preventDefault(),Sr())}),R?.addEventListener("click",Sr)}function Sr(){const t=i.chatInput.trim();if(!t)return;const e={id:Date.now(),sender:"user",text:t};i.chatMessages=[...i.chatMessages,e],i.chatInput="",ln&&window.clearTimeout(ln),ln=window.setTimeout(()=>{const n={id:Date.now()+1,sender:"agent",text:"I don't work yet."};i.chatMessages=[...i.chatMessages,n],q()},1e3),q()}async function $r(){if(Y=document.querySelector("#app"),!Y)throw new Error("Root element #app not found");q(),vc().then(()=>{q()}),i.canvasView==="map"&&i.mode==="Explore"&&ut()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",$r):$r();
