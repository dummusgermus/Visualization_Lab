(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();function vn(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function di(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Ba(t){let e,n,r;t.length!==2?(e=vn,n=(l,c)=>vn(t(l),c),r=(l,c)=>t(l)-c):(e=t===vn||t===di?t:fi,n=t,r=t);function o(l,c,u=0,d=l.length){if(u<d){if(e(c,c)!==0)return d;do{const h=u+d>>>1;n(l[h],c)<0?u=h+1:d=h}while(u<d)}return u}function i(l,c,u=0,d=l.length){if(u<d){if(e(c,c)!==0)return d;do{const h=u+d>>>1;n(l[h],c)<=0?u=h+1:d=h}while(u<d)}return u}function s(l,c,u=0,d=l.length){const h=o(l,c,u,d-1);return h>u&&r(l[h-1],c)>-r(l[h],c)?h-1:h}return{left:o,center:s,right:i}}function fi(){return 0}function no(t){return t===null?NaN:+t}const hi=Ba(vn),pi=hi.right;Ba(no).center;const mi=Math.sqrt(50),gi=Math.sqrt(10),yi=Math.sqrt(2);function Dn(t,e,n){const r=(e-t)/Math.max(0,n),o=Math.floor(Math.log10(r)),i=r/Math.pow(10,o),s=i>=mi?10:i>=gi?5:i>=yi?2:1;let l,c,u;return o<0?(u=Math.pow(10,-o)/s,l=Math.round(t*u),c=Math.round(e*u),l/u<t&&++l,c/u>e&&--c,u=-u):(u=Math.pow(10,o)*s,l=Math.round(t/u),c=Math.round(e/u),l*u<t&&++l,c*u>e&&--c),c<l&&.5<=n&&n<2?Dn(t,e,n*2):[l,c,u]}function vi(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const r=e<t,[o,i,s]=r?Dn(e,t,n):Dn(t,e,n);if(!(i>=o))return[];const l=i-o+1,c=new Array(l);if(r)if(s<0)for(let u=0;u<l;++u)c[u]=(i-u)/-s;else for(let u=0;u<l;++u)c[u]=(i-u)*s;else if(s<0)for(let u=0;u<l;++u)c[u]=(o+u)/-s;else for(let u=0;u<l;++u)c[u]=(o+u)*s;return c}function pa(t,e,n){return e=+e,t=+t,n=+n,Dn(t,e,n)[2]}function ma(t,e,n){e=+e,t=+t,n=+n;const r=e<t,o=r?pa(e,t,n):pa(t,e,n);return(r?-1:1)*(o<0?1/-o:o)}function xi(t,e){let n;for(const r of t)r!=null&&(n<r||n===void 0&&r>=r)&&(n=r);return n}function wi(t,e){let n;for(const r of t)r!=null&&(n>r||n===void 0&&r>=r)&&(n=r);return n}function ea(t,e,n=no){if(!(!(r=t.length)||isNaN(e=+e))){if(e<=0||r<2)return+n(t[0],0,t);if(e>=1)return+n(t[r-1],r-1,t);var r,o=(r-1)*e,i=Math.floor(o),s=+n(t[i],i,t),l=+n(t[i+1],i+1,t);return s+(l-s)*(o-i)}}function bi(t,e){let n=0,r=0;for(let o of t)o!=null&&(o=+o)>=o&&(++n,r+=o);if(n)return r/n}var Si={value:()=>{}};function Ua(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new xn(n)}function xn(t){this._=t}function Mi(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",o=n.indexOf(".");if(o>=0&&(r=n.slice(o+1),n=n.slice(0,o)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}xn.prototype=Ua.prototype={constructor:xn,on:function(t,e){var n=this._,r=Mi(t+"",n),o,i=-1,s=r.length;if(arguments.length<2){for(;++i<s;)if((o=(t=r[i]).type)&&(o=$i(n[o],t.name)))return o;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++i<s;)if(o=(t=r[i]).type)n[o]=ir(n[o],t.name,e);else if(e==null)for(o in n)n[o]=ir(n[o],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new xn(t)},call:function(t,e){if((o=arguments.length-2)>0)for(var n=new Array(o),r=0,o,i;r<o;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(i=this._[t],r=0,o=i.length;r<o;++r)i[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],o=0,i=r.length;o<i;++o)r[o].value.apply(e,n)}};function $i(t,e){for(var n=0,r=t.length,o;n<r;++n)if((o=t[n]).name===e)return o.value}function ir(t,e,n){for(var r=0,o=t.length;r<o;++r)if(t[r].name===e){t[r]=Si,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var ga="http://www.w3.org/1999/xhtml";const sr={svg:"http://www.w3.org/2000/svg",xhtml:ga,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Wn(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),sr.hasOwnProperty(e)?{space:sr[e],local:t}:t}function Ti(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===ga&&e.documentElement.namespaceURI===ga?e.createElement(t):e.createElementNS(n,t)}}function ki(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function ao(t){var e=Wn(t);return(e.local?ki:Ti)(e)}function Li(){}function Oa(t){return t==null?Li:function(){return this.querySelector(t)}}function Di(t){typeof t!="function"&&(t=Oa(t));for(var e=this._groups,n=e.length,r=new Array(n),o=0;o<n;++o)for(var i=e[o],s=i.length,l=r[o]=new Array(s),c,u,d=0;d<s;++d)(c=i[d])&&(u=t.call(c,c.__data__,d,i))&&("__data__"in c&&(u.__data__=c.__data__),l[d]=u);return new Mt(r,this._parents)}function _i(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function Ei(){return[]}function ro(t){return t==null?Ei:function(){return this.querySelectorAll(t)}}function Ci(t){return function(){return _i(t.apply(this,arguments))}}function Pi(t){typeof t=="function"?t=Ci(t):t=ro(t);for(var e=this._groups,n=e.length,r=[],o=[],i=0;i<n;++i)for(var s=e[i],l=s.length,c,u=0;u<l;++u)(c=s[u])&&(r.push(t.call(c,c.__data__,u,s)),o.push(c));return new Mt(r,o)}function oo(t){return function(){return this.matches(t)}}function io(t){return function(e){return e.matches(t)}}var Ii=Array.prototype.find;function Ai(t){return function(){return Ii.call(this.children,t)}}function Ri(){return this.firstElementChild}function Ni(t){return this.select(t==null?Ri:Ai(typeof t=="function"?t:io(t)))}var Fi=Array.prototype.filter;function Bi(){return Array.from(this.children)}function Ui(t){return function(){return Fi.call(this.children,t)}}function Oi(t){return this.selectAll(t==null?Bi:Ui(typeof t=="function"?t:io(t)))}function Vi(t){typeof t!="function"&&(t=oo(t));for(var e=this._groups,n=e.length,r=new Array(n),o=0;o<n;++o)for(var i=e[o],s=i.length,l=r[o]=[],c,u=0;u<s;++u)(c=i[u])&&t.call(c,c.__data__,u,i)&&l.push(c);return new Mt(r,this._parents)}function so(t){return new Array(t.length)}function zi(){return new Mt(this._enter||this._groups.map(so),this._parents)}function _n(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}_n.prototype={constructor:_n,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function qi(t){return function(){return t}}function Hi(t,e,n,r,o,i){for(var s=0,l,c=e.length,u=i.length;s<u;++s)(l=e[s])?(l.__data__=i[s],r[s]=l):n[s]=new _n(t,i[s]);for(;s<c;++s)(l=e[s])&&(o[s]=l)}function Wi(t,e,n,r,o,i,s){var l,c,u=new Map,d=e.length,h=i.length,p=new Array(d),m;for(l=0;l<d;++l)(c=e[l])&&(p[l]=m=s.call(c,c.__data__,l,e)+"",u.has(m)?o[l]=c:u.set(m,c));for(l=0;l<h;++l)m=s.call(t,i[l],l,i)+"",(c=u.get(m))?(r[l]=c,c.__data__=i[l],u.delete(m)):n[l]=new _n(t,i[l]);for(l=0;l<d;++l)(c=e[l])&&u.get(p[l])===c&&(o[l]=c)}function Yi(t){return t.__data__}function Xi(t,e){if(!arguments.length)return Array.from(this,Yi);var n=e?Wi:Hi,r=this._parents,o=this._groups;typeof t!="function"&&(t=qi(t));for(var i=o.length,s=new Array(i),l=new Array(i),c=new Array(i),u=0;u<i;++u){var d=r[u],h=o[u],p=h.length,m=ji(t.call(d,d&&d.__data__,u,r)),b=m.length,E=l[u]=new Array(b),L=s[u]=new Array(b),x=c[u]=new Array(p);n(d,h,E,L,x,m,e);for(var v=0,T=0,M,k;v<b;++v)if(M=E[v]){for(v>=T&&(T=v+1);!(k=L[T])&&++T<b;);M._next=k||null}}return s=new Mt(s,r),s._enter=l,s._exit=c,s}function ji(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function Gi(){return new Mt(this._exit||this._groups.map(so),this._parents)}function Ki(t,e,n){var r=this.enter(),o=this,i=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(o=e(o),o&&(o=o.selection())),n==null?i.remove():n(i),r&&o?r.merge(o).order():o}function Qi(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,o=n.length,i=r.length,s=Math.min(o,i),l=new Array(o),c=0;c<s;++c)for(var u=n[c],d=r[c],h=u.length,p=l[c]=new Array(h),m,b=0;b<h;++b)(m=u[b]||d[b])&&(p[b]=m);for(;c<o;++c)l[c]=n[c];return new Mt(l,this._parents)}function Zi(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],o=r.length-1,i=r[o],s;--o>=0;)(s=r[o])&&(i&&s.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(s,i),i=s);return this}function Ji(t){t||(t=ts);function e(h,p){return h&&p?t(h.__data__,p.__data__):!h-!p}for(var n=this._groups,r=n.length,o=new Array(r),i=0;i<r;++i){for(var s=n[i],l=s.length,c=o[i]=new Array(l),u,d=0;d<l;++d)(u=s[d])&&(c[d]=u);c.sort(e)}return new Mt(o,this._parents).order()}function ts(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function es(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function ns(){return Array.from(this)}function as(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],o=0,i=r.length;o<i;++o){var s=r[o];if(s)return s}return null}function rs(){let t=0;for(const e of this)++t;return t}function os(){return!this.node()}function is(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var o=e[n],i=0,s=o.length,l;i<s;++i)(l=o[i])&&t.call(l,l.__data__,i,o);return this}function ss(t){return function(){this.removeAttribute(t)}}function ls(t){return function(){this.removeAttributeNS(t.space,t.local)}}function cs(t,e){return function(){this.setAttribute(t,e)}}function us(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function ds(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function fs(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function hs(t,e){var n=Wn(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?ls:ss:typeof e=="function"?n.local?fs:ds:n.local?us:cs)(n,e))}function lo(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function ps(t){return function(){this.style.removeProperty(t)}}function ms(t,e,n){return function(){this.style.setProperty(t,e,n)}}function gs(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function ys(t,e,n){return arguments.length>1?this.each((e==null?ps:typeof e=="function"?gs:ms)(t,e,n??"")):_e(this.node(),t)}function _e(t,e){return t.style.getPropertyValue(e)||lo(t).getComputedStyle(t,null).getPropertyValue(e)}function vs(t){return function(){delete this[t]}}function xs(t,e){return function(){this[t]=e}}function ws(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function bs(t,e){return arguments.length>1?this.each((e==null?vs:typeof e=="function"?ws:xs)(t,e)):this.node()[t]}function co(t){return t.trim().split(/^|\s+/)}function Va(t){return t.classList||new uo(t)}function uo(t){this._node=t,this._names=co(t.getAttribute("class")||"")}uo.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function fo(t,e){for(var n=Va(t),r=-1,o=e.length;++r<o;)n.add(e[r])}function ho(t,e){for(var n=Va(t),r=-1,o=e.length;++r<o;)n.remove(e[r])}function Ss(t){return function(){fo(this,t)}}function Ms(t){return function(){ho(this,t)}}function $s(t,e){return function(){(e.apply(this,arguments)?fo:ho)(this,t)}}function Ts(t,e){var n=co(t+"");if(arguments.length<2){for(var r=Va(this.node()),o=-1,i=n.length;++o<i;)if(!r.contains(n[o]))return!1;return!0}return this.each((typeof e=="function"?$s:e?Ss:Ms)(n,e))}function ks(){this.textContent=""}function Ls(t){return function(){this.textContent=t}}function Ds(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function _s(t){return arguments.length?this.each(t==null?ks:(typeof t=="function"?Ds:Ls)(t)):this.node().textContent}function Es(){this.innerHTML=""}function Cs(t){return function(){this.innerHTML=t}}function Ps(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function Is(t){return arguments.length?this.each(t==null?Es:(typeof t=="function"?Ps:Cs)(t)):this.node().innerHTML}function As(){this.nextSibling&&this.parentNode.appendChild(this)}function Rs(){return this.each(As)}function Ns(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Fs(){return this.each(Ns)}function Bs(t){var e=typeof t=="function"?t:ao(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function Us(){return null}function Os(t,e){var n=typeof t=="function"?t:ao(t),r=e==null?Us:typeof e=="function"?e:Oa(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function Vs(){var t=this.parentNode;t&&t.removeChild(this)}function zs(){return this.each(Vs)}function qs(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Hs(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Ws(t){return this.select(t?Hs:qs)}function Ys(t){return arguments.length?this.property("__data__",t):this.node().__data__}function Xs(t){return function(e){t.call(this,e,this.__data__)}}function js(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function Gs(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,o=e.length,i;n<o;++n)i=e[n],(!t.type||i.type===t.type)&&i.name===t.name?this.removeEventListener(i.type,i.listener,i.options):e[++r]=i;++r?e.length=r:delete this.__on}}}function Ks(t,e,n){return function(){var r=this.__on,o,i=Xs(e);if(r){for(var s=0,l=r.length;s<l;++s)if((o=r[s]).type===t.type&&o.name===t.name){this.removeEventListener(o.type,o.listener,o.options),this.addEventListener(o.type,o.listener=i,o.options=n),o.value=e;return}}this.addEventListener(t.type,i,n),o={type:t.type,name:t.name,value:e,listener:i,options:n},r?r.push(o):this.__on=[o]}}function Qs(t,e,n){var r=js(t+""),o,i=r.length,s;if(arguments.length<2){var l=this.node().__on;if(l){for(var c=0,u=l.length,d;c<u;++c)for(o=0,d=l[c];o<i;++o)if((s=r[o]).type===d.type&&s.name===d.name)return d.value}return}for(l=e?Ks:Gs,o=0;o<i;++o)this.each(l(r[o],e,n));return this}function po(t,e,n){var r=lo(t),o=r.CustomEvent;typeof o=="function"?o=new o(e,n):(o=r.document.createEvent("Event"),n?(o.initEvent(e,n.bubbles,n.cancelable),o.detail=n.detail):o.initEvent(e,!1,!1)),t.dispatchEvent(o)}function Zs(t,e){return function(){return po(this,t,e)}}function Js(t,e){return function(){return po(this,t,e.apply(this,arguments))}}function tl(t,e){return this.each((typeof e=="function"?Js:Zs)(t,e))}function*el(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],o=0,i=r.length,s;o<i;++o)(s=r[o])&&(yield s)}var mo=[null];function Mt(t,e){this._groups=t,this._parents=e}function tn(){return new Mt([[document.documentElement]],mo)}function nl(){return this}Mt.prototype=tn.prototype={constructor:Mt,select:Di,selectAll:Pi,selectChild:Ni,selectChildren:Oi,filter:Vi,data:Xi,enter:zi,exit:Gi,join:Ki,merge:Qi,selection:nl,order:Zi,sort:Ji,call:es,nodes:ns,node:as,size:rs,empty:os,each:is,attr:hs,style:ys,property:bs,classed:Ts,text:_s,html:Is,raise:Rs,lower:Fs,append:Bs,insert:Os,remove:zs,clone:Ws,datum:Ys,on:Qs,dispatch:tl,[Symbol.iterator]:el};function Ot(t){return typeof t=="string"?new Mt([[document.querySelector(t)]],[document.documentElement]):new Mt([[t]],mo)}function al(t){let e;for(;e=t.sourceEvent;)t=e;return t}function Qt(t,e){if(t=al(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var o=e.getBoundingClientRect();return[t.clientX-o.left-e.clientLeft,t.clientY-o.top-e.clientTop]}}return[t.pageX,t.pageY]}const ya={capture:!0,passive:!1};function va(t){t.preventDefault(),t.stopImmediatePropagation()}function rl(t){var e=t.document.documentElement,n=Ot(t).on("dragstart.drag",va,ya);"onselectstart"in e?n.on("selectstart.drag",va,ya):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function ol(t,e){var n=t.document.documentElement,r=Ot(t).on("dragstart.drag",null);e&&(r.on("click.drag",va,ya),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}function za(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function go(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function en(){}var We=.7,En=1/We,ke="\\s*([+-]?\\d+)\\s*",Ye="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",It="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",il=/^#([0-9a-f]{3,8})$/,sl=new RegExp(`^rgb\\(${ke},${ke},${ke}\\)$`),ll=new RegExp(`^rgb\\(${It},${It},${It}\\)$`),cl=new RegExp(`^rgba\\(${ke},${ke},${ke},${Ye}\\)$`),ul=new RegExp(`^rgba\\(${It},${It},${It},${Ye}\\)$`),dl=new RegExp(`^hsl\\(${Ye},${It},${It}\\)$`),fl=new RegExp(`^hsla\\(${Ye},${It},${It},${Ye}\\)$`),lr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};za(en,pe,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:cr,formatHex:cr,formatHex8:hl,formatHsl:pl,formatRgb:ur,toString:ur});function cr(){return this.rgb().formatHex()}function hl(){return this.rgb().formatHex8()}function pl(){return yo(this).formatHsl()}function ur(){return this.rgb().formatRgb()}function pe(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=il.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?dr(e):n===3?new wt(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?cn(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?cn(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=sl.exec(t))?new wt(e[1],e[2],e[3],1):(e=ll.exec(t))?new wt(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=cl.exec(t))?cn(e[1],e[2],e[3],e[4]):(e=ul.exec(t))?cn(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=dl.exec(t))?pr(e[1],e[2]/100,e[3]/100,1):(e=fl.exec(t))?pr(e[1],e[2]/100,e[3]/100,e[4]):lr.hasOwnProperty(t)?dr(lr[t]):t==="transparent"?new wt(NaN,NaN,NaN,0):null}function dr(t){return new wt(t>>16&255,t>>8&255,t&255,1)}function cn(t,e,n,r){return r<=0&&(t=e=n=NaN),new wt(t,e,n,r)}function ml(t){return t instanceof en||(t=pe(t)),t?(t=t.rgb(),new wt(t.r,t.g,t.b,t.opacity)):new wt}function xa(t,e,n,r){return arguments.length===1?ml(t):new wt(t,e,n,r??1)}function wt(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}za(wt,xa,go(en,{brighter(t){return t=t==null?En:Math.pow(En,t),new wt(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?We:Math.pow(We,t),new wt(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new wt(he(this.r),he(this.g),he(this.b),Cn(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:fr,formatHex:fr,formatHex8:gl,formatRgb:hr,toString:hr}));function fr(){return`#${ue(this.r)}${ue(this.g)}${ue(this.b)}`}function gl(){return`#${ue(this.r)}${ue(this.g)}${ue(this.b)}${ue((isNaN(this.opacity)?1:this.opacity)*255)}`}function hr(){const t=Cn(this.opacity);return`${t===1?"rgb(":"rgba("}${he(this.r)}, ${he(this.g)}, ${he(this.b)}${t===1?")":`, ${t})`}`}function Cn(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function he(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function ue(t){return t=he(t),(t<16?"0":"")+t.toString(16)}function pr(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Dt(t,e,n,r)}function yo(t){if(t instanceof Dt)return new Dt(t.h,t.s,t.l,t.opacity);if(t instanceof en||(t=pe(t)),!t)return new Dt;if(t instanceof Dt)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,o=Math.min(e,n,r),i=Math.max(e,n,r),s=NaN,l=i-o,c=(i+o)/2;return l?(e===i?s=(n-r)/l+(n<r)*6:n===i?s=(r-e)/l+2:s=(e-n)/l+4,l/=c<.5?i+o:2-i-o,s*=60):l=c>0&&c<1?0:s,new Dt(s,l,c,t.opacity)}function yl(t,e,n,r){return arguments.length===1?yo(t):new Dt(t,e,n,r??1)}function Dt(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}za(Dt,yl,go(en,{brighter(t){return t=t==null?En:Math.pow(En,t),new Dt(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?We:Math.pow(We,t),new Dt(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,o=2*n-r;return new wt(na(t>=240?t-240:t+120,o,r),na(t,o,r),na(t<120?t+240:t-120,o,r),this.opacity)},clamp(){return new Dt(mr(this.h),un(this.s),un(this.l),Cn(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Cn(this.opacity);return`${t===1?"hsl(":"hsla("}${mr(this.h)}, ${un(this.s)*100}%, ${un(this.l)*100}%${t===1?")":`, ${t})`}`}}));function mr(t){return t=(t||0)%360,t<0?t+360:t}function un(t){return Math.max(0,Math.min(1,t||0))}function na(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const qa=t=>()=>t;function vl(t,e){return function(n){return t+n*e}}function xl(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function wl(t){return(t=+t)==1?vo:function(e,n){return n-e?xl(e,n,t):qa(isNaN(e)?n:e)}}function vo(t,e){var n=e-t;return n?vl(t,n):qa(isNaN(t)?e:t)}const Pn=(function t(e){var n=wl(e);function r(o,i){var s=n((o=xa(o)).r,(i=xa(i)).r),l=n(o.g,i.g),c=n(o.b,i.b),u=vo(o.opacity,i.opacity);return function(d){return o.r=s(d),o.g=l(d),o.b=c(d),o.opacity=u(d),o+""}}return r.gamma=t,r})(1);function bl(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),o;return function(i){for(o=0;o<n;++o)r[o]=t[o]*(1-i)+e[o]*i;return r}}function Sl(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Ml(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,o=new Array(r),i=new Array(n),s;for(s=0;s<r;++s)o[s]=Ha(t[s],e[s]);for(;s<n;++s)i[s]=e[s];return function(l){for(s=0;s<r;++s)i[s]=o[s](l);return i}}function $l(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function Lt(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function Tl(t,e){var n={},r={},o;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(o in e)o in t?n[o]=Ha(t[o],e[o]):r[o]=e[o];return function(i){for(o in n)r[o]=n[o](i);return r}}var wa=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,aa=new RegExp(wa.source,"g");function kl(t){return function(){return t}}function Ll(t){return function(e){return t(e)+""}}function xo(t,e){var n=wa.lastIndex=aa.lastIndex=0,r,o,i,s=-1,l=[],c=[];for(t=t+"",e=e+"";(r=wa.exec(t))&&(o=aa.exec(e));)(i=o.index)>n&&(i=e.slice(n,i),l[s]?l[s]+=i:l[++s]=i),(r=r[0])===(o=o[0])?l[s]?l[s]+=o:l[++s]=o:(l[++s]=null,c.push({i:s,x:Lt(r,o)})),n=aa.lastIndex;return n<e.length&&(i=e.slice(n),l[s]?l[s]+=i:l[++s]=i),l.length<2?c[0]?Ll(c[0].x):kl(e):(e=c.length,function(u){for(var d=0,h;d<e;++d)l[(h=c[d]).i]=h.x(u);return l.join("")})}function Ha(t,e){var n=typeof e,r;return e==null||n==="boolean"?qa(e):(n==="number"?Lt:n==="string"?(r=pe(e))?(e=r,Pn):xo:e instanceof pe?Pn:e instanceof Date?$l:Sl(e)?bl:Array.isArray(e)?Ml:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?Tl:Lt)(t,e)}function Dl(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var gr=180/Math.PI,ba={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function wo(t,e,n,r,o,i){var s,l,c;return(s=Math.sqrt(t*t+e*e))&&(t/=s,e/=s),(c=t*n+e*r)&&(n-=t*c,r-=e*c),(l=Math.sqrt(n*n+r*r))&&(n/=l,r/=l,c/=l),t*r<e*n&&(t=-t,e=-e,c=-c,s=-s),{translateX:o,translateY:i,rotate:Math.atan2(e,t)*gr,skewX:Math.atan(c)*gr,scaleX:s,scaleY:l}}var dn;function _l(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?ba:wo(e.a,e.b,e.c,e.d,e.e,e.f)}function El(t){return t==null||(dn||(dn=document.createElementNS("http://www.w3.org/2000/svg","g")),dn.setAttribute("transform",t),!(t=dn.transform.baseVal.consolidate()))?ba:(t=t.matrix,wo(t.a,t.b,t.c,t.d,t.e,t.f))}function bo(t,e,n,r){function o(u){return u.length?u.pop()+" ":""}function i(u,d,h,p,m,b){if(u!==h||d!==p){var E=m.push("translate(",null,e,null,n);b.push({i:E-4,x:Lt(u,h)},{i:E-2,x:Lt(d,p)})}else(h||p)&&m.push("translate("+h+e+p+n)}function s(u,d,h,p){u!==d?(u-d>180?d+=360:d-u>180&&(u+=360),p.push({i:h.push(o(h)+"rotate(",null,r)-2,x:Lt(u,d)})):d&&h.push(o(h)+"rotate("+d+r)}function l(u,d,h,p){u!==d?p.push({i:h.push(o(h)+"skewX(",null,r)-2,x:Lt(u,d)}):d&&h.push(o(h)+"skewX("+d+r)}function c(u,d,h,p,m,b){if(u!==h||d!==p){var E=m.push(o(m)+"scale(",null,",",null,")");b.push({i:E-4,x:Lt(u,h)},{i:E-2,x:Lt(d,p)})}else(h!==1||p!==1)&&m.push(o(m)+"scale("+h+","+p+")")}return function(u,d){var h=[],p=[];return u=t(u),d=t(d),i(u.translateX,u.translateY,d.translateX,d.translateY,h,p),s(u.rotate,d.rotate,h,p),l(u.skewX,d.skewX,h,p),c(u.scaleX,u.scaleY,d.scaleX,d.scaleY,h,p),u=d=null,function(m){for(var b=-1,E=p.length,L;++b<E;)h[(L=p[b]).i]=L.x(m);return h.join("")}}}var Cl=bo(_l,"px, ","px)","deg)"),Pl=bo(El,", ",")",")"),Il=1e-12;function yr(t){return((t=Math.exp(t))+1/t)/2}function Al(t){return((t=Math.exp(t))-1/t)/2}function Rl(t){return((t=Math.exp(2*t))-1)/(t+1)}const Nl=(function t(e,n,r){function o(i,s){var l=i[0],c=i[1],u=i[2],d=s[0],h=s[1],p=s[2],m=d-l,b=h-c,E=m*m+b*b,L,x;if(E<Il)x=Math.log(p/u)/e,L=function(A){return[l+A*m,c+A*b,u*Math.exp(e*A*x)]};else{var v=Math.sqrt(E),T=(p*p-u*u+r*E)/(2*u*n*v),M=(p*p-u*u-r*E)/(2*p*n*v),k=Math.log(Math.sqrt(T*T+1)-T),w=Math.log(Math.sqrt(M*M+1)-M);x=(w-k)/e,L=function(A){var O=A*x,W=yr(k),z=u/(n*v)*(W*Rl(e*O+k)-Al(k));return[l+z*m,c+z*b,u*W/yr(e*O+k)]}}return L.duration=x*1e3*e/Math.SQRT2,L}return o.rho=function(i){var s=Math.max(.001,+i),l=s*s,c=l*l;return t(s,l,c)},o})(Math.SQRT2,2,4);var Ee=0,Oe=0,Ae=0,So=1e3,In,Ve,An=0,me=0,Yn=0,Xe=typeof performance=="object"&&performance.now?performance:Date,Mo=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Wa(){return me||(Mo(Fl),me=Xe.now()+Yn)}function Fl(){me=0}function Rn(){this._call=this._time=this._next=null}Rn.prototype=$o.prototype={constructor:Rn,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?Wa():+n)+(e==null?0:+e),!this._next&&Ve!==this&&(Ve?Ve._next=this:In=this,Ve=this),this._call=t,this._time=n,Sa()},stop:function(){this._call&&(this._call=null,this._time=1/0,Sa())}};function $o(t,e,n){var r=new Rn;return r.restart(t,e,n),r}function Bl(){Wa(),++Ee;for(var t=In,e;t;)(e=me-t._time)>=0&&t._call.call(void 0,e),t=t._next;--Ee}function vr(){me=(An=Xe.now())+Yn,Ee=Oe=0;try{Bl()}finally{Ee=0,Ol(),me=0}}function Ul(){var t=Xe.now(),e=t-An;e>So&&(Yn-=e,An=t)}function Ol(){for(var t,e=In,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:In=n);Ve=t,Sa(r)}function Sa(t){if(!Ee){Oe&&(Oe=clearTimeout(Oe));var e=t-me;e>24?(t<1/0&&(Oe=setTimeout(vr,t-Xe.now()-Yn)),Ae&&(Ae=clearInterval(Ae))):(Ae||(An=Xe.now(),Ae=setInterval(Ul,So)),Ee=1,Mo(vr))}}function xr(t,e,n){var r=new Rn;return e=e==null?0:+e,r.restart(o=>{r.stop(),t(o+e)},e,n),r}var Vl=Ua("start","end","cancel","interrupt"),zl=[],To=0,wr=1,Ma=2,wn=3,br=4,$a=5,bn=6;function Xn(t,e,n,r,o,i){var s=t.__transition;if(!s)t.__transition={};else if(n in s)return;ql(t,n,{name:e,index:r,group:o,on:Vl,tween:zl,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:To})}function Ya(t,e){var n=Et(t,e);if(n.state>To)throw new Error("too late; already scheduled");return n}function At(t,e){var n=Et(t,e);if(n.state>wn)throw new Error("too late; already running");return n}function Et(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function ql(t,e,n){var r=t.__transition,o;r[e]=n,n.timer=$o(i,0,n.time);function i(u){n.state=wr,n.timer.restart(s,n.delay,n.time),n.delay<=u&&s(u-n.delay)}function s(u){var d,h,p,m;if(n.state!==wr)return c();for(d in r)if(m=r[d],m.name===n.name){if(m.state===wn)return xr(s);m.state===br?(m.state=bn,m.timer.stop(),m.on.call("interrupt",t,t.__data__,m.index,m.group),delete r[d]):+d<e&&(m.state=bn,m.timer.stop(),m.on.call("cancel",t,t.__data__,m.index,m.group),delete r[d])}if(xr(function(){n.state===wn&&(n.state=br,n.timer.restart(l,n.delay,n.time),l(u))}),n.state=Ma,n.on.call("start",t,t.__data__,n.index,n.group),n.state===Ma){for(n.state=wn,o=new Array(p=n.tween.length),d=0,h=-1;d<p;++d)(m=n.tween[d].value.call(t,t.__data__,n.index,n.group))&&(o[++h]=m);o.length=h+1}}function l(u){for(var d=u<n.duration?n.ease.call(null,u/n.duration):(n.timer.restart(c),n.state=$a,1),h=-1,p=o.length;++h<p;)o[h].call(t,d);n.state===$a&&(n.on.call("end",t,t.__data__,n.index,n.group),c())}function c(){n.state=bn,n.timer.stop(),delete r[e];for(var u in r)return;delete t.__transition}}function Sn(t,e){var n=t.__transition,r,o,i=!0,s;if(n){e=e==null?null:e+"";for(s in n){if((r=n[s]).name!==e){i=!1;continue}o=r.state>Ma&&r.state<$a,r.state=bn,r.timer.stop(),r.on.call(o?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[s]}i&&delete t.__transition}}function Hl(t){return this.each(function(){Sn(this,t)})}function Wl(t,e){var n,r;return function(){var o=At(this,t),i=o.tween;if(i!==n){r=n=i;for(var s=0,l=r.length;s<l;++s)if(r[s].name===e){r=r.slice(),r.splice(s,1);break}}o.tween=r}}function Yl(t,e,n){var r,o;if(typeof n!="function")throw new Error;return function(){var i=At(this,t),s=i.tween;if(s!==r){o=(r=s).slice();for(var l={name:e,value:n},c=0,u=o.length;c<u;++c)if(o[c].name===e){o[c]=l;break}c===u&&o.push(l)}i.tween=o}}function Xl(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=Et(this.node(),n).tween,o=0,i=r.length,s;o<i;++o)if((s=r[o]).name===t)return s.value;return null}return this.each((e==null?Wl:Yl)(n,t,e))}function Xa(t,e,n){var r=t._id;return t.each(function(){var o=At(this,r);(o.value||(o.value={}))[e]=n.apply(this,arguments)}),function(o){return Et(o,r).value[e]}}function ko(t,e){var n;return(typeof e=="number"?Lt:e instanceof pe?Pn:(n=pe(e))?(e=n,Pn):xo)(t,e)}function jl(t){return function(){this.removeAttribute(t)}}function Gl(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Kl(t,e,n){var r,o=n+"",i;return function(){var s=this.getAttribute(t);return s===o?null:s===r?i:i=e(r=s,n)}}function Ql(t,e,n){var r,o=n+"",i;return function(){var s=this.getAttributeNS(t.space,t.local);return s===o?null:s===r?i:i=e(r=s,n)}}function Zl(t,e,n){var r,o,i;return function(){var s,l=n(this),c;return l==null?void this.removeAttribute(t):(s=this.getAttribute(t),c=l+"",s===c?null:s===r&&c===o?i:(o=c,i=e(r=s,l)))}}function Jl(t,e,n){var r,o,i;return function(){var s,l=n(this),c;return l==null?void this.removeAttributeNS(t.space,t.local):(s=this.getAttributeNS(t.space,t.local),c=l+"",s===c?null:s===r&&c===o?i:(o=c,i=e(r=s,l)))}}function tc(t,e){var n=Wn(t),r=n==="transform"?Pl:ko;return this.attrTween(t,typeof e=="function"?(n.local?Jl:Zl)(n,r,Xa(this,"attr."+t,e)):e==null?(n.local?Gl:jl)(n):(n.local?Ql:Kl)(n,r,e))}function ec(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function nc(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function ac(t,e){var n,r;function o(){var i=e.apply(this,arguments);return i!==r&&(n=(r=i)&&nc(t,i)),n}return o._value=e,o}function rc(t,e){var n,r;function o(){var i=e.apply(this,arguments);return i!==r&&(n=(r=i)&&ec(t,i)),n}return o._value=e,o}function oc(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=Wn(t);return this.tween(n,(r.local?ac:rc)(r,e))}function ic(t,e){return function(){Ya(this,t).delay=+e.apply(this,arguments)}}function sc(t,e){return e=+e,function(){Ya(this,t).delay=e}}function lc(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?ic:sc)(e,t)):Et(this.node(),e).delay}function cc(t,e){return function(){At(this,t).duration=+e.apply(this,arguments)}}function uc(t,e){return e=+e,function(){At(this,t).duration=e}}function dc(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?cc:uc)(e,t)):Et(this.node(),e).duration}function fc(t,e){if(typeof e!="function")throw new Error;return function(){At(this,t).ease=e}}function hc(t){var e=this._id;return arguments.length?this.each(fc(e,t)):Et(this.node(),e).ease}function pc(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;At(this,t).ease=n}}function mc(t){if(typeof t!="function")throw new Error;return this.each(pc(this._id,t))}function gc(t){typeof t!="function"&&(t=oo(t));for(var e=this._groups,n=e.length,r=new Array(n),o=0;o<n;++o)for(var i=e[o],s=i.length,l=r[o]=[],c,u=0;u<s;++u)(c=i[u])&&t.call(c,c.__data__,u,i)&&l.push(c);return new Xt(r,this._parents,this._name,this._id)}function yc(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,o=n.length,i=Math.min(r,o),s=new Array(r),l=0;l<i;++l)for(var c=e[l],u=n[l],d=c.length,h=s[l]=new Array(d),p,m=0;m<d;++m)(p=c[m]||u[m])&&(h[m]=p);for(;l<r;++l)s[l]=e[l];return new Xt(s,this._parents,this._name,this._id)}function vc(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function xc(t,e,n){var r,o,i=vc(e)?Ya:At;return function(){var s=i(this,t),l=s.on;l!==r&&(o=(r=l).copy()).on(e,n),s.on=o}}function wc(t,e){var n=this._id;return arguments.length<2?Et(this.node(),n).on.on(t):this.each(xc(n,t,e))}function bc(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function Sc(){return this.on("end.remove",bc(this._id))}function Mc(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Oa(t));for(var r=this._groups,o=r.length,i=new Array(o),s=0;s<o;++s)for(var l=r[s],c=l.length,u=i[s]=new Array(c),d,h,p=0;p<c;++p)(d=l[p])&&(h=t.call(d,d.__data__,p,l))&&("__data__"in d&&(h.__data__=d.__data__),u[p]=h,Xn(u[p],e,n,p,u,Et(d,n)));return new Xt(i,this._parents,e,n)}function $c(t){var e=this._name,n=this._id;typeof t!="function"&&(t=ro(t));for(var r=this._groups,o=r.length,i=[],s=[],l=0;l<o;++l)for(var c=r[l],u=c.length,d,h=0;h<u;++h)if(d=c[h]){for(var p=t.call(d,d.__data__,h,c),m,b=Et(d,n),E=0,L=p.length;E<L;++E)(m=p[E])&&Xn(m,e,n,E,p,b);i.push(p),s.push(d)}return new Xt(i,s,e,n)}var Tc=tn.prototype.constructor;function kc(){return new Tc(this._groups,this._parents)}function Lc(t,e){var n,r,o;return function(){var i=_e(this,t),s=(this.style.removeProperty(t),_e(this,t));return i===s?null:i===n&&s===r?o:o=e(n=i,r=s)}}function Lo(t){return function(){this.style.removeProperty(t)}}function Dc(t,e,n){var r,o=n+"",i;return function(){var s=_e(this,t);return s===o?null:s===r?i:i=e(r=s,n)}}function _c(t,e,n){var r,o,i;return function(){var s=_e(this,t),l=n(this),c=l+"";return l==null&&(c=l=(this.style.removeProperty(t),_e(this,t))),s===c?null:s===r&&c===o?i:(o=c,i=e(r=s,l))}}function Ec(t,e){var n,r,o,i="style."+e,s="end."+i,l;return function(){var c=At(this,t),u=c.on,d=c.value[i]==null?l||(l=Lo(e)):void 0;(u!==n||o!==d)&&(r=(n=u).copy()).on(s,o=d),c.on=r}}function Cc(t,e,n){var r=(t+="")=="transform"?Cl:ko;return e==null?this.styleTween(t,Lc(t,r)).on("end.style."+t,Lo(t)):typeof e=="function"?this.styleTween(t,_c(t,r,Xa(this,"style."+t,e))).each(Ec(this._id,t)):this.styleTween(t,Dc(t,r,e),n).on("end.style."+t,null)}function Pc(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function Ic(t,e,n){var r,o;function i(){var s=e.apply(this,arguments);return s!==o&&(r=(o=s)&&Pc(t,s,n)),r}return i._value=e,i}function Ac(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,Ic(t,e,n??""))}function Rc(t){return function(){this.textContent=t}}function Nc(t){return function(){var e=t(this);this.textContent=e??""}}function Fc(t){return this.tween("text",typeof t=="function"?Nc(Xa(this,"text",t)):Rc(t==null?"":t+""))}function Bc(t){return function(e){this.textContent=t.call(this,e)}}function Uc(t){var e,n;function r(){var o=t.apply(this,arguments);return o!==n&&(e=(n=o)&&Bc(o)),e}return r._value=t,r}function Oc(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,Uc(t))}function Vc(){for(var t=this._name,e=this._id,n=Do(),r=this._groups,o=r.length,i=0;i<o;++i)for(var s=r[i],l=s.length,c,u=0;u<l;++u)if(c=s[u]){var d=Et(c,e);Xn(c,t,n,u,s,{time:d.time+d.delay+d.duration,delay:0,duration:d.duration,ease:d.ease})}return new Xt(r,this._parents,t,n)}function zc(){var t,e,n=this,r=n._id,o=n.size();return new Promise(function(i,s){var l={value:s},c={value:function(){--o===0&&i()}};n.each(function(){var u=At(this,r),d=u.on;d!==t&&(e=(t=d).copy(),e._.cancel.push(l),e._.interrupt.push(l),e._.end.push(c)),u.on=e}),o===0&&i()})}var qc=0;function Xt(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function Do(){return++qc}var Nt=tn.prototype;Xt.prototype={constructor:Xt,select:Mc,selectAll:$c,selectChild:Nt.selectChild,selectChildren:Nt.selectChildren,filter:gc,merge:yc,selection:kc,transition:Vc,call:Nt.call,nodes:Nt.nodes,node:Nt.node,size:Nt.size,empty:Nt.empty,each:Nt.each,on:wc,attr:tc,attrTween:oc,style:Cc,styleTween:Ac,text:Fc,textTween:Oc,remove:Sc,tween:Xl,delay:lc,duration:dc,ease:hc,easeVarying:mc,end:zc,[Symbol.iterator]:Nt[Symbol.iterator]};function Hc(t){return--t*t*t+1}function Wc(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var Yc={time:null,delay:0,duration:250,ease:Wc};function Xc(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function jc(t){var e,n;t instanceof Xt?(e=t._id,t=t._name):(e=Do(),(n=Yc).time=Wa(),t=t==null?null:t+"");for(var r=this._groups,o=r.length,i=0;i<o;++i)for(var s=r[i],l=s.length,c,u=0;u<l;++u)(c=s[u])&&Xn(c,t,e,u,s,n||Xc(c,e));return new Xt(r,this._parents,t,e)}tn.prototype.interrupt=Hl;tn.prototype.transition=jc;function Gc(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function Nn(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function Ce(t){return t=Nn(Math.abs(t)),t?t[1]:NaN}function Kc(t,e){return function(n,r){for(var o=n.length,i=[],s=0,l=t[0],c=0;o>0&&l>0&&(c+l+1>r&&(l=Math.max(1,r-c)),i.push(n.substring(o-=l,o+l)),!((c+=l+1)>r));)l=t[s=(s+1)%t.length];return i.reverse().join(e)}}function Qc(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var Zc=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Fn(t){if(!(e=Zc.exec(t)))throw new Error("invalid format: "+t);var e;return new ja({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Fn.prototype=ja.prototype;function ja(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}ja.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Jc(t){t:for(var e=t.length,n=1,r=-1,o;n<e;++n)switch(t[n]){case".":r=o=n;break;case"0":r===0&&(r=n),o=n;break;default:if(!+t[n])break t;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(o+1):t}var _o;function tu(t,e){var n=Nn(t,e);if(!n)return t+"";var r=n[0],o=n[1],i=o-(_o=Math.max(-8,Math.min(8,Math.floor(o/3)))*3)+1,s=r.length;return i===s?r:i>s?r+new Array(i-s+1).join("0"):i>0?r.slice(0,i)+"."+r.slice(i):"0."+new Array(1-i).join("0")+Nn(t,Math.max(0,e+i-1))[0]}function Sr(t,e){var n=Nn(t,e);if(!n)return t+"";var r=n[0],o=n[1];return o<0?"0."+new Array(-o).join("0")+r:r.length>o+1?r.slice(0,o+1)+"."+r.slice(o+1):r+new Array(o-r.length+2).join("0")}const Mr={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:Gc,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Sr(t*100,e),r:Sr,s:tu,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function $r(t){return t}var Tr=Array.prototype.map,kr=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function eu(t){var e=t.grouping===void 0||t.thousands===void 0?$r:Kc(Tr.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",o=t.decimal===void 0?".":t.decimal+"",i=t.numerals===void 0?$r:Qc(Tr.call(t.numerals,String)),s=t.percent===void 0?"%":t.percent+"",l=t.minus===void 0?"−":t.minus+"",c=t.nan===void 0?"NaN":t.nan+"";function u(h){h=Fn(h);var p=h.fill,m=h.align,b=h.sign,E=h.symbol,L=h.zero,x=h.width,v=h.comma,T=h.precision,M=h.trim,k=h.type;k==="n"?(v=!0,k="g"):Mr[k]||(T===void 0&&(T=12),M=!0,k="g"),(L||p==="0"&&m==="=")&&(L=!0,p="0",m="=");var w=E==="$"?n:E==="#"&&/[boxX]/.test(k)?"0"+k.toLowerCase():"",A=E==="$"?r:/[%p]/.test(k)?s:"",O=Mr[k],W=/[defgprs%]/.test(k);T=T===void 0?6:/[gprs]/.test(k)?Math.max(1,Math.min(21,T)):Math.max(0,Math.min(20,T));function z(N){var G=w,B=A,f,g,y;if(k==="c")B=O(N)+B,N="";else{N=+N;var D=N<0||1/N<0;if(N=isNaN(N)?c:O(Math.abs(N),T),M&&(N=Jc(N)),D&&+N==0&&b!=="+"&&(D=!1),G=(D?b==="("?b:l:b==="-"||b==="("?"":b)+G,B=(k==="s"?kr[8+_o/3]:"")+B+(D&&b==="("?")":""),W){for(f=-1,g=N.length;++f<g;)if(y=N.charCodeAt(f),48>y||y>57){B=(y===46?o+N.slice(f+1):N.slice(f))+B,N=N.slice(0,f);break}}}v&&!L&&(N=e(N,1/0));var P=G.length+N.length+B.length,_=P<x?new Array(x-P+1).join(p):"";switch(v&&L&&(N=e(_+N,_.length?x-B.length:1/0),_=""),m){case"<":N=G+N+B+_;break;case"=":N=G+_+N+B;break;case"^":N=_.slice(0,P=_.length>>1)+G+N+B+_.slice(P);break;default:N=_+G+N+B;break}return i(N)}return z.toString=function(){return h+""},z}function d(h,p){var m=u((h=Fn(h),h.type="f",h)),b=Math.max(-8,Math.min(8,Math.floor(Ce(p)/3)))*3,E=Math.pow(10,-b),L=kr[8+b/3];return function(x){return m(E*x)+L}}return{format:u,formatPrefix:d}}var fn,Eo,Co;nu({thousands:",",grouping:[3],currency:["$",""]});function nu(t){return fn=eu(t),Eo=fn.format,Co=fn.formatPrefix,fn}function au(t){return Math.max(0,-Ce(Math.abs(t)))}function ru(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Ce(e)/3)))*3-Ce(Math.abs(t)))}function ou(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Ce(e)-Ce(t))+1}function Po(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function iu(t){return function(){return t}}function su(t){return+t}var Lr=[0,1];function Se(t){return t}function Ta(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:iu(isNaN(e)?NaN:.5)}function lu(t,e){var n;return t>e&&(n=t,t=e,e=n),function(r){return Math.max(t,Math.min(e,r))}}function cu(t,e,n){var r=t[0],o=t[1],i=e[0],s=e[1];return o<r?(r=Ta(o,r),i=n(s,i)):(r=Ta(r,o),i=n(i,s)),function(l){return i(r(l))}}function uu(t,e,n){var r=Math.min(t.length,e.length)-1,o=new Array(r),i=new Array(r),s=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++s<r;)o[s]=Ta(t[s],t[s+1]),i[s]=n(e[s],e[s+1]);return function(l){var c=pi(t,l,1,r)-1;return i[c](o[c](l))}}function Io(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function du(){var t=Lr,e=Lr,n=Ha,r,o,i,s=Se,l,c,u;function d(){var p=Math.min(t.length,e.length);return s!==Se&&(s=lu(t[0],t[p-1])),l=p>2?uu:cu,c=u=null,h}function h(p){return p==null||isNaN(p=+p)?i:(c||(c=l(t.map(r),e,n)))(r(s(p)))}return h.invert=function(p){return s(o((u||(u=l(e,t.map(r),Lt)))(p)))},h.domain=function(p){return arguments.length?(t=Array.from(p,su),d()):t.slice()},h.range=function(p){return arguments.length?(e=Array.from(p),d()):e.slice()},h.rangeRound=function(p){return e=Array.from(p),n=Dl,d()},h.clamp=function(p){return arguments.length?(s=p?!0:Se,d()):s!==Se},h.interpolate=function(p){return arguments.length?(n=p,d()):n},h.unknown=function(p){return arguments.length?(i=p,h):i},function(p,m){return r=p,o=m,d()}}function Ao(){return du()(Se,Se)}function fu(t,e,n,r){var o=ma(t,e,n),i;switch(r=Fn(r??",f"),r.type){case"s":{var s=Math.max(Math.abs(t),Math.abs(e));return r.precision==null&&!isNaN(i=ru(o,s))&&(r.precision=i),Co(r,s)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(i=ou(o,Math.max(Math.abs(t),Math.abs(e))))&&(r.precision=i-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(i=au(o))&&(r.precision=i-(r.type==="%")*2);break}}return Eo(r)}function hu(t){var e=t.domain;return t.ticks=function(n){var r=e();return vi(r[0],r[r.length-1],n??10)},t.tickFormat=function(n,r){var o=e();return fu(o[0],o[o.length-1],n??10,r)},t.nice=function(n){n==null&&(n=10);var r=e(),o=0,i=r.length-1,s=r[o],l=r[i],c,u,d=10;for(l<s&&(u=s,s=l,l=u,u=o,o=i,i=u);d-- >0;){if(u=pa(s,l,n),u===c)return r[o]=s,r[i]=l,e(r);if(u>0)s=Math.floor(s/u)*u,l=Math.ceil(l/u)*u;else if(u<0)s=Math.ceil(s*u)/u,l=Math.floor(l*u)/u;else break;c=u}return t},t}function jn(){var t=Ao();return t.copy=function(){return Io(t,jn())},Po.apply(t,arguments),hu(t)}function pu(t,e){t=t.slice();var n=0,r=t.length-1,o=t[n],i=t[r],s;return i<o&&(s=n,n=r,r=s,s=o,o=i,i=s),t[n]=e.floor(o),t[r]=e.ceil(i),t}const ra=new Date,oa=new Date;function ct(t,e,n,r){function o(i){return t(i=arguments.length===0?new Date:new Date(+i)),i}return o.floor=i=>(t(i=new Date(+i)),i),o.ceil=i=>(t(i=new Date(i-1)),e(i,1),t(i),i),o.round=i=>{const s=o(i),l=o.ceil(i);return i-s<l-i?s:l},o.offset=(i,s)=>(e(i=new Date(+i),s==null?1:Math.floor(s)),i),o.range=(i,s,l)=>{const c=[];if(i=o.ceil(i),l=l==null?1:Math.floor(l),!(i<s)||!(l>0))return c;let u;do c.push(u=new Date(+i)),e(i,l),t(i);while(u<i&&i<s);return c},o.filter=i=>ct(s=>{if(s>=s)for(;t(s),!i(s);)s.setTime(s-1)},(s,l)=>{if(s>=s)if(l<0)for(;++l<=0;)for(;e(s,-1),!i(s););else for(;--l>=0;)for(;e(s,1),!i(s););}),n&&(o.count=(i,s)=>(ra.setTime(+i),oa.setTime(+s),t(ra),t(oa),Math.floor(n(ra,oa))),o.every=i=>(i=Math.floor(i),!isFinite(i)||!(i>0)?null:i>1?o.filter(r?s=>r(s)%i===0:s=>o.count(0,s)%i===0):o)),o}const Bn=ct(()=>{},(t,e)=>{t.setTime(+t+e)},(t,e)=>e-t);Bn.every=t=>(t=Math.floor(t),!isFinite(t)||!(t>0)?null:t>1?ct(e=>{e.setTime(Math.floor(e/t)*t)},(e,n)=>{e.setTime(+e+n*t)},(e,n)=>(n-e)/t):Bn);Bn.range;const Vt=1e3,$t=Vt*60,zt=$t*60,jt=zt*24,Ga=jt*7,Dr=jt*30,ia=jt*365,Me=ct(t=>{t.setTime(t-t.getMilliseconds())},(t,e)=>{t.setTime(+t+e*Vt)},(t,e)=>(e-t)/Vt,t=>t.getUTCSeconds());Me.range;const Ka=ct(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*Vt)},(t,e)=>{t.setTime(+t+e*$t)},(t,e)=>(e-t)/$t,t=>t.getMinutes());Ka.range;const mu=ct(t=>{t.setUTCSeconds(0,0)},(t,e)=>{t.setTime(+t+e*$t)},(t,e)=>(e-t)/$t,t=>t.getUTCMinutes());mu.range;const Qa=ct(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*Vt-t.getMinutes()*$t)},(t,e)=>{t.setTime(+t+e*zt)},(t,e)=>(e-t)/zt,t=>t.getHours());Qa.range;const gu=ct(t=>{t.setUTCMinutes(0,0,0)},(t,e)=>{t.setTime(+t+e*zt)},(t,e)=>(e-t)/zt,t=>t.getUTCHours());gu.range;const nn=ct(t=>t.setHours(0,0,0,0),(t,e)=>t.setDate(t.getDate()+e),(t,e)=>(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*$t)/jt,t=>t.getDate()-1);nn.range;const Za=ct(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/jt,t=>t.getUTCDate()-1);Za.range;const yu=ct(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/jt,t=>Math.floor(t/jt));yu.range;function ye(t){return ct(e=>{e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)},(e,n)=>{e.setDate(e.getDate()+n*7)},(e,n)=>(n-e-(n.getTimezoneOffset()-e.getTimezoneOffset())*$t)/Ga)}const Gn=ye(0),Un=ye(1),vu=ye(2),xu=ye(3),Pe=ye(4),wu=ye(5),bu=ye(6);Gn.range;Un.range;vu.range;xu.range;Pe.range;wu.range;bu.range;function ve(t){return ct(e=>{e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCDate(e.getUTCDate()+n*7)},(e,n)=>(n-e)/Ga)}const Ro=ve(0),On=ve(1),Su=ve(2),Mu=ve(3),Ie=ve(4),$u=ve(5),Tu=ve(6);Ro.range;On.range;Su.range;Mu.range;Ie.range;$u.range;Tu.range;const Ja=ct(t=>{t.setDate(1),t.setHours(0,0,0,0)},(t,e)=>{t.setMonth(t.getMonth()+e)},(t,e)=>e.getMonth()-t.getMonth()+(e.getFullYear()-t.getFullYear())*12,t=>t.getMonth());Ja.range;const ku=ct(t=>{t.setUTCDate(1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCMonth(t.getUTCMonth()+e)},(t,e)=>e.getUTCMonth()-t.getUTCMonth()+(e.getUTCFullYear()-t.getUTCFullYear())*12,t=>t.getUTCMonth());ku.range;const Gt=ct(t=>{t.setMonth(0,1),t.setHours(0,0,0,0)},(t,e)=>{t.setFullYear(t.getFullYear()+e)},(t,e)=>e.getFullYear()-t.getFullYear(),t=>t.getFullYear());Gt.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:ct(e=>{e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)},(e,n)=>{e.setFullYear(e.getFullYear()+n*t)});Gt.range;const ge=ct(t=>{t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCFullYear(t.getUTCFullYear()+e)},(t,e)=>e.getUTCFullYear()-t.getUTCFullYear(),t=>t.getUTCFullYear());ge.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:ct(e=>{e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCFullYear(e.getUTCFullYear()+n*t)});ge.range;function Lu(t,e,n,r,o,i){const s=[[Me,1,Vt],[Me,5,5*Vt],[Me,15,15*Vt],[Me,30,30*Vt],[i,1,$t],[i,5,5*$t],[i,15,15*$t],[i,30,30*$t],[o,1,zt],[o,3,3*zt],[o,6,6*zt],[o,12,12*zt],[r,1,jt],[r,2,2*jt],[n,1,Ga],[e,1,Dr],[e,3,3*Dr],[t,1,ia]];function l(u,d,h){const p=d<u;p&&([u,d]=[d,u]);const m=h&&typeof h.range=="function"?h:c(u,d,h),b=m?m.range(u,+d+1):[];return p?b.reverse():b}function c(u,d,h){const p=Math.abs(d-u)/h,m=Ba(([,,L])=>L).right(s,p);if(m===s.length)return t.every(ma(u/ia,d/ia,h));if(m===0)return Bn.every(Math.max(ma(u,d,h),1));const[b,E]=s[p/s[m-1][2]<s[m][2]/p?m-1:m];return b.every(E)}return[l,c]}const[Du,_u]=Lu(Gt,Ja,Gn,nn,Qa,Ka);function sa(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function la(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function Re(t,e,n){return{y:t,m:e,d:n,H:0,M:0,S:0,L:0}}function Eu(t){var e=t.dateTime,n=t.date,r=t.time,o=t.periods,i=t.days,s=t.shortDays,l=t.months,c=t.shortMonths,u=Ne(o),d=Fe(o),h=Ne(i),p=Fe(i),m=Ne(s),b=Fe(s),E=Ne(l),L=Fe(l),x=Ne(c),v=Fe(c),T={a:D,A:P,b:_,B:F,c:null,d:Ar,e:Ar,f:Ju,g:cd,G:dd,H:Ku,I:Qu,j:Zu,L:No,m:td,M:ed,p:I,q:V,Q:Fr,s:Br,S:nd,u:ad,U:rd,V:od,w:id,W:sd,x:null,X:null,y:ld,Y:ud,Z:fd,"%":Nr},M={a:Z,A:X,b:q,B:H,c:null,d:Rr,e:Rr,f:gd,g:kd,G:Dd,H:hd,I:pd,j:md,L:Bo,m:yd,M:vd,p:K,q:rt,Q:Fr,s:Br,S:xd,u:wd,U:bd,V:Sd,w:Md,W:$d,x:null,X:null,y:Td,Y:Ld,Z:_d,"%":Nr},k={a:z,A:N,b:G,B,c:f,d:Pr,e:Pr,f:Yu,g:Cr,G:Er,H:Ir,I:Ir,j:zu,L:Wu,m:Vu,M:qu,p:W,q:Ou,Q:ju,s:Gu,S:Hu,u:Ru,U:Nu,V:Fu,w:Au,W:Bu,x:g,X:y,y:Cr,Y:Er,Z:Uu,"%":Xu};T.x=w(n,T),T.X=w(r,T),T.c=w(e,T),M.x=w(n,M),M.X=w(r,M),M.c=w(e,M);function w(R,Y){return function(J){var C=[],ut=-1,at=0,ht=R.length,pt,Rt,rn;for(J instanceof Date||(J=new Date(+J));++ut<ht;)R.charCodeAt(ut)===37&&(C.push(R.slice(at,ut)),(Rt=_r[pt=R.charAt(++ut)])!=null?pt=R.charAt(++ut):Rt=pt==="e"?" ":"0",(rn=Y[pt])&&(pt=rn(J,Rt)),C.push(pt),at=ut+1);return C.push(R.slice(at,ut)),C.join("")}}function A(R,Y){return function(J){var C=Re(1900,void 0,1),ut=O(C,R,J+="",0),at,ht;if(ut!=J.length)return null;if("Q"in C)return new Date(C.Q);if("s"in C)return new Date(C.s*1e3+("L"in C?C.L:0));if(Y&&!("Z"in C)&&(C.Z=0),"p"in C&&(C.H=C.H%12+C.p*12),C.m===void 0&&(C.m="q"in C?C.q:0),"V"in C){if(C.V<1||C.V>53)return null;"w"in C||(C.w=1),"Z"in C?(at=la(Re(C.y,0,1)),ht=at.getUTCDay(),at=ht>4||ht===0?On.ceil(at):On(at),at=Za.offset(at,(C.V-1)*7),C.y=at.getUTCFullYear(),C.m=at.getUTCMonth(),C.d=at.getUTCDate()+(C.w+6)%7):(at=sa(Re(C.y,0,1)),ht=at.getDay(),at=ht>4||ht===0?Un.ceil(at):Un(at),at=nn.offset(at,(C.V-1)*7),C.y=at.getFullYear(),C.m=at.getMonth(),C.d=at.getDate()+(C.w+6)%7)}else("W"in C||"U"in C)&&("w"in C||(C.w="u"in C?C.u%7:"W"in C?1:0),ht="Z"in C?la(Re(C.y,0,1)).getUTCDay():sa(Re(C.y,0,1)).getDay(),C.m=0,C.d="W"in C?(C.w+6)%7+C.W*7-(ht+5)%7:C.w+C.U*7-(ht+6)%7);return"Z"in C?(C.H+=C.Z/100|0,C.M+=C.Z%100,la(C)):sa(C)}}function O(R,Y,J,C){for(var ut=0,at=Y.length,ht=J.length,pt,Rt;ut<at;){if(C>=ht)return-1;if(pt=Y.charCodeAt(ut++),pt===37){if(pt=Y.charAt(ut++),Rt=k[pt in _r?Y.charAt(ut++):pt],!Rt||(C=Rt(R,J,C))<0)return-1}else if(pt!=J.charCodeAt(C++))return-1}return C}function W(R,Y,J){var C=u.exec(Y.slice(J));return C?(R.p=d.get(C[0].toLowerCase()),J+C[0].length):-1}function z(R,Y,J){var C=m.exec(Y.slice(J));return C?(R.w=b.get(C[0].toLowerCase()),J+C[0].length):-1}function N(R,Y,J){var C=h.exec(Y.slice(J));return C?(R.w=p.get(C[0].toLowerCase()),J+C[0].length):-1}function G(R,Y,J){var C=x.exec(Y.slice(J));return C?(R.m=v.get(C[0].toLowerCase()),J+C[0].length):-1}function B(R,Y,J){var C=E.exec(Y.slice(J));return C?(R.m=L.get(C[0].toLowerCase()),J+C[0].length):-1}function f(R,Y,J){return O(R,e,Y,J)}function g(R,Y,J){return O(R,n,Y,J)}function y(R,Y,J){return O(R,r,Y,J)}function D(R){return s[R.getDay()]}function P(R){return i[R.getDay()]}function _(R){return c[R.getMonth()]}function F(R){return l[R.getMonth()]}function I(R){return o[+(R.getHours()>=12)]}function V(R){return 1+~~(R.getMonth()/3)}function Z(R){return s[R.getUTCDay()]}function X(R){return i[R.getUTCDay()]}function q(R){return c[R.getUTCMonth()]}function H(R){return l[R.getUTCMonth()]}function K(R){return o[+(R.getUTCHours()>=12)]}function rt(R){return 1+~~(R.getUTCMonth()/3)}return{format:function(R){var Y=w(R+="",T);return Y.toString=function(){return R},Y},parse:function(R){var Y=A(R+="",!1);return Y.toString=function(){return R},Y},utcFormat:function(R){var Y=w(R+="",M);return Y.toString=function(){return R},Y},utcParse:function(R){var Y=A(R+="",!0);return Y.toString=function(){return R},Y}}}var _r={"-":"",_:" ",0:"0"},ft=/^\s*\d+/,Cu=/^%/,Pu=/[\\^$*+?|[\]().{}]/g;function et(t,e,n){var r=t<0?"-":"",o=(r?-t:t)+"",i=o.length;return r+(i<n?new Array(n-i+1).join(e)+o:o)}function Iu(t){return t.replace(Pu,"\\$&")}function Ne(t){return new RegExp("^(?:"+t.map(Iu).join("|")+")","i")}function Fe(t){return new Map(t.map((e,n)=>[e.toLowerCase(),n]))}function Au(t,e,n){var r=ft.exec(e.slice(n,n+1));return r?(t.w=+r[0],n+r[0].length):-1}function Ru(t,e,n){var r=ft.exec(e.slice(n,n+1));return r?(t.u=+r[0],n+r[0].length):-1}function Nu(t,e,n){var r=ft.exec(e.slice(n,n+2));return r?(t.U=+r[0],n+r[0].length):-1}function Fu(t,e,n){var r=ft.exec(e.slice(n,n+2));return r?(t.V=+r[0],n+r[0].length):-1}function Bu(t,e,n){var r=ft.exec(e.slice(n,n+2));return r?(t.W=+r[0],n+r[0].length):-1}function Er(t,e,n){var r=ft.exec(e.slice(n,n+4));return r?(t.y=+r[0],n+r[0].length):-1}function Cr(t,e,n){var r=ft.exec(e.slice(n,n+2));return r?(t.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function Uu(t,e,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(n,n+6));return r?(t.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function Ou(t,e,n){var r=ft.exec(e.slice(n,n+1));return r?(t.q=r[0]*3-3,n+r[0].length):-1}function Vu(t,e,n){var r=ft.exec(e.slice(n,n+2));return r?(t.m=r[0]-1,n+r[0].length):-1}function Pr(t,e,n){var r=ft.exec(e.slice(n,n+2));return r?(t.d=+r[0],n+r[0].length):-1}function zu(t,e,n){var r=ft.exec(e.slice(n,n+3));return r?(t.m=0,t.d=+r[0],n+r[0].length):-1}function Ir(t,e,n){var r=ft.exec(e.slice(n,n+2));return r?(t.H=+r[0],n+r[0].length):-1}function qu(t,e,n){var r=ft.exec(e.slice(n,n+2));return r?(t.M=+r[0],n+r[0].length):-1}function Hu(t,e,n){var r=ft.exec(e.slice(n,n+2));return r?(t.S=+r[0],n+r[0].length):-1}function Wu(t,e,n){var r=ft.exec(e.slice(n,n+3));return r?(t.L=+r[0],n+r[0].length):-1}function Yu(t,e,n){var r=ft.exec(e.slice(n,n+6));return r?(t.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function Xu(t,e,n){var r=Cu.exec(e.slice(n,n+1));return r?n+r[0].length:-1}function ju(t,e,n){var r=ft.exec(e.slice(n));return r?(t.Q=+r[0],n+r[0].length):-1}function Gu(t,e,n){var r=ft.exec(e.slice(n));return r?(t.s=+r[0],n+r[0].length):-1}function Ar(t,e){return et(t.getDate(),e,2)}function Ku(t,e){return et(t.getHours(),e,2)}function Qu(t,e){return et(t.getHours()%12||12,e,2)}function Zu(t,e){return et(1+nn.count(Gt(t),t),e,3)}function No(t,e){return et(t.getMilliseconds(),e,3)}function Ju(t,e){return No(t,e)+"000"}function td(t,e){return et(t.getMonth()+1,e,2)}function ed(t,e){return et(t.getMinutes(),e,2)}function nd(t,e){return et(t.getSeconds(),e,2)}function ad(t){var e=t.getDay();return e===0?7:e}function rd(t,e){return et(Gn.count(Gt(t)-1,t),e,2)}function Fo(t){var e=t.getDay();return e>=4||e===0?Pe(t):Pe.ceil(t)}function od(t,e){return t=Fo(t),et(Pe.count(Gt(t),t)+(Gt(t).getDay()===4),e,2)}function id(t){return t.getDay()}function sd(t,e){return et(Un.count(Gt(t)-1,t),e,2)}function ld(t,e){return et(t.getFullYear()%100,e,2)}function cd(t,e){return t=Fo(t),et(t.getFullYear()%100,e,2)}function ud(t,e){return et(t.getFullYear()%1e4,e,4)}function dd(t,e){var n=t.getDay();return t=n>=4||n===0?Pe(t):Pe.ceil(t),et(t.getFullYear()%1e4,e,4)}function fd(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+et(e/60|0,"0",2)+et(e%60,"0",2)}function Rr(t,e){return et(t.getUTCDate(),e,2)}function hd(t,e){return et(t.getUTCHours(),e,2)}function pd(t,e){return et(t.getUTCHours()%12||12,e,2)}function md(t,e){return et(1+Za.count(ge(t),t),e,3)}function Bo(t,e){return et(t.getUTCMilliseconds(),e,3)}function gd(t,e){return Bo(t,e)+"000"}function yd(t,e){return et(t.getUTCMonth()+1,e,2)}function vd(t,e){return et(t.getUTCMinutes(),e,2)}function xd(t,e){return et(t.getUTCSeconds(),e,2)}function wd(t){var e=t.getUTCDay();return e===0?7:e}function bd(t,e){return et(Ro.count(ge(t)-1,t),e,2)}function Uo(t){var e=t.getUTCDay();return e>=4||e===0?Ie(t):Ie.ceil(t)}function Sd(t,e){return t=Uo(t),et(Ie.count(ge(t),t)+(ge(t).getUTCDay()===4),e,2)}function Md(t){return t.getUTCDay()}function $d(t,e){return et(On.count(ge(t)-1,t),e,2)}function Td(t,e){return et(t.getUTCFullYear()%100,e,2)}function kd(t,e){return t=Uo(t),et(t.getUTCFullYear()%100,e,2)}function Ld(t,e){return et(t.getUTCFullYear()%1e4,e,4)}function Dd(t,e){var n=t.getUTCDay();return t=n>=4||n===0?Ie(t):Ie.ceil(t),et(t.getUTCFullYear()%1e4,e,4)}function _d(){return"+0000"}function Nr(){return"%"}function Fr(t){return+t}function Br(t){return Math.floor(+t/1e3)}var xe,tr;Ed({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Ed(t){return xe=Eu(t),tr=xe.format,xe.parse,xe.utcFormat,xe.utcParse,xe}function Cd(t){return new Date(t)}function Pd(t){return t instanceof Date?+t:+new Date(+t)}function Oo(t,e,n,r,o,i,s,l,c,u){var d=Ao(),h=d.invert,p=d.domain,m=u(".%L"),b=u(":%S"),E=u("%I:%M"),L=u("%I %p"),x=u("%a %d"),v=u("%b %d"),T=u("%B"),M=u("%Y");function k(w){return(c(w)<w?m:l(w)<w?b:s(w)<w?E:i(w)<w?L:r(w)<w?o(w)<w?x:v:n(w)<w?T:M)(w)}return d.invert=function(w){return new Date(h(w))},d.domain=function(w){return arguments.length?p(Array.from(w,Pd)):p().map(Cd)},d.ticks=function(w){var A=p();return t(A[0],A[A.length-1],w??10)},d.tickFormat=function(w,A){return A==null?k:u(A)},d.nice=function(w){var A=p();return(!w||typeof w.range!="function")&&(w=e(A[0],A[A.length-1],w??10)),w?p(pu(A,w)):d},d.copy=function(){return Io(d,Oo(t,e,n,r,o,i,s,l,c,u))},d}function Id(){return Po.apply(Oo(Du,_u,Gt,Ja,Gn,nn,Qa,Ka,Me,tr).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}const hn=t=>()=>t;function Ad(t,{sourceEvent:e,target:n,transform:r,dispatch:o}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:o}})}function qt(t,e,n){this.k=t,this.x=e,this.y=n}qt.prototype={constructor:qt,scale:function(t){return t===1?this:new qt(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new qt(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Kn=new qt(1,0,0);qt.prototype;function ca(t){t.stopImmediatePropagation()}function Be(t){t.preventDefault(),t.stopImmediatePropagation()}function Rd(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function Nd(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function Ur(){return this.__zoom||Kn}function Fd(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function Bd(){return navigator.maxTouchPoints||"ontouchstart"in this}function Ud(t,e,n){var r=t.invertX(e[0][0])-n[0][0],o=t.invertX(e[1][0])-n[1][0],i=t.invertY(e[0][1])-n[0][1],s=t.invertY(e[1][1])-n[1][1];return t.translate(o>r?(r+o)/2:Math.min(0,r)||Math.max(0,o),s>i?(i+s)/2:Math.min(0,i)||Math.max(0,s))}function Od(){var t=Rd,e=Nd,n=Ud,r=Fd,o=Bd,i=[0,1/0],s=[[-1/0,-1/0],[1/0,1/0]],l=250,c=Nl,u=Ua("start","zoom","end"),d,h,p,m=500,b=150,E=0,L=10;function x(f){f.property("__zoom",Ur).on("wheel.zoom",O,{passive:!1}).on("mousedown.zoom",W).on("dblclick.zoom",z).filter(o).on("touchstart.zoom",N).on("touchmove.zoom",G).on("touchend.zoom touchcancel.zoom",B).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}x.transform=function(f,g,y,D){var P=f.selection?f.selection():f;P.property("__zoom",Ur),f!==P?k(f,g,y,D):P.interrupt().each(function(){w(this,arguments).event(D).start().zoom(null,typeof g=="function"?g.apply(this,arguments):g).end()})},x.scaleBy=function(f,g,y,D){x.scaleTo(f,function(){var P=this.__zoom.k,_=typeof g=="function"?g.apply(this,arguments):g;return P*_},y,D)},x.scaleTo=function(f,g,y,D){x.transform(f,function(){var P=e.apply(this,arguments),_=this.__zoom,F=y==null?M(P):typeof y=="function"?y.apply(this,arguments):y,I=_.invert(F),V=typeof g=="function"?g.apply(this,arguments):g;return n(T(v(_,V),F,I),P,s)},y,D)},x.translateBy=function(f,g,y,D){x.transform(f,function(){return n(this.__zoom.translate(typeof g=="function"?g.apply(this,arguments):g,typeof y=="function"?y.apply(this,arguments):y),e.apply(this,arguments),s)},null,D)},x.translateTo=function(f,g,y,D,P){x.transform(f,function(){var _=e.apply(this,arguments),F=this.__zoom,I=D==null?M(_):typeof D=="function"?D.apply(this,arguments):D;return n(Kn.translate(I[0],I[1]).scale(F.k).translate(typeof g=="function"?-g.apply(this,arguments):-g,typeof y=="function"?-y.apply(this,arguments):-y),_,s)},D,P)};function v(f,g){return g=Math.max(i[0],Math.min(i[1],g)),g===f.k?f:new qt(g,f.x,f.y)}function T(f,g,y){var D=g[0]-y[0]*f.k,P=g[1]-y[1]*f.k;return D===f.x&&P===f.y?f:new qt(f.k,D,P)}function M(f){return[(+f[0][0]+ +f[1][0])/2,(+f[0][1]+ +f[1][1])/2]}function k(f,g,y,D){f.on("start.zoom",function(){w(this,arguments).event(D).start()}).on("interrupt.zoom end.zoom",function(){w(this,arguments).event(D).end()}).tween("zoom",function(){var P=this,_=arguments,F=w(P,_).event(D),I=e.apply(P,_),V=y==null?M(I):typeof y=="function"?y.apply(P,_):y,Z=Math.max(I[1][0]-I[0][0],I[1][1]-I[0][1]),X=P.__zoom,q=typeof g=="function"?g.apply(P,_):g,H=c(X.invert(V).concat(Z/X.k),q.invert(V).concat(Z/q.k));return function(K){if(K===1)K=q;else{var rt=H(K),R=Z/rt[2];K=new qt(R,V[0]-rt[0]*R,V[1]-rt[1]*R)}F.zoom(null,K)}})}function w(f,g,y){return!y&&f.__zooming||new A(f,g)}function A(f,g){this.that=f,this.args=g,this.active=0,this.sourceEvent=null,this.extent=e.apply(f,g),this.taps=0}A.prototype={event:function(f){return f&&(this.sourceEvent=f),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(f,g){return this.mouse&&f!=="mouse"&&(this.mouse[1]=g.invert(this.mouse[0])),this.touch0&&f!=="touch"&&(this.touch0[1]=g.invert(this.touch0[0])),this.touch1&&f!=="touch"&&(this.touch1[1]=g.invert(this.touch1[0])),this.that.__zoom=g,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(f){var g=Ot(this.that).datum();u.call(f,this.that,new Ad(f,{sourceEvent:this.sourceEvent,target:x,transform:this.that.__zoom,dispatch:u}),g)}};function O(f,...g){if(!t.apply(this,arguments))return;var y=w(this,g).event(f),D=this.__zoom,P=Math.max(i[0],Math.min(i[1],D.k*Math.pow(2,r.apply(this,arguments)))),_=Qt(f);if(y.wheel)(y.mouse[0][0]!==_[0]||y.mouse[0][1]!==_[1])&&(y.mouse[1]=D.invert(y.mouse[0]=_)),clearTimeout(y.wheel);else{if(D.k===P)return;y.mouse=[_,D.invert(_)],Sn(this),y.start()}Be(f),y.wheel=setTimeout(F,b),y.zoom("mouse",n(T(v(D,P),y.mouse[0],y.mouse[1]),y.extent,s));function F(){y.wheel=null,y.end()}}function W(f,...g){if(p||!t.apply(this,arguments))return;var y=f.currentTarget,D=w(this,g,!0).event(f),P=Ot(f.view).on("mousemove.zoom",V,!0).on("mouseup.zoom",Z,!0),_=Qt(f,y),F=f.clientX,I=f.clientY;rl(f.view),ca(f),D.mouse=[_,this.__zoom.invert(_)],Sn(this),D.start();function V(X){if(Be(X),!D.moved){var q=X.clientX-F,H=X.clientY-I;D.moved=q*q+H*H>E}D.event(X).zoom("mouse",n(T(D.that.__zoom,D.mouse[0]=Qt(X,y),D.mouse[1]),D.extent,s))}function Z(X){P.on("mousemove.zoom mouseup.zoom",null),ol(X.view,D.moved),Be(X),D.event(X).end()}}function z(f,...g){if(t.apply(this,arguments)){var y=this.__zoom,D=Qt(f.changedTouches?f.changedTouches[0]:f,this),P=y.invert(D),_=y.k*(f.shiftKey?.5:2),F=n(T(v(y,_),D,P),e.apply(this,g),s);Be(f),l>0?Ot(this).transition().duration(l).call(k,F,D,f):Ot(this).call(x.transform,F,D,f)}}function N(f,...g){if(t.apply(this,arguments)){var y=f.touches,D=y.length,P=w(this,g,f.changedTouches.length===D).event(f),_,F,I,V;for(ca(f),F=0;F<D;++F)I=y[F],V=Qt(I,this),V=[V,this.__zoom.invert(V),I.identifier],P.touch0?!P.touch1&&P.touch0[2]!==V[2]&&(P.touch1=V,P.taps=0):(P.touch0=V,_=!0,P.taps=1+!!d);d&&(d=clearTimeout(d)),_&&(P.taps<2&&(h=V[0],d=setTimeout(function(){d=null},m)),Sn(this),P.start())}}function G(f,...g){if(this.__zooming){var y=w(this,g).event(f),D=f.changedTouches,P=D.length,_,F,I,V;for(Be(f),_=0;_<P;++_)F=D[_],I=Qt(F,this),y.touch0&&y.touch0[2]===F.identifier?y.touch0[0]=I:y.touch1&&y.touch1[2]===F.identifier&&(y.touch1[0]=I);if(F=y.that.__zoom,y.touch1){var Z=y.touch0[0],X=y.touch0[1],q=y.touch1[0],H=y.touch1[1],K=(K=q[0]-Z[0])*K+(K=q[1]-Z[1])*K,rt=(rt=H[0]-X[0])*rt+(rt=H[1]-X[1])*rt;F=v(F,Math.sqrt(K/rt)),I=[(Z[0]+q[0])/2,(Z[1]+q[1])/2],V=[(X[0]+H[0])/2,(X[1]+H[1])/2]}else if(y.touch0)I=y.touch0[0],V=y.touch0[1];else return;y.zoom("touch",n(T(F,I,V),y.extent,s))}}function B(f,...g){if(this.__zooming){var y=w(this,g).event(f),D=f.changedTouches,P=D.length,_,F;for(ca(f),p&&clearTimeout(p),p=setTimeout(function(){p=null},m),_=0;_<P;++_)F=D[_],y.touch0&&y.touch0[2]===F.identifier?delete y.touch0:y.touch1&&y.touch1[2]===F.identifier&&delete y.touch1;if(y.touch1&&!y.touch0&&(y.touch0=y.touch1,delete y.touch1),y.touch0)y.touch0[1]=this.__zoom.invert(y.touch0[0]);else if(y.end(),y.taps===2&&(F=Qt(F,this),Math.hypot(h[0]-F[0],h[1]-F[1])<L)){var I=Ot(this).on("dblclick.zoom");I&&I.apply(this,arguments)}}}return x.wheelDelta=function(f){return arguments.length?(r=typeof f=="function"?f:hn(+f),x):r},x.filter=function(f){return arguments.length?(t=typeof f=="function"?f:hn(!!f),x):t},x.touchable=function(f){return arguments.length?(o=typeof f=="function"?f:hn(!!f),x):o},x.extent=function(f){return arguments.length?(e=typeof f=="function"?f:hn([[+f[0][0],+f[0][1]],[+f[1][0],+f[1][1]]]),x):e},x.scaleExtent=function(f){return arguments.length?(i[0]=+f[0],i[1]=+f[1],x):[i[0],i[1]]},x.translateExtent=function(f){return arguments.length?(s[0][0]=+f[0][0],s[1][0]=+f[1][0],s[0][1]=+f[0][1],s[1][1]=+f[1][1],x):[[s[0][0],s[0][1]],[s[1][0],s[1][1]]]},x.constrain=function(f){return arguments.length?(n=f,x):n},x.duration=function(f){return arguments.length?(l=+f,x):l},x.interpolate=function(f){return arguments.length?(c=f,x):c},x.on=function(){var f=u.on.apply(u,arguments);return f===u?x:f},x.clickDistance=function(f){return arguments.length?(E=(f=+f)*f,x):Math.sqrt(E)},x.tapDistance=function(f){return arguments.length?(L=+f,x):L},x}const gt=360;let ie=null,Bt=null;function Vd(t){const{root:e,isOpen:n,onCanvasToggleUpdate:r,onTimeSliderUpdate:o}=t;ie||(ie=e.querySelector('[data-role="sidebar"]')),Bt||(Bt=e.querySelector('[data-action="toggle-sidebar"]'));const i=e.querySelector('[data-role="canvas-toggle"]'),s=e.querySelector('[data-role="compare-info-trigger"]'),l=e.querySelector('[data-role="compare-info-overlay"]');if(!ie||!i||!Bt)return;const c=n?"translateX(0)":`translateX(${gt+24}px)`;ie.style.transform=c,ie.style.pointerEvents=n?"auto":"none",ie.setAttribute("aria-hidden",String(!n));const u=n?`${gt+10}px`:"14px";Bt.style.right=u,Bt.setAttribute("aria-label",n?"Collapse sidebar":"Expand sidebar"),Bt.className=n?"sidebar-toggle open":"sidebar-toggle";const d=Bt.querySelector("span");d&&(d.textContent=n?"›":"‹");const h=n?gt+24:24;i.style.right=`${h}px`,s&&(s.style.right=`${h}px`),l&&(l.style.left=n?`${gt}px`:"0",l.style.right="0"),r&&r(h),o&&o(n)}function zd(t){const{root:e,getSidebarOpen:n,setSidebarOpen:r,onCanvasToggleUpdate:o,onTimeSliderUpdate:i}=t;ie=e.querySelector('[data-role="sidebar"]'),Bt=e.querySelector('[data-action="toggle-sidebar"]'),Bt?.addEventListener("click",()=>{const s=!n();r(s),Vd({root:e,isOpen:s,onCanvasToggleUpdate:o,onTimeSliderUpdate:i})})}function qd(t){const e=t?gt+10:14;return`
      <button
        type="button"
        aria-label="${t?"Collapse sidebar":"Expand sidebar"}"
        data-action="toggle-sidebar"
        class="${t?"sidebar-toggle open":"sidebar-toggle"}"
        style="right: ${e}px"
      >
        <span class="sidebar-toggle-icon">${t?"›":"‹"}</span>
      </button>
    `}function Vo(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:{r:0,g:0,b:0}}const Hd=t=>t-273.15,Wd=t=>(t-273.15)*(9/5)+32,Yd=t=>t*1e3,Xd=t=>t*3.6,jd=t=>t*2.237,Gd=t=>t/1e3,we=t=>t;function ne(t){switch(t){case"tas":case"tasmin":case"tasmax":return[{label:"Kelvin (K)",unit:"K",convert:we},{label:"Celsius (°C)",unit:"°C",convert:Hd},{label:"Fahrenheit (°F)",unit:"°F",convert:Wd}];case"pr":return[{label:"g m⁻² s⁻¹",unit:"g m⁻² s⁻¹",convert:Yd},{label:"kg m⁻² s⁻¹",unit:"kg m⁻² s⁻¹",convert:we}];case"rsds":case"rlds":return[{label:"W/m²",unit:"W/m²",convert:we},{label:"kW/m²",unit:"kW/m²",convert:Gd}];case"sfcWind":return[{label:"m/s",unit:"m/s",convert:we},{label:"km/h",unit:"km/h",convert:Xd},{label:"mph",unit:"mph",convert:jd}];case"hurs":return[{label:"Percent (%)",unit:"%",convert:we}];default:return[{label:"Default",unit:"",convert:we}]}}function je(t){return ne(t)[0]}function Le(t,e,n,r){const i=ne(e).find(s=>s.label===n);return i?r?.isDifference&&["tas","tasmin","tasmax"].includes(e)?n.includes("Celsius")?t:n.includes("Fahrenheit")?t*(9/5):t:i.convert(t):t}function zo(t,e){return ne(t).find(o=>o.label===e)?.unit||""}function qo(t,e,n,r,o){const s=ne(n).find(l=>l.label===r);return s?o?.isDifference&&["tas","tasmin","tasmax"].includes(n)?r.startsWith("Celsius")?{min:t,max:e}:r.startsWith("Fahrenheit")?{min:t*1.8,max:e*1.8}:{min:t,max:e}:{min:s.convert(t),max:s.convert(e)}:{min:t,max:e}}let Ht=null,Ge=[];function er(t,e,n,r){const o=r.map(Vo);for(let i=0;i<n;i++){const l=(1-i/(n-1))*(o.length-1),c=Math.floor(l),u=Math.min(c+1,o.length-1),d=l-c,h=o[c],p=o[u],m=Math.round(h.r+(p.r-h.r)*d),b=Math.round(h.g+(p.g-h.g)*d),E=Math.round(h.b+(p.b-h.b)*d);t.fillStyle=`rgb(${m}, ${b}, ${E})`,t.fillRect(0,i,e,1)}}function Kd(t,e,n,r,o,i){const s=r?.variable_metadata[t],l=s?.name||t;let c=e,u=n,d=s?.unit||"";if(o){const m=qo(e,n,t,o,{isDifference:i});c=m.min,u=m.max,d=zo(t,o)}const h=(u-c)/4,p=[u,u-h,u-2*h,u-3*h,c];return`
      <div class="map-legend">
        <div class="legend-title">${l}</div>
        <div class="legend-container">
        <canvas id="legend-gradient-canvas" width="20" height="200" style="width: 20px; height: 200px; border-radius: 4px;"></canvas>
          <div class="legend-labels">
            ${p.map(m=>`<span>${m.toFixed(2)} ${d}</span>`).join("")}
          </div>
        </div>
      </div>
    `}function ka(t,e){const n=document.getElementById(t);if(!n){console.warn("Legend canvas not found");return}Ht=n,Ge=e;const r=n.getContext("2d");if(!r)return;const o=n.width,i=n.height;er(r,o,i,e)}function Qd(t,e,n){if(!Ht||Ge.length===0)return;const r=Ht.getContext("2d");if(!r)return;const o=Ht.width,i=Ht.height;er(r,o,i,Ge);const s=(t-e)/(n-e),l=Math.round(i*(1-s));r.strokeStyle="rgba(255, 255, 255, 0.95)",r.lineWidth=2,r.shadowColor="rgba(0, 0, 0, 0.8)",r.shadowBlur=4,r.beginPath(),r.moveTo(0,l),r.lineTo(o,l),r.stroke(),r.shadowBlur=0}function Zd(){if(!Ht||Ge.length===0)return;const t=Ht.getContext("2d");if(!t)return;const e=Ht.width,n=Ht.height;er(t,e,n,Ge)}const an="http://localhost:8000";class bt extends Error{statusCode;details;constructor(e,n,r){super(e),this.name="DataClientError",this.statusCode=n,this.details=r}}function Wt(t){return{Historical:"historical",SSP245:"ssp245",SSP585:"ssp585"}[t]||t.toLowerCase()}function Jd(t){return t===1?"low":t===2?"medium":"high"}function tf(t,e,n="float32"){const r=atob(t),o=new Uint8Array(r.length);for(let i=0;i<r.length;i++)o[i]=r.charCodeAt(i);if(n.includes("float32"))return new Float32Array(o.buffer);if(n.includes("float64"))return new Float64Array(o.buffer);throw new Error(`Unsupported dtype: ${n}`)}function ef(t,e){const n=t.flat(),r=new Float32Array(n.length);for(let o=0;o<n.length;o++)r[o]=n[o];return r}async function Pt(t,e){const r=`${an}/data`;try{const o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...t,scenario:t.scenario?Wt(t.scenario):void 0,data_format:t.data_format||"base64"})});if(!o.ok){const i=await o.json().catch(()=>({detail:o.statusText}));throw new bt(i.detail||`HTTP ${o.status}: ${o.statusText}`,o.status,i)}return await o.json()}catch(o){throw o instanceof bt?o:new bt(`Failed to fetch data: ${o instanceof Error?o.message:String(o)}`,void 0,o)}}async function nr(t){const n=`${an}/metadata`;try{const r=await fetch(n,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new bt(`HTTP ${r.status}: ${r.statusText}`,r.status);return await r.json()}catch(r){throw r instanceof bt?r:new bt(`Failed to fetch metadata: ${r instanceof Error?r.message:String(r)}`)}}function _t(t){return t.data?t.data instanceof Float32Array||t.data instanceof Float64Array?t.data:t.data_encoding==="none"?null:t.data_encoding==="base64"&&typeof t.data=="string"?tf(t.data,t.shape,t.dtype):t.data_encoding==="list"&&Array.isArray(t.data)?ef(t.data,t.shape):null:null}function mt(t){return{variable:t.variable,time:t.date,model:t.model,scenario:t.scenario,resolution:Jd(t.resolution),data_format:t.dataFormat||"base64"}}async function La(t,e){const r=`${an}/pixel-data`;try{const o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...t,scenario:t.scenario?Wt(t.scenario):void 0,resolution:t.resolution||"medium",step_days:t.step_days||1})});if(!o.ok){const i=await o.json().catch(()=>({detail:o.statusText}));throw new bt(i.detail||`HTTP ${o.status}: ${o.statusText}`,o.status,i)}return await o.json()}catch(o){throw o instanceof bt?o:new bt(`Failed to fetch pixel data: ${o instanceof Error?o.message:String(o)}`,void 0,o)}}async function Da(t,e){const r=`${an}/aggregate-on-demand`;try{const o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...t,scenario:t.scenario?Wt(t.scenario):void 0,resolution:t.resolution||"medium",step_days:t.step_days||1})});if(!o.ok){const i=await o.json().catch(()=>({detail:o.statusText}));throw new bt(i.detail||`HTTP ${o.status}: ${o.statusText}`,o.status,i)}return await o.json()}catch(o){throw o instanceof bt?o:new bt(`Failed to fetch aggregate data: ${o instanceof Error?o.message:String(o)}`,void 0,o)}}async function nf(t){const n=`${an}/health`;try{return(await fetch(n,{method:"GET",signal:AbortSignal.timeout(5e3)})).ok}catch{return!1}}let Ue=null,_a=0,Ea=1,se="",le="",Mn=!1;function Ho(){return Ue||(Ue=document.createElement("div"),Ue.className="map-tooltip",document.body.appendChild(Ue)),Ue}function af(t,e,n,r,o,i,s){const l=Ho();let c=o,u=i;le&&se&&(c=Le(o,se,le,{isDifference:s??Mn}),u=zo(se,le)||i),l.textContent=`Lat: ${n.toFixed(2)}, Lon: ${r.toFixed(2)}, Value: ${c.toFixed(2)} ${u}`,l.style.display="block",l.style.left=`${t+10}px`,l.style.top=`${e+10}px`;let d=_a,h=Ea;if(le&&se){const p=Le(_a,se,le,{isDifference:s??Mn}),m=Le(Ea,se,le,{isDifference:s??Mn});d=p,h=m}Qd(c,d,h)}function ze(){const t=Ho();t.style.display="none",Zd()}function rf(t,e,n,r,o){_a=t,Ea=e,n!==void 0&&(se=n),r!==void 0&&(le=r),o!==void 0&&(Mn=o)}let Q=Kn,qe=null,st=null,Wo=null,Yo=!1,Vn=null,Xo,jo,He=!1,Ca=null,Pa=null;function Go(){return Q.k}function of(t){const e=t.getContext("2d");if(!e)return null;const n=t.getBoundingClientRect();return t.width=n.width*window.devicePixelRatio,t.height=n.height*window.devicePixelRatio,e.scale(window.devicePixelRatio,window.devicePixelRatio),{ctx:e,rect:n,viewWidth:n.width,viewHeight:n.height}}function sf(t,e,n,r){const o=t*n+n/2,i=o>180?o-360:o,s=90-(e*r+r/2);return[i,s]}function lf(t,e,n,r,o){if(t<0||t>=n||e<0||e>=r)return null;const s=(r-1-e)*n+t,l=o[s];return isFinite(l)?l:null}function ua(t){He?t.style.cursor="crosshair":t.style.cursor="auto"}function Or(t,e,n){if(!st)return null;const r=t.getBoundingClientRect(),o=e-r.left,i=n-r.top;let s=(o-Q.x)/Q.k;const l=(i-Q.y)/Q.k,c=st.width,u=st.height;if(l<0||l>u)return null;let d=s;d=d%c,d<0&&(d+=c),d<0&&(d=0),d>=c&&(d=c*(1-Number.EPSILON));const h=d/c*360-180,p=90-l/u*150,m=Math.max(-180,Math.min(180,h)),b=Math.max(-90,Math.min(90,p));return!Number.isFinite(m)||!Number.isFinite(b)?null:{lat:b,lon:m}}function cf(t,e){He=t,Ca=t?e??null:null}function $n(t,e,n){if(!st)return null;const r=st.width,o=st.height;let i=e;for(;i>180;)i-=360;for(;i<-180;)i+=360;const s=(i+180)/360*r,l=(90-n)/150*o,c=s*Q.k+Q.x,u=l*Q.k+Q.y,d=t.getBoundingClientRect(),h=r*Q.k,p=d.width/2;let m=c,b=Math.abs(c-p);for(let E=-h;E<=h;E+=h){const L=c+E,x=Math.abs(L-p);x<b&&(b=x,m=L)}return u<-o*Q.k||u>d.height+o*Q.k?null:{x:m,y:u}}function uf(t,e,n,r,o,i){cf(i?.drawMode??!1,{onClick:i?.onDrawClick,onMove:i?.onDrawMove}),Pa=i?.onTransform??null,ua(t);const s=Ot(t);qe=Od().scaleExtent([.8,10]).filter(l=>He?!1:!l.ctrlKey&&!l.button).on("zoom",l=>{Q=l.transform,(st||e)&&Vr(t),Pa?.()}).on("start",()=>{t.style.cursor="grabbing",ze()}).on("end",()=>{ua(t)}),s.call(qe),s.call(qe.transform,Q),s.on("click.draw",l=>{const c=Or(t,l.clientX,l.clientY);if(c){if(He){Ca?.onClick?.(c);return}i?.onMapClick?.(c)}}),s.on("pointermove.tooltip",l=>{if(He){const c=Or(t,l.clientX,l.clientY);c&&Ca?.onMove?.(c),ze();return}if(l.buttons===0&&Wo&&Vn&&st){const[c,u]=Qt(l,t);df(l.clientX,l.clientY,c,u,n,Xo,jo,Yo)}}),s.on("pointerleave",()=>{ze()}),ua(t)}function Vr(t){if(!st)return;const e=t.getContext("2d");if(!e)return;const n=t.getBoundingClientRect();e.clearRect(0,0,n.width,n.height),e.save(),e.translate(Q.x,Q.y),e.scale(Q.k,Q.k),e.imageSmoothingEnabled=!1;const r=st.width,o=-Q.x/Q.k,i=(n.width-Q.x)/Q.k,s=Math.floor(o/r)-1,l=Math.ceil(i/r)+1;for(let c=s;c<=l;c++)e.drawImage(st,c*r,0);e.restore()}function Ia(t,e,n,r,o,i,s,l){if(!e)return;const c=_t(t);if(!c){console.warn("No data to render");return}console.log("Rendering map data (full render)");const u=of(e);if(!u)return;const{ctx:d,rect:h,viewWidth:p,viewHeight:m}=u,[b,E]=t.shape;d.clearRect(0,0,h.width,h.height),d.save();const L=!!t?.metadata?.comparison||typeof t.model=="string"&&t.model.includes(" minus ");Wo=t,Xo=s,jo=l,Yo=L;const x=new Array(m).fill(null).map(()=>new Float32Array(p).fill(NaN));let v=o,T=i;if(s&&l){const I=qo(o,i,s,l,{isDifference:L});v=I.min,T=I.max}rf(o,i,s,l,L);const w=(n.find(I=>I.name===r)||n[0]).colors.map(Vo);function A(I,V){const Z=(I+180)/360*p,X=(90-V)/150*m;return[Z,X]}const O=document.createElement("canvas");O.width=p,O.height=m;const W=O.getContext("2d");if(!W)return;const z=W.createImageData(p,m),N=z.data;console.log("Rendering map data");const G=Math.max(p/E,m/b),B=Math.ceil(G/2),f=360/E,g=150/b;for(let I=0;I<b;I++)for(let V=0;V<E;V++){const Z=lf(V,I,E,b,c);if(Z===null)continue;const[X,q]=sf(V,I,f,g),[H,K]=A(X,q);let rt=Z;s&&l&&(rt=Le(Z,s,l,{isDifference:L}));const R=T-v,Y=R===0?.5:Math.min(1,Math.max(0,(rt-v)/R)),J=Math.floor(Y*(w.length-1)),C=w[Math.min(J,w.length-1)],ut=w[Math.min(J+1,w.length-1)],at=Y*(w.length-1)-J,ht=Math.round(C.r+(ut.r-C.r)*at),pt=Math.round(C.g+(ut.g-C.g)*at),Rt=Math.round(C.b+(ut.b-C.b)*at),rn=Math.max(0,Math.floor(H-B)),li=Math.min(p,Math.ceil(H+B)),ci=Math.max(0,Math.floor(K-B)),ui=Math.min(m,Math.ceil(K+B));for(let on=ci;on<ui;on++)for(let sn=rn;sn<li;sn++){const ln=(on*p+sn)*4;N[ln]=ht,N[ln+1]=pt,N[ln+2]=Rt,N[ln+3]=255,x[on][sn]=Z}}W.putImageData(z,0,0),st=O,Vn=x,d.clearRect(0,0,h.width,h.height),d.save(),d.translate(Q.x,Q.y),d.scale(Q.k,Q.k),d.imageSmoothingEnabled=!1;const y=st.width,D=-Q.x/Q.k,P=(h.width-Q.x)/Q.k,_=Math.floor(D/y)-1,F=Math.ceil(P/y)+1;for(let I=_;I<=F;I++)d.drawImage(st,I*y,0);d.restore()}function Ko(t,e,n,r=3.2,o=550){if(!st||!qe)return;const i=t.getBoundingClientRect(),s=st.width,l=st.height;let c=e;for(;c>180;)c-=360;for(;c<-180;)c+=360;const u=(c+180)/360*s,d=(90-n)/150*l,h=[u-s,u,u+s];let p=i.width/2-u*r,m=Math.abs(p-Q.x);for(const L of h){const x=i.width/2-L*r,v=Math.abs(x-Q.x);v<m&&(m=v,p=x)}const b=i.height/2-d*r,E=Kn.translate(p,b).scale(r);Ot(t).transition().duration(o).ease(Hc).call(qe.transform,E),Q=E,Pa?.()}function df(t,e,n,r,o,i,s,l){if(!Vn||!st)return;let c=(n-Q.x)/Q.k;const u=(r-Q.y)/Q.k,d=st.width,h=st.height;c=(c%d+d)%d;const p=Math.floor(c),m=Math.floor(u);if(p>=0&&p<d&&m>=0&&m<h){const b=Vn?.[m]?.[p]??0;if(isFinite(b)){const E=c/d*360-180,L=90-u/h*150;af(t,e,L,E,b,o,l)}else ze()}else ze()}function Zt(t){const e=new Date(t);return`${["January","February","March","April","May","June","July","August","September","October","November","December"][e.getMonth()]} ${e.getDate()}, ${e.getFullYear()}`}function ff(t){const{date:e,timeRange:n,sidebarOpen:r,sidebarWidth:o,mode:i,compareMode:s,compareDateStart:l,compareDateEnd:c}=t;let u=0,d=0,h=0,p=0,m=0,b=0,E=0,L=100;if(n){const v=new Date(n.start),T=new Date(n.end),M=new Date(e);if(d=Math.floor((T.getTime()-v.getTime())/(1e3*60*60*24)),h=Math.floor((M.getTime()-v.getTime())/(1e3*60*60*24)),p=d>0?h/d*100:0,i==="Compare"&&s==="Dates"){const k=l?new Date(l):v,w=c?new Date(c):T;m=Math.max(0,Math.floor((k.getTime()-v.getTime())/(1e3*60*60*24))),b=Math.min(d,Math.floor((w.getTime()-v.getTime())/(1e3*60*60*24))),E=d>0?m/d*100:0,L=d>0?b/d*100:100}}const x=r?o+16:16;if(i==="Compare"&&s==="Dates"&&n){const v=Zt(l||n.start),T=Zt(c||n.end);return`
      <div class="time-slider-container" style="right: ${x}px">
        <div data-role="time-label" class="time-label">${v} – ${T}</div>
        <div class="time-slider-row dual-slider" data-role="dual-slider">
          <div
            class="dual-slider-track"
            aria-hidden="true"
          ></div>
          <div
            class="dual-slider-fill"
            data-role="dual-fill"
            style="--fill-start: ${E}%; --fill-end: ${L}%"
            aria-hidden="true"
          ></div>
          <input
            type="range"
            min="${u}"
            max="${d}"
            step="1"
            value="${m}"
            data-action="set-time-start"
            class="time-slider dual-thumb dual-thumb-start"
            aria-label="Start date"
          />
          <input
            type="range"
            min="${u}"
            max="${d}"
            step="1"
            value="${b}"
            data-action="set-time-end"
            class="time-slider dual-thumb dual-thumb-end"
            aria-label="End date"
          />
        </div>
      </div>
    `}return`
      <div class="time-slider-container" style="right: ${x}px">
        <div data-role="time-label" class="time-label">${Zt(e)}</div>
        <div class="time-slider-row">
          <input
            type="range"
            min="${u}"
            max="${d}"
            step="1"
            value="${h}"
            data-action="set-time"
            class="time-slider"
            style="--slider-fill: ${p}%"
          />
        </div>
      </div>
    `}let be=null,Aa=null;function hf(t){const{root:e,getTimeRange:n,onDateChange:r,getMode:o,getCompareMode:i,getCompareDates:s,onDateRangeChange:l}=t;Aa=e.querySelector('[data-role="time-label"]')?.parentElement??null;const c=()=>o?.()==="Compare"&&i?.()==="Dates";e.querySelectorAll('[data-action="set-time"]').forEach(L=>L.addEventListener("input",()=>{if(c())return;const x=Number.parseInt(L.value,10),v=n();if(!Number.isNaN(x)&&v){const T=new Date(v.start);T.setDate(T.getDate()+x);const M=T.toISOString().split("T")[0],k=e.querySelector('[data-role="time-label"]');k&&(k.textContent=Zt(M));const w=new Date(v.end),A=Math.floor((w.getTime()-new Date(v.start).getTime())/(1e3*60*60*24)),O=A>0?x/A*100:0;L.style.setProperty("--slider-fill",`${O}%`),be&&window.clearTimeout(be),be=window.setTimeout(()=>{r(M)},500)}}));const d=e.querySelectorAll('[data-action="set-time-start"]'),h=e.querySelectorAll('[data-action="set-time-end"]'),p=e.querySelector('[data-role="dual-fill"]'),m=(L,x,v,T,M)=>{const k=e.querySelector('[data-role="time-label"]'),w=new Date(v.start),A=new Date(v.start);w.setDate(w.getDate()+L),A.setDate(A.getDate()+x);const O=w.toISOString().split("T")[0],W=A.toISOString().split("T")[0];k&&(k.textContent=`${Zt(O)} – ${Zt(W)}`);const z=new Date(v.end).getTime()-new Date(v.start).getTime(),N=Math.max(1,Math.floor(z/(1e3*60*60*24))),G=L/N*100,B=x/N*100;[p,T,M].forEach(g=>{g&&(g.style.setProperty("--fill-start",`${G}%`),g.style.setProperty("--fill-end",`${B}%`))})},b=(L,x,v)=>{L.addEventListener("input",()=>{if(!c())return;const T=n();if(!T)return;const M=Math.floor((new Date(T.end).getTime()-new Date(T.start).getTime())/(1e3*60*60*24));let k=Number.parseInt(v?L.value:x.value,10),w=Number.parseInt(v?x.value:L.value,10);if(Number.isNaN(k)||Number.isNaN(w))return;k=Math.max(0,Math.min(k,M)),w=Math.max(0,Math.min(w,M)),v&&k>w?(w=k,x.value=String(w)):!v&&w<k&&(k=w,x.value=String(k)),m(k,w,T,v?L:x,v?x:L);const A=new Date(T.start);A.setDate(A.getDate()+k);const O=new Date(T.start);O.setDate(O.getDate()+w);const W=A.toISOString().split("T")[0],z=O.toISOString().split("T")[0];be&&window.clearTimeout(be),be=window.setTimeout(()=>{l?.(W,z)},300)})},E=L=>{const x=d[0],v=h[0];!x||!v||(L==="start"?(x.style.zIndex="4",v.style.zIndex="3"):(x.style.zIndex="3",v.style.zIndex="4"))};if(d.length&&h.length){d.forEach((v,T)=>{const M=h[T]||h[0];b(v,M,!0),v.addEventListener("pointerdown",()=>E("start"))}),h.forEach((v,T)=>{const M=d[T]||d[0];b(v,M,!1),v.addEventListener("pointerdown",()=>E("end"))}),d.forEach(v=>v.addEventListener("focus",()=>E("start"))),h.forEach(v=>v.addEventListener("focus",()=>E("end")));const L=(v,T)=>{v.addEventListener("pointerdown",M=>{if(!c())return;const k=n();if(!k)return;const w=v.getBoundingClientRect(),A=Math.min(1,Math.max(0,(M.clientX-w.left)/w.width)),O=Math.max(1,Math.floor((new Date(k.end).getTime()-new Date(k.start).getTime())/(1e3*60*60*24))),W=Number.parseInt(v.value,10),N=(Number.isNaN(W)?0:Math.max(0,Math.min(W,O)))/O;Math.abs(A-N)*w.width>14&&(M.preventDefault(),M.stopPropagation(),E(v===T?"end":"start"))})};if(L(d[0],h[0]),L(h[0],d[0]),c()){const v=n(),T=s?.();if(v&&T){const M=Math.max(0,Math.floor((new Date(T.start).getTime()-new Date(v.start).getTime())/864e5)),k=Math.max(0,Math.floor((new Date(T.end).getTime()-new Date(v.start).getTime())/(1e3*60*60*24))),w=d[0],A=h[0];w.value=String(M),A.value=String(Math.max(k,M)),m(M,Math.max(k,M),v,w,A)}}e.querySelectorAll(".dual-slider").forEach(v=>{v.addEventListener("pointermove",T=>{if(!c())return;const M=n();if(!M)return;const k=d[0],w=h[0];if(!k||!w)return;const A=v.getBoundingClientRect(),O=Math.min(1,Math.max(0,(T.clientX-A.left)/A.width)),W=Math.max(1,Math.floor((new Date(M.end).getTime()-new Date(M.start).getTime())/(1e3*60*60*24)));let z=Number.parseInt(k.value,10),N=Number.parseInt(w.value,10);Number.isNaN(z)&&(z=0),Number.isNaN(N)&&(N=W);const G=z/W,B=N/W,f=Math.abs(O-G)<=Math.abs(O-B);E(f?"start":"end")})})}}function pf(t,e){if(Aa){const n=t?e+16:16;Aa.style.right=`${n}px`}}const mf=!1;function Qo(t,e){document.querySelectorAll("[data-role='chart-container']").forEach(r=>{r.style.transition="padding 220ms ease, padding-right 220ms ease, transform 220ms ease",r.style.paddingRight=`${t}px`,typeof e=="number"&&(r.style.transform=`scale(${e})`,r.style.transformOrigin="center center")})}function Qn(t){const e=t.toLowerCase();return e==="historical"?"Historical":e==="ssp245"?"SSP245":e==="ssp370"?"SSP370":e==="ssp585"?"SSP585":t}function j(t){return new Date(t)}function ar(t){if(!t.length)return Tt("Historical");let e="1900-01-01",n="2100-12-31";return t.forEach((r,o)=>{const i=Tt(r);if(o===0){e=i.start,n=i.end;return}e=j(i.start)>j(e)?i.start:e,n=j(i.end)<j(n)?i.end:n}),{start:e,end:n}}function St(t,e){const n=j(t),r=j(e.start),o=j(e.end);return n<r?e.start:n>o?e.end:t}const kt=["Historical","SSP245","SSP370","SSP585"],xt=["ACCESS-CM2","CanESM5","CESM2","CMCC-CM2-SR5","EC-Earth3","GFDL-ESM4","INM-CM5-0","IPSL-CM6A-LR","MIROC6","MPI-ESM1-2-HR","MRI-ESM2-0"],Yt=["tas","pr","rsds","hurs","rlds","sfcWind","tasmin","tasmax"],gf={SSP245:"A moderate scenario (2015-2100) that assumes we take active measures against climate change. This represents a realistic path where significant climate protection policies are implemented, leading to moderate warming by the end of the century.",SSP370:"A moderate-to-high scenario (2015-2100) representing a middle ground. This path assumes some climate action is taken, but not enough to prevent substantial warming. It falls between optimistic and pessimistic outcomes.",SSP585:"A pessimistic scenario (2015-2100) representing a worst-case path with minimal climate action. This shows what happens if we continue with current trends and take little to no measures against climate change, leading to severe warming.",Historical:"Historical climate simulation (1950-2014) based on past conditions. This represents simulated climate data for the historical period, used as a baseline to compare against future projections."},yf={tas:"Near-Surface Air Temperature",pr:"Precipitation",rsds:"Surface Downwelling Shortwave Radiation",hurs:"Near-Surface Relative Humidity",rlds:"Surface Downwelling Longwave Radiation",sfcWind:"Daily-Mean Near-Surface Wind Speed",tasmin:"Daily Minimum Near-Surface Air Temperature",tasmax:"Daily Maximum Near-Surface Air Temperature"},vf={tas:"The air temperature near the Earth's surface, measured in Kelvin.",pr:"The amount of water that falls from the atmosphere to the surface, measured as mass per unit area per unit time.",rsds:"Incoming solar radiation reaching the Earth's surface, measured in Watts per square meter.",hurs:"The amount of moisture in the air relative to the maximum it can hold, expressed as a percentage.",rlds:"Incoming thermal radiation from the atmosphere, measured in Watts per square meter.",sfcWind:"The average wind speed near the surface over a day, measured in meters per second.",tasmin:"The lowest air temperature near the surface during a day, measured in Kelvin.",tasmax:"The highest air temperature near the surface during a day, measured in Kelvin."},xf={"ACCESS-CM2":"Developed by Australia's research institutions. This model is part of the global CMIP6 ensemble, providing climate projections that contribute to our understanding of future climate patterns.",CanESM5:"The Canadian Earth System Model version 5, developed by Environment and Climate Change Canada. This model represents North American climate research and contributes valuable projections to the global climate science community.",CESM2:"The Community Earth System Model version 2, developed by the National Center for Atmospheric Research (NCAR) in the United States. One of the most widely used models in climate research, known for its comprehensive representation of Earth's climate system.","CMCC-CM2-SR5":"Developed by the Euro-Mediterranean Center on Climate Change (CMCC) in Italy. This model provides European perspectives on climate change and is particularly valuable for understanding Mediterranean and European climate patterns.","EC-Earth3":"A collaborative European climate model developed by multiple research institutions across Europe. This model combines expertise from various European countries to provide comprehensive climate projections.","GFDL-ESM4":"Developed by NOAA's Geophysical Fluid Dynamics Laboratory in the United States. This model is known for its advanced representation of ocean and atmosphere interactions, providing detailed climate projections.","INM-CM5-0":"Developed by the Institute of Numerical Mathematics in Russia. This model contributes a unique perspective from Russian climate research to the global ensemble of climate models.","IPSL-CM6A-LR":"Developed by the Institut Pierre-Simon Laplace in France. This model is part of a long-standing French climate modeling tradition and provides important contributions to understanding global climate dynamics.",MIROC6:"Developed by a Japanese research consortium. This model represents Asian climate research expertise and contributes valuable insights, particularly for understanding climate patterns in the Asia-Pacific region.","MPI-ESM1-2-HR":"Developed by the Max Planck Institute in Germany. This high-resolution model provides detailed climate projections and is known for its sophisticated representation of Earth's climate system.","MRI-ESM2-0":"Developed by Japan's Meteorological Research Institute. This model contributes Japanese climate research expertise to the global ensemble, providing valuable perspectives on climate change projections."},dt=[{name:"Viridis",colors:["#440154","#3b528b","#21908d","#5dc863","#fde725"]},{name:"Magma",colors:["#000004","#3b0f70","#8c2981","#de4968","#fe9f6d"]},{name:"Cividis",colors:["#00204c","#31456a","#6b6d7f","#a59c8f","#fdea9b"]},{name:"Thermal",colors:["#04142f","#155570","#1fa187","#f8c932","#f16623"]}],$={page:{position:"relative",minHeight:"100vh",color:"white",overflow:"hidden",fontFamily:"Inter, system-ui, sans-serif"},bgLayer1:{position:"absolute",inset:0,background:"linear-gradient(135deg, #05070f, #0b1326)"},bgLayer2:{position:"absolute",inset:0,background:"radial-gradient(circle at 20% 20%, rgba(56,189,248,0.12), transparent 32%), radial-gradient(circle at 80% 10%, rgba(139,92,246,0.15), transparent 30%), radial-gradient(circle at 50% 70%, rgba(34,197,94,0.08), transparent 28%)"},bgOverlay:{position:"absolute",inset:0,background:"#050505",opacity:.35},branding:{position:"fixed",top:16,left:16,display:"flex",alignItems:"center",gap:12,padding:"8px 0",background:"transparent",border:"none",borderRadius:0,zIndex:"9999",boxShadow:"none",backdropFilter:"none",pointerEvents:"auto"},brandIcon:{width:38,height:38,position:"relative",display:"grid",placeItems:"center",filter:"drop-shadow(0 8px 18px rgba(0, 0, 0, 0.42))",transition:"transform 160ms ease, filter 160ms ease","--iris-x":"0px","--iris-y":"0px","--pupil-x":"0px","--pupil-y":"0px","--blink-open":"1"},brandSvg:{width:"100%",height:"100%",display:"block"},brandOutline:{stroke:"white",strokeWidth:5,strokeLinecap:"round",strokeLinejoin:"round",fill:"none",opacity:.92},brandLids:{transform:"translate(60px, 40px) scaleY(var(--blink-open, 1)) translate(-60px, -40px)",transformOrigin:"60px 40px",transition:"none"},brandClipRect:{transform:"translate(60px, 40px) scaleY(var(--blink-open, 1)) translate(-60px, -40px)",transformOrigin:"60px 40px",transition:"none"},brandIrisGroup:{transform:"translate(var(--iris-x, 0px), var(--iris-y, 0px))",transition:"none",transformBox:"fill-box",transformOrigin:"center center"},brandIris:{stroke:"white",strokeWidth:5,fill:"rgba(255, 255, 255, 0.08)"},brandPupilGroup:{transform:"translate(var(--pupil-x, 0px), var(--pupil-y, 0px))",transition:"none",transformOrigin:"center center"},brandEyeContent:{clipPath:"url(#brand-eye-clip)"},brandPupil:{fill:"white"},brandHighlight:{fill:"white",opacity:.92},brandName:{fontSize:18,fontWeight:700,letterSpacing:.6,color:"white",textTransform:"none",textShadow:"0 8px 20px rgba(0, 0, 0, 0.45)"},field:{minWidth:0,display:"flex",flexDirection:"column",gap:4},fieldLabel:{fontSize:11,letterSpacing:.5,color:"var(--text-secondary)",textTransform:"uppercase"},mapArea:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:10,textAlign:"center",pointerEvents:"none",zIndex:1},mapSearchWrap:{position:"absolute",top:18,left:"50%",transform:"translateX(-50%)",width:"min(360px, 70vw)",pointerEvents:"auto",zIndex:12,transition:"transform 220ms ease, width 220ms ease"},mapSearchResults:{maxHeight:220,overflowY:"auto"},mapMarker:{position:"absolute",left:0,top:0,width:28,height:36,pointerEvents:"none",zIndex:11,transform:"translate(-9999px, -9999px)",opacity:0,transition:"opacity 160ms ease",filter:"drop-shadow(0 10px 18px rgba(0,0,0,0.45))"},mapInfoPanel:{position:"absolute",left:0,top:0,width:360,maxWidth:"min(360px, 80vw)",opacity:0,userSelect:"none",transform:"translate(-9999px, -9999px)",transition:"opacity 160ms ease",zIndex:12},mapInfoHeader:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:8},mapInfoTitleGroup:{display:"flex",flexDirection:"column",gap:2,flex:1,minWidth:0},mapInfoActions:{display:"flex",gap:6,alignItems:"center"},mapInfoActionBtn:{width:30,height:30,borderRadius:8,border:"none",background:"transparent",color:"var(--text-secondary)",display:"inline-flex",alignItems:"center",justifyContent:"center",cursor:"pointer",pointerEvents:"auto",transition:"all 120ms ease"},mapInfoExpandBtn:{position:"absolute",right:12,bottom:12},mapInfoSubtitle:{fontSize:11.5,color:"var(--text-secondary)",marginTop:2},mapInfoBody:{marginTop:10,display:"flex",flexDirection:"column",gap:10,paddingBottom:36},mapInfoLoadingRow:{display:"flex",alignItems:"center",gap:8,fontSize:11,color:"var(--text-secondary)"},mapInfoLoadingSpinner:{width:14,height:14,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.18)",borderTop:"2px solid #34d399",animation:"sv-spin 1s linear infinite",flexShrink:0},drawOverlay:{position:"absolute",inset:0,background:"rgba(5, 10, 20, 0.28)",backdropFilter:"blur(1px)",pointerEvents:"none",zIndex:8},drawOverlayCanvas:{position:"absolute",inset:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:9},drawPrompt:{position:"absolute",top:16,left:"50%",transform:"translateX(-50%)",padding:"10px 14px",borderRadius:12,background:"rgba(15, 23, 42, 0.92)",border:"1px solid var(--border-medium)",boxShadow:"var(--shadow-elevated)",fontWeight:800,fontSize:13,color:"var(--text-primary)",pointerEvents:"none",zIndex:10,textAlign:"center"},drawPromptSub:{marginTop:4,fontSize:12,fontWeight:600,color:"var(--text-secondary)"},loadingIndicator:{position:"absolute",left:18,bottom:80,display:"flex",alignItems:"center",gap:12,padding:0,pointerEvents:"auto",zIndex:20,minWidth:160},loadingSpinner:{width:18,height:18,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.18)",borderTop:"2px solid #34d399",animation:"sv-spin 1s linear infinite",flexShrink:0},loadingTextGroup:{display:"flex",flexDirection:"column",gap:4,alignItems:"flex-start",minWidth:0},loadingText:{fontSize:12.5,fontWeight:700,color:"var(--text-primary)",letterSpacing:.3},loadingSubtext:{fontSize:11.5,color:"var(--text-secondary)",letterSpacing:.2},loadingBar:{position:"relative",width:120,height:6,borderRadius:999,background:"rgba(255, 255, 255, 0.08)",overflow:"hidden"},loadingBarFill:{position:"absolute",inset:0,borderRadius:999,background:"linear-gradient(90deg, rgba(52, 211, 153, 0.9), rgba(125, 211, 252, 0.9))",transition:"width 140ms ease",width:"0%"},compareInfoWrap:{position:"fixed",right:24,bottom:88,display:"flex",alignItems:"center",pointerEvents:"auto",zIndex:1e4},compareInfoButton:{padding:0,background:"transparent",border:"none",color:"var(--text-primary)",fontWeight:700,fontSize:13,letterSpacing:.2,cursor:"pointer",textDecoration:"underline"},infoModalOverlay:{position:"fixed",inset:0,background:"transparent",backdropFilter:"none",zIndex:200,display:"flex",alignItems:"center",justifyContent:"center",padding:16},infoModal:{width:"min(480px, 92vw)",background:"rgba(12, 16, 24, 0.98)",border:"1px solid var(--border-default)",borderRadius:14,boxShadow:"var(--shadow-elevated)",color:"var(--text-primary)",padding:20,position:"relative",maxWidth:"520px"},infoModalHeader:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,marginBottom:12},infoModalTitle:{fontSize:16,fontWeight:900,letterSpacing:.2,background:"var(--gradient-accent)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",color:"transparent"},infoModalClose:{width:32,height:32,borderRadius:8,border:"none",background:"transparent",color:"var(--text-secondary)",cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",fontWeight:700},infoModalBody:{fontSize:14,lineHeight:1.6,color:"var(--text-primary)",display:"block",textAlign:"left",whiteSpace:"normal",wordBreak:"break-word"},infoModalFooter:{marginTop:18,display:"flex",justifyContent:"center"},infoModalConfirm:{padding:"10px 16px",borderRadius:10,border:"1px solid var(--accent-border)",background:"var(--gradient-primary)",color:"white",fontWeight:700,cursor:"pointer",boxShadow:"var(--shadow-combined)"},canvasToggle:{position:"fixed",top:14,display:"flex",alignItems:"center",gap:8,pointerEvents:"auto",zIndex:100,transition:"right 0.25s ease"},canvasSwitch:{position:"relative",display:"grid",gridTemplateColumns:"1fr 1fr",gap:0,padding:3,borderRadius:11,background:"var(--dark-bg)",border:"var(--border-base)",boxShadow:"var(--shadow-elevated)",zIndex:101},canvasIndicator:{position:"absolute",top:3,bottom:3,left:3,width:"calc(50% - 3px)",borderRadius:9,background:"var(--gradient-indicator)",boxShadow:"var(--shadow-canvas), var(--shadow-inset)",transition:"transform 180ms ease",zIndex:0,pointerEvents:"none"},canvasBtn:{width:40,height:40,borderRadius:9,border:"1px solid transparent",background:"var(--bg-transparent)",color:"var(--text-secondary)",cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",transition:"color 120ms ease",position:"relative",zIndex:1},canvasBtnActive:{color:"white"},mapTitle:{fontSize:18,fontWeight:600},mapSubtitle:{fontSize:14,color:"var(--text-secondary)"},modeSwitch:{position:"relative",display:"grid",gridTemplateColumns:"1fr 1fr",gap:4,padding:2,borderRadius:10,border:"1px solid var(--border-subtle)",background:"var(--bg-subtle)",boxShadow:"none"},modeIndicator:{position:"absolute",top:2,bottom:2,left:2,width:"calc(50% - 2px)",borderRadius:8,background:"var(--gradient-mode-indicator)",boxShadow:"var(--shadow-combined)",transition:"transform 200ms ease",zIndex:0},modeBtn:{flex:1,padding:"8px 0",borderRadius:8,border:"none",color:"var(--text-secondary)",cursor:"pointer",transition:"all 0.15s ease",background:"var(--bg-transparent)",textAlign:"center",fontSize:12.5,fontWeight:700,letterSpacing:.2,outline:"none",boxShadow:"none",position:"relative",zIndex:1},modeBtnActive:{background:"var(--gradient-primary)",border:"none",color:"white",boxShadow:"var(--shadow-combined)"},tabSwitch:{position:"absolute",left:32,right:12,bottom:-8,display:"flex",gap:10,padding:"0 8px",alignItems:"flex-end",pointerEvents:"auto",zIndex:0},tabBtn:{borderRadius:"14px 14px 0 0",padding:"12px 18px",background:"var(--bg-strong)",color:"var(--text-secondary)",fontWeight:700,fontSize:13,letterSpacing:.35,cursor:"pointer",transition:"all 0.18s ease",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.06), 0 8px 18px rgba(0,0,0,0.32)",borderTop:"var(--border-base)",borderRight:"var(--border-base)",borderLeft:"var(--border-base)",borderBottom:"none",transform:"translateY(4px)"},tabBtnActive:{background:"var(--gradient-tab-active)",color:"white",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.12), 0 12px 26px rgba(0,0,0,0.42)",borderTop:"var(--border-active)",borderRight:"var(--border-active)",borderLeft:"var(--border-active)",borderBottom:"none",transform:"translateY(-4px)",zIndex:1},modeViewport:{overflow:"hidden",width:"100%",position:"relative",flex:1,minHeight:0,height:0},modeTrack:{display:"grid",gridTemplateColumns:"1fr 1fr",width:"200%",height:"100%",transition:"transform 220ms ease"},modePane:{width:"100%",height:"100%",paddingRight:4,overflowY:"auto",overflowX:"hidden",scrollbarGutter:"stable",minHeight:0,maxHeight:"100%"},chatBox:{display:"flex",alignItems:"center",gap:10,padding:"12px 14px",borderRadius:14,border:"1px solid var(--border-default)",background:"rgba(15,18,25,0.96)",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.05), 0 8px 20px rgba(0,0,0,0.38)"},chatInput:{flex:1,padding:"12px 0",borderRadius:8,border:"none",background:"var(--bg-transparent)",color:"white",fontSize:14,lineHeight:1.4,outline:"none",minHeight:24},chatSend:{padding:"10px 14px",borderRadius:12,border:"1px solid var(--accent-border-strong)",background:"var(--gradient-primary)",color:"white",fontWeight:700,fontSize:14,letterSpacing:.1,cursor:"pointer",boxShadow:"0 10px 22px rgba(0,0,0,0.38), var(--shadow-inset)",transition:"transform 120ms ease, box-shadow 120ms ease"},chatStack:{display:"flex",flexDirection:"column",gap:12},chatLead:{fontSize:13,color:"var(--text-secondary)",lineHeight:1.45,marginTop:10},chatMessages:{display:"flex",flexDirection:"column",gap:10,padding:"4px 0 6px",paddingRight:0,width:"100%",boxSizing:"border-box"},chatBubble:{maxWidth:"100%",width:"fit-content",padding:"16px 16px",borderRadius:12,fontSize:13,lineHeight:1.4,boxShadow:"0 6px 14px rgba(0,0,0,0.3)",boxSizing:"border-box"},chatBubbleUser:{alignSelf:"flex-end",background:"var(--gradient-chat-user)",border:"1px solid rgba(125,211,252,0.45)",color:"white",marginRight:26},chatBubbleAgent:{alignSelf:"flex-start",background:"rgba(20,24,31,0.95)",border:"1px solid var(--border-medium)",color:"var(--text-primary)"},sectionTitle:{fontSize:13,fontWeight:700,color:"var(--text-primary)",letterSpacing:.3,textTransform:"uppercase"},paramGrid:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},range:{width:"100%",background:"var(--bg-transparent)",appearance:"none",WebkitAppearance:"none",height:10,outline:"none",padding:0,margin:0},resolutionRow:{display:"flex",alignItems:"center",gap:12},resolutionValue:{fontSize:12.5,color:"var(--text-secondary)",minWidth:60,textAlign:"right"},chartPanel:{width:"min(1200px, 100%)",background:"transparent",border:"none",borderRadius:0,padding:0,boxShadow:"none",backdropFilter:"none"},chartHeader:{textAlign:"center",marginBottom:12},chartTitle:{fontSize:18,fontWeight:800,color:"var(--text-primary)"},chartPlotWrapper:{width:"100%",minHeight:360,background:"transparent",border:"none",borderRadius:0,padding:0,position:"relative"},chartEmpty:{textAlign:"center",color:"var(--text-secondary)",padding:"40px 16px",lineHeight:1.6},chartError:{color:"#fca5a5",background:"rgba(248,113,113,0.08)",border:"1px solid rgba(248,113,113,0.35)",borderRadius:12,padding:14,fontSize:13,lineHeight:1.5},chipRow:{display:"flex",flexWrap:"wrap",gap:8},chip:{padding:"8px 10px",borderRadius:12,border:"1px solid var(--border-medium)",background:"rgba(255,255,255,0.04)",color:"var(--text-primary)",cursor:"pointer",fontSize:12.5,fontWeight:700,letterSpacing:.2,transition:"all 140ms ease"},chipActive:{borderColor:"rgba(167,139,250,0.65)",background:"rgba(167,139,250,0.16)",boxShadow:"0 0 0 1px rgba(167,139,250,0.35)"},chartLegend:{display:"flex",gap:12,flexWrap:"wrap",alignItems:"center",marginTop:10,fontSize:12,color:"var(--text-secondary)"}},a={mode:"Explore",panelTab:"Manual",sidebarOpen:!0,canvasView:"map",scenario:kt[0],model:xt[0],variable:Yt[0],date:"2000-01-01",palette:dt[0].name,resolution:2,selectedUnit:je(Yt[0]).label,chartMode:"single",chartDate:"2026-01-16",chartRangeStart:"2015-01-01",chartRangeEnd:"2099-01-01",chartVariable:Yt[0],chartUnit:je(Yt[0]).label,chartScenarios:["SSP245","SSP370","SSP585"],chartModels:[...xt],chartDropdown:{scenariosOpen:!1,modelsOpen:!1},chartLoadingProgress:{total:0,done:0},chartSamples:[],chartBoxes:null,chartRangeSeries:null,chartLoading:!1,chartError:null,chartLocation:"World",chartLocationName:null,chartLocationSearchQuery:"",chartLocationSearchResults:[],chartLocationSearchLoading:!1,chartLocationSearchError:null,mapLocationSearchQuery:"",mapLocationSearchResults:[],mapLocationSearchLoading:!1,mapLocationSearchError:null,mapLocationSearchSelection:null,mapLocationSearchFocused:!1,mapLocationSearchCursor:{start:0,end:0},mapMarker:null,mapInfoSamples:[],mapInfoBoxes:null,mapInfoLoading:!1,mapInfoError:null,mapInfoLoadingProgress:{total:0,done:0},mapInfoOpen:!1,mapPolygon:null,chartPolygon:null,chartPoint:null,drawState:{active:!1,points:[],previewPoint:null},pointSelectActive:!1,chatInput:"",chatMessages:[],compareMode:"Scenarios",availableModels:[],compareScenarioA:"SSP245",compareScenarioB:"SSP585",compareModelA:xt[0],compareModelB:xt[1]??xt[0],compareDateStart:"1962-06-28",compareDateEnd:"2007-06-28",isLoading:!1,loadingProgress:0,dataError:null,currentData:null,apiAvailable:null,dataMin:null,dataMax:null,timeRange:null,metaData:void 0,compareInfoOpen:!1};let da=null,yt=null,De=null,tt=null,pn=null,re=null,Kt=null,oe=null,Ft=null,de=null,mn=0,fe=null,gn=0,ce=0,Jt=null;const zr=500;function wf(t){return t.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}function S(t){return Object.entries(t).filter(([,e])=>e!=null).map(([e,n])=>{const r=e.startsWith("--")?e:wf(e),o=typeof n=="number"?`${n}px`:String(n);return`${r}:${o}`}).join(";")}function lt(...t){return t.reduce((e,n)=>n?{...e,...n}:e,{})}function vt(t){return t.replace(/[&<>"']/g,e=>{switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return e}})}function ee(t){const e=new Date(t);return Number.isNaN(e.getTime())?t:e.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}function Zn(t,e){return e?.variable_metadata?.[t]?.name||e?.variable_metadata?.[t]?.description||t}function bf(t){const e=Zn(t.variable,t.metaData),n=t.selectedUnit||t.metaData?.variable_metadata?.[t.variable]?.unit||"",r=n?`${n}`:"the dataset's native units";switch(t.compareMode){case"Dates":{const o=ee(t.compareDateStart),i=ee(t.compareDateEnd);return{title:"Comparing two dates",paragraphs:[`We are comparing ${e} on ${o} versus ${i} under the ${t.scenario} scenario using the ${t.model} model.`,`Values on the map represent ${i} minus ${o} in ${r}. A value of X means ${e} was X ${n||""} higher on ${i} than on ${o} (negative values mean it was lower).`]}}case"Models":{const o=ee(t.date);return{title:"Comparing two models",paragraphs:[`We are comparing ${e} between ${t.compareModelB} and ${t.compareModelA} on ${o} within the ${t.scenario} scenario.`,`Each value shows ${t.compareModelB} minus ${t.compareModelA} in ${r}. Positive numbers mean ${e} is higher in ${t.compareModelB}; negative means it is higher in ${t.compareModelA}.`]}}default:{const o=ee(t.date),i=t.compareScenarioA,s=t.compareScenarioB;return{title:"Comparing two scenarios",paragraphs:[`We are comparing ${e} for ${s} versus ${i} on ${o} using the ${t.model} model.`,`Values show ${s} minus ${i} in ${r}. A value of X means ${e} is X ${n||""} higher under ${s} than under ${i}; negative values mean it is lower.`]}}}}function Sf(t){if(t.mode!=="Compare"||t.canvasView!=="map")return"";const e=bf(t),n=e.paragraphs.map((c,u)=>{const h=u===e.paragraphs.length-1?"0":"0 0 12px 0",p=c.replace(/(\bX\b|ΔX)/g,'<span style="color: var(--accent-purple);">$1</span>');return`<p style="display:block; margin:${h}; line-height:1.6; white-space: normal; word-break: break-word;">${p}</p>`}).join(""),r=t.sidebarOpen?gt+24:24,o=t.mode==="Compare"&&t.compareMode==="Dates"?120:88,i=lt($.infoModalOverlay,{left:"0",right:"0",width:"100%",justifyContent:"center",paddingLeft:0}),s=lt($.infoModal,{alignSelf:"center",marginLeft:"auto",marginRight:"auto"}),l=t.compareInfoOpen?`
      <div data-role="compare-info-overlay" class="compare-info-overlay" style="${S(i)}">
        <div style="${S(s)}" role="dialog" aria-modal="true" aria-label="${e.title}">
          <div style="${S($.infoModalHeader)}">
            <div style="${S($.infoModalTitle)}">${e.title}</div>
            <button type="button" data-action="close-compare-info" style="${S($.infoModalClose)}" aria-label="Close info dialog">✕</button>
          </div>
          <div style="${S($.infoModalBody)}">
            ${n}
          </div>
          <div style="${S($.infoModalFooter)}">
            <button type="button" data-action="close-compare-info" style="${S($.infoModalConfirm)}">Got it</button>
          </div>
        </div>
      </div>
    `:"";return`
      <div data-role="compare-info-trigger" style="${S(lt($.compareInfoWrap,{right:r,bottom:o}))}">
        <button type="button" data-action="open-compare-info" style="${S($.compareInfoButton)}">
          What am I seeing?
        </button>
      </div>
      ${l}
    `}async function Mf(){try{const t=await nf();a.apiAvailable=t}catch{a.apiAvailable=!1}}function $f(t){if(t==="Historical")return"2000-01-01";const e=new Date,n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return n<2015?"2015-01-01":n>2100?"2100-12-31":`${n}-${r}-${o}`}function Tt(t){return t==="Historical"?{start:"1950-01-01",end:"2014-12-31"}:{start:"2015-01-01",end:"2099-12-31"}}function $e(t,e){const n=Tt(e),r=new Date(t),o=new Date(n.start),i=new Date(n.end);return r<o?n.start:r>i?n.end:t}function Tf(t){let e=1/0,n=-1/0;for(let r=0;r<t.length;r++){const o=t[r];isFinite(o)&&(e=Math.min(e,o),n=Math.max(n,o))}if(!isFinite(e)||!isFinite(n))throw new Error("No valid numeric values returned from dataset.");return{min:e,max:n}}function fa(t,e){let n=0,r=0;for(let o=0;o<t.length;o++){const i=t[o];if(!isFinite(i))continue;const s=e==="hurs"?Math.min(i,100):i;n+=s,r+=1}if(!r)throw new Error("No valid numeric values returned from dataset.");return n/r}function Zo(t,e){let n=!1;for(let r=0,o=e.length-1;r<e.length;o=r++){const i=e[r].lon,s=e[r].lat,l=e[o].lon,c=e[o].lat;s>t.lat!=c>t.lat&&t.lon<(l-i)*(t.lat-s)/(c-s+Number.EPSILON)+i&&(n=!n)}return n}function Tn(t,e,n,r){const[o,i]=n,s=360/i,l=150/o;let c=0,u=0;for(let d=0;d<o;d++){const h=90-d*l-l/2;for(let p=0;p<i;p++){const m=p*s+s/2,b=m>180?m-360:m,E=(o-1-d)*i+p,L=t[E];if(!isFinite(L))continue;const x=e==="hurs"?Math.min(L,100):L;Zo({lat:h,lon:b},r)&&(c+=x,u+=1)}}if(!u)throw new Error("The selected region does not contain valid data points.");return c/u}function kf(t,e,n=.75){const r=t.lat-e.lat,o=t.lon-e.lon;return Math.hypot(r,o)<=n}function kn(t,e,n,r){const[o,i]=n,l=((r.lon+360)%360+360)%360/360*i-.5,c=(90-r.lat)/150*o-.5,u=(L,x,v)=>Math.min(v,Math.max(x,L)),d=u(Math.round(l),0,i-1),h=u(Math.round(c),0,o-1),p=(L,x)=>(o-1-x)*i+L,m=(L,x)=>{const v=(L%i+i)%i,T=u(x,0,o-1),M=p(v,T),k=t[M];return Number.isFinite(k)?k:null};let b=m(d,h);if(b===null){let x=null;for(let v=1;v<=3&&x===null;v++)for(let T=-v;T<=v;T++){for(let M=-v;M<=v;M++){if(Math.abs(M)!==v&&Math.abs(T)!==v)continue;const k=m(d+M,h+T);if(k!==null){x=k;break}}if(x!==null)break}b=x}if(b===null)throw new Error("No valid data at the selected point.");const E=e==="hurs"?Math.min(b,100):b;if(!Number.isFinite(E))throw new Error(`Invalid value at point: ${E}`);return E}function ae(){return{active:!1,points:[],previewPoint:null}}function Jo(t){De||(De=e=>{e.key==="Enter"&&a.drawState.active&&(e.preventDefault(),t())},window.addEventListener("keydown",De))}function Jn(){De&&(window.removeEventListener("keydown",De),De=null)}function rr(t){const e=a.drawState.active||a.pointSelectActive,n=a.metaData?.variable_metadata[a.variable]?.unit||"";uf(t,a.currentData,n,a.variable,a.selectedUnit,{drawMode:e,onDrawClick:a.pointSelectActive?qf:zf,onDrawMove:a.drawState.active?Vf:void 0,onMapClick:Uf,onTransform:()=>{ta(),qr(),zn()}}),qr(),zn()}function ta(){if(!tt)return;const t=tt.querySelector("#draw-overlay-canvas"),e=yt||tt.querySelector("#map-canvas");if(!t||!e)return;const n=e.getBoundingClientRect(),r=window.devicePixelRatio||1;t.width=n.width*r,t.height=n.height*r,t.style.width=`${n.width}px`,t.style.height=`${n.height}px`;const o=t.getContext("2d");if(!o)return;o.save(),o.scale(r,r),o.clearRect(0,0,n.width,n.height);let i=[];if(a.drawState.active){const l=[...a.drawState.points];i=a.drawState.previewPoint?[...l,a.drawState.previewPoint]:l}else if(a.mapPolygon&&a.mapPolygon.length>=3)i=a.mapPolygon;else{o.restore();return}const s=[];if(i.forEach(l=>{const c=$n(e,l.lon,l.lat);c&&s.push(c)}),!s.length){o.restore();return}o.lineWidth=2,o.strokeStyle="#34d399",o.fillStyle="rgba(52,211,153,0.18)",o.beginPath(),o.moveTo(s[0].x,s[0].y);for(let l=1;l<s.length;l++)o.lineTo(s[l].x,s[l].y);s.length>2&&(o.closePath(),o.fill()),o.stroke(),a.drawState.active&&s.forEach(({x:l,y:c},u)=>{o.beginPath(),o.fillStyle=u===0?"#10b981":"#34d399",o.arc(l,c,4,0,Math.PI*2),o.fill(),o.strokeStyle="#0f172a",o.lineWidth=1,o.stroke()}),o.restore()}function Lf(){return a.drawState.active||a.mapPolygon!==null&&a.mapPolygon.length>=3?`
      <canvas
        id="draw-overlay-canvas"
        style="${S($.drawOverlayCanvas)}"
      ></canvas>
    `:""}function qr(){if(!tt)return;const t=tt.querySelector("#point-overlay-marker"),e=yt||tt.querySelector("#map-canvas");!t||!e||!a.pointSelectActive||(t.style.left="0px",t.style.top="0px",t.style.right="0px",t.style.bottom="0px",t.style.width="100%",t.style.height="100%")}function zn(){if(!tt)return;const t=tt.querySelector("#map-location-marker"),e=tt.querySelector("#map-info-panel"),n=yt||tt.querySelector("#map-canvas");if(!n)return;const r=a.mapPolygon!==null&&a.mapPolygon.length>=3;if(t)if(!a.mapMarker)t.style.opacity="0",t.style.transform="translate(-9999px, -9999px)",t.title="Selected location";else{const o=$n(n,a.mapMarker.lon,a.mapMarker.lat);t.title=a.mapMarker.name?a.mapMarker.name:`Pixel ${a.mapMarker.pixel.x}, ${a.mapMarker.pixel.y}`,o?(t.style.opacity="1",t.style.transform=`translate(${o.x}px, ${o.y}px) translate(-50%, -100%)`):(t.style.opacity="0",t.style.transform="translate(-9999px, -9999px)")}if(e&&a.mapInfoOpen){const o=n.getBoundingClientRect(),i=e.offsetWidth||360,s=e.offsetHeight||240,l=12;let c,u;if(a.mapMarker){const p=$n(n,a.mapMarker.lon,a.mapMarker.lat);if(!p){e.style.opacity="0",e.style.transform="translate(-9999px, -9999px)",e.style.pointerEvents="none",e.style.visibility="hidden";return}c=p.x-i-24,c<l&&(c=p.x+24),u=p.y-s/2}else if(r&&a.mapPolygon){let p=a.mapPolygon[0];for(const b of a.mapPolygon)b.lon<p.lon&&(p=b);const m=$n(n,p.lon,p.lat);m?(c=m.x-i-24,c<l&&(c=m.x+24),u=m.y-s/2):(c=o.width-i-l-24,u=o.height/2-s/2)}else{e.style.opacity="0",e.style.transform="translate(-9999px, -9999px)",e.style.pointerEvents="none",e.style.visibility="hidden";return}c=Math.max(l,Math.min(c,o.width-i-l)),u=Math.max(l,Math.min(u,o.height-s-l));const d=e.style.left,h=e.style.top;(!d||d==="0px"||!h||h==="0px")&&(e.style.left=`${c}px`,e.style.top=`${u}px`),e.style.opacity="1",e.style.transform="translate(0, 0)",e.style.pointerEvents="none",e.style.visibility="visible"}else e&&!a.mapInfoOpen&&(e.style.opacity="0",e.style.transform="translate(-9999px, -9999px)",e.style.pointerEvents="none",e.style.visibility="hidden")}function ti(){if(!tt)return;const t=tt.querySelector('[data-role="map-location-search"]');if(!t)return;const e=a.sidebarOpen?-gt/2:0;t.style.transform=`translateX(calc(-50% + ${e}px))`}function Df(){return a.pointSelectActive?`
      <div style="${S($.drawOverlay)}"></div>
      <div
        id="point-overlay-marker"
        style="${S({position:"absolute",inset:0,pointerEvents:"none",zIndex:9})}"
      ></div>
      <div style="${S($.drawPrompt)}">
        <div>Click a point to sample</div>
        <div style="${S($.drawPromptSub)}">
          The chart will load data for this single location
        </div>
      </div>
    `:""}function _f(){const t=a.mapMarker,e=t?.name?vt(t.name):t?`Pixel ${t.pixel.x}, ${t.pixel.y}`:"Selected location";return`
      <div
        id="map-location-marker"
        style="${S($.mapMarker)}"
        aria-hidden="true"
        title="${e}"
      >
        <svg
          viewBox="0 0 28 36"
          width="28"
          height="36"
          aria-hidden="true"
          focusable="false"
        >
          <defs>
            <linearGradient id="map-marker-gradient" x1="0" x2="1">
              <stop offset="0%" stop-color="var(--accent-blue)" />
              <stop offset="100%" stop-color="var(--accent-purple)" />
            </linearGradient>
          </defs>
          <path
            d="M14 2C8.48 2 4 6.48 4 12c0 7.72 8.4 19.3 9.1 20.25.5.68 1.3.68 1.8 0C15.6 31.3 24 19.72 24 12 24 6.48 19.52 2 14 2Z"
            fill="url(#map-marker-gradient)"
          />
          <circle cx="14" cy="12" r="4.5" fill="rgba(9, 14, 28, 0.9)" />
          <circle cx="14" cy="12" r="3" fill="white" opacity="0.9" />
        </svg>
      </div>
    `}function ei(){const t=a.mapMarker!==null,e=a.mapPolygon!==null&&a.mapPolygon.length>=3;if(!t&&!e)return`<div style="${S($.chartEmpty)}">Click a location or draw a region to load boxplots.</div>`;if(a.mapInfoLoading){const n=a.mapInfoLoadingProgress.total>0?`${a.mapInfoLoadingProgress.done}/${a.mapInfoLoadingProgress.total} datasets loaded`:"Preparing datasets",r=a.mapInfoBoxes&&a.mapInfoBoxes.length?Kr(a.mapInfoBoxes,a.selectedUnit):`<div style="${S($.chartEmpty)}">Loading boxplots...</div>`;return`
          <div style="${S($.mapInfoLoadingRow)}">
            <div style="${S($.mapInfoLoadingSpinner)}"></div>
            <div>${n}</div>
          </div>
          ${r}
        `}return a.mapInfoError?`<div style="${S($.chartError)}">${vt(a.mapInfoError)}</div>`:!a.mapInfoBoxes||!a.mapInfoBoxes.length?`<div style="${S($.chartEmpty)}">Click a location to load boxplots.</div>`:Kr(a.mapInfoBoxes,a.selectedUnit)}function Ef(){if(!a.mapInfoOpen)return"";const t=a.mapMarker,n=a.mapPolygon!==null&&a.mapPolygon.length>=3?"Drawn Region":t?.name?t.name:t?`Pixel ${t.pixel.x}, ${t.pixel.y}`:"Selected location",r=Zn(a.variable,a.metaData),o=`${n} · ${r}`,i=`${ee(a.date)} · ${a.selectedUnit}`;return`
      <div id="map-info-panel" class="custom-select-info-panel map-info-panel" style="${S($.mapInfoPanel)}">
        <div style="${S($.mapInfoHeader)}">
          <div style="${S($.mapInfoTitleGroup)}">
            <div class="custom-select-info-panel-title">${vt(o)}</div>
            <div style="${S($.mapInfoSubtitle)}">${vt(i)}</div>
          </div>
          <div style="${S($.mapInfoActions)}">
            <button
              type="button"
              data-action="close-map-info"
              aria-label="Close info"
              style="${S($.mapInfoActionBtn)}"
              onmouseover="this.style.color='var(--text-primary)';this.style.background='rgba(15, 23, 42, 0.85)';"
              onmouseout="this.style.color='var(--text-secondary)';this.style.background='transparent';"
            >
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M6 6l12 12M18 6l-12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </button>
          </div>
        </div>
        <div class="map-info-body" style="${S($.mapInfoBody)}">
          ${ei()}
        </div>
        <button
          type="button"
          data-action="open-map-info-chart"
          aria-label="Open chart view"
          style="${S({...$.mapInfoActionBtn,...$.mapInfoExpandBtn})}"
          onmouseover="this.style.color='var(--text-primary)';this.style.background='rgba(15, 23, 42, 0.85)';"
          onmouseout="this.style.color='var(--text-secondary)';this.style.background='transparent';"
        >
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M9 5H5v4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M15 5h4v4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M9 19H5v-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M15 19h4v-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    `}function Hr(){a.chartLocation="Draw",a.chartPolygon=null,a.chartLocationName=null,a.chartLocationSearchResults=[],a.chartLocationSearchQuery="",a.chartLocationSearchError=null,a.chartLocationSearchLoading=!1,a.chartError=null,a.pointSelectActive=!1,a.drawState={active:!0,points:[],previewPoint:null},a.canvasView="map",Jo(ii),U(),Ct()}function qn(){a.drawState=ae(),Jn()}function Cf(){a.canvasView==="map"&&(a.mapPolygon=null,a.mapMarker=null,a.mapInfoOpen=!1,a.drawState={active:!0,points:[],previewPoint:null},a.pointSelectActive=!1,Jo(ni),U())}function Pf(){a.drawState=ae(),Jn()}function ni(){if(a.drawState.active){if(a.drawState.points.length<3){a.mapInfoError="Draw at least three points to define a region.",a.mapInfoOpen=!0,U();return}a.mapPolygon=a.drawState.points,a.mapMarker=null,a.drawState=ae(),Jn(),a.mapInfoError=null,a.mapInfoOpen=!0,U(),Te()}}function Wr(){a.chartLocation="Point",a.chartPolygon=null,a.chartPoint=null,a.chartLocationName=null,a.chartLocationSearchResults=[],a.chartLocationSearchQuery="",a.chartLocationSearchError=null,a.chartLocationSearchLoading=!1,a.chartError=null,a.drawState=ae(),a.chartUnit=je(a.chartVariable).label,a.pointSelectActive=!0,a.canvasView="map",U(),Ct()}function Hn(){a.pointSelectActive=!1}async function ai(t){const e=t.trim();if(!e)return[];const n=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(e)}&limit=5&addressdetails=1`,r=await fetch(n,{headers:{Accept:"application/json","User-Agent":"climate-visualization-app/1.0"}});if(!r.ok)throw new Error("Location search failed. Please try again.");return(await r.json()).map(i=>({displayName:i.display_name,lat:Number(i.lat),lon:Number(i.lon)})).filter(i=>Number.isFinite(i.lat)&&Number.isFinite(i.lon))}async function If(t,e){const n=`https://nominatim.openstreetmap.org/reverse?format=json&lat=${t}&lon=${e}&addressdetails=1`,r=await fetch(n,{headers:{Accept:"application/json","User-Agent":"climate-visualization-app/1.0"}});return r.ok&&(await r.json()).display_name||null}function Af(t){de!==null&&(window.clearTimeout(de),de=null),a.chartLocation="Search",a.chartPoint={lat:t.lat,lon:t.lon},a.chartLocationName=t.displayName,a.chartLocationSearchError=null,a.chartLocationSearchResults=[],a.chartLocationSearchLoading=!1,a.chartLocationSearchQuery="",a.chartError=null,a.chartPolygon=null,a.pointSelectActive=!1,a.drawState=ae(),a.canvasView="chart",qn(),Hn(),U(),Ut()}async function Rf(t){const e=t.trim(),n=++mn;if(a.chartLocation="Search",a.chartLocationSearchQuery=t,a.chartLocationSearchError=null,a.chartLocationSearchResults=[],a.chartLocationName=null,a.chartPoint=null,a.chartError=null,a.chartPolygon=null,a.pointSelectActive=!1,a.drawState=ae(),a.canvasView="chart",qn(),Hn(),!e){a.chartLocationSearchLoading=!1,a.chartLocationSearchResults=[],a.chartLocationSearchError=null,U();return}a.chartLocationSearchLoading=!0,U();try{const r=await ai(e);if(n!==mn)return;a.chartLocationSearchResults=r,r.length||(a.chartLocationSearchError="No places found for that query.")}catch(r){if(n!==mn)return;a.chartLocationSearchError=r instanceof Error?r.message:"Search failed."}finally{if(n!==mn)return;a.chartLocationSearchLoading=!1,U()}}function ri(t,e,n){const[r,o]=Je(t,e);a.mapMarker={lat:t,lon:e,name:n,pixel:{x:r,y:o}}}function Nf(t){if(fe!==null&&(window.clearTimeout(fe),fe=null),a.mapLocationSearchError=null,a.mapLocationSearchResults=[],a.mapLocationSearchLoading=!1,a.mapLocationSearchQuery=t.displayName,a.mapLocationSearchSelection=t.displayName,a.mapLocationSearchFocused=!0,ri(t.lat,t.lon,t.displayName),U(),yt){const e=Math.max(Go(),3.2);Ko(yt,t.lon,t.lat,e),zn()}oi()}async function Ff(t){const e=t.trim(),n=++gn;if(a.mapLocationSearchQuery=t,a.mapLocationSearchError=null,a.mapLocationSearchResults=[],a.mapLocationSearchSelection=null,!e){a.mapLocationSearchLoading=!1,a.mapLocationSearchResults=[],a.mapLocationSearchError=null,U();return}a.mapLocationSearchLoading=!0,U();try{const r=await ai(e);if(n!==gn)return;a.mapLocationSearchResults=r,r.length||(a.mapLocationSearchError="No places found for that query.")}catch(r){if(n!==gn)return;a.mapLocationSearchError=r instanceof Error?r.message:"Search failed."}finally{if(n!==gn)return;a.mapLocationSearchLoading=!1,U()}}function Bf(t){if(a.mapMarker&&(a.mapMarker.name=t),!tt)return;const e=tt.querySelector("#map-location-marker");if(e&&a.mapMarker&&(e.title=t),a.mapInfoOpen&&a.mapMarker){const n=tt.querySelector(".custom-select-info-panel-title");if(n){const r=Zn(a.variable,a.metaData),i=`${t} · ${r}`;n.textContent=i}}}async function Uf(t){if(a.canvasView==="map"&&!(a.drawState.active||a.pointSelectActive)){if(a.mapPolygon=null,ri(t.lat,t.lon,null),yt){const e=Math.max(Go(),3.2);Ko(yt,t.lon,t.lat,e),zn()}oi();try{const e=await If(t.lat,t.lon);e&&Bf(e)}catch(e){console.error("Failed to fetch reverse geocode:",e)}}}function oi(t=700){Jt!==null&&(window.clearTimeout(Jt),Jt=null);const e=a.mapInfoOpen;if(a.mapInfoOpen=!1,e&&tt){const n=tt.querySelector("#map-info-panel");n&&(n.style.opacity="0",n.style.transform="translate(-9999px, -9999px)",n.style.pointerEvents="none",n.style.visibility="hidden")}Jt=window.setTimeout(()=>{Jt=null;const n=a.mapMarker!==null,r=a.mapPolygon!==null&&a.mapPolygon.length>=3;!n&&!r||(a.mapInfoOpen=!0,U(),Te())},t)}function Of(){Jt!==null&&(window.clearTimeout(Jt),Jt=null),ce+=1,a.mapInfoOpen=!1,a.mapInfoLoading=!1,U()}function ha(t){a.mapInfoSamples=t;try{a.mapInfoBoxes=Ke(t,a.variable,a.selectedUnit)}catch{return}if(!tt){U();return}const e=tt.querySelector("#map-info-panel");if(e){const n=e.querySelector(".map-info-body");if(n){n.innerHTML=ei();return}}U()}async function Te(){if(a.canvasView!=="map")return;const t=a.mapMarker!==null,e=a.mapPolygon!==null&&a.mapPolygon.length>=3;if(!t&&!e){a.mapInfoLoading=!1,a.mapInfoError=null,a.mapInfoSamples=[],a.mapInfoBoxes=null,a.mapInfoLoadingProgress={total:0,done:0},a.mapInfoOpen=!1,U();return}const n=++ce;a.mapInfoLoading=!0,a.mapInfoError=null,a.mapInfoSamples=[],a.mapInfoBoxes=null,a.mapInfoLoadingProgress={total:0,done:0},U();try{const r=a.metaData??await nr();a.metaData||(a.metaData=r);const o=r?.scenarios?.length?Array.from(new Set(r.scenarios.map(Qn))):kt,i=o.filter(d=>Ra(a.date,Tt(d))),s=i.length?i.includes("Historical")?["Historical"]:i:o,l=r?.models?.length?r.models:xt;if(!o.length||!l.length){a.mapInfoError="Select at least one scenario and one model.",a.mapInfoLoading=!1,a.mapInfoLoadingProgress={total:0,done:0},U();return}const c=s.length*l.length;a.mapInfoLoadingProgress={total:c,done:0},U();const u=[];for(const d of s){if(n!==ce)return;const h=St(a.date,Tt(d));if(t&&a.mapMarker){const[p,m]=Je(a.mapMarker.lat,a.mapMarker.lon),b=l.map(L=>La({variable:a.variable,model:L,x0:p,x1:p,y0:m,y1:m,start_date:h,end_date:h,scenario:Wt(d),resolution:"low",step_days:1}).catch(x=>{console.warn(`Pixel API failed for model ${L}, falling back:`,x);const v=mt({variable:a.variable,date:h,model:L,scenario:d,resolution:1});return Pt(v).then(T=>{const M=_t(T);if(!M)throw new Error("No data returned for map info request.");const k=kn(M,a.variable,T.shape,{lat:a.mapMarker.lat,lon:a.mapMarker.lon});return{model:L,value:k,fallback:!0}})})),E=await Promise.allSettled(b);if(n!==ce)return;for(const L of E)if(L.status==="fulfilled"){const x=L.value;if(typeof x=="object"&&"fallback"in x&&x.fallback)u.push({scenario:d,model:x.model,rawValue:x.value,dateUsed:h});else{const v=x,T=v.values[0];if(T!==null&&isFinite(T)){const M=a.variable==="hurs"?Math.min(T,100):T;u.push({scenario:d,model:v.model,rawValue:M,dateUsed:h})}}}else console.warn("Failed to fetch pixel data for map info:",L.reason);a.mapInfoLoadingProgress={total:c,done:a.mapInfoLoadingProgress.done+l.length},ha(u)}else if(e&&a.mapPolygon){const[p,m,b,E]=Na(a.mapPolygon),L=Fa(a.mapPolygon,p,m,b,E);try{const x=await Da({variable:a.variable,models:l,x0:p,x1:m,y0:b,y1:E,start_date:h,end_date:h,scenario:Wt(d),resolution:"low",step_days:1,mask:L});for(const v of l){const T=x.models[v];if(T){const M=T.values[0];if(M!==null&&isFinite(M)){const k=a.variable==="hurs"?Math.min(M,100):M;u.push({scenario:d,model:v,rawValue:k,dateUsed:h})}}}a.mapInfoLoadingProgress={total:c,done:a.mapInfoLoadingProgress.done+l.length},ha(u)}catch(x){console.warn(`Aggregate API failed for scenario ${d}, falling back to full map load:`,x);for(const v of l){if(n!==ce)return;const T=mt({variable:a.variable,date:h,model:v,scenario:d,resolution:1});try{const M=await Pt(T),k=_t(M);if(k){const w=Tn(k,a.variable,M.shape,a.mapPolygon);u.push({scenario:d,model:v,rawValue:w,dateUsed:h})}}catch(M){console.warn(`Failed to load data for model ${v}:`,M)}a.mapInfoLoadingProgress={total:c,done:a.mapInfoLoadingProgress.done+1},ha(u)}}}}if(n!==ce)return;a.mapInfoLoading=!1,U()}catch(r){if(n!==ce)return;a.mapInfoError=r instanceof Error?r.message:"Failed to load map chart data.",a.mapInfoLoading=!1,a.mapInfoLoadingProgress={total:0,done:0},U()}}function Vf(t){a.drawState.active&&(a.drawState={...a.drawState,previewPoint:t},ta())}function zf(t){if(!a.drawState.active)return;const e=a.drawState.points;if(e.length>=3&&kf(t,e[0])){a.canvasView==="chart"||a.chartLocation==="Draw"?ii():a.canvasView==="map"&&ni();return}a.drawState={...a.drawState,points:[...e,t],previewPoint:t},ta()}function qf(t){a.pointSelectActive&&(a.chartPoint=t,a.pointSelectActive=!1,a.chartError=null,a.canvasView="chart",U(),Ut())}function ii(){if(a.drawState.active){if(a.drawState.points.length<3){a.chartError="Draw at least three points to define a region.",U();return}a.chartPolygon=a.drawState.points,a.drawState=ae(),Jn(),a.chartError=null,a.canvasView="chart",U(),Ut()}}function si(t){const e=t.filter(s=>Number.isFinite(s)).sort((s,l)=>s-l);if(!e.length)throw new Error("No valid values available to build chart statistics.");const n=ea(e,.25)??e[0],r=ea(e,.5)??e[Math.floor(e.length/2)],o=ea(e,.75)??e[e.length-1],i=bi(e)??e[0];return{min:e[0],q1:n,median:r,q3:o,max:e[e.length-1],mean:i,count:e.length}}function Ke(t,e,n){const r=new Map;return t.forEach(o=>{const i=r.get(o.scenario)??[];i.push(o),r.set(o.scenario,i)}),Array.from(r.entries()).map(([o,i])=>{const s=i.map(c=>{const u=Le(c.rawValue,e,n);return{...c,value:u}}),l=si(s.map(c=>c.value));return{scenario:o,dateUsed:i[0]?.dateUsed??"",samples:s,stats:l}})}function Hf(t,e,n=50){const r=j(t),o=j(e);if(Number.isNaN(r.getTime())||Number.isNaN(o.getTime())||n<=0)return[];let i=r,s=o;i>s&&([i,s]=[s,i]);const l=1440*60*1e3,u=Math.floor((s.getTime()-i.getTime())/l)+1,d=[];if(u<=n){for(let m=0;m<u;m++){const b=new Date(i.getTime()+m*l);d.push(b.toISOString().slice(0,10))}return d}const h=(s.getTime()-i.getTime())/(n-1),p=new Set;for(let m=0;m<n;m++){const b=new Date(i.getTime()+h*m);p.add(b.toISOString().slice(0,10))}return p.add(s.toISOString().slice(0,10)),Array.from(p).sort((m,b)=>j(m).getTime()-j(b).getTime())}function Yr(t,e,n=50){const r=j(t),o=j(e);if(Number.isNaN(r.getTime())||Number.isNaN(o.getTime())||n<=0)return[];let i=r,s=o;i>s&&([i,s]=[s,i]);const l=1440*60*1e3,c=Math.floor((s.getTime()-i.getTime())/l),u=s.getFullYear()-i.getFullYear();if(c<=120)return Hf(i.toISOString().slice(0,10),s.toISOString().slice(0,10),n);const d=i.getDate(),h=i.getMonth(),p=i.getFullYear(),m=s.getFullYear(),b=m-p+1,E=Math.min(n,b),L=new Set;if(E===1)L.add(p);else{const T=(b-1)/(E-1);for(let M=0;M<E;M++){const k=Math.round(p+T*M);L.add(Math.min(m,Math.max(p,k)))}}const x=[];return Array.from(L).sort((T,M)=>T-M).forEach(T=>{const M=new Date(T,h+1,0).getDate(),k=Math.min(d,M),w=new Date(T,h,k);if(u>=20){if(w<i||w>s)return;x.push(w.toISOString().slice(0,10));return}let A=w;w<i&&(A=i),w>s&&(A=s),x.push(A.toISOString().slice(0,10))}),Array.from(new Set(x)).sort((T,M)=>j(T).getTime()-j(M).getTime())}function Wf(t,e){const n=j(t),r=j(e);if(Number.isNaN(n.getTime())||Number.isNaN(r.getTime()))return!1;const o=1440*60*1e3;return Math.abs(r.getTime()-n.getTime())/o/365.25>=20}function Xr(t,e){const n=j(e),r=j(t);return Number.isNaN(n.getTime())||Number.isNaN(r.getTime())?!1:r.getMonth()===n.getMonth()&&r.getDate()===n.getDate()}function Ra(t,e){const n=j(t),r=j(e.start),o=j(e.end);return Number.isNaN(n.getTime())||Number.isNaN(r.getTime())||Number.isNaN(o.getTime())?!1:n>=r&&n<=o}function jr(t,e,n,r=50){const o=j(t),i=j(e),s=j(n);if(Number.isNaN(o.getTime())||Number.isNaN(i.getTime())||Number.isNaN(s.getTime())||r<=0)return[];const l=o.getMonth(),c=o.getDate(),u=i.getFullYear(),d=s.getFullYear(),h=d-u+1,p=Math.min(r,h),m=new Set;if(p===1)m.add(u);else{const L=(h-1)/(p-1);for(let x=0;x<p;x++){const v=Math.round(u+L*x);m.add(Math.min(d,Math.max(u,v)))}}const b=[];return Array.from(m).sort((L,x)=>L-x).forEach(L=>{const x=new Date(L,l+1,0).getDate(),v=Math.min(c,x),T=new Date(L,l,v);T<i||T>s||b.push(T.toISOString().slice(0,10))}),Array.from(new Set(b)).sort((L,x)=>j(L).getTime()-j(x).getTime())}function Ln(t,e,n){const r=new Map;return t.forEach(o=>{const i=r.get(o.scenario)??[];i.push(o),r.set(o.scenario,i)}),Array.from(r.entries()).map(([o,i])=>{const s=new Map;i.forEach(c=>{const u=Le(c.rawValue,e,n),d=s.get(c.dateUsed)??[];d.push({...c,value:u}),s.set(c.dateUsed,d)});const l=Array.from(s.entries()).map(([c,u])=>({date:c,samples:u,stats:si(u.map(d=>d.value))})).sort((c,u)=>j(c.date).getTime()-j(u.date).getTime());return{scenario:o,points:l}})}function Yf(t,e,n,r){const o=_t(t),i=_t(e);if(!o||!i)throw new Error("Comparison data is missing numeric values.");if(o.length!==i.length||t.shape[0]!==e.shape[0]||t.shape[1]!==e.shape[1])throw new Error("Comparison datasets have mismatched shapes.");const s=new Float32Array(o.length);let l=1/0,c=-1/0;for(let d=0;d<o.length;d++){const h=o[d],p=i[d];if(!isFinite(h)||!isFinite(p)){s[d]=NaN;continue}const m=p-h;s[d]=m,isFinite(m)&&(l=Math.min(l,m),c=Math.max(c,m))}if(!isFinite(l)||!isFinite(c))throw new Error("Comparison produced no valid numeric values.");return{data:{...t,data:s,data_encoding:"none",dtype:"float32",model:`${r} minus ${n}`,time:`${e.time} minus ${t.time}`,scenario:`${e.scenario} minus ${t.scenario}`,metadata:{...t.metadata,comparison:{labelA:n,labelB:r}}},min:l,max:c}}function it(t,e=!1){const n=Math.max(0,Math.min(100,Math.round(t)));n!==a.loadingProgress&&(a.loadingProgress=n,(a.isLoading||e)&&U())}async function Xf(t,e){let n=mt({variable:a.variable,date:a.date,model:a.model,scenario:a.scenario,resolution:a.resolution}),r=n,o="",i="";switch(a.compareMode){case"Scenarios":{const c=a.compareScenarioA,u=a.compareScenarioB,d=$e(a.date,t);d!==a.date&&(a.date=d),n=mt({variable:a.variable,date:d,model:a.model,scenario:c,resolution:a.resolution}),r=mt({variable:a.variable,date:d,model:a.model,scenario:u,resolution:a.resolution}),o=c,i=u;break}case"Models":{const c=$e(a.date,t);c!==a.date&&(a.date=c),n=mt({variable:a.variable,date:c,model:a.compareModelA,scenario:a.scenario,resolution:a.resolution}),r=mt({variable:a.variable,date:c,model:a.compareModelB,scenario:a.scenario,resolution:a.resolution}),o=a.compareModelA,i=a.compareModelB;break}case"Dates":{const c=$e(a.compareDateStart,a.scenario),u=$e(a.compareDateEnd,a.scenario);c!==a.compareDateStart&&(a.compareDateStart=c),u!==a.compareDateEnd&&(a.compareDateEnd=u),n=mt({variable:a.variable,date:c,model:a.model,scenario:a.scenario,resolution:a.resolution}),r=mt({variable:a.variable,date:u,model:a.model,scenario:a.scenario,resolution:a.resolution}),o=c,i=u;break}}const s=await Pt(n);e?.(65);const l=await Pt(r);return e?.(85),Yf(s,l,o,i)}const Qe=600,Ze=1440;function Je(t,e){const r=((e+360)%360+360)%360/360*Ze-.5,o=(90-t)/150*Qe-.5,i=(c,u,d)=>Math.min(d,Math.max(u,c)),s=i(Math.round(r),0,Ze-1),l=i(Math.round(o),0,Qe-1);return[s,l]}function Na(t){if(!t||t.length<3)throw new Error("Polygon must have at least 3 points");let e=1/0,n=-1/0,r=1/0,o=-1/0;for(const i of t){const[s,l]=Je(i.lat,i.lon);e=Math.min(e,s),n=Math.max(n,s),r=Math.min(r,l),o=Math.max(o,l)}return e=Math.max(0,Math.min(e,Ze-1)),n=Math.max(0,Math.min(n,Ze-1)),r=Math.max(0,Math.min(r,Qe-1)),o=Math.max(0,Math.min(o,Qe-1)),[e,n,r,o]}function Fa(t,e,n,r,o){const i=[],s=360/Ze,l=150/Qe;for(let c=r;c<=o;c++){const u=[],d=90-(c+.5)*l;for(let h=e;h<=n;h++){const p=(h+.5)*s,m=p>180?p-360:p,b=Zo({lat:d,lon:m},t);u.push(b?1:0)}i.push(u)}return i}async function Ut(){if(a.canvasView!=="chart")return;const t=e=>{if(a.chartSamples=e,a.chartMode==="single")try{a.chartBoxes=Ke(e,a.chartVariable,a.chartUnit),a.chartRangeSeries=null}catch{return}else try{a.chartRangeSeries=Ln(e,a.chartVariable,a.chartUnit),a.chartBoxes=null}catch{return}U()};if(a.chartLocation==="Draw"&&(!a.chartPolygon||a.chartPolygon.length<3)){a.chartError="Draw a region on the map to load chart data.",a.chartBoxes=null,a.chartRangeSeries=null,a.chartSamples=[],a.chartLoading=!1,a.chartLoadingProgress={total:0,done:0},U();return}if(a.chartLocation==="Point"&&!a.chartPoint){a.chartError="Click a point on the map to load chart data.",a.chartBoxes=null,a.chartRangeSeries=null,a.chartSamples=[],a.chartLoading=!1,a.chartLoadingProgress={total:0,done:0},U();return}if(a.chartLocation==="Search"&&!a.chartPoint){a.chartError=a.chartLocationSearchLoading?"Searching for a place...":"Search for a place and pick a result.",a.chartBoxes=null,a.chartRangeSeries=null,a.chartSamples=[],a.chartLoading=!1,a.chartLoadingProgress={total:0,done:0},U();return}a.chartLoading=!0,a.chartError=null,it(5,!0),a.chartLoadingProgress={total:0,done:0},a.chartSamples=[],a.chartBoxes=null,a.chartRangeSeries=null,U();try{const e=a.metaData??await nr();a.metaData||(a.metaData=e);const n=e?.scenarios?.length?Array.from(new Set(e.scenarios.map(Qn))):kt,r=e?.models?.length?e.models:xt,o=(a.chartScenarios.length?a.chartScenarios:n).filter(l=>n.includes(l)),i=(a.chartModels.length?a.chartModels:r).filter(l=>r.includes(l));if(!o.length||!i.length){a.chartError="Select at least one scenario and one model.",a.chartSamples=[],a.chartBoxes=null,a.chartRangeSeries=null,a.chartLoading=!1,a.chartLoadingProgress={total:0,done:0},U();return}const s=ar(o);if(a.chartMode==="single"){const l=St(a.chartDate,s);l!==a.chartDate&&(a.chartDate=l);const c=o.length*i.length;a.chartLoadingProgress={total:c,done:0},a.chartRangeSeries=null,U();const u=[];if((a.chartLocation==="Point"||a.chartLocation==="Search")&&a.chartPoint?!0:a.chartLocation==="Draw"&&a.chartPolygon&&a.chartPolygon.length>=3){console.log("Using pixel-data API for efficient loading");for(const h of o){const p=St(a.chartDate,Tt(h));try{if((a.chartLocation==="Point"||a.chartLocation==="Search")&&a.chartPoint){const[m,b]=Je(a.chartPoint.lat,a.chartPoint.lon);console.log(`Fetching pixel data for point (${m}, ${b}) for ${i.length} models`);const E=i.map(x=>La({variable:a.chartVariable,model:x,x0:m,x1:m,y0:b,y1:b,start_date:p,end_date:p,scenario:Wt(h),resolution:"low",step_days:1}).catch(v=>{if(console.warn(`Pixel API failed for model ${x}, falling back:`,v),!a.chartPoint)throw v;const T=mt({variable:a.chartVariable,date:p,model:x,scenario:h,resolution:1});return Pt(T).then(M=>{const k=_t(M);if(!k)throw new Error("No data returned for chart request.");if(!a.chartPoint)throw new Error("No chart point selected");const w=kn(k,a.chartVariable,M.shape,a.chartPoint);return{model:x,value:w,fallback:!0}})})),L=await Promise.allSettled(E);for(const x of L)if(x.status==="fulfilled"){const v=x.value;if(typeof v=="object"&&"fallback"in v&&v.fallback)u.push({scenario:h,model:v.model,rawValue:v.value,dateUsed:p});else{const T=v,M=T.values[0];if(M!==null&&isFinite(M)){const k=a.chartVariable==="hurs"?Math.min(M,100):M;u.push({scenario:h,model:T.model,rawValue:k,dateUsed:p})}}}else console.warn("Failed to fetch pixel data:",x.reason);a.chartLoadingProgress={total:c,done:a.chartLoadingProgress.done+i.length},it(Math.min(98,Math.round(a.chartLoadingProgress.done/c*100))),t(u)}else if(a.chartLocation==="Draw"&&a.chartPolygon&&a.chartPolygon.length>=3){const[m,b,E,L]=Na(a.chartPolygon),x=Fa(a.chartPolygon,m,b,E,L);console.log(`Fetching aggregate data for polygon window [${m},${b},${E},${L}] for ${i.length} models`);try{const v=await Da({variable:a.chartVariable,models:i,x0:m,x1:b,y0:E,y1:L,start_date:p,end_date:p,scenario:Wt(h),resolution:"low",step_days:1,mask:x});for(const T of i){const M=v.models[T];if(M){const k=M.values[0];if(k!==null&&isFinite(k)){const w=a.chartVariable==="hurs"?Math.min(k,100):k;u.push({scenario:h,model:T,rawValue:w,dateUsed:p})}}}a.chartLoadingProgress={total:c,done:a.chartLoadingProgress.done+i.length},it(Math.min(98,Math.round(a.chartLoadingProgress.done/c*100))),t(u)}catch(v){console.warn("Batch aggregate API failed, falling back to full map load:",v);for(const T of i){const M=mt({variable:a.chartVariable,date:p,model:T,scenario:h,resolution:1}),k=await Pt(M),w=_t(k);if(!w)continue;const A=Tn(w,a.chartVariable,k.shape,a.chartPolygon);u.push({scenario:h,model:T,rawValue:A,dateUsed:p})}t(u)}}}catch(m){throw console.error("Error in pixel API path:",m),m}}}else for(const h of o){const p=St(a.chartDate,Tt(h));for(const m of i){const b=a.chartLoadingProgress.done;it(Math.min(95,Math.round((b+.1)/c*100)));const E=mt({variable:a.chartVariable,date:p,model:m,scenario:h,resolution:1}),L=await Pt(E),x=a.chartLoadingProgress.done+1;a.chartLoadingProgress={total:c,done:x},it(Math.min(98,Math.round(x/c*100))),t(u);const v=_t(L);if(!v)throw new Error("No data returned for chart request.");const T=fa(v,a.chartVariable);u.push({scenario:h,model:m,rawValue:T,dateUsed:p})}}a.chartSamples=u,a.chartBoxes=Ke(u,a.chartVariable,a.chartUnit),a.chartLoadingProgress={total:c,done:c},it(100)}else{let l=St(a.chartRangeStart,s),c=St(a.chartRangeEnd,s);j(l)>j(c)&&([l,c]=[c,l]),a.chartRangeStart=l,a.chartRangeEnd=c;const u=Wf(l,c),d=l;if(!mf)if((a.chartLocation==="Point"||a.chartLocation==="Search")&&a.chartPoint?!0:a.chartLocation==="Draw"&&a.chartPolygon&&a.chartPolygon.length>=3){console.log("Using pixel-data API for range mode");const p=o.length*i.length;a.chartLoadingProgress={total:p,done:0},a.chartBoxes=null,U();const m=[];for(const b of i)for(const E of o){const L=Tt(E),x=St(l,L),v=St(c,L);if(j(x)>j(v))continue;const T=a.chartLoadingProgress.done;it(Math.min(95,Math.round((T+.1)/p*100)));try{if((a.chartLocation==="Point"||a.chartLocation==="Search")&&a.chartPoint){const[k,w]=Je(a.chartPoint.lat,a.chartPoint.lon),A=await La({variable:a.chartVariable,model:b,x0:k,x1:k,y0:w,y1:w,start_date:x,end_date:v,scenario:Wt(E),resolution:"low",step_days:1});for(let O=0;O<A.timestamps.length;O++){const W=A.timestamps[O];if(u&&!Xr(W,d))continue;const z=A.values[O];if(z!==null&&isFinite(z)){const N=a.chartVariable==="hurs"?Math.min(z,100):z;m.push({scenario:E,model:b,rawValue:N,dateUsed:W})}}t(m)}else if(a.chartLocation==="Draw"&&a.chartPolygon&&a.chartPolygon.length>=3){const[k,w,A,O]=Na(a.chartPolygon),W=Fa(a.chartPolygon,k,w,A,O),N=(await Da({variable:a.chartVariable,models:[b],x0:k,x1:w,y0:A,y1:O,start_date:x,end_date:v,scenario:Wt(E),resolution:"low",step_days:1,mask:W})).models[b];if(N)for(let G=0;G<N.timestamps.length;G++){const B=N.timestamps[G];if(u&&!Xr(B,d))continue;const f=N.values[G];if(f!==null&&isFinite(f)){const g=a.chartVariable==="hurs"?Math.min(f,100):f;m.push({scenario:E,model:b,rawValue:g,dateUsed:B})}}t(m)}}catch(k){console.warn("Pixel API failed, falling back to full map load:",k);const w=u?jr(d,x,v,50):Yr(x,v,50);for(const A of w){const O=u?A:St(A,L);if(u&&!Ra(O,L))continue;const W=mt({variable:a.chartVariable,date:O,model:b,scenario:E,resolution:1});let z=null;try{z=await Pt(W)}catch(B){console.warn("Range fallback request failed, skipping date:",B);continue}const N=_t(z);if(!N)continue;const G=a.chartLocation==="Draw"&&a.chartPolygon&&a.chartPolygon.length>=3?Tn(N,a.chartVariable,z.shape,a.chartPolygon):(a.chartLocation==="Point"||a.chartLocation==="Search")&&a.chartPoint?kn(N,a.chartVariable,z.shape,a.chartPoint):fa(N,a.chartVariable);m.push({scenario:E,model:b,rawValue:G,dateUsed:O})}t(m)}const M=a.chartLoadingProgress.done+1;a.chartLoadingProgress={total:p,done:M},it(Math.min(98,Math.round(M/p*100))),t(m)}a.chartSamples=m,a.chartRangeSeries=Ln(m,a.chartVariable,a.chartUnit),a.chartLoadingProgress={total:p,done:p},it(100)}else{const p=u?jr(d,l,c,50):Yr(l,c,50);if(!p.length){a.chartError="Enter a valid date range within the selected scenarios.",a.chartSamples=[],a.chartBoxes=null,a.chartRangeSeries=null,a.chartLoading=!1,a.chartLoadingProgress={total:0,done:0},U();return}const m=o.length*i.length*p.length;a.chartLoadingProgress={total:m,done:0},a.chartBoxes=null,U();const b=[];for(const E of i)for(const L of o){const x=Tt(L);for(const v of p){const T=u?v:St(v,x);if(u&&!Ra(T,x))continue;const M=a.chartLoadingProgress.done;it(Math.min(95,Math.round((M+.1)/m*100)));const k=mt({variable:a.chartVariable,date:T,model:E,scenario:L,resolution:1});let w=null;try{w=await Pt(k)}catch(z){console.warn("Range request failed, skipping date:",z);continue}const A=a.chartLoadingProgress.done+1;a.chartLoadingProgress={total:m,done:A},it(Math.min(98,Math.round(A/m*100))),t(b);const O=_t(w);if(!O)throw new Error("No data returned for chart request.");const W=a.chartLocation==="Draw"&&a.chartPolygon&&a.chartPolygon.length>=3?Tn(O,a.chartVariable,w.shape,a.chartPolygon):(a.chartLocation==="Point"||a.chartLocation==="Search")&&a.chartPoint?kn(O,a.chartVariable,w.shape,a.chartPoint):fa(O,a.chartVariable);b.push({scenario:L,model:E,rawValue:W,dateUsed:T})}}a.chartSamples=b,a.chartRangeSeries=Ln(b,a.chartVariable,a.chartUnit),a.chartLoadingProgress={total:m,done:m},it(100)}}}catch(e){a.chartError=e instanceof bt&&e.statusCode||e instanceof Error?e.message:String(e),a.chartSamples=[],a.chartBoxes=null,a.chartRangeSeries=null,a.chartLoadingProgress={total:1,done:1}}finally{a.chartLoading=!1,U()}}async function Ct(){if(console.log("fetching"),a.canvasView==="map"){a.isLoading=!0,it(5,!0),a.dataError=null;try{const t=await nr();a.metaData=t,a.availableModels=t.models,it(20);const e=a.mode==="Compare"&&a.compareMode==="Scenarios"?a.compareScenarioA:a.scenario;a.timeRange=Tt(e),it(30);const n=a.mode==="Compare"?await Xf(e,it):await(async()=>{it(40);const r=$e(a.date,e);r!==a.date&&(a.date=r);const o=mt({variable:a.variable,date:r,model:a.model,scenario:a.scenario,resolution:a.resolution});it(55);let i=await Pt(o);it(80);let s=_t(i);if(!s)throw new Error("No data returned for the selected parameters.");if(a.variable==="hurs"){const u=new Float32Array(s.length);let d=1/0,h=-1/0;for(let p=0;p<s.length;p++){const m=s[p];if(!isFinite(m)){u[p]=NaN;continue}const b=Math.min(m,100);u[p]=b,d=Math.min(d,b),h=Math.max(h,b)}return i={...i,data:u,data_encoding:"none"},s=u,{data:i,min:d,max:h}}const{min:l,max:c}=Tf(s);return it(95),{data:i,min:l,max:c}})();if(a.currentData=n.data,a.dataMin=n.min,a.dataMax=n.max,it(100),a.isLoading=!1,U(),tt){const r=tt.querySelector("#map-canvas");r&&rr(r)}}catch(t){t instanceof bt&&t.statusCode?a.dataError=t.message:a.dataError=t instanceof Error?t.message:String(t),a.isLoading=!1,it(0,!0),a.currentData=null,a.dataMin=null,a.dataMax=null,U()}}}function jf(){return`
      <div style="${S($.branding)}">
        <div data-role="brand-eye" style="${S($.brandIcon)}">
          <svg viewBox="0 0 120 80" style="${S($.brandSvg)}" aria-hidden="true">
            <defs>
              <clipPath id="brand-eye-clip">
                <rect x="0" y="0" width="120" height="80" style="${S($.brandClipRect)}" />
              </clipPath>
            </defs>
            <g style="${S($.brandLids)}">
              <path
                d="M10 40c10-15 30-30 50-30s40 15 50 30c-10 15-30 30-50 30S20 55 10 40Z"
                style="${S($.brandOutline)}"
              />
            </g>
            <g data-role="brand-iris" style="${S(lt($.brandIrisGroup,$.brandEyeContent))}">
              <circle cx="60" cy="40" r="20" style="${S($.brandIris)}" />
              <g data-role="brand-pupil" style="${S($.brandPupilGroup)}">
                <circle cx="60" cy="40" r="10" style="${S($.brandPupil)}" />
                <circle cx="72" cy="30" r="4" style="${S($.brandHighlight)}" />
              </g>
            </g>
          </svg>
        </div>
        <span style="${S($.brandName)}">Polyoracle</span>
      </div>
    `}function U(){if(!tt)return;const t=!!tt.querySelector('.custom-select-wrapper[data-key="chartLocation"]')?.classList.contains("open"),e=(a.resolution-1)/2*100,n=a.mode==="Explore"?"translateX(0%)":"translateX(-50%)",r=a.mode==="Explore"?"translateX(0%)":"translateX(100%)",o=a.canvasView==="map"?"translateX(0%)":"translateX(100%)",i=a.panelTab==="Manual"?"translateX(0%)":"translateX(-50%)";if(tt.innerHTML=`
    <div style="${S($.page)}">
      <div style="${S($.bgLayer1)}"></div>
      <div style="${S($.bgLayer2)}"></div>
      <div style="${S($.bgOverlay)}"></div>
      ${jf()}
        ${a.canvasView==="map"&&a.dataMin!==null&&a.dataMax!==null?Kd(a.variable,a.dataMin,a.dataMax,a.metaData,a.selectedUnit,a.mode==="Compare"):""}
      <div style="${S($.mapArea)}">
        ${a.canvasView==="map"?`
              <canvas
                id="map-canvas"
                style="position: absolute; inset: 0; width: 100%; height: 100%; object-fit: contain; pointer-events: auto;"
              ></canvas>
              ${th()}
              ${Lf()}
              ${Df()}
              ${_f()}
              ${Ef()}
              ${Gf()}
              ${a.dataError?`<div style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.8); z-index: 10;">
                      <div style="text-align: center; max-width: 600px; padding: 20px;">
                        <div style="${S($.mapTitle)}">Error loading data</div>
                        <div style="${S($.mapSubtitle)}">${a.dataError}</div>
                        ${a.apiAvailable===!1?`<div style="${S(lt($.mapSubtitle,{marginTop:12,fontSize:12}))}">
                                Make sure the Python API server is running. Check the terminal for connection details.
                              </div>`:""}
                      </div>
                    </div>`:""}
              ${!a.isLoading&&!a.dataError&&!a.currentData?`<div style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.5); z-index: 5;">
                      <div style="text-align: center;">
                        <div style="${S($.mapTitle)}">No data loaded</div>
                        <div style="${S($.mapSubtitle)}">
                          Adjust parameters to load climate data
                        </div>
                      </div>
                    </div>`:""}
            `:Qf()}
      </div>

      <aside data-role="sidebar" class="sidebar" style="width: ${gt}px; transform: ${a.sidebarOpen?"translateX(0)":`translateX(${gt+24}px)`}; pointer-events: ${a.sidebarOpen?"auto":"none"}" aria-hidden="${!a.sidebarOpen}">
        <div class="sidebar-top">
          <div class="sidebar-brand">
            <div class="logo-dot"></div>
          </div>
          <div class="tab-switch" style="${S($.tabSwitch)}">
            ${["Manual","Chat"].map(c=>Zf(c,a.panelTab===c?$.tabBtnActive:void 0,"panel-tab")).join("")}
          </div>
        </div>

        <div class="sidebar-content">
          <div class="tab-viewport">
            <div data-role="tab-track" class="tab-track" style="transform: ${i}">
              <div class="tab-pane">
                ${a.canvasView==="map"?Jf({modeTransform:n,resolutionFill:e,modeIndicatorTransform:r}):eh()}
              </div>
              <div class="tab-pane">
                ${nh()}
              </div>
            </div>
          </div>
        </div>
      </aside>

      <div data-role="canvas-toggle" style="${S({...$.canvasToggle,right:a.sidebarOpen?gt+24:24})}">
        <div style="${S($.canvasSwitch)}">
          <div data-role="canvas-indicator" style="${S({...$.canvasIndicator,transform:o})}"></div>
          <button
            type="button"
            aria-label="Show map canvas"
            data-action="set-canvas"
            data-value="map"
            style="${S(lt($.canvasBtn,a.canvasView==="map"?$.canvasBtnActive:void 0))}"
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.6">
              <path d="M4 6.5 9 4l6 2.5L20 4v14l-5 2.5L9 18 4 20.5V6.5Z" />
              <path d="m9 4v14m6-11.5v14" />
            </svg>
          </button>
          <button
            type="button"
            aria-label="Show chart canvas"
            data-action="set-canvas"
            data-value="chart"
            style="${S(lt($.canvasBtn,a.canvasView==="chart"?$.canvasBtnActive:void 0))}"
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.8">
              <path d="M4 18h16" />
              <path d="M6 18 11 9l4 5 3-6" />
              <circle cx="6" cy="18" r="1.2" />
              <circle cx="11" cy="9" r="1.2" />
              <circle cx="15" cy="14" r="1.2" />
              <circle cx="18" cy="8" r="1.2" />
            </svg>
          </button>
        </div>
      </div>

      ${Sf(a)}

      ${qd(a.sidebarOpen)}

      ${a.canvasView==="map"?ff({date:a.date,timeRange:a.timeRange,sidebarOpen:a.sidebarOpen,sidebarWidth:gt,mode:a.mode,compareMode:a.compareMode,compareDateStart:a.compareDateStart,compareDateEnd:a.compareDateEnd}):""}
    </div>
  `,rh(),t){const c=tt.querySelector('.custom-select-wrapper[data-key="chartLocation"]');c&&c.classList.add("open")}if(yt=tt.querySelector("#map-canvas"),yt&&a.currentData&&!a.dataError&&a.dataMin!==null&&a.dataMax!==null){rr(yt),Ia(a.currentData,yt,dt,a.palette,a.dataMin,a.dataMax,a.variable,a.selectedUnit);const c=dt.find(u=>u.name===a.palette)||dt[0];ka("legend-gradient-canvas",c.colors),(a.drawState.active||a.mapPolygon!==null&&a.mapPolygon.length>=3)&&requestAnimationFrame(ta)}const s=(a.sidebarOpen?gt+24:24)+8,l=a.sidebarOpen?1:.9;Qo(s,l),ti()}function Gf(){if(!a.isLoading)return"";const t=Math.max(0,Math.min(100,Math.round(a.loadingProgress)));return`
      <div style="${S($.loadingIndicator)}">
        <div style="${S($.loadingSpinner)}"></div>
        <div style="${S($.loadingTextGroup)}">
          <div style="${S($.loadingText)}">Loading data · ${t}%</div>
          <div style="${S($.loadingBar)}">
            <div style="${S({...$.loadingBarFill,width:`${t}%`})}"></div>
          </div>
          <div style="${S($.loadingSubtext)}">Fetching climate tiles</div>
        </div>
      </div>
    `}function Kf(){return`
      <div style="position:absolute; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none;">
      </div>
    `}function or(t){if(!Number.isFinite(t))return"-";const e=Math.abs(t);return e>=1e3?t.toFixed(0):e>=100?t.toFixed(1):e>=1?t.toFixed(2):t.toPrecision(2)}function Gr(t){if(!t.length)return`<div style="${S($.chartEmpty)}">No chart data loaded yet.</div>`;const e=[...t].sort((M,k)=>kt.indexOf(M.scenario)-kt.indexOf(k.scenario)),r=(dt.find(M=>M.name===a.palette)||dt[0]).colors,o=900,i=440,s={top:26,right:36,bottom:70,left:86},l=o-s.left-s.right,c=i-s.top-s.bottom,u=e.flatMap(M=>[M.stats.min,M.stats.max]),d=Math.min(...u),h=Math.max(...u),p=Math.max(Math.abs(h-d)*.12,1e-6),m=jn().domain([d-p,h+p]).range([c,0]),b=m.ticks(6),E=l/(e.length+1),L=b.map(M=>{const k=m(M)+s.top;return`
        <g>
          <line x1="${s.left}" x2="${o-s.right}" y1="${k}" y2="${k}" stroke="rgba(255,255,255,0.08)" />
          <text x="${s.left-10}" y="${k+4}" fill="var(--text-secondary)" font-size="11" text-anchor="end">
            ${or(M)}
          </text>
        </g>
      `}).join(""),x=e.map((M,k)=>{const w=s.left+E*(k+1),A=r[k%r.length],{min:O,q1:W,median:z,q3:N,max:G,mean:B}=M.stats,f=m(N)+s.top,g=m(W)+s.top,y=Math.max(2,g-f);return`
        <g>
          <line x1="${w}" x2="${w}" y1="${m(O)+s.top}" y2="${m(G)+s.top}" stroke="${A}" stroke-width="2" stroke-linecap="round" />
          <rect x="${w-24}" y="${f}" width="48" height="${y}" fill="rgba(255,255,255,0.06)" stroke="${A}" stroke-width="2" rx="6" />
          <line x1="${w-24}" x2="${w+24}" y1="${m(z)+s.top}" y2="${m(z)+s.top}" stroke="${A}" stroke-width="2.4" />
          <circle cx="${w}" cy="${m(B)+s.top}" r="4" fill="${A}" stroke="rgba(0,0,0,0.55)" stroke-width="1" />
          <text x="${w}" y="${i-s.bottom+32}" fill="var(--text-primary)" font-weight="700" font-size="12" text-anchor="middle">${M.scenario}</text>
          <text x="${w}" y="${i-s.bottom+48}" fill="var(--text-secondary)" font-size="11" text-anchor="middle">${M.samples.length} model${M.samples.length===1?"":"s"}</text>
        </g>
      `}).join(""),v=`
      <line
        x1="${s.left}"
        x2="${s.left}"
        y1="${s.top}"
        y2="${i-s.bottom}"
        stroke="rgba(255,255,255,0.65)"
        stroke-width="1.2"
      />
    `,T=`
      <text
        x="${s.left-70}"
        y="${s.top+c/2}"
        fill="var(--text-secondary)"
        font-size="12"
        text-anchor="middle"
        transform="rotate(-90 ${s.left-70} ${s.top+c/2})"
      >
        ${a.chartUnit}
      </text>
    `;return`
      <svg viewBox="0 0 ${o} ${i}" role="img" aria-label="Global box plots" preserveAspectRatio="xMidYMid meet" style="width:100%; height:auto;">
        ${v}
        ${L}
        ${x}
        ${T}
      </svg>
    `}function Kr(t,e){if(!t.length)return`<div style="${S($.chartEmpty)}">No chart data loaded yet.</div>`;const n=[...t].sort((M,k)=>kt.indexOf(M.scenario)-kt.indexOf(k.scenario)),o=(dt.find(M=>M.name===a.palette)||dt[0]).colors,i=560,s=300,l={top:18,right:16,bottom:52,left:48},c=i-l.left-l.right,u=s-l.top-l.bottom,d=n.flatMap(M=>[M.stats.min,M.stats.max]),h=Math.min(...d),p=Math.max(...d),m=Math.max(Math.abs(p-h)*.12,1e-6),b=jn().domain([h-m,p+m]).range([u,0]),E=b.ticks(4),L=c/(n.length+1),x=E.map(M=>{const k=b(M)+l.top;return`
        <g>
          <line x1="${l.left}" x2="${i-l.right}" y1="${k}" y2="${k}" stroke="rgba(255,255,255,0.06)" />
          <text x="${l.left-8}" y="${k+3}" fill="var(--text-secondary)" font-size="9" text-anchor="end">
            ${or(M)}
          </text>
        </g>
      `}).join(""),v=n.map((M,k)=>{const w=l.left+L*(k+1),A=o[k%o.length],{min:O,q1:W,median:z,q3:N,max:G,mean:B}=M.stats,f=b(N)+l.top,g=b(W)+l.top,y=Math.max(2,g-f);return`
        <g>
          <line x1="${w}" x2="${w}" y1="${b(O)+l.top}" y2="${b(G)+l.top}" stroke="${A}" stroke-width="1.6" stroke-linecap="round" />
          <rect x="${w-16}" y="${f}" width="32" height="${y}" fill="rgba(255,255,255,0.06)" stroke="${A}" stroke-width="1.6" rx="5" />
          <line x1="${w-16}" x2="${w+16}" y1="${b(z)+l.top}" y2="${b(z)+l.top}" stroke="${A}" stroke-width="2" />
          <circle cx="${w}" cy="${b(B)+l.top}" r="3.2" fill="${A}" stroke="rgba(0,0,0,0.55)" stroke-width="0.8" />
          <text x="${w}" y="${s-l.bottom+26}" fill="var(--text-primary)" font-weight="700" font-size="10" text-anchor="middle">${M.scenario}</text>
          <text x="${w}" y="${s-l.bottom+40}" fill="var(--text-secondary)" font-size="9" text-anchor="middle">${M.samples.length} model${M.samples.length===1?"":"s"}</text>
        </g>
      `}).join(""),T=`
      <line
        x1="${l.left}"
        x2="${l.left}"
        y1="${l.top}"
        y2="${s-l.bottom}"
        stroke="rgba(255,255,255,0.55)"
        stroke-width="1"
      />
    `;return`
      <svg viewBox="0 0 ${i} ${s}" role="img" aria-label="Mini box plots" preserveAspectRatio="xMidYMid meet" style="width:100%; height:auto;">
        ${T}
        ${x}
        ${v}
        <text x="${l.left}" y="${l.top-6}" fill="var(--text-secondary)" font-size="9">${vt(e)}</text>
      </svg>
    `}function Qr(t){if(!t.length)return`<div style="${S($.chartEmpty)}">No chart data loaded yet.</div>`;const n=(dt.find(B=>B.name===a.palette)||dt[0]).colors,r=960,o=460,i={top:28,right:32,bottom:82,left:86},s=r-i.left-i.right,l=o-i.top-i.bottom,c=t.flatMap(B=>B.points),u=c.map(B=>j(B.date)),d=wi(u),h=xi(u);if(!d||!h)return`<div style="${S($.chartEmpty)}">No chart data loaded yet.</div>`;const p=1440*60*1e3,m=new Date(d.getTime()-p*.25),b=new Date(h.getTime()+p*.25),E=Id().domain([m,b]).range([0,s]),L=E.ticks(6),x=tr("%b %Y"),v=c.flatMap(B=>[B.stats.min,B.stats.max]),T=Math.min(...v),M=Math.max(...v),k=Math.max(Math.abs(M-T)*.12,1e-6),w=jn().domain([T-k,M+k]).range([l,0]),O=w.ticks(6).map(B=>{const f=w(B)+i.top;return`
        <g>
          <line x1="${i.left}" x2="${r-i.right}" y1="${f}" y2="${f}" stroke="rgba(255,255,255,0.08)" />
          <text x="${i.left-10}" y="${f+4}" fill="var(--text-secondary)" font-size="11" text-anchor="end">
            ${or(B)}
          </text>
        </g>
      `}).join(""),W=L.map(B=>{const f=E(B)+i.left;return`
        <g>
          <line x1="${f}" x2="${f}" y1="${i.top}" y2="${o-i.bottom}" stroke="rgba(255,255,255,0.06)" />
          <text x="${f}" y="${o-i.bottom+26}" fill="var(--text-secondary)" font-size="11" text-anchor="middle">
            ${x(B)}
          </text>
        </g>
      `}).join(""),z=Math.max(Yt.length,4),N=t.map((B,f)=>{if(!B.points.length)return"";const g=n[f%n.length],y=B.points.map(I=>{const V=Array.from({length:z+1},(Z,X)=>{const q=X/z;return I.stats.min+(I.stats.max-I.stats.min)*q});return{point:I,levels:V}}),D=I=>{const V=y.map(({point:X,levels:q})=>{const H=E(j(X.date))+i.left,K=w(q[I+1])+i.top;return`${H},${K}`}).join(" L "),Z=[...y].reverse().map(({point:X,levels:q})=>{const H=E(j(X.date))+i.left,K=w(q[I])+i.top;return`${H},${K}`}).join(" L ");return`M ${V} L ${Z} Z`},P=Array.from({length:z},(I,V)=>{const Z=D(V),X=z/2,H=.55*(1-Math.min(Math.abs(V+.5-X)/X,1))+.08;return`<path d="${Z}" fill="${g}" fill-opacity="${H.toFixed(3)}" stroke="none" />`}).join(""),_=B.points.map((I,V)=>{const Z=E(j(I.date))+i.left,X=w(I.stats.median)+i.top;return`${V===0?"M":"L"} ${Z} ${X}`}).join(" "),F=B.points.map((I,V)=>{const Z=E(j(I.date))+i.left,X=w(I.stats.mean)+i.top;return`${V===0?"M":"L"} ${Z} ${X}`}).join(" ");return`
        <g>
          ${P}
          <path d="${_}" fill="none" stroke="${g}" stroke-width="2.2" />
          <path d="${F}" fill="none" stroke="${g}" stroke-width="1.6" stroke-dasharray="6 6" stroke-opacity="0.9" />
          <circle cx="${E(j(B.points[B.points.length-1].date))+i.left}" cy="${w(B.points[B.points.length-1].stats.median)+i.top}" r="4" fill="${g}" stroke="rgba(0,0,0,0.4)" stroke-width="1" />
        </g>
      `}).join(""),G=`
      <text
        x="${i.left-70}"
        y="${i.top+l/2}"
        fill="var(--text-secondary)"
        font-size="12"
        text-anchor="middle"
        transform="rotate(-90 ${i.left-70} ${i.top+l/2})"
      >
        ${a.chartUnit}
      </text>
    `;return`
      <div style="width:100%; display:flex; flex-direction:column; gap:12px; align-items:center;">
        <div style="position:relative; width:100%; display:flex; justify-content:center;">
          <div style="position:absolute; top:10px; right:16px; display:flex; gap:12px; align-items:center; color:var(--text-secondary); font-size:11.5px; z-index:2;">
            <div style="display:flex; align-items:center; gap:6px;">
              <span style="display:inline-block; width:26px; height:0; border-top:1px solid var(--text-primary);"></span>
              <span>Median</span>
            </div>
            <div style="display:flex; align-items:center; gap:6px;">
              <span style="display:inline-block; width:26px; height:0; border-top:1px dashed var(--text-primary);"></span>
              <span>Mean</span>
            </div>
          </div>
          <svg viewBox="0 0 ${r} ${o}" role="img" aria-label="Distribution over time" preserveAspectRatio="xMidYMid meet" style="width:100%; height:auto;">
            ${O}
            ${W}
            <path
              d="M ${i.left} ${i.top} L ${i.left} ${o-i.bottom} L ${r-i.right} ${o-i.bottom}"
              fill="none"
              stroke="rgba(255,255,255,0.6)"
              stroke-width="1.2"
              stroke-linecap="round"
            />
            ${N}
            ${G}
          </svg>
        </div>
        <div style="${S($.chartLegend)}">
          ${t.map((B,f)=>`
            <div style="display:flex; align-items:center; gap:8px; font-size:12; color:var(--text-secondary);">
              <span style="display:inline-block; width:16px; height:8px; background:${n[f%n.length]}; border-radius:999px;"></span>
              <span style="color:var(--text-primary); font-weight:700;">${B.scenario}</span>
            </div>
          `).join("")}
        </div>
      </div>
    `}function Qf(){let t="";const e=a.chartMode==="range";if(a.chartLoading)t=`
          <div style="position:absolute; inset:0; pointer-events:none;">
            <div style="${S(lt($.loadingIndicator,{position:"absolute",left:18,bottom:-95,pointerEvents:"auto"}))}">
              <div style="${S($.loadingSpinner)}"></div>
              <div style="${S($.loadingTextGroup)}">
                <div style="${S($.loadingText)}">Loading data</div>
                <div style="${S($.loadingBar)}">
                  <div style="${S({...$.loadingBarFill,width:`${Math.max(0,Math.min(100,Math.round(a.loadingProgress||25)))}%`})}"></div>
                </div>
                <div style="${S($.loadingSubtext)}">${a.chartLoadingProgress.total>0?`${a.chartLoadingProgress.done}/${a.chartLoadingProgress.total} datasets loaded`:"Preparing datasets"}</div>
              </div>
            </div>
            ${Kf()}
          </div>
          ${!e&&a.chartBoxes?Gr(a.chartBoxes):e&&a.chartRangeSeries?Qr(a.chartRangeSeries):""}
        `;else if(a.chartError)t=`<div style="${S($.chartError)}">${a.chartError}</div>`;else if(!e&&(!a.chartBoxes||!a.chartBoxes.length)||e&&(!a.chartRangeSeries||!a.chartRangeSeries.length)){const i=e?"Select scenarios, models, and a date range to see how the distribution evolves over time.":"Select scenarios and models to fetch the global box plot.";t=`<div style="${S($.chartEmpty)}">${i}</div>`}else t=e?Qr(a.chartRangeSeries??[]):Gr(a.chartBoxes??[]);const n=a.chartLocationName||(a.chartLocation==="Point"&&a.chartPoint?`Point (${a.chartPoint.lat.toFixed(2)}, ${a.chartPoint.lon.toFixed(2)})`:a.chartLocation==="Draw"?"Custom region":a.chartLocation==="World"?"Global":""),r=a.chartMode==="range"?`${ee(a.chartRangeStart)} – ${ee(a.chartRangeEnd)}`:ee(a.chartDate);return`
      <div data-role="chart-container" style="pointer-events:auto; width:100%; display:flex; align-items:center; justify-content:center; padding:24px; padding-right:${a.sidebarOpen?gt+32:24}px;">
        <div style="${S($.chartPanel)}">
          <div style="${S($.chartHeader)}">
            <div style="${S($.chartTitle)}">${Zn(a.chartVariable,a.metaData)}</div>
            <div style="${S($.mapSubtitle)}">${n?`${vt(n)} · ${r}`:r}</div>
          </div>
          <div style="${S(lt($.chartPlotWrapper,{display:"flex",alignItems:"center",justifyContent:"center"}))}">
            ${t}
          </div>
        </div>
      </div>
    `}function nt(t,e){return`
    <div style="${S($.field)}">
      ${t?`<div style="${S($.fieldLabel)}">${t}</div>`:""}
      ${e}
    </div>
  `}function te(t,e,n){const r=n?.type??"date",o=n?.dataKey??t,i=n?.min?`min="${n.min}"`:"",s=n?.max?`max="${n.max}"`:"";return`
    <input
      type="${r}"
      value="${e}"
      data-action="update-input"
      data-key="${o}"
      ${i}
      ${s}
    />
  `}function ot(t,e,n,r){const o=r?.dataKey??t,i=r?.disabled?"disabled":"",s=`custom-select-${o}-${Math.random().toString(36).substr(2,9)}`,l=r?.infoType,c=vt(r?.selectedLabel??n),u=r?.extraContent??"";return`
    <div class="custom-select-container">
      <div class="custom-select-info-panel" id="${s}-info" role="tooltip"></div>
      <div class="custom-select-wrapper" data-key="${o}" ${i?'data-disabled="true"':""} ${l?`data-info-type="${l}"`:""}>
        <div class="custom-select-trigger" data-action="update-select" data-key="${o}" id="${s}-trigger" ${i?'aria-disabled="true"':""} tabindex="${i?"-1":"0"}">
          <span class="custom-select-value">${c}</span>
          <svg class="custom-select-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="custom-select-dropdown" id="${s}-dropdown" role="listbox">
          ${e.map(d=>`
                <div class="custom-select-option ${d===n?"selected":""}" 
                     data-value="${d}" 
                     data-action="update-select" 
                     data-key="${o}"
                     role="option"
                     ${d===n?'aria-selected="true"':""}
                     tabindex="0">
                  ${d}
                </div>
              `).join("")}
          ${u}
        </div>
      </div>
    </div>
  `}function Zf(t,e,n="panel-tab"){return`
    <button
      type="button"
      data-action="set-tab"
      data-key="${n}"
      data-value="${t}"
      style="${S(lt($.tabBtn,e))}"
    >
      ${t}
    </button>
  `}function Jf(t){const{modeTransform:e,resolutionFill:n,modeIndicatorTransform:r}=t,o=a.compareMode==="Models"?[nt("Scenario",ot("scenario",kt,a.scenario,{infoType:"scenario"})),nt("Date",te("date",a.date))]:a.compareMode==="Dates"?[nt("Scenario",ot("scenario",kt,a.scenario,{infoType:"scenario"})),nt("Model",ot("model",xt,a.model,{infoType:"model"}))]:[nt("Model",ot("model",xt,a.model,{infoType:"model"})),nt("Date",te("date",a.date))];return`
    <div style="${S($.modeSwitch)}">
      <div data-role="mode-indicator" style="${S({...$.modeIndicator,transform:r})}"></div>
      ${["Explore","Compare"].map(i=>`
            <button
              type="button"
              class="mode-btn"
              data-action="set-mode"
              data-value="${i}"
              style="${S(lt($.modeBtn,a.mode===i?$.modeBtnActive:void 0))}"
            >
              ${i}
            </button>
          `).join("")}
    </div>

    <div style="${S($.modeViewport)}">
      <div data-role="mode-track" style="${S({...$.modeTrack,transform:e})}">
        <div class="mode-pane-scrollable" style="${S($.modePane)}">
          <div style="${S({display:"flex",flexDirection:"column",gap:8})}">
            <div style="${S($.sectionTitle)}">Parameters</div>
            <div style="${S($.paramGrid)}">
              ${nt("Scenario",ot("scenario",kt,a.scenario,{infoType:"scenario"}))}
              ${nt("Model",ot("model",xt,a.model,{infoType:"model"}))}
              ${nt("Date",(()=>{const i=Tt(a.scenario);return te("date",a.date,{min:i.start,max:i.end})})())}
              ${nt("Variable",ot("variable",Yt,a.variable,{infoType:"variable"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${S({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${S($.sectionTitle)}">Unit</div>
              ${nt("",ot("unit",ne(a.variable).map(i=>i.label),a.selectedUnit,{dataKey:"unit"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${S({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${S($.sectionTitle)}">Color palette</div>
              ${nt("",ot("palette",dt.map(i=>i.name),a.palette,{dataKey:"palette"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${S({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${S($.sectionTitle)}">Resolution</div>
              <div style="${S($.resolutionRow)}">
                <input
                  type="range"
                  min="1"
                  max="3"
                  step="1"
                  value="${a.resolution}"
                  data-action="set-resolution"
                  class="resolution-slider"
                  style="${S(lt($.range,{"--slider-fill":`${n}%`}))}"
                />
                <div data-role="resolution-value" style="${S($.resolutionValue)}">${a.resolution===1?"Low":a.resolution===2?"Medium":"High"}</div>
              </div>
            </div>
          </div>
        </div>

        <div class="mode-pane-scrollable" style="${S($.modePane)}">
          <div style="${S({display:"flex",flexDirection:"column",gap:14})}">
            <div style="${S({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${S($.sectionTitle)}">Compare</div>
              <div style="${S($.paramGrid)}">
                ${nt("What do you want to compare?",ot("compareMode",["Scenarios","Models","Dates"],a.compareMode,{dataKey:"compareMode"}))}
              </div>

              ${a.compareMode==="Scenarios"?`
                      <div style="${S($.paramGrid)}">
                        ${nt("Scenario A",ot("compareScenarioA",["SSP245","SSP370","SSP585"],a.compareScenarioA,{dataKey:"compareScenarioA",infoType:"scenario"}))}
                        ${nt("Scenario B",ot("compareScenarioB",["SSP245","SSP370","SSP585"],a.compareScenarioB,{dataKey:"compareScenarioB",infoType:"scenario"}))}
                      </div>
                    `:""}

              ${a.compareMode==="Models"?`
                      <div style="${S($.paramGrid)}">
                        ${nt("Model A",ot("compareModelA",(()=>{const i=xt.filter(s=>s!==a.compareModelB);return i.includes(a.compareModelA)?i:[a.compareModelA,...i]})(),a.compareModelA,{dataKey:"compareModelA",infoType:"model"}))}
                        ${nt("Model B",ot("compareModelB",(()=>{const i=xt.filter(s=>s!==a.compareModelA);return i.includes(a.compareModelB)?i:[a.compareModelB,...i]})(),a.compareModelB,{dataKey:"compareModelB",infoType:"model"}))}
                      </div>
                    `:""}

              ${a.compareMode==="Dates"?`
                      <div style="${S($.paramGrid)}">
                        ${nt("Start date",te("compareDateStart",a.compareDateStart,{dataKey:"compareDateStart"}))}
                        ${nt("End date",te("compareDateEnd",a.compareDateEnd,{dataKey:"compareDateEnd"}))}
  </div>
`:""}

              <div style="${S($.paramGrid)}">
                ${o.join("")}
                ${nt("Variable",ot("variable",Yt,a.variable,{infoType:"variable"}))}
              </div>

              <div style="margin-top:14px">
                <div style="${S({display:"flex",flexDirection:"column",gap:8})}">
                  <div style="${S($.sectionTitle)}">Unit</div>
                  ${nt("",ot("unit",ne(a.variable).map(i=>i.label),a.selectedUnit,{dataKey:"unit"}))}
                </div>
              </div>

              <div style="margin-top:14px">
                <div style="${S({display:"flex",flexDirection:"column",gap:8})}">
                  <div style="${S($.sectionTitle)}">Color palette</div>
                  ${nt("",ot("palette",dt.map(i=>i.name),a.palette,{dataKey:"palette"}))}
                </div>
              </div>

              <div style="margin-top:14px">
                <div style="${S({display:"flex",flexDirection:"column",gap:8})}">
                  <div style="${S($.sectionTitle)}">Resolution</div>
                  <div style="${S($.resolutionRow)}">
                    <input
                      type="range"
                      min="1"
                      max="3"
                      step="1"
                      value="${a.resolution}"
                      data-action="set-resolution"
                      class="resolution-slider"
                      style="${S(lt($.range,{"--slider-fill":`${n}%`}))}"
                    />
                    <div data-role="resolution-value" style="${S($.resolutionValue)}">${a.resolution===1?"Low":a.resolution===2?"Medium":"High"}</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  `}function yn(t,e,n){const r=new Set(e);return`
      <div style="${S($.chipRow)}">
        ${t.map(o=>{const i=r.has(o);return`
                  <button
                    type="button"
                    data-action="toggle-multi"
                    data-key="${n}"
                    data-value="${o}"
                    style="${S(lt($.chip,i?$.chipActive:void 0))}"
                  >
                    ${o}
                  </button>
                `}).join("")}
      </div>
    `}function Zr(){const t=a.chartLocationSearchResults.length>0?a.chartLocationSearchResults.map(r=>`
                <button
                  type="button"
                  class="location-search-result"
                  data-role="location-search-result"
                  data-name="${vt(r.displayName)}"
                  data-lat="${r.lat}"
                  data-lon="${r.lon}"
                >
                  <div class="location-search-result-name">${vt(r.displayName)}</div>
                  <div class="location-search-result-coord">
                    ${r.lat.toFixed(3)}, ${r.lon.toFixed(3)}
                  </div>
                </button>
              `).join(""):"",e=a.chartLocationSearchQuery.trim().length>0,n=a.chartLocationSearchError?`<div class="location-search-error">${vt(a.chartLocationSearchError)}</div>`:a.chartLocationSearchLoading?'<div class="location-search-status">Searching...</div>':a.chartLocationSearchResults.length===0&&e?'<div class="location-search-status">No places found. Try refining your query.</div>':"";return`
      <div class="custom-select-extra" data-role="chart-location-search">
        <div class="location-search-row">
          <input
            type="text"
            class="location-search-input"
            value="${vt(a.chartLocationSearchQuery)}"
            placeholder="Search a place (e.g. Aachen)"
            data-role="location-search-input"
          />
        </div>
        ${n}
        <div class="location-search-results" data-role="location-search-results">
          ${t||""}
        </div>
      </div>
    `}function th(){if(a.canvasView!=="map")return"";const t=a.mapLocationSearchResults.length>0?a.mapLocationSearchResults.map(s=>`
                <button
                  type="button"
                  class="location-search-result"
                  data-role="map-location-search-result"
                  data-name="${vt(s.displayName)}"
                  data-lat="${s.lat}"
                  data-lon="${s.lon}"
                >
                  <div class="location-search-result-name">${vt(s.displayName)}</div>
                  <div class="location-search-result-coord">
                    ${s.lat.toFixed(3)}, ${s.lon.toFixed(3)}
                  </div>
                </button>
              `).join(""):"",e=a.mapLocationSearchQuery.trim().length>0,n=a.mapLocationSearchError?`<div class="location-search-error">${vt(a.mapLocationSearchError)}</div>`:a.mapLocationSearchLoading?'<div class="location-search-status">Searching...</div>':a.mapLocationSearchResults.length===0&&e&&!a.mapLocationSearchSelection?'<div class="location-search-status">No places found. Try refining your query.</div>':"",r=!!(t||n&&!a.mapLocationSearchLoading),o=a.sidebarOpen?-gt/2:0,i=lt($.mapSearchWrap,{top:18,transform:`translateX(calc(-50% + ${o}px))`});return`
      <div data-role="map-location-search" style="${S(i)}">
        <div class="location-search-row" style="display: flex; align-items: center; gap: 8px;">
          <input
            type="text"
            class="location-search-input"
            value="${vt(a.mapLocationSearchQuery)}"
            placeholder="Search a place (e.g. Aachen)"
            data-role="map-location-search-input"
            style="flex: 1;"
          />
          <button
            type="button"
            data-action="toggle-map-draw"
            aria-label="${a.drawState.active?"Stop drawing":"Start drawing"}"
            style="
              display: flex;
              align-items: center;
              justify-content: center;
              width: 36px;
              height: 36px;
              padding: 0;
              border: 1px solid rgba(148, 163, 184, 0.3);
              border-radius: 6px;
              background: ${a.drawState.active?"rgba(52, 211, 153, 0.1)":"rgba(15, 23, 42, 0.85)"};
              color: ${a.drawState.active?"#34d399":"var(--text-secondary)"};
              cursor: pointer;
              transition: all 0.2s ease;
            "
            onmouseover="this.style.background='rgba(52, 211, 153, 0.2)';this.style.color='#34d399';"
            onmouseout="this.style.background='${a.drawState.active?"rgba(52, 211, 153, 0.1)":"rgba(15, 23, 42, 0.85)"}';this.style.color='${a.drawState.active?"#34d399":"var(--text-secondary)"}';"
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
          </button>
        </div>
        ${a.mapLocationSearchLoading?n:""}
        ${r?`
        ${a.mapLocationSearchLoading?"":n}
        <div
          class="location-search-results"
          data-role="map-location-search-results"
          style="${S($.mapSearchResults)}"
        >
          ${t||""}
        </div>`:""}
      </div>
    `}function eh(){const t=a.chartMode==="single"?"translateX(0%)":"translateX(100%)",e=a.metaData?.scenarios?.length?Array.from(new Set(a.metaData.scenarios.map(Qn))):kt,n=a.metaData?.models?.length?a.metaData.models:xt,r=ar(a.chartScenarios.length?a.chartScenarios:e),o=(l,c,u,d,h)=>`
          <div style="${S({border:"1px solid var(--border-medium)",borderRadius:12,background:"var(--bg-subtle)",padding:"10px 12px"})}">
            <button
              type="button"
              data-action="toggle-collapse"
              data-key="${h}"
              style="${S({display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",background:"transparent",border:"none",color:"var(--text-primary)",fontWeight:700,fontSize:13,cursor:"pointer",padding:0})}"
            >
              <span>${l}</span>
              <span style="${S({color:"var(--text-secondary)",fontWeight:600,fontSize:12})}">${u} ${c?"▴":"▾"}</span>
            </button>
            ${c?`<div style="${S({marginTop:10,display:"flex",flexWrap:"wrap",gap:8})}">${d}</div>`:""}
          </div>
        `,i=`
      <div style="${S($.paramGrid)}">
        ${nt("Date",te("chartDate",a.chartDate,{dataKey:"chartDate",min:r.start,max:r.end}))}
        ${nt("Variable",ot("chartVariable",Yt,a.chartVariable,{dataKey:"chartVariable",infoType:"variable"}))}
      </div>

      <div style="margin-top:10px">
        ${nt("Location",ot("chartLocation",["World","Draw","Point"],a.chartLocation,{dataKey:"chartLocation",selectedLabel:a.chartLocation==="Search"&&a.chartLocationName?`Search: ${a.chartLocationName}`:a.chartLocation,extraContent:Zr()}))}
      </div>

      <div style="margin-top:14px">
        ${o("Scenarios",a.chartDropdown.scenariosOpen,`${a.chartScenarios.length} selected`,yn(e,a.chartScenarios,"chartScenarios"),"chartScenarios")}
      </div>

      <div style="margin-top:14px">
        ${o("Models",a.chartDropdown.modelsOpen,`${a.chartModels.length} selected`,yn(n,a.chartModels,"chartModels"),"chartModels")}
      </div>

      <div style="margin-top:14px">
        <div style="${S($.sectionTitle)}">Unit</div>
        ${nt("",ot("chartUnit",ne(a.chartVariable).map(l=>l.label),a.chartUnit,{dataKey:"chartUnit"}))}
      </div>
    `,s=`
      <div style="${S($.paramGrid)}">
        ${nt("Start date",te("chartRangeStart",a.chartRangeStart,{dataKey:"chartRangeStart",min:r.start,max:r.end}))}
        ${nt("End date",te("chartRangeEnd",a.chartRangeEnd,{dataKey:"chartRangeEnd",min:r.start,max:r.end}))}
      </div>

      <div style="${S(lt($.paramGrid,{marginTop:12}))}">
        ${nt("Variable",ot("chartVariable",Yt,a.chartVariable,{dataKey:"chartVariable",infoType:"variable"}))}
      </div>

      <div style="margin-top:10px">
        ${nt("Location",ot("chartLocation",["World","Draw","Point"],a.chartLocation,{dataKey:"chartLocation",selectedLabel:a.chartLocation==="Search"&&a.chartLocationName?`Search: ${a.chartLocationName}`:a.chartLocation,extraContent:Zr()}))}
      </div>

      <div style="margin-top:14px">
        ${o("Scenarios",a.chartDropdown.scenariosOpen,`${a.chartScenarios.length} selected`,yn(e,a.chartScenarios,"chartScenarios"),"chartScenarios")}
      </div>

      <div style="margin-top:14px">
        ${o("Models",a.chartDropdown.modelsOpen,`${a.chartModels.length} selected`,yn(n,a.chartModels,"chartModels"),"chartModels")}
      </div>

      <div style="margin-top:14px">
        <div style="${S($.sectionTitle)}">Unit</div>
        ${nt("",ot("chartUnit",ne(a.chartVariable).map(l=>l.label),a.chartUnit,{dataKey:"chartUnit"}))}
      </div>
    `;return`
      <div style="${S($.modeSwitch)}">
        <div data-role="chart-mode-indicator" style="${S({...$.modeIndicator,transform:t})}"></div>
        ${["single","range"].map(l=>{const c=l==="single"?"Single dates":"Range";return`
              <button
                type="button"
                class="mode-btn"
                data-action="set-chart-mode"
                data-value="${l}"
                style="${S(lt($.modeBtn,a.chartMode===l?$.modeBtnActive:void 0))}"
              >
                ${c}
              </button>
            `}).join("")}
      </div>

      <div class="mode-pane-scrollable" style="${S($.modePane)}">
        ${a.chartMode==="single"?i:s}
      </div>
    `}function nh(){return`
    <div style="${S({display:"flex",flexDirection:"column",gap:8})}">
      <div style="${S($.sectionTitle)}">Chat</div>
      <div style="${S($.chatStack)}">
        <div style="${S($.chatLead)}">Discuss the data with an agent, or ask questions.</div>

        <div style="${S($.chatMessages)}">
          ${a.chatMessages.map(t=>{const e=t.sender==="user"?lt($.chatBubble,$.chatBubbleUser):lt($.chatBubble,$.chatBubbleAgent);return`<div style="${S(e)}">${t.text}</div>`}).join("")}
        </div>

        <div style="${S($.chatBox)}">
          <input
            type="text"
            value="${a.chatInput}"
            data-action="chat-input"
            style="${S($.chatInput)}"
            placeholder="Ask a question"
          />
          <button type="button" data-action="chat-send" aria-label="Send chat message" style="${S($.chatSend)}">
            ➤
          </button>
        </div>
      </div>
    </div>
  `}function Jr(t,e,n){const r=Math.hypot(t,e);if(!r||!isFinite(r)||n<=0)return{x:0,y:0};const o=Math.min(1,n/r);return{x:t*o,y:e*o}}function ah(t){pn&&(pn(),pn=null),re!==null&&(cancelAnimationFrame(re),re=null),Kt!==null&&(cancelAnimationFrame(Kt),Kt=null),oe!==null&&(clearTimeout(oe),oe=null),Ft!==null&&(clearTimeout(Ft),Ft=null);const e=t.querySelector('[data-role="brand-eye"]');if(!e)return;let n={x:0,y:0},r={x:0,y:0},o={x:0,y:0},i={x:0,y:0},s=1,l=!1;const c=3e4,u=(v,T)=>{const M=e.getBoundingClientRect(),k=M.left+M.width/2,w=M.top+M.height/2,A=v-k,O=T-w,z=Math.min(M.width,M.height)*.14,N=z*.6;n=Jr(A,O,z),r=Jr(A,O,N)},d=v=>{s=Math.max(0,Math.min(1,v)),e.style.setProperty("--blink-open",`${s}`)},h=()=>{Ft!==null&&clearTimeout(Ft),Ft=window.setTimeout(()=>{n={x:0,y:0},r={x:0,y:0}},c)},p=()=>{o.x+=(n.x-o.x)*.28,o.y+=(n.y-o.y)*.28,i.x+=(r.x-i.x)*.32,i.y+=(r.y-i.y)*.32,e.style.setProperty("--iris-x",`${o.x}px`),e.style.setProperty("--iris-y",`${o.y}px`),e.style.setProperty("--pupil-x",`${i.x}px`),e.style.setProperty("--pupil-y",`${i.y}px`),re=requestAnimationFrame(p)},m=()=>{if(l)return;l=!0;const v=[{t:0,v:1},{t:.16,v:.08},{t:.26,v:.02},{t:.4,v:1}],T=350,M=performance.now(),k=w=>{const A=w-M,O=Math.min(1,A/T);let W=v[0],z=v[v.length-1];for(let g=0;g<v.length-1;g++){const y=v[g],D=v[g+1];if(O>=y.t&&O<=D.t){W=y,z=D;break}}const N=z.t-W.t||1,G=Math.min(1,Math.max(0,(O-W.t)/N)),B=1-Math.pow(1-G,2),f=W.v+(z.v-W.v)*B;d(f),O<1?Kt=requestAnimationFrame(k):(d(1),l=!1,b())};Kt=requestAnimationFrame(k)},b=()=>{const v=3e3+Math.random()*15e3;oe=window.setTimeout(m,v)},E=()=>{const v=e.getBoundingClientRect();u(v.left+v.width/2,v.top+v.height/2)},L=v=>{u(v.clientX,v.clientY),h()},x=()=>E();E(),p(),b(),h(),window.addEventListener("pointermove",L),window.addEventListener("pointerleave",x),pn=()=>{window.removeEventListener("pointermove",L),window.removeEventListener("pointerleave",x),re!==null&&(cancelAnimationFrame(re),re=null),Kt!==null&&(cancelAnimationFrame(Kt),Kt=null),oe!==null&&(clearTimeout(oe),oe=null),Ft!==null&&(clearTimeout(Ft),Ft=null)}}function rh(t){if(!tt)return;const e=tt;ah(e),zd({root:e,getSidebarOpen:()=>a.sidebarOpen,setSidebarOpen:f=>{a.sidebarOpen=f},onTimeSliderUpdate:f=>{pf(f,gt)},onCanvasToggleUpdate:f=>{const g=a.sidebarOpen?1:.9;Qo(f+8,g),ti()}}),e.querySelectorAll('[data-action="set-canvas"]').forEach(f=>f.addEventListener("click",()=>{const g=f.dataset.value;if(g){if(g===a.canvasView)return;const D=a.canvasView==="map"?"translateX(0%)":"translateX(100%)",P=g==="map"?"translateX(0%)":"translateX(100%)";a.canvasView=g,U(),g==="map"?Ct():Ut();const _=e.querySelector('[data-role="canvas-indicator"]');if(!_)return;_.style.removeProperty("transition"),_.style.transform=D,_.offsetHeight,_.getBoundingClientRect(),requestAnimationFrame(()=>{_.style.transition="transform 180ms ease",_.style.transform=P})}})),e.querySelectorAll('[data-action="set-mode"]').forEach(f=>f.addEventListener("click",()=>{const g=f.dataset.value;if(g){if(g===a.mode)return;const y=a.mode,D=y==="Explore"?"translateX(0%)":"translateX(-50%)",P=y==="Explore"?"translateX(0%)":"translateX(100%)",_=g==="Explore"?"translateX(0%)":"translateX(-50%)",F=g==="Explore"?"translateX(0%)":"translateX(100%)";a.mode=g,U();const I=e.querySelector('[data-role="mode-track"]'),V=e.querySelector('[data-role="mode-indicator"]');if(!I||!V)return;I.style.transition="none",V.style.transition="none",I.style.transform=D,V.style.transform=P,I.offsetHeight,I.style.transition="transform 220ms ease",V.style.transition="transform 200ms ease",I.style.transform=_,V.style.transform=F}a.canvasView==="map"&&Ct()})),e.querySelectorAll('[data-action="set-chart-mode"]').forEach(f=>f.addEventListener("click",()=>{const g=f.dataset.value;if(!g||g===a.chartMode)return;const D=a.chartMode==="single"?"translateX(0%)":"translateX(100%)",P=g==="single"?"translateX(0%)":"translateX(100%)";a.chartMode=g,U();const _=e.querySelector('[data-role="chart-mode-indicator"]');_&&(_.style.removeProperty("transition"),_.style.transform=D,_.offsetHeight,requestAnimationFrame(()=>{_.style.transition="transform 200ms ease",_.style.transform=P})),a.canvasView==="chart"&&Ut()})),e.querySelectorAll('[data-action="set-tab"]').forEach(f=>f.addEventListener("click",()=>{const g=f.dataset.value;if(g){if(g===a.panelTab)return;const D=a.panelTab==="Manual"?"translateX(0%)":"translateX(-50%)",P=g==="Manual"?"translateX(0%)":"translateX(-50%)";a.panelTab=g,U();const _=e.querySelector('[data-role="tab-track"]');if(!_)return;_.style.removeProperty("transition"),_.style.transform=D,_.offsetHeight,_.getBoundingClientRect(),requestAnimationFrame(()=>{_.style.transition="transform 220ms ease",_.style.transform=P})}}));const s=e.querySelectorAll(".custom-select-wrapper");let l=document.querySelector(".custom-select-info-panel-shared");l||(l=document.createElement("div"),l.className="custom-select-info-panel custom-select-info-panel-shared",l.setAttribute("role","tooltip"),document.body.appendChild(l));const c=f=>{f.target.closest(".custom-select-wrapper")||(s.forEach(y=>{y.classList.remove("open")}),l&&l.classList.remove("visible"))},u=f=>{f.key==="Escape"&&(s.forEach(g=>{g.classList.remove("open")}),l&&l.classList.remove("visible"))};document.addEventListener("click",c),document.addEventListener("keydown",u),s.forEach(f=>{const g=f.querySelector(".custom-select-trigger"),y=f.querySelector(".custom-select-dropdown"),D=f.querySelectorAll(".custom-select-option"),P=f.dataset.key,_=f.dataset.infoType,F=f.dataset.disabled==="true";if(!g||!y||F)return;const I=l,V=(q,H)=>{if(!I||!_)return;let K="",rt=q;if(_==="scenario"?K=gf[q]||"":_==="variable"?(K=vf[q]||"",rt=yf[q]||q):_==="model"&&(K=xf[q]||""),K){if(I.innerHTML=`
                    <div class="custom-select-info-panel-title">${rt}</div>
                    <div class="custom-select-info-panel-content">${K}</div>
                `,H||g){const R=H||g;if(R){const Y=R.getBoundingClientRect();I.style.left=`${Y.left-272}px`,I.style.top=`${Y.top}px`}}I.classList.add("visible")}},Z=()=>{I&&I.classList.remove("visible")};g.addEventListener("click",q=>{if(q.stopPropagation(),F)return;const H=f.classList.contains("open");s.forEach(K=>{K!==f&&K.classList.remove("open")}),f.classList.toggle("open",!H)}),g.addEventListener("keydown",q=>{if(!F&&(q.key==="Enter"||q.key===" "||q.key==="ArrowDown")){q.preventDefault(),f.classList.add("open");const H=D[0];H&&H.focus()}}),D.forEach(q=>{q.addEventListener("click",H=>{H.stopPropagation();const K=q.dataset.value;if(!K||!P)return;D.forEach(R=>{R.classList.remove("selected"),R.removeAttribute("aria-selected")}),q.classList.add("selected"),q.setAttribute("aria-selected","true");const rt=g.querySelector(".custom-select-value");rt&&(rt.textContent=K),f.classList.remove("open"),Z(),d(P,K)}),_&&(q.addEventListener("mouseenter",()=>{const H=q.dataset.value;H&&V(H,q)}),q.addEventListener("mouseleave",()=>{Z()})),q.addEventListener("keydown",H=>{const K=Array.from(D).indexOf(q);if(H.key==="Enter"||H.key===" ")H.preventDefault(),q.click();else if(H.key==="ArrowDown"){H.preventDefault();const rt=(K+1)%D.length;D[rt]?.focus()}else if(H.key==="ArrowUp"){H.preventDefault();const rt=K===0?D.length-1:K-1;D[rt]?.focus()}else H.key==="Escape"?(H.preventDefault(),f.classList.remove("open"),Z(),g.focus()):H.key==="Home"?(H.preventDefault(),D[0]?.focus()):H.key==="End"&&(H.preventDefault(),D[D.length-1]?.focus())})}),new MutationObserver(q=>{q.forEach(H=>{H.type==="attributes"&&H.attributeName==="class"&&(f.classList.contains("open")||Z())})}).observe(f,{attributes:!0})});const d=async(f,g)=>{if(!f)return;let y=!1,D=!1;switch(f){case"scenario":a.scenario=g,a.date=$f(g),a.timeRange=Tt(g),y=!0;break;case"model":a.model=g,y=!0;break;case"variable":a.variable=g,a.selectedUnit=je(g).label,y=!0;break;case"unit":if(a.selectedUnit=g,U(),a.currentData&&tt&&a.dataMin!==null&&a.dataMax!==null){const P=tt.querySelector("#map-canvas");if(P){yt=P,rr(P),Ia(a.currentData,yt,dt,a.palette,a.dataMin,a.dataMax,a.variable,a.selectedUnit);const _=dt.find(F=>F.name===a.palette)||dt[0];ka("legend-gradient-canvas",_.colors)}}a.mapMarker&&a.mapInfoOpen&&(a.mapInfoSamples.length?(a.mapInfoBoxes=Ke(a.mapInfoSamples,a.variable,a.selectedUnit),U()):a.mapInfoLoading||Te());return;case"palette":if(a.palette=g,U(),a.canvasView==="map"&&a.currentData&&tt&&a.dataMin!==null&&a.dataMax!==null){const P=tt.querySelector("#map-canvas");if(P){yt=P,Ia(a.currentData,yt,dt,a.palette,a.dataMin,a.dataMax,a.variable,a.selectedUnit);const _=dt.find(F=>F.name===a.palette)||dt[0];ka("legend-gradient-canvas",_.colors)}}return;case"compareMode":a.compareMode=g,y=!0;break;case"compareScenarioA":g===a.compareScenarioB&&(a.compareScenarioB=a.compareScenarioA),a.compareScenarioA=g,y=!0;break;case"compareScenarioB":g===a.compareScenarioA&&(a.compareScenarioA=a.compareScenarioB),a.compareScenarioB=g,y=!0;break;case"compareModelA":g===a.compareModelB&&(a.compareModelB=a.compareModelA),a.compareModelA=g,y=!0;break;case"compareModelB":g===a.compareModelA&&(a.compareModelA=a.compareModelB),a.compareModelB=g,y=!0;break;case"chartVariable":a.chartVariable=g,a.chartUnit=je(g).label,D=!0;break;case"chartUnit":a.chartUnit=g,a.chartSamples.length&&(a.chartMode==="range"?(a.chartRangeSeries=Ln(a.chartSamples,a.chartVariable,a.chartUnit),a.chartBoxes=null):a.chartBoxes=Ke(a.chartSamples,a.chartVariable,a.chartUnit)),U();return;case"chartLocation":if(g==="Draw"){Hr();return}if(g==="Point"){Wr();return}if(g==="Search"){a.chartLocation="Search",a.chartPolygon=null,a.pointSelectActive=!1,a.drawState=ae(),a.chartError=null,a.chartLocationName=null,a.chartLocationSearchError=null,a.chartLocationSearchResults=[],a.chartLocationSearchQuery="",a.chartLocationSearchLoading=!1,a.canvasView="chart",qn(),Hn(),U();return}a.chartLocation="World",a.chartPolygon=null,a.chartPoint=null,a.chartLocationName=null,a.chartLocationSearchError=null,a.chartLocationSearchResults=[],a.chartLocationSearchQuery="",a.chartLocationSearchLoading=!1,qn(),Hn(),D=!0;break}if(U(),a.canvasView==="map"&&y){Ct();const P=a.mapMarker!==null,_=a.mapPolygon!==null&&a.mapPolygon.length>=3;(P||_)&&a.mapInfoOpen&&Te()}a.canvasView==="chart"&&(D||y)&&Ut()},h=e.querySelector('.custom-select-wrapper[data-key="chartLocation"]');if(h){h.querySelectorAll(".custom-select-option").forEach(_=>{_.addEventListener("click",()=>{const F=_.dataset.value;F==="Draw"&&a.chartLocation==="Draw"?Hr():F==="Point"&&a.chartLocation==="Point"&&Wr()})});const g=h.querySelectorAll('[data-role="location-search-input"]'),y=h.querySelectorAll('[data-role="location-search-result"]'),D=()=>{de!==null&&(window.clearTimeout(de),de=null)},P=_=>{D(),Rf(_)};if(g.forEach(_=>{_.addEventListener("input",()=>{const F=a.chartLocationSearchResults.length>0,I=a.chartLocationSearchLoading,V=!!a.chartLocationSearchError;if(a.chartLocationSearchQuery=_.value,a.chartLocationSearchError=null,D(),!_.value.trim()){a.chartLocationSearchResults=[],a.chartLocationSearchLoading=!1,U();return}(F||I||V)&&(a.chartLocationSearchResults=[],a.chartLocationSearchLoading=!1,U()),de=window.setTimeout(()=>{P(_.value)},zr)}),_.addEventListener("keydown",F=>{F.key==="Enter"&&(F.preventDefault(),D(),P(_.value))})}),y.forEach(_=>{_.addEventListener("click",()=>{const F=Number(_.dataset.lat),I=Number(_.dataset.lon),V=_.dataset.name??"Selected place";!Number.isFinite(F)||!Number.isFinite(I)||(h.classList.remove("open"),Af({displayName:V,lat:F,lon:I}))})}),a.chartLocation==="Search"){const _=h.querySelector('[data-role="location-search-input"]');_&&setTimeout(()=>_.focus(),0)}}const p=e.querySelectorAll('[data-role="map-location-search-input"]'),m=e.querySelectorAll('[data-role="map-location-search-result"]'),b=()=>{fe!==null&&(window.clearTimeout(fe),fe=null)},E=f=>{b(),Ff(f)};if(p.forEach(f=>{f.addEventListener("focus",()=>{a.mapLocationSearchFocused=!0});const g=()=>{const y=f.selectionStart??f.value.length,D=f.selectionEnd??f.value.length;a.mapLocationSearchCursor={start:y,end:D}};f.addEventListener("input",()=>{const y=a.mapLocationSearchResults.length>0,D=a.mapLocationSearchLoading,P=!!a.mapLocationSearchError;if(a.mapLocationSearchQuery=f.value,a.mapLocationSearchError=null,a.mapLocationSearchSelection=null,a.mapLocationSearchFocused=!0,g(),b(),!f.value.trim()){a.mapLocationSearchResults=[],a.mapLocationSearchLoading=!1,U();return}(y||D||P)&&(a.mapLocationSearchResults=[],a.mapLocationSearchLoading=!1,U()),fe=window.setTimeout(()=>{E(f.value)},zr)}),f.addEventListener("keyup",g),f.addEventListener("click",g),f.addEventListener("select",g),f.addEventListener("keydown",y=>{y.key==="Enter"&&(y.preventDefault(),b(),E(f.value))})}),m.forEach(f=>{f.addEventListener("click",()=>{const g=Number(f.dataset.lat),y=Number(f.dataset.lon),D=f.dataset.name??"Selected place";!Number.isFinite(g)||!Number.isFinite(y)||Nf({displayName:D,lat:g,lon:y})})}),a.mapLocationSearchFocused){const f=e.querySelector('[data-role="map-location-search-input"]');if(f){setTimeout(()=>f.focus(),0);const{start:g,end:y}=a.mapLocationSearchCursor,D=Math.min(g,f.value.length),P=Math.min(y,f.value.length);setTimeout(()=>f.setSelectionRange(D,P),0)}}e.querySelectorAll('select[data-action="update-select"]').forEach(f=>f.addEventListener("change",async()=>{const g=f.dataset.key,y=f.value;g&&await d(g,y)})),e.querySelectorAll('[data-action="toggle-multi"]').forEach(f=>f.addEventListener("click",()=>{const g=f.dataset.key,y=f.dataset.value;if(!(!g||!y)){if(g==="chartScenarios"){const D=a.metaData?.scenarios?.length&&a.metaData.scenarios?Array.from(new Set(a.metaData.scenarios.map(Qn))):kt,P=y==="Historical",_=new Set(a.chartScenarios);_.has(y)?_.delete(y):P?(_.clear(),_.add("Historical")):(_.delete("Historical"),_.add(y)),_.size===0&&_.add(P?"Historical":y),a.chartScenarios=Array.from(_).filter(I=>D.includes(I));const F=ar(a.chartScenarios);a.chartDate=St(a.chartDate,F),a.chartRangeStart=St(a.chartRangeStart,F),a.chartRangeEnd=St(a.chartRangeEnd,F)}if(g==="chartModels"){const D=a.metaData?.models?.length&&a.metaData.models?a.metaData.models:xt,P=new Set(a.chartModels);P.has(y)?P.delete(y):P.add(y),a.chartModels=P.size?Array.from(P):[...D]}U(),a.canvasView==="chart"&&Ut()}})),e.querySelectorAll('[data-action="toggle-collapse"]').forEach(f=>f.addEventListener("click",()=>{const g=f.dataset.key;g&&(g==="chartScenarios"&&(a.chartDropdown.scenariosOpen=!a.chartDropdown.scenariosOpen),g==="chartModels"&&(a.chartDropdown.modelsOpen=!a.chartDropdown.modelsOpen),U())})),e.querySelectorAll('[data-action="update-input"]').forEach(f=>{const g=()=>{const y=f.dataset.key;if(!y)return;const D=f.value;if(!(/^\d{4}-\d{2}-\d{2}$/.test(D)&&!isNaN(new Date(D).getTime()))){f.style.borderColor="rgba(239, 68, 68, 0.6)";return}f.style.borderColor="";let I=D;if(y==="date"&&(I=$e(D,a.scenario),I!==D&&(f.value=I)),(y==="date"?a.date:y==="compareDateStart"?a.compareDateStart:y==="compareDateEnd"?a.compareDateEnd:y==="chartRangeStart"?a.chartRangeStart:y==="chartRangeEnd"?a.chartRangeEnd:a.chartDate)!==I){switch(y){case"date":a.date=I;break;case"compareDateStart":a.compareDateStart=D;break;case"compareDateEnd":a.compareDateEnd=D;break;case"chartDate":a.chartDate=D;break;case"chartRangeStart":a.chartRangeStart=D;break;case"chartRangeEnd":a.chartRangeEnd=D;break}if(U(),y==="date"||a.mode==="Compare"&&(y==="compareDateStart"||y==="compareDateEnd")){Ct();const Z=a.mapMarker!==null,X=a.mapPolygon!==null&&a.mapPolygon.length>=3;(Z||X)&&a.mapInfoOpen&&Te()}a.canvasView==="chart"&&(y==="chartDate"||y==="chartRangeStart"||y==="chartRangeEnd")&&Ut()}};f.addEventListener("blur",g),f.addEventListener("keydown",y=>{y.key==="Enter"&&(y.preventDefault(),g(),f.blur())})});const M=e.querySelectorAll('[data-action="set-resolution"]'),k=e.querySelectorAll('[data-role="resolution-value"]'),w=f=>{const g=(f-1)/2*100,y=f===1?"Low":f===2?"Medium":"High";M.forEach(D=>{D.value=String(f),D.style.setProperty("--slider-fill",`${g}%`)}),k.forEach(D=>{D.textContent=y})};M.forEach(f=>f.addEventListener("input",()=>{const g=Number.parseInt(f.value,10);Number.isNaN(g)||(a.resolution=g,w(g),a.canvasView==="map"&&Ct())})),e.querySelector('[data-action="open-compare-info"]')?.addEventListener("click",()=>{a.compareInfoOpen=!0,U()}),e.querySelectorAll('[data-action="close-compare-info"]').forEach(f=>f.addEventListener("click",()=>{a.compareInfoOpen=!1,U()})),e.querySelector('[data-action="close-map-info"]')?.addEventListener("click",f=>{f.preventDefault(),Of()}),e.querySelector('[data-action="open-map-info-chart"]')?.addEventListener("click",f=>{f.preventDefault(),!(!a.mapMarker&&!a.mapPolygon)&&(a.canvasView="chart",a.chartMode="single",a.mapPolygon&&a.mapPolygon.length>=3?(a.chartLocation="Draw",a.chartPolygon=a.mapPolygon,a.chartPoint=null,a.chartLocationName=null):a.mapMarker&&(a.chartLocation="Point",a.chartPoint={lat:a.mapMarker.lat,lon:a.mapMarker.lon},a.chartLocationName=a.mapMarker.name??null,a.chartPolygon=null),a.chartVariable=a.variable,a.chartUnit=a.selectedUnit,a.chartDate=a.date,a.chartError=null,U(),Ut())}),e.querySelector('[data-action="toggle-map-draw"]')?.addEventListener("click",f=>{f.preventDefault(),a.drawState.active?Pf():Cf()}),hf({root:e,getTimeRange:()=>a.timeRange,onDateChange:f=>{a.date=f,Ct();const g=a.mapMarker!==null,y=a.mapPolygon!==null&&a.mapPolygon.length>=3;(g||y)&&a.mapInfoOpen&&Te()},getMode:()=>a.mode,getCompareMode:()=>a.compareMode,getCompareDates:()=>({start:a.compareDateStart,end:a.compareDateEnd}),onDateRangeChange:(f,g)=>{a.compareDateStart=f,a.compareDateEnd=g,Ct()}});const G=e.querySelector('[data-action="chat-input"]'),B=e.querySelector('[data-action="chat-send"]');G?.addEventListener("input",()=>{a.chatInput=G.value}),G?.addEventListener("keydown",f=>{f.key==="Enter"&&(f.preventDefault(),to())}),B?.addEventListener("click",to)}function to(){const t=a.chatInput.trim();if(!t)return;const e={id:Date.now(),sender:"user",text:t};a.chatMessages=[...a.chatMessages,e],a.chatInput="",da&&window.clearTimeout(da),da=window.setTimeout(()=>{const n={id:Date.now()+1,sender:"agent",text:"I don't work yet."};a.chatMessages=[...a.chatMessages,n],U()},1e3),U()}async function eo(){if(tt=document.querySelector("#app"),!tt)throw new Error("Root element #app not found");U(),Mf().then(()=>{U()}),a.canvasView==="map"&&a.mode==="Explore"&&Ct()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",eo):eo();
