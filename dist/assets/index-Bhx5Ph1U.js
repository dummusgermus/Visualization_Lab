(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function a(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=a(o);fetch(o.href,i)}})();function An(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Ai(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function nr(e){let t,a,r;e.length!==2?(t=An,a=(l,c)=>An(e(l),c),r=(l,c)=>e(l)-c):(t=e===An||e===Ai?e:Ri,a=e,r=e);function o(l,c,d=0,u=l.length){if(d<u){if(t(c,c)!==0)return u;do{const h=d+u>>>1;a(l[h],c)<0?d=h+1:u=h}while(d<u)}return d}function i(l,c,d=0,u=l.length){if(d<u){if(t(c,c)!==0)return u;do{const h=d+u>>>1;a(l[h],c)<=0?d=h+1:u=h}while(d<u)}return d}function s(l,c,d=0,u=l.length){const h=o(l,c,d,u-1);return h>d&&r(l[h-1],c)>-r(l[h],c)?h-1:h}return{left:o,center:s,right:i}}function Ri(){return 0}function So(e){return e===null?NaN:+e}const Ni=nr(An),Fi=Ni.right;nr(So).center;const Bi=Math.sqrt(50),Vi=Math.sqrt(10),Ui=Math.sqrt(2);function Xn(e,t,a){const r=(t-e)/Math.max(0,a),o=Math.floor(Math.log10(r)),i=r/Math.pow(10,o),s=i>=Bi?10:i>=Vi?5:i>=Ui?2:1;let l,c,d;return o<0?(d=Math.pow(10,-o)/s,l=Math.round(e*d),c=Math.round(t*d),l/d<e&&++l,c/d>t&&--c,d=-d):(d=Math.pow(10,o)*s,l=Math.round(e/d),c=Math.round(t/d),l*d<e&&++l,c*d>t&&--c),c<l&&.5<=a&&a<2?Xn(e,t,a*2):[l,c,d]}function Oi(e,t,a){if(t=+t,e=+e,a=+a,!(a>0))return[];if(e===t)return[e];const r=t<e,[o,i,s]=r?Xn(t,e,a):Xn(e,t,a);if(!(i>=o))return[];const l=i-o+1,c=new Array(l);if(r)if(s<0)for(let d=0;d<l;++d)c[d]=(i-d)/-s;else for(let d=0;d<l;++d)c[d]=(i-d)*s;else if(s<0)for(let d=0;d<l;++d)c[d]=(o+d)/-s;else for(let d=0;d<l;++d)c[d]=(o+d)*s;return c}function Aa(e,t,a){return t=+t,e=+e,a=+a,Xn(e,t,a)[2]}function Ra(e,t,a){t=+t,e=+e,a=+a;const r=t<e,o=r?Aa(t,e,a):Aa(e,t,a);return(r?-1:1)*(o<0?1/-o:o)}function qi(e,t){let a;for(const r of e)r!=null&&(a<r||a===void 0&&r>=r)&&(a=r);return a}function zi(e,t){let a;for(const r of e)r!=null&&(a>r||a===void 0&&r>=r)&&(a=r);return a}function wa(e,t,a=So){if(!(!(r=e.length)||isNaN(t=+t))){if(t<=0||r<2)return+a(e[0],0,e);if(t>=1)return+a(e[r-1],r-1,e);var r,o=(r-1)*t,i=Math.floor(o),s=+a(e[i],i,e),l=+a(e[i+1],i+1,e);return s+(l-s)*(o-i)}}function Hi(e,t){let a=0,r=0;for(let o of e)o!=null&&(o=+o)>=o&&(++a,r+=o);if(a)return r/a}var Wi={value:()=>{}};function ar(){for(var e=0,t=arguments.length,a={},r;e<t;++e){if(!(r=arguments[e]+"")||r in a||/[\s.]/.test(r))throw new Error("illegal type: "+r);a[r]=[]}return new Rn(a)}function Rn(e){this._=e}function Yi(e,t){return e.trim().split(/^|\s+/).map(function(a){var r="",o=a.indexOf(".");if(o>=0&&(r=a.slice(o+1),a=a.slice(0,o)),a&&!t.hasOwnProperty(a))throw new Error("unknown type: "+a);return{type:a,name:r}})}Rn.prototype=ar.prototype={constructor:Rn,on:function(e,t){var a=this._,r=Yi(e+"",a),o,i=-1,s=r.length;if(arguments.length<2){for(;++i<s;)if((o=(e=r[i]).type)&&(o=Xi(a[o],e.name)))return o;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++i<s;)if(o=(e=r[i]).type)a[o]=Mr(a[o],e.name,t);else if(t==null)for(o in a)a[o]=Mr(a[o],e.name,null);return this},copy:function(){var e={},t=this._;for(var a in t)e[a]=t[a].slice();return new Rn(e)},call:function(e,t){if((o=arguments.length-2)>0)for(var a=new Array(o),r=0,o,i;r<o;++r)a[r]=arguments[r+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(i=this._[e],r=0,o=i.length;r<o;++r)i[r].value.apply(t,a)},apply:function(e,t,a){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],o=0,i=r.length;o<i;++o)r[o].value.apply(t,a)}};function Xi(e,t){for(var a=0,r=e.length,o;a<r;++a)if((o=e[a]).name===t)return o.value}function Mr(e,t,a){for(var r=0,o=e.length;r<o;++r)if(e[r].name===t){e[r]=Wi,e=e.slice(0,r).concat(e.slice(r+1));break}return a!=null&&e.push({name:t,value:a}),e}var Na="http://www.w3.org/1999/xhtml";const $r={svg:"http://www.w3.org/2000/svg",xhtml:Na,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function da(e){var t=e+="",a=t.indexOf(":");return a>=0&&(t=e.slice(0,a))!=="xmlns"&&(e=e.slice(a+1)),$r.hasOwnProperty(t)?{space:$r[t],local:e}:e}function ji(e){return function(){var t=this.ownerDocument,a=this.namespaceURI;return a===Na&&t.documentElement.namespaceURI===Na?t.createElement(e):t.createElementNS(a,e)}}function Ki(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Mo(e){var t=da(e);return(t.local?Ki:ji)(t)}function Gi(){}function rr(e){return e==null?Gi:function(){return this.querySelector(e)}}function Qi(e){typeof e!="function"&&(e=rr(e));for(var t=this._groups,a=t.length,r=new Array(a),o=0;o<a;++o)for(var i=t[o],s=i.length,l=r[o]=new Array(s),c,d,u=0;u<s;++u)(c=i[u])&&(d=e.call(c,c.__data__,u,i))&&("__data__"in c&&(d.__data__=c.__data__),l[u]=d);return new Ne(r,this._parents)}function Zi(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function Ji(){return[]}function $o(e){return e==null?Ji:function(){return this.querySelectorAll(e)}}function es(e){return function(){return Zi(e.apply(this,arguments))}}function ts(e){typeof e=="function"?e=es(e):e=$o(e);for(var t=this._groups,a=t.length,r=[],o=[],i=0;i<a;++i)for(var s=t[i],l=s.length,c,d=0;d<l;++d)(c=s[d])&&(r.push(e.call(c,c.__data__,d,s)),o.push(c));return new Ne(r,o)}function ko(e){return function(){return this.matches(e)}}function Do(e){return function(t){return t.matches(e)}}var ns=Array.prototype.find;function as(e){return function(){return ns.call(this.children,e)}}function rs(){return this.firstElementChild}function os(e){return this.select(e==null?rs:as(typeof e=="function"?e:Do(e)))}var is=Array.prototype.filter;function ss(){return Array.from(this.children)}function ls(e){return function(){return is.call(this.children,e)}}function cs(e){return this.selectAll(e==null?ss:ls(typeof e=="function"?e:Do(e)))}function ds(e){typeof e!="function"&&(e=ko(e));for(var t=this._groups,a=t.length,r=new Array(a),o=0;o<a;++o)for(var i=t[o],s=i.length,l=r[o]=[],c,d=0;d<s;++d)(c=i[d])&&e.call(c,c.__data__,d,i)&&l.push(c);return new Ne(r,this._parents)}function To(e){return new Array(e.length)}function us(){return new Ne(this._enter||this._groups.map(To),this._parents)}function jn(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}jn.prototype={constructor:jn,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function hs(e){return function(){return e}}function fs(e,t,a,r,o,i){for(var s=0,l,c=t.length,d=i.length;s<d;++s)(l=t[s])?(l.__data__=i[s],r[s]=l):a[s]=new jn(e,i[s]);for(;s<c;++s)(l=t[s])&&(o[s]=l)}function ps(e,t,a,r,o,i,s){var l,c,d=new Map,u=t.length,h=i.length,f=new Array(u),p;for(l=0;l<u;++l)(c=t[l])&&(f[l]=p=s.call(c,c.__data__,l,t)+"",d.has(p)?o[l]=c:d.set(p,c));for(l=0;l<h;++l)p=s.call(e,i[l],l,i)+"",(c=d.get(p))?(r[l]=c,c.__data__=i[l],d.delete(p)):a[l]=new jn(e,i[l]);for(l=0;l<u;++l)(c=t[l])&&d.get(f[l])===c&&(o[l]=c)}function ms(e){return e.__data__}function gs(e,t){if(!arguments.length)return Array.from(this,ms);var a=t?ps:fs,r=this._parents,o=this._groups;typeof e!="function"&&(e=hs(e));for(var i=o.length,s=new Array(i),l=new Array(i),c=new Array(i),d=0;d<i;++d){var u=r[d],h=o[d],f=h.length,p=ys(e.call(u,u&&u.__data__,d,r)),x=p.length,k=l[d]=new Array(x),$=s[d]=new Array(x),w=c[d]=new Array(f);a(u,h,k,$,w,p,t);for(var b=0,L=0,E,T;b<x;++b)if(E=k[b]){for(b>=L&&(L=b+1);!(T=$[L])&&++L<x;);E._next=T||null}}return s=new Ne(s,r),s._enter=l,s._exit=c,s}function ys(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function vs(){return new Ne(this._exit||this._groups.map(To),this._parents)}function bs(e,t,a){var r=this.enter(),o=this,i=this.exit();return typeof e=="function"?(r=e(r),r&&(r=r.selection())):r=r.append(e+""),t!=null&&(o=t(o),o&&(o=o.selection())),a==null?i.remove():a(i),r&&o?r.merge(o).order():o}function xs(e){for(var t=e.selection?e.selection():e,a=this._groups,r=t._groups,o=a.length,i=r.length,s=Math.min(o,i),l=new Array(o),c=0;c<s;++c)for(var d=a[c],u=r[c],h=d.length,f=l[c]=new Array(h),p,x=0;x<h;++x)(p=d[x]||u[x])&&(f[x]=p);for(;c<o;++c)l[c]=a[c];return new Ne(l,this._parents)}function ws(){for(var e=this._groups,t=-1,a=e.length;++t<a;)for(var r=e[t],o=r.length-1,i=r[o],s;--o>=0;)(s=r[o])&&(i&&s.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(s,i),i=s);return this}function Ss(e){e||(e=Ms);function t(h,f){return h&&f?e(h.__data__,f.__data__):!h-!f}for(var a=this._groups,r=a.length,o=new Array(r),i=0;i<r;++i){for(var s=a[i],l=s.length,c=o[i]=new Array(l),d,u=0;u<l;++u)(d=s[u])&&(c[u]=d);c.sort(t)}return new Ne(o,this._parents).order()}function Ms(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function $s(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function ks(){return Array.from(this)}function Ds(){for(var e=this._groups,t=0,a=e.length;t<a;++t)for(var r=e[t],o=0,i=r.length;o<i;++o){var s=r[o];if(s)return s}return null}function Ts(){let e=0;for(const t of this)++e;return e}function Ls(){return!this.node()}function Es(e){for(var t=this._groups,a=0,r=t.length;a<r;++a)for(var o=t[a],i=0,s=o.length,l;i<s;++i)(l=o[i])&&e.call(l,l.__data__,i,o);return this}function Cs(e){return function(){this.removeAttribute(e)}}function _s(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Ps(e,t){return function(){this.setAttribute(e,t)}}function Is(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function As(e,t){return function(){var a=t.apply(this,arguments);a==null?this.removeAttribute(e):this.setAttribute(e,a)}}function Rs(e,t){return function(){var a=t.apply(this,arguments);a==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,a)}}function Ns(e,t){var a=da(e);if(arguments.length<2){var r=this.node();return a.local?r.getAttributeNS(a.space,a.local):r.getAttribute(a)}return this.each((t==null?a.local?_s:Cs:typeof t=="function"?a.local?Rs:As:a.local?Is:Ps)(a,t))}function Lo(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Fs(e){return function(){this.style.removeProperty(e)}}function Bs(e,t,a){return function(){this.style.setProperty(e,t,a)}}function Vs(e,t,a){return function(){var r=t.apply(this,arguments);r==null?this.style.removeProperty(e):this.style.setProperty(e,r,a)}}function Us(e,t,a){return arguments.length>1?this.each((t==null?Fs:typeof t=="function"?Vs:Bs)(e,t,a??"")):Ht(this.node(),e)}function Ht(e,t){return e.style.getPropertyValue(t)||Lo(e).getComputedStyle(e,null).getPropertyValue(t)}function Os(e){return function(){delete this[e]}}function qs(e,t){return function(){this[e]=t}}function zs(e,t){return function(){var a=t.apply(this,arguments);a==null?delete this[e]:this[e]=a}}function Hs(e,t){return arguments.length>1?this.each((t==null?Os:typeof t=="function"?zs:qs)(e,t)):this.node()[e]}function Eo(e){return e.trim().split(/^|\s+/)}function or(e){return e.classList||new Co(e)}function Co(e){this._node=e,this._names=Eo(e.getAttribute("class")||"")}Co.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function _o(e,t){for(var a=or(e),r=-1,o=t.length;++r<o;)a.add(t[r])}function Po(e,t){for(var a=or(e),r=-1,o=t.length;++r<o;)a.remove(t[r])}function Ws(e){return function(){_o(this,e)}}function Ys(e){return function(){Po(this,e)}}function Xs(e,t){return function(){(t.apply(this,arguments)?_o:Po)(this,e)}}function js(e,t){var a=Eo(e+"");if(arguments.length<2){for(var r=or(this.node()),o=-1,i=a.length;++o<i;)if(!r.contains(a[o]))return!1;return!0}return this.each((typeof t=="function"?Xs:t?Ws:Ys)(a,t))}function Ks(){this.textContent=""}function Gs(e){return function(){this.textContent=e}}function Qs(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function Zs(e){return arguments.length?this.each(e==null?Ks:(typeof e=="function"?Qs:Gs)(e)):this.node().textContent}function Js(){this.innerHTML=""}function el(e){return function(){this.innerHTML=e}}function tl(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function nl(e){return arguments.length?this.each(e==null?Js:(typeof e=="function"?tl:el)(e)):this.node().innerHTML}function al(){this.nextSibling&&this.parentNode.appendChild(this)}function rl(){return this.each(al)}function ol(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function il(){return this.each(ol)}function sl(e){var t=typeof e=="function"?e:Mo(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function ll(){return null}function cl(e,t){var a=typeof e=="function"?e:Mo(e),r=t==null?ll:typeof t=="function"?t:rr(t);return this.select(function(){return this.insertBefore(a.apply(this,arguments),r.apply(this,arguments)||null)})}function dl(){var e=this.parentNode;e&&e.removeChild(this)}function ul(){return this.each(dl)}function hl(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function fl(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function pl(e){return this.select(e?fl:hl)}function ml(e){return arguments.length?this.property("__data__",e):this.node().__data__}function gl(e){return function(t){e.call(this,t,this.__data__)}}function yl(e){return e.trim().split(/^|\s+/).map(function(t){var a="",r=t.indexOf(".");return r>=0&&(a=t.slice(r+1),t=t.slice(0,r)),{type:t,name:a}})}function vl(e){return function(){var t=this.__on;if(t){for(var a=0,r=-1,o=t.length,i;a<o;++a)i=t[a],(!e.type||i.type===e.type)&&i.name===e.name?this.removeEventListener(i.type,i.listener,i.options):t[++r]=i;++r?t.length=r:delete this.__on}}}function bl(e,t,a){return function(){var r=this.__on,o,i=gl(t);if(r){for(var s=0,l=r.length;s<l;++s)if((o=r[s]).type===e.type&&o.name===e.name){this.removeEventListener(o.type,o.listener,o.options),this.addEventListener(o.type,o.listener=i,o.options=a),o.value=t;return}}this.addEventListener(e.type,i,a),o={type:e.type,name:e.name,value:t,listener:i,options:a},r?r.push(o):this.__on=[o]}}function xl(e,t,a){var r=yl(e+""),o,i=r.length,s;if(arguments.length<2){var l=this.node().__on;if(l){for(var c=0,d=l.length,u;c<d;++c)for(o=0,u=l[c];o<i;++o)if((s=r[o]).type===u.type&&s.name===u.name)return u.value}return}for(l=t?bl:vl,o=0;o<i;++o)this.each(l(r[o],t,a));return this}function Io(e,t,a){var r=Lo(e),o=r.CustomEvent;typeof o=="function"?o=new o(t,a):(o=r.document.createEvent("Event"),a?(o.initEvent(t,a.bubbles,a.cancelable),o.detail=a.detail):o.initEvent(t,!1,!1)),e.dispatchEvent(o)}function wl(e,t){return function(){return Io(this,e,t)}}function Sl(e,t){return function(){return Io(this,e,t.apply(this,arguments))}}function Ml(e,t){return this.each((typeof t=="function"?Sl:wl)(e,t))}function*$l(){for(var e=this._groups,t=0,a=e.length;t<a;++t)for(var r=e[t],o=0,i=r.length,s;o<i;++o)(s=r[o])&&(yield s)}var Ao=[null];function Ne(e,t){this._groups=e,this._parents=t}function xn(){return new Ne([[document.documentElement]],Ao)}function kl(){return this}Ne.prototype=xn.prototype={constructor:Ne,select:Qi,selectAll:ts,selectChild:os,selectChildren:cs,filter:ds,data:gs,enter:us,exit:vs,join:bs,merge:xs,selection:kl,order:ws,sort:Ss,call:$s,nodes:ks,node:Ds,size:Ts,empty:Ls,each:Es,attr:Ns,style:Us,property:Hs,classed:js,text:Zs,html:nl,raise:rl,lower:il,append:sl,insert:cl,remove:ul,clone:pl,datum:ml,on:xl,dispatch:Ml,[Symbol.iterator]:$l};function tt(e){return typeof e=="string"?new Ne([[document.querySelector(e)]],[document.documentElement]):new Ne([[e]],Ao)}function Dl(e){let t;for(;t=e.sourceEvent;)e=t;return e}function ut(e,t){if(e=Dl(e),t===void 0&&(t=e.currentTarget),t){var a=t.ownerSVGElement||t;if(a.createSVGPoint){var r=a.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,r=r.matrixTransform(t.getScreenCTM().inverse()),[r.x,r.y]}if(t.getBoundingClientRect){var o=t.getBoundingClientRect();return[e.clientX-o.left-t.clientLeft,e.clientY-o.top-t.clientTop]}}return[e.pageX,e.pageY]}const Fa={capture:!0,passive:!1};function Ba(e){e.preventDefault(),e.stopImmediatePropagation()}function Tl(e){var t=e.document.documentElement,a=tt(e).on("dragstart.drag",Ba,Fa);"onselectstart"in t?a.on("selectstart.drag",Ba,Fa):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function Ll(e,t){var a=e.document.documentElement,r=tt(e).on("dragstart.drag",null);t&&(r.on("click.drag",Ba,Fa),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in a?r.on("selectstart.drag",null):(a.style.MozUserSelect=a.__noselect,delete a.__noselect)}function ir(e,t,a){e.prototype=t.prototype=a,a.constructor=e}function Ro(e,t){var a=Object.create(e.prototype);for(var r in t)a[r]=t[r];return a}function wn(){}var un=.7,Kn=1/un,Ot="\\s*([+-]?\\d+)\\s*",hn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Ye="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",El=/^#([0-9a-f]{3,8})$/,Cl=new RegExp(`^rgb\\(${Ot},${Ot},${Ot}\\)$`),_l=new RegExp(`^rgb\\(${Ye},${Ye},${Ye}\\)$`),Pl=new RegExp(`^rgba\\(${Ot},${Ot},${Ot},${hn}\\)$`),Il=new RegExp(`^rgba\\(${Ye},${Ye},${Ye},${hn}\\)$`),Al=new RegExp(`^hsl\\(${hn},${Ye},${Ye}\\)$`),Rl=new RegExp(`^hsla\\(${hn},${Ye},${Ye},${hn}\\)$`),kr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};ir(wn,Lt,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Dr,formatHex:Dr,formatHex8:Nl,formatHsl:Fl,formatRgb:Tr,toString:Tr});function Dr(){return this.rgb().formatHex()}function Nl(){return this.rgb().formatHex8()}function Fl(){return No(this).formatHsl()}function Tr(){return this.rgb().formatRgb()}function Lt(e){var t,a;return e=(e+"").trim().toLowerCase(),(t=El.exec(e))?(a=t[1].length,t=parseInt(t[1],16),a===6?Lr(t):a===3?new Ie(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):a===8?Dn(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):a===4?Dn(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Cl.exec(e))?new Ie(t[1],t[2],t[3],1):(t=_l.exec(e))?new Ie(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Pl.exec(e))?Dn(t[1],t[2],t[3],t[4]):(t=Il.exec(e))?Dn(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Al.exec(e))?_r(t[1],t[2]/100,t[3]/100,1):(t=Rl.exec(e))?_r(t[1],t[2]/100,t[3]/100,t[4]):kr.hasOwnProperty(e)?Lr(kr[e]):e==="transparent"?new Ie(NaN,NaN,NaN,0):null}function Lr(e){return new Ie(e>>16&255,e>>8&255,e&255,1)}function Dn(e,t,a,r){return r<=0&&(e=t=a=NaN),new Ie(e,t,a,r)}function Bl(e){return e instanceof wn||(e=Lt(e)),e?(e=e.rgb(),new Ie(e.r,e.g,e.b,e.opacity)):new Ie}function Va(e,t,a,r){return arguments.length===1?Bl(e):new Ie(e,t,a,r??1)}function Ie(e,t,a,r){this.r=+e,this.g=+t,this.b=+a,this.opacity=+r}ir(Ie,Va,Ro(wn,{brighter(e){return e=e==null?Kn:Math.pow(Kn,e),new Ie(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?un:Math.pow(un,e),new Ie(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Ie(Tt(this.r),Tt(this.g),Tt(this.b),Gn(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Er,formatHex:Er,formatHex8:Vl,formatRgb:Cr,toString:Cr}));function Er(){return`#${$t(this.r)}${$t(this.g)}${$t(this.b)}`}function Vl(){return`#${$t(this.r)}${$t(this.g)}${$t(this.b)}${$t((isNaN(this.opacity)?1:this.opacity)*255)}`}function Cr(){const e=Gn(this.opacity);return`${e===1?"rgb(":"rgba("}${Tt(this.r)}, ${Tt(this.g)}, ${Tt(this.b)}${e===1?")":`, ${e})`}`}function Gn(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Tt(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function $t(e){return e=Tt(e),(e<16?"0":"")+e.toString(16)}function _r(e,t,a,r){return r<=0?e=t=a=NaN:a<=0||a>=1?e=t=NaN:t<=0&&(e=NaN),new qe(e,t,a,r)}function No(e){if(e instanceof qe)return new qe(e.h,e.s,e.l,e.opacity);if(e instanceof wn||(e=Lt(e)),!e)return new qe;if(e instanceof qe)return e;e=e.rgb();var t=e.r/255,a=e.g/255,r=e.b/255,o=Math.min(t,a,r),i=Math.max(t,a,r),s=NaN,l=i-o,c=(i+o)/2;return l?(t===i?s=(a-r)/l+(a<r)*6:a===i?s=(r-t)/l+2:s=(t-a)/l+4,l/=c<.5?i+o:2-i-o,s*=60):l=c>0&&c<1?0:s,new qe(s,l,c,e.opacity)}function Ul(e,t,a,r){return arguments.length===1?No(e):new qe(e,t,a,r??1)}function qe(e,t,a,r){this.h=+e,this.s=+t,this.l=+a,this.opacity=+r}ir(qe,Ul,Ro(wn,{brighter(e){return e=e==null?Kn:Math.pow(Kn,e),new qe(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?un:Math.pow(un,e),new qe(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,a=this.l,r=a+(a<.5?a:1-a)*t,o=2*a-r;return new Ie(Sa(e>=240?e-240:e+120,o,r),Sa(e,o,r),Sa(e<120?e+240:e-120,o,r),this.opacity)},clamp(){return new qe(Pr(this.h),Tn(this.s),Tn(this.l),Gn(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Gn(this.opacity);return`${e===1?"hsl(":"hsla("}${Pr(this.h)}, ${Tn(this.s)*100}%, ${Tn(this.l)*100}%${e===1?")":`, ${e})`}`}}));function Pr(e){return e=(e||0)%360,e<0?e+360:e}function Tn(e){return Math.max(0,Math.min(1,e||0))}function Sa(e,t,a){return(e<60?t+(a-t)*e/60:e<180?a:e<240?t+(a-t)*(240-e)/60:t)*255}const sr=e=>()=>e;function Ol(e,t){return function(a){return e+a*t}}function ql(e,t,a){return e=Math.pow(e,a),t=Math.pow(t,a)-e,a=1/a,function(r){return Math.pow(e+r*t,a)}}function zl(e){return(e=+e)==1?Fo:function(t,a){return a-t?ql(t,a,e):sr(isNaN(t)?a:t)}}function Fo(e,t){var a=t-e;return a?Ol(e,a):sr(isNaN(e)?t:e)}const Qn=(function e(t){var a=zl(t);function r(o,i){var s=a((o=Va(o)).r,(i=Va(i)).r),l=a(o.g,i.g),c=a(o.b,i.b),d=Fo(o.opacity,i.opacity);return function(u){return o.r=s(u),o.g=l(u),o.b=c(u),o.opacity=d(u),o+""}}return r.gamma=e,r})(1);function Hl(e,t){t||(t=[]);var a=e?Math.min(t.length,e.length):0,r=t.slice(),o;return function(i){for(o=0;o<a;++o)r[o]=e[o]*(1-i)+t[o]*i;return r}}function Wl(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Yl(e,t){var a=t?t.length:0,r=e?Math.min(a,e.length):0,o=new Array(r),i=new Array(a),s;for(s=0;s<r;++s)o[s]=lr(e[s],t[s]);for(;s<a;++s)i[s]=t[s];return function(l){for(s=0;s<r;++s)i[s]=o[s](l);return i}}function Xl(e,t){var a=new Date;return e=+e,t=+t,function(r){return a.setTime(e*(1-r)+t*r),a}}function Oe(e,t){return e=+e,t=+t,function(a){return e*(1-a)+t*a}}function jl(e,t){var a={},r={},o;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(o in t)o in e?a[o]=lr(e[o],t[o]):r[o]=t[o];return function(i){for(o in a)r[o]=a[o](i);return r}}var Ua=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Ma=new RegExp(Ua.source,"g");function Kl(e){return function(){return e}}function Gl(e){return function(t){return e(t)+""}}function Bo(e,t){var a=Ua.lastIndex=Ma.lastIndex=0,r,o,i,s=-1,l=[],c=[];for(e=e+"",t=t+"";(r=Ua.exec(e))&&(o=Ma.exec(t));)(i=o.index)>a&&(i=t.slice(a,i),l[s]?l[s]+=i:l[++s]=i),(r=r[0])===(o=o[0])?l[s]?l[s]+=o:l[++s]=o:(l[++s]=null,c.push({i:s,x:Oe(r,o)})),a=Ma.lastIndex;return a<t.length&&(i=t.slice(a),l[s]?l[s]+=i:l[++s]=i),l.length<2?c[0]?Gl(c[0].x):Kl(t):(t=c.length,function(d){for(var u=0,h;u<t;++u)l[(h=c[u]).i]=h.x(d);return l.join("")})}function lr(e,t){var a=typeof t,r;return t==null||a==="boolean"?sr(t):(a==="number"?Oe:a==="string"?(r=Lt(t))?(t=r,Qn):Bo:t instanceof Lt?Qn:t instanceof Date?Xl:Wl(t)?Hl:Array.isArray(t)?Yl:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?jl:Oe)(e,t)}function Ql(e,t){return e=+e,t=+t,function(a){return Math.round(e*(1-a)+t*a)}}var Ir=180/Math.PI,Oa={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Vo(e,t,a,r,o,i){var s,l,c;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(c=e*a+t*r)&&(a-=e*c,r-=t*c),(l=Math.sqrt(a*a+r*r))&&(a/=l,r/=l,c/=l),e*r<t*a&&(e=-e,t=-t,c=-c,s=-s),{translateX:o,translateY:i,rotate:Math.atan2(t,e)*Ir,skewX:Math.atan(c)*Ir,scaleX:s,scaleY:l}}var Ln;function Zl(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Oa:Vo(t.a,t.b,t.c,t.d,t.e,t.f)}function Jl(e){return e==null||(Ln||(Ln=document.createElementNS("http://www.w3.org/2000/svg","g")),Ln.setAttribute("transform",e),!(e=Ln.transform.baseVal.consolidate()))?Oa:(e=e.matrix,Vo(e.a,e.b,e.c,e.d,e.e,e.f))}function Uo(e,t,a,r){function o(d){return d.length?d.pop()+" ":""}function i(d,u,h,f,p,x){if(d!==h||u!==f){var k=p.push("translate(",null,t,null,a);x.push({i:k-4,x:Oe(d,h)},{i:k-2,x:Oe(u,f)})}else(h||f)&&p.push("translate("+h+t+f+a)}function s(d,u,h,f){d!==u?(d-u>180?u+=360:u-d>180&&(d+=360),f.push({i:h.push(o(h)+"rotate(",null,r)-2,x:Oe(d,u)})):u&&h.push(o(h)+"rotate("+u+r)}function l(d,u,h,f){d!==u?f.push({i:h.push(o(h)+"skewX(",null,r)-2,x:Oe(d,u)}):u&&h.push(o(h)+"skewX("+u+r)}function c(d,u,h,f,p,x){if(d!==h||u!==f){var k=p.push(o(p)+"scale(",null,",",null,")");x.push({i:k-4,x:Oe(d,h)},{i:k-2,x:Oe(u,f)})}else(h!==1||f!==1)&&p.push(o(p)+"scale("+h+","+f+")")}return function(d,u){var h=[],f=[];return d=e(d),u=e(u),i(d.translateX,d.translateY,u.translateX,u.translateY,h,f),s(d.rotate,u.rotate,h,f),l(d.skewX,u.skewX,h,f),c(d.scaleX,d.scaleY,u.scaleX,u.scaleY,h,f),d=u=null,function(p){for(var x=-1,k=f.length,$;++x<k;)h[($=f[x]).i]=$.x(p);return h.join("")}}}var ec=Uo(Zl,"px, ","px)","deg)"),tc=Uo(Jl,", ",")",")"),nc=1e-12;function Ar(e){return((e=Math.exp(e))+1/e)/2}function ac(e){return((e=Math.exp(e))-1/e)/2}function rc(e){return((e=Math.exp(2*e))-1)/(e+1)}const oc=(function e(t,a,r){function o(i,s){var l=i[0],c=i[1],d=i[2],u=s[0],h=s[1],f=s[2],p=u-l,x=h-c,k=p*p+x*x,$,w;if(k<nc)w=Math.log(f/d)/t,$=function(P){return[l+P*p,c+P*x,d*Math.exp(t*P*w)]};else{var b=Math.sqrt(k),L=(f*f-d*d+r*k)/(2*d*a*b),E=(f*f-d*d-r*k)/(2*f*a*b),T=Math.log(Math.sqrt(L*L+1)-L),S=Math.log(Math.sqrt(E*E+1)-E);w=(S-T)/t,$=function(P){var q=P*w,Y=Ar(T),W=d/(a*b)*(Y*rc(t*q+T)-ac(T));return[l+W*p,c+W*x,d*Y/Ar(t*q+T)]}}return $.duration=w*1e3*t/Math.SQRT2,$}return o.rho=function(i){var s=Math.max(.001,+i),l=s*s,c=l*l;return e(s,l,c)},o})(Math.SQRT2,2,4);var Wt=0,rn=0,Qt=0,Oo=1e3,Zn,on,Jn=0,Et=0,ua=0,fn=typeof performance=="object"&&performance.now?performance:Date,qo=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function cr(){return Et||(qo(ic),Et=fn.now()+ua)}function ic(){Et=0}function ea(){this._call=this._time=this._next=null}ea.prototype=zo.prototype={constructor:ea,restart:function(e,t,a){if(typeof e!="function")throw new TypeError("callback is not a function");a=(a==null?cr():+a)+(t==null?0:+t),!this._next&&on!==this&&(on?on._next=this:Zn=this,on=this),this._call=e,this._time=a,qa()},stop:function(){this._call&&(this._call=null,this._time=1/0,qa())}};function zo(e,t,a){var r=new ea;return r.restart(e,t,a),r}function sc(){cr(),++Wt;for(var e=Zn,t;e;)(t=Et-e._time)>=0&&e._call.call(void 0,t),e=e._next;--Wt}function Rr(){Et=(Jn=fn.now())+ua,Wt=rn=0;try{sc()}finally{Wt=0,cc(),Et=0}}function lc(){var e=fn.now(),t=e-Jn;t>Oo&&(ua-=t,Jn=e)}function cc(){for(var e,t=Zn,a,r=1/0;t;)t._call?(r>t._time&&(r=t._time),e=t,t=t._next):(a=t._next,t._next=null,t=e?e._next=a:Zn=a);on=e,qa(r)}function qa(e){if(!Wt){rn&&(rn=clearTimeout(rn));var t=e-Et;t>24?(e<1/0&&(rn=setTimeout(Rr,e-fn.now()-ua)),Qt&&(Qt=clearInterval(Qt))):(Qt||(Jn=fn.now(),Qt=setInterval(lc,Oo)),Wt=1,qo(Rr))}}function Nr(e,t,a){var r=new ea;return t=t==null?0:+t,r.restart(o=>{r.stop(),e(o+t)},t,a),r}var dc=ar("start","end","cancel","interrupt"),uc=[],Ho=0,Fr=1,za=2,Nn=3,Br=4,Ha=5,Fn=6;function ha(e,t,a,r,o,i){var s=e.__transition;if(!s)e.__transition={};else if(a in s)return;hc(e,a,{name:t,index:r,group:o,on:dc,tween:uc,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:Ho})}function dr(e,t){var a=He(e,t);if(a.state>Ho)throw new Error("too late; already scheduled");return a}function Xe(e,t){var a=He(e,t);if(a.state>Nn)throw new Error("too late; already running");return a}function He(e,t){var a=e.__transition;if(!a||!(a=a[t]))throw new Error("transition not found");return a}function hc(e,t,a){var r=e.__transition,o;r[t]=a,a.timer=zo(i,0,a.time);function i(d){a.state=Fr,a.timer.restart(s,a.delay,a.time),a.delay<=d&&s(d-a.delay)}function s(d){var u,h,f,p;if(a.state!==Fr)return c();for(u in r)if(p=r[u],p.name===a.name){if(p.state===Nn)return Nr(s);p.state===Br?(p.state=Fn,p.timer.stop(),p.on.call("interrupt",e,e.__data__,p.index,p.group),delete r[u]):+u<t&&(p.state=Fn,p.timer.stop(),p.on.call("cancel",e,e.__data__,p.index,p.group),delete r[u])}if(Nr(function(){a.state===Nn&&(a.state=Br,a.timer.restart(l,a.delay,a.time),l(d))}),a.state=za,a.on.call("start",e,e.__data__,a.index,a.group),a.state===za){for(a.state=Nn,o=new Array(f=a.tween.length),u=0,h=-1;u<f;++u)(p=a.tween[u].value.call(e,e.__data__,a.index,a.group))&&(o[++h]=p);o.length=h+1}}function l(d){for(var u=d<a.duration?a.ease.call(null,d/a.duration):(a.timer.restart(c),a.state=Ha,1),h=-1,f=o.length;++h<f;)o[h].call(e,u);a.state===Ha&&(a.on.call("end",e,e.__data__,a.index,a.group),c())}function c(){a.state=Fn,a.timer.stop(),delete r[t];for(var d in r)return;delete e.__transition}}function Bn(e,t){var a=e.__transition,r,o,i=!0,s;if(a){t=t==null?null:t+"";for(s in a){if((r=a[s]).name!==t){i=!1;continue}o=r.state>za&&r.state<Ha,r.state=Fn,r.timer.stop(),r.on.call(o?"interrupt":"cancel",e,e.__data__,r.index,r.group),delete a[s]}i&&delete e.__transition}}function fc(e){return this.each(function(){Bn(this,e)})}function pc(e,t){var a,r;return function(){var o=Xe(this,e),i=o.tween;if(i!==a){r=a=i;for(var s=0,l=r.length;s<l;++s)if(r[s].name===t){r=r.slice(),r.splice(s,1);break}}o.tween=r}}function mc(e,t,a){var r,o;if(typeof a!="function")throw new Error;return function(){var i=Xe(this,e),s=i.tween;if(s!==r){o=(r=s).slice();for(var l={name:t,value:a},c=0,d=o.length;c<d;++c)if(o[c].name===t){o[c]=l;break}c===d&&o.push(l)}i.tween=o}}function gc(e,t){var a=this._id;if(e+="",arguments.length<2){for(var r=He(this.node(),a).tween,o=0,i=r.length,s;o<i;++o)if((s=r[o]).name===e)return s.value;return null}return this.each((t==null?pc:mc)(a,e,t))}function ur(e,t,a){var r=e._id;return e.each(function(){var o=Xe(this,r);(o.value||(o.value={}))[t]=a.apply(this,arguments)}),function(o){return He(o,r).value[t]}}function Wo(e,t){var a;return(typeof t=="number"?Oe:t instanceof Lt?Qn:(a=Lt(t))?(t=a,Qn):Bo)(e,t)}function yc(e){return function(){this.removeAttribute(e)}}function vc(e){return function(){this.removeAttributeNS(e.space,e.local)}}function bc(e,t,a){var r,o=a+"",i;return function(){var s=this.getAttribute(e);return s===o?null:s===r?i:i=t(r=s,a)}}function xc(e,t,a){var r,o=a+"",i;return function(){var s=this.getAttributeNS(e.space,e.local);return s===o?null:s===r?i:i=t(r=s,a)}}function wc(e,t,a){var r,o,i;return function(){var s,l=a(this),c;return l==null?void this.removeAttribute(e):(s=this.getAttribute(e),c=l+"",s===c?null:s===r&&c===o?i:(o=c,i=t(r=s,l)))}}function Sc(e,t,a){var r,o,i;return function(){var s,l=a(this),c;return l==null?void this.removeAttributeNS(e.space,e.local):(s=this.getAttributeNS(e.space,e.local),c=l+"",s===c?null:s===r&&c===o?i:(o=c,i=t(r=s,l)))}}function Mc(e,t){var a=da(e),r=a==="transform"?tc:Wo;return this.attrTween(e,typeof t=="function"?(a.local?Sc:wc)(a,r,ur(this,"attr."+e,t)):t==null?(a.local?vc:yc)(a):(a.local?xc:bc)(a,r,t))}function $c(e,t){return function(a){this.setAttribute(e,t.call(this,a))}}function kc(e,t){return function(a){this.setAttributeNS(e.space,e.local,t.call(this,a))}}function Dc(e,t){var a,r;function o(){var i=t.apply(this,arguments);return i!==r&&(a=(r=i)&&kc(e,i)),a}return o._value=t,o}function Tc(e,t){var a,r;function o(){var i=t.apply(this,arguments);return i!==r&&(a=(r=i)&&$c(e,i)),a}return o._value=t,o}function Lc(e,t){var a="attr."+e;if(arguments.length<2)return(a=this.tween(a))&&a._value;if(t==null)return this.tween(a,null);if(typeof t!="function")throw new Error;var r=da(e);return this.tween(a,(r.local?Dc:Tc)(r,t))}function Ec(e,t){return function(){dr(this,e).delay=+t.apply(this,arguments)}}function Cc(e,t){return t=+t,function(){dr(this,e).delay=t}}function _c(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Ec:Cc)(t,e)):He(this.node(),t).delay}function Pc(e,t){return function(){Xe(this,e).duration=+t.apply(this,arguments)}}function Ic(e,t){return t=+t,function(){Xe(this,e).duration=t}}function Ac(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Pc:Ic)(t,e)):He(this.node(),t).duration}function Rc(e,t){if(typeof t!="function")throw new Error;return function(){Xe(this,e).ease=t}}function Nc(e){var t=this._id;return arguments.length?this.each(Rc(t,e)):He(this.node(),t).ease}function Fc(e,t){return function(){var a=t.apply(this,arguments);if(typeof a!="function")throw new Error;Xe(this,e).ease=a}}function Bc(e){if(typeof e!="function")throw new Error;return this.each(Fc(this._id,e))}function Vc(e){typeof e!="function"&&(e=ko(e));for(var t=this._groups,a=t.length,r=new Array(a),o=0;o<a;++o)for(var i=t[o],s=i.length,l=r[o]=[],c,d=0;d<s;++d)(c=i[d])&&e.call(c,c.__data__,d,i)&&l.push(c);return new st(r,this._parents,this._name,this._id)}function Uc(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,a=e._groups,r=t.length,o=a.length,i=Math.min(r,o),s=new Array(r),l=0;l<i;++l)for(var c=t[l],d=a[l],u=c.length,h=s[l]=new Array(u),f,p=0;p<u;++p)(f=c[p]||d[p])&&(h[p]=f);for(;l<r;++l)s[l]=t[l];return new st(s,this._parents,this._name,this._id)}function Oc(e){return(e+"").trim().split(/^|\s+/).every(function(t){var a=t.indexOf(".");return a>=0&&(t=t.slice(0,a)),!t||t==="start"})}function qc(e,t,a){var r,o,i=Oc(t)?dr:Xe;return function(){var s=i(this,e),l=s.on;l!==r&&(o=(r=l).copy()).on(t,a),s.on=o}}function zc(e,t){var a=this._id;return arguments.length<2?He(this.node(),a).on.on(e):this.each(qc(a,e,t))}function Hc(e){return function(){var t=this.parentNode;for(var a in this.__transition)if(+a!==e)return;t&&t.removeChild(this)}}function Wc(){return this.on("end.remove",Hc(this._id))}function Yc(e){var t=this._name,a=this._id;typeof e!="function"&&(e=rr(e));for(var r=this._groups,o=r.length,i=new Array(o),s=0;s<o;++s)for(var l=r[s],c=l.length,d=i[s]=new Array(c),u,h,f=0;f<c;++f)(u=l[f])&&(h=e.call(u,u.__data__,f,l))&&("__data__"in u&&(h.__data__=u.__data__),d[f]=h,ha(d[f],t,a,f,d,He(u,a)));return new st(i,this._parents,t,a)}function Xc(e){var t=this._name,a=this._id;typeof e!="function"&&(e=$o(e));for(var r=this._groups,o=r.length,i=[],s=[],l=0;l<o;++l)for(var c=r[l],d=c.length,u,h=0;h<d;++h)if(u=c[h]){for(var f=e.call(u,u.__data__,h,c),p,x=He(u,a),k=0,$=f.length;k<$;++k)(p=f[k])&&ha(p,t,a,k,f,x);i.push(f),s.push(u)}return new st(i,s,t,a)}var jc=xn.prototype.constructor;function Kc(){return new jc(this._groups,this._parents)}function Gc(e,t){var a,r,o;return function(){var i=Ht(this,e),s=(this.style.removeProperty(e),Ht(this,e));return i===s?null:i===a&&s===r?o:o=t(a=i,r=s)}}function Yo(e){return function(){this.style.removeProperty(e)}}function Qc(e,t,a){var r,o=a+"",i;return function(){var s=Ht(this,e);return s===o?null:s===r?i:i=t(r=s,a)}}function Zc(e,t,a){var r,o,i;return function(){var s=Ht(this,e),l=a(this),c=l+"";return l==null&&(c=l=(this.style.removeProperty(e),Ht(this,e))),s===c?null:s===r&&c===o?i:(o=c,i=t(r=s,l))}}function Jc(e,t){var a,r,o,i="style."+t,s="end."+i,l;return function(){var c=Xe(this,e),d=c.on,u=c.value[i]==null?l||(l=Yo(t)):void 0;(d!==a||o!==u)&&(r=(a=d).copy()).on(s,o=u),c.on=r}}function ed(e,t,a){var r=(e+="")=="transform"?ec:Wo;return t==null?this.styleTween(e,Gc(e,r)).on("end.style."+e,Yo(e)):typeof t=="function"?this.styleTween(e,Zc(e,r,ur(this,"style."+e,t))).each(Jc(this._id,e)):this.styleTween(e,Qc(e,r,t),a).on("end.style."+e,null)}function td(e,t,a){return function(r){this.style.setProperty(e,t.call(this,r),a)}}function nd(e,t,a){var r,o;function i(){var s=t.apply(this,arguments);return s!==o&&(r=(o=s)&&td(e,s,a)),r}return i._value=t,i}function ad(e,t,a){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(t==null)return this.tween(r,null);if(typeof t!="function")throw new Error;return this.tween(r,nd(e,t,a??""))}function rd(e){return function(){this.textContent=e}}function od(e){return function(){var t=e(this);this.textContent=t??""}}function id(e){return this.tween("text",typeof e=="function"?od(ur(this,"text",e)):rd(e==null?"":e+""))}function sd(e){return function(t){this.textContent=e.call(this,t)}}function ld(e){var t,a;function r(){var o=e.apply(this,arguments);return o!==a&&(t=(a=o)&&sd(o)),t}return r._value=e,r}function cd(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,ld(e))}function dd(){for(var e=this._name,t=this._id,a=Xo(),r=this._groups,o=r.length,i=0;i<o;++i)for(var s=r[i],l=s.length,c,d=0;d<l;++d)if(c=s[d]){var u=He(c,t);ha(c,e,a,d,s,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new st(r,this._parents,e,a)}function ud(){var e,t,a=this,r=a._id,o=a.size();return new Promise(function(i,s){var l={value:s},c={value:function(){--o===0&&i()}};a.each(function(){var d=Xe(this,r),u=d.on;u!==e&&(t=(e=u).copy(),t._.cancel.push(l),t._.interrupt.push(l),t._.end.push(c)),d.on=t}),o===0&&i()})}var hd=0;function st(e,t,a,r){this._groups=e,this._parents=t,this._name=a,this._id=r}function Xo(){return++hd}var Ge=xn.prototype;st.prototype={constructor:st,select:Yc,selectAll:Xc,selectChild:Ge.selectChild,selectChildren:Ge.selectChildren,filter:Vc,merge:Uc,selection:Kc,transition:dd,call:Ge.call,nodes:Ge.nodes,node:Ge.node,size:Ge.size,empty:Ge.empty,each:Ge.each,on:zc,attr:Mc,attrTween:Lc,style:ed,styleTween:ad,text:id,textTween:cd,remove:Wc,tween:gc,delay:_c,duration:Ac,ease:Nc,easeVarying:Bc,end:ud,[Symbol.iterator]:Ge[Symbol.iterator]};function fd(e){return--e*e*e+1}function pd(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var md={time:null,delay:0,duration:250,ease:pd};function gd(e,t){for(var a;!(a=e.__transition)||!(a=a[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return a}function yd(e){var t,a;e instanceof st?(t=e._id,e=e._name):(t=Xo(),(a=md).time=cr(),e=e==null?null:e+"");for(var r=this._groups,o=r.length,i=0;i<o;++i)for(var s=r[i],l=s.length,c,d=0;d<l;++d)(c=s[d])&&ha(c,e,t,d,s,a||gd(c,t));return new st(r,this._parents,e,t)}xn.prototype.interrupt=fc;xn.prototype.transition=yd;function vd(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function ta(e,t){if((a=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var a,r=e.slice(0,a);return[r.length>1?r[0]+r.slice(2):r,+e.slice(a+1)]}function Yt(e){return e=ta(Math.abs(e)),e?e[1]:NaN}function bd(e,t){return function(a,r){for(var o=a.length,i=[],s=0,l=e[0],c=0;o>0&&l>0&&(c+l+1>r&&(l=Math.max(1,r-c)),i.push(a.substring(o-=l,o+l)),!((c+=l+1)>r));)l=e[s=(s+1)%e.length];return i.reverse().join(t)}}function xd(e){return function(t){return t.replace(/[0-9]/g,function(a){return e[+a]})}}var wd=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function na(e){if(!(t=wd.exec(e)))throw new Error("invalid format: "+e);var t;return new hr({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}na.prototype=hr.prototype;function hr(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}hr.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Sd(e){e:for(var t=e.length,a=1,r=-1,o;a<t;++a)switch(e[a]){case".":r=o=a;break;case"0":r===0&&(r=a),o=a;break;default:if(!+e[a])break e;r>0&&(r=0);break}return r>0?e.slice(0,r)+e.slice(o+1):e}var jo;function Md(e,t){var a=ta(e,t);if(!a)return e+"";var r=a[0],o=a[1],i=o-(jo=Math.max(-8,Math.min(8,Math.floor(o/3)))*3)+1,s=r.length;return i===s?r:i>s?r+new Array(i-s+1).join("0"):i>0?r.slice(0,i)+"."+r.slice(i):"0."+new Array(1-i).join("0")+ta(e,Math.max(0,t+i-1))[0]}function Vr(e,t){var a=ta(e,t);if(!a)return e+"";var r=a[0],o=a[1];return o<0?"0."+new Array(-o).join("0")+r:r.length>o+1?r.slice(0,o+1)+"."+r.slice(o+1):r+new Array(o-r.length+2).join("0")}const Ur={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:vd,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>Vr(e*100,t),r:Vr,s:Md,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function Or(e){return e}var qr=Array.prototype.map,zr=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function $d(e){var t=e.grouping===void 0||e.thousands===void 0?Or:bd(qr.call(e.grouping,Number),e.thousands+""),a=e.currency===void 0?"":e.currency[0]+"",r=e.currency===void 0?"":e.currency[1]+"",o=e.decimal===void 0?".":e.decimal+"",i=e.numerals===void 0?Or:xd(qr.call(e.numerals,String)),s=e.percent===void 0?"%":e.percent+"",l=e.minus===void 0?"−":e.minus+"",c=e.nan===void 0?"NaN":e.nan+"";function d(h){h=na(h);var f=h.fill,p=h.align,x=h.sign,k=h.symbol,$=h.zero,w=h.width,b=h.comma,L=h.precision,E=h.trim,T=h.type;T==="n"?(b=!0,T="g"):Ur[T]||(L===void 0&&(L=12),E=!0,T="g"),($||f==="0"&&p==="=")&&($=!0,f="0",p="=");var S=k==="$"?a:k==="#"&&/[boxX]/.test(T)?"0"+T.toLowerCase():"",P=k==="$"?r:/[%p]/.test(T)?s:"",q=Ur[T],Y=/[defgprs%]/.test(T);L=L===void 0?6:/[gprs]/.test(T)?Math.max(1,Math.min(21,L)):Math.max(0,Math.min(20,L));function W(O){var j=S,U=P,y,F,C;if(T==="c")U=q(O)+U,O="";else{O=+O;var m=O<0||1/O<0;if(O=isNaN(O)?c:q(Math.abs(O),L),E&&(O=Sd(O)),m&&+O==0&&x!=="+"&&(m=!1),j=(m?x==="("?x:l:x==="-"||x==="("?"":x)+j,U=(T==="s"?zr[8+jo/3]:"")+U+(m&&x==="("?")":""),Y){for(y=-1,F=O.length;++y<F;)if(C=O.charCodeAt(y),48>C||C>57){U=(C===46?o+O.slice(y+1):O.slice(y))+U,O=O.slice(0,y);break}}}b&&!$&&(O=t(O,1/0));var v=j.length+O.length+U.length,D=v<w?new Array(w-v+1).join(f):"";switch(b&&$&&(O=t(D+O,D.length?w-U.length:1/0),D=""),p){case"<":O=j+O+U+D;break;case"=":O=j+D+O+U;break;case"^":O=D.slice(0,v=D.length>>1)+j+O+U+D.slice(v);break;default:O=D+j+O+U;break}return i(O)}return W.toString=function(){return h+""},W}function u(h,f){var p=d((h=na(h),h.type="f",h)),x=Math.max(-8,Math.min(8,Math.floor(Yt(f)/3)))*3,k=Math.pow(10,-x),$=zr[8+x/3];return function(w){return p(k*w)+$}}return{format:d,formatPrefix:u}}var En,Ko,Go;kd({thousands:",",grouping:[3],currency:["$",""]});function kd(e){return En=$d(e),Ko=En.format,Go=En.formatPrefix,En}function Dd(e){return Math.max(0,-Yt(Math.abs(e)))}function Td(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Yt(t)/3)))*3-Yt(Math.abs(e)))}function Ld(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,Yt(t)-Yt(e))+1}function Qo(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Ed(e){return function(){return e}}function Cd(e){return+e}var Hr=[0,1];function Ft(e){return e}function Wa(e,t){return(t-=e=+e)?function(a){return(a-e)/t}:Ed(isNaN(t)?NaN:.5)}function _d(e,t){var a;return e>t&&(a=e,e=t,t=a),function(r){return Math.max(e,Math.min(t,r))}}function Pd(e,t,a){var r=e[0],o=e[1],i=t[0],s=t[1];return o<r?(r=Wa(o,r),i=a(s,i)):(r=Wa(r,o),i=a(i,s)),function(l){return i(r(l))}}function Id(e,t,a){var r=Math.min(e.length,t.length)-1,o=new Array(r),i=new Array(r),s=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++s<r;)o[s]=Wa(e[s],e[s+1]),i[s]=a(t[s],t[s+1]);return function(l){var c=Fi(e,l,1,r)-1;return i[c](o[c](l))}}function Zo(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Ad(){var e=Hr,t=Hr,a=lr,r,o,i,s=Ft,l,c,d;function u(){var f=Math.min(e.length,t.length);return s!==Ft&&(s=_d(e[0],e[f-1])),l=f>2?Id:Pd,c=d=null,h}function h(f){return f==null||isNaN(f=+f)?i:(c||(c=l(e.map(r),t,a)))(r(s(f)))}return h.invert=function(f){return s(o((d||(d=l(t,e.map(r),Oe)))(f)))},h.domain=function(f){return arguments.length?(e=Array.from(f,Cd),u()):e.slice()},h.range=function(f){return arguments.length?(t=Array.from(f),u()):t.slice()},h.rangeRound=function(f){return t=Array.from(f),a=Ql,u()},h.clamp=function(f){return arguments.length?(s=f?!0:Ft,u()):s!==Ft},h.interpolate=function(f){return arguments.length?(a=f,u()):a},h.unknown=function(f){return arguments.length?(i=f,h):i},function(f,p){return r=f,o=p,u()}}function Jo(){return Ad()(Ft,Ft)}function Rd(e,t,a,r){var o=Ra(e,t,a),i;switch(r=na(r??",f"),r.type){case"s":{var s=Math.max(Math.abs(e),Math.abs(t));return r.precision==null&&!isNaN(i=Td(o,s))&&(r.precision=i),Go(r,s)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(i=Ld(o,Math.max(Math.abs(e),Math.abs(t))))&&(r.precision=i-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(i=Dd(o))&&(r.precision=i-(r.type==="%")*2);break}}return Ko(r)}function Nd(e){var t=e.domain;return e.ticks=function(a){var r=t();return Oi(r[0],r[r.length-1],a??10)},e.tickFormat=function(a,r){var o=t();return Rd(o[0],o[o.length-1],a??10,r)},e.nice=function(a){a==null&&(a=10);var r=t(),o=0,i=r.length-1,s=r[o],l=r[i],c,d,u=10;for(l<s&&(d=s,s=l,l=d,d=o,o=i,i=d);u-- >0;){if(d=Aa(s,l,a),d===c)return r[o]=s,r[i]=l,t(r);if(d>0)s=Math.floor(s/d)*d,l=Math.ceil(l/d)*d;else if(d<0)s=Math.ceil(s*d)/d,l=Math.floor(l*d)/d;else break;c=d}return e},e}function fa(){var e=Jo();return e.copy=function(){return Zo(e,fa())},Qo.apply(e,arguments),Nd(e)}function Fd(e,t){e=e.slice();var a=0,r=e.length-1,o=e[a],i=e[r],s;return i<o&&(s=a,a=r,r=s,s=o,o=i,i=s),e[a]=t.floor(o),e[r]=t.ceil(i),e}const $a=new Date,ka=new Date;function pe(e,t,a,r){function o(i){return e(i=arguments.length===0?new Date:new Date(+i)),i}return o.floor=i=>(e(i=new Date(+i)),i),o.ceil=i=>(e(i=new Date(i-1)),t(i,1),e(i),i),o.round=i=>{const s=o(i),l=o.ceil(i);return i-s<l-i?s:l},o.offset=(i,s)=>(t(i=new Date(+i),s==null?1:Math.floor(s)),i),o.range=(i,s,l)=>{const c=[];if(i=o.ceil(i),l=l==null?1:Math.floor(l),!(i<s)||!(l>0))return c;let d;do c.push(d=new Date(+i)),t(i,l),e(i);while(d<i&&i<s);return c},o.filter=i=>pe(s=>{if(s>=s)for(;e(s),!i(s);)s.setTime(s-1)},(s,l)=>{if(s>=s)if(l<0)for(;++l<=0;)for(;t(s,-1),!i(s););else for(;--l>=0;)for(;t(s,1),!i(s););}),a&&(o.count=(i,s)=>($a.setTime(+i),ka.setTime(+s),e($a),e(ka),Math.floor(a($a,ka))),o.every=i=>(i=Math.floor(i),!isFinite(i)||!(i>0)?null:i>1?o.filter(r?s=>r(s)%i===0:s=>o.count(0,s)%i===0):o)),o}const aa=pe(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);aa.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?pe(t=>{t.setTime(Math.floor(t/e)*e)},(t,a)=>{t.setTime(+t+a*e)},(t,a)=>(a-t)/e):aa);aa.range;const nt=1e3,Ve=nt*60,at=Ve*60,lt=at*24,fr=lt*7,Wr=lt*30,Da=lt*365,Bt=pe(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*nt)},(e,t)=>(t-e)/nt,e=>e.getUTCSeconds());Bt.range;const pr=pe(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*nt)},(e,t)=>{e.setTime(+e+t*Ve)},(e,t)=>(t-e)/Ve,e=>e.getMinutes());pr.range;const Bd=pe(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*Ve)},(e,t)=>(t-e)/Ve,e=>e.getUTCMinutes());Bd.range;const mr=pe(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*nt-e.getMinutes()*Ve)},(e,t)=>{e.setTime(+e+t*at)},(e,t)=>(t-e)/at,e=>e.getHours());mr.range;const Vd=pe(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*at)},(e,t)=>(t-e)/at,e=>e.getUTCHours());Vd.range;const Sn=pe(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Ve)/lt,e=>e.getDate()-1);Sn.range;const gr=pe(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/lt,e=>e.getUTCDate()-1);gr.range;const Ud=pe(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/lt,e=>Math.floor(e/lt));Ud.range;function Pt(e){return pe(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,a)=>{t.setDate(t.getDate()+a*7)},(t,a)=>(a-t-(a.getTimezoneOffset()-t.getTimezoneOffset())*Ve)/fr)}const pa=Pt(0),ra=Pt(1),Od=Pt(2),qd=Pt(3),Xt=Pt(4),zd=Pt(5),Hd=Pt(6);pa.range;ra.range;Od.range;qd.range;Xt.range;zd.range;Hd.range;function It(e){return pe(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,a)=>{t.setUTCDate(t.getUTCDate()+a*7)},(t,a)=>(a-t)/fr)}const ei=It(0),oa=It(1),Wd=It(2),Yd=It(3),jt=It(4),Xd=It(5),jd=It(6);ei.range;oa.range;Wd.range;Yd.range;jt.range;Xd.range;jd.range;const yr=pe(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());yr.range;const Kd=pe(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());Kd.range;const ct=pe(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());ct.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:pe(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,a)=>{t.setFullYear(t.getFullYear()+a*e)});ct.range;const Ct=pe(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());Ct.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:pe(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,a)=>{t.setUTCFullYear(t.getUTCFullYear()+a*e)});Ct.range;function Gd(e,t,a,r,o,i){const s=[[Bt,1,nt],[Bt,5,5*nt],[Bt,15,15*nt],[Bt,30,30*nt],[i,1,Ve],[i,5,5*Ve],[i,15,15*Ve],[i,30,30*Ve],[o,1,at],[o,3,3*at],[o,6,6*at],[o,12,12*at],[r,1,lt],[r,2,2*lt],[a,1,fr],[t,1,Wr],[t,3,3*Wr],[e,1,Da]];function l(d,u,h){const f=u<d;f&&([d,u]=[u,d]);const p=h&&typeof h.range=="function"?h:c(d,u,h),x=p?p.range(d,+u+1):[];return f?x.reverse():x}function c(d,u,h){const f=Math.abs(u-d)/h,p=nr(([,,$])=>$).right(s,f);if(p===s.length)return e.every(Ra(d/Da,u/Da,h));if(p===0)return aa.every(Math.max(Ra(d,u,h),1));const[x,k]=s[f/s[p-1][2]<s[p][2]/f?p-1:p];return x.every(k)}return[l,c]}const[Qd,Zd]=Gd(ct,yr,pa,Sn,mr,pr);function Ta(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function La(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Zt(e,t,a){return{y:e,m:t,d:a,H:0,M:0,S:0,L:0}}function Jd(e){var t=e.dateTime,a=e.date,r=e.time,o=e.periods,i=e.days,s=e.shortDays,l=e.months,c=e.shortMonths,d=Jt(o),u=en(o),h=Jt(i),f=en(i),p=Jt(s),x=en(s),k=Jt(l),$=en(l),w=Jt(c),b=en(c),L={a:m,A:v,b:D,B:A,c:null,d:Qr,e:Qr,f:Su,g:Pu,G:Au,H:bu,I:xu,j:wu,L:ti,m:Mu,M:$u,p:B,q:I,Q:eo,s:to,S:ku,u:Du,U:Tu,V:Lu,w:Eu,W:Cu,x:null,X:null,y:_u,Y:Iu,Z:Ru,"%":Jr},E={a:_,A:V,b:z,B:K,c:null,d:Zr,e:Zr,f:Vu,g:Ku,G:Qu,H:Nu,I:Fu,j:Bu,L:ai,m:Uu,M:Ou,p:Z,q:Q,Q:eo,s:to,S:qu,u:zu,U:Hu,V:Wu,w:Yu,W:Xu,x:null,X:null,y:ju,Y:Gu,Z:Zu,"%":Jr},T={a:W,A:O,b:j,B:U,c:y,d:Kr,e:Kr,f:mu,g:jr,G:Xr,H:Gr,I:Gr,j:uu,L:pu,m:du,M:hu,p:Y,q:cu,Q:yu,s:vu,S:fu,u:ru,U:ou,V:iu,w:au,W:su,x:F,X:C,y:jr,Y:Xr,Z:lu,"%":gu};L.x=S(a,L),L.X=S(r,L),L.c=S(t,L),E.x=S(a,E),E.X=S(r,E),E.c=S(t,E);function S(R,X){return function(G){var N=[],oe=-1,re=0,be=R.length,xe,je,kn;for(G instanceof Date||(G=new Date(+G));++oe<be;)R.charCodeAt(oe)===37&&(N.push(R.slice(re,oe)),(je=Yr[xe=R.charAt(++oe)])!=null?xe=R.charAt(++oe):je=xe==="e"?" ":"0",(kn=X[xe])&&(xe=kn(G,je)),N.push(xe),re=oe+1);return N.push(R.slice(re,oe)),N.join("")}}function P(R,X){return function(G){var N=Zt(1900,void 0,1),oe=q(N,R,G+="",0),re,be;if(oe!=G.length)return null;if("Q"in N)return new Date(N.Q);if("s"in N)return new Date(N.s*1e3+("L"in N?N.L:0));if(X&&!("Z"in N)&&(N.Z=0),"p"in N&&(N.H=N.H%12+N.p*12),N.m===void 0&&(N.m="q"in N?N.q:0),"V"in N){if(N.V<1||N.V>53)return null;"w"in N||(N.w=1),"Z"in N?(re=La(Zt(N.y,0,1)),be=re.getUTCDay(),re=be>4||be===0?oa.ceil(re):oa(re),re=gr.offset(re,(N.V-1)*7),N.y=re.getUTCFullYear(),N.m=re.getUTCMonth(),N.d=re.getUTCDate()+(N.w+6)%7):(re=Ta(Zt(N.y,0,1)),be=re.getDay(),re=be>4||be===0?ra.ceil(re):ra(re),re=Sn.offset(re,(N.V-1)*7),N.y=re.getFullYear(),N.m=re.getMonth(),N.d=re.getDate()+(N.w+6)%7)}else("W"in N||"U"in N)&&("w"in N||(N.w="u"in N?N.u%7:"W"in N?1:0),be="Z"in N?La(Zt(N.y,0,1)).getUTCDay():Ta(Zt(N.y,0,1)).getDay(),N.m=0,N.d="W"in N?(N.w+6)%7+N.W*7-(be+5)%7:N.w+N.U*7-(be+6)%7);return"Z"in N?(N.H+=N.Z/100|0,N.M+=N.Z%100,La(N)):Ta(N)}}function q(R,X,G,N){for(var oe=0,re=X.length,be=G.length,xe,je;oe<re;){if(N>=be)return-1;if(xe=X.charCodeAt(oe++),xe===37){if(xe=X.charAt(oe++),je=T[xe in Yr?X.charAt(oe++):xe],!je||(N=je(R,G,N))<0)return-1}else if(xe!=G.charCodeAt(N++))return-1}return N}function Y(R,X,G){var N=d.exec(X.slice(G));return N?(R.p=u.get(N[0].toLowerCase()),G+N[0].length):-1}function W(R,X,G){var N=p.exec(X.slice(G));return N?(R.w=x.get(N[0].toLowerCase()),G+N[0].length):-1}function O(R,X,G){var N=h.exec(X.slice(G));return N?(R.w=f.get(N[0].toLowerCase()),G+N[0].length):-1}function j(R,X,G){var N=w.exec(X.slice(G));return N?(R.m=b.get(N[0].toLowerCase()),G+N[0].length):-1}function U(R,X,G){var N=k.exec(X.slice(G));return N?(R.m=$.get(N[0].toLowerCase()),G+N[0].length):-1}function y(R,X,G){return q(R,t,X,G)}function F(R,X,G){return q(R,a,X,G)}function C(R,X,G){return q(R,r,X,G)}function m(R){return s[R.getDay()]}function v(R){return i[R.getDay()]}function D(R){return c[R.getMonth()]}function A(R){return l[R.getMonth()]}function B(R){return o[+(R.getHours()>=12)]}function I(R){return 1+~~(R.getMonth()/3)}function _(R){return s[R.getUTCDay()]}function V(R){return i[R.getUTCDay()]}function z(R){return c[R.getUTCMonth()]}function K(R){return l[R.getUTCMonth()]}function Z(R){return o[+(R.getUTCHours()>=12)]}function Q(R){return 1+~~(R.getUTCMonth()/3)}return{format:function(R){var X=S(R+="",L);return X.toString=function(){return R},X},parse:function(R){var X=P(R+="",!1);return X.toString=function(){return R},X},utcFormat:function(R){var X=S(R+="",E);return X.toString=function(){return R},X},utcParse:function(R){var X=P(R+="",!0);return X.toString=function(){return R},X}}}var Yr={"-":"",_:" ",0:"0"},ve=/^\s*\d+/,eu=/^%/,tu=/[\\^$*+?|[\]().{}]/g;function ie(e,t,a){var r=e<0?"-":"",o=(r?-e:e)+"",i=o.length;return r+(i<a?new Array(a-i+1).join(t)+o:o)}function nu(e){return e.replace(tu,"\\$&")}function Jt(e){return new RegExp("^(?:"+e.map(nu).join("|")+")","i")}function en(e){return new Map(e.map((t,a)=>[t.toLowerCase(),a]))}function au(e,t,a){var r=ve.exec(t.slice(a,a+1));return r?(e.w=+r[0],a+r[0].length):-1}function ru(e,t,a){var r=ve.exec(t.slice(a,a+1));return r?(e.u=+r[0],a+r[0].length):-1}function ou(e,t,a){var r=ve.exec(t.slice(a,a+2));return r?(e.U=+r[0],a+r[0].length):-1}function iu(e,t,a){var r=ve.exec(t.slice(a,a+2));return r?(e.V=+r[0],a+r[0].length):-1}function su(e,t,a){var r=ve.exec(t.slice(a,a+2));return r?(e.W=+r[0],a+r[0].length):-1}function Xr(e,t,a){var r=ve.exec(t.slice(a,a+4));return r?(e.y=+r[0],a+r[0].length):-1}function jr(e,t,a){var r=ve.exec(t.slice(a,a+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),a+r[0].length):-1}function lu(e,t,a){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(a,a+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),a+r[0].length):-1}function cu(e,t,a){var r=ve.exec(t.slice(a,a+1));return r?(e.q=r[0]*3-3,a+r[0].length):-1}function du(e,t,a){var r=ve.exec(t.slice(a,a+2));return r?(e.m=r[0]-1,a+r[0].length):-1}function Kr(e,t,a){var r=ve.exec(t.slice(a,a+2));return r?(e.d=+r[0],a+r[0].length):-1}function uu(e,t,a){var r=ve.exec(t.slice(a,a+3));return r?(e.m=0,e.d=+r[0],a+r[0].length):-1}function Gr(e,t,a){var r=ve.exec(t.slice(a,a+2));return r?(e.H=+r[0],a+r[0].length):-1}function hu(e,t,a){var r=ve.exec(t.slice(a,a+2));return r?(e.M=+r[0],a+r[0].length):-1}function fu(e,t,a){var r=ve.exec(t.slice(a,a+2));return r?(e.S=+r[0],a+r[0].length):-1}function pu(e,t,a){var r=ve.exec(t.slice(a,a+3));return r?(e.L=+r[0],a+r[0].length):-1}function mu(e,t,a){var r=ve.exec(t.slice(a,a+6));return r?(e.L=Math.floor(r[0]/1e3),a+r[0].length):-1}function gu(e,t,a){var r=eu.exec(t.slice(a,a+1));return r?a+r[0].length:-1}function yu(e,t,a){var r=ve.exec(t.slice(a));return r?(e.Q=+r[0],a+r[0].length):-1}function vu(e,t,a){var r=ve.exec(t.slice(a));return r?(e.s=+r[0],a+r[0].length):-1}function Qr(e,t){return ie(e.getDate(),t,2)}function bu(e,t){return ie(e.getHours(),t,2)}function xu(e,t){return ie(e.getHours()%12||12,t,2)}function wu(e,t){return ie(1+Sn.count(ct(e),e),t,3)}function ti(e,t){return ie(e.getMilliseconds(),t,3)}function Su(e,t){return ti(e,t)+"000"}function Mu(e,t){return ie(e.getMonth()+1,t,2)}function $u(e,t){return ie(e.getMinutes(),t,2)}function ku(e,t){return ie(e.getSeconds(),t,2)}function Du(e){var t=e.getDay();return t===0?7:t}function Tu(e,t){return ie(pa.count(ct(e)-1,e),t,2)}function ni(e){var t=e.getDay();return t>=4||t===0?Xt(e):Xt.ceil(e)}function Lu(e,t){return e=ni(e),ie(Xt.count(ct(e),e)+(ct(e).getDay()===4),t,2)}function Eu(e){return e.getDay()}function Cu(e,t){return ie(ra.count(ct(e)-1,e),t,2)}function _u(e,t){return ie(e.getFullYear()%100,t,2)}function Pu(e,t){return e=ni(e),ie(e.getFullYear()%100,t,2)}function Iu(e,t){return ie(e.getFullYear()%1e4,t,4)}function Au(e,t){var a=e.getDay();return e=a>=4||a===0?Xt(e):Xt.ceil(e),ie(e.getFullYear()%1e4,t,4)}function Ru(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+ie(t/60|0,"0",2)+ie(t%60,"0",2)}function Zr(e,t){return ie(e.getUTCDate(),t,2)}function Nu(e,t){return ie(e.getUTCHours(),t,2)}function Fu(e,t){return ie(e.getUTCHours()%12||12,t,2)}function Bu(e,t){return ie(1+gr.count(Ct(e),e),t,3)}function ai(e,t){return ie(e.getUTCMilliseconds(),t,3)}function Vu(e,t){return ai(e,t)+"000"}function Uu(e,t){return ie(e.getUTCMonth()+1,t,2)}function Ou(e,t){return ie(e.getUTCMinutes(),t,2)}function qu(e,t){return ie(e.getUTCSeconds(),t,2)}function zu(e){var t=e.getUTCDay();return t===0?7:t}function Hu(e,t){return ie(ei.count(Ct(e)-1,e),t,2)}function ri(e){var t=e.getUTCDay();return t>=4||t===0?jt(e):jt.ceil(e)}function Wu(e,t){return e=ri(e),ie(jt.count(Ct(e),e)+(Ct(e).getUTCDay()===4),t,2)}function Yu(e){return e.getUTCDay()}function Xu(e,t){return ie(oa.count(Ct(e)-1,e),t,2)}function ju(e,t){return ie(e.getUTCFullYear()%100,t,2)}function Ku(e,t){return e=ri(e),ie(e.getUTCFullYear()%100,t,2)}function Gu(e,t){return ie(e.getUTCFullYear()%1e4,t,4)}function Qu(e,t){var a=e.getUTCDay();return e=a>=4||a===0?jt(e):jt.ceil(e),ie(e.getUTCFullYear()%1e4,t,4)}function Zu(){return"+0000"}function Jr(){return"%"}function eo(e){return+e}function to(e){return Math.floor(+e/1e3)}var At,vr;Ju({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Ju(e){return At=Jd(e),vr=At.format,At.parse,At.utcFormat,At.utcParse,At}function eh(e){return new Date(e)}function th(e){return e instanceof Date?+e:+new Date(+e)}function oi(e,t,a,r,o,i,s,l,c,d){var u=Jo(),h=u.invert,f=u.domain,p=d(".%L"),x=d(":%S"),k=d("%I:%M"),$=d("%I %p"),w=d("%a %d"),b=d("%b %d"),L=d("%B"),E=d("%Y");function T(S){return(c(S)<S?p:l(S)<S?x:s(S)<S?k:i(S)<S?$:r(S)<S?o(S)<S?w:b:a(S)<S?L:E)(S)}return u.invert=function(S){return new Date(h(S))},u.domain=function(S){return arguments.length?f(Array.from(S,th)):f().map(eh)},u.ticks=function(S){var P=f();return e(P[0],P[P.length-1],S??10)},u.tickFormat=function(S,P){return P==null?T:d(P)},u.nice=function(S){var P=f();return(!S||typeof S.range!="function")&&(S=t(P[0],P[P.length-1],S??10)),S?f(Fd(P,S)):u},u.copy=function(){return Zo(u,oi(e,t,a,r,o,i,s,l,c,d))},u}function nh(){return Qo.apply(oi(Qd,Zd,ct,yr,pa,Sn,mr,pr,Bt,vr).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}const Cn=e=>()=>e;function ah(e,{sourceEvent:t,target:a,transform:r,dispatch:o}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:a,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:o}})}function rt(e,t,a){this.k=e,this.x=t,this.y=a}rt.prototype={constructor:rt,scale:function(e){return e===1?this:new rt(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new rt(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var ma=new rt(1,0,0);rt.prototype;function Ea(e){e.stopImmediatePropagation()}function tn(e){e.preventDefault(),e.stopImmediatePropagation()}function rh(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function oh(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function no(){return this.__zoom||ma}function ih(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function sh(){return navigator.maxTouchPoints||"ontouchstart"in this}function lh(e,t,a){var r=e.invertX(t[0][0])-a[0][0],o=e.invertX(t[1][0])-a[1][0],i=e.invertY(t[0][1])-a[0][1],s=e.invertY(t[1][1])-a[1][1];return e.translate(o>r?(r+o)/2:Math.min(0,r)||Math.max(0,o),s>i?(i+s)/2:Math.min(0,i)||Math.max(0,s))}function ch(){var e=rh,t=oh,a=lh,r=ih,o=sh,i=[0,1/0],s=[[-1/0,-1/0],[1/0,1/0]],l=250,c=oc,d=ar("start","zoom","end"),u,h,f,p=500,x=150,k=0,$=10;function w(y){y.property("__zoom",no).on("wheel.zoom",q,{passive:!1}).on("mousedown.zoom",Y).on("dblclick.zoom",W).filter(o).on("touchstart.zoom",O).on("touchmove.zoom",j).on("touchend.zoom touchcancel.zoom",U).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}w.transform=function(y,F,C,m){var v=y.selection?y.selection():y;v.property("__zoom",no),y!==v?T(y,F,C,m):v.interrupt().each(function(){S(this,arguments).event(m).start().zoom(null,typeof F=="function"?F.apply(this,arguments):F).end()})},w.scaleBy=function(y,F,C,m){w.scaleTo(y,function(){var v=this.__zoom.k,D=typeof F=="function"?F.apply(this,arguments):F;return v*D},C,m)},w.scaleTo=function(y,F,C,m){w.transform(y,function(){var v=t.apply(this,arguments),D=this.__zoom,A=C==null?E(v):typeof C=="function"?C.apply(this,arguments):C,B=D.invert(A),I=typeof F=="function"?F.apply(this,arguments):F;return a(L(b(D,I),A,B),v,s)},C,m)},w.translateBy=function(y,F,C,m){w.transform(y,function(){return a(this.__zoom.translate(typeof F=="function"?F.apply(this,arguments):F,typeof C=="function"?C.apply(this,arguments):C),t.apply(this,arguments),s)},null,m)},w.translateTo=function(y,F,C,m,v){w.transform(y,function(){var D=t.apply(this,arguments),A=this.__zoom,B=m==null?E(D):typeof m=="function"?m.apply(this,arguments):m;return a(ma.translate(B[0],B[1]).scale(A.k).translate(typeof F=="function"?-F.apply(this,arguments):-F,typeof C=="function"?-C.apply(this,arguments):-C),D,s)},m,v)};function b(y,F){return F=Math.max(i[0],Math.min(i[1],F)),F===y.k?y:new rt(F,y.x,y.y)}function L(y,F,C){var m=F[0]-C[0]*y.k,v=F[1]-C[1]*y.k;return m===y.x&&v===y.y?y:new rt(y.k,m,v)}function E(y){return[(+y[0][0]+ +y[1][0])/2,(+y[0][1]+ +y[1][1])/2]}function T(y,F,C,m){y.on("start.zoom",function(){S(this,arguments).event(m).start()}).on("interrupt.zoom end.zoom",function(){S(this,arguments).event(m).end()}).tween("zoom",function(){var v=this,D=arguments,A=S(v,D).event(m),B=t.apply(v,D),I=C==null?E(B):typeof C=="function"?C.apply(v,D):C,_=Math.max(B[1][0]-B[0][0],B[1][1]-B[0][1]),V=v.__zoom,z=typeof F=="function"?F.apply(v,D):F,K=c(V.invert(I).concat(_/V.k),z.invert(I).concat(_/z.k));return function(Z){if(Z===1)Z=z;else{var Q=K(Z),R=_/Q[2];Z=new rt(R,I[0]-Q[0]*R,I[1]-Q[1]*R)}A.zoom(null,Z)}})}function S(y,F,C){return!C&&y.__zooming||new P(y,F)}function P(y,F){this.that=y,this.args=F,this.active=0,this.sourceEvent=null,this.extent=t.apply(y,F),this.taps=0}P.prototype={event:function(y){return y&&(this.sourceEvent=y),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(y,F){return this.mouse&&y!=="mouse"&&(this.mouse[1]=F.invert(this.mouse[0])),this.touch0&&y!=="touch"&&(this.touch0[1]=F.invert(this.touch0[0])),this.touch1&&y!=="touch"&&(this.touch1[1]=F.invert(this.touch1[0])),this.that.__zoom=F,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(y){var F=tt(this.that).datum();d.call(y,this.that,new ah(y,{sourceEvent:this.sourceEvent,target:w,transform:this.that.__zoom,dispatch:d}),F)}};function q(y,...F){if(!e.apply(this,arguments))return;var C=S(this,F).event(y),m=this.__zoom,v=Math.max(i[0],Math.min(i[1],m.k*Math.pow(2,r.apply(this,arguments)))),D=ut(y);if(C.wheel)(C.mouse[0][0]!==D[0]||C.mouse[0][1]!==D[1])&&(C.mouse[1]=m.invert(C.mouse[0]=D)),clearTimeout(C.wheel);else{if(m.k===v)return;C.mouse=[D,m.invert(D)],Bn(this),C.start()}tn(y),C.wheel=setTimeout(A,x),C.zoom("mouse",a(L(b(m,v),C.mouse[0],C.mouse[1]),C.extent,s));function A(){C.wheel=null,C.end()}}function Y(y,...F){if(f||!e.apply(this,arguments))return;var C=y.currentTarget,m=S(this,F,!0).event(y),v=tt(y.view).on("mousemove.zoom",I,!0).on("mouseup.zoom",_,!0),D=ut(y,C),A=y.clientX,B=y.clientY;Tl(y.view),Ea(y),m.mouse=[D,this.__zoom.invert(D)],Bn(this),m.start();function I(V){if(tn(V),!m.moved){var z=V.clientX-A,K=V.clientY-B;m.moved=z*z+K*K>k}m.event(V).zoom("mouse",a(L(m.that.__zoom,m.mouse[0]=ut(V,C),m.mouse[1]),m.extent,s))}function _(V){v.on("mousemove.zoom mouseup.zoom",null),Ll(V.view,m.moved),tn(V),m.event(V).end()}}function W(y,...F){if(e.apply(this,arguments)){var C=this.__zoom,m=ut(y.changedTouches?y.changedTouches[0]:y,this),v=C.invert(m),D=C.k*(y.shiftKey?.5:2),A=a(L(b(C,D),m,v),t.apply(this,F),s);tn(y),l>0?tt(this).transition().duration(l).call(T,A,m,y):tt(this).call(w.transform,A,m,y)}}function O(y,...F){if(e.apply(this,arguments)){var C=y.touches,m=C.length,v=S(this,F,y.changedTouches.length===m).event(y),D,A,B,I;for(Ea(y),A=0;A<m;++A)B=C[A],I=ut(B,this),I=[I,this.__zoom.invert(I),B.identifier],v.touch0?!v.touch1&&v.touch0[2]!==I[2]&&(v.touch1=I,v.taps=0):(v.touch0=I,D=!0,v.taps=1+!!u);u&&(u=clearTimeout(u)),D&&(v.taps<2&&(h=I[0],u=setTimeout(function(){u=null},p)),Bn(this),v.start())}}function j(y,...F){if(this.__zooming){var C=S(this,F).event(y),m=y.changedTouches,v=m.length,D,A,B,I;for(tn(y),D=0;D<v;++D)A=m[D],B=ut(A,this),C.touch0&&C.touch0[2]===A.identifier?C.touch0[0]=B:C.touch1&&C.touch1[2]===A.identifier&&(C.touch1[0]=B);if(A=C.that.__zoom,C.touch1){var _=C.touch0[0],V=C.touch0[1],z=C.touch1[0],K=C.touch1[1],Z=(Z=z[0]-_[0])*Z+(Z=z[1]-_[1])*Z,Q=(Q=K[0]-V[0])*Q+(Q=K[1]-V[1])*Q;A=b(A,Math.sqrt(Z/Q)),B=[(_[0]+z[0])/2,(_[1]+z[1])/2],I=[(V[0]+K[0])/2,(V[1]+K[1])/2]}else if(C.touch0)B=C.touch0[0],I=C.touch0[1];else return;C.zoom("touch",a(L(A,B,I),C.extent,s))}}function U(y,...F){if(this.__zooming){var C=S(this,F).event(y),m=y.changedTouches,v=m.length,D,A;for(Ea(y),f&&clearTimeout(f),f=setTimeout(function(){f=null},p),D=0;D<v;++D)A=m[D],C.touch0&&C.touch0[2]===A.identifier?delete C.touch0:C.touch1&&C.touch1[2]===A.identifier&&delete C.touch1;if(C.touch1&&!C.touch0&&(C.touch0=C.touch1,delete C.touch1),C.touch0)C.touch0[1]=this.__zoom.invert(C.touch0[0]);else if(C.end(),C.taps===2&&(A=ut(A,this),Math.hypot(h[0]-A[0],h[1]-A[1])<$)){var B=tt(this).on("dblclick.zoom");B&&B.apply(this,arguments)}}}return w.wheelDelta=function(y){return arguments.length?(r=typeof y=="function"?y:Cn(+y),w):r},w.filter=function(y){return arguments.length?(e=typeof y=="function"?y:Cn(!!y),w):e},w.touchable=function(y){return arguments.length?(o=typeof y=="function"?y:Cn(!!y),w):o},w.extent=function(y){return arguments.length?(t=typeof y=="function"?y:Cn([[+y[0][0],+y[0][1]],[+y[1][0],+y[1][1]]]),w):t},w.scaleExtent=function(y){return arguments.length?(i[0]=+y[0],i[1]=+y[1],w):[i[0],i[1]]},w.translateExtent=function(y){return arguments.length?(s[0][0]=+y[0][0],s[1][0]=+y[1][0],s[0][1]=+y[0][1],s[1][1]=+y[1][1],w):[[s[0][0],s[0][1]],[s[1][0],s[1][1]]]},w.constrain=function(y){return arguments.length?(a=y,w):a},w.duration=function(y){return arguments.length?(l=+y,w):l},w.interpolate=function(y){return arguments.length?(c=y,w):c},w.on=function(){var y=d.on.apply(d,arguments);return y===d?w:y},w.clickDistance=function(y){return arguments.length?(k=(y=+y)*y,w):Math.sqrt(k)},w.tapDistance=function(y){return arguments.length?($=+y,w):$},w}async function dh(e){const t="http://localhost:8000";try{const a=await fetch(`${t}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok){const o=await a.text();throw new Error(`Chat API error (${a.status}): ${o}`)}return await a.json()}catch(a){return console.error("Chat API error:",a),{message:`Fehler bei der Kommunikation mit dem Chat-Service: ${a instanceof Error?a.message:"Unbekannter Fehler"}`,success:!1,error:a instanceof Error?a.message:"Unknown error"}}}function uh(e){const t={mode:e.mode,canvasView:e.canvasView,selectedVariable:e.selectedVariable,selectedModel:e.selectedModel,selectedScenario:e.selectedScenario,selectedDate:e.selectedDate};return e.currentDataStats&&(t.dataStats={min:e.currentDataStats.min,max:e.currentDataStats.max,mean:e.currentDataStats.mean,median:e.currentDataStats.median,stddev:e.currentDataStats.stddev}),e.selectedLocation&&(t.selectedLocation={lat:e.selectedLocation.lat,lon:e.selectedLocation.lon,value:e.selectedLocation.value}),e.mode==="Compare"&&e.compareMode&&(t.compareMode=e.compareMode,e.compareMode==="Scenarios"?(t.scenario1=e.selectedScenario1,t.scenario2=e.selectedScenario2):e.compareMode==="Models"?(t.model1=e.selectedModel1,t.model2=e.selectedModel2):e.compareMode==="Dates"&&(t.date1=e.selectedDate1,t.date2=e.selectedDate2)),e.canvasView==="chart"&&e.chartMode&&(t.chartMode=e.chartMode),t}let Ya=null;function hh(e){Ya=e}function fh(e){if(!e||!Ya)return;const t={};e.mode&&(t.mode=e.mode),e.model&&(t.model=e.model),e.selectedScenario&&(t.scenario=e.selectedScenario),e.selectedDate&&(t.date=e.selectedDate),e.variable&&(t.variable=e.variable),e.palette&&(t.palette=e.palette),e.compareMode&&(t.compareMode=e.compareMode),e.scenario1&&(t.compareScenarioA=e.scenario1),e.scenario2&&(t.compareScenarioB=e.scenario2),e.model1&&(t.compareModelA=e.model1),e.model2&&(t.compareModelB=e.model2),e.date1&&(t.compareDateStart=e.date1),e.date2&&(t.compareDateEnd=e.date2),e.chartMode&&(t.chartMode=e.chartMode),e.chartDate&&(t.chartDate=e.chartDate),e.location&&(t.chartLocation=e.location),e.start_date&&(t.chartRangeStart=e.start_date),e.end_date&&(t.chartRangeEnd=e.end_date),e.models&&(t.chartModels=e.models),e.scenarios&&(t.chartScenarios=e.scenarios.map(a=>_t(a))),e.colorPalette&&(t.palette=Zh(e.colorPalette)),e.canvasView&&(t.canvasView=e.canvasView.toLowerCase()),Object.keys(t).length>0&&(console.log("Applying state updates from backend:",t),Ya(t))}function ph(e){let t=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;");t=t.replace(/```(.+?)```/gs,'<code style="background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px; font-family: monospace; display: inline-block; margin: 4px 0; line-height: 1.4;">$1</code>'),t=t.replace(/`(.+?)`/g,'<code style="background: rgba(255,255,255,0.1); padding: 2px 4px; border-radius: 3px; font-family: monospace; font-size: 0.9em; vertical-align: middle; line-height: 1.4;">$1</code>'),t=t.replace(/\*\*(.+?)\*\*/g,'<strong style="font-weight: 700;">$1</strong>'),t=t.replace(/__(.+?)__/g,'<strong style="font-weight: 700;">$1</strong>');const a=t.split(`
`),r=[];for(let o=0;o<a.length;o++){const i=a[o].trim();if(i.startsWith("- ")){const s=i.substring(2);r.push(`<div style="display: flex; gap: 8px; margin: 6px 0;"><span style="flex-shrink: 0;">•</span><span style="flex: 1; line-height: 1.6; word-break: break-word; overflow-wrap: break-word;">${s}</span></div>`)}else if(/^\d+\.\s/.test(i)){const s=i.match(/^(\d+)\.\s(.+)$/);if(s){const l=s[1],c=s[2];r.push(`<div style="display: flex; gap: 8px; margin: 6px 0;"><span style="flex-shrink: 0; font-weight: 600; line-height: 1.6;">${l}.</span><span style="flex: 1; line-height: 1.6; word-break: break-word; overflow-wrap: break-word;">${c}</span></div>`)}else r.push(i)}else i.length>0?r.push(`<div style="margin: 8px 0; line-height: 1.6;">${i}</div>`):r.push('<div style="height: 12px;"></div>')}return r.join("")}function ii(e){const t=e.sender==="user"?"chat-bubble chat-bubble-user":"chat-bubble chat-bubble-agent",a=e.sender==="user"?e.text:ph(e.text);return`<div class="${t}">${a}</div>`}function Ca(e,t){const a=e.querySelector(".chat-messages");if(!a)return;const r=ii(t);a.insertAdjacentHTML("beforeend",r),a.scrollTop=a.scrollHeight}function _a(e,t){const a=e.querySelector(".chat-loading");a&&(a.style.display=t?"flex":"none")}function mh(e,t){return`
    <div class="chat-stack">
      <div class="chat-lead">Discuss the data with an agent, or ask questions.</div>

      <div class="chat-messages">
            ${e.map(a=>ii(a)).join("")}
      </div>
      <div class="chat-bubble chat-bubble-agent chat-loading" style="display: none">
        <span class="chat-loading-dot"></span><span class="chat-loading-dot"></span><span class="chat-loading-dot"></span>
      </div>
    

      <div class="chat-box">
        <input
          type="text"
          value="${t}"
          data-action="chat-input"
          class="chat-input"
          placeholder="Ask a question"
        />
        <button 
          type="button" 
          data-action="chat-send" 
          aria-label="Send chat message" 
          class="chat-send"
        >
          ➤
        </button>
      </div>
    </div>
  `}function gh(e,t,a){const r=e.querySelector('[data-action="chat-input"]'),o=e.querySelector('[data-action="chat-send"]');r?.addEventListener("input",i=>{t.chatInput=i.target.value}),r?.addEventListener("keydown",i=>{if(i.key==="ArrowUp"&&t.chatMessages.length>0){const s=[...t.chatMessages].reverse().find(l=>l.sender==="user");s&&(t.chatInput=s.text,r&&(r.value=s.text),setTimeout(()=>{r?.setSelectionRange(r.value.length,r.value.length)},0))}i.key==="Enter"&&ao(e,t,a)}),o?.addEventListener("click",()=>{ao(e,t,a)})}async function ao(e,t,a){const r=t.chatInput.trim();if(!r)return;const o={id:Date.now(),sender:"user",text:r};t.chatMessages=[...t.chatMessages,o],t.chatInput="";const i=e.querySelector('[data-action="chat-input"]');i&&(i.value=""),Ca(e,o),_a(e,!0);const s=t.chatMessages.slice(Math.max(0,t.chatMessages.length-11),-1).map(c=>({role:c.sender==="user"?"user":"assistant",content:c.text})),l=uh({mode:a.mode,canvasView:a.canvasView,selectedVariable:a.selectedVariable,selectedModel:a.selectedModel,selectedScenario:a.selectedScenario,selectedDate:a.selectedDate,compareMode:a.compareMode,chartMode:a.chartMode,selectedScenario1:a.selectedScenario1,selectedScenario2:a.selectedScenario2,selectedModel1:a.selectedModel1,selectedModel2:a.selectedModel2,selectedDate1:a.selectedDate1,selectedDate2:a.selectedDate2,currentDataStats:a.currentDataStats});try{const c=await dh({message:r,context:l,history:s}),d={id:Date.now()+1,sender:"agent",text:c.message,new_state:c.new_state};console.log("New state from agent:",d.new_state),t.chatMessages=[...t.chatMessages,d],d.new_state&&fh(d.new_state),_a(e,!1),Ca(e,d)}catch(c){const d={id:Date.now()+1,sender:"agent",text:`Entschuldigung, es gab einen Fehler: ${c instanceof Error?c.message:"Unbekannter Fehler"}`};t.chatMessages=[...t.chatMessages,d],_a(e,!1),Ca(e,d)}}const Pe=360;let wt=null,Ze=null;function yh(e){const{root:t,isOpen:a,onCanvasToggleUpdate:r,onTimeSliderUpdate:o}=e;wt||(wt=t.querySelector('[data-role="sidebar"]')),Ze||(Ze=t.querySelector('[data-action="toggle-sidebar"]'));const i=t.querySelector('[data-role="canvas-toggle"]'),s=t.querySelector('[data-role="compare-info-trigger"]'),l=t.querySelector('[data-role="compare-info-overlay"]');if(!wt||!i||!Ze)return;const c=a?"translateX(0)":`translateX(${Pe+24}px)`;wt.style.transform=c,wt.style.pointerEvents=a?"auto":"none",wt.setAttribute("aria-hidden",String(!a));const d=a?`${Pe+10}px`:"14px";Ze.style.right=d,Ze.setAttribute("aria-label",a?"Collapse sidebar":"Expand sidebar"),Ze.className=a?"sidebar-toggle open":"sidebar-toggle";const u=Ze.querySelector("span");u&&(u.textContent=a?"›":"‹");const h=a?Pe+24:24;i.style.right=`${h}px`,s&&(s.style.right=`${h}px`),l&&(l.style.left=a?`${Pe}px`:"0",l.style.right="0"),r&&r(h),o&&o(a)}function vh(e){const{root:t,getSidebarOpen:a,setSidebarOpen:r,onCanvasToggleUpdate:o,onTimeSliderUpdate:i}=e;wt=t.querySelector('[data-role="sidebar"]'),Ze=t.querySelector('[data-action="toggle-sidebar"]'),Ze?.addEventListener("click",()=>{const s=!a();r(s),yh({root:t,isOpen:s,onCanvasToggleUpdate:o,onTimeSliderUpdate:i})})}function bh(e){const t=e?Pe+10:14;return`
      <button
        type="button"
        aria-label="${e?"Collapse sidebar":"Expand sidebar"}"
        data-action="toggle-sidebar"
        class="${e?"sidebar-toggle open":"sidebar-toggle"}"
        style="right: ${t}px"
      >
        <span class="sidebar-toggle-icon">${e?"›":"‹"}</span>
      </button>
    `}const ue={map:"map",scenario:"scenario",models:"models",date:"date",variable:"variable",unit:"unit",palette:"palette",timeframe:"timeframe",mapReview:"map-review",compareSwitch:"compare-switch",compareParameters:"compare-parameters",chatSwitch:"chat-switch",chatOverview:"chat-overview",analysisSwitch:"analysis-switch",analysisOverview:"analysis-overview"},De={map:"#map-canvas",scenario:'[data-role="scenario-selector"]',model:'[data-role="model-selector"]',date:'[data-role="date-picker"]',variable:'[data-role="variable-selector"]',unit:'[data-role="unit-selector"]',palette:'[data-role="palette-selector"]',timeSlider:'[data-role="time-slider"]',compareSwitch:'[data-action="set-mode"][data-value="Compare"]',compareParameters:'[data-role="compare-parameters"]',chatSwitch:'[data-action="set-tab"][data-value="Chat"]',chatSection:'[data-role="chat-section"]',analysisSwitch:'[data-action="set-canvas"][data-value="chart"]',analysisOverview:'[data-role="chart-container"]'},Mn=[{id:ue.map,title:"Welcome to Climate Visualization",description:"This interactive map shows climate data across the globe. You can pan by dragging, zoom with your mouse wheel, and hover over any location to see detailed information.",targetSelector:De.map,position:"center",requiresAction:{type:"none"}},{id:ue.scenario,title:"Climate Scenarios",description:"Choose a climate scenario: Historical (1950-2014) shows past data, while SSP245, SSP370, and SSP585 represent different future warming pathways. Select one to continue.",targetSelector:De.scenario,position:"left",requiresAction:{type:"select",dataKey:"scenario"}},{id:ue.models,title:"Climate Models",description:"Select from 11 global climate models developed by research institutions worldwide. Each model provides unique projections. Choose a model to continue.",targetSelector:De.model,position:"left",requiresAction:{type:"select",dataKey:"model"}},{id:ue.date,title:"Date Selection",description:"Pick a date to view climate data. The available range depends on your chosen scenario. Select a date to continue.",targetSelector:De.date,position:"left",requiresAction:{type:"input",dataKey:"date"}},{id:ue.variable,title:"Climate Variable",description:"Select which climate variable to visualize, such as temperature or precipitation. Choose one to continue.",targetSelector:De.variable,position:"left",requiresAction:{type:"select",dataKey:"variable"}},{id:ue.unit,title:"Unit Preferences",description:"Choose your preferred temperature unit: Celsius (°C), Fahrenheit (°F), or Kelvin (K). Select a unit to continue.",targetSelector:De.unit,position:"left",requiresAction:{type:"select",dataKey:"unit"}},{id:ue.palette,title:"Color Palette",description:"Select a color scheme for the map. Different palettes can help visualize temperature variations. Choose a palette to continue.",targetSelector:De.palette,position:"left",requiresAction:{type:"select",dataKey:"palette"}},{id:ue.timeframe,title:"Time Navigation",description:"Use this slider to quickly navigate through different dates and see how climate patterns change over time.",targetSelector:De.timeSlider,position:"top",requiresAction:{type:"none"}},{id:ue.mapReview,title:"Review the Map",description:"Great! Your parameters are set. Take a quick look at the map with your chosen settings, then continue.",targetSelector:De.map,position:"right",requiresAction:{type:"none"}},{id:ue.compareSwitch,title:"Compare Mode",description:"Now switch to Compare mode to explore differences side by side. Click Compare to continue.",targetSelector:De.compareSwitch,position:"left",requiresAction:{type:"click"}},{id:ue.compareParameters,title:"Compare Parameters",description:"These settings control what you compare and how the differences are calculated. Review the options, then continue.",targetSelector:De.compareParameters,position:"left",requiresAction:{type:"none"}},{id:ue.chatSwitch,title:"Chat",description:"Open the Chat tab to ask questions about the data and get insights. Click Chat to continue.",targetSelector:De.chatSwitch,position:"left",requiresAction:{type:"click"}},{id:ue.chatOverview,title:"Chat Overview",description:"Use the chat to explore insights, ask about trends, or get help interpreting results. You can also change the parameters with the chat, e.g. 'Compare optimistic and pessimistic prediction of precipitation for 2050. Change the color for a good representation'.<br><br>When you're ready, continue.",targetSelector:De.chatSection,position:"left",requiresAction:{type:"none"}},{id:ue.analysisSwitch,title:"Analysis Tools",description:"Switch to the Analysis view to see detailed charts and statistics. Click the Analysis button to continue.",targetSelector:De.analysisSwitch,position:"left",requiresAction:{type:"click"}},{id:ue.analysisOverview,title:"Analysis Overview",description:"Here you can explore charts, compare scenarios, and analyze trends over time. This is where you dive deeper into the data. The tutorial is complete!",targetSelector:De.analysisOverview,position:"center",requiresAction:{type:"none"}}];let gt={active:!1,currentStep:0,completed:!1};const br=new Set;function Je(){return gt}function xh(){gt={active:!0,currentStep:0,completed:!1},br.clear()}function si(){gt={active:!1,currentStep:0,completed:!1},br.clear(),document.querySelectorAll(".tutorial-target-active").forEach(e=>{e.classList.remove("tutorial-target-active")})}function wh(){gt.currentStep<Mn.length-1?gt.currentStep++:si()}function Mt(){const e=Mn[gt.currentStep];e&&br.add(e.id),wh()}function Sh(){return{current:gt.currentStep+1,total:Mn.length}}function ro(e,t,a=!0){if(t===ue.map)return null;const r=document.querySelector(e);if(r){if(t===ue.mapReview){const l=document.querySelector('[data-role="sidebar"]')?.getBoundingClientRect(),c=l?l.left:window.innerWidth;return new DOMRect(0,0,Math.max(c,0),window.innerHeight)}if(t===ue.chatOverview){const l=document.querySelector('[data-role="sidebar"]')?.getBoundingClientRect();if(l)return new DOMRect(l.left,0,l.width,window.innerHeight)}const o=r.getBoundingClientRect(),i=r.querySelector(".custom-select-dropdown");if(a&&i&&r.classList.contains("open")){const s=i.getBoundingClientRect(),l=Math.min(o.top,s.top),c=Math.max(o.bottom,s.bottom),d=Math.min(o.left,s.left),u=Math.max(o.right,s.right);return new DOMRect(d,l,u-d,c-l)}return o}return null}function Mh(e,t,a){if(!e)return{top:"50%",left:"50%"};const r=20,o={};switch(t){case"top":o.bottom=`${window.innerHeight-e.top+r}px`,o.left=`${e.left+e.width/2}px`;break;case"bottom":o.top=`${e.bottom+r}px`,o.left=`${e.left+e.width/2}px`;break;case"left":if(o.top=`${e.top+e.height/2}px`,a===ue.chatSwitch||a===ue.chatOverview){const s=document.querySelector('[data-role="sidebar"]')?.getBoundingClientRect(),l=s?s.left:e.left;o.right=`${window.innerWidth-l+r}px`}else o.right=`${window.innerWidth-e.left+r}px`;break;case"right":o.top=`${e.top+e.height/2}px`,o.left=`${e.right+r}px`;break;default:o.top="50%",o.left="50%";break}return o}function $h(e){if(!e.active)return"";const t=Mn[e.currentStep];if(!t)return"";const a=document.querySelector(t.targetSelector);if(a){document.querySelectorAll(".tutorial-target-active").forEach(f=>{f!==a&&f.classList.remove("tutorial-target-active")}),a.classList.add("tutorial-target-active");const u=a.closest(".custom-select-container");if(u){u.classList.add("tutorial-target-active");const f=u.querySelector(".custom-select-info-panel");f&&f.classList.add("tutorial-target-active")}const h=document.querySelector(".custom-select-info-panel-shared");h&&h.classList.add("tutorial-target-active")}const r=Sh(),o=ro(t.targetSelector,t.id,!0),i=ro(t.targetSelector,t.id,!1),s=Mh(i,t.position,t.id);let l="";t.position==="center"?l="transform: translate(-50%, -50%);":t.position==="top"||t.position==="bottom"?l="transform: translateX(-50%);":(t.position==="left"||t.position==="right")&&(l="transform: translateY(-50%);");const c=Object.entries(s).map(([u,h])=>`${u}: ${h};`).join(" ");let d="";if(o){const h=o.top-5,f=o.left-5,p=o.bottom+5,x=o.right+5;d=`clip-path: polygon(
            0% 0%, 
            0% 100%, 
            ${f}px 100%, 
            ${f}px ${h}px, 
            ${x}px ${h}px, 
            ${x}px ${p}px, 
            ${f}px ${p}px, 
            ${f}px 100%, 
            100% 100%, 
            100% 0%
        );`}return`
        <div class="tutorial-backdrop" style="${d}"></div>
        ${o?`<div class="tutorial-spotlight" style="
                    top: ${o.top}px;
                    left: ${o.left}px;
                    width: ${o.width}px;
                    height: ${o.height}px;
                "></div>`:""}
        <div class="tutorial-box" data-role="tutorial-box" style="${c} ${l}">
            <div class="tutorial-header">
                <div class="tutorial-progress">Step ${r.current} of ${r.total}</div>
                <button class="tutorial-close" data-action="close-tutorial" aria-label="Close tutorial">×</button>
            </div>
            <h3 class="tutorial-title">${t.title}</h3>
            <p class="tutorial-description">${t.description}</p>
            <div class="tutorial-actions">
                        <button class="tutorial-btn tutorial-btn-primary" data-action="tutorial-continue">Continue →</button>
                    </div>
        </div>
    `}function kh(){return gt.completed?"":`
        <button class="tutorial-start-btn" data-action="start-tutorial" aria-label="Start tutorial">
            ?
        </button>
    `}function Xa(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:{r:0,g:0,b:0}}const Dh=e=>e-273.15,Th=e=>(e-273.15)*(9/5)+32,Lh=e=>e*1e3,Eh=e=>e*3.6,Ch=e=>e*2.237,_h=e=>e/1e3,Rt=e=>e;function Be(e){switch(e){case"tas":case"tasmin":case"tasmax":return[{label:"Kelvin (K)",unit:"K",convert:Rt},{label:"Celsius (°C)",unit:"°C",convert:Dh},{label:"Fahrenheit (°F)",unit:"°F",convert:Th}];case"pr":return[{label:"g m⁻² s⁻¹",unit:"g m⁻² s⁻¹",convert:Lh},{label:"kg m⁻² s⁻¹",unit:"kg m⁻² s⁻¹",convert:Rt}];case"rsds":case"rlds":return[{label:"W/m²",unit:"W/m²",convert:Rt},{label:"kW/m²",unit:"kW/m²",convert:_h}];case"sfcWind":return[{label:"m/s",unit:"m/s",convert:Rt},{label:"km/h",unit:"km/h",convert:Eh},{label:"mph",unit:"mph",convert:Ch}];case"hurs":return[{label:"Percent (%)",unit:"%",convert:Rt}];default:return[{label:"Default",unit:"",convert:Rt}]}}function ze(e){return Be(e)[0]}function qt(e,t,a,r){const i=Be(t).find(s=>s.label===a);return i?r?.isDifference&&["tas","tasmin","tasmax"].includes(t)?a.includes("Celsius")?e:a.includes("Fahrenheit")?e*(9/5):e:i.convert(e):e}function li(e,t){return Be(e).find(o=>o.label===t)?.unit||""}function ci(e,t,a,r,o){const s=Be(a).find(l=>l.label===r);return s?o?.isDifference&&["tas","tasmin","tasmax"].includes(a)?r.startsWith("Celsius")?{min:e,max:t}:r.startsWith("Fahrenheit")?{min:e*1.8,max:t*1.8}:{min:e,max:t}:{min:s.convert(e),max:s.convert(t)}:{min:e,max:t}}let ot=null,pn=[];function xr(e,t,a,r){const o=r.map(Xa);for(let i=0;i<a;i++){const l=(1-i/(a-1))*(o.length-1),c=Math.floor(l),d=Math.min(c+1,o.length-1),u=l-c,h=o[c],f=o[d],p=Math.round(h.r+(f.r-h.r)*u),x=Math.round(h.g+(f.g-h.g)*u),k=Math.round(h.b+(f.b-h.b)*u);e.fillStyle=`rgb(${p}, ${x}, ${k})`,e.fillRect(0,i,t,1)}}function Ph(e,t,a,r,o,i){const s=r?.variable_metadata[e],l=s?.name||e;let c=t,d=a,u=s?.unit||"";if(o){const p=ci(t,a,e,o,{isDifference:i});c=p.min,d=p.max,u=li(e,o)}const h=(d-c)/4,f=[d,d-h,d-2*h,d-3*h,c];return`
      <div class="map-legend">
        <div class="legend-title">${l}</div>
        <div class="legend-container">
        <canvas id="legend-gradient-canvas" width="20" height="200" style="width: 20px; height: 200px; border-radius: 4px;"></canvas>
          <div class="legend-labels">
            ${f.map(p=>`<span>${p.toFixed(2)} ${u}</span>`).join("")}
          </div>
        </div>
      </div>
    `}function Vn(e,t){const a=document.getElementById(e);if(!a){console.warn("Legend canvas not found");return}ot=a,pn=t;const r=a.getContext("2d");if(!r)return;const o=a.width,i=a.height;xr(r,o,i,t)}function Ih(e,t,a){if(!ot||pn.length===0)return;const r=ot.getContext("2d");if(!r)return;const o=ot.width,i=ot.height;xr(r,o,i,pn);const s=a-t,l=!Number.isFinite(s)||s<=0||!Number.isFinite(e)?.5:Math.min(1,Math.max(0,(e-t)/s)),c=Math.round(i*(1-l));r.strokeStyle="rgba(255, 255, 255, 0.95)",r.lineWidth=2,r.shadowColor="rgba(0, 0, 0, 0.8)",r.shadowBlur=4,r.beginPath(),r.moveTo(0,c),r.lineTo(o,c),r.stroke(),r.shadowBlur=0}function Ah(){if(!ot||pn.length===0)return;const e=ot.getContext("2d");if(!e)return;const t=ot.width,a=ot.height;xr(e,t,a,pn)}const $n="http://localhost:8000";class Ae extends Error{statusCode;details;constructor(t,a,r){super(t),this.name="DataClientError",this.statusCode=a,this.details=r}}function it(e){return{Historical:"historical",SSP245:"ssp245",SSP585:"ssp585"}[e]||e.toLowerCase()}function Rh(e){return e===1?"low":e===2?"medium":"high"}function Nh(e,t,a="float32"){const r=atob(e),o=new Uint8Array(r.length);for(let i=0;i<r.length;i++)o[i]=r.charCodeAt(i);if(a.includes("float32"))return new Float32Array(o.buffer);if(a.includes("float64"))return new Float64Array(o.buffer);throw new Error(`Unsupported dtype: ${a}`)}function Fh(e,t){const a=e.flat(),r=new Float32Array(a.length);for(let o=0;o<a.length;o++)r[o]=a[o];return r}async function Ee(e,t){const r=`${$n}/data`;try{const o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,scenario:e.scenario?it(e.scenario):void 0,data_format:e.data_format||"base64"})});if(!o.ok){const i=await o.json().catch(()=>({detail:o.statusText}));throw new Ae(i.detail||`HTTP ${o.status}: ${o.statusText}`,o.status,i)}return await o.json()}catch(o){throw o instanceof Ae?o:new Ae(`Failed to fetch data: ${o instanceof Error?o.message:String(o)}`,void 0,o)}}async function wr(e){const a=`${$n}/metadata`;try{const r=await fetch(a,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Ae(`HTTP ${r.status}: ${r.statusText}`,r.status);return await r.json()}catch(r){throw r instanceof Ae?r:new Ae(`Failed to fetch metadata: ${r instanceof Error?r.message:String(r)}`)}}function Se(e){return e.data?e.data instanceof Float32Array||e.data instanceof Float64Array?e.data:e.data_encoding==="none"?null:e.data_encoding==="base64"&&typeof e.data=="string"?Nh(e.data,e.shape,e.dtype):e.data_encoding==="list"&&Array.isArray(e.data)?Fh(e.data,e.shape):null:null}function he(e){return{variable:e.variable,time:e.date,model:e.model,scenario:e.scenario,resolution:Rh(e.resolution),data_format:e.dataFormat||"base64"}}async function ja(e,t){const r=`${$n}/pixel-data`;try{const o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,scenario:e.scenario?it(e.scenario):void 0,resolution:e.resolution||"medium",step_days:e.step_days||1})});if(!o.ok){const i=await o.json().catch(()=>({detail:o.statusText}));throw new Ae(i.detail||`HTTP ${o.status}: ${o.statusText}`,o.status,i)}return await o.json()}catch(o){throw o instanceof Ae?o:new Ae(`Failed to fetch pixel data: ${o instanceof Error?o.message:String(o)}`,void 0,o)}}async function Ka(e,t){const r=`${$n}/aggregate-on-demand`;try{const o=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,scenario:e.scenario?it(e.scenario):void 0,resolution:e.resolution||"medium",step_days:e.step_days||1})});if(!o.ok){const i=await o.json().catch(()=>({detail:o.statusText}));throw new Ae(i.detail||`HTTP ${o.status}: ${o.statusText}`,o.status,i)}return await o.json()}catch(o){throw o instanceof Ae?o:new Ae(`Failed to fetch aggregate data: ${o instanceof Error?o.message:String(o)}`,void 0,o)}}async function Bh(e){const a=`${$n}/health`;try{return(await fetch(a,{method:"GET",signal:AbortSignal.timeout(5e3)})).ok}catch{return!1}}let nn=null,di=0,ui=1,Un="",On="",hi=!1;function fi(){return nn||(nn=document.createElement("div"),nn.className="map-tooltip",document.body.appendChild(nn)),nn}function Vh(e,t,a,r,o,i,s){const l=fi();let c=o,d=i;On&&Un&&(c=qt(o,Un,On,{isDifference:s??hi}),d=li(Un,On)||i),l.textContent=`Lat: ${a.toFixed(2)}, Lon: ${r.toFixed(2)}, Value: ${c.toFixed(2)} ${d}`,l.style.display="block",l.style.left=`${e+10}px`,l.style.top=`${t+10}px`,Ih(c,di,ui)}function sn(){const e=fi();e.style.display="none",Ah()}function Uh(e,t,a,r,o){di=e,ui=t,a!==void 0&&(Un=a),r!==void 0&&(On=r),o!==void 0&&(hi=o)}let te=ma,ln=null,fe=null,pi=null,mi=!1,ia=null,gi,yi,cn=!1,Ga=null,Qa=null;function vi(){return te.k}function Oh(e){const t=e.getContext("2d");if(!t)return null;const a=e.getBoundingClientRect();return e.width=a.width*window.devicePixelRatio,e.height=a.height*window.devicePixelRatio,t.scale(window.devicePixelRatio,window.devicePixelRatio),{ctx:t,rect:a,viewWidth:a.width,viewHeight:a.height}}function qh(e,t,a,r){const o=e*a+a/2,i=o>180?o-360:o,s=90-(t*r+r/2);return[i,s]}function zh(e,t,a,r,o){if(e<0||e>=a||t<0||t>=r)return null;const s=(r-1-t)*a+e,l=o[s];return isFinite(l)?l:null}function Pa(e){cn?e.style.cursor="crosshair":e.style.cursor="auto"}function oo(e,t,a){if(!fe)return null;const r=e.getBoundingClientRect(),o=t-r.left,i=a-r.top;let s=(o-te.x)/te.k;const l=(i-te.y)/te.k,c=fe.width,d=fe.height;if(l<0||l>d)return null;let u=s;u=u%c,u<0&&(u+=c),u<0&&(u=0),u>=c&&(u=c*(1-Number.EPSILON));const h=u/c*360-180,f=90-l/d*150,p=Math.max(-180,Math.min(180,h)),x=Math.max(-90,Math.min(90,f));return!Number.isFinite(p)||!Number.isFinite(x)?null:{lat:x,lon:p}}function Hh(e,t){cn=e,Ga=e?t??null:null}function qn(e,t,a){if(!fe)return null;const r=fe.width,o=fe.height;let i=t;for(;i>180;)i-=360;for(;i<-180;)i+=360;const s=(i+180)/360*r,l=(90-a)/150*o,c=s*te.k+te.x,d=l*te.k+te.y,u=e.getBoundingClientRect(),h=r*te.k,f=u.width/2;let p=c,x=Math.abs(c-f);for(let k=-h;k<=h;k+=h){const $=c+k,w=Math.abs($-f);w<x&&(x=w,p=$)}return d<-o*te.k||d>u.height+o*te.k?null:{x:p,y:d}}function Wh(e,t,a,r,o,i){Hh(i?.drawMode??!1,{onClick:i?.onDrawClick,onMove:i?.onDrawMove}),Qa=i?.onTransform??null,Pa(e);const s=tt(e);ln=ch().scaleExtent([.8,10]).filter(l=>cn?!1:!l.ctrlKey&&!l.button).on("zoom",l=>{te=l.transform,(fe||t)&&io(e),Qa?.()}).on("start",()=>{e.style.cursor="grabbing",sn()}).on("end",()=>{Pa(e)}),s.call(ln),s.call(ln.transform,te),s.on("click.draw",l=>{const c=oo(e,l.clientX,l.clientY);if(c){if(cn){Ga?.onClick?.(c);return}i?.onMapClick?.(c)}}),s.on("pointermove.tooltip",l=>{if(cn){const c=oo(e,l.clientX,l.clientY);c&&Ga?.onMove?.(c),sn();return}if(l.buttons===0&&pi&&ia&&fe){const[c,d]=ut(l,e);Xh(l.clientX,l.clientY,c,d,a,gi,yi,mi)}}),s.on("pointerleave",()=>{sn()}),Pa(e)}function io(e){if(!fe)return;const t=e.getContext("2d");if(!t)return;const a=e.getBoundingClientRect();t.clearRect(0,0,a.width,a.height),t.save(),t.translate(te.x,te.y),t.scale(te.k,te.k),t.imageSmoothingEnabled=!1;const r=fe.width,o=-te.x/te.k,i=(a.width-te.x)/te.k,s=Math.floor(o/r)-1,l=Math.ceil(i/r)+1;for(let c=s;c<=l;c++)t.drawImage(fe,c*r,0);t.restore()}function zn(e,t,a,r,o,i,s,l,c,d,u,h){if(t)try{Yh(e,t,a,r,o,i,s,l,c,d,u,h)}catch(f){console.error("renderMapData failed (e.g. when changing display variable with masks):",f)}}function Yh(e,t,a,r,o,i,s,l,c,d,u,h){const f=Se(e);if(!f){console.warn("No data to render");return}const p=Oh(t);if(!p)return;const{ctx:x,rect:k,viewWidth:$,viewHeight:w}=p,[b,L]=e.shape;x.clearRect(0,0,k.width,k.height),x.save();const E=!!e?.metadata?.comparison||typeof e.model=="string"&&e.model.includes(" minus ");pi=e,gi=s,yi=l,mi=E;const T=new Array(w).fill(null).map(()=>new Float32Array($).fill(NaN));let S=o,P=i;if(s&&l){const z=ci(o,i,s,l,{isDifference:E});S=z.min,P=z.max}Number.isFinite(S)||(S=0),Number.isFinite(P)||(P=1),P<=S&&(P=S+1),Uh(S,P,s,l,E);const Y=(a.find(z=>z.name===r)||a[0]).colors,W=Y.length>0?Y.map(Xa):[Xa("#808080")];function O(z,K){const Z=(z+180)/360*$,Q=(90-K)/150*w;return[Z,Q]}const j=document.createElement("canvas");j.width=$,j.height=w;const U=j.getContext("2d");if(!U)return;const y=U.createImageData($,w),F=y.data,C=Math.max($/L,w/b),m=Math.ceil(C/2),v=360/L,D=150/b;for(let z=0;z<b;z++)for(let K=0;K<L;K++){const Z=zh(K,z,L,b,f);if(Z===null)continue;const[Q,R]=qh(K,z,v,D),[X,G]=O(Q,R);let N=Z;s&&l&&(N=qt(Z,s,l,{isDifference:E}));let oe=!1;if(c&&c.length>0)if(u&&d){oe=!0;for(const ce of c){const de=!ce.lowerEdited,me=!ce.upperEdited,Ke=ce.statistic||"mean",$e=d.get(Ke);if(!$e)continue;const ke=(b-1-z)*L+K,Re=$e[ke];if(!isFinite(Re)){oe=!1;break}let vt=Re;if(s&&l&&(vt=qt(Re,s,l,{isDifference:Ke!=="mean"||E})),!de&&ce.lowerBound!==null&&vt<ce.lowerBound){oe=!1;break}if(!me&&ce.upperBound!==null&&vt>ce.upperBound){oe=!1;break}}}else{const ce=new Map;for(const de of c){const me=de.variable;me&&(ce.has(me)||ce.set(me,[]),ce.get(me).push(de))}oe=!0;for(const[de,me]of ce){let Ke=!1,$e;if(h&&h.has(de)){const ke=h.get(de),Re=Se(ke),vt=L*b;if(Re&&Re.length===vt){const Gt=(b-1-z)*L+K;if($e=Re[Gt],!isFinite($e)){oe=!1;break}}else{oe=!1;break}}else{oe=!1;break}for(const ke of me){const Re=!ke.lowerEdited,vt=!ke.upperEdited,Gt=ke.unit;let ba=$e;Gt&&(ba=qt($e,de,Gt));let xa=!0;if(!Re&&ke.lowerBound!==null&&ba<ke.lowerBound&&(xa=!1),!vt&&ke.upperBound!==null&&ba>ke.upperBound&&(xa=!1),xa){Ke=!0;break}}if(!Ke){oe=!1;break}}}else oe=!0;let re,be,xe;if(!oe&&c&&c.length>0)re=20,be=24,xe=32;else{const ce=P-S;let de;!Number.isFinite(ce)||ce<=0||!Number.isFinite(N)?de=.5:(de=Math.min(1,Math.max(0,(N-S)/ce)),Number.isFinite(de)||(de=.5));const me=Math.max(0,W.length-1),Ke=Math.min(Math.max(0,Math.floor(de*me)),me),$e=W[Ke],ke=W[Math.min(Ke+1,me)]??$e,Re=Math.max(0,Math.min(1,de*me-Ke));re=Math.round($e.r+(ke.r-$e.r)*Re),be=Math.round($e.g+(ke.g-$e.g)*Re),xe=Math.round($e.b+(ke.b-$e.b)*Re)}const je=Math.max(0,Math.floor(X-m)),kn=Math.min($,Math.ceil(X+m)),Pi=Math.max(0,Math.floor(G-m)),Ii=Math.min(w,Math.ceil(G+m));for(let ce=Pi;ce<Ii;ce++)for(let de=je;de<kn;de++){const me=(ce*$+de)*4;F[me]=re,F[me+1]=be,F[me+2]=xe,F[me+3]=255,T[ce][de]=Z}}U.putImageData(y,0,0),fe=j,ia=T,x.clearRect(0,0,k.width,k.height),x.save(),x.translate(te.x,te.y),x.scale(te.k,te.k),x.imageSmoothingEnabled=!1;const A=fe.width,B=-te.x/te.k,I=(k.width-te.x)/te.k,_=Math.floor(B/A)-1,V=Math.ceil(I/A)+1;for(let z=_;z<=V;z++)x.drawImage(fe,z*A,0);x.restore()}function bi(e,t,a,r=3.2,o=550){if(!fe||!ln)return;const i=e.getBoundingClientRect(),s=fe.width,l=fe.height;let c=t;for(;c>180;)c-=360;for(;c<-180;)c+=360;const d=(c+180)/360*s,u=(90-a)/150*l,h=[d-s,d,d+s];let f=i.width/2-d*r,p=Math.abs(f-te.x);for(const $ of h){const w=i.width/2-$*r,b=Math.abs(w-te.x);b<p&&(p=b,f=w)}const x=i.height/2-u*r,k=ma.translate(f,x).scale(r);tt(e).transition().duration(o).ease(fd).call(ln.transform,k),te=k,Qa?.()}function Xh(e,t,a,r,o,i,s,l){if(!ia||!fe)return;let c=(a-te.x)/te.k;const d=(r-te.y)/te.k,u=fe.width,h=fe.height;c=(c%u+u)%u;const f=Math.floor(c),p=Math.floor(d);if(f>=0&&f<u&&p>=0&&p<h){const x=ia?.[p]?.[f]??0;if(isFinite(x)){const k=c/u*360-180,$=90-d/h*150;Vh(e,t,$,k,x,o,l)}else sn()}else sn()}function ht(e){const t=new Date(e);return`${["January","February","March","April","May","June","July","August","September","October","November","December"][t.getMonth()]} ${t.getDate()}, ${t.getFullYear()}`}function jh(e){const{date:t,timeRange:a,sidebarOpen:r,sidebarWidth:o,mode:i,compareMode:s,compareDateStart:l,compareDateEnd:c}=e;let d=0,u=0,h=0,f=0,p=0,x=0,k=0,$=100;if(a){const b=new Date(a.start),L=new Date(a.end),E=new Date(t);if(u=Math.floor((L.getTime()-b.getTime())/(1e3*60*60*24)),h=Math.floor((E.getTime()-b.getTime())/(1e3*60*60*24)),f=u>0?h/u*100:0,i==="Compare"&&s==="Dates"){const T=l?new Date(l):b,S=c?new Date(c):L;p=Math.max(0,Math.floor((T.getTime()-b.getTime())/(1e3*60*60*24))),x=Math.min(u,Math.floor((S.getTime()-b.getTime())/(1e3*60*60*24))),k=u>0?p/u*100:0,$=u>0?x/u*100:100}}const w=r?o+16:16;if(i==="Compare"&&s==="Dates"&&a){const b=ht(l||a.start),L=ht(c||a.end);return`
      <div class="time-slider-container" style="right: ${w}px">
        <div data-role="time-label" class="time-label">${b} – ${L}</div>
        <div class="time-slider-row dual-slider" data-role="dual-slider">
          <div
            class="dual-slider-track"
            aria-hidden="true"
          ></div>
          <div
            class="dual-slider-fill"
            data-role="dual-fill"
            style="--fill-start: ${k}%; --fill-end: ${$}%"
            aria-hidden="true"
          ></div>
          <input
            type="range"
            min="${d}"
            max="${u}"
            step="1"
            value="${p}"
            data-action="set-time-start"
            class="time-slider dual-thumb dual-thumb-start"
            aria-label="Start date"
          />
          <input
            type="range"
            min="${d}"
            max="${u}"
            step="1"
            value="${x}"
            data-action="set-time-end"
            class="time-slider dual-thumb dual-thumb-end"
            aria-label="End date"
          />
        </div>
      </div>
    `}return`
      <div class="time-slider-container" data-role="time-slider" style="right: ${w}px">
        <div data-role="time-label" class="time-label">${ht(t)}</div>
        <div class="time-slider-row">
          <input
            type="range"
            min="${d}"
            max="${u}"
            step="1"
            value="${h}"
            data-action="set-time"
            class="time-slider"
            style="--slider-fill: ${f}%"
          />
        </div>
      </div>
    `}let Nt=null,Za=null;function Kh(e){const{root:t,getTimeRange:a,onDateChange:r,getMode:o,getCompareMode:i,getCompareDates:s,onDateRangeChange:l}=e;Za=t.querySelector('[data-role="time-label"]')?.parentElement??null;const c=()=>o?.()==="Compare"&&i?.()==="Dates";t.querySelectorAll('[data-action="set-time"]').forEach($=>$.addEventListener("input",()=>{if(c())return;const w=Number.parseInt($.value,10),b=a();if(!Number.isNaN(w)&&b){const L=new Date(b.start);L.setDate(L.getDate()+w);const E=L.toISOString().split("T")[0],T=t.querySelector('[data-role="time-label"]');T&&(T.textContent=ht(E));const S=new Date(b.end),P=Math.floor((S.getTime()-new Date(b.start).getTime())/(1e3*60*60*24)),q=P>0?w/P*100:0;$.style.setProperty("--slider-fill",`${q}%`),Nt&&window.clearTimeout(Nt),Nt=window.setTimeout(()=>{r(E)},500)}}));const u=t.querySelectorAll('[data-action="set-time-start"]'),h=t.querySelectorAll('[data-action="set-time-end"]'),f=t.querySelector('[data-role="dual-fill"]'),p=($,w,b,L,E)=>{const T=t.querySelector('[data-role="time-label"]'),S=new Date(b.start),P=new Date(b.start);S.setDate(S.getDate()+$),P.setDate(P.getDate()+w);const q=S.toISOString().split("T")[0],Y=P.toISOString().split("T")[0];T&&(T.textContent=`${ht(q)} – ${ht(Y)}`);const W=new Date(b.end).getTime()-new Date(b.start).getTime(),O=Math.max(1,Math.floor(W/(1e3*60*60*24))),j=$/O*100,U=w/O*100;[f,L,E].forEach(F=>{F&&(F.style.setProperty("--fill-start",`${j}%`),F.style.setProperty("--fill-end",`${U}%`))})},x=($,w,b)=>{$.addEventListener("input",()=>{if(!c())return;const L=a();if(!L)return;const E=Math.floor((new Date(L.end).getTime()-new Date(L.start).getTime())/(1e3*60*60*24));let T=Number.parseInt(b?$.value:w.value,10),S=Number.parseInt(b?w.value:$.value,10);if(Number.isNaN(T)||Number.isNaN(S))return;T=Math.max(0,Math.min(T,E)),S=Math.max(0,Math.min(S,E)),b&&T>S?(S=T,w.value=String(S)):!b&&S<T&&(T=S,w.value=String(T)),p(T,S,L,b?$:w,b?w:$);const P=new Date(L.start);P.setDate(P.getDate()+T);const q=new Date(L.start);q.setDate(q.getDate()+S);const Y=P.toISOString().split("T")[0],W=q.toISOString().split("T")[0];Nt&&window.clearTimeout(Nt),Nt=window.setTimeout(()=>{l?.(Y,W)},300)})},k=$=>{const w=u[0],b=h[0];!w||!b||($==="start"?(w.style.zIndex="4",b.style.zIndex="3"):(w.style.zIndex="3",b.style.zIndex="4"))};if(u.length&&h.length){u.forEach((b,L)=>{const E=h[L]||h[0];x(b,E,!0),b.addEventListener("pointerdown",()=>k("start"))}),h.forEach((b,L)=>{const E=u[L]||u[0];x(b,E,!1),b.addEventListener("pointerdown",()=>k("end"))}),u.forEach(b=>b.addEventListener("focus",()=>k("start"))),h.forEach(b=>b.addEventListener("focus",()=>k("end")));const $=(b,L)=>{b.addEventListener("pointerdown",E=>{if(!c())return;const T=a();if(!T)return;const S=b.getBoundingClientRect(),P=Math.min(1,Math.max(0,(E.clientX-S.left)/S.width)),q=Math.max(1,Math.floor((new Date(T.end).getTime()-new Date(T.start).getTime())/(1e3*60*60*24))),Y=Number.parseInt(b.value,10),O=(Number.isNaN(Y)?0:Math.max(0,Math.min(Y,q)))/q;Math.abs(P-O)*S.width>14&&(E.preventDefault(),E.stopPropagation(),k(b===L?"end":"start"))})};if($(u[0],h[0]),$(h[0],u[0]),c()){const b=a(),L=s?.();if(b&&L){const E=Math.max(0,Math.floor((new Date(L.start).getTime()-new Date(b.start).getTime())/864e5)),T=Math.max(0,Math.floor((new Date(L.end).getTime()-new Date(b.start).getTime())/(1e3*60*60*24))),S=u[0],P=h[0];S.value=String(E),P.value=String(Math.max(T,E)),p(E,Math.max(T,E),b,S,P)}}t.querySelectorAll(".dual-slider").forEach(b=>{b.addEventListener("pointermove",L=>{if(!c())return;const E=a();if(!E)return;const T=u[0],S=h[0];if(!T||!S)return;const P=b.getBoundingClientRect(),q=Math.min(1,Math.max(0,(L.clientX-P.left)/P.width)),Y=Math.max(1,Math.floor((new Date(E.end).getTime()-new Date(E.start).getTime())/(1e3*60*60*24)));let W=Number.parseInt(T.value,10),O=Number.parseInt(S.value,10);Number.isNaN(W)&&(W=0),Number.isNaN(O)&&(O=Y);const j=W/Y,U=O/Y,y=Math.abs(q-j)<=Math.abs(q-U);k(y?"start":"end")})})}}function Gh(e,t){if(Za){const a=e?t+16:16;Za.style.right=`${a}px`}}const Qh=!1;function xi(e,t){document.querySelectorAll("[data-role='chart-container']").forEach(r=>{r.style.transition="padding 220ms ease, padding-right 220ms ease, transform 220ms ease",r.style.paddingRight=`${e}px`,typeof t=="number"&&(r.style.transform=`scale(${t})`,r.style.transformOrigin="center center")})}function _t(e){const t=e.toLowerCase();return t==="historical"?"Historical":t==="ssp245"?"SSP245":t==="ssp370"?"SSP370":t==="ssp585"?"SSP585":e}function Zh(e){const t=e.toLowerCase();return t==="viridis"?"Viridis":t==="magma"?"Magma":t==="cividis"?"Cividis":t==="thermal"?"Thermal":e}function J(e){return new Date(e)}function Kt(e){if(!e.length)return Ue("Historical");let t="1900-01-01",a="2100-12-31";return e.forEach((r,o)=>{const i=Ue(r);if(o===0){t=i.start,a=i.end;return}t=J(i.start)>J(t)?i.start:t,a=J(i.end)<J(a)?i.end:a}),{start:t,end:a}}function Te(e,t){const a=J(e),r=J(t.start),o=J(t.end);return a<r?t.start:a>o?t.end:e}const Me=["Historical","SSP245","SSP370","SSP585"],ge=["ACCESS-CM2","CanESM5","CESM2","CMCC-CM2-SR5","EC-Earth3","GFDL-ESM4","INM-CM5-0","IPSL-CM6A-LR","MIROC6","MPI-ESM1-2-HR","MRI-ESM2-0"],Le=["tas","pr","rsds","hurs","rlds","sfcWind","tasmin","tasmax"],Jh={SSP245:"A moderate scenario (2015-2100) that assumes we take active measures against climate change. This represents a realistic path where significant climate protection policies are implemented, leading to moderate warming by the end of the century.",SSP370:"A moderate-to-high scenario (2015-2100) representing a middle ground. This path assumes some climate action is taken, but not enough to prevent substantial warming. It falls between optimistic and pessimistic outcomes.",SSP585:"A pessimistic scenario (2015-2100) representing a worst-case path with minimal climate action. This shows what happens if we continue with current trends and take little to no measures against climate change, leading to severe warming.",Historical:"Historical climate simulation (1950-2014) based on past conditions. This represents simulated climate data for the historical period, used as a baseline to compare against future projections."},ef={tas:"Near-Surface Air Temperature",pr:"Precipitation",rsds:"Surface Downwelling Shortwave Radiation",hurs:"Near-Surface Relative Humidity",rlds:"Surface Downwelling Longwave Radiation",sfcWind:"Daily-Mean Near-Surface Wind Speed",tasmin:"Daily Minimum Near-Surface Air Temperature",tasmax:"Daily Maximum Near-Surface Air Temperature"},tf={tas:"The air temperature near the Earth's surface, measured in Kelvin.",pr:"The amount of water that falls from the atmosphere to the surface, measured as mass per unit area per unit time.",rsds:"Incoming solar radiation reaching the Earth's surface, measured in Watts per square meter.",hurs:"The amount of moisture in the air relative to the maximum it can hold, expressed as a percentage.",rlds:"Incoming thermal radiation from the atmosphere, measured in Watts per square meter.",sfcWind:"The average wind speed near the surface over a day, measured in meters per second.",tasmin:"The lowest air temperature near the surface during a day, measured in Kelvin.",tasmax:"The highest air temperature near the surface during a day, measured in Kelvin."},nf={"ACCESS-CM2":"Developed by Australia's research institutions. This model is part of the global CMIP6 ensemble, providing climate projections that contribute to our understanding of future climate patterns.",CanESM5:"The Canadian Earth System Model version 5, developed by Environment and Climate Change Canada. This model represents North American climate research and contributes valuable projections to the global climate science community.",CESM2:"The Community Earth System Model version 2, developed by the National Center for Atmospheric Research (NCAR) in the United States. One of the most widely used models in climate research, known for its comprehensive representation of Earth's climate system.","CMCC-CM2-SR5":"Developed by the Euro-Mediterranean Center on Climate Change (CMCC) in Italy. This model provides European perspectives on climate change and is particularly valuable for understanding Mediterranean and European climate patterns.","EC-Earth3":"A collaborative European climate model developed by multiple research institutions across Europe. This model combines expertise from various European countries to provide comprehensive climate projections.","GFDL-ESM4":"Developed by NOAA's Geophysical Fluid Dynamics Laboratory in the United States. This model is known for its advanced representation of ocean and atmosphere interactions, providing detailed climate projections.","INM-CM5-0":"Developed by the Institute of Numerical Mathematics in Russia. This model contributes a unique perspective from Russian climate research to the global ensemble of climate models.","IPSL-CM6A-LR":"Developed by the Institut Pierre-Simon Laplace in France. This model is part of a long-standing French climate modeling tradition and provides important contributions to understanding global climate dynamics.",MIROC6:"Developed by a Japanese research consortium. This model represents Asian climate research expertise and contributes valuable insights, particularly for understanding climate patterns in the Asia-Pacific region.","MPI-ESM1-2-HR":"Developed by the Max Planck Institute in Germany. This high-resolution model provides detailed climate projections and is known for its sophisticated representation of Earth's climate system.","MRI-ESM2-0":"Developed by Japan's Meteorological Research Institute. This model contributes Japanese climate research expertise to the global ensemble, providing valuable perspectives on climate change projections."},le=[{name:"Viridis",colors:["#440154","#3b528b","#21908d","#5dc863","#fde725"]},{name:"Magma",colors:["#000004","#3b0f70","#8c2981","#de4968","#fe9f6d"]},{name:"Cividis",colors:["#00204c","#31456a","#6b6d7f","#a59c8f","#fdea9b"]},{name:"Thermal",colors:["#04142f","#155570","#1fa187","#f8c932","#f16623"]}],M={page:{position:"relative",minHeight:"100vh",color:"white",overflow:"hidden",fontFamily:"Inter, system-ui, sans-serif"},bgLayer1:{position:"absolute",inset:0,background:"linear-gradient(135deg, #05070f, #0b1326)"},bgLayer2:{position:"absolute",inset:0,background:"radial-gradient(circle at 20% 20%, rgba(56,189,248,0.12), transparent 32%), radial-gradient(circle at 80% 10%, rgba(139,92,246,0.15), transparent 30%), radial-gradient(circle at 50% 70%, rgba(34,197,94,0.08), transparent 28%)"},bgOverlay:{position:"absolute",inset:0,background:"#050505",opacity:.35},branding:{position:"fixed",top:16,left:16,display:"flex",alignItems:"center",gap:12,padding:"8px 0",background:"transparent",border:"none",borderRadius:0,zIndex:"9999",boxShadow:"none",backdropFilter:"none",pointerEvents:"auto"},brandIcon:{width:38,height:38,position:"relative",display:"grid",placeItems:"center",filter:"drop-shadow(0 8px 18px rgba(0, 0, 0, 0.42))",transition:"transform 160ms ease, filter 160ms ease","--iris-x":"0px","--iris-y":"0px","--pupil-x":"0px","--pupil-y":"0px","--blink-open":"1"},brandSvg:{width:"100%",height:"100%",display:"block"},brandOutline:{stroke:"white",strokeWidth:5,strokeLinecap:"round",strokeLinejoin:"round",fill:"none",opacity:.92},brandLids:{transform:"translate(60px, 40px) scaleY(var(--blink-open, 1)) translate(-60px, -40px)",transformOrigin:"60px 40px",transition:"none"},brandClipRect:{transform:"translate(60px, 40px) scaleY(var(--blink-open, 1)) translate(-60px, -40px)",transformOrigin:"60px 40px",transition:"none"},brandIrisGroup:{transform:"translate(var(--iris-x, 0px), var(--iris-y, 0px))",transition:"none",transformBox:"fill-box",transformOrigin:"center center"},brandIris:{stroke:"white",strokeWidth:5,fill:"rgba(255, 255, 255, 0.08)"},brandPupilGroup:{transform:"translate(var(--pupil-x, 0px), var(--pupil-y, 0px))",transition:"none",transformOrigin:"center center"},brandEyeContent:{clipPath:"url(#brand-eye-clip)"},brandPupil:{fill:"white"},brandHighlight:{fill:"white",opacity:.92},brandName:{fontSize:18,fontWeight:700,letterSpacing:.6,color:"white",textTransform:"none",textShadow:"0 8px 20px rgba(0, 0, 0, 0.45)"},field:{minWidth:0,display:"flex",flexDirection:"column",gap:4},fieldLabel:{fontSize:11,letterSpacing:.5,color:"var(--text-secondary)",textTransform:"uppercase"},mapArea:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:10,textAlign:"center",pointerEvents:"none",zIndex:1},mapSearchWrap:{position:"absolute",top:18,left:"50%",transform:"translateX(-50%)",width:"min(360px, 70vw)",pointerEvents:"auto",zIndex:12,transition:"transform 220ms ease, width 220ms ease"},mapSearchResults:{maxHeight:220,overflowY:"auto"},mapMarker:{position:"absolute",left:0,top:0,width:28,height:36,pointerEvents:"none",zIndex:11,transform:"translate(-9999px, -9999px)",opacity:0,transition:"opacity 160ms ease",filter:"drop-shadow(0 10px 18px rgba(0,0,0,0.45))"},mapInfoPanel:{position:"absolute",left:0,top:0,width:360,maxWidth:"min(360px, 80vw)",opacity:0,userSelect:"none",transform:"translate(-9999px, -9999px)",transition:"opacity 160ms ease",zIndex:12},mapInfoHeader:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:8},mapInfoTitleGroup:{display:"flex",flexDirection:"column",gap:2,flex:1,minWidth:0},mapInfoActions:{display:"flex",gap:6,alignItems:"center"},mapInfoActionBtn:{width:30,height:30,borderRadius:8,border:"none",background:"transparent",color:"var(--text-secondary)",display:"inline-flex",alignItems:"center",justifyContent:"center",cursor:"pointer",pointerEvents:"auto",transition:"all 120ms ease"},mapInfoExpandBtn:{position:"absolute",right:12,bottom:12},mapInfoSubtitle:{fontSize:11.5,color:"var(--text-secondary)",marginTop:2},mapInfoBody:{marginTop:10,display:"flex",flexDirection:"column",gap:10,paddingBottom:36},mapInfoLoadingRow:{display:"flex",alignItems:"center",gap:8,fontSize:11,color:"var(--text-secondary)"},mapInfoLoadingSpinner:{width:14,height:14,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.18)",borderTop:"2px solid #34d399",animation:"sv-spin 1s linear infinite",flexShrink:0},drawOverlay:{position:"absolute",inset:0,background:"rgba(5, 10, 20, 0.28)",backdropFilter:"blur(1px)",pointerEvents:"none",zIndex:8},drawOverlayCanvas:{position:"absolute",inset:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:9},drawPrompt:{position:"absolute",top:16,left:"50%",transform:"translateX(-50%)",padding:"10px 14px",borderRadius:12,background:"rgba(15, 23, 42, 0.92)",border:"1px solid var(--border-medium)",boxShadow:"var(--shadow-elevated)",fontWeight:800,fontSize:13,color:"var(--text-primary)",pointerEvents:"none",zIndex:10,textAlign:"center"},drawPromptSub:{marginTop:4,fontSize:12,fontWeight:600,color:"var(--text-secondary)"},loadingIndicator:{position:"absolute",left:18,bottom:80,display:"flex",alignItems:"center",gap:12,padding:0,pointerEvents:"auto",zIndex:20,minWidth:160},loadingSpinner:{width:18,height:18,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.18)",borderTop:"2px solid #34d399",animation:"sv-spin 1s linear infinite",flexShrink:0},loadingTextGroup:{display:"flex",flexDirection:"column",gap:4,alignItems:"flex-start",minWidth:0},loadingText:{fontSize:12.5,fontWeight:700,color:"var(--text-primary)",letterSpacing:.3},loadingSubtext:{fontSize:11.5,color:"var(--text-secondary)",letterSpacing:.2},loadingBar:{position:"relative",width:120,height:6,borderRadius:999,background:"rgba(255, 255, 255, 0.08)",overflow:"hidden"},loadingBarFill:{position:"absolute",inset:0,borderRadius:999,background:"linear-gradient(90deg, rgba(52, 211, 153, 0.9), rgba(125, 211, 252, 0.9))",transition:"width 140ms ease",width:"0%"},compareInfoWrap:{position:"fixed",right:24,bottom:88,display:"flex",alignItems:"center",pointerEvents:"auto",zIndex:1e4},compareInfoButton:{padding:0,background:"transparent",border:"none",color:"var(--text-primary)",fontWeight:700,fontSize:13,letterSpacing:.2,cursor:"pointer",textDecoration:"underline"},infoModalOverlay:{position:"fixed",inset:0,background:"transparent",backdropFilter:"none",zIndex:200,display:"flex",alignItems:"center",justifyContent:"center",padding:16},infoModal:{width:"min(480px, 92vw)",background:"rgba(12, 16, 24, 0.98)",border:"1px solid var(--border-default)",borderRadius:14,boxShadow:"var(--shadow-elevated)",color:"var(--text-primary)",padding:20,position:"relative",maxWidth:"520px"},infoModalHeader:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,marginBottom:12},infoModalTitle:{fontSize:16,fontWeight:900,letterSpacing:.2,background:"var(--gradient-accent)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",color:"transparent"},infoModalClose:{width:32,height:32,borderRadius:8,border:"none",background:"transparent",color:"var(--text-secondary)",cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",fontWeight:700},infoModalBody:{fontSize:14,lineHeight:1.6,color:"var(--text-primary)",display:"block",textAlign:"left",whiteSpace:"normal",wordBreak:"break-word"},infoModalFooter:{marginTop:18,display:"flex",justifyContent:"center"},infoModalConfirm:{padding:"10px 16px",borderRadius:10,border:"1px solid var(--accent-border)",background:"var(--gradient-primary)",color:"white",fontWeight:700,cursor:"pointer",boxShadow:"var(--shadow-combined)"},canvasToggle:{position:"fixed",top:14,display:"flex",alignItems:"center",gap:8,pointerEvents:"auto",zIndex:100,transition:"right 0.25s ease"},canvasSwitch:{position:"relative",display:"grid",gridTemplateColumns:"1fr 1fr",gap:0,padding:3,borderRadius:11,background:"var(--dark-bg)",border:"var(--border-base)",boxShadow:"var(--shadow-elevated)",zIndex:101},canvasIndicator:{position:"absolute",top:3,bottom:3,left:3,width:"calc(50% - 3px)",borderRadius:9,background:"var(--gradient-indicator)",boxShadow:"var(--shadow-canvas), var(--shadow-inset)",transition:"transform 180ms ease",zIndex:0,pointerEvents:"none"},canvasBtn:{width:40,height:40,borderRadius:9,border:"1px solid transparent",background:"var(--bg-transparent)",color:"var(--text-secondary)",cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",transition:"color 120ms ease",position:"relative",zIndex:1},canvasBtnActive:{color:"white"},mapTitle:{fontSize:18,fontWeight:600},mapSubtitle:{fontSize:14,color:"var(--text-secondary)"},modeSwitch:{position:"relative",display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:4,padding:2,borderRadius:10,border:"1px solid var(--border-subtle)",background:"var(--bg-subtle)",boxShadow:"none"},modeIndicator:{position:"absolute",top:2,bottom:2,left:2,width:"calc(33.333% - 2px)",borderRadius:8,background:"var(--gradient-mode-indicator)",boxShadow:"var(--shadow-combined)",transition:"transform 200ms ease",zIndex:0},modeBtn:{flex:1,padding:"8px 0",borderRadius:8,border:"none",color:"var(--text-secondary)",cursor:"pointer",transition:"all 0.15s ease",background:"var(--bg-transparent)",textAlign:"center",fontSize:12.5,fontWeight:700,letterSpacing:.2,outline:"none",boxShadow:"none",position:"relative",zIndex:1},modeBtnActive:{background:"var(--gradient-primary)",border:"none",color:"white",boxShadow:"var(--shadow-combined)"},tabSwitch:{position:"absolute",left:32,right:12,bottom:-8,display:"flex",gap:10,padding:"0 8px",alignItems:"flex-end",pointerEvents:"auto",zIndex:0},tabBtn:{borderRadius:"14px 14px 0 0",padding:"12px 18px",background:"var(--bg-strong)",color:"var(--text-secondary)",fontWeight:700,fontSize:13,letterSpacing:.35,cursor:"pointer",transition:"all 0.18s ease",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.06), 0 8px 18px rgba(0,0,0,0.32)",borderTop:"var(--border-base)",borderRight:"var(--border-base)",borderLeft:"var(--border-base)",borderBottom:"none",transform:"translateY(4px)"},tabBtnActive:{background:"var(--gradient-tab-active)",color:"white",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.12), 0 12px 26px rgba(0,0,0,0.42)",borderTop:"var(--border-active)",borderRight:"var(--border-active)",borderLeft:"var(--border-active)",borderBottom:"none",transform:"translateY(-4px)",zIndex:1},modeViewport:{overflow:"hidden",width:"100%",position:"relative",flex:1,minHeight:0,height:0},modeTrack:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",width:"300%",height:"100%",transition:"transform 220ms ease"},modePane:{width:"100%",height:"100%",paddingRight:4,overflowY:"auto",overflowX:"hidden",scrollbarGutter:"stable",minHeight:0,maxHeight:"100%"},sectionTitle:{fontSize:13,fontWeight:700,color:"var(--text-primary)",letterSpacing:.3,textTransform:"uppercase"},paramGrid:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},range:{width:"100%",background:"var(--bg-transparent)",appearance:"none",WebkitAppearance:"none",height:10,outline:"none",padding:0,margin:0},resolutionRow:{display:"flex",alignItems:"center",gap:12},resolutionValue:{fontSize:12.5,color:"var(--text-secondary)",minWidth:60,textAlign:"right"},chartPanel:{width:"min(1200px, 100%)",background:"transparent",border:"none",borderRadius:0,padding:0,boxShadow:"none",backdropFilter:"none"},chartHeader:{textAlign:"center",marginBottom:12},chartTitle:{fontSize:18,fontWeight:800,color:"var(--text-primary)"},chartPlotWrapper:{width:"100%",minHeight:360,background:"transparent",border:"none",borderRadius:0,padding:0,position:"relative"},chartEmpty:{textAlign:"center",color:"var(--text-secondary)",padding:"40px 16px",lineHeight:1.6},chartError:{color:"#fca5a5",background:"rgba(248,113,113,0.08)",border:"1px solid rgba(248,113,113,0.35)",borderRadius:12,padding:14,fontSize:13,lineHeight:1.5},chipRow:{display:"flex",flexWrap:"wrap",gap:8},chip:{padding:"8px 10px",borderRadius:12,border:"1px solid var(--border-medium)",background:"rgba(255,255,255,0.04)",color:"var(--text-primary)",cursor:"pointer",fontSize:12.5,fontWeight:700,letterSpacing:.2,transition:"all 140ms ease"},chipActive:{borderColor:"rgba(167,139,250,0.65)",background:"rgba(167,139,250,0.16)",boxShadow:"0 0 0 1px rgba(167,139,250,0.35)"},chartLegend:{display:"flex",gap:12,flexWrap:"wrap",alignItems:"center",marginTop:10,fontSize:12,color:"var(--text-secondary)"}},n={mode:"Explore",panelTab:"Manual",sidebarOpen:!0,canvasView:"map",scenario:Me[0],model:ge[0],variable:Le[0],date:"2000-01-01",palette:le[0].name,resolution:2,selectedUnit:ze(Le[0]).label,chartMode:"single",chartDate:"2026-01-16",chartRangeStart:"2015-01-01",chartRangeEnd:"2099-01-01",chartVariable:Le[0],chartUnit:ze(Le[0]).label,chartScenarios:["SSP245","SSP370","SSP585"],chartModels:[...ge],chartDropdown:{scenariosOpen:!1,modelsOpen:!1},chartLoadingProgress:{total:0,done:0},chartSamples:[],chartBoxes:null,chartRangeSeries:null,chartLoading:!1,chartError:null,chartLocation:"World",chartLocationName:null,chartLocationSearchQuery:"",chartLocationSearchResults:[],chartLocationSearchLoading:!1,chartLocationSearchError:null,mapLocationSearchQuery:"",mapLocationSearchResults:[],mapLocationSearchLoading:!1,mapLocationSearchError:null,mapLocationSearchSelection:null,mapLocationSearchFocused:!1,mapLocationSearchCursor:{start:0,end:0},mapMarker:null,mapInfoSamples:[],mapInfoBoxes:null,mapInfoLoading:!1,mapInfoError:null,mapInfoLoadingProgress:{total:0,done:0},mapInfoOpen:!1,mapPolygon:null,chartPolygon:null,chartPoint:null,drawState:{active:!1,points:[],previewPoint:null},pointSelectActive:!1,chatInput:"",chatMessages:[],chatIsLoading:!1,compareMode:"Scenarios",availableModels:[],compareScenarioA:"SSP245",compareScenarioB:"SSP585",compareModelA:ge[0],compareModelB:ge[1]??ge[0],compareDateStart:"1962-06-28",compareDateEnd:"2007-06-28",masks:[],ensembleScenarios:["SSP245","SSP370","SSP585"],ensembleModels:[...ge],ensembleDropdown:{scenariosOpen:!1,modelsOpen:!1},ensembleStatistic:"mean",ensembleDate:"2000-01-01",ensembleVariable:Le[0],ensembleUnit:ze(Le[0]).label,ensembleStatistics:null,isLoading:!1,loadingProgress:0,dataError:null,currentData:null,apiAvailable:null,dataMin:null,dataMax:null,dataMean:null,timeRange:null,metaData:void 0,compareInfoOpen:!1,maskVariableData:new Map};let we=null,zt=null,ee=null,_n=null,bt=null,dt=null,xt=null,Qe=null,kt=null,Pn=0,Dt=null,In=0,St=0,ft=null;const so=500;function af(e){return e.replace(/[A-Z]/g,t=>`-${t.toLowerCase()}`)}function g(e){return Object.entries(e).filter(([,t])=>t!=null).map(([t,a])=>{const r=t.startsWith("--")?t:af(t),o=typeof a=="number"?`${a}px`:String(a);return`${r}:${o}`}).join(";")}function ye(...e){return e.reduce((t,a)=>a?{...t,...a}:t,{})}function Ce(e){return e.replace(/[&<>"']/g,t=>{switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return t}})}function pt(e){const t=new Date(e);return Number.isNaN(t.getTime())?e:t.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}function ga(e,t){return t?.variable_metadata?.[e]?.name||t?.variable_metadata?.[e]?.description||e}function rf(e){const t=ga(e.variable,e.metaData),a=e.selectedUnit||e.metaData?.variable_metadata?.[e.variable]?.unit||"",r=a?`${a}`:"the dataset's native units";switch(e.compareMode){case"Dates":{const o=pt(e.compareDateStart),i=pt(e.compareDateEnd);return{title:"Comparing two dates",paragraphs:[`We are comparing ${t} on ${o} versus ${i} under the ${e.scenario} scenario using the ${e.model} model.`,`Values on the map represent ${i} minus ${o} in ${r}. A value of X means ${t} was X ${a||""} higher on ${i} than on ${o} (negative values mean it was lower).`]}}case"Models":{const o=pt(e.date);return{title:"Comparing two models",paragraphs:[`We are comparing ${t} between ${e.compareModelB} and ${e.compareModelA} on ${o} within the ${e.scenario} scenario.`,`Each value shows ${e.compareModelB} minus ${e.compareModelA} in ${r}. Positive numbers mean ${t} is higher in ${e.compareModelB}; negative means it is higher in ${e.compareModelA}.`]}}default:{const o=pt(e.date),i=e.compareScenarioA,s=e.compareScenarioB;return{title:"Comparing two scenarios",paragraphs:[`We are comparing ${t} for ${s} versus ${i} on ${o} using the ${e.model} model.`,`Values show ${s} minus ${i} in ${r}. A value of X means ${t} is X ${a||""} higher under ${s} than under ${i}; negative values mean it is lower.`]}}}}function of(e){if(e.mode!=="Compare"||e.canvasView!=="map")return"";const t=rf(e),a=t.paragraphs.map((c,d)=>{const h=d===t.paragraphs.length-1?"0":"0 0 12px 0",f=c.replace(/(\bX\b|ΔX)/g,'<span style="color: var(--accent-purple);">$1</span>');return`<p style="display:block; margin:${h}; line-height:1.6; white-space: normal; word-break: break-word;">${f}</p>`}).join(""),r=e.sidebarOpen?Pe+24:24,o=e.mode==="Compare"&&e.compareMode==="Dates"?120:88,i=ye(M.infoModalOverlay,{left:"0",right:"0",width:"100%",justifyContent:"center",paddingLeft:0}),s=ye(M.infoModal,{alignSelf:"center",marginLeft:"auto",marginRight:"auto"}),l=e.compareInfoOpen?`
      <div data-role="compare-info-overlay" class="compare-info-overlay" style="${g(i)}">
        <div style="${g(s)}" role="dialog" aria-modal="true" aria-label="${t.title}">
          <div style="${g(M.infoModalHeader)}">
            <div style="${g(M.infoModalTitle)}">${t.title}</div>
            <button type="button" data-action="close-compare-info" style="${g(M.infoModalClose)}" aria-label="Close info dialog">✕</button>
          </div>
          <div style="${g(M.infoModalBody)}">
            ${a}
          </div>
          <div style="${g(M.infoModalFooter)}">
            <button type="button" data-action="close-compare-info" style="${g(M.infoModalConfirm)}">Got it</button>
          </div>
        </div>
      </div>
    `:"";return`
      <div data-role="compare-info-trigger" style="${g(ye(M.compareInfoWrap,{right:r,bottom:o}))}">
        <button type="button" data-action="open-compare-info" style="${g(M.compareInfoButton)}">
          What am I seeing?
        </button>
      </div>
      ${l}
    `}async function sf(){try{const e=await Bh();n.apiAvailable=e}catch{n.apiAvailable=!1}}function lf(e){if(e==="Historical")return"2000-01-01";const t=new Date,a=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0");return a<2015?"2015-01-01":a>2100?"2100-12-31":`${a}-${r}-${o}`}function Ue(e){return e==="Historical"?{start:"1950-01-01",end:"2014-12-31"}:{start:"2015-01-01",end:"2099-12-31"}}function mt(e,t){const a=Ue(t),r=new Date(e),o=new Date(a.start),i=new Date(a.end);return r<o?a.start:r>i?a.end:e}function wi(e){let t=1/0,a=-1/0;for(let r=0;r<e.length;r++){const o=e[r];isFinite(o)&&(t=Math.min(t,o),a=Math.max(a,o))}if(!isFinite(t)||!isFinite(a))throw new Error("No valid numeric values returned from dataset.");return{min:t,max:a}}function dn(e,t){let a=0,r=0;for(let o=0;o<e.length;o++){const i=e[o];if(!isFinite(i))continue;const s=t==="hurs"?Math.min(i,100):i;a+=s,r+=1}if(!r)throw new Error("No valid numeric values returned from dataset.");return a/r}function Si(e,t){let a=!1;for(let r=0,o=t.length-1;r<t.length;o=r++){const i=t[r].lon,s=t[r].lat,l=t[o].lon,c=t[o].lat;s>e.lat!=c>e.lat&&e.lon<(l-i)*(e.lat-s)/(c-s+Number.EPSILON)+i&&(a=!a)}return a}function Hn(e,t,a,r){const[o,i]=a,s=360/i,l=150/o;let c=0,d=0;for(let u=0;u<o;u++){const h=90-u*l-l/2;for(let f=0;f<i;f++){const p=f*s+s/2,x=p>180?p-360:p,k=(o-1-u)*i+f,$=e[k];if(!isFinite($))continue;const w=t==="hurs"?Math.min($,100):$;Si({lat:h,lon:x},r)&&(c+=w,d+=1)}}if(!d)throw new Error("The selected region does not contain valid data points.");return c/d}function cf(e,t,a=.75){const r=e.lat-t.lat,o=e.lon-t.lon;return Math.hypot(r,o)<=a}function Wn(e,t,a,r){const[o,i]=a,l=((r.lon+360)%360+360)%360/360*i-.5,c=(90-r.lat)/150*o-.5,d=($,w,b)=>Math.min(b,Math.max(w,$)),u=d(Math.round(l),0,i-1),h=d(Math.round(c),0,o-1),f=($,w)=>(o-1-w)*i+$,p=($,w)=>{const b=($%i+i)%i,L=d(w,0,o-1),E=f(b,L),T=e[E];return Number.isFinite(T)?T:null};let x=p(u,h);if(x===null){let w=null;for(let b=1;b<=3&&w===null;b++)for(let L=-b;L<=b;L++){for(let E=-b;E<=b;E++){if(Math.abs(E)!==b&&Math.abs(L)!==b)continue;const T=p(u+E,h+L);if(T!==null){w=T;break}}if(w!==null)break}x=w}if(x===null)throw new Error("No valid data at the selected point.");const k=t==="hurs"?Math.min(x,100):x;if(!Number.isFinite(k))throw new Error(`Invalid value at point: ${k}`);return k}function yt(){return{active:!1,points:[],previewPoint:null}}function Mi(e){zt||(zt=t=>{t.key==="Enter"&&n.drawState.active&&(t.preventDefault(),e())},window.addEventListener("keydown",zt))}function ya(){zt&&(window.removeEventListener("keydown",zt),zt=null)}function mn(e){const t=n.drawState.active||n.pointSelectActive,a=n.mode==="Ensemble"?n.ensembleVariable:n.variable,r=n.mode==="Ensemble"?n.ensembleUnit:n.selectedUnit,o=n.metaData?.variable_metadata[a]?.unit||"";Wh(e,n.currentData,o,a,r,{drawMode:t,onDrawClick:n.pointSelectActive?kf:$f,onDrawMove:n.drawState.active?Mf:void 0,onMapClick:wf,onTransform:()=>{va(),lo(),sa()}}),lo(),sa()}function va(){if(!ee)return;const e=ee.querySelector("#draw-overlay-canvas"),t=we||ee.querySelector("#map-canvas");if(!e||!t)return;const a=t.getBoundingClientRect(),r=window.devicePixelRatio||1;e.width=a.width*r,e.height=a.height*r,e.style.width=`${a.width}px`,e.style.height=`${a.height}px`;const o=e.getContext("2d");if(!o)return;o.save(),o.scale(r,r),o.clearRect(0,0,a.width,a.height);let i=[];if(n.drawState.active){const l=[...n.drawState.points];i=n.drawState.previewPoint?[...l,n.drawState.previewPoint]:l}else if(n.mapPolygon&&n.mapPolygon.length>=3)i=n.mapPolygon;else{o.restore();return}const s=[];if(i.forEach(l=>{const c=qn(t,l.lon,l.lat);c&&s.push(c)}),!s.length){o.restore();return}o.lineWidth=2,o.strokeStyle="#34d399",o.fillStyle="rgba(52,211,153,0.18)",o.beginPath(),o.moveTo(s[0].x,s[0].y);for(let l=1;l<s.length;l++)o.lineTo(s[l].x,s[l].y);s.length>2&&(o.closePath(),o.fill()),o.stroke(),n.drawState.active&&s.forEach(({x:l,y:c},d)=>{o.beginPath(),o.fillStyle=d===0?"#10b981":"#34d399",o.arc(l,c,4,0,Math.PI*2),o.fill(),o.strokeStyle="#0f172a",o.lineWidth=1,o.stroke()}),o.restore()}function df(){return n.drawState.active||n.mapPolygon!==null&&n.mapPolygon.length>=3?`
      <canvas
        id="draw-overlay-canvas"
        style="${g(M.drawOverlayCanvas)}"
      ></canvas>
    `:""}function lo(){if(!ee)return;const e=ee.querySelector("#point-overlay-marker"),t=we||ee.querySelector("#map-canvas");!e||!t||!n.pointSelectActive||(e.style.left="0px",e.style.top="0px",e.style.right="0px",e.style.bottom="0px",e.style.width="100%",e.style.height="100%")}function sa(){if(!ee)return;const e=ee.querySelector("#map-location-marker"),t=ee.querySelector("#map-info-panel"),a=we||ee.querySelector("#map-canvas");if(!a)return;const r=n.mapPolygon!==null&&n.mapPolygon.length>=3;if(e)if(!n.mapMarker)e.style.opacity="0",e.style.transform="translate(-9999px, -9999px)",e.title="Selected location";else{const o=qn(a,n.mapMarker.lon,n.mapMarker.lat);e.title=n.mapMarker.name?n.mapMarker.name:`Pixel ${n.mapMarker.pixel.x}, ${n.mapMarker.pixel.y}`,o?(e.style.opacity="1",e.style.transform=`translate(${o.x}px, ${o.y}px) translate(-50%, -100%)`):(e.style.opacity="0",e.style.transform="translate(-9999px, -9999px)")}if(t&&n.mapInfoOpen){const o=a.getBoundingClientRect(),i=t.offsetWidth||360,s=t.offsetHeight||240,l=12;let c,d;if(n.mapMarker){const f=qn(a,n.mapMarker.lon,n.mapMarker.lat);if(!f){t.style.opacity="0",t.style.transform="translate(-9999px, -9999px)",t.style.pointerEvents="none",t.style.visibility="hidden";return}c=f.x-i-24,c<l&&(c=f.x+24),d=f.y-s/2}else if(r&&n.mapPolygon){let f=n.mapPolygon[0];for(const x of n.mapPolygon)x.lon<f.lon&&(f=x);const p=qn(a,f.lon,f.lat);p?(c=p.x-i-24,c<l&&(c=p.x+24),d=p.y-s/2):(c=o.width-i-l-24,d=o.height/2-s/2)}else{t.style.opacity="0",t.style.transform="translate(-9999px, -9999px)",t.style.pointerEvents="none",t.style.visibility="hidden";return}c=Math.max(l,Math.min(c,o.width-i-l)),d=Math.max(l,Math.min(d,o.height-s-l));const u=t.style.left,h=t.style.top;(!u||u==="0px"||!h||h==="0px")&&(t.style.left=`${c}px`,t.style.top=`${d}px`),t.style.opacity="1",t.style.transform="translate(0, 0)",t.style.pointerEvents="none",t.style.visibility="visible"}else t&&!n.mapInfoOpen&&(t.style.opacity="0",t.style.transform="translate(-9999px, -9999px)",t.style.pointerEvents="none",t.style.visibility="hidden")}function $i(){if(!ee)return;const e=ee.querySelector('[data-role="map-location-search"]');if(!e)return;const t=n.sidebarOpen?-Pe/2:0;e.style.transform=`translateX(calc(-50% + ${t}px))`}function uf(){return n.pointSelectActive?`
      <div style="${g(M.drawOverlay)}"></div>
      <div
        id="point-overlay-marker"
        style="${g({position:"absolute",inset:0,pointerEvents:"none",zIndex:9})}"
      ></div>
      <div style="${g(M.drawPrompt)}">
        <div>Click a point to sample</div>
        <div style="${g(M.drawPromptSub)}">
          The chart will load data for this single location
        </div>
      </div>
    `:""}function hf(){const e=n.mapMarker,t=e?.name?Ce(e.name):e?`Pixel ${e.pixel.x}, ${e.pixel.y}`:"Selected location";return`
      <div
        id="map-location-marker"
        style="${g(M.mapMarker)}"
        aria-hidden="true"
        title="${t}"
      >
        <svg
          viewBox="0 0 28 36"
          width="28"
          height="36"
          aria-hidden="true"
          focusable="false"
        >
          <defs>
            <linearGradient id="map-marker-gradient" x1="0" x2="1">
              <stop offset="0%" stop-color="var(--accent-blue)" />
              <stop offset="100%" stop-color="var(--accent-purple)" />
            </linearGradient>
          </defs>
          <path
            d="M14 2C8.48 2 4 6.48 4 12c0 7.72 8.4 19.3 9.1 20.25.5.68 1.3.68 1.8 0C15.6 31.3 24 19.72 24 12 24 6.48 19.52 2 14 2Z"
            fill="url(#map-marker-gradient)"
          />
          <circle cx="14" cy="12" r="4.5" fill="rgba(9, 14, 28, 0.9)" />
          <circle cx="14" cy="12" r="3" fill="white" opacity="0.9" />
        </svg>
      </div>
    `}function ki(){const e=n.mapMarker!==null,t=n.mapPolygon!==null&&n.mapPolygon.length>=3;if(!e&&!t)return`<div style="${g(M.chartEmpty)}">Click a location or draw a region to load boxplots.</div>`;if(n.mapInfoLoading){const a=n.mapInfoLoadingProgress.total>0?`${n.mapInfoLoadingProgress.done}/${n.mapInfoLoadingProgress.total} datasets loaded`:"Preparing datasets",r=n.mapInfoBoxes&&n.mapInfoBoxes.length?yo(n.mapInfoBoxes,n.selectedUnit):`<div style="${g(M.chartEmpty)}">Loading boxplots...</div>`;return`
          <div style="${g(M.mapInfoLoadingRow)}">
            <div style="${g(M.mapInfoLoadingSpinner)}"></div>
            <div>${a}</div>
          </div>
          ${r}
        `}return n.mapInfoError?`<div style="${g(M.chartError)}">${Ce(n.mapInfoError)}</div>`:!n.mapInfoBoxes||!n.mapInfoBoxes.length?`<div style="${g(M.chartEmpty)}">Click a location to load boxplots.</div>`:yo(n.mapInfoBoxes,n.selectedUnit)}function ff(){if(!n.mapInfoOpen)return"";const e=n.mapMarker,a=n.mapPolygon!==null&&n.mapPolygon.length>=3?"Drawn Region":e?.name?e.name:e?`Pixel ${e.pixel.x}, ${e.pixel.y}`:"Selected location",r=ga(n.variable,n.metaData),o=`${a} · ${r}`,i=`${pt(n.date)} · ${n.selectedUnit}`;return`
      <div id="map-info-panel" class="custom-select-info-panel map-info-panel" style="${g(M.mapInfoPanel)}">
        <div style="${g(M.mapInfoHeader)}">
          <div style="${g(M.mapInfoTitleGroup)}">
            <div class="custom-select-info-panel-title">${Ce(o)}</div>
            <div style="${g(M.mapInfoSubtitle)}">${Ce(i)}</div>
          </div>
          <div style="${g(M.mapInfoActions)}">
            <button
              type="button"
              data-action="close-map-info"
              aria-label="Close info"
              style="${g(M.mapInfoActionBtn)}"
              onmouseover="this.style.color='var(--text-primary)';this.style.background='rgba(15, 23, 42, 0.85)';"
              onmouseout="this.style.color='var(--text-secondary)';this.style.background='transparent';"
            >
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M6 6l12 12M18 6l-12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </button>
          </div>
        </div>
        <div class="map-info-body" style="${g(M.mapInfoBody)}">
          ${ki()}
        </div>
        <button
          type="button"
          data-action="open-map-info-chart"
          aria-label="Open chart view"
          style="${g({...M.mapInfoActionBtn,...M.mapInfoExpandBtn})}"
          onmouseover="this.style.color='var(--text-primary)';this.style.background='rgba(15, 23, 42, 0.85)';"
          onmouseout="this.style.color='var(--text-secondary)';this.style.background='transparent';"
        >
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M9 5H5v4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M15 5h4v4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M9 19H5v-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M15 19h4v-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    `}function co(){n.chartLocation="Draw",n.chartPolygon=null,n.chartLocationName=null,n.chartLocationSearchResults=[],n.chartLocationSearchQuery="",n.chartLocationSearchError=null,n.chartLocationSearchLoading=!1,n.chartError=null,n.pointSelectActive=!1,n.drawState={active:!0,points:[],previewPoint:null},n.canvasView="map",Mi(Ci),H(),_e()}function la(){n.drawState=yt(),ya()}function pf(){n.canvasView==="map"&&(n.mapPolygon=null,n.mapMarker=null,n.mapInfoOpen=!1,n.drawState={active:!0,points:[],previewPoint:null},n.pointSelectActive=!1,Mi(Di),H())}function mf(){n.drawState=yt(),ya()}function Di(){if(n.drawState.active){if(n.drawState.points.length<3){n.mapInfoError="Draw at least three points to define a region.",n.mapInfoOpen=!0,H();return}n.mapPolygon=n.drawState.points,n.mapMarker=null,n.drawState=yt(),ya(),n.mapInfoError=null,n.mapInfoOpen=!0,H(),Vt()}}function uo(){n.chartLocation="Point",n.chartPolygon=null,n.chartPoint=null,n.chartLocationName=null,n.chartLocationSearchResults=[],n.chartLocationSearchQuery="",n.chartLocationSearchError=null,n.chartLocationSearchLoading=!1,n.chartError=null,n.drawState=yt(),n.chartUnit=ze(n.chartVariable).label,n.pointSelectActive=!0,n.canvasView="map",H(),_e()}function ca(){n.pointSelectActive=!1}async function Ti(e){const t=e.trim();if(!t)return[];const a=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(t)}&limit=5&addressdetails=1`,r=await fetch(a,{headers:{Accept:"application/json","User-Agent":"climate-visualization-app/1.0"}});if(!r.ok)throw new Error("Location search failed. Please try again.");return(await r.json()).map(i=>({displayName:i.display_name,lat:Number(i.lat),lon:Number(i.lon)})).filter(i=>Number.isFinite(i.lat)&&Number.isFinite(i.lon))}async function gf(e,t){const a=`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${t}&addressdetails=1`,r=await fetch(a,{headers:{Accept:"application/json","User-Agent":"climate-visualization-app/1.0"}});return r.ok&&(await r.json()).display_name||null}function ho(e){kt!==null&&(window.clearTimeout(kt),kt=null),n.chartLocation="Search",n.chartPoint={lat:e.lat,lon:e.lon},n.chartLocationName=e.displayName,n.chartLocationSearchError=null,n.chartLocationSearchResults=[],n.chartLocationSearchLoading=!1,n.chartLocationSearchQuery="",n.chartError=null,n.chartPolygon=null,n.pointSelectActive=!1,n.drawState=yt(),n.canvasView="chart",la(),ca(),H(),We()}async function yf(e){const t=e.trim(),a=++Pn;if(n.chartLocation="Search",n.chartLocationSearchQuery=e,n.chartLocationSearchError=null,n.chartLocationSearchResults=[],n.chartLocationName=null,n.chartPoint=null,n.chartError=null,n.chartPolygon=null,n.pointSelectActive=!1,n.drawState=yt(),n.canvasView="chart",la(),ca(),!t){n.chartLocationSearchLoading=!1,n.chartLocationSearchResults=[],n.chartLocationSearchError=null,H();return}n.chartLocationSearchLoading=!0,H();try{const r=await Ti(t);if(a!==Pn)return;n.chartLocationSearchResults=r,r.length||(n.chartLocationSearchError="No places found for that query.")}catch(r){if(a!==Pn)return;n.chartLocationSearchError=r instanceof Error?r.message:"Search failed."}finally{if(a!==Pn)return;n.chartLocationSearchLoading=!1,H()}}function Li(e,t,a){const[r,o]=bn(e,t);n.mapMarker={lat:e,lon:t,name:a,pixel:{x:r,y:o}}}function vf(e){if(Dt!==null&&(window.clearTimeout(Dt),Dt=null),n.mapLocationSearchError=null,n.mapLocationSearchResults=[],n.mapLocationSearchLoading=!1,n.mapLocationSearchQuery=e.displayName,n.mapLocationSearchSelection=e.displayName,n.mapLocationSearchFocused=!0,Li(e.lat,e.lon,e.displayName),H(),we){const t=Math.max(vi(),3.2);bi(we,e.lon,e.lat,t),sa()}Ei()}async function bf(e){const t=e.trim(),a=++In;if(n.mapLocationSearchQuery=e,n.mapLocationSearchError=null,n.mapLocationSearchResults=[],n.mapLocationSearchSelection=null,!t){n.mapLocationSearchLoading=!1,n.mapLocationSearchResults=[],n.mapLocationSearchError=null,H();return}n.mapLocationSearchLoading=!0,H();try{const r=await Ti(t);if(a!==In)return;n.mapLocationSearchResults=r,r.length||(n.mapLocationSearchError="No places found for that query.")}catch(r){if(a!==In)return;n.mapLocationSearchError=r instanceof Error?r.message:"Search failed."}finally{if(a!==In)return;n.mapLocationSearchLoading=!1,H()}}function xf(e){if(n.mapMarker&&(n.mapMarker.name=e),!ee)return;const t=ee.querySelector("#map-location-marker");if(t&&n.mapMarker&&(t.title=e),n.mapInfoOpen&&n.mapMarker){const a=ee.querySelector(".custom-select-info-panel-title");if(a){const r=ga(n.variable,n.metaData),i=`${e} · ${r}`;a.textContent=i}}}async function wf(e){if(n.canvasView==="map"&&!(n.drawState.active||n.pointSelectActive)){if(n.mapPolygon=null,Li(e.lat,e.lon,null),we){const t=Math.max(vi(),3.2);bi(we,e.lon,e.lat,t),sa()}Ei();try{const t=await gf(e.lat,e.lon);t&&xf(t)}catch(t){console.error("Failed to fetch reverse geocode:",t)}}}function Ei(e=700){ft!==null&&(window.clearTimeout(ft),ft=null);const t=n.mapInfoOpen;if(n.mapInfoOpen=!1,t&&ee){const a=ee.querySelector("#map-info-panel");a&&(a.style.opacity="0",a.style.transform="translate(-9999px, -9999px)",a.style.pointerEvents="none",a.style.visibility="hidden")}ft=window.setTimeout(()=>{ft=null;const a=n.mapMarker!==null,r=n.mapPolygon!==null&&n.mapPolygon.length>=3;!a&&!r||(n.mapInfoOpen=!0,H(),Vt())},e)}function Sf(){ft!==null&&(window.clearTimeout(ft),ft=null),St+=1,n.mapInfoOpen=!1,n.mapInfoLoading=!1,H()}function Ia(e){n.mapInfoSamples=e;try{n.mapInfoBoxes=gn(e,n.variable,n.selectedUnit)}catch{return}if(!ee){H();return}const t=ee.querySelector("#map-info-panel");if(t){const a=t.querySelector(".map-info-body");if(a){a.innerHTML=ki();return}}H()}async function Vt(){if(n.canvasView!=="map")return;const e=n.mapMarker!==null,t=n.mapPolygon!==null&&n.mapPolygon.length>=3;if(!e&&!t){n.mapInfoLoading=!1,n.mapInfoError=null,n.mapInfoSamples=[],n.mapInfoBoxes=null,n.mapInfoLoadingProgress={total:0,done:0},n.mapInfoOpen=!1,H();return}const a=++St;n.mapInfoLoading=!0,n.mapInfoError=null,n.mapInfoSamples=[],n.mapInfoBoxes=null,n.mapInfoLoadingProgress={total:0,done:0},H();try{const r=n.metaData??await wr();n.metaData||(n.metaData=r);const o=r?.scenarios?.length?Array.from(new Set(r.scenarios.map(_t))):Me,i=o.filter(u=>Ja(n.date,Ue(u))),s=i.length?i.includes("Historical")?["Historical"]:i:o,l=r?.models?.length?r.models:ge;if(!o.length||!l.length){n.mapInfoError="Select at least one scenario and one model.",n.mapInfoLoading=!1,n.mapInfoLoadingProgress={total:0,done:0},H();return}const c=s.length*l.length;n.mapInfoLoadingProgress={total:c,done:0},H();const d=[];for(const u of s){if(a!==St)return;const h=Te(n.date,Ue(u));if(e&&n.mapMarker){const[f,p]=bn(n.mapMarker.lat,n.mapMarker.lon),x=l.map($=>ja({variable:n.variable,model:$,x0:f,x1:f,y0:p,y1:p,start_date:h,end_date:h,scenario:it(u),resolution:"low",step_days:1}).catch(w=>{console.warn(`Pixel API failed for model ${$}, falling back:`,w);const b=he({variable:n.variable,date:h,model:$,scenario:u,resolution:1});return Ee(b).then(L=>{const E=Se(L);if(!E)throw new Error("No data returned for map info request.");const T=Wn(E,n.variable,L.shape,{lat:n.mapMarker.lat,lon:n.mapMarker.lon});return{model:$,value:T,fallback:!0}})})),k=await Promise.allSettled(x);if(a!==St)return;for(const $ of k)if($.status==="fulfilled"){const w=$.value;if(typeof w=="object"&&"fallback"in w&&w.fallback)d.push({scenario:u,model:w.model,rawValue:w.value,dateUsed:h});else{const b=w,L=b.values[0];if(L!==null&&isFinite(L)){const E=n.variable==="hurs"?Math.min(L,100):L;d.push({scenario:u,model:b.model,rawValue:E,dateUsed:h})}}}else console.warn("Failed to fetch pixel data for map info:",$.reason);n.mapInfoLoadingProgress={total:c,done:n.mapInfoLoadingProgress.done+l.length},Ia(d)}else if(t&&n.mapPolygon){const[f,p,x,k]=er(n.mapPolygon),$=tr(n.mapPolygon,f,p,x,k);try{const w=await Ka({variable:n.variable,models:l,x0:f,x1:p,y0:x,y1:k,start_date:h,end_date:h,scenario:it(u),resolution:"low",step_days:1,mask:$});for(const b of l){const L=w.models[b];if(L){const E=L.values[0];if(E!==null&&isFinite(E)){const T=n.variable==="hurs"?Math.min(E,100):E;d.push({scenario:u,model:b,rawValue:T,dateUsed:h})}}}n.mapInfoLoadingProgress={total:c,done:n.mapInfoLoadingProgress.done+l.length},Ia(d)}catch(w){console.warn(`Aggregate API failed for scenario ${u}, falling back to full map load:`,w);for(const b of l){if(a!==St)return;const L=he({variable:n.variable,date:h,model:b,scenario:u,resolution:1});try{const E=await Ee(L),T=Se(E);if(T){const S=Hn(T,n.variable,E.shape,n.mapPolygon);d.push({scenario:u,model:b,rawValue:S,dateUsed:h})}}catch(E){console.warn(`Failed to load data for model ${b}:`,E)}n.mapInfoLoadingProgress={total:c,done:n.mapInfoLoadingProgress.done+1},Ia(d)}}}}if(a!==St)return;n.mapInfoLoading=!1,H()}catch(r){if(a!==St)return;n.mapInfoError=r instanceof Error?r.message:"Failed to load map chart data.",n.mapInfoLoading=!1,n.mapInfoLoadingProgress={total:0,done:0},H()}}function Mf(e){n.drawState.active&&(n.drawState={...n.drawState,previewPoint:e},va())}function $f(e){if(!n.drawState.active)return;const t=n.drawState.points;if(t.length>=3&&cf(e,t[0])){n.canvasView==="chart"||n.chartLocation==="Draw"?Ci():n.canvasView==="map"&&Di();return}n.drawState={...n.drawState,points:[...t,e],previewPoint:e},va()}function kf(e){n.pointSelectActive&&(n.chartPoint=e,n.pointSelectActive=!1,n.chartError=null,n.canvasView="chart",H(),We())}function Ci(){if(n.drawState.active){if(n.drawState.points.length<3){n.chartError="Draw at least three points to define a region.",H();return}n.chartPolygon=n.drawState.points,n.drawState=yt(),ya(),n.chartError=null,n.canvasView="chart",H(),We()}}function _i(e){const t=e.filter(s=>Number.isFinite(s)).sort((s,l)=>s-l);if(!t.length)throw new Error("No valid values available to build chart statistics.");const a=wa(t,.25)??t[0],r=wa(t,.5)??t[Math.floor(t.length/2)],o=wa(t,.75)??t[t.length-1],i=Hi(t)??t[0];return{min:t[0],q1:a,median:r,q3:o,max:t[t.length-1],mean:i,count:t.length}}function gn(e,t,a){const r=new Map;return e.forEach(o=>{const i=r.get(o.scenario)??[];i.push(o),r.set(o.scenario,i)}),Array.from(r.entries()).map(([o,i])=>{const s=i.map(c=>{const d=qt(c.rawValue,t,a);return{...c,value:d}}),l=_i(s.map(c=>c.value));return{scenario:o,dateUsed:i[0]?.dateUsed??"",samples:s,stats:l}})}function Df(e,t,a=50){const r=J(e),o=J(t);if(Number.isNaN(r.getTime())||Number.isNaN(o.getTime())||a<=0)return[];let i=r,s=o;i>s&&([i,s]=[s,i]);const l=1440*60*1e3,d=Math.floor((s.getTime()-i.getTime())/l)+1,u=[];if(d<=a){for(let p=0;p<d;p++){const x=new Date(i.getTime()+p*l);u.push(x.toISOString().slice(0,10))}return u}const h=(s.getTime()-i.getTime())/(a-1),f=new Set;for(let p=0;p<a;p++){const x=new Date(i.getTime()+h*p);f.add(x.toISOString().slice(0,10))}return f.add(s.toISOString().slice(0,10)),Array.from(f).sort((p,x)=>J(p).getTime()-J(x).getTime())}function fo(e,t,a=50){const r=J(e),o=J(t);if(Number.isNaN(r.getTime())||Number.isNaN(o.getTime())||a<=0)return[];let i=r,s=o;i>s&&([i,s]=[s,i]);const l=1440*60*1e3,c=Math.floor((s.getTime()-i.getTime())/l),d=s.getFullYear()-i.getFullYear();if(c<=120)return Df(i.toISOString().slice(0,10),s.toISOString().slice(0,10),a);const u=i.getDate(),h=i.getMonth(),f=i.getFullYear(),p=s.getFullYear(),x=p-f+1,k=Math.min(a,x),$=new Set;if(k===1)$.add(f);else{const L=(x-1)/(k-1);for(let E=0;E<k;E++){const T=Math.round(f+L*E);$.add(Math.min(p,Math.max(f,T)))}}const w=[];return Array.from($).sort((L,E)=>L-E).forEach(L=>{const E=new Date(L,h+1,0).getDate(),T=Math.min(u,E),S=new Date(L,h,T);if(d>=20){if(S<i||S>s)return;w.push(S.toISOString().slice(0,10));return}let P=S;S<i&&(P=i),S>s&&(P=s),w.push(P.toISOString().slice(0,10))}),Array.from(new Set(w)).sort((L,E)=>J(L).getTime()-J(E).getTime())}function Tf(e,t){const a=J(e),r=J(t);if(Number.isNaN(a.getTime())||Number.isNaN(r.getTime()))return!1;const o=1440*60*1e3;return Math.abs(r.getTime()-a.getTime())/o/365.25>=20}function po(e,t){const a=J(t),r=J(e);return Number.isNaN(a.getTime())||Number.isNaN(r.getTime())?!1:r.getMonth()===a.getMonth()&&r.getDate()===a.getDate()}function Ja(e,t){const a=J(e),r=J(t.start),o=J(t.end);return Number.isNaN(a.getTime())||Number.isNaN(r.getTime())||Number.isNaN(o.getTime())?!1:a>=r&&a<=o}function mo(e,t,a,r=50){const o=J(e),i=J(t),s=J(a);if(Number.isNaN(o.getTime())||Number.isNaN(i.getTime())||Number.isNaN(s.getTime())||r<=0)return[];const l=o.getMonth(),c=o.getDate(),d=i.getFullYear(),u=s.getFullYear(),h=u-d+1,f=Math.min(r,h),p=new Set;if(f===1)p.add(d);else{const $=(h-1)/(f-1);for(let w=0;w<f;w++){const b=Math.round(d+$*w);p.add(Math.min(u,Math.max(d,b)))}}const x=[];return Array.from(p).sort(($,w)=>$-w).forEach($=>{const w=new Date($,l+1,0).getDate(),b=Math.min(c,w),L=new Date($,l,b);L<i||L>s||x.push(L.toISOString().slice(0,10))}),Array.from(new Set(x)).sort(($,w)=>J($).getTime()-J(w).getTime())}function Yn(e,t,a){const r=new Map;return e.forEach(o=>{const i=r.get(o.scenario)??[];i.push(o),r.set(o.scenario,i)}),Array.from(r.entries()).map(([o,i])=>{const s=new Map;i.forEach(c=>{const d=qt(c.rawValue,t,a),u=s.get(c.dateUsed)??[];u.push({...c,value:d}),s.set(c.dateUsed,u)});const l=Array.from(s.entries()).map(([c,d])=>({date:c,samples:d,stats:_i(d.map(u=>u.value))})).sort((c,d)=>J(c.date).getTime()-J(d.date).getTime());return{scenario:o,points:l}})}function Lf(e,t,a,r){const o=Se(e),i=Se(t);if(!o||!i)throw new Error("Comparison data is missing numeric values.");if(o.length!==i.length||e.shape[0]!==t.shape[0]||e.shape[1]!==t.shape[1])throw new Error("Comparison datasets have mismatched shapes.");const s=new Float32Array(o.length);let l=1/0,c=-1/0,d=0,u=0;for(let p=0;p<o.length;p++){const x=o[p],k=i[p];if(!isFinite(x)||!isFinite(k)){s[p]=NaN;continue}const $=k-x;s[p]=$,isFinite($)&&(l=Math.min(l,$),c=Math.max(c,$),d+=$,u+=1)}if(!isFinite(l)||!isFinite(c))throw new Error("Comparison produced no valid numeric values.");const h=u>0?d/u:NaN;return{data:{...e,data:s,data_encoding:"none",dtype:"float32",model:`${r} minus ${a}`,time:`${t.time} minus ${e.time}`,scenario:`${t.scenario} minus ${e.scenario}`,metadata:{...e.metadata,comparison:{labelA:a,labelB:r}}},min:l,max:c,mean:h}}function se(e,t=!1){const a=Math.max(0,Math.min(100,Math.round(e)));a!==n.loadingProgress&&(n.loadingProgress=a,(n.isLoading||t)&&H())}async function Ef(e,t){let a=he({variable:n.variable,date:n.date,model:n.model,scenario:n.scenario,resolution:n.resolution}),r=a,o="",i="";switch(n.compareMode){case"Scenarios":{const c=n.compareScenarioA,d=n.compareScenarioB,u=mt(n.date,e);u!==n.date&&(n.date=u),a=he({variable:n.variable,date:u,model:n.model,scenario:c,resolution:n.resolution}),r=he({variable:n.variable,date:u,model:n.model,scenario:d,resolution:n.resolution}),o=c,i=d;break}case"Models":{const c=mt(n.date,e);c!==n.date&&(n.date=c),a=he({variable:n.variable,date:c,model:n.compareModelA,scenario:n.scenario,resolution:n.resolution}),r=he({variable:n.variable,date:c,model:n.compareModelB,scenario:n.scenario,resolution:n.resolution}),o=n.compareModelA,i=n.compareModelB;break}case"Dates":{const c=mt(n.compareDateStart,n.scenario),d=mt(n.compareDateEnd,n.scenario);c!==n.compareDateStart&&(n.compareDateStart=c),d!==n.compareDateEnd&&(n.compareDateEnd=d),a=he({variable:n.variable,date:c,model:n.model,scenario:n.scenario,resolution:n.resolution}),r=he({variable:n.variable,date:d,model:n.model,scenario:n.scenario,resolution:n.resolution}),o=c,i=d;break}}const s=await Ee(a);t?.(65);const l=await Ee(r);return t?.(85),Lf(s,l,o,i)}function an(e,t){if(e.length===0)return NaN;if(e.length===1)return e[0];const a=t/100*(e.length-1),r=Math.floor(a),o=Math.ceil(a),i=a-r;return r===o?e[r]:e[r]*(1-i)+e[o]*i}async function Cf(e){const t=n.ensembleScenarios.length>0?n.ensembleScenarios:Me.filter(P=>P!=="Historical"),a=n.ensembleModels.length>0?n.ensembleModels:ge;if(t.length===0||a.length===0)throw new Error("Please select at least one scenario and one model.");const r=Kt(t),o=Te(n.ensembleDate,r);o!==n.ensembleDate&&(n.ensembleDate=o);const i=t.length*a.length,s=[],l=[];e?.(10);for(let P=0;P<t.length;P++){const q=t[P];for(let Y=0;Y<a.length;Y++){const W=a[Y],O=10+Math.round((P*a.length+Y)/i*80);e?.(O);const j=he({variable:n.ensembleVariable,date:o,model:W,scenario:q,resolution:n.resolution});try{const U=await Ee(j),y=Se(U);y&&(s.push(y),l.push(U.shape))}catch(U){console.warn(`Failed to fetch data for ${q}/${W}:`,U)}}}if(s.length===0)throw new Error("No valid data could be loaded for the selected scenarios and models.");e?.(90);const c=l[0];for(let P=1;P<l.length;P++)if(l[P][0]!==c[0]||l[P][1]!==c[1])throw new Error("Ensemble datasets have mismatched shapes. Cannot compute statistics.");const d=s[0].length,u=new Float32Array(d);let h=1/0,f=-1/0,p=0,x=0;const k=new Set([n.ensembleStatistic]);if(n.masks&&n.masks.length>0)for(const P of n.masks)P.statistic&&k.add(P.statistic);const $=new Map;for(const P of k)$.set(P,new Float32Array(d));for(let P=0;P<d;P++){const q=[];for(const j of s){const U=j[P];if(isFinite(U)){const y=n.ensembleVariable==="hurs"?Math.min(U,100):U;q.push(y)}}if(q.length===0){u[P]=NaN;for(const j of k)$.get(j)[P]=NaN;continue}const Y=k.has("median")||k.has("iqr")||k.has("percentile")?[...q].sort((j,U)=>j-U):null,W=k.has("mean")||k.has("std")?q.reduce((j,U)=>j+U,0)/q.length:0;for(const j of k){let U;if(j==="mean")U=W;else if(j==="median")U=an(Y,50);else if(j==="std"){const y=q.reduce((F,C)=>F+Math.pow(C-W,2),0)/q.length;U=Math.sqrt(y)}else if(j==="iqr"){const y=an(Y,75),F=an(Y,25);U=y-F}else if(j==="percentile"){const y=an(Y,90),F=an(Y,10);U=y-F}else j==="extremes"?U=Math.max(...q)-Math.min(...q):U=W;$.get(j)[P]=U}const O=$.get(n.ensembleStatistic)[P];u[P]=O,isFinite(O)&&(h=Math.min(h,O),f=Math.max(f,O),p+=O,x+=1)}if(n.ensembleStatistics=$,!isFinite(h)||!isFinite(f))throw new Error("Ensemble computation produced no valid numeric values.");const w=x>0?p/x:NaN,b=he({variable:n.ensembleVariable,date:o,model:a[0],scenario:t[0],resolution:n.resolution}),L=await Ee(b),T=n.ensembleStatistic!=="mean"?{...L.metadata||{},comparison:{labelA:"Ensemble",labelB:n.ensembleStatistic==="std"?"Std Dev":n.ensembleStatistic==="median"?"Median":n.ensembleStatistic==="iqr"?"IQR":n.ensembleStatistic==="percentile"?"Percentile Band":"Extremes"}}:L.metadata,S={...L,data:u,data_encoding:"none",metadata:T};return e?.(100),{data:S,min:h,max:f,mean:w}}const yn=600,vn=1440;function bn(e,t){const r=((t+360)%360+360)%360/360*vn-.5,o=(90-e)/150*yn-.5,i=(c,d,u)=>Math.min(u,Math.max(d,c)),s=i(Math.round(r),0,vn-1),l=i(Math.round(o),0,yn-1);return[s,l]}function er(e){if(!e||e.length<3)throw new Error("Polygon must have at least 3 points");let t=1/0,a=-1/0,r=1/0,o=-1/0;for(const i of e){const[s,l]=bn(i.lat,i.lon);t=Math.min(t,s),a=Math.max(a,s),r=Math.min(r,l),o=Math.max(o,l)}return t=Math.max(0,Math.min(t,vn-1)),a=Math.max(0,Math.min(a,vn-1)),r=Math.max(0,Math.min(r,yn-1)),o=Math.max(0,Math.min(o,yn-1)),[t,a,r,o]}function tr(e,t,a,r,o){const i=[],s=360/vn,l=150/yn;for(let c=r;c<=o;c++){const d=[],u=90-(c+.5)*l;for(let h=t;h<=a;h++){const f=(h+.5)*s,p=f>180?f-360:f,x=Si({lat:u,lon:p},e);d.push(x?1:0)}i.push(d)}return i}function Fe(){const e=document.querySelector("[data-role='chart-container']");if(!e)return;const t=n.chartMode==="range";let a="";if(n.chartLoading)a=`
          <div style="position:absolute; inset:0; pointer-events:none;">
            <div style="${g(ye(M.loadingIndicator,{position:"absolute",left:18,bottom:-95,pointerEvents:"auto"}))}">
              <div style="${g(M.loadingSpinner)}"></div>
              <div style="${g(M.loadingTextGroup)}">
                <div style="${g(M.loadingText)}">Loading data</div>
                <div style="${g(M.loadingBar)}">
                  <div style="${g({...M.loadingBarFill,width:`${Math.max(0,Math.min(100,Math.round(n.loadingProgress||25)))}%`})}"></div>
                </div>
                <div style="${g(M.loadingSubtext)}">${n.chartLoadingProgress.total>0?`${n.chartLoadingProgress.done}/${n.chartLoadingProgress.total} datasets loaded`:"Preparing datasets"}</div>
              </div>
            </div>
            ${Rf()}
          </div>
          ${!t&&n.chartBoxes?go(n.chartBoxes):t&&n.chartRangeSeries?vo(n.chartRangeSeries):""}
        `;else if(n.chartError)a=`<div style="${g(M.chartError)}">${n.chartError}</div>`;else if(!t&&(!n.chartBoxes||!n.chartBoxes.length)||t&&(!n.chartRangeSeries||!n.chartRangeSeries.length)){const i=t?"Select scenarios, models, and a date range to see how the distribution evolves over time.":"Select scenarios and models to fetch the global box plot.";a=`<div style="${g(M.chartEmpty)}">${i}</div>`}else a=t?vo(n.chartRangeSeries??[]):go(n.chartBoxes??[]);const r=n.chartLocationName||(n.chartLocation==="Point"&&n.chartPoint?`Point (${n.chartPoint.lat.toFixed(2)}, ${n.chartPoint.lon.toFixed(2)})`:n.chartLocation==="Draw"?"Custom region":n.chartLocation==="World"?"Global":""),o=n.chartMode==="range"?`${pt(n.chartRangeStart)} – ${pt(n.chartRangeEnd)}`:pt(n.chartDate);e.innerHTML=`
        <div style="${g(M.chartPanel)}">
          <div style="${g(M.chartHeader)}">
            <div style="${g(M.chartTitle)}">${ga(n.chartVariable,n.metaData)}</div>
            <div style="${g(M.mapSubtitle)}">${r?`${Ce(r)} · ${o}`:o}</div>
          </div>
          <div style="${g(ye(M.chartPlotWrapper,{display:"flex",alignItems:"center",justifyContent:"center"}))}">
            ${a}
          </div>
        </div>
      `,!t&&n.chartBoxes&&n.chartBoxes.length>0&&setTimeout(()=>{_f()},0)}function _f(){const e=document.querySelector("[data-role='chart-container'] svg");if(!e)return;const t=e.querySelector(".boxplot-hover-overlay");if(!t)return;const a=e.querySelectorAll(".boxplot-hover-area"),r=e.querySelectorAll(".model-indicator");a.length!==0&&(r.forEach(o=>{o.style.opacity="0"}),a.forEach(o=>{const i=o.closest(".boxplot-group");if(!i)return;const s=i.getAttribute("data-boxplot-idx");s!==null&&(o.addEventListener("mouseenter",()=>{t.style.opacity="1",t.style.pointerEvents="auto",r.forEach(l=>{const c=l;c.getAttribute("data-boxplot-idx")===s?c.style.opacity="1":c.style.opacity="0"})}),o.addEventListener("mouseleave",()=>{t.style.opacity="0",t.style.pointerEvents="none",r.forEach(l=>{l.style.opacity="0"})}))}))}async function We(){if(n.canvasView!=="chart")return;const e=t=>{if(n.chartSamples=t,n.chartMode==="single")try{n.chartBoxes=gn(t,n.chartVariable,n.chartUnit),n.chartRangeSeries=null}catch{return}else try{n.chartRangeSeries=Yn(t,n.chartVariable,n.chartUnit),n.chartBoxes=null}catch{return}Fe()};if(n.chartLocation==="Draw"&&(!n.chartPolygon||n.chartPolygon.length<3)){n.chartError="Draw a region on the map to load chart data.",n.chartBoxes=null,n.chartRangeSeries=null,n.chartSamples=[],n.chartLoading=!1,n.chartLoadingProgress={total:0,done:0},Fe();return}if(n.chartLocation==="Point"&&!n.chartPoint){n.chartError="Click a point on the map to load chart data.",n.chartBoxes=null,n.chartRangeSeries=null,n.chartSamples=[],n.chartLoading=!1,n.chartLoadingProgress={total:0,done:0},Fe();return}if(n.chartLocation==="Search"&&!n.chartPoint){n.chartError=n.chartLocationSearchLoading?"Searching for a place...":"Search for a place and pick a result.",n.chartBoxes=null,n.chartRangeSeries=null,n.chartSamples=[],n.chartLoading=!1,n.chartLoadingProgress={total:0,done:0},Fe();return}n.chartLoading=!0,n.chartError=null,se(5,!0),n.chartLoadingProgress={total:0,done:0},n.chartSamples=[],n.chartBoxes=null,n.chartRangeSeries=null,Fe();try{const t=n.metaData??await wr();n.metaData||(n.metaData=t);const a=t?.scenarios?.length?Array.from(new Set(t.scenarios.map(_t))):Me,r=t?.models?.length?t.models:ge,o=(n.chartScenarios.length?n.chartScenarios:a).filter(l=>a.includes(l)),i=(n.chartModels.length?n.chartModels:r).filter(l=>r.includes(l));if(!o.length||!i.length){n.chartError="Select at least one scenario and one model.",n.chartSamples=[],n.chartBoxes=null,n.chartRangeSeries=null,n.chartLoading=!1,n.chartLoadingProgress={total:0,done:0},Fe();return}const s=Kt(o);if(n.chartMode==="single"){const l=Te(n.chartDate,s);l!==n.chartDate&&(n.chartDate=l);const c=o.length*i.length;n.chartLoadingProgress={total:c,done:0},n.chartRangeSeries=null,Fe();const d=[];if((n.chartLocation==="Point"||n.chartLocation==="Search")&&n.chartPoint?!0:n.chartLocation==="Draw"&&n.chartPolygon&&n.chartPolygon.length>=3){console.log("Using pixel-data API for efficient loading");for(const h of o){const f=Te(n.chartDate,Ue(h));try{if((n.chartLocation==="Point"||n.chartLocation==="Search")&&n.chartPoint){const[p,x]=bn(n.chartPoint.lat,n.chartPoint.lon);console.log(`Fetching pixel data for point (${p}, ${x}) for ${i.length} models`);const k=i.map(w=>ja({variable:n.chartVariable,model:w,x0:p,x1:p,y0:x,y1:x,start_date:f,end_date:f,scenario:it(h),resolution:"low",step_days:1}).catch(b=>{if(console.warn(`Pixel API failed for model ${w}, falling back:`,b),!n.chartPoint)throw b;const L=he({variable:n.chartVariable,date:f,model:w,scenario:h,resolution:1});return Ee(L).then(E=>{const T=Se(E);if(!T)throw new Error("No data returned for chart request.");if(!n.chartPoint)throw new Error("No chart point selected");const S=Wn(T,n.chartVariable,E.shape,n.chartPoint);return{model:w,value:S,fallback:!0}})})),$=await Promise.allSettled(k);for(const w of $)if(w.status==="fulfilled"){const b=w.value;if(typeof b=="object"&&"fallback"in b&&b.fallback)d.push({scenario:h,model:b.model,rawValue:b.value,dateUsed:f});else{const L=b,E=L.values[0];if(E!==null&&isFinite(E)){const T=n.chartVariable==="hurs"?Math.min(E,100):E;d.push({scenario:h,model:L.model,rawValue:T,dateUsed:f})}}}else console.warn("Failed to fetch pixel data:",w.reason);n.chartLoadingProgress={total:c,done:n.chartLoadingProgress.done+i.length},se(Math.min(98,Math.round(n.chartLoadingProgress.done/c*100))),e(d)}else if(n.chartLocation==="Draw"&&n.chartPolygon&&n.chartPolygon.length>=3){const[p,x,k,$]=er(n.chartPolygon),w=tr(n.chartPolygon,p,x,k,$);console.log(`Fetching aggregate data for polygon window [${p},${x},${k},${$}] for ${i.length} models`);try{const b=await Ka({variable:n.chartVariable,models:i,x0:p,x1:x,y0:k,y1:$,start_date:f,end_date:f,scenario:it(h),resolution:"low",step_days:1,mask:w});for(const L of i){const E=b.models[L];if(E){const T=E.values[0];if(T!==null&&isFinite(T)){const S=n.chartVariable==="hurs"?Math.min(T,100):T;d.push({scenario:h,model:L,rawValue:S,dateUsed:f})}}}n.chartLoadingProgress={total:c,done:n.chartLoadingProgress.done+i.length},se(Math.min(98,Math.round(n.chartLoadingProgress.done/c*100))),e(d)}catch(b){console.warn("Batch aggregate API failed, falling back to full map load:",b);for(const L of i){const E=he({variable:n.chartVariable,date:f,model:L,scenario:h,resolution:1}),T=await Ee(E),S=Se(T);if(!S)continue;const P=Hn(S,n.chartVariable,T.shape,n.chartPolygon);d.push({scenario:h,model:L,rawValue:P,dateUsed:f})}e(d)}}}catch(p){throw console.error("Error in pixel API path:",p),p}}}else for(const h of o){const f=Te(n.chartDate,Ue(h));for(const p of i){const x=n.chartLoadingProgress.done;se(Math.min(95,Math.round((x+.1)/c*100)));const k=he({variable:n.chartVariable,date:f,model:p,scenario:h,resolution:1}),$=await Ee(k),w=n.chartLoadingProgress.done+1;n.chartLoadingProgress={total:c,done:w},se(Math.min(98,Math.round(w/c*100))),e(d);const b=Se($);if(!b)throw new Error("No data returned for chart request.");const L=dn(b,n.chartVariable);d.push({scenario:h,model:p,rawValue:L,dateUsed:f})}}n.chartSamples=d,n.chartBoxes=gn(d,n.chartVariable,n.chartUnit),n.chartLoadingProgress={total:c,done:c},se(100)}else{let l=Te(n.chartRangeStart,s),c=Te(n.chartRangeEnd,s);J(l)>J(c)&&([l,c]=[c,l]),n.chartRangeStart=l,n.chartRangeEnd=c;const d=Tf(l,c),u=l;if(!Qh)if((n.chartLocation==="Point"||n.chartLocation==="Search")&&n.chartPoint?!0:n.chartLocation==="Draw"&&n.chartPolygon&&n.chartPolygon.length>=3){console.log("Using pixel-data API for range mode");const f=o.length*i.length;n.chartLoadingProgress={total:f,done:0},n.chartBoxes=null,Fe();const p=[];for(const x of i)for(const k of o){const $=Ue(k),w=Te(l,$),b=Te(c,$);if(J(w)>J(b))continue;const L=n.chartLoadingProgress.done;se(Math.min(95,Math.round((L+.1)/f*100)));try{if((n.chartLocation==="Point"||n.chartLocation==="Search")&&n.chartPoint){const[T,S]=bn(n.chartPoint.lat,n.chartPoint.lon),P=await ja({variable:n.chartVariable,model:x,x0:T,x1:T,y0:S,y1:S,start_date:w,end_date:b,scenario:it(k),resolution:"low",step_days:1});for(let q=0;q<P.timestamps.length;q++){const Y=P.timestamps[q];if(d&&!po(Y,u))continue;const W=P.values[q];if(W!==null&&isFinite(W)){const O=n.chartVariable==="hurs"?Math.min(W,100):W;p.push({scenario:k,model:x,rawValue:O,dateUsed:Y})}}e(p)}else if(n.chartLocation==="Draw"&&n.chartPolygon&&n.chartPolygon.length>=3){const[T,S,P,q]=er(n.chartPolygon),Y=tr(n.chartPolygon,T,S,P,q),O=(await Ka({variable:n.chartVariable,models:[x],x0:T,x1:S,y0:P,y1:q,start_date:w,end_date:b,scenario:it(k),resolution:"low",step_days:1,mask:Y})).models[x];if(O)for(let j=0;j<O.timestamps.length;j++){const U=O.timestamps[j];if(d&&!po(U,u))continue;const y=O.values[j];if(y!==null&&isFinite(y)){const F=n.chartVariable==="hurs"?Math.min(y,100):y;p.push({scenario:k,model:x,rawValue:F,dateUsed:U})}}e(p)}}catch(T){console.warn("Pixel API failed, falling back to full map load:",T);const S=d?mo(u,w,b,50):fo(w,b,50);for(const P of S){const q=d?P:Te(P,$);if(d&&!Ja(q,$))continue;const Y=he({variable:n.chartVariable,date:q,model:x,scenario:k,resolution:1});let W=null;try{W=await Ee(Y)}catch(U){console.warn("Range fallback request failed, skipping date:",U);continue}const O=Se(W);if(!O)continue;const j=n.chartLocation==="Draw"&&n.chartPolygon&&n.chartPolygon.length>=3?Hn(O,n.chartVariable,W.shape,n.chartPolygon):(n.chartLocation==="Point"||n.chartLocation==="Search")&&n.chartPoint?Wn(O,n.chartVariable,W.shape,n.chartPoint):dn(O,n.chartVariable);p.push({scenario:k,model:x,rawValue:j,dateUsed:q})}e(p)}const E=n.chartLoadingProgress.done+1;n.chartLoadingProgress={total:f,done:E},se(Math.min(98,Math.round(E/f*100))),e(p)}n.chartSamples=p,n.chartRangeSeries=Yn(p,n.chartVariable,n.chartUnit),n.chartLoadingProgress={total:f,done:f},se(100)}else{const f=d?mo(u,l,c,50):fo(l,c,50);if(!f.length){n.chartError="Enter a valid date range within the selected scenarios.",n.chartSamples=[],n.chartBoxes=null,n.chartRangeSeries=null,n.chartLoading=!1,n.chartLoadingProgress={total:0,done:0},Fe();return}const p=o.length*i.length*f.length;n.chartLoadingProgress={total:p,done:0},n.chartBoxes=null,Fe();const x=[];for(const k of i)for(const $ of o){const w=Ue($);for(const b of f){const L=d?b:Te(b,w);if(d&&!Ja(L,w))continue;const E=n.chartLoadingProgress.done;se(Math.min(95,Math.round((E+.1)/p*100)));const T=he({variable:n.chartVariable,date:L,model:k,scenario:$,resolution:1});let S=null;try{S=await Ee(T)}catch(W){console.warn("Range request failed, skipping date:",W);continue}const P=n.chartLoadingProgress.done+1;n.chartLoadingProgress={total:p,done:P},se(Math.min(98,Math.round(P/p*100))),e(x);const q=Se(S);if(!q)throw new Error("No data returned for chart request.");const Y=n.chartLocation==="Draw"&&n.chartPolygon&&n.chartPolygon.length>=3?Hn(q,n.chartVariable,S.shape,n.chartPolygon):(n.chartLocation==="Point"||n.chartLocation==="Search")&&n.chartPoint?Wn(q,n.chartVariable,S.shape,n.chartPoint):dn(q,n.chartVariable);x.push({scenario:$,model:k,rawValue:Y,dateUsed:L})}}n.chartSamples=x,n.chartRangeSeries=Yn(x,n.chartVariable,n.chartUnit),n.chartLoadingProgress={total:p,done:p},se(100)}}}catch(t){n.chartError=t instanceof Ae&&t.statusCode||t instanceof Error?t.message:String(t),n.chartSamples=[],n.chartBoxes=null,n.chartRangeSeries=null,n.chartLoadingProgress={total:1,done:1}}finally{n.chartLoading=!1,Fe()}}async function Pf(){if(!(n.canvasView!=="map"||n.mode!=="Explore")){n.isLoading=!0,se(5,!0),n.dataError=null;try{const e=n.scenario,t=mt(n.date,e);t!==n.date&&(n.date=t);const a=he({variable:n.variable,date:t,model:n.model,scenario:e,resolution:n.resolution});se(40);let r=await Ee(a);se(70);let o=Se(r);if(!o)throw new Error("No data returned for the selected parameters.");let i,s,l;if(n.variable==="hurs"){const c=new Float32Array(o.length);let d=1/0,u=-1/0,h=0,f=0;for(let p=0;p<o.length;p++){const x=o[p];if(!isFinite(x)){c[p]=NaN;continue}const k=Math.min(x,100);c[p]=k,d=Math.min(d,k),u=Math.max(u,k),h+=k,f+=1}l=f>0?h/f:NaN,r={...r,data:c,data_encoding:"none"},o=c,i=d,s=u}else{const c=wi(o);i=c.min,s=c.max,l=dn(o,n.variable)}if(n.currentData=r,n.dataMin=i,n.dataMax=s,n.dataMean=l,n.masks?.length){const c=new Set;for(const d of n.masks)d.variable&&c.add(d.variable);for(const d of c)if(!n.maskVariableData.has(d))try{const u=he({variable:d,date:t,model:n.model,scenario:e,resolution:n.resolution});let h=await Ee(u);if(d==="hurs"){const f=Se(h);if(f){const p=new Float32Array(f.length);for(let x=0;x<f.length;x++){const k=f[x];p[x]=isFinite(k)?Math.min(k,100):NaN}h={...h,data:p,data_encoding:"none"}}}n.maskVariableData.set(d,h)}catch(u){console.warn(`Failed to load mask variable ${d}:`,u)}}if(se(100),n.isLoading=!1,H(),ee){const c=ee.querySelector("#map-canvas");c&&mn(c)}}catch(e){n.dataError=e instanceof Error?e.message:String(e),n.isLoading=!1,se(0,!0),n.currentData=null,n.dataMin=null,n.dataMax=null,n.dataMean=null,H()}}}async function _e(){if(n.__updatingMask){console.log("Skipping loadClimateData - mask update in progress");return}if(console.log("fetching"),n.canvasView==="map"){n.isLoading=!0,se(5,!0),n.dataError=null;try{const e=await wr();n.metaData=e,n.availableModels=e.models,se(20);const t=n.mode==="Compare"&&n.compareMode==="Scenarios"?n.compareScenarioA:n.mode==="Ensemble"&&n.ensembleScenarios.length>0?n.ensembleScenarios[0]:n.scenario;n.timeRange=Ue(t),se(30);const a=n.mode==="Compare"?await Ef(t,se):n.mode==="Ensemble"?await Cf(se):await(async()=>{se(40);const r=mt(n.date,t);r!==n.date&&(n.date=r);const o=he({variable:n.variable,date:r,model:n.model,scenario:n.scenario,resolution:n.resolution});se(55);let i=await Ee(o);se(80);let s=Se(i);if(!s)throw new Error("No data returned for the selected parameters.");if(n.variable==="hurs"){const u=new Float32Array(s.length);let h=1/0,f=-1/0,p=0,x=0;for(let $=0;$<s.length;$++){const w=s[$];if(!isFinite(w)){u[$]=NaN;continue}const b=Math.min(w,100);u[$]=b,h=Math.min(h,b),f=Math.max(f,b),p+=b,x+=1}const k=x>0?p/x:NaN;return i={...i,data:u,data_encoding:"none"},s=u,{data:i,min:h,max:f,mean:k}}const{min:l,max:c}=wi(s),d=dn(s,n.variable);return se(95),{data:i,min:l,max:c,mean:d}})();if(n.currentData=a.data,n.dataMin=a.min,n.dataMax=a.max,n.dataMean=a.mean,n.mode==="Explore"&&n.masks&&n.masks.length>0){const r=mt(n.date,t),o=new Set;for(const i of n.masks)i.variable&&o.add(i.variable);n.maskVariableData.clear();for(const i of o)try{const s=he({variable:i,date:r,model:n.model,scenario:n.scenario,resolution:n.resolution}),l=await Ee(s);if(i==="hurs"){const c=Se(l);if(c){const d=new Float32Array(c.length);for(let u=0;u<c.length;u++){const h=c[u];isFinite(h)?d[u]=Math.min(h,100):d[u]=NaN}n.maskVariableData.set(i,{...l,data:d,data_encoding:"none"})}else n.maskVariableData.set(i,l)}else n.maskVariableData.set(i,l)}catch(s){console.warn(`Failed to load data for mask variable ${i}:`,s)}}if(se(100),n.isLoading=!1,H(),ee){const r=ee.querySelector("#map-canvas");r&&mn(r)}}catch(e){e instanceof Ae&&e.statusCode?n.dataError=e.message:n.dataError=e instanceof Error?e.message:String(e),n.isLoading=!1,se(0,!0),n.currentData=null,n.dataMin=null,n.dataMax=null,n.dataMean=null,H()}}}function If(){return`
      <div style="${g(M.branding)}">
        <div data-role="brand-eye" style="${g(M.brandIcon)}">
          <svg viewBox="0 0 120 80" style="${g(M.brandSvg)}" aria-hidden="true">
            <defs>
              <clipPath id="brand-eye-clip">
                <rect x="0" y="0" width="120" height="80" style="${g(M.brandClipRect)}" />
              </clipPath>
            </defs>
            <g style="${g(M.brandLids)}">
              <path
                d="M10 40c10-15 30-30 50-30s40 15 50 30c-10 15-30 30-50 30S20 55 10 40Z"
                style="${g(M.brandOutline)}"
              />
            </g>
            <g data-role="brand-iris" style="${g(ye(M.brandIrisGroup,M.brandEyeContent))}">
              <circle cx="60" cy="40" r="20" style="${g(M.brandIris)}" />
              <g data-role="brand-pupil" style="${g(M.brandPupilGroup)}">
                <circle cx="60" cy="40" r="10" style="${g(M.brandPupil)}" />
                <circle cx="72" cy="30" r="4" style="${g(M.brandHighlight)}" />
              </g>
            </g>
          </svg>
        </div>
        <span style="${g(M.brandName)}">Polyoracle</span>
      </div>
    `}function H(){if(!ee)return;const e=ee,t=Array.from(e.querySelectorAll(".custom-select-wrapper.open")).map(u=>u.getAttribute("data-key")).filter(u=>!!u),a=(n.resolution-1)/2*100,r=n.mode==="Explore"?"translateX(0%)":n.mode==="Compare"?"translateX(-33.333%)":"translateX(-66.666%)",o=n.mode==="Explore"?"translateX(0%)":n.mode==="Compare"?"translateX(100%)":"translateX(200%)",i=n.canvasView==="map"?"translateX(0%)":"translateX(100%)",s=n.panelTab==="Manual"?"translateX(0%)":"translateX(-50%)";e.innerHTML=`
    <div style="${g(M.page)}">
      <div style="${g(M.bgLayer1)}"></div>
      <div style="${g(M.bgLayer2)}"></div>
      <div style="${g(M.bgOverlay)}"></div>
      ${If()}
        ${n.canvasView==="map"&&n.dataMin!==null&&n.dataMax!==null?Ph(n.mode==="Ensemble"?n.ensembleVariable:n.variable,n.dataMin,n.dataMax,n.metaData,n.mode==="Ensemble"?n.ensembleUnit:n.selectedUnit,n.mode==="Compare"||n.mode==="Ensemble"&&n.ensembleStatistic!=="mean"):""}
      <div style="${g(M.mapArea)}">
        ${n.canvasView==="map"?`
              <canvas
                id="map-canvas"
                style="position: absolute; inset: 0; width: 100%; height: 100%; object-fit: contain; pointer-events: auto;"
              ></canvas>
              ${Bf()}
              ${df()}
              ${uf()}
              ${hf()}
              ${ff()}
              ${Af()}
              ${n.dataError?`<div style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.8); z-index: 10;">
                      <div style="text-align: center; max-width: 600px; padding: 20px;">
                        <div style="${g(M.mapTitle)}">Error loading data</div>
                        <div style="${g(M.mapSubtitle)}">${n.dataError}</div>
                        ${n.apiAvailable===!1?`<div style="${g(ye(M.mapSubtitle,{marginTop:12,fontSize:12}))}">
                                Make sure the Python API server is running. Check the terminal for connection details.
                              </div>`:""}
                      </div>
                    </div>`:""}
              ${!n.isLoading&&!n.dataError&&!n.currentData?`<div style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.5); z-index: 5;">
                      <div style="text-align: center;">
                        <div style="${g(M.mapTitle)}">No data loaded</div>
                        <div style="${g(M.mapSubtitle)}">
                          Adjust parameters to load climate data
                        </div>
                      </div>
                    </div>`:""}
            `:'<div data-role="chart-container" style="pointer-events:auto; width:100%; display:flex; align-items:center; justify-content:center; padding:24px;"></div>'}
      </div>

      <aside data-role="sidebar" class="sidebar" style="width: ${Pe}px; transform: ${n.sidebarOpen?"translateX(0)":`translateX(${Pe+24}px)`}; pointer-events: ${n.sidebarOpen?"auto":"none"}" aria-hidden="${!n.sidebarOpen}">
        <div class="sidebar-top">
          <div class="sidebar-brand">
            <div class="logo-dot"></div>
          </div>
          <div class="tab-switch" style="${g(M.tabSwitch)}">
            ${["Manual","Chat"].map(u=>Nf(u,n.panelTab===u?M.tabBtnActive:void 0,"panel-tab")).join("")}
          </div>
        </div>

        <div class="sidebar-content">
          <div class="tab-viewport">
            <div data-role="tab-track" class="tab-track" style="transform: ${s}">
              <div class="tab-pane">
                ${n.canvasView==="map"?Ff({modeTransform:r,resolutionFill:a,modeIndicatorTransform:o}):Vf()}
              </div>
              <div class="tab-pane">
                ${Uf()}
              </div>
            </div>
          </div>
        </div>
      </aside>

      <div data-role="canvas-toggle" style="${g({...M.canvasToggle,right:n.sidebarOpen?Pe+24:24})}">
        <div style="${g(M.canvasSwitch)}">
          <div data-role="canvas-indicator" style="${g({...M.canvasIndicator,transform:i})}"></div>
          <button
            type="button"
            aria-label="Show map canvas"
            data-action="set-canvas"
            data-value="map"
            style="${g(ye(M.canvasBtn,n.canvasView==="map"?M.canvasBtnActive:void 0))}"
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.6">
              <path d="M4 6.5 9 4l6 2.5L20 4v14l-5 2.5L9 18 4 20.5V6.5Z" />
              <path d="m9 4v14m6-11.5v14" />
            </svg>
          </button>
          <button
            type="button"
            aria-label="Show chart canvas"
            data-action="set-canvas"
            data-value="chart"
            style="${g(ye(M.canvasBtn,n.canvasView==="chart"?M.canvasBtnActive:void 0))}"
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.8">
              <path d="M4 18h16" />
              <path d="M6 18 11 9l4 5 3-6" />
              <circle cx="6" cy="18" r="1.2" />
              <circle cx="11" cy="9" r="1.2" />
              <circle cx="15" cy="14" r="1.2" />
              <circle cx="18" cy="8" r="1.2" />
            </svg>
          </button>
        </div>
      </div>

      ${of(n)}

      ${bh(n.sidebarOpen)}

      ${n.canvasView==="map"?jh({date:n.date,timeRange:n.timeRange,sidebarOpen:n.sidebarOpen,sidebarWidth:Pe,mode:n.mode,compareMode:n.compareMode,compareDateStart:n.compareDateStart,compareDateEnd:n.compareDateEnd}):""}

      ${kh()}
      ${$h(Je())}
    </div>
  `,qf();const l=e.querySelector(".tutorial-box");if(l){const u=l.getBoundingClientRect(),h=16;let f=0,p=0;if(u.right>window.innerWidth-h?f=window.innerWidth-h-u.right:u.left<h&&(f=h-u.left),u.bottom>window.innerHeight-h?p=window.innerHeight-h-u.bottom:u.top<h&&(p=h-u.top),f!==0||p!==0){const x=l.style.transform||"";l.style.transform=`${x} translate(${f}px, ${p}px)`}}if(t.forEach(u=>{const h=e.querySelector(`.custom-select-wrapper[data-key="${u}"]`);h&&h.classList.add("open")}),we=ee.querySelector("#map-canvas"),we&&n.currentData&&!n.dataError&&n.dataMin!==null&&n.dataMax!==null)try{mn(we),zn(n.currentData,we,le,n.palette,n.dataMin,n.dataMax,n.mode==="Ensemble"?n.ensembleVariable:n.variable,n.mode==="Ensemble"?n.ensembleUnit:n.selectedUnit,n.masks,n.mode==="Ensemble"?n.ensembleStatistics:null,n.mode==="Ensemble",n.mode==="Explore"?n.maskVariableData:void 0);const u=le.find(h=>h.name===n.palette)||le[0];Vn("legend-gradient-canvas",u.colors),(n.drawState.active||n.mapPolygon!==null&&n.mapPolygon.length>=3)&&requestAnimationFrame(va)}catch(u){console.error("Map render failed (e.g. changing display variable with masks):",u)}const c=(n.sidebarOpen?Pe+24:24)+8,d=n.sidebarOpen?1:.9;xi(c,d),$i(),n.canvasView==="chart"&&Fe()}function Af(){if(!n.isLoading)return"";const e=Math.max(0,Math.min(100,Math.round(n.loadingProgress)));return`
      <div style="${g(M.loadingIndicator)}">
        <div style="${g(M.loadingSpinner)}"></div>
        <div style="${g(M.loadingTextGroup)}">
          <div style="${g(M.loadingText)}">Loading data · ${e}%</div>
          <div style="${g(M.loadingBar)}">
            <div style="${g({...M.loadingBarFill,width:`${e}%`})}"></div>
          </div>
          <div style="${g(M.loadingSubtext)}">Fetching climate tiles</div>
        </div>
      </div>
    `}function Rf(){return`
      <div style="position:absolute; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none;">
      </div>
    `}function Sr(e){if(!Number.isFinite(e))return"-";const t=Math.abs(e);return t>=1e3?e.toFixed(0):t>=100?e.toFixed(1):t>=1?e.toFixed(2):e.toPrecision(2)}function go(e){if(!e.length)return`<div style="${g(M.chartEmpty)}">No chart data loaded yet.</div>`;const t=[...e].sort((T,S)=>Me.indexOf(T.scenario)-Me.indexOf(S.scenario)),r=(le.find(T=>T.name===n.palette)||le[0]).colors,o=900,i=440,s={top:26,right:36,bottom:70,left:86},l=o-s.left-s.right,c=i-s.top-s.bottom,d=t.flatMap(T=>[T.stats.min,T.stats.max]),u=Math.min(...d),h=Math.max(...d),f=Math.max(Math.abs(h-u)*.12,1e-6),p=fa().domain([u-f,h+f]).range([c,0]),x=p.ticks(6),k=l/(t.length+1),$=x.map(T=>{const S=p(T)+s.top;return`
        <g>
          <line x1="${s.left}" x2="${o-s.right}" y1="${S}" y2="${S}" stroke="rgba(255,255,255,0.08)" />
          <text x="${s.left-10}" y="${S+4}" fill="var(--text-secondary)" font-size="11" text-anchor="end">
            ${Sr(T)}
          </text>
        </g>
      `}).join(""),w=t.map((T,S)=>{const P=s.left+k*(S+1),q=r[S%r.length],{min:Y,q1:W,median:O,q3:j,max:U,mean:y}=T.stats,F=p(j)+s.top,C=p(W)+s.top,m=Math.max(2,C-F),v=p(Y)+s.top,D=p(U)+s.top;return`
        <g data-boxplot-idx="${S}" class="boxplot-group">
          <line x1="${P}" x2="${P}" y1="${v}" y2="${D}" stroke="${q}" stroke-width="2" stroke-linecap="round" />
          <rect x="${P-24}" y="${F}" width="48" height="${m}" fill="rgba(255,255,255,0.06)" stroke="${q}" stroke-width="2" rx="6" />
          <line x1="${P-24}" x2="${P+24}" y1="${p(O)+s.top}" y2="${p(O)+s.top}" stroke="${q}" stroke-width="2.4" />
          <circle cx="${P}" cy="${p(y)+s.top}" r="4" fill="${q}" stroke="rgba(0,0,0,0.55)" stroke-width="1" />
          <text x="${P}" y="${i-s.bottom+32}" fill="var(--text-primary)" font-weight="700" font-size="12" text-anchor="middle">${T.scenario}</text>
          <text x="${P}" y="${i-s.bottom+48}" fill="var(--text-secondary)" font-size="11" text-anchor="middle">${T.samples.length} model${T.samples.length===1?"":"s"}</text>
          <rect x="${P-35}" y="${s.top}" width="70" height="${c}" fill="transparent" class="boxplot-hover-area" style="cursor: pointer; pointer-events: all;" />
        </g>
      `}).join(""),b=t.map((T,S)=>{const q=s.left+k*(S+1)+30,Y=q,W=q+6,O=W+6,j=T.samples.map(C=>{const m=p(C.value)+s.top;return{model:C.model,value:C.value,y:m}}).sort((C,m)=>C.y-m.y),U=12,y=[];return j.forEach((C,m)=>{if(m===0)y.push({...C,adjustedY:C.y});else{const D=y[m-1].adjustedY+U;y.push({...C,adjustedY:Math.max(C.y,D)})}}),y.map(C=>{const m=C.adjustedY||C.y;return`
                    <g class="model-indicator" data-boxplot-idx="${S}">
                      <line x1="${Y}" x2="${W}" y1="${C.y}" y2="${C.y}" stroke="white" stroke-width="1" stroke-linecap="round" />
                      <text x="${O}" y="${m+4}" fill="white" font-size="10" font-weight="300" opacity="0.95">${C.model}</text>
                    </g>
                  `}).join("")}).join(""),L=`
      <line
        x1="${s.left}"
        x2="${s.left}"
        y1="${s.top}"
        y2="${i-s.bottom}"
        stroke="rgba(255,255,255,0.65)"
        stroke-width="1.2"
      />
    `,E=`
      <text
        x="${s.left-70}"
        y="${s.top+c/2}"
        fill="var(--text-secondary)"
        font-size="12"
        text-anchor="middle"
        transform="rotate(-90 ${s.left-70} ${s.top+c/2})"
      >
        ${n.chartUnit}
      </text>
    `;return`
      <svg viewBox="0 0 ${o} ${i}" role="img" aria-label="Global box plots" preserveAspectRatio="xMidYMid meet" style="width:100%; height:auto;">
        ${L}
        ${$}
        ${w}
        <g class="boxplot-hover-overlay" style="opacity: 0; pointer-events: none;">
          ${b}
        </g>
        ${E}
      </svg>
    `}function yo(e,t){if(!e.length)return`<div style="${g(M.chartEmpty)}">No chart data loaded yet.</div>`;const a=[...e].sort((E,T)=>Me.indexOf(E.scenario)-Me.indexOf(T.scenario)),o=(le.find(E=>E.name===n.palette)||le[0]).colors,i=560,s=300,l={top:18,right:16,bottom:52,left:48},c=i-l.left-l.right,d=s-l.top-l.bottom,u=a.flatMap(E=>[E.stats.min,E.stats.max]),h=Math.min(...u),f=Math.max(...u),p=Math.max(Math.abs(f-h)*.12,1e-6),x=fa().domain([h-p,f+p]).range([d,0]),k=x.ticks(4),$=c/(a.length+1),w=k.map(E=>{const T=x(E)+l.top;return`
        <g>
          <line x1="${l.left}" x2="${i-l.right}" y1="${T}" y2="${T}" stroke="rgba(255,255,255,0.06)" />
          <text x="${l.left-8}" y="${T+3}" fill="var(--text-secondary)" font-size="9" text-anchor="end">
            ${Sr(E)}
          </text>
        </g>
      `}).join(""),b=a.map((E,T)=>{const S=l.left+$*(T+1),P=o[T%o.length],{min:q,q1:Y,median:W,q3:O,max:j,mean:U}=E.stats,y=x(O)+l.top,F=x(Y)+l.top,C=Math.max(2,F-y);return`
        <g>
          <line x1="${S}" x2="${S}" y1="${x(q)+l.top}" y2="${x(j)+l.top}" stroke="${P}" stroke-width="1.6" stroke-linecap="round" />
          <rect x="${S-16}" y="${y}" width="32" height="${C}" fill="rgba(255,255,255,0.06)" stroke="${P}" stroke-width="1.6" rx="5" />
          <line x1="${S-16}" x2="${S+16}" y1="${x(W)+l.top}" y2="${x(W)+l.top}" stroke="${P}" stroke-width="2" />
          <circle cx="${S}" cy="${x(U)+l.top}" r="3.2" fill="${P}" stroke="rgba(0,0,0,0.55)" stroke-width="0.8" />
          <text x="${S}" y="${s-l.bottom+26}" fill="var(--text-primary)" font-weight="700" font-size="10" text-anchor="middle">${E.scenario}</text>
          <text x="${S}" y="${s-l.bottom+40}" fill="var(--text-secondary)" font-size="9" text-anchor="middle">${E.samples.length} model${E.samples.length===1?"":"s"}</text>
        </g>
      `}).join(""),L=`
      <line
        x1="${l.left}"
        x2="${l.left}"
        y1="${l.top}"
        y2="${s-l.bottom}"
        stroke="rgba(255,255,255,0.55)"
        stroke-width="1"
      />
    `;return`
      <svg viewBox="0 0 ${i} ${s}" role="img" aria-label="Mini box plots" preserveAspectRatio="xMidYMid meet" style="width:100%; height:auto;">
        ${L}
        ${w}
        ${b}
        <text x="${l.left}" y="${l.top-6}" fill="var(--text-secondary)" font-size="9">${Ce(t)}</text>
      </svg>
    `}function vo(e){if(!e.length)return`<div style="${g(M.chartEmpty)}">No chart data loaded yet.</div>`;const a=(le.find(U=>U.name===n.palette)||le[0]).colors,r=960,o=460,i={top:28,right:32,bottom:82,left:86},s=r-i.left-i.right,l=o-i.top-i.bottom,c=e.flatMap(U=>U.points),d=c.map(U=>J(U.date)),u=zi(d),h=qi(d);if(!u||!h)return`<div style="${g(M.chartEmpty)}">No chart data loaded yet.</div>`;const f=1440*60*1e3,p=new Date(u.getTime()-f*.25),x=new Date(h.getTime()+f*.25),k=nh().domain([p,x]).range([0,s]),$=k.ticks(6),w=vr("%b %Y"),b=c.flatMap(U=>[U.stats.min,U.stats.max]),L=Math.min(...b),E=Math.max(...b),T=Math.max(Math.abs(E-L)*.12,1e-6),S=fa().domain([L-T,E+T]).range([l,0]),q=S.ticks(6).map(U=>{const y=S(U)+i.top;return`
        <g>
          <line x1="${i.left}" x2="${r-i.right}" y1="${y}" y2="${y}" stroke="rgba(255,255,255,0.08)" />
          <text x="${i.left-10}" y="${y+4}" fill="var(--text-secondary)" font-size="11" text-anchor="end">
            ${Sr(U)}
          </text>
        </g>
      `}).join(""),Y=$.map(U=>{const y=k(U)+i.left;return`
        <g>
          <line x1="${y}" x2="${y}" y1="${i.top}" y2="${o-i.bottom}" stroke="rgba(255,255,255,0.06)" />
          <text x="${y}" y="${o-i.bottom+26}" fill="var(--text-secondary)" font-size="11" text-anchor="middle">
            ${w(U)}
          </text>
        </g>
      `}).join(""),W=Math.max(Le.length,4),O=e.map((U,y)=>{if(!U.points.length)return"";const F=a[y%a.length],C=U.points.map(B=>{const I=Array.from({length:W+1},(_,V)=>{const z=V/W;return B.stats.min+(B.stats.max-B.stats.min)*z});return{point:B,levels:I}}),m=B=>{const I=C.map(({point:V,levels:z})=>{const K=k(J(V.date))+i.left,Z=S(z[B+1])+i.top;return`${K},${Z}`}).join(" L "),_=[...C].reverse().map(({point:V,levels:z})=>{const K=k(J(V.date))+i.left,Z=S(z[B])+i.top;return`${K},${Z}`}).join(" L ");return`M ${I} L ${_} Z`},v=Array.from({length:W},(B,I)=>{const _=m(I),V=W/2,K=.55*(1-Math.min(Math.abs(I+.5-V)/V,1))+.08;return`<path d="${_}" fill="${F}" fill-opacity="${K.toFixed(3)}" stroke="none" />`}).join(""),D=U.points.map((B,I)=>{const _=k(J(B.date))+i.left,V=S(B.stats.median)+i.top;return`${I===0?"M":"L"} ${_} ${V}`}).join(" "),A=U.points.map((B,I)=>{const _=k(J(B.date))+i.left,V=S(B.stats.mean)+i.top;return`${I===0?"M":"L"} ${_} ${V}`}).join(" ");return`
        <g>
          ${v}
          <path d="${D}" fill="none" stroke="${F}" stroke-width="2.2" />
          <path d="${A}" fill="none" stroke="${F}" stroke-width="1.6" stroke-dasharray="6 6" stroke-opacity="0.9" />
          <circle cx="${k(J(U.points[U.points.length-1].date))+i.left}" cy="${S(U.points[U.points.length-1].stats.median)+i.top}" r="4" fill="${F}" stroke="rgba(0,0,0,0.4)" stroke-width="1" />
        </g>
      `}).join(""),j=`
      <text
        x="${i.left-70}"
        y="${i.top+l/2}"
        fill="var(--text-secondary)"
        font-size="12"
        text-anchor="middle"
        transform="rotate(-90 ${i.left-70} ${i.top+l/2})"
      >
        ${n.chartUnit}
      </text>
    `;return`
      <div style="width:100%; display:flex; flex-direction:column; gap:12px; align-items:center;">
        <div style="position:relative; width:100%; display:flex; justify-content:center;">
          <div style="position:absolute; top:10px; right:16px; display:flex; gap:12px; align-items:center; color:var(--text-secondary); font-size:11.5px; z-index:2;">
            <div style="display:flex; align-items:center; gap:6px;">
              <span style="display:inline-block; width:26px; height:0; border-top:1px solid var(--text-primary);"></span>
              <span>Median</span>
            </div>
            <div style="display:flex; align-items:center; gap:6px;">
              <span style="display:inline-block; width:26px; height:0; border-top:1px dashed var(--text-primary);"></span>
              <span>Mean</span>
            </div>
          </div>
          <svg viewBox="0 0 ${r} ${o}" role="img" aria-label="Distribution over time" preserveAspectRatio="xMidYMid meet" style="width:100%; height:auto;">
            ${q}
            ${Y}
            <path
              d="M ${i.left} ${i.top} L ${i.left} ${o-i.bottom} L ${r-i.right} ${o-i.bottom}"
              fill="none"
              stroke="rgba(255,255,255,0.6)"
              stroke-width="1.2"
              stroke-linecap="round"
            />
            ${O}
            ${j}
          </svg>
        </div>
        <div style="${g(M.chartLegend)}">
          ${e.map((U,y)=>`
            <div style="display:flex; align-items:center; gap:8px; font-size:12; color:var(--text-secondary);">
              <span style="display:inline-block; width:16px; height:8px; background:${a[y%a.length]}; border-radius:999px;"></span>
              <span style="color:var(--text-primary); font-weight:700;">${U.scenario}</span>
            </div>
          `).join("")}
        </div>
      </div>
    `}function ae(e,t){return`
    <div style="${g(M.field)}">
      ${e?`<div style="${g(M.fieldLabel)}">${e}</div>`:""}
      ${t}
    </div>
  `}function et(e,t,a){const r=a?.type??"date",o=a?.dataKey??e,i=a?.min?`min="${a.min}"`:"",s=a?.max?`max="${a.max}"`:"",l=a?.dataRole?`data-role="${a.dataRole}"`:"";return`
    <input
      type="${r}"
      value="${t}"
      data-action="update-input"
      data-key="${o}"
      ${i}
      ${s}
      ${l}
    />
  `}function ne(e,t,a,r){const o=r?.dataKey??e,i=r?.disabled?"disabled":"",s=`custom-select-${o}-${Math.random().toString(36).substr(2,9)}`,l=r?.infoType,c=Ce(r?.selectedLabel??a),d=r?.extraContent??"",u=r?.dataRole?`data-role="${r.dataRole}"`:"";return`
    <div class="custom-select-container">
      <div class="custom-select-info-panel" id="${s}-info" role="tooltip"></div>
      <div class="custom-select-wrapper" ${u} data-key="${o}" ${i?'data-disabled="true"':""} ${l?`data-info-type="${l}"`:""}>
        <div class="custom-select-trigger" data-action="update-select" data-key="${o}" id="${s}-trigger" ${i?'aria-disabled="true"':""} tabindex="${i?"-1":"0"}">
          <span class="custom-select-value">${c}</span>
          <svg class="custom-select-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="custom-select-dropdown" id="${s}-dropdown" role="listbox">
          ${t.map(h=>`
                <div class="custom-select-option ${h===a?"selected":""}" 
                     data-value="${h}" 
                     data-action="update-select" 
                     data-key="${o}"
                     role="option"
                     ${h===a?'aria-selected="true"':""}
                     tabindex="0">
                  ${o==="ensembleStatistic"||o==="maskStatistic"?h==="mean"?"Mean":h==="median"?"Median":h==="std"?"Std":h==="iqr"?"IQR":h==="percentile"?"Percentile":h==="extremes"?"Extremes":h:h}
                </div>
              `).join("")}
          ${d}
        </div>
      </div>
    </div>
  `}function Nf(e,t,a="panel-tab"){return`
    <button
      type="button"
      data-action="set-tab"
      data-key="${a}"
      data-value="${e}"
      style="${g(ye(M.tabBtn,t))}"
    >
      ${e}
    </button>
  `}function Ff(e){const{modeTransform:t,resolutionFill:a,modeIndicatorTransform:r}=e,o=(s,l,c,d,u)=>`
          <div style="${g({border:"1px solid var(--border-medium)",borderRadius:12,background:"var(--bg-subtle)",padding:"10px 12px"})}">
            <button
              type="button"
              data-action="toggle-collapse"
              data-key="${u}"
              style="${g({display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",background:"transparent",border:"none",color:"var(--text-primary)",fontWeight:700,fontSize:13,cursor:"pointer",padding:0})}"
            >
              <span>${s}</span>
              <span style="${g({color:"var(--text-secondary)",fontWeight:600,fontSize:12})}">${c} ${l?"▴":"▾"}</span>
            </button>
            ${l?`<div style="${g({marginTop:10,display:"flex",flexWrap:"wrap",gap:8})}">${d}</div>`:""}
          </div>
        `,i=n.compareMode==="Models"?[ae("Scenario",ne("scenario",Me,n.scenario,{infoType:"scenario"})),ae("Date",et("date",n.date))]:n.compareMode==="Dates"?[ae("Scenario",ne("scenario",Me,n.scenario,{infoType:"scenario"})),ae("Model",ne("model",ge,n.model,{infoType:"model"}))]:[ae("Model",ne("model",ge,n.model,{infoType:"model"})),ae("Date",et("date",n.date))];return`
    <div style="${g(M.modeSwitch)}">
      <div data-role="mode-indicator" style="${g({...M.modeIndicator,transform:r})}"></div>
      ${["Explore","Compare","Ensemble"].map(s=>`
            <button
              type="button"
              class="mode-btn"
              data-action="set-mode"
              data-value="${s}"
              style="${g(ye(M.modeBtn,n.mode===s?M.modeBtnActive:void 0))}"
            >
              ${s}
            </button>
          `).join("")}
    </div>

    <div style="${g(M.modeViewport)}">
      <div data-role="mode-track" style="${g({...M.modeTrack,transform:t})}">
        <div class="mode-pane-scrollable" style="${g(M.modePane)}">
          <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
            <div style="${g(M.sectionTitle)}">Parameters</div>
            <div style="${g(M.paramGrid)}">
              ${ae("Scenario",ne("scenario",Me,n.scenario,{infoType:"scenario",dataRole:"scenario-selector"}))}
              ${ae("Model",ne("model",ge,n.model,{infoType:"model",dataRole:"model-selector"}))}
              ${ae("Date",(()=>{const s=Ue(n.scenario);return et("date",n.date,{min:s.start,max:s.end,dataRole:"date-picker"})})())}
              ${ae("Variable",ne("variable",Le,n.variable,{infoType:"variable",dataRole:"variable-selector"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${g(M.sectionTitle)}">Unit</div>
              ${ae("",ne("unit",Be(n.variable).map(s=>s.label),n.selectedUnit,{dataKey:"unit",dataRole:"unit-selector"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${g(M.sectionTitle)}">Color palette</div>
              ${ae("",ne("palette",le.map(s=>s.name),n.palette,{dataKey:"palette",dataRole:"palette-selector"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${g(M.sectionTitle)}">Resolution</div>
              <div style="${g(M.resolutionRow)}">
                <input
                  type="range"
                  min="1"
                  max="3"
                  step="1"
                  value="${n.resolution}"
                  data-action="set-resolution"
                  class="resolution-slider"
                  style="${g(ye(M.range,{"--slider-fill":`${a}%`}))}"
                />
                <div data-role="resolution-value" style="${g(M.resolutionValue)}">${n.resolution===1?"Low":n.resolution===2?"Medium":"High"}</div>
              </div>
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${g(M.sectionTitle)}">Mask</div>
              ${n.masks.length>0?`
                      <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
                        ${n.masks.map((s,l)=>`
                          ${n.mode==="Ensemble"?`
                                  <div style="${g({display:"flex",alignItems:"center",gap:8,marginBottom:4})}">
                                    ${ne("maskStatistic",["mean","std","median","iqr","percentile","extremes"],s.statistic||"mean",{dataKey:"maskStatistic",selectedLabel:s.statistic==="mean"?"Mean":s.statistic==="std"?"Std":s.statistic==="median"?"Median":s.statistic==="iqr"?"IQR":s.statistic==="percentile"?"Percentile":s.statistic==="extremes"?"Extremes":"Mean"}).replace('class="custom-select-wrapper"',`class="custom-select-wrapper" data-mask-index="${l}" style="width: 100px;"`)}
                                  </div>
                                  `:n.mode==="Explore"?`
                                  <div style="${g({display:"flex",alignItems:"center",gap:8,marginBottom:4})}">
                                    ${ne("maskVariable",Le,s.variable||n.variable,{dataKey:"maskVariable",infoType:"variable"}).replace('class="custom-select-wrapper"',`class="custom-select-wrapper" data-mask-index="${l}" style="width: 140px;"`)}
                                    ${ne("maskUnit",Be(s.variable||n.variable).map(c=>c.label),s.unit||ze(s.variable||n.variable).label,{dataKey:"maskUnit"}).replace('class="custom-select-wrapper"',`class="custom-select-wrapper" data-mask-index="${l}" style="width: 120px;"`)}
                                  </div>
                                  `:""}
                          <div style="${g({display:"flex",alignItems:"center",gap:8})}">
                            <input
                              type="number"
                              step="any"
                              value="${s.lowerEdited&&s.lowerBound!==null?s.lowerBound:""}"
                              data-action="update-mask-bound"
                              data-mask-index="${l}"
                              data-bound="lower"
                              placeholder="${n.dataMin!==null?n.dataMin.toFixed(2):""}"
                              style="${g({width:"90px",background:"var(--gradient-bg)",border:"1px solid var(--border-strong)",borderRadius:8,color:"var(--text-primary)",padding:"6px 10px",fontSize:12.5,fontWeight:600,fontFamily:"var(--font-geist-sans)",letterSpacing:.25,minHeight:32,boxShadow:"inset 0 1px 0 var(--inset-light)"})}"
                            />
                            <span style="${g({fontSize:12.5,color:"var(--text-secondary)",minWidth:"20px",textAlign:"center"})}">to</span>
                            <input
                              type="number"
                              step="any"
                              value="${s.upperEdited&&s.upperBound!==null?s.upperBound:""}"
                              data-action="update-mask-bound"
                              data-mask-index="${l}"
                              data-bound="upper"
                              placeholder="${n.dataMax!==null?n.dataMax.toFixed(2):""}"
                              style="${g({width:"90px",background:"var(--gradient-bg)",border:"1px solid var(--border-strong)",borderRadius:8,color:"var(--text-primary)",padding:"6px 10px",fontSize:12.5,fontWeight:600,fontFamily:"var(--font-geist-sans)",letterSpacing:.25,minHeight:32,boxShadow:"inset 0 1px 0 var(--inset-light)"})}"
                            />
                            <button
                              type="button"
                              data-action="remove-mask"
                              data-mask-index="${l}"
                              style="${g({width:28,height:28,padding:0,borderRadius:6,border:"1px solid var(--border-medium)",background:"var(--bg-transparent)",color:"var(--text-secondary)",fontSize:16,fontWeight:600,cursor:"pointer",transition:"all 0.15s ease",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0})}"
                              onmouseover="this.style.borderColor='var(--border-bright)'; this.style.background='var(--bg-medium)'"
                              onmouseout="this.style.borderColor='var(--border-medium)'; this.style.background='var(--bg-transparent)'"
                            >
                              −
                            </button>
                          </div>
                        `).join("")}
                        <button
                          type="button"
                          data-action="apply-masks"
                          style="${g({padding:"10px 16px",borderRadius:10,border:"1px solid var(--border-strong)",background:"var(--gradient-primary)",color:"white",fontSize:12.5,fontWeight:700,cursor:"pointer",transition:"all 0.15s ease",textAlign:"center",width:"100%",marginTop:8,boxShadow:"var(--shadow-combined)"})}"
                          onmouseover="this.style.borderColor='var(--accent-border-bright)'; this.style.boxShadow='var(--shadow-elevated)'"
                          onmouseout="this.style.borderColor='var(--border-strong)'; this.style.boxShadow='var(--shadow-combined)'"
                        >
                          Apply Masks
                        </button>
                        <button
                          type="button"
                          data-action="add-mask"
                          style="${g({padding:"8px 14px",borderRadius:10,border:"1px solid var(--border-subtle)",background:"var(--bg-transparent)",color:"var(--text-secondary)",fontSize:12.5,fontWeight:600,cursor:"pointer",transition:"all 0.15s ease",textAlign:"left",width:"100%",marginTop:4})}"
                          onmouseover="this.style.borderColor='var(--border-medium)'; this.style.background='var(--bg-subtle)'"
                          onmouseout="this.style.borderColor='var(--border-subtle)'; this.style.background='var(--bg-transparent)'"
                        >
                          + Add Mask
                        </button>
                      </div>
                      `:`
                      <button
                        type="button"
                        data-action="add-mask"
                        style="${g({padding:"8px 14px",borderRadius:10,border:"1px solid var(--border-subtle)",background:"var(--bg-transparent)",color:"var(--text-secondary)",fontSize:12.5,fontWeight:600,cursor:"pointer",transition:"all 0.15s ease",textAlign:"left",width:"100%"})}"
                        onmouseover="this.style.borderColor='var(--border-medium)'; this.style.background='var(--bg-subtle)'"
                        onmouseout="this.style.borderColor='var(--border-subtle)'; this.style.background='var(--bg-transparent)'"
                      >
                        + Add Mask
                      </button>
                      `}
            </div>
          </div>
        </div>

                <div class="mode-pane-scrollable" style="${g(M.modePane)}">
                    <div data-role="compare-parameters" style="${g({display:"flex",flexDirection:"column",gap:14})}">
            <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${g(M.sectionTitle)}">Compare</div>
              <div style="${g(M.paramGrid)}">
                ${ae("What do you want to compare?",ne("compareMode",["Scenarios","Models","Dates"],n.compareMode,{dataKey:"compareMode"}))}
              </div>

              ${n.compareMode==="Scenarios"?`
                      <div style="${g(M.paramGrid)}">
                        ${ae("Scenario A",ne("compareScenarioA",["SSP245","SSP370","SSP585"],n.compareScenarioA,{dataKey:"compareScenarioA",infoType:"scenario"}))}
                        ${ae("Scenario B",ne("compareScenarioB",["SSP245","SSP370","SSP585"],n.compareScenarioB,{dataKey:"compareScenarioB",infoType:"scenario"}))}
                      </div>
                    `:""}

              ${n.compareMode==="Models"?`
                      <div style="${g(M.paramGrid)}">
                        ${ae("Model A",ne("compareModelA",(()=>{const s=ge.filter(l=>l!==n.compareModelB);return s.includes(n.compareModelA)?s:[n.compareModelA,...s]})(),n.compareModelA,{dataKey:"compareModelA",infoType:"model"}))}
                        ${ae("Model B",ne("compareModelB",(()=>{const s=ge.filter(l=>l!==n.compareModelA);return s.includes(n.compareModelB)?s:[n.compareModelB,...s]})(),n.compareModelB,{dataKey:"compareModelB",infoType:"model"}))}
                      </div>
                    `:""}

              ${n.compareMode==="Dates"?`
                      <div style="${g(M.paramGrid)}">
                        ${ae("Start date",et("compareDateStart",n.compareDateStart,{dataKey:"compareDateStart"}))}
                        ${ae("End date",et("compareDateEnd",n.compareDateEnd,{dataKey:"compareDateEnd"}))}
  </div>
`:""}

              <div style="${g(M.paramGrid)}">
                ${i.join("")}
                ${ae("Variable",ne("variable",Le,n.variable,{infoType:"variable"}))}
              </div>

              <div style="margin-top:14px">
                <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
                  <div style="${g(M.sectionTitle)}">Unit</div>
                  ${ae("",ne("unit",Be(n.variable).map(s=>s.label),n.selectedUnit,{dataKey:"unit"}))}
                </div>
              </div>

              <div style="margin-top:14px">
                <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
                  <div style="${g(M.sectionTitle)}">Color palette</div>
                  ${ae("",ne("palette",le.map(s=>s.name),n.palette,{dataKey:"palette"}))}
                </div>
              </div>

              <div style="margin-top:14px">
                <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
                  <div style="${g(M.sectionTitle)}">Resolution</div>
                  <div style="${g(M.resolutionRow)}">
                    <input
                      type="range"
                      min="1"
                      max="3"
                      step="1"
                      value="${n.resolution}"
                      data-action="set-resolution"
                      class="resolution-slider"
                      style="${g(ye(M.range,{"--slider-fill":`${a}%`}))}"
                    />
                    <div data-role="resolution-value" style="${g(M.resolutionValue)}">${n.resolution===1?"Low":n.resolution===2?"Medium":"High"}</div>
                  </div>
                </div>
              </div>

              <div style="margin-top:14px">
                <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
                  <div style="${g(M.sectionTitle)}">Mask</div>
                  ${n.masks.length>0?`
                          <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
                            ${n.masks.map((s,l)=>`
                              <div style="${g({display:"flex",alignItems:"center",gap:8})}">
                                ${n.mode==="Ensemble"?ne("maskStatistic",["mean","std","median","iqr","percentile","extremes"],s.statistic||"mean",{dataKey:"maskStatistic",selectedLabel:s.statistic==="mean"?"Mean":s.statistic==="std"?"Std":s.statistic==="median"?"Median":s.statistic==="iqr"?"IQR":s.statistic==="percentile"?"Percentile":s.statistic==="extremes"?"Extremes":"Mean"}).replace('data-key="maskStatistic"',`data-key="maskStatistic" data-mask-index="${l}"`).replace('class="custom-select-wrapper"',`class="custom-select-wrapper" data-mask-index="${l}"`):n.mode==="Explore"?`
                                            ${ne("maskVariable",Le,s.variable||n.variable,{dataKey:"maskVariable",infoType:"variable"}).replace('class="custom-select-wrapper"',`class="custom-select-wrapper" data-mask-index="${l}" style="width: 140px;"`)}
                                            ${ne("maskUnit",Be(s.variable||n.variable).map(c=>c.label),s.unit||ze(s.variable||n.variable).label,{dataKey:"maskUnit"}).replace('class="custom-select-wrapper"',`class="custom-select-wrapper" data-mask-index="${l}" style="width: 120px;"`)}
                                          `:""}
                                <input
                                  type="number"
                                  step="any"
                                  value="${s.lowerEdited&&s.lowerBound!==null?s.lowerBound:""}"
                                  data-action="update-mask-bound"
                                  data-mask-index="${l}"
                                  data-bound="lower"
                                  placeholder="${n.dataMin!==null?n.dataMin.toFixed(2):""}"
                                  style="${g({width:"90px",background:"var(--gradient-bg)",border:"1px solid var(--border-strong)",borderRadius:8,color:"var(--text-primary)",padding:"6px 10px",fontSize:12.5,fontWeight:600,fontFamily:"var(--font-geist-sans)",letterSpacing:.25,minHeight:32,boxShadow:"inset 0 1px 0 var(--inset-light)"})}"
                                />
                                <span style="${g({fontSize:12.5,color:"var(--text-secondary)",minWidth:"20px",textAlign:"center"})}">to</span>
                                <input
                                  type="number"
                                  step="any"
                                  value="${s.upperEdited&&s.upperBound!==null?s.upperBound:""}"
                                  data-action="update-mask-bound"
                                  data-mask-index="${l}"
                                  data-bound="upper"
                                  placeholder="${n.dataMax!==null?n.dataMax.toFixed(2):""}"
                                  style="${g({width:"90px",background:"var(--gradient-bg)",border:"1px solid var(--border-strong)",borderRadius:8,color:"var(--text-primary)",padding:"6px 10px",fontSize:12.5,fontWeight:600,fontFamily:"var(--font-geist-sans)",letterSpacing:.25,minHeight:32,boxShadow:"inset 0 1px 0 var(--inset-light)"})}"
                                />
                                <button
                                  type="button"
                                  data-action="remove-mask"
                                  data-mask-index="${l}"
                                  style="${g({width:28,height:28,padding:0,borderRadius:6,border:"1px solid var(--border-medium)",background:"var(--bg-transparent)",color:"var(--text-secondary)",fontSize:16,fontWeight:600,cursor:"pointer",transition:"all 0.15s ease",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0})}"
                                  onmouseover="this.style.borderColor='var(--border-bright)'; this.style.background='var(--bg-medium)'"
                                  onmouseout="this.style.borderColor='var(--border-medium)'; this.style.background='var(--bg-transparent)'"
                                >
                                  −
                                </button>
                              </div>
                            `).join("")}
                            <button
                              type="button"
                              data-action="add-mask"
                              style="${g({padding:"8px 14px",borderRadius:10,border:"1px solid var(--border-subtle)",background:"var(--bg-transparent)",color:"var(--text-secondary)",fontSize:12.5,fontWeight:600,cursor:"pointer",transition:"all 0.15s ease",textAlign:"left",width:"100%",marginTop:4})}"
                              onmouseover="this.style.borderColor='var(--border-medium)'; this.style.background='var(--bg-subtle)'"
                              onmouseout="this.style.borderColor='var(--border-subtle)'; this.style.background='var(--bg-transparent)'"
                            >
                              + Add Mask
                            </button>
                          </div>
                          `:`
                          <button
                            type="button"
                            data-action="add-mask"
                            style="${g({padding:"8px 14px",borderRadius:10,border:"1px solid var(--border-subtle)",background:"var(--bg-transparent)",color:"var(--text-secondary)",fontSize:12.5,fontWeight:600,cursor:"pointer",transition:"all 0.15s ease",textAlign:"left",width:"100%"})}"
                            onmouseover="this.style.borderColor='var(--border-medium)'; this.style.background='var(--bg-subtle)'"
                            onmouseout="this.style.borderColor='var(--border-subtle)'; this.style.background='var(--bg-transparent)'"
                          >
                            + Add Mask
                          </button>
                          `}
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="mode-pane-scrollable" style="${g(M.modePane)}">
          <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
            <div style="${g(M.sectionTitle)}">Parameters</div>
            <div style="${g(M.paramGrid)}">
              ${ae("Date",(()=>{const s=Kt(n.ensembleScenarios.length?n.ensembleScenarios:Me);return et("ensembleDate",n.ensembleDate,{dataKey:"ensembleDate",min:s.start,max:s.end})})())}
              ${ae("Variable",ne("ensembleVariable",Le,n.ensembleVariable,{dataKey:"ensembleVariable",infoType:"variable"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${g(M.sectionTitle)}">Statistic</div>
              ${ae("",ne("ensembleStatistic",["mean","median","std","iqr","percentile","extremes"],n.ensembleStatistic,{dataKey:"ensembleStatistic",selectedLabel:n.ensembleStatistic==="mean"?"Mean":n.ensembleStatistic==="median"?"Median":n.ensembleStatistic==="std"?"Std Deviation":n.ensembleStatistic==="iqr"?"IQR (Interquartile Range)":n.ensembleStatistic==="percentile"?"Percentile Band (90th-10th)":"Extremes (Max-Min)"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            ${o("Scenarios",n.ensembleDropdown.scenariosOpen,`${n.ensembleScenarios.length} selected`,Ut(n.metaData?.scenarios?.length?Array.from(new Set(n.metaData.scenarios.map(_t))):Me,n.ensembleScenarios,"ensembleScenarios"),"ensembleScenarios")}
          </div>

          <div style="margin-top:14px">
            ${o("Models",n.ensembleDropdown.modelsOpen,`${n.ensembleModels.length} selected`,Ut(n.metaData?.models?.length?n.metaData.models:ge,n.ensembleModels,"ensembleModels"),"ensembleModels")}
          </div>

          <div style="margin-top:14px">
            <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${g(M.sectionTitle)}">Unit</div>
              ${ae("",ne("ensembleUnit",Be(n.ensembleVariable).map(s=>s.label),n.ensembleUnit,{dataKey:"ensembleUnit"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${g(M.sectionTitle)}">Color palette</div>
              ${ae("",ne("palette",le.map(s=>s.name),n.palette,{dataKey:"palette",dataRole:"palette-selector"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${g(M.sectionTitle)}">Resolution</div>
              <div style="${g(M.resolutionRow)}">
                <input
                  type="range"
                  min="1"
                  max="3"
                  step="1"
                  value="${n.resolution}"
                  data-action="set-resolution"
                  class="resolution-slider"
                  style="${g(ye(M.range,{"--slider-fill":`${a}%`}))}"
                />
                <div data-role="resolution-value" style="${g(M.resolutionValue)}">${n.resolution===1?"Low":n.resolution===2?"Medium":"High"}</div>
              </div>
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${g(M.sectionTitle)}">Mask</div>
              ${n.masks.length>0?`
                      <div style="${g({display:"flex",flexDirection:"column",gap:8})}">
                        ${n.masks.map((s,l)=>`
                          ${n.mode==="Ensemble"?`
                                  <div style="${g({display:"flex",alignItems:"center",gap:8,marginBottom:4})}">
                                    ${ne("maskStatistic",["mean","std","median","iqr","percentile","extremes"],s.statistic||"mean",{dataKey:"maskStatistic",selectedLabel:s.statistic==="mean"?"Mean":s.statistic==="std"?"Std":s.statistic==="median"?"Median":s.statistic==="iqr"?"IQR":s.statistic==="percentile"?"Percentile":s.statistic==="extremes"?"Extremes":"Mean"}).replace('class="custom-select-wrapper"',`class="custom-select-wrapper" data-mask-index="${l}" style="width: 100px;"`)}
                                  </div>
                                  `:n.mode==="Explore"?`
                                  <div style="${g({display:"flex",alignItems:"center",gap:8,marginBottom:4})}">
                                    ${ne("maskVariable",Le,s.variable||n.variable,{dataKey:"maskVariable",infoType:"variable"}).replace('class="custom-select-wrapper"',`class="custom-select-wrapper" data-mask-index="${l}" style="width: 140px;"`)}
                                    ${ne("maskUnit",Be(s.variable||n.variable).map(c=>c.label),s.unit||ze(s.variable||n.variable).label,{dataKey:"maskUnit"}).replace('class="custom-select-wrapper"',`class="custom-select-wrapper" data-mask-index="${l}" style="width: 120px;"`)}
                                  </div>
                                  `:""}
                          <div style="${g({display:"flex",alignItems:"center",gap:8})}">
                            <input
                              type="number"
                              step="any"
                              value="${s.lowerEdited&&s.lowerBound!==null?s.lowerBound:""}"
                              data-action="update-mask-bound"
                              data-mask-index="${l}"
                              data-bound="lower"
                              placeholder="${n.dataMin!==null?n.dataMin.toFixed(2):""}"
                              style="${g({width:"90px",background:"var(--gradient-bg)",border:"1px solid var(--border-strong)",borderRadius:8,color:"var(--text-primary)",padding:"6px 10px",fontSize:12.5,fontWeight:600,fontFamily:"var(--font-geist-sans)",letterSpacing:.25,minHeight:32,boxShadow:"inset 0 1px 0 var(--inset-light)"})}"
                            />
                            <span style="${g({fontSize:12.5,color:"var(--text-secondary)",minWidth:"20px",textAlign:"center"})}">to</span>
                            <input
                              type="number"
                              step="any"
                              value="${s.upperEdited&&s.upperBound!==null?s.upperBound:""}"
                              data-action="update-mask-bound"
                              data-mask-index="${l}"
                              data-bound="upper"
                              placeholder="${n.dataMax!==null?n.dataMax.toFixed(2):""}"
                              style="${g({width:"90px",background:"var(--gradient-bg)",border:"1px solid var(--border-strong)",borderRadius:8,color:"var(--text-primary)",padding:"6px 10px",fontSize:12.5,fontWeight:600,fontFamily:"var(--font-geist-sans)",letterSpacing:.25,minHeight:32,boxShadow:"inset 0 1px 0 var(--inset-light)"})}"
                            />
                            <button
                              type="button"
                              data-action="remove-mask"
                              data-mask-index="${l}"
                              style="${g({width:28,height:28,padding:0,borderRadius:6,border:"1px solid var(--border-medium)",background:"var(--bg-transparent)",color:"var(--text-secondary)",fontSize:16,fontWeight:600,cursor:"pointer",transition:"all 0.15s ease",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0})}"
                              onmouseover="this.style.borderColor='var(--border-bright)'; this.style.background='var(--bg-medium)'"
                              onmouseout="this.style.borderColor='var(--border-medium)'; this.style.background='var(--bg-transparent)'"
                            >
                              −
                            </button>
                          </div>
                        `).join("")}
                        <button
                          type="button"
                          data-action="apply-masks"
                          style="${g({padding:"10px 16px",borderRadius:10,border:"1px solid var(--border-strong)",background:"var(--gradient-primary)",color:"white",fontSize:12.5,fontWeight:700,cursor:"pointer",transition:"all 0.15s ease",textAlign:"center",width:"100%",marginTop:8,boxShadow:"var(--shadow-combined)"})}"
                          onmouseover="this.style.borderColor='var(--accent-border-bright)'; this.style.boxShadow='var(--shadow-elevated)'"
                          onmouseout="this.style.borderColor='var(--border-strong)'; this.style.boxShadow='var(--shadow-combined)'"
                        >
                          Apply Masks
                        </button>
                        <button
                          type="button"
                          data-action="add-mask"
                          style="${g({padding:"8px 14px",borderRadius:10,border:"1px solid var(--border-subtle)",background:"var(--bg-transparent)",color:"var(--text-secondary)",fontSize:12.5,fontWeight:600,cursor:"pointer",transition:"all 0.15s ease",textAlign:"left",width:"100%",marginTop:4})}"
                          onmouseover="this.style.borderColor='var(--border-medium)'; this.style.background='var(--bg-subtle)'"
                          onmouseout="this.style.borderColor='var(--border-subtle)'; this.style.background='var(--bg-transparent)'"
                        >
                          + Add Mask
                        </button>
                      </div>
                      `:`
                      <button
                        type="button"
                        data-action="add-mask"
                        style="${g({padding:"8px 14px",borderRadius:10,border:"1px solid var(--border-subtle)",background:"var(--bg-transparent)",color:"var(--text-secondary)",fontSize:12.5,fontWeight:600,cursor:"pointer",transition:"all 0.15s ease",textAlign:"left",width:"100%"})}"
                        onmouseover="this.style.borderColor='var(--border-medium)'; this.style.background='var(--bg-subtle)'"
                        onmouseout="this.style.borderColor='var(--border-subtle)'; this.style.background='var(--bg-transparent)'"
                      >
                        + Add Mask
                      </button>
                      `}
            </div>
          </div>
        </div>
      </div>
    </div>
  `}function Ut(e,t,a){const r=new Set(t);return`
      <div style="${g(M.chipRow)}">
        ${e.map(o=>{const i=r.has(o);return`
                  <button
                    type="button"
                    data-action="toggle-multi"
                    data-key="${a}"
                    data-value="${o}"
                    style="${g(ye(M.chip,i?M.chipActive:void 0))}"
                  >
                    ${o}
                  </button>
                `}).join("")}
      </div>
    `}function bo(){const e=n.chartLocationSearchResults.length>0?n.chartLocationSearchResults.map(r=>`
                <button
                  type="button"
                  class="location-search-result"
                  data-role="location-search-result"
                  data-name="${Ce(r.displayName)}"
                  data-lat="${r.lat}"
                  data-lon="${r.lon}"
                >
                  <div class="location-search-result-name">${Ce(r.displayName)}</div>
                  <div class="location-search-result-coord">
                    ${r.lat.toFixed(3)}, ${r.lon.toFixed(3)}
                  </div>
                </button>
              `).join(""):"",t=n.chartLocationSearchQuery.trim().length>0,a=n.chartLocationSearchError?`<div class="location-search-error">${Ce(n.chartLocationSearchError)}</div>`:n.chartLocationSearchLoading?'<div class="location-search-status">Searching...</div>':n.chartLocationSearchResults.length===0&&t?'<div class="location-search-status">No places found. Try refining your query.</div>':"";return`
      <div class="custom-select-extra" data-role="chart-location-search">
        <div class="location-search-row">
          <input
            type="text"
            class="location-search-input"
            value="${Ce(n.chartLocationSearchQuery)}"
            placeholder="Search a place (e.g. Aachen)"
            data-role="location-search-input"
          />
        </div>
        ${a}
        <div class="location-search-results" data-role="location-search-results">
          ${e||""}
        </div>
      </div>
    `}function Bf(){if(n.canvasView!=="map")return"";const e=n.mapLocationSearchResults.length>0?n.mapLocationSearchResults.map(s=>`
                <button
                  type="button"
                  class="location-search-result"
                  data-role="map-location-search-result"
                  data-name="${Ce(s.displayName)}"
                  data-lat="${s.lat}"
                  data-lon="${s.lon}"
                >
                  <div class="location-search-result-name">${Ce(s.displayName)}</div>
                  <div class="location-search-result-coord">
                    ${s.lat.toFixed(3)}, ${s.lon.toFixed(3)}
                  </div>
                </button>
              `).join(""):"",t=n.mapLocationSearchQuery.trim().length>0,a=n.mapLocationSearchError?`<div class="location-search-error">${Ce(n.mapLocationSearchError)}</div>`:n.mapLocationSearchLoading?'<div class="location-search-status">Searching...</div>':n.mapLocationSearchResults.length===0&&t&&!n.mapLocationSearchSelection?'<div class="location-search-status">No places found. Try refining your query.</div>':"",r=!!(e||a&&!n.mapLocationSearchLoading),o=n.sidebarOpen?-Pe/2:0,i=ye(M.mapSearchWrap,{top:18,transform:`translateX(calc(-50% + ${o}px))`});return`
      <div data-role="map-location-search" style="${g(i)}">
        <div class="location-search-row" style="display: flex; align-items: center; gap: 8px;">
          <input
            type="text"
            class="location-search-input"
            value="${Ce(n.mapLocationSearchQuery)}"
            placeholder="Search a place (e.g. Aachen)"
            data-role="map-location-search-input"
            style="flex: 1;"
          />
          <button
            type="button"
            data-action="toggle-map-draw"
            aria-label="${n.drawState.active?"Stop drawing":"Start drawing"}"
            style="
              display: flex;
              align-items: center;
              justify-content: center;
              width: 36px;
              height: 36px;
              padding: 0;
              border: 1px solid rgba(148, 163, 184, 0.3);
              border-radius: 6px;
              background: ${n.drawState.active?"rgba(52, 211, 153, 0.1)":"rgba(15, 23, 42, 0.85)"};
              color: ${n.drawState.active?"#34d399":"var(--text-secondary)"};
              cursor: pointer;
              transition: all 0.2s ease;
            "
            onmouseover="this.style.background='rgba(52, 211, 153, 0.2)';this.style.color='#34d399';"
            onmouseout="this.style.background='${n.drawState.active?"rgba(52, 211, 153, 0.1)":"rgba(15, 23, 42, 0.85)"}';this.style.color='${n.drawState.active?"#34d399":"var(--text-secondary)"}';"
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
          </button>
        </div>
        ${n.mapLocationSearchLoading?a:""}
        ${r?`
        ${n.mapLocationSearchLoading?"":a}
        <div
          class="location-search-results"
          data-role="map-location-search-results"
          style="${g(M.mapSearchResults)}"
        >
          ${e||""}
        </div>`:""}
      </div>
    `}function Vf(){console.log("Rendering chart section with state:",n);const e=n.chartMode==="single"?"translateX(0%)":"translateX(100%)",t=n.metaData?.scenarios?.length?Array.from(new Set(n.metaData.scenarios.map(_t))):Me,a=n.metaData?.models?.length?n.metaData.models:ge,r=Kt(n.chartScenarios.length?n.chartScenarios:t),o=(l,c,d,u,h)=>`
          <div style="${g({border:"1px solid var(--border-medium)",borderRadius:12,background:"var(--bg-subtle)",padding:"10px 12px"})}">
            <button
              type="button"
              data-action="toggle-collapse"
              data-key="${h}"
              style="${g({display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",background:"transparent",border:"none",color:"var(--text-primary)",fontWeight:700,fontSize:13,cursor:"pointer",padding:0})}"
            >
              <span>${l}</span>
              <span style="${g({color:"var(--text-secondary)",fontWeight:600,fontSize:12})}">${d} ${c?"▴":"▾"}</span>
            </button>
            ${c?`<div style="${g({marginTop:10,display:"flex",flexWrap:"wrap",gap:8})}">${u}</div>`:""}
          </div>
        `,i=`
      <div style="${g(M.paramGrid)}">
        ${ae("Date",et("chartDate",n.chartDate,{dataKey:"chartDate",min:r.start,max:r.end}))}
        ${ae("Variable",ne("chartVariable",Le,n.chartVariable,{dataKey:"chartVariable",infoType:"variable"}))}
      </div>
    
      <div style="margin-top:10px">
        ${ae("Location",ne("chartLocation",["World","Draw","Point"],n.chartLocation,{dataKey:"chartLocation",selectedLabel:n.chartLocation==="Search"&&n.chartLocationName?`Search: ${n.chartLocationName}`:n.chartLocation,extraContent:bo()}))}
      </div>

      <div style="margin-top:14px">
        ${o("Scenarios",n.chartDropdown.scenariosOpen,`${n.chartScenarios.length} selected`,Ut(t,n.chartScenarios,"chartScenarios"),"chartScenarios")}
      </div>

      <div style="margin-top:14px">
        ${o("Models",n.chartDropdown.modelsOpen,`${n.chartModels.length} selected`,Ut(a,n.chartModels,"chartModels"),"chartModels")}
      </div>

      <div style="margin-top:14px">
        <div style="${g(M.sectionTitle)}">Unit</div>
        ${ae("",ne("chartUnit",Be(n.chartVariable).map(l=>l.label),n.chartUnit,{dataKey:"chartUnit"}))}
      </div>
    `,s=`
      <div style="${g(M.paramGrid)}">
        ${ae("Start date",et("chartRangeStart",n.chartRangeStart,{dataKey:"chartRangeStart",min:r.start,max:r.end}))}
        ${ae("End date",et("chartRangeEnd",n.chartRangeEnd,{dataKey:"chartRangeEnd",min:r.start,max:r.end}))}
      </div>

      <div style="${g(ye(M.paramGrid,{marginTop:12}))}">
        ${ae("Variable",ne("chartVariable",Le,n.chartVariable,{dataKey:"chartVariable",infoType:"variable"}))}
      </div>

      <div style="margin-top:10px">
        ${ae("Location",ne("chartLocation",["World","Draw","Point"],n.chartLocation,{dataKey:"chartLocation",selectedLabel:n.chartLocation==="Search"&&n.chartLocationName?`Search: ${n.chartLocationName}`:n.chartLocation,extraContent:bo()}))}
      </div>

      <div style="margin-top:14px">
        ${o("Scenarios",n.chartDropdown.scenariosOpen,`${n.chartScenarios.length} selected`,Ut(t,n.chartScenarios,"chartScenarios"),"chartScenarios")}
      </div>

      <div style="margin-top:14px">
        ${o("Models",n.chartDropdown.modelsOpen,`${n.chartModels.length} selected`,Ut(a,n.chartModels,"chartModels"),"chartModels")}
      </div>

      <div style="margin-top:14px">
        <div style="${g(M.sectionTitle)}">Unit</div>
        ${ae("",ne("chartUnit",Be(n.chartVariable).map(l=>l.label),n.chartUnit,{dataKey:"chartUnit"}))}
      </div>
    `;return`
      <div style="${g(M.modeSwitch)}">
        <div data-role="chart-mode-indicator" style="${g({...M.modeIndicator,transform:e})}"></div>
        ${["single","range"].map(l=>{const c=l==="single"?"Single dates":"Range";return`
              <button
                type="button"
                class="mode-btn"
                data-action="set-chart-mode"
                data-value="${l}"
                style="${g(ye(M.modeBtn,n.chartMode===l?M.modeBtnActive:void 0))}"
              >
                ${c}
              </button>
            `}).join("")}
      </div>

      <div class="mode-pane-scrollable" style="${g(M.modePane)}">
        ${n.chartMode==="single"?i:s}
      </div>
    `}function Uf(){return`
    <div data-role="chat-section" style="${g({display:"flex",flexDirection:"column",gap:8})}">
      <div style="${g(M.sectionTitle)}">Chat</div>
      ${mh(n.chatMessages,n.chatInput)}
    </div>
  `}function xo(e,t,a){const r=Math.hypot(e,t);if(!r||!isFinite(r)||a<=0)return{x:0,y:0};const o=Math.min(1,a/r);return{x:e*o,y:t*o}}function Of(e){_n&&(_n(),_n=null),bt!==null&&(cancelAnimationFrame(bt),bt=null),dt!==null&&(cancelAnimationFrame(dt),dt=null),xt!==null&&(clearTimeout(xt),xt=null),Qe!==null&&(clearTimeout(Qe),Qe=null);const t=e.querySelector('[data-role="brand-eye"]');if(!t)return;let a={x:0,y:0},r={x:0,y:0},o={x:0,y:0},i={x:0,y:0},s=1,l=!1;const c=3e4,d=(b,L)=>{const E=t.getBoundingClientRect(),T=E.left+E.width/2,S=E.top+E.height/2,P=b-T,q=L-S,W=Math.min(E.width,E.height)*.14,O=W*.6;a=xo(P,q,W),r=xo(P,q,O)},u=b=>{s=Math.max(0,Math.min(1,b)),t.style.setProperty("--blink-open",`${s}`)},h=()=>{Qe!==null&&clearTimeout(Qe),Qe=window.setTimeout(()=>{a={x:0,y:0},r={x:0,y:0}},c)},f=()=>{o.x+=(a.x-o.x)*.28,o.y+=(a.y-o.y)*.28,i.x+=(r.x-i.x)*.32,i.y+=(r.y-i.y)*.32,t.style.setProperty("--iris-x",`${o.x}px`),t.style.setProperty("--iris-y",`${o.y}px`),t.style.setProperty("--pupil-x",`${i.x}px`),t.style.setProperty("--pupil-y",`${i.y}px`),bt=requestAnimationFrame(f)},p=()=>{if(l)return;l=!0;const b=[{t:0,v:1},{t:.16,v:.08},{t:.26,v:.02},{t:.4,v:1}],L=350,E=performance.now(),T=S=>{const P=S-E,q=Math.min(1,P/L);let Y=b[0],W=b[b.length-1];for(let F=0;F<b.length-1;F++){const C=b[F],m=b[F+1];if(q>=C.t&&q<=m.t){Y=C,W=m;break}}const O=W.t-Y.t||1,j=Math.min(1,Math.max(0,(q-Y.t)/O)),U=1-Math.pow(1-j,2),y=Y.v+(W.v-Y.v)*U;u(y),q<1?dt=requestAnimationFrame(T):(u(1),l=!1,x())};dt=requestAnimationFrame(T)},x=()=>{const b=3e3+Math.random()*15e3;xt=window.setTimeout(p,b)},k=()=>{const b=t.getBoundingClientRect();d(b.left+b.width/2,b.top+b.height/2)},$=b=>{d(b.clientX,b.clientY),h()},w=()=>k();k(),f(),x(),h(),window.addEventListener("pointermove",$),window.addEventListener("pointerleave",w),_n=()=>{window.removeEventListener("pointermove",$),window.removeEventListener("pointerleave",w),bt!==null&&(cancelAnimationFrame(bt),bt=null),dt!==null&&(cancelAnimationFrame(dt),dt=null),xt!==null&&(clearTimeout(xt),xt=null),Qe!==null&&(clearTimeout(Qe),Qe=null)}}function qf(e){if(!ee)return;const t=ee;Of(t),t.querySelectorAll('[data-action="update-mask-bound"]').forEach(m=>{m.__isMaskInput=!0;const v=D=>{D&&(D.stopPropagation(),D.preventDefault(),D.stopImmediatePropagation());const A=m.dataset.bound,B=m.dataset.maskIndex;if(!A||B===void 0)return;const I=Number.parseInt(B,10);if(Number.isNaN(I)||I<0||I>=n.masks.length)return;const _=m.value.trim(),V=_===""?null:Number.parseFloat(_);if(_===""||!Number.isNaN(V)){const z=n.masks[I];let K=!1;A==="lower"?z.lowerBound!==V&&(z.lowerBound=V,z.lowerEdited=_!=="",K=!0):z.upperBound!==V&&(z.upperBound=V,z.upperEdited=_!=="",K=!0),K&&(n.__updatingMask=!0,H(),setTimeout(()=>{n.__updatingMask=!1},0))}};m.addEventListener("blur",D=>{v(D)},{capture:!0}),m.addEventListener("keydown",D=>{D.key==="Enter"&&(D.preventDefault(),D.stopPropagation(),D.stopImmediatePropagation(),v(D),m.blur())},{capture:!0})}),vh({root:t,getSidebarOpen:()=>n.sidebarOpen,setSidebarOpen:m=>{n.sidebarOpen=m},onTimeSliderUpdate:m=>{Gh(m,Pe)},onCanvasToggleUpdate:m=>{const v=n.sidebarOpen?1:.9;xi(m+8,v),$i()}}),t.querySelectorAll('[data-action="set-canvas"]').forEach(m=>m.addEventListener("click",()=>{const v=m.dataset.value;if(v){if(v===n.canvasView)return;const A=n.canvasView==="map"?"translateX(0%)":"translateX(100%)",B=v==="map"?"translateX(0%)":"translateX(100%)";n.canvasView=v,v==="chart"&&(n.panelTab="Manual");const I=Je();I.active&&I.currentStep===13&&v==="chart"&&Mt(),H(),v==="map"?_e():We();const _=t.querySelector('[data-role="canvas-indicator"]');if(!_)return;_.style.removeProperty("transition"),_.style.transform=A,_.offsetHeight,_.getBoundingClientRect(),requestAnimationFrame(()=>{_.style.transition="transform 180ms ease",_.style.transform=B})}})),t.querySelectorAll('[data-action="set-mode"]').forEach(m=>m.addEventListener("click",()=>{const v=m.dataset.value;if(v){if(v===n.mode)return;const D=n.mode,A=D==="Explore"?"translateX(0%)":D==="Compare"?"translateX(-33.333%)":"translateX(-66.666%)",B=D==="Explore"?"translateX(0%)":D==="Compare"?"translateX(100%)":"translateX(200%)",I=v==="Explore"?"translateX(0%)":v==="Compare"?"translateX(-33.333%)":"translateX(-66.666%)",_=v==="Explore"?"translateX(0%)":v==="Compare"?"translateX(100%)":"translateX(200%)";n.mode=v;const V=Je();V.active&&V.currentStep===9&&v==="Compare"&&Mt(),H();const z=t.querySelector('[data-role="mode-track"]'),K=t.querySelector('[data-role="mode-indicator"]');if(!z||!K)return;z.style.transition="none",K.style.transition="none",z.style.transform=A,K.style.transform=B,z.offsetHeight,z.style.transition="transform 220ms ease",K.style.transition="transform 200ms ease",z.style.transform=I,K.style.transform=_}n.canvasView==="map"&&_e()})),t.querySelectorAll('[data-action="set-chart-mode"]').forEach(m=>m.addEventListener("click",()=>{const v=m.dataset.value;if(!v||v===n.chartMode)return;const A=n.chartMode==="single"?"translateX(0%)":"translateX(100%)",B=v==="single"?"translateX(0%)":"translateX(100%)";n.chartMode=v,H();const I=t.querySelector('[data-role="chart-mode-indicator"]');I&&(I.style.removeProperty("transition"),I.style.transform=A,I.offsetHeight,requestAnimationFrame(()=>{I.style.transition="transform 200ms ease",I.style.transform=B})),n.canvasView==="chart"&&We()})),t.querySelectorAll('[data-action="set-tab"]').forEach(m=>m.addEventListener("click",()=>{const v=m.dataset.value;if(v){if(v===n.panelTab)return;const A=n.panelTab==="Manual"?"translateX(0%)":"translateX(-50%)",B=v==="Manual"?"translateX(0%)":"translateX(-50%)";n.panelTab=v;const I=Je();I.active&&I.currentStep===11&&v==="Chat"&&Mt(),H();const _=t.querySelector('[data-role="tab-track"]');if(!_)return;_.style.removeProperty("transition"),_.style.transform=A,_.offsetHeight,_.getBoundingClientRect(),requestAnimationFrame(()=>{_.style.transition="transform 220ms ease",_.style.transform=B})}}));const l=t.querySelectorAll(".custom-select-wrapper");let c=document.querySelector(".custom-select-info-panel-shared");c||(c=document.createElement("div"),c.className="custom-select-info-panel custom-select-info-panel-shared",c.setAttribute("role","tooltip"),document.body.appendChild(c));const d=m=>{m.target.closest(".custom-select-wrapper")||(l.forEach(D=>{D.classList.remove("open")}),c&&c.classList.remove("visible"))},u=m=>{m.key==="Escape"&&(l.forEach(v=>{v.classList.remove("open")}),c&&c.classList.remove("visible"))};document.addEventListener("click",d),document.addEventListener("keydown",u),l.forEach(m=>{const v=m.querySelector(".custom-select-trigger"),D=m.querySelector(".custom-select-dropdown"),A=m.querySelectorAll(".custom-select-option"),B=m.dataset.key,I=m.dataset.infoType,_=m.dataset.disabled==="true";if(!v||!D||_)return;const V=c,z=(Q,R)=>{if(!V||!I)return;let X="",G=Q;if(I==="scenario"?X=Jh[Q]||"":I==="variable"?(X=tf[Q]||"",G=ef[Q]||Q):I==="model"&&(X=nf[Q]||""),X){if(V.innerHTML=`
                    <div class="custom-select-info-panel-title">${G}</div>
                    <div class="custom-select-info-panel-content">${X}</div>
                `,R||v){const N=R||v;if(N){const oe=N.getBoundingClientRect();V.style.left=`${oe.left-272}px`,V.style.top=`${oe.top}px`}}V.classList.add("visible")}},K=()=>{V&&V.classList.remove("visible")};v.addEventListener("click",Q=>{if(Q.stopPropagation(),_)return;const R=m.classList.contains("open");l.forEach(G=>{G!==m&&G.classList.remove("open")}),m.classList.toggle("open",!R),Je().active&&setTimeout(()=>{H()},50)}),v.addEventListener("keydown",Q=>{if(!_&&(Q.key==="Enter"||Q.key===" "||Q.key==="ArrowDown")){Q.preventDefault(),m.classList.add("open");const R=A[0];R&&R.focus()}}),A.forEach(Q=>{Q.addEventListener("click",R=>{R.stopPropagation();const X=Q.dataset.value;if(!X||!B)return;A.forEach(re=>{re.classList.remove("selected"),re.removeAttribute("aria-selected")}),Q.classList.add("selected"),Q.setAttribute("aria-selected","true");const G=v.querySelector(".custom-select-value");G&&(G.textContent=X),m.classList.remove("open"),K();const N=m.dataset.maskIndex;h(B,X,N);const oe=Je();oe.active&&{1:"scenario",2:"model",4:"variable",5:"unit",6:"palette"}[oe.currentStep]===B&&setTimeout(()=>{Mt(),H()},100)}),I&&(Q.addEventListener("mouseenter",()=>{const R=Q.dataset.value;R&&z(R,Q)}),Q.addEventListener("mouseleave",()=>{K()})),Q.addEventListener("keydown",R=>{const X=Array.from(A).indexOf(Q);if(R.key==="Enter"||R.key===" ")R.preventDefault(),Q.click();else if(R.key==="ArrowDown"){R.preventDefault();const G=(X+1)%A.length;A[G]?.focus()}else if(R.key==="ArrowUp"){R.preventDefault();const G=X===0?A.length-1:X-1;A[G]?.focus()}else R.key==="Escape"?(R.preventDefault(),m.classList.remove("open"),K(),v.focus()):R.key==="Home"?(R.preventDefault(),A[0]?.focus()):R.key==="End"&&(R.preventDefault(),A[A.length-1]?.focus())})}),new MutationObserver(Q=>{Q.forEach(R=>{R.type==="attributes"&&R.attributeName==="class"&&(m.classList.contains("open")||K())})}).observe(m,{attributes:!0})});const h=async(m,v,D)=>{if(!m)return;let A=!1,B=!1;switch(m){case"scenario":n.scenario=v,n.date=lf(v),n.ensembleDate=n.date,n.timeRange=Ue(v),A=!0;break;case"model":n.model=v,A=!0;break;case"variable":{if(n.variable=v,n.selectedUnit=ze(v).label,n.mode==="Explore"&&n.masks?.length&&n.canvasView==="map"){Pf();return}A=!0;break}case"unit":if(n.selectedUnit=v,H(),n.currentData&&ee&&n.dataMin!==null&&n.dataMax!==null){const _=ee.querySelector("#map-canvas");if(_)try{we=_,mn(_),zn(n.currentData,we,le,n.palette,n.dataMin,n.dataMax,n.variable,n.selectedUnit,n.masks,null,!1,n.mode==="Explore"?n.maskVariableData:void 0);const V=le.find(z=>z.name===n.palette)||le[0];Vn("legend-gradient-canvas",V.colors)}catch(V){console.error("Map redraw (unit change) failed:",V)}}n.mapMarker&&n.mapInfoOpen&&(n.mapInfoSamples.length?(n.mapInfoBoxes=gn(n.mapInfoSamples,n.variable,n.selectedUnit),H()):n.mapInfoLoading||Vt());return;case"palette":if(n.palette=v,H(),n.canvasView==="map"&&n.currentData&&ee&&n.dataMin!==null&&n.dataMax!==null){const _=ee.querySelector("#map-canvas");if(_){we=_,zn(n.currentData,we,le,n.palette,n.dataMin,n.dataMax,n.variable,n.selectedUnit,n.masks,null,!1,n.mode==="Explore"?n.maskVariableData:void 0);const V=le.find(z=>z.name===n.palette)||le[0];Vn("legend-gradient-canvas",V.colors)}}return;case"compareMode":n.compareMode=v,A=!0;break;case"compareScenarioA":v===n.compareScenarioB&&(n.compareScenarioB=n.compareScenarioA),n.compareScenarioA=v,A=!0;break;case"compareScenarioB":v===n.compareScenarioA&&(n.compareScenarioA=n.compareScenarioB),n.compareScenarioB=v,A=!0;break;case"compareModelA":v===n.compareModelB&&(n.compareModelB=n.compareModelA),n.compareModelA=v,A=!0;break;case"compareModelB":v===n.compareModelA&&(n.compareModelA=n.compareModelB),n.compareModelB=v,A=!0;break;case"chartVariable":n.chartVariable=v,n.chartUnit=ze(v).label,B=!0;break;case"chartUnit":n.chartUnit=v,n.chartSamples.length&&(n.chartMode==="range"?(n.chartRangeSeries=Yn(n.chartSamples,n.chartVariable,n.chartUnit),n.chartBoxes=null):n.chartBoxes=gn(n.chartSamples,n.chartVariable,n.chartUnit)),H();return;case"ensembleVariable":n.ensembleVariable=v,n.ensembleUnit=ze(v).label,A=!0;break;case"ensembleUnit":if(n.ensembleUnit=v,H(),n.currentData&&ee&&n.dataMin!==null&&n.dataMax!==null&&n.mode==="Ensemble"){const _=ee.querySelector("#map-canvas");if(_){we=_,mn(_),zn(n.currentData,we,le,n.palette,n.dataMin,n.dataMax,n.ensembleVariable,n.ensembleUnit,n.masks,n.ensembleStatistics,!0);const V=le.find(z=>z.name===n.palette)||le[0];Vn("legend-gradient-canvas",V.colors)}}return;case"ensembleStatistic":n.ensembleStatistic=v,A=!0;break;case"maskStatistic":{if(D!==void 0){const _=Number.parseInt(D,10);!Number.isNaN(_)&&_>=0&&_<n.masks.length&&(n.masks[_].statistic=v,H())}return}case"maskVariable":{if(D!==void 0){const _=Number.parseInt(D,10);if(!Number.isNaN(_)&&_>=0&&_<n.masks.length){const V=n.masks[_];V.variable=v,V.unit=ze(v).label,V.lowerBound=null,V.upperBound=null,V.lowerEdited=!1,V.upperEdited=!1,H(),n.mode==="Explore"&&n.canvasView==="map"&&(_e(),H())}}return}case"maskUnit":{if(D!==void 0){const _=Number.parseInt(D,10);!Number.isNaN(_)&&_>=0&&_<n.masks.length&&(n.masks[_].unit=v,H())}return}case"chartLocation":if(v==="Draw"){co();return}if(v==="Point"){uo();return}if(v==="Search"){n.chartLocation="Search",n.chartPolygon=null,n.pointSelectActive=!1,n.drawState=yt(),n.chartError=null,n.chartLocationName=null,n.chartLocationSearchError=null,n.chartLocationSearchResults=[],n.chartLocationSearchQuery="",n.chartLocationSearchLoading=!1,n.canvasView="chart",la(),ca(),H();return}n.chartLocation="World",n.chartPolygon=null,n.chartPoint=null,n.chartLocationName=null,n.chartLocationSearchError=null,n.chartLocationSearchResults=[],n.chartLocationSearchQuery="",n.chartLocationSearchLoading=!1,la(),ca(),B=!0;break}const I=()=>{if(H(),n.canvasView==="map"&&A){_e();const _=n.mapMarker!==null,V=n.mapPolygon!==null&&n.mapPolygon.length>=3;(_||V)&&n.mapInfoOpen&&Vt()}n.canvasView==="chart"&&(B||A)&&We()};A||B?setTimeout(I,0):I()},f=t.querySelector('.custom-select-wrapper[data-key="chartLocation"]');if(f){let m=function(){const _=ee?.querySelector('.custom-select-wrapper[data-key="chartLocation"]');if(!_)return;const V=_.querySelector('[data-role="location-search-input"]');V&&(V.value=n.chartLocationSearchQuery);const z=_.querySelector('[data-role="location-search-results-container"]');if(z){if(z.innerHTML="",n.chartLocationSearchLoading)z.innerHTML='<div class="search-loading">Loading...</div>';else if(n.chartLocationSearchError)z.innerHTML=`<div class="search-error">${n.chartLocationSearchError}</div>`;else if(n.chartLocationSearchResults.length>0)for(const K of n.chartLocationSearchResults){const Z=document.createElement("div");Z.className="custom-select-option search-result",Z.setAttribute("data-role","location-search-result"),Z.setAttribute("data-lat",String(K.lat)),Z.setAttribute("data-lon",String(K.lon)),Z.setAttribute("data-name",K.displayName||"Selected place"),Z.textContent=K.displayName||`${K.lat}, ${K.lon}`,Z.addEventListener("click",()=>{_.classList.remove("open"),ho({displayName:K.displayName||"Selected place",lat:K.lat,lon:K.lon})}),z.appendChild(Z)}}};f.querySelectorAll(".custom-select-option").forEach(_=>{_.addEventListener("click",()=>{const V=_.dataset.value;V==="Draw"&&n.chartLocation==="Draw"?co():V==="Point"&&n.chartLocation==="Point"&&uo()})});const D=f.querySelectorAll('[data-role="location-search-input"]'),A=f.querySelectorAll('[data-role="location-search-result"]'),B=()=>{kt!==null&&(window.clearTimeout(kt),kt=null)},I=_=>{B(),yf(_)};if(D.forEach(_=>{_.addEventListener("input",()=>{const V=n.chartLocationSearchResults.length>0,z=n.chartLocationSearchLoading,K=!!n.chartLocationSearchError;if(n.chartLocationSearchQuery=_.value,n.chartLocationSearchError=null,B(),!_.value.trim()){n.chartLocationSearchResults=[],n.chartLocationSearchLoading=!1,m();return}(V||z||K)&&(n.chartLocationSearchResults=[],n.chartLocationSearchLoading=!1,m()),kt=window.setTimeout(()=>{I(_.value)},so)}),_.addEventListener("keydown",V=>{V.key==="Enter"&&(V.preventDefault(),B(),I(_.value))})}),A.forEach(_=>{_.addEventListener("click",()=>{const V=Number(_.dataset.lat),z=Number(_.dataset.lon),K=_.dataset.name??"Selected place";!Number.isFinite(V)||!Number.isFinite(z)||(f.classList.remove("open"),ho({displayName:K,lat:V,lon:z}))})}),n.chartLocation==="Search"){const _=f.querySelector('[data-role="location-search-input"]');_&&setTimeout(()=>_.focus(),0)}}const p=t.querySelectorAll('[data-role="map-location-search-input"]'),x=t.querySelectorAll('[data-role="map-location-search-result"]'),k=()=>{Dt!==null&&(window.clearTimeout(Dt),Dt=null)},$=m=>{k(),bf(m)};if(p.forEach(m=>{m.addEventListener("focus",()=>{n.mapLocationSearchFocused=!0});const v=()=>{const D=m.selectionStart??m.value.length,A=m.selectionEnd??m.value.length;n.mapLocationSearchCursor={start:D,end:A}};m.addEventListener("input",()=>{const D=n.mapLocationSearchResults.length>0,A=n.mapLocationSearchLoading,B=!!n.mapLocationSearchError;if(n.mapLocationSearchQuery=m.value,n.mapLocationSearchError=null,n.mapLocationSearchSelection=null,n.mapLocationSearchFocused=!0,v(),k(),!m.value.trim()){n.mapLocationSearchResults=[],n.mapLocationSearchLoading=!1,H();return}(D||A||B)&&(n.mapLocationSearchResults=[],n.mapLocationSearchLoading=!1,H()),Dt=window.setTimeout(()=>{$(m.value)},so)}),m.addEventListener("keyup",v),m.addEventListener("click",v),m.addEventListener("select",v),m.addEventListener("keydown",D=>{D.key==="Enter"&&(D.preventDefault(),k(),$(m.value))})}),x.forEach(m=>{m.addEventListener("click",()=>{const v=Number(m.dataset.lat),D=Number(m.dataset.lon),A=m.dataset.name??"Selected place";!Number.isFinite(v)||!Number.isFinite(D)||vf({displayName:A,lat:v,lon:D})})}),n.mapLocationSearchFocused){const m=t.querySelector('[data-role="map-location-search-input"]');if(m){setTimeout(()=>m.focus(),0);const{start:v,end:D}=n.mapLocationSearchCursor,A=Math.min(v,m.value.length),B=Math.min(D,m.value.length);setTimeout(()=>m.setSelectionRange(A,B),0)}}t.querySelectorAll('select[data-action="update-select"]').forEach(m=>m.addEventListener("change",async()=>{const v=m.dataset.key,D=m.value;v&&await h(v,D)})),t.querySelectorAll('[data-action="toggle-multi"]').forEach(m=>m.addEventListener("click",()=>{const v=m.dataset.key,D=m.dataset.value;if(!(!v||!D)){if(v==="chartScenarios"){const A=n.metaData?.scenarios?.length&&n.metaData.scenarios?Array.from(new Set(n.metaData.scenarios.map(_t))):Me,B=D==="Historical",I=new Set(n.chartScenarios);I.has(D)?I.delete(D):B?(I.clear(),I.add("Historical")):(I.delete("Historical"),I.add(D)),I.size===0&&I.add(B?"Historical":D),n.chartScenarios=Array.from(I).filter(V=>A.includes(V));const _=Kt(n.chartScenarios);n.chartDate=Te(n.chartDate,_),n.chartRangeStart=Te(n.chartRangeStart,_),n.chartRangeEnd=Te(n.chartRangeEnd,_)}if(v==="chartModels"){const A=n.metaData?.models?.length&&n.metaData.models?n.metaData.models:ge,B=new Set(n.chartModels);B.has(D)?B.delete(D):B.add(D),n.chartModels=B.size?Array.from(B):[...A]}if(v==="ensembleScenarios"){const A=n.metaData?.scenarios?.length&&n.metaData.scenarios?Array.from(new Set(n.metaData.scenarios.map(_t))):Me,B=D==="Historical",I=new Set(n.ensembleScenarios);I.has(D)?I.delete(D):B?(I.clear(),I.add("Historical")):(I.delete("Historical"),I.add(D)),I.size===0&&I.add(B?"Historical":D),n.ensembleScenarios=Array.from(I).filter(V=>A.includes(V));const _=Kt(n.ensembleScenarios);n.ensembleDate=Te(n.ensembleDate,_)}if(v==="ensembleModels"){const A=n.metaData?.models?.length?n.metaData.models:ge,B=new Set(n.ensembleModels);B.has(D)?B.delete(D):B.add(D),n.ensembleModels=B.size?Array.from(B):[...A]}H(),n.canvasView==="chart"?We():n.canvasView==="map"&&n.mode==="Ensemble"&&_e()}})),t.querySelectorAll('[data-action="toggle-collapse"]').forEach(m=>m.addEventListener("click",()=>{const v=m.dataset.key;v&&(v==="chartScenarios"&&(n.chartDropdown.scenariosOpen=!n.chartDropdown.scenariosOpen),v==="chartModels"&&(n.chartDropdown.modelsOpen=!n.chartDropdown.modelsOpen),v==="ensembleScenarios"&&(n.ensembleDropdown.scenariosOpen=!n.ensembleDropdown.scenariosOpen),v==="ensembleModels"&&(n.ensembleDropdown.modelsOpen=!n.ensembleDropdown.modelsOpen),H())})),t.querySelectorAll('[data-action="update-input"]').forEach(m=>{let v=!1,D=null;const A=()=>{const I=m.value;!(/^\d{4}-\d{2}-\d{2}$/.test(I)&&!isNaN(new Date(I).getTime()))&&I.length>0?m.style.borderColor="rgba(239, 68, 68, 0.6)":m.style.borderColor=""},B=()=>{const I=m.dataset.key;if(!I)return;const _=m.value;if(!(/^\d{4}-\d{2}-\d{2}$/.test(_)&&!isNaN(new Date(_).getTime()))){const X=I==="date"?n.date:I==="compareDateStart"?n.compareDateStart:I==="compareDateEnd"?n.compareDateEnd:I==="chartRangeStart"?n.chartRangeStart:I==="chartRangeEnd"?n.chartRangeEnd:n.chartDate;m.value=X,m.style.borderColor="";return}m.style.borderColor="";let Z=_;if(I==="date"&&(Z=mt(_,n.scenario),Z!==_&&(m.value=Z)),(I==="date"?n.date:I==="compareDateStart"?n.compareDateStart:I==="compareDateEnd"?n.compareDateEnd:I==="chartRangeStart"?n.chartRangeStart:I==="chartRangeEnd"?n.chartRangeEnd:n.chartDate)===Z)return;switch(I){case"date":n.date=Z,n.ensembleDate=Z;break;case"compareDateStart":n.compareDateStart=_;break;case"compareDateEnd":n.compareDateEnd=_;break;case"chartDate":n.chartDate=_;break;case"chartRangeStart":n.chartRangeStart=_;break;case"chartRangeEnd":n.chartRangeEnd=_;break;case"ensembleDate":n.ensembleDate=_;break}const R=Je();if(I==="date"&&R.active&&R.currentStep===3&&setTimeout(()=>{Mt(),H()},100),H(),I==="date"||n.mode==="Compare"&&(I==="compareDateStart"||I==="compareDateEnd")||n.mode==="Ensemble"&&I==="ensembleDate"){_e();const X=n.mapMarker!==null,G=n.mapPolygon!==null&&n.mapPolygon.length>=3;(X||G)&&n.mapInfoOpen&&Vt()}n.canvasView==="chart"&&(I==="chartDate"||I==="chartRangeStart"||I==="chartRangeEnd")&&We()};m.addEventListener("input",()=>{v=!0,A(),D!==null&&window.clearTimeout(D),D=window.setTimeout(()=>{v=!1},300)}),m.addEventListener("blur",I=>{I.target.__isMaskInput||(v=!1,D!==null&&(window.clearTimeout(D),D=null),B())}),m.addEventListener("keydown",I=>{I.key==="Enter"&&(I.preventDefault(),v=!1,D!==null&&(window.clearTimeout(D),D=null),B(),m.blur())}),m.addEventListener("change",()=>{v||B()})});const T=t.querySelectorAll('[data-action="set-resolution"]'),S=t.querySelectorAll('[data-role="resolution-value"]'),P=m=>{const v=(m-1)/2*100,D=m===1?"Low":m===2?"Medium":"High";T.forEach(A=>{A.value=String(m),A.style.setProperty("--slider-fill",`${v}%`)}),S.forEach(A=>{A.textContent=D})};T.forEach(m=>m.addEventListener("input",()=>{const v=Number.parseInt(m.value,10);Number.isNaN(v)||(n.resolution=v,P(v),n.canvasView==="map"&&_e())})),t.querySelectorAll('[data-action="add-mask"]').forEach(m=>{m.addEventListener("click",()=>{const v={lowerBound:n.dataMin,upperBound:n.dataMax,lowerEdited:!1,upperEdited:!1};n.mode==="Ensemble"&&(v.statistic="mean"),n.mode==="Explore"&&(v.variable=n.variable,v.unit=n.selectedUnit),n.masks.push(v),H()})}),t.querySelectorAll('[data-action="remove-mask"]').forEach(m=>{m.addEventListener("click",()=>{const v=m.dataset.maskIndex;if(v===void 0)return;const D=Number.parseInt(v,10);!Number.isNaN(D)&&D>=0&&D<n.masks.length&&(n.masks.splice(D,1),H())})}),t.querySelector('[data-action="apply-masks"]')?.addEventListener("click",()=>{n.canvasView==="map"&&_e()}),t.querySelector('[data-action="open-compare-info"]')?.addEventListener("click",()=>{n.compareInfoOpen=!0,H()}),t.querySelectorAll('[data-action="close-compare-info"]').forEach(m=>m.addEventListener("click",()=>{n.compareInfoOpen=!1,H()})),t.querySelector('[data-action="close-map-info"]')?.addEventListener("click",m=>{m.preventDefault(),Sf()}),t.querySelector('[data-action="open-map-info-chart"]')?.addEventListener("click",m=>{m.preventDefault(),!(!n.mapMarker&&!n.mapPolygon)&&(n.canvasView="chart",n.chartMode="single",n.mapPolygon&&n.mapPolygon.length>=3?(n.chartLocation="Draw",n.chartPolygon=n.mapPolygon,n.chartPoint=null,n.chartLocationName=null):n.mapMarker&&(n.chartLocation="Point",n.chartPoint={lat:n.mapMarker.lat,lon:n.mapMarker.lon},n.chartLocationName=n.mapMarker.name??null,n.chartPolygon=null),n.chartVariable=n.variable,n.chartUnit=n.selectedUnit,n.chartDate=n.date,n.chartError=null,H(),We())}),t.querySelector('[data-action="toggle-map-draw"]')?.addEventListener("click",m=>{m.preventDefault(),n.drawState.active?mf():pf()}),Kh({root:t,getTimeRange:()=>n.timeRange,onDateChange:m=>{n.date=m,n.ensembleDate=m,_e();const v=n.mapMarker!==null,D=n.mapPolygon!==null&&n.mapPolygon.length>=3;(v||D)&&n.mapInfoOpen&&Vt()},getMode:()=>n.mode,getCompareMode:()=>n.compareMode,getCompareDates:()=>({start:n.compareDateStart,end:n.compareDateEnd}),onDateRangeChange:(m,v)=>{n.compareDateStart=m,n.compareDateEnd=v,_e()}});const C={mode:n.mode,canvasView:n.canvasView,selectedVariable:n.variable,selectedModel:n.model,selectedScenario:n.scenario,selectedDate:n.date,compareMode:n.compareMode,chartMode:n.chartMode,selectedScenario1:n.compareScenarioA,selectedScenario2:n.compareScenarioB,selectedModel1:n.compareModelA,selectedModel2:n.compareModelB,selectedDate1:n.compareDateStart,selectedDate2:n.compareDateEnd,currentDataStats:n.dataMin!==null&&n.dataMax!==null?{min:n.dataMin,max:n.dataMax,mean:n.dataMean??void 0}:void 0};gh(t,n,C)}async function wo(){if(ee=document.querySelector("#app"),!ee)throw new Error("Root element #app not found");hh(e=>{Object.assign(n,e),H(),n.canvasView==="map"&&(e.date||e.model||e.scenario||e.variable)?_e():n.canvasView==="map"&&e.palette&&n.currentData&&H(),n.canvasView==="chart"&&(e.chartDate||e.chartRangeStart||e.chartRangeEnd)&&We()}),H(),sf().then(()=>{H()}),n.canvasView==="map"&&n.mode==="Explore"&&_e(),ee.addEventListener("click",e=>{const t=e.target,a=t.closest("[data-action]"),r=a?.getAttribute("data-action");if(r==="tutorial-continue"){e.preventDefault(),e.stopPropagation();const o=Je(),i=Mn[o.currentStep]?.id??"";if(i==="compare-switch"){const s=document.querySelector('[data-action="set-mode"][data-value="Compare"]');if(s){s.click();return}}if(i==="chat-switch"){const s=document.querySelector('[data-action="set-tab"][data-value="Chat"]');if(s){s.click();return}}if(i==="analysis-switch"){const s=document.querySelector('[data-action="set-canvas"][data-value="chart"]');if(s){s.click();return}}Mt(),H();return}if(r==="close-tutorial"){e.preventDefault(),e.stopPropagation(),si(),H();return}if(r==="start-tutorial"){e.preventDefault(),e.stopPropagation(),n.canvasView="map",n.mode="Explore",n.panelTab="Manual",xh(),H();return}if(r==="update-select"){const o=Je();if(o.active){const i=a?.getAttribute("data-key");(t.classList.contains("custom-select-trigger")||t.closest(".custom-select-trigger"))&&setTimeout(()=>{H()},50),{1:"scenario",2:"model",4:"variable",5:"unit",6:"palette"}[o.currentStep]===i&&(t.classList.contains("custom-select-option")||t.closest(".custom-select-option"))&&setTimeout(()=>{Mt(),H()},100)}}})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",wo):wo();
