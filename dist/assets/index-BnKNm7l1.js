(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=n(i);fetch(i.href,a)}})();const rt=360;let Tt=null,vt=null;function hi(t){const{root:e,isOpen:n,onCanvasToggleUpdate:r,onTimeSliderUpdate:i}=t;Tt||(Tt=e.querySelector('[data-role="sidebar"]')),vt||(vt=e.querySelector('[data-action="toggle-sidebar"]'));const a=e.querySelector('[data-role="canvas-toggle"]'),o=e.querySelector('[data-role="compare-info-trigger"]'),l=e.querySelector('[data-role="compare-info-overlay"]');if(!Tt||!a||!vt)return;const u=n?"translateX(0)":`translateX(${rt+24}px)`;Tt.style.transform=u,Tt.style.pointerEvents=n?"auto":"none",Tt.setAttribute("aria-hidden",String(!n));const f=n?`${rt+10}px`:"14px";vt.style.right=f,vt.setAttribute("aria-label",n?"Collapse sidebar":"Expand sidebar"),vt.className=n?"sidebar-toggle open":"sidebar-toggle";const s=vt.querySelector("span");s&&(s.textContent=n?"›":"‹");const d=n?rt+24:24;a.style.right=`${d}px`,o&&(o.style.right=`${d}px`),l&&(l.style.left=n?`${rt}px`:"0",l.style.right="0"),r&&r(d),i&&i(n)}function pi(t){const{root:e,getSidebarOpen:n,setSidebarOpen:r,onCanvasToggleUpdate:i,onTimeSliderUpdate:a}=t;Tt=e.querySelector('[data-role="sidebar"]'),vt=e.querySelector('[data-action="toggle-sidebar"]'),vt?.addEventListener("click",()=>{const o=!n();r(o),hi({root:e,isOpen:o,onCanvasToggleUpdate:i,onTimeSliderUpdate:a})})}function gi(t){const e=t?rt+10:14;return`
      <button
        type="button"
        aria-label="${t?"Collapse sidebar":"Expand sidebar"}"
        data-action="toggle-sidebar"
        class="${t?"sidebar-toggle open":"sidebar-toggle"}"
        style="right: ${e}px"
      >
        <span class="sidebar-toggle-icon">${t?"›":"‹"}</span>
      </button>
    `}function br(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:{r:0,g:0,b:0}}const mi=t=>t-273.15,vi=t=>(t-273.15)*(9/5)+32,yi=t=>t*1e3,xi=t=>t*3.6,wi=t=>t*2.237,bi=t=>t/1e3,Bt=t=>t;function qt(t){switch(t){case"tas":case"tasmin":case"tasmax":return[{label:"Kelvin (K)",unit:"K",convert:Bt},{label:"Celsius (°C)",unit:"°C",convert:mi},{label:"Fahrenheit (°F)",unit:"°F",convert:vi}];case"pr":return[{label:"g m⁻² s⁻¹",unit:"g m⁻² s⁻¹",convert:yi},{label:"kg m⁻² s⁻¹",unit:"kg m⁻² s⁻¹",convert:Bt}];case"rsds":case"rlds":return[{label:"W/m²",unit:"W/m²",convert:Bt},{label:"kW/m²",unit:"kW/m²",convert:bi}];case"sfcWind":return[{label:"m/s",unit:"m/s",convert:Bt},{label:"km/h",unit:"km/h",convert:xi},{label:"mph",unit:"mph",convert:wi}];case"hurs":return[{label:"Percent (%)",unit:"%",convert:Bt}];default:return[{label:"Default",unit:"",convert:Bt}]}}function Sr(t){return qt(t)[0]}function be(t,e,n,r){const a=qt(e).find(o=>o.label===n);return a?r?.isDifference&&["tas","tasmin","tasmax"].includes(e)?n.includes("Celsius")?t:n.includes("Fahrenheit")?t*(9/5):t:a.convert(t):t}function _r(t,e){return qt(t).find(i=>i.label===e)?.unit||""}function $r(t,e,n,r,i){const o=qt(n).find(l=>l.label===r);return o?i?.isDifference&&["tas","tasmin","tasmax"].includes(n)?r.startsWith("Celsius")?{min:t,max:e}:r.startsWith("Fahrenheit")?{min:t*1.8,max:e*1.8}:{min:t,max:e}:{min:o.convert(t),max:o.convert(e)}:{min:t,max:e}}let xt=null,te=[];function Sn(t,e,n,r){const i=r.map(br);for(let a=0;a<n;a++){const l=(1-a/(n-1))*(i.length-1),u=Math.floor(l),f=Math.min(u+1,i.length-1),s=l-u,d=i[u],h=i[f],p=Math.round(d.r+(h.r-d.r)*s),g=Math.round(d.g+(h.g-d.g)*s),y=Math.round(d.b+(h.b-d.b)*s);t.fillStyle=`rgb(${p}, ${g}, ${y})`,t.fillRect(0,a,e,1)}}function Si(t,e,n,r,i,a){const o=r?.variable_metadata[t],l=o?.name||t;let u=e,f=n,s=o?.unit||"";if(i){const p=$r(e,n,t,i,{isDifference:a});u=p.min,f=p.max,s=_r(t,i)}const d=(f-u)/4,h=[f,f-d,f-2*d,f-3*d,u];return`
      <div class="map-legend">
        <div class="legend-title">${l}</div>
        <div class="legend-container">
        <canvas id="legend-gradient-canvas" width="20" height="200" style="width: 20px; height: 200px; border-radius: 4px;"></canvas>
          <div class="legend-labels">
            ${h.map(p=>`<span>${p.toFixed(2)} ${s}</span>`).join("")}
          </div>
        </div>
      </div>
    `}function en(t,e){const n=document.getElementById(t);if(!n){console.warn("Legend canvas not found");return}xt=n,te=e;const r=n.getContext("2d");if(!r)return;const i=n.width,a=n.height;Sn(r,i,a,e)}function _i(t,e,n){if(!xt||te.length===0)return;const r=xt.getContext("2d");if(!r)return;const i=xt.width,a=xt.height;Sn(r,i,a,te);const o=(t-e)/(n-e),l=Math.round(a*(1-o));r.strokeStyle="rgba(255, 255, 255, 0.95)",r.lineWidth=2,r.shadowColor="rgba(0, 0, 0, 0.8)",r.shadowBlur=4,r.beginPath(),r.moveTo(0,l),r.lineTo(i,l),r.stroke(),r.shadowBlur=0}function $i(){if(!xt||te.length===0)return;const t=xt.getContext("2d");if(!t)return;const e=xt.width,n=xt.height;Sn(t,e,n,te)}class Mi{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){const n=this._partials;let r=0;for(let i=0;i<this._n&&i<32;i++){const a=n[i],o=e+a,l=Math.abs(e)<Math.abs(a)?e-(o-a):a-(o-e);l&&(n[r++]=l),e=o}return n[r]=e,this._n=r+1,this}valueOf(){const e=this._partials;let n=this._n,r,i,a,o=0;if(n>0){for(o=e[--n];n>0&&(r=o,i=e[--n],o=r+i,a=i-(o-r),!a););n>0&&(a<0&&e[n-1]<0||a>0&&e[n-1]>0)&&(i=a*2,r=o+i,i==r-o&&(o=r))}return o}}function*Ei(t){for(const e of t)yield*e}function Mr(t){return Array.from(Ei(t))}var Di={value:()=>{}};function Er(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new Se(n)}function Se(t){this._=t}function Ti(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}Se.prototype=Er.prototype={constructor:Se,on:function(t,e){var n=this._,r=Ti(t+"",n),i,a=-1,o=r.length;if(arguments.length<2){for(;++a<o;)if((i=(t=r[a]).type)&&(i=Ci(n[i],t.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++a<o;)if(i=(t=r[a]).type)n[i]=Bn(n[i],t.name,e);else if(e==null)for(i in n)n[i]=Bn(n[i],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new Se(t)},call:function(t,e){if((i=arguments.length-2)>0)for(var n=new Array(i),r=0,i,a;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=this._[t],r=0,i=a.length;r<i;++r)a[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],i=0,a=r.length;i<a;++i)r[i].value.apply(e,n)}};function Ci(t,e){for(var n=0,r=t.length,i;n<r;++n)if((i=t[n]).name===e)return i.value}function Bn(t,e,n){for(var r=0,i=t.length;r<i;++r)if(t[r].name===e){t[r]=Di,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var nn="http://www.w3.org/1999/xhtml";const Fn={svg:"http://www.w3.org/2000/svg",xhtml:nn,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Ve(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),Fn.hasOwnProperty(e)?{space:Fn[e],local:t}:t}function Ii(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===nn&&e.documentElement.namespaceURI===nn?e.createElement(t):e.createElementNS(n,t)}}function Ai(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function Dr(t){var e=Ve(t);return(e.local?Ai:Ii)(e)}function Ri(){}function _n(t){return t==null?Ri:function(){return this.querySelector(t)}}function Ni(t){typeof t!="function"&&(t=_n(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var a=e[i],o=a.length,l=r[i]=new Array(o),u,f,s=0;s<o;++s)(u=a[s])&&(f=t.call(u,u.__data__,s,a))&&("__data__"in u&&(f.__data__=u.__data__),l[s]=f);return new at(r,this._parents)}function ki(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function Li(){return[]}function Tr(t){return t==null?Li:function(){return this.querySelectorAll(t)}}function Pi(t){return function(){return ki(t.apply(this,arguments))}}function Bi(t){typeof t=="function"?t=Pi(t):t=Tr(t);for(var e=this._groups,n=e.length,r=[],i=[],a=0;a<n;++a)for(var o=e[a],l=o.length,u,f=0;f<l;++f)(u=o[f])&&(r.push(t.call(u,u.__data__,f,o)),i.push(u));return new at(r,i)}function Cr(t){return function(){return this.matches(t)}}function Ir(t){return function(e){return e.matches(t)}}var Fi=Array.prototype.find;function Xi(t){return function(){return Fi.call(this.children,t)}}function Oi(){return this.firstElementChild}function qi(t){return this.select(t==null?Oi:Xi(typeof t=="function"?t:Ir(t)))}var Vi=Array.prototype.filter;function zi(){return Array.from(this.children)}function Hi(t){return function(){return Vi.call(this.children,t)}}function Wi(t){return this.selectAll(t==null?zi:Hi(typeof t=="function"?t:Ir(t)))}function Ui(t){typeof t!="function"&&(t=Cr(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var a=e[i],o=a.length,l=r[i]=[],u,f=0;f<o;++f)(u=a[f])&&t.call(u,u.__data__,f,a)&&l.push(u);return new at(r,this._parents)}function Ar(t){return new Array(t.length)}function Yi(){return new at(this._enter||this._groups.map(Ar),this._parents)}function Te(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}Te.prototype={constructor:Te,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function Gi(t){return function(){return t}}function Ki(t,e,n,r,i,a){for(var o=0,l,u=e.length,f=a.length;o<f;++o)(l=e[o])?(l.__data__=a[o],r[o]=l):n[o]=new Te(t,a[o]);for(;o<u;++o)(l=e[o])&&(i[o]=l)}function Zi(t,e,n,r,i,a,o){var l,u,f=new Map,s=e.length,d=a.length,h=new Array(s),p;for(l=0;l<s;++l)(u=e[l])&&(h[l]=p=o.call(u,u.__data__,l,e)+"",f.has(p)?i[l]=u:f.set(p,u));for(l=0;l<d;++l)p=o.call(t,a[l],l,a)+"",(u=f.get(p))?(r[l]=u,u.__data__=a[l],f.delete(p)):n[l]=new Te(t,a[l]);for(l=0;l<s;++l)(u=e[l])&&f.get(h[l])===u&&(i[l]=u)}function Ji(t){return t.__data__}function Qi(t,e){if(!arguments.length)return Array.from(this,Ji);var n=e?Zi:Ki,r=this._parents,i=this._groups;typeof t!="function"&&(t=Gi(t));for(var a=i.length,o=new Array(a),l=new Array(a),u=new Array(a),f=0;f<a;++f){var s=r[f],d=i[f],h=d.length,p=ji(t.call(s,s&&s.__data__,f,r)),g=p.length,y=l[f]=new Array(g),m=o[f]=new Array(g),b=u[f]=new Array(h);n(s,d,y,m,b,p,e);for(var v=0,x=0,S,_;v<g;++v)if(S=y[v]){for(v>=x&&(x=v+1);!(_=m[x])&&++x<g;);S._next=_||null}}return o=new at(o,r),o._enter=l,o._exit=u,o}function ji(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function ta(){return new at(this._exit||this._groups.map(Ar),this._parents)}function ea(t,e,n){var r=this.enter(),i=this,a=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(i=e(i),i&&(i=i.selection())),n==null?a.remove():n(a),r&&i?r.merge(i).order():i}function na(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,i=n.length,a=r.length,o=Math.min(i,a),l=new Array(i),u=0;u<o;++u)for(var f=n[u],s=r[u],d=f.length,h=l[u]=new Array(d),p,g=0;g<d;++g)(p=f[g]||s[g])&&(h[g]=p);for(;u<i;++u)l[u]=n[u];return new at(l,this._parents)}function ra(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],i=r.length-1,a=r[i],o;--i>=0;)(o=r[i])&&(a&&o.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(o,a),a=o);return this}function ia(t){t||(t=aa);function e(d,h){return d&&h?t(d.__data__,h.__data__):!d-!h}for(var n=this._groups,r=n.length,i=new Array(r),a=0;a<r;++a){for(var o=n[a],l=o.length,u=i[a]=new Array(l),f,s=0;s<l;++s)(f=o[s])&&(u[s]=f);u.sort(e)}return new at(i,this._parents).order()}function aa(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function oa(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function sa(){return Array.from(this)}function la(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,a=r.length;i<a;++i){var o=r[i];if(o)return o}return null}function ca(){let t=0;for(const e of this)++t;return t}function ua(){return!this.node()}function fa(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var i=e[n],a=0,o=i.length,l;a<o;++a)(l=i[a])&&t.call(l,l.__data__,a,i);return this}function da(t){return function(){this.removeAttribute(t)}}function ha(t){return function(){this.removeAttributeNS(t.space,t.local)}}function pa(t,e){return function(){this.setAttribute(t,e)}}function ga(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function ma(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function va(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function ya(t,e){var n=Ve(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?ha:da:typeof e=="function"?n.local?va:ma:n.local?ga:pa)(n,e))}function Rr(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function xa(t){return function(){this.style.removeProperty(t)}}function wa(t,e,n){return function(){this.style.setProperty(t,e,n)}}function ba(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function Sa(t,e,n){return arguments.length>1?this.each((e==null?xa:typeof e=="function"?ba:wa)(t,e,n??"")):Vt(this.node(),t)}function Vt(t,e){return t.style.getPropertyValue(e)||Rr(t).getComputedStyle(t,null).getPropertyValue(e)}function _a(t){return function(){delete this[t]}}function $a(t,e){return function(){this[t]=e}}function Ma(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function Ea(t,e){return arguments.length>1?this.each((e==null?_a:typeof e=="function"?Ma:$a)(t,e)):this.node()[t]}function Nr(t){return t.trim().split(/^|\s+/)}function $n(t){return t.classList||new kr(t)}function kr(t){this._node=t,this._names=Nr(t.getAttribute("class")||"")}kr.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function Lr(t,e){for(var n=$n(t),r=-1,i=e.length;++r<i;)n.add(e[r])}function Pr(t,e){for(var n=$n(t),r=-1,i=e.length;++r<i;)n.remove(e[r])}function Da(t){return function(){Lr(this,t)}}function Ta(t){return function(){Pr(this,t)}}function Ca(t,e){return function(){(e.apply(this,arguments)?Lr:Pr)(this,t)}}function Ia(t,e){var n=Nr(t+"");if(arguments.length<2){for(var r=$n(this.node()),i=-1,a=n.length;++i<a;)if(!r.contains(n[i]))return!1;return!0}return this.each((typeof e=="function"?Ca:e?Da:Ta)(n,e))}function Aa(){this.textContent=""}function Ra(t){return function(){this.textContent=t}}function Na(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function ka(t){return arguments.length?this.each(t==null?Aa:(typeof t=="function"?Na:Ra)(t)):this.node().textContent}function La(){this.innerHTML=""}function Pa(t){return function(){this.innerHTML=t}}function Ba(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function Fa(t){return arguments.length?this.each(t==null?La:(typeof t=="function"?Ba:Pa)(t)):this.node().innerHTML}function Xa(){this.nextSibling&&this.parentNode.appendChild(this)}function Oa(){return this.each(Xa)}function qa(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Va(){return this.each(qa)}function za(t){var e=typeof t=="function"?t:Dr(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function Ha(){return null}function Wa(t,e){var n=typeof t=="function"?t:Dr(t),r=e==null?Ha:typeof e=="function"?e:_n(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function Ua(){var t=this.parentNode;t&&t.removeChild(this)}function Ya(){return this.each(Ua)}function Ga(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Ka(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function Za(t){return this.select(t?Ka:Ga)}function Ja(t){return arguments.length?this.property("__data__",t):this.node().__data__}function Qa(t){return function(e){t.call(this,e,this.__data__)}}function ja(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function to(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,i=e.length,a;n<i;++n)a=e[n],(!t.type||a.type===t.type)&&a.name===t.name?this.removeEventListener(a.type,a.listener,a.options):e[++r]=a;++r?e.length=r:delete this.__on}}}function eo(t,e,n){return function(){var r=this.__on,i,a=Qa(e);if(r){for(var o=0,l=r.length;o<l;++o)if((i=r[o]).type===t.type&&i.name===t.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=a,i.options=n),i.value=e;return}}this.addEventListener(t.type,a,n),i={type:t.type,name:t.name,value:e,listener:a,options:n},r?r.push(i):this.__on=[i]}}function no(t,e,n){var r=ja(t+""),i,a=r.length,o;if(arguments.length<2){var l=this.node().__on;if(l){for(var u=0,f=l.length,s;u<f;++u)for(i=0,s=l[u];i<a;++i)if((o=r[i]).type===s.type&&o.name===s.name)return s.value}return}for(l=e?eo:to,i=0;i<a;++i)this.each(l(r[i],e,n));return this}function Br(t,e,n){var r=Rr(t),i=r.CustomEvent;typeof i=="function"?i=new i(e,n):(i=r.document.createEvent("Event"),n?(i.initEvent(e,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(e,!1,!1)),t.dispatchEvent(i)}function ro(t,e){return function(){return Br(this,t,e)}}function io(t,e){return function(){return Br(this,t,e.apply(this,arguments))}}function ao(t,e){return this.each((typeof e=="function"?io:ro)(t,e))}function*oo(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],i=0,a=r.length,o;i<a;++i)(o=r[i])&&(yield o)}var so=[null];function at(t,e){this._groups=t,this._parents=e}function le(){return new at([[document.documentElement]],so)}function lo(){return this}at.prototype=le.prototype={constructor:at,select:Ni,selectAll:Bi,selectChild:qi,selectChildren:Wi,filter:Ui,data:Qi,enter:Yi,exit:ta,join:ea,merge:na,selection:lo,order:ra,sort:ia,call:oa,nodes:sa,node:la,size:ca,empty:ua,each:fa,attr:ya,style:Sa,property:Ea,classed:Ia,text:ka,html:Fa,raise:Oa,lower:Va,append:za,insert:Wa,remove:Ya,clone:Za,datum:Ja,on:no,dispatch:ao,[Symbol.iterator]:oo};function co(t){let e;for(;e=t.sourceEvent;)t=e;return t}function uo(t,e){if(t=co(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}}return[t.pageX,t.pageY]}function Mn(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Fr(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function ce(){}var ee=.7,Ce=1/ee,Ot="\\s*([+-]?\\d+)\\s*",ne="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ut="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",fo=/^#([0-9a-f]{3,8})$/,ho=new RegExp(`^rgb\\(${Ot},${Ot},${Ot}\\)$`),po=new RegExp(`^rgb\\(${ut},${ut},${ut}\\)$`),go=new RegExp(`^rgba\\(${Ot},${Ot},${Ot},${ne}\\)$`),mo=new RegExp(`^rgba\\(${ut},${ut},${ut},${ne}\\)$`),vo=new RegExp(`^hsl\\(${ne},${ut},${ut}\\)$`),yo=new RegExp(`^hsla\\(${ne},${ut},${ut},${ne}\\)$`),Xn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Mn(ce,re,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:On,formatHex:On,formatHex8:xo,formatHsl:wo,formatRgb:qn,toString:qn});function On(){return this.rgb().formatHex()}function xo(){return this.rgb().formatHex8()}function wo(){return Xr(this).formatHsl()}function qn(){return this.rgb().formatRgb()}function re(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=fo.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?Vn(e):n===3?new K(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?he(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?he(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=ho.exec(t))?new K(e[1],e[2],e[3],1):(e=po.exec(t))?new K(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=go.exec(t))?he(e[1],e[2],e[3],e[4]):(e=mo.exec(t))?he(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=vo.exec(t))?Wn(e[1],e[2]/100,e[3]/100,1):(e=yo.exec(t))?Wn(e[1],e[2]/100,e[3]/100,e[4]):Xn.hasOwnProperty(t)?Vn(Xn[t]):t==="transparent"?new K(NaN,NaN,NaN,0):null}function Vn(t){return new K(t>>16&255,t>>8&255,t&255,1)}function he(t,e,n,r){return r<=0&&(t=e=n=NaN),new K(t,e,n,r)}function bo(t){return t instanceof ce||(t=re(t)),t?(t=t.rgb(),new K(t.r,t.g,t.b,t.opacity)):new K}function rn(t,e,n,r){return arguments.length===1?bo(t):new K(t,e,n,r??1)}function K(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}Mn(K,rn,Fr(ce,{brighter(t){return t=t==null?Ce:Math.pow(Ce,t),new K(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?ee:Math.pow(ee,t),new K(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new K(Nt(this.r),Nt(this.g),Nt(this.b),Ie(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:zn,formatHex:zn,formatHex8:So,formatRgb:Hn,toString:Hn}));function zn(){return`#${At(this.r)}${At(this.g)}${At(this.b)}`}function So(){return`#${At(this.r)}${At(this.g)}${At(this.b)}${At((isNaN(this.opacity)?1:this.opacity)*255)}`}function Hn(){const t=Ie(this.opacity);return`${t===1?"rgb(":"rgba("}${Nt(this.r)}, ${Nt(this.g)}, ${Nt(this.b)}${t===1?")":`, ${t})`}`}function Ie(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Nt(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function At(t){return t=Nt(t),(t<16?"0":"")+t.toString(16)}function Wn(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new nt(t,e,n,r)}function Xr(t){if(t instanceof nt)return new nt(t.h,t.s,t.l,t.opacity);if(t instanceof ce||(t=re(t)),!t)return new nt;if(t instanceof nt)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),a=Math.max(e,n,r),o=NaN,l=a-i,u=(a+i)/2;return l?(e===a?o=(n-r)/l+(n<r)*6:n===a?o=(r-e)/l+2:o=(e-n)/l+4,l/=u<.5?a+i:2-a-i,o*=60):l=u>0&&u<1?0:o,new nt(o,l,u,t.opacity)}function _o(t,e,n,r){return arguments.length===1?Xr(t):new nt(t,e,n,r??1)}function nt(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}Mn(nt,_o,Fr(ce,{brighter(t){return t=t==null?Ce:Math.pow(Ce,t),new nt(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?ee:Math.pow(ee,t),new nt(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new K(Ze(t>=240?t-240:t+120,i,r),Ze(t,i,r),Ze(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new nt(Un(this.h),pe(this.s),pe(this.l),Ie(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Ie(this.opacity);return`${t===1?"hsl(":"hsla("}${Un(this.h)}, ${pe(this.s)*100}%, ${pe(this.l)*100}%${t===1?")":`, ${t})`}`}}));function Un(t){return t=(t||0)%360,t<0?t+360:t}function pe(t){return Math.max(0,Math.min(1,t||0))}function Ze(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const Or=t=>()=>t;function $o(t,e){return function(n){return t+n*e}}function Mo(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function Eo(t){return(t=+t)==1?qr:function(e,n){return n-e?Mo(e,n,t):Or(isNaN(e)?n:e)}}function qr(t,e){var n=e-t;return n?$o(t,n):Or(isNaN(t)?e:t)}const Yn=(function t(e){var n=Eo(e);function r(i,a){var o=n((i=rn(i)).r,(a=rn(a)).r),l=n(i.g,a.g),u=n(i.b,a.b),f=qr(i.opacity,a.opacity);return function(s){return i.r=o(s),i.g=l(s),i.b=u(s),i.opacity=f(s),i+""}}return r.gamma=t,r})(1);function _t(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}var an=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Je=new RegExp(an.source,"g");function Do(t){return function(){return t}}function To(t){return function(e){return t(e)+""}}function Co(t,e){var n=an.lastIndex=Je.lastIndex=0,r,i,a,o=-1,l=[],u=[];for(t=t+"",e=e+"";(r=an.exec(t))&&(i=Je.exec(e));)(a=i.index)>n&&(a=e.slice(n,a),l[o]?l[o]+=a:l[++o]=a),(r=r[0])===(i=i[0])?l[o]?l[o]+=i:l[++o]=i:(l[++o]=null,u.push({i:o,x:_t(r,i)})),n=Je.lastIndex;return n<e.length&&(a=e.slice(n),l[o]?l[o]+=a:l[++o]=a),l.length<2?u[0]?To(u[0].x):Do(e):(e=u.length,function(f){for(var s=0,d;s<e;++s)l[(d=u[s]).i]=d.x(f);return l.join("")})}var Gn=180/Math.PI,on={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Vr(t,e,n,r,i,a){var o,l,u;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(u=t*n+e*r)&&(n-=t*u,r-=e*u),(l=Math.sqrt(n*n+r*r))&&(n/=l,r/=l,u/=l),t*r<e*n&&(t=-t,e=-e,u=-u,o=-o),{translateX:i,translateY:a,rotate:Math.atan2(e,t)*Gn,skewX:Math.atan(u)*Gn,scaleX:o,scaleY:l}}var ge;function Io(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?on:Vr(e.a,e.b,e.c,e.d,e.e,e.f)}function Ao(t){return t==null||(ge||(ge=document.createElementNS("http://www.w3.org/2000/svg","g")),ge.setAttribute("transform",t),!(t=ge.transform.baseVal.consolidate()))?on:(t=t.matrix,Vr(t.a,t.b,t.c,t.d,t.e,t.f))}function zr(t,e,n,r){function i(f){return f.length?f.pop()+" ":""}function a(f,s,d,h,p,g){if(f!==d||s!==h){var y=p.push("translate(",null,e,null,n);g.push({i:y-4,x:_t(f,d)},{i:y-2,x:_t(s,h)})}else(d||h)&&p.push("translate("+d+e+h+n)}function o(f,s,d,h){f!==s?(f-s>180?s+=360:s-f>180&&(f+=360),h.push({i:d.push(i(d)+"rotate(",null,r)-2,x:_t(f,s)})):s&&d.push(i(d)+"rotate("+s+r)}function l(f,s,d,h){f!==s?h.push({i:d.push(i(d)+"skewX(",null,r)-2,x:_t(f,s)}):s&&d.push(i(d)+"skewX("+s+r)}function u(f,s,d,h,p,g){if(f!==d||s!==h){var y=p.push(i(p)+"scale(",null,",",null,")");g.push({i:y-4,x:_t(f,d)},{i:y-2,x:_t(s,h)})}else(d!==1||h!==1)&&p.push(i(p)+"scale("+d+","+h+")")}return function(f,s){var d=[],h=[];return f=t(f),s=t(s),a(f.translateX,f.translateY,s.translateX,s.translateY,d,h),o(f.rotate,s.rotate,d,h),l(f.skewX,s.skewX,d,h),u(f.scaleX,f.scaleY,s.scaleX,s.scaleY,d,h),f=s=null,function(p){for(var g=-1,y=h.length,m;++g<y;)d[(m=h[g]).i]=m.x(p);return d.join("")}}}var Ro=zr(Io,"px, ","px)","deg)"),No=zr(Ao,", ",")",")"),zt=0,Kt=0,Ut=0,Hr=1e3,Ae,Zt,Re=0,Lt=0,ze=0,ie=typeof performance=="object"&&performance.now?performance:Date,Wr=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function En(){return Lt||(Wr(ko),Lt=ie.now()+ze)}function ko(){Lt=0}function Ne(){this._call=this._time=this._next=null}Ne.prototype=Ur.prototype={constructor:Ne,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?En():+n)+(e==null?0:+e),!this._next&&Zt!==this&&(Zt?Zt._next=this:Ae=this,Zt=this),this._call=t,this._time=n,sn()},stop:function(){this._call&&(this._call=null,this._time=1/0,sn())}};function Ur(t,e,n){var r=new Ne;return r.restart(t,e,n),r}function Lo(){En(),++zt;for(var t=Ae,e;t;)(e=Lt-t._time)>=0&&t._call.call(void 0,e),t=t._next;--zt}function Kn(){Lt=(Re=ie.now())+ze,zt=Kt=0;try{Lo()}finally{zt=0,Bo(),Lt=0}}function Po(){var t=ie.now(),e=t-Re;e>Hr&&(ze-=e,Re=t)}function Bo(){for(var t,e=Ae,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:Ae=n);Zt=t,sn(r)}function sn(t){if(!zt){Kt&&(Kt=clearTimeout(Kt));var e=t-Lt;e>24?(t<1/0&&(Kt=setTimeout(Kn,t-ie.now()-ze)),Ut&&(Ut=clearInterval(Ut))):(Ut||(Re=ie.now(),Ut=setInterval(Po,Hr)),zt=1,Wr(Kn))}}function Zn(t,e,n){var r=new Ne;return e=e==null?0:+e,r.restart(i=>{r.stop(),t(i+e)},e,n),r}var Fo=Er("start","end","cancel","interrupt"),Xo=[],Yr=0,Jn=1,ln=2,_e=3,Qn=4,cn=5,$e=6;function He(t,e,n,r,i,a){var o=t.__transition;if(!o)t.__transition={};else if(n in o)return;Oo(t,n,{name:e,index:r,group:i,on:Fo,tween:Xo,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:Yr})}function Dn(t,e){var n=st(t,e);if(n.state>Yr)throw new Error("too late; already scheduled");return n}function dt(t,e){var n=st(t,e);if(n.state>_e)throw new Error("too late; already running");return n}function st(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function Oo(t,e,n){var r=t.__transition,i;r[e]=n,n.timer=Ur(a,0,n.time);function a(f){n.state=Jn,n.timer.restart(o,n.delay,n.time),n.delay<=f&&o(f-n.delay)}function o(f){var s,d,h,p;if(n.state!==Jn)return u();for(s in r)if(p=r[s],p.name===n.name){if(p.state===_e)return Zn(o);p.state===Qn?(p.state=$e,p.timer.stop(),p.on.call("interrupt",t,t.__data__,p.index,p.group),delete r[s]):+s<e&&(p.state=$e,p.timer.stop(),p.on.call("cancel",t,t.__data__,p.index,p.group),delete r[s])}if(Zn(function(){n.state===_e&&(n.state=Qn,n.timer.restart(l,n.delay,n.time),l(f))}),n.state=ln,n.on.call("start",t,t.__data__,n.index,n.group),n.state===ln){for(n.state=_e,i=new Array(h=n.tween.length),s=0,d=-1;s<h;++s)(p=n.tween[s].value.call(t,t.__data__,n.index,n.group))&&(i[++d]=p);i.length=d+1}}function l(f){for(var s=f<n.duration?n.ease.call(null,f/n.duration):(n.timer.restart(u),n.state=cn,1),d=-1,h=i.length;++d<h;)i[d].call(t,s);n.state===cn&&(n.on.call("end",t,t.__data__,n.index,n.group),u())}function u(){n.state=$e,n.timer.stop(),delete r[e];for(var f in r)return;delete t.__transition}}function qo(t,e){var n=t.__transition,r,i,a=!0,o;if(n){e=e==null?null:e+"";for(o in n){if((r=n[o]).name!==e){a=!1;continue}i=r.state>ln&&r.state<cn,r.state=$e,r.timer.stop(),r.on.call(i?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[o]}a&&delete t.__transition}}function Vo(t){return this.each(function(){qo(this,t)})}function zo(t,e){var n,r;return function(){var i=dt(this,t),a=i.tween;if(a!==n){r=n=a;for(var o=0,l=r.length;o<l;++o)if(r[o].name===e){r=r.slice(),r.splice(o,1);break}}i.tween=r}}function Ho(t,e,n){var r,i;if(typeof n!="function")throw new Error;return function(){var a=dt(this,t),o=a.tween;if(o!==r){i=(r=o).slice();for(var l={name:e,value:n},u=0,f=i.length;u<f;++u)if(i[u].name===e){i[u]=l;break}u===f&&i.push(l)}a.tween=i}}function Wo(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=st(this.node(),n).tween,i=0,a=r.length,o;i<a;++i)if((o=r[i]).name===t)return o.value;return null}return this.each((e==null?zo:Ho)(n,t,e))}function Tn(t,e,n){var r=t._id;return t.each(function(){var i=dt(this,r);(i.value||(i.value={}))[e]=n.apply(this,arguments)}),function(i){return st(i,r).value[e]}}function Gr(t,e){var n;return(typeof e=="number"?_t:e instanceof re?Yn:(n=re(e))?(e=n,Yn):Co)(t,e)}function Uo(t){return function(){this.removeAttribute(t)}}function Yo(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Go(t,e,n){var r,i=n+"",a;return function(){var o=this.getAttribute(t);return o===i?null:o===r?a:a=e(r=o,n)}}function Ko(t,e,n){var r,i=n+"",a;return function(){var o=this.getAttributeNS(t.space,t.local);return o===i?null:o===r?a:a=e(r=o,n)}}function Zo(t,e,n){var r,i,a;return function(){var o,l=n(this),u;return l==null?void this.removeAttribute(t):(o=this.getAttribute(t),u=l+"",o===u?null:o===r&&u===i?a:(i=u,a=e(r=o,l)))}}function Jo(t,e,n){var r,i,a;return function(){var o,l=n(this),u;return l==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),u=l+"",o===u?null:o===r&&u===i?a:(i=u,a=e(r=o,l)))}}function Qo(t,e){var n=Ve(t),r=n==="transform"?No:Gr;return this.attrTween(t,typeof e=="function"?(n.local?Jo:Zo)(n,r,Tn(this,"attr."+t,e)):e==null?(n.local?Yo:Uo)(n):(n.local?Ko:Go)(n,r,e))}function jo(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function ts(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function es(t,e){var n,r;function i(){var a=e.apply(this,arguments);return a!==r&&(n=(r=a)&&ts(t,a)),n}return i._value=e,i}function ns(t,e){var n,r;function i(){var a=e.apply(this,arguments);return a!==r&&(n=(r=a)&&jo(t,a)),n}return i._value=e,i}function rs(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=Ve(t);return this.tween(n,(r.local?es:ns)(r,e))}function is(t,e){return function(){Dn(this,t).delay=+e.apply(this,arguments)}}function as(t,e){return e=+e,function(){Dn(this,t).delay=e}}function os(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?is:as)(e,t)):st(this.node(),e).delay}function ss(t,e){return function(){dt(this,t).duration=+e.apply(this,arguments)}}function ls(t,e){return e=+e,function(){dt(this,t).duration=e}}function cs(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?ss:ls)(e,t)):st(this.node(),e).duration}function us(t,e){if(typeof e!="function")throw new Error;return function(){dt(this,t).ease=e}}function fs(t){var e=this._id;return arguments.length?this.each(us(e,t)):st(this.node(),e).ease}function ds(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;dt(this,t).ease=n}}function hs(t){if(typeof t!="function")throw new Error;return this.each(ds(this._id,t))}function ps(t){typeof t!="function"&&(t=Cr(t));for(var e=this._groups,n=e.length,r=new Array(n),i=0;i<n;++i)for(var a=e[i],o=a.length,l=r[i]=[],u,f=0;f<o;++f)(u=a[f])&&t.call(u,u.__data__,f,a)&&l.push(u);return new wt(r,this._parents,this._name,this._id)}function gs(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,i=n.length,a=Math.min(r,i),o=new Array(r),l=0;l<a;++l)for(var u=e[l],f=n[l],s=u.length,d=o[l]=new Array(s),h,p=0;p<s;++p)(h=u[p]||f[p])&&(d[p]=h);for(;l<r;++l)o[l]=e[l];return new wt(o,this._parents,this._name,this._id)}function ms(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function vs(t,e,n){var r,i,a=ms(e)?Dn:dt;return function(){var o=a(this,t),l=o.on;l!==r&&(i=(r=l).copy()).on(e,n),o.on=i}}function ys(t,e){var n=this._id;return arguments.length<2?st(this.node(),n).on.on(t):this.each(vs(n,t,e))}function xs(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function ws(){return this.on("end.remove",xs(this._id))}function bs(t){var e=this._name,n=this._id;typeof t!="function"&&(t=_n(t));for(var r=this._groups,i=r.length,a=new Array(i),o=0;o<i;++o)for(var l=r[o],u=l.length,f=a[o]=new Array(u),s,d,h=0;h<u;++h)(s=l[h])&&(d=t.call(s,s.__data__,h,l))&&("__data__"in s&&(d.__data__=s.__data__),f[h]=d,He(f[h],e,n,h,f,st(s,n)));return new wt(a,this._parents,e,n)}function Ss(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Tr(t));for(var r=this._groups,i=r.length,a=[],o=[],l=0;l<i;++l)for(var u=r[l],f=u.length,s,d=0;d<f;++d)if(s=u[d]){for(var h=t.call(s,s.__data__,d,u),p,g=st(s,n),y=0,m=h.length;y<m;++y)(p=h[y])&&He(p,e,n,y,h,g);a.push(h),o.push(s)}return new wt(a,o,e,n)}var _s=le.prototype.constructor;function $s(){return new _s(this._groups,this._parents)}function Ms(t,e){var n,r,i;return function(){var a=Vt(this,t),o=(this.style.removeProperty(t),Vt(this,t));return a===o?null:a===n&&o===r?i:i=e(n=a,r=o)}}function Kr(t){return function(){this.style.removeProperty(t)}}function Es(t,e,n){var r,i=n+"",a;return function(){var o=Vt(this,t);return o===i?null:o===r?a:a=e(r=o,n)}}function Ds(t,e,n){var r,i,a;return function(){var o=Vt(this,t),l=n(this),u=l+"";return l==null&&(u=l=(this.style.removeProperty(t),Vt(this,t))),o===u?null:o===r&&u===i?a:(i=u,a=e(r=o,l))}}function Ts(t,e){var n,r,i,a="style."+e,o="end."+a,l;return function(){var u=dt(this,t),f=u.on,s=u.value[a]==null?l||(l=Kr(e)):void 0;(f!==n||i!==s)&&(r=(n=f).copy()).on(o,i=s),u.on=r}}function Cs(t,e,n){var r=(t+="")=="transform"?Ro:Gr;return e==null?this.styleTween(t,Ms(t,r)).on("end.style."+t,Kr(t)):typeof e=="function"?this.styleTween(t,Ds(t,r,Tn(this,"style."+t,e))).each(Ts(this._id,t)):this.styleTween(t,Es(t,r,e),n).on("end.style."+t,null)}function Is(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function As(t,e,n){var r,i;function a(){var o=e.apply(this,arguments);return o!==i&&(r=(i=o)&&Is(t,o,n)),r}return a._value=e,a}function Rs(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,As(t,e,n??""))}function Ns(t){return function(){this.textContent=t}}function ks(t){return function(){var e=t(this);this.textContent=e??""}}function Ls(t){return this.tween("text",typeof t=="function"?ks(Tn(this,"text",t)):Ns(t==null?"":t+""))}function Ps(t){return function(e){this.textContent=t.call(this,e)}}function Bs(t){var e,n;function r(){var i=t.apply(this,arguments);return i!==n&&(e=(n=i)&&Ps(i)),e}return r._value=t,r}function Fs(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,Bs(t))}function Xs(){for(var t=this._name,e=this._id,n=Zr(),r=this._groups,i=r.length,a=0;a<i;++a)for(var o=r[a],l=o.length,u,f=0;f<l;++f)if(u=o[f]){var s=st(u,e);He(u,t,n,f,o,{time:s.time+s.delay+s.duration,delay:0,duration:s.duration,ease:s.ease})}return new wt(r,this._parents,t,n)}function Os(){var t,e,n=this,r=n._id,i=n.size();return new Promise(function(a,o){var l={value:o},u={value:function(){--i===0&&a()}};n.each(function(){var f=dt(this,r),s=f.on;s!==t&&(e=(t=s).copy(),e._.cancel.push(l),e._.interrupt.push(l),e._.end.push(u)),f.on=e}),i===0&&a()})}var qs=0;function wt(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function Zr(){return++qs}var gt=le.prototype;wt.prototype={constructor:wt,select:bs,selectAll:Ss,selectChild:gt.selectChild,selectChildren:gt.selectChildren,filter:ps,merge:gs,selection:$s,transition:Xs,call:gt.call,nodes:gt.nodes,node:gt.node,size:gt.size,empty:gt.empty,each:gt.each,on:ys,attr:Qo,attrTween:rs,style:Cs,styleTween:Rs,text:Ls,textTween:Fs,remove:ws,tween:Wo,delay:os,duration:cs,ease:fs,easeVarying:hs,end:Os,[Symbol.iterator]:gt[Symbol.iterator]};function Vs(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var zs={time:null,delay:0,duration:250,ease:Vs};function Hs(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function Ws(t){var e,n;t instanceof wt?(e=t._id,t=t._name):(e=Zr(),(n=zs).time=En(),t=t==null?null:t+"");for(var r=this._groups,i=r.length,a=0;a<i;++a)for(var o=r[a],l=o.length,u,f=0;f<l;++f)(u=o[f])&&He(u,t,e,f,o,n||Hs(u,e));return new wt(r,this._parents,t,e)}le.prototype.interrupt=Vo;le.prototype.transition=Ws;var B=1e-6,k=Math.PI,j=k/2,jn=k/4,ot=k*2,mt=180/k,Z=k/180,X=Math.abs,Us=Math.atan,ae=Math.atan2,q=Math.cos,V=Math.sin,Ys=Math.sign||function(t){return t>0?1:t<0?-1:0},We=Math.sqrt;function Gs(t){return t>1?0:t<-1?k:Math.acos(t)}function oe(t){return t>1?j:t<-1?-j:Math.asin(t)}function Jt(){}function ke(t,e){t&&er.hasOwnProperty(t.type)&&er[t.type](t,e)}var tr={Feature:function(t,e){ke(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,r=-1,i=n.length;++r<i;)ke(n[r].geometry,e)}},er={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)t=n[r],e.point(t[0],t[1],t[2])},LineString:function(t,e){un(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)un(n[r],e,0)},Polygon:function(t,e){nr(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,r=-1,i=n.length;++r<i;)nr(n[r],e)},GeometryCollection:function(t,e){for(var n=t.geometries,r=-1,i=n.length;++r<i;)ke(n[r],e)}};function un(t,e,n){var r=-1,i=t.length-n,a;for(e.lineStart();++r<i;)a=t[r],e.point(a[0],a[1],a[2]);e.lineEnd()}function nr(t,e){var n=-1,r=t.length;for(e.polygonStart();++n<r;)un(t[n],e,1);e.polygonEnd()}function Ks(t,e){t&&tr.hasOwnProperty(t.type)?tr[t.type](t,e):ke(t,e)}function fn(t){return[ae(t[1],t[0]),oe(t[2])]}function Ht(t){var e=t[0],n=t[1],r=q(n);return[r*q(e),r*V(e),V(n)]}function me(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Le(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function Qe(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function ve(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function dn(t){var e=We(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function hn(t,e){function n(r,i){return r=t(r,i),e(r[0],r[1])}return t.invert&&e.invert&&(n.invert=function(r,i){return r=e.invert(r,i),r&&t.invert(r[0],r[1])}),n}function pn(t,e){return X(t)>k&&(t-=Math.round(t/ot)*ot),[t,e]}pn.invert=pn;function Zs(t,e,n){return(t%=ot)?e||n?hn(ir(t),ar(e,n)):ir(t):e||n?ar(e,n):pn}function rr(t){return function(e,n){return e+=t,X(e)>k&&(e-=Math.round(e/ot)*ot),[e,n]}}function ir(t){var e=rr(t);return e.invert=rr(-t),e}function ar(t,e){var n=q(t),r=V(t),i=q(e),a=V(e);function o(l,u){var f=q(u),s=q(l)*f,d=V(l)*f,h=V(u),p=h*n+s*r;return[ae(d*i-p*a,s*n-h*r),oe(p*i+d*a)]}return o.invert=function(l,u){var f=q(u),s=q(l)*f,d=V(l)*f,h=V(u),p=h*i-d*a;return[ae(d*i+h*a,s*n+p*r),oe(p*n-s*r)]},o}function Js(t,e,n,r,i,a){if(n){var o=q(e),l=V(e),u=r*n;i==null?(i=e+r*ot,a=e-u/2):(i=or(o,i),a=or(o,a),(r>0?i<a:i>a)&&(i+=r*ot));for(var f,s=i;r>0?s>a:s<a;s-=u)f=fn([o,-l*q(s),-l*V(s)]),t.point(f[0],f[1])}}function or(t,e){e=Ht(e),e[0]-=t,dn(e);var n=Gs(-e[1]);return((-e[2]<0?-n:n)+ot-B)%ot}function Jr(){var t=[],e;return{point:function(n,r,i){e.push([n,r,i])},lineStart:function(){t.push(e=[])},lineEnd:Jt,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}}function Me(t,e){return X(t[0]-e[0])<B&&X(t[1]-e[1])<B}function ye(t,e,n,r){this.x=t,this.z=e,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function Qr(t,e,n,r,i){var a=[],o=[],l,u;if(t.forEach(function(g){if(!((y=g.length-1)<=0)){var y,m=g[0],b=g[y],v;if(Me(m,b)){if(!m[2]&&!b[2]){for(i.lineStart(),l=0;l<y;++l)i.point((m=g[l])[0],m[1]);i.lineEnd();return}b[0]+=2*B}a.push(v=new ye(m,g,null,!0)),o.push(v.o=new ye(m,null,v,!1)),a.push(v=new ye(b,g,null,!1)),o.push(v.o=new ye(b,null,v,!0))}}),!!a.length){for(o.sort(e),sr(a),sr(o),l=0,u=o.length;l<u;++l)o[l].e=n=!n;for(var f=a[0],s,d;;){for(var h=f,p=!0;h.v;)if((h=h.n)===f)return;s=h.z,i.lineStart();do{if(h.v=h.o.v=!0,h.e){if(p)for(l=0,u=s.length;l<u;++l)i.point((d=s[l])[0],d[1]);else r(h.x,h.n.x,1,i);h=h.n}else{if(p)for(s=h.p.z,l=s.length-1;l>=0;--l)i.point((d=s[l])[0],d[1]);else r(h.x,h.p.x,-1,i);h=h.p}h=h.o,s=h.z,p=!p}while(!h.v);i.lineEnd()}}}function sr(t){if(e=t.length){for(var e,n=0,r=t[0],i;++n<e;)r.n=i=t[n],i.p=r,r=i;r.n=i=t[0],i.p=r}}function je(t){return X(t[0])<=k?t[0]:Ys(t[0])*((X(t[0])+k)%ot-k)}function Qs(t,e){var n=je(e),r=e[1],i=V(r),a=[V(n),-q(n),0],o=0,l=0,u=new Mi;i===1?r=j+B:i===-1&&(r=-j-B);for(var f=0,s=t.length;f<s;++f)if(h=(d=t[f]).length)for(var d,h,p=d[h-1],g=je(p),y=p[1]/2+jn,m=V(y),b=q(y),v=0;v<h;++v,g=S,m=M,b=C,p=x){var x=d[v],S=je(x),_=x[1]/2+jn,M=V(_),C=q(_),T=S-g,I=T>=0?1:-1,R=I*T,D=R>k,O=m*M;if(u.add(ae(O*I*V(R),b*C+O*q(R))),o+=D?T+I*ot:T,D^g>=n^S>=n){var L=Le(Ht(p),Ht(x));dn(L);var N=Le(a,L);dn(N);var w=(D^T>=0?-1:1)*oe(N[2]);(r>w||r===w&&(L[0]||L[1]))&&(l+=D^T>=0?1:-1)}}return(o<-B||o<B&&u<-1e-12)^l&1}function jr(t,e,n,r){return function(i){var a=e(i),o=Jr(),l=e(o),u=!1,f,s,d,h={point:p,lineStart:y,lineEnd:m,polygonStart:function(){h.point=b,h.lineStart=v,h.lineEnd=x,s=[],f=[]},polygonEnd:function(){h.point=p,h.lineStart=y,h.lineEnd=m,s=Mr(s);var S=Qs(f,r);s.length?(u||(i.polygonStart(),u=!0),Qr(s,tl,S,n,i)):S&&(u||(i.polygonStart(),u=!0),i.lineStart(),n(null,null,1,i),i.lineEnd()),u&&(i.polygonEnd(),u=!1),s=f=null},sphere:function(){i.polygonStart(),i.lineStart(),n(null,null,1,i),i.lineEnd(),i.polygonEnd()}};function p(S,_){t(S,_)&&i.point(S,_)}function g(S,_){a.point(S,_)}function y(){h.point=g,a.lineStart()}function m(){h.point=p,a.lineEnd()}function b(S,_){d.push([S,_]),l.point(S,_)}function v(){l.lineStart(),d=[]}function x(){b(d[0][0],d[0][1]),l.lineEnd();var S=l.clean(),_=o.result(),M,C=_.length,T,I,R;if(d.pop(),f.push(d),d=null,!!C){if(S&1){if(I=_[0],(T=I.length-1)>0){for(u||(i.polygonStart(),u=!0),i.lineStart(),M=0;M<T;++M)i.point((R=I[M])[0],R[1]);i.lineEnd()}return}C>1&&S&2&&_.push(_.pop().concat(_.shift())),s.push(_.filter(js))}}return h}}function js(t){return t.length>1}function tl(t,e){return((t=t.x)[0]<0?t[1]-j-B:j-t[1])-((e=e.x)[0]<0?e[1]-j-B:j-e[1])}const lr=jr(function(){return!0},el,rl,[-k,-j]);function el(t){var e=NaN,n=NaN,r=NaN,i;return{lineStart:function(){t.lineStart(),i=1},point:function(a,o){var l=a>0?k:-k,u=X(a-e);X(u-k)<B?(t.point(e,n=(n+o)/2>0?j:-j),t.point(r,n),t.lineEnd(),t.lineStart(),t.point(l,n),t.point(a,n),i=0):r!==l&&u>=k&&(X(e-r)<B&&(e-=r*B),X(a-l)<B&&(a-=l*B),n=nl(e,n,a,o),t.point(r,n),t.lineEnd(),t.lineStart(),t.point(l,n),i=0),t.point(e=a,n=o),r=l},lineEnd:function(){t.lineEnd(),e=n=NaN},clean:function(){return 2-i}}}function nl(t,e,n,r){var i,a,o=V(t-n);return X(o)>B?Us((V(e)*(a=q(r))*V(n)-V(r)*(i=q(e))*V(t))/(i*a*o)):(e+r)/2}function rl(t,e,n,r){var i;if(t==null)i=n*j,r.point(-k,i),r.point(0,i),r.point(k,i),r.point(k,0),r.point(k,-i),r.point(0,-i),r.point(-k,-i),r.point(-k,0),r.point(-k,i);else if(X(t[0]-e[0])>B){var a=t[0]<e[0]?k:-k;i=n*a/2,r.point(-a,i),r.point(0,i),r.point(a,i)}else r.point(e[0],e[1])}function il(t){var e=q(t),n=2*Z,r=e>0,i=X(e)>B;function a(s,d,h,p){Js(p,t,n,h,s,d)}function o(s,d){return q(s)*q(d)>e}function l(s){var d,h,p,g,y;return{lineStart:function(){g=p=!1,y=1},point:function(m,b){var v=[m,b],x,S=o(m,b),_=r?S?0:f(m,b):S?f(m+(m<0?k:-k),b):0;if(!d&&(g=p=S)&&s.lineStart(),S!==p&&(x=u(d,v),(!x||Me(d,x)||Me(v,x))&&(v[2]=1)),S!==p)y=0,S?(s.lineStart(),x=u(v,d),s.point(x[0],x[1])):(x=u(d,v),s.point(x[0],x[1],2),s.lineEnd()),d=x;else if(i&&d&&r^S){var M;!(_&h)&&(M=u(v,d,!0))&&(y=0,r?(s.lineStart(),s.point(M[0][0],M[0][1]),s.point(M[1][0],M[1][1]),s.lineEnd()):(s.point(M[1][0],M[1][1]),s.lineEnd(),s.lineStart(),s.point(M[0][0],M[0][1],3)))}S&&(!d||!Me(d,v))&&s.point(v[0],v[1]),d=v,p=S,h=_},lineEnd:function(){p&&s.lineEnd(),d=null},clean:function(){return y|(g&&p)<<1}}}function u(s,d,h){var p=Ht(s),g=Ht(d),y=[1,0,0],m=Le(p,g),b=me(m,m),v=m[0],x=b-v*v;if(!x)return!h&&s;var S=e*b/x,_=-e*v/x,M=Le(y,m),C=ve(y,S),T=ve(m,_);Qe(C,T);var I=M,R=me(C,I),D=me(I,I),O=R*R-D*(me(C,C)-1);if(!(O<0)){var L=We(O),N=ve(I,(-R-L)/D);if(Qe(N,C),N=fn(N),!h)return N;var w=s[0],A=d[0],z=s[1],W=d[1],P;A<w&&(P=w,w=A,A=P);var lt=A-w,G=X(lt-k)<B,ht=G||lt<B;if(!G&&W<z&&(P=z,z=W,W=P),ht?G?z+W>0^N[1]<(X(N[0]-w)<B?z:W):z<=N[1]&&N[1]<=W:lt>k^(w<=N[0]&&N[0]<=A)){var et=ve(I,(-R+L)/D);return Qe(et,C),[N,fn(et)]}}}function f(s,d){var h=r?t:k-t,p=0;return s<-h?p|=1:s>h&&(p|=2),d<-h?p|=4:d>h&&(p|=8),p}return jr(o,l,a,r?[0,-t]:[-k,t-k])}function al(t,e,n,r,i,a){var o=t[0],l=t[1],u=e[0],f=e[1],s=0,d=1,h=u-o,p=f-l,g;if(g=n-o,!(!h&&g>0)){if(g/=h,h<0){if(g<s)return;g<d&&(d=g)}else if(h>0){if(g>d)return;g>s&&(s=g)}if(g=i-o,!(!h&&g<0)){if(g/=h,h<0){if(g>d)return;g>s&&(s=g)}else if(h>0){if(g<s)return;g<d&&(d=g)}if(g=r-l,!(!p&&g>0)){if(g/=p,p<0){if(g<s)return;g<d&&(d=g)}else if(p>0){if(g>d)return;g>s&&(s=g)}if(g=a-l,!(!p&&g<0)){if(g/=p,p<0){if(g>d)return;g>s&&(s=g)}else if(p>0){if(g<s)return;g<d&&(d=g)}return s>0&&(t[0]=o+s*h,t[1]=l+s*p),d<1&&(e[0]=o+d*h,e[1]=l+d*p),!0}}}}}var Qt=1e9,xe=-Qt;function ol(t,e,n,r){function i(f,s){return t<=f&&f<=n&&e<=s&&s<=r}function a(f,s,d,h){var p=0,g=0;if(f==null||(p=o(f,d))!==(g=o(s,d))||u(f,s)<0^d>0)do h.point(p===0||p===3?t:n,p>1?r:e);while((p=(p+d+4)%4)!==g);else h.point(s[0],s[1])}function o(f,s){return X(f[0]-t)<B?s>0?0:3:X(f[0]-n)<B?s>0?2:1:X(f[1]-e)<B?s>0?1:0:s>0?3:2}function l(f,s){return u(f.x,s.x)}function u(f,s){var d=o(f,1),h=o(s,1);return d!==h?d-h:d===0?s[1]-f[1]:d===1?f[0]-s[0]:d===2?f[1]-s[1]:s[0]-f[0]}return function(f){var s=f,d=Jr(),h,p,g,y,m,b,v,x,S,_,M,C={point:T,lineStart:O,lineEnd:L,polygonStart:R,polygonEnd:D};function T(w,A){i(w,A)&&s.point(w,A)}function I(){for(var w=0,A=0,z=p.length;A<z;++A)for(var W=p[A],P=1,lt=W.length,G=W[0],ht,et,Et=G[0],pt=G[1];P<lt;++P)ht=Et,et=pt,G=W[P],Et=G[0],pt=G[1],et<=r?pt>r&&(Et-ht)*(r-et)>(pt-et)*(t-ht)&&++w:pt<=r&&(Et-ht)*(r-et)<(pt-et)*(t-ht)&&--w;return w}function R(){s=d,h=[],p=[],M=!0}function D(){var w=I(),A=M&&w,z=(h=Mr(h)).length;(A||z)&&(f.polygonStart(),A&&(f.lineStart(),a(null,null,1,f),f.lineEnd()),z&&Qr(h,l,w,a,f),f.polygonEnd()),s=f,h=p=g=null}function O(){C.point=N,p&&p.push(g=[]),_=!0,S=!1,v=x=NaN}function L(){h&&(N(y,m),b&&S&&d.rejoin(),h.push(d.result())),C.point=T,S&&s.lineEnd()}function N(w,A){var z=i(w,A);if(p&&g.push([w,A]),_)y=w,m=A,b=z,_=!1,z&&(s.lineStart(),s.point(w,A));else if(z&&S)s.point(w,A);else{var W=[v=Math.max(xe,Math.min(Qt,v)),x=Math.max(xe,Math.min(Qt,x))],P=[w=Math.max(xe,Math.min(Qt,w)),A=Math.max(xe,Math.min(Qt,A))];al(W,P,t,e,n,r)?(S||(s.lineStart(),s.point(W[0],W[1])),s.point(P[0],P[1]),z||s.lineEnd(),M=!1):z&&(s.lineStart(),s.point(w,A),M=!1)}v=w,x=A,S=z}return C}}const cr=t=>t;var Wt=1/0,Pe=Wt,se=-Wt,Be=se,ur={point:sl,lineStart:Jt,lineEnd:Jt,polygonStart:Jt,polygonEnd:Jt,result:function(){var t=[[Wt,Pe],[se,Be]];return se=Be=-(Pe=Wt=1/0),t}};function sl(t,e){t<Wt&&(Wt=t),t>se&&(se=t),e<Pe&&(Pe=e),e>Be&&(Be=e)}function Cn(t){return function(e){var n=new gn;for(var r in t)n[r]=t[r];return n.stream=e,n}}function gn(){}gn.prototype={constructor:gn,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function In(t,e,n){var r=t.clipExtent&&t.clipExtent();return t.scale(150).translate([0,0]),r!=null&&t.clipExtent(null),Ks(n,t.stream(ur)),e(ur.result()),r!=null&&t.clipExtent(r),t}function ti(t,e,n){return In(t,function(r){var i=e[1][0]-e[0][0],a=e[1][1]-e[0][1],o=Math.min(i/(r[1][0]-r[0][0]),a/(r[1][1]-r[0][1])),l=+e[0][0]+(i-o*(r[1][0]+r[0][0]))/2,u=+e[0][1]+(a-o*(r[1][1]+r[0][1]))/2;t.scale(150*o).translate([l,u])},n)}function ll(t,e,n){return ti(t,[[0,0],e],n)}function cl(t,e,n){return In(t,function(r){var i=+e,a=i/(r[1][0]-r[0][0]),o=(i-a*(r[1][0]+r[0][0]))/2,l=-a*r[0][1];t.scale(150*a).translate([o,l])},n)}function ul(t,e,n){return In(t,function(r){var i=+e,a=i/(r[1][1]-r[0][1]),o=-a*r[0][0],l=(i-a*(r[1][1]+r[0][1]))/2;t.scale(150*a).translate([o,l])},n)}var fr=16,fl=q(30*Z);function dr(t,e){return+e?hl(t,e):dl(t)}function dl(t){return Cn({point:function(e,n){e=t(e,n),this.stream.point(e[0],e[1])}})}function hl(t,e){function n(r,i,a,o,l,u,f,s,d,h,p,g,y,m){var b=f-r,v=s-i,x=b*b+v*v;if(x>4*e&&y--){var S=o+h,_=l+p,M=u+g,C=We(S*S+_*_+M*M),T=oe(M/=C),I=X(X(M)-1)<B||X(a-d)<B?(a+d)/2:ae(_,S),R=t(I,T),D=R[0],O=R[1],L=D-r,N=O-i,w=v*L-b*N;(w*w/x>e||X((b*L+v*N)/x-.5)>.3||o*h+l*p+u*g<fl)&&(n(r,i,a,o,l,u,D,O,I,S/=C,_/=C,M,y,m),m.point(D,O),n(D,O,I,S,_,M,f,s,d,h,p,g,y,m))}}return function(r){var i,a,o,l,u,f,s,d,h,p,g,y,m={point:b,lineStart:v,lineEnd:S,polygonStart:function(){r.polygonStart(),m.lineStart=_},polygonEnd:function(){r.polygonEnd(),m.lineStart=v}};function b(T,I){T=t(T,I),r.point(T[0],T[1])}function v(){d=NaN,m.point=x,r.lineStart()}function x(T,I){var R=Ht([T,I]),D=t(T,I);n(d,h,s,p,g,y,d=D[0],h=D[1],s=T,p=R[0],g=R[1],y=R[2],fr,r),r.point(d,h)}function S(){m.point=b,r.lineEnd()}function _(){v(),m.point=M,m.lineEnd=C}function M(T,I){x(i=T,I),a=d,o=h,l=p,u=g,f=y,m.point=x}function C(){n(d,h,s,p,g,y,a,o,i,l,u,f,fr,r),m.lineEnd=S,S()}return m}}var pl=Cn({point:function(t,e){this.stream.point(t*Z,e*Z)}});function gl(t){return Cn({point:function(e,n){var r=t(e,n);return this.stream.point(r[0],r[1])}})}function ml(t,e,n,r,i){function a(o,l){return o*=r,l*=i,[e+t*o,n-t*l]}return a.invert=function(o,l){return[(o-e)/t*r,(n-l)/t*i]},a}function hr(t,e,n,r,i,a){if(!a)return ml(t,e,n,r,i);var o=q(a),l=V(a),u=o*t,f=l*t,s=o/t,d=l/t,h=(l*n-o*e)/t,p=(l*e+o*n)/t;function g(y,m){return y*=r,m*=i,[u*y-f*m+e,n-f*y-u*m]}return g.invert=function(y,m){return[r*(s*y-d*m+h),i*(p-d*y-s*m)]},g}function vl(t){return yl(function(){return t})()}function yl(t){var e,n=150,r=480,i=250,a=0,o=0,l=0,u=0,f=0,s,d=0,h=1,p=1,g=null,y=lr,m=null,b,v,x,S=cr,_=.5,M,C,T,I,R;function D(w){return T(w[0]*Z,w[1]*Z)}function O(w){return w=T.invert(w[0],w[1]),w&&[w[0]*mt,w[1]*mt]}D.stream=function(w){return I&&R===w?I:I=pl(gl(s)(y(M(S(R=w)))))},D.preclip=function(w){return arguments.length?(y=w,g=void 0,N()):y},D.postclip=function(w){return arguments.length?(S=w,m=b=v=x=null,N()):S},D.clipAngle=function(w){return arguments.length?(y=+w?il(g=w*Z):(g=null,lr),N()):g*mt},D.clipExtent=function(w){return arguments.length?(S=w==null?(m=b=v=x=null,cr):ol(m=+w[0][0],b=+w[0][1],v=+w[1][0],x=+w[1][1]),N()):m==null?null:[[m,b],[v,x]]},D.scale=function(w){return arguments.length?(n=+w,L()):n},D.translate=function(w){return arguments.length?(r=+w[0],i=+w[1],L()):[r,i]},D.center=function(w){return arguments.length?(a=w[0]%360*Z,o=w[1]%360*Z,L()):[a*mt,o*mt]},D.rotate=function(w){return arguments.length?(l=w[0]%360*Z,u=w[1]%360*Z,f=w.length>2?w[2]%360*Z:0,L()):[l*mt,u*mt,f*mt]},D.angle=function(w){return arguments.length?(d=w%360*Z,L()):d*mt},D.reflectX=function(w){return arguments.length?(h=w?-1:1,L()):h<0},D.reflectY=function(w){return arguments.length?(p=w?-1:1,L()):p<0},D.precision=function(w){return arguments.length?(M=dr(C,_=w*w),N()):We(_)},D.fitExtent=function(w,A){return ti(D,w,A)},D.fitSize=function(w,A){return ll(D,w,A)},D.fitWidth=function(w,A){return cl(D,w,A)},D.fitHeight=function(w,A){return ul(D,w,A)};function L(){var w=hr(n,0,0,h,p,d).apply(null,e(a,o)),A=hr(n,r-w[0],i-w[1],h,p,d);return s=Zs(l,u,f),C=hn(e,A),T=hn(s,C),M=dr(C,_),N()}function N(){return I=R=null,D}return function(){return e=t.apply(this,arguments),D.invert=e.invert&&O,L()}}function mn(t,e){return[t,e]}mn.invert=mn;function xl(){return vl(mn).scale(152.63)}function jt(t,e,n){this.k=t,this.x=e,this.y=n}jt.prototype={constructor:jt,scale:function(t){return t===1?this:new jt(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new jt(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};jt.prototype;const An="http://localhost:8000";class kt extends Error{statusCode;details;constructor(e,n,r){super(e),this.name="DataClientError",this.statusCode=n,this.details=r}}function wl(t){return{Historical:"historical",SSP245:"ssp245",SSP585:"ssp585"}[t]||t.toLowerCase()}function bl(t){return t===1?"low":t===2?"medium":"high"}function Sl(t,e,n="float32"){const r=atob(t),i=new Uint8Array(r.length);for(let a=0;a<r.length;a++)i[a]=r.charCodeAt(a);if(n.includes("float32"))return new Float32Array(i.buffer);if(n.includes("float64"))return new Float64Array(i.buffer);throw new Error(`Unsupported dtype: ${n}`)}function _l(t,e){const n=t.flat(),r=new Float32Array(n.length);for(let i=0;i<n.length;i++)r[i]=n[i];return r}async function vn(t,e){const r=`${An}/data`;try{const i=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...t,scenario:t.scenario?wl(t.scenario):void 0,data_format:t.data_format||"base64"})});if(!i.ok){const a=await i.json().catch(()=>({detail:i.statusText}));throw new kt(a.detail||`HTTP ${i.status}: ${i.statusText}`,i.status,a)}return await i.json()}catch(i){throw i instanceof kt?i:new kt(`Failed to fetch data: ${i instanceof Error?i.message:String(i)}`,void 0,i)}}async function $l(t){const n=`${An}/metadata`;try{const r=await fetch(n,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new kt(`HTTP ${r.status}: ${r.statusText}`,r.status);return await r.json()}catch(r){throw r instanceof kt?r:new kt(`Failed to fetch metadata: ${r instanceof Error?r.message:String(r)}`)}}function Fe(t){return t.data?t.data instanceof Float32Array||t.data instanceof Float64Array?t.data:t.data_encoding==="none"?null:t.data_encoding==="base64"&&typeof t.data=="string"?Sl(t.data,t.shape,t.dtype):t.data_encoding==="list"&&Array.isArray(t.data)?_l(t.data,t.shape):null:null}function bt(t){return{variable:t.variable,time:t.date,model:t.model,scenario:t.scenario,resolution:bl(t.resolution),data_format:t.dataFormat||"base64"}}async function Ml(t){const n=`${An}/health`;try{return(await fetch(n,{method:"GET",signal:AbortSignal.timeout(5e3)})).ok}catch{return!1}}let Yt=null,yn=0,xn=1,Ct="",It="",Ee=!1;function ei(){return Yt||(Yt=document.createElement("div"),Yt.className="map-tooltip",document.body.appendChild(Yt)),Yt}function El(t,e,n,r,i,a,o){const l=ei();let u=i,f=a;It&&Ct&&(u=be(i,Ct,It,{isDifference:o??Ee}),f=_r(Ct,It)||a),l.textContent=`Lat: ${n.toFixed(2)}, Lon: ${r.toFixed(2)}, Value: ${u.toFixed(2)} ${f}`,l.style.display="block",l.style.left=`${t+10}px`,l.style.top=`${e+10}px`;let s=yn,d=xn;if(It&&Ct){const h=be(yn,Ct,It,{isDifference:o??Ee}),p=be(xn,Ct,It,{isDifference:o??Ee});s=h,d=p}_i(u,s,d)}function Xe(){const t=ei();t.style.display="none",$i()}function Dl(t,e,n,r,i){yn=t,xn=e,n!==void 0&&(Ct=n),r!==void 0&&(It=r),i!==void 0&&(Ee=i)}let Y=1,it=0,Rt=0,Dt=!1,pr=0,gr=0,mr=0,vr=0,ft=null,ni=null,ri=!1,Oe=null,ii,ai;function Tl(t){const e=t.getContext("2d");if(!e)return null;const n=t.getBoundingClientRect();return t.width=n.width*window.devicePixelRatio,t.height=n.height*window.devicePixelRatio,e.scale(window.devicePixelRatio,window.devicePixelRatio),{ctx:e,rect:n,viewWidth:n.width,viewHeight:n.height}}function Cl(t,e,n,r){const i=360/n,a=180/r,o=-180+t*i+i/2,l=90-e*a-a/2;return[o,l]}function Il(t,e,n,r,i){if(t<0||t>=n||e<0||e>=r)return null;const o=(r-1-e)*n+t,l=i[o];return isFinite(l)?l:null}function Rn(t,e,n,r,i){t.addEventListener("wheel",a=>{a.preventDefault();const o=t.getBoundingClientRect(),l=a.clientX-o.left,u=a.clientY-o.top,f=a.deltaY>0?.9:1.1,s=Y*f;if(s>=.8&&s<=10){const p=(l+it)/Y,g=(u+Rt)/Y;Y=s,it=p*Y-l,Rt=g*Y-u,e&&yr(t)}},{passive:!1}),t.addEventListener("mousedown",a=>{a.button===0&&(Dt=!0,pr=a.clientX,gr=a.clientY,mr=it,vr=Rt,t.style.cursor="grabbing")}),t.addEventListener("mousemove",a=>{if(Dt&&e){const o=a.clientX-pr,l=a.clientY-gr;it=mr-o,Rt=vr-l,yr(t),Xe()}else if(!Dt&&ni&&Oe&&ft){const[o,l]=uo(a,t);Al(a.clientX,a.clientY,o,l,n,ii,ai,ri)}}),t.addEventListener("mouseup",()=>{Dt&&(Dt=!1,t.style.cursor="auto")}),t.addEventListener("mouseleave",()=>{Dt&&(Dt=!1,t.style.cursor="grab"),Xe()}),t.style.cursor="auto"}function yr(t){if(!ft)return;const e=t.getContext("2d");if(!e)return;const n=t.getBoundingClientRect();e.clearRect(0,0,n.width,n.height),e.save(),e.translate(-it,-Rt),e.scale(Y,Y),e.imageSmoothingEnabled=!0;const r=ft.width,i=it/Y,a=(it+n.width)/Y,o=Math.floor(i/r)-1,l=Math.ceil(a/r)+1;for(let u=o;u<=l;u++)e.drawImage(ft,u*r-.5,0);e.restore()}function wn(t,e,n,r,i,a,o,l){if(!e)return;const u=Fe(t);if(!u){console.warn("No data to render");return}console.log("Rendering map data (full render)");const f=Tl(e);if(!f)return;const{ctx:s,rect:d,viewWidth:h,viewHeight:p}=f,[g,y]=t.shape;s.clearRect(0,0,d.width,d.height),s.save();const m=!!t?.metadata?.comparison||typeof t.model=="string"&&t.model.includes(" minus ");ni=t,ii=o,ai=l,ri=m;const b=new Array(p).fill(null).map(()=>new Float32Array(h).fill(NaN));let v=i,x=a;if(o&&l){const P=$r(i,a,o,l,{isDifference:m});v=P.min,x=P.max}Dl(i,a,o,l,m);const M=(n.find(P=>P.name===r)||n[0]).colors.map(br),C=xl().scale(h/(2*Math.PI)).translate([h/2,p/2]),T=document.createElement("canvas");T.width=h,T.height=p;const I=T.getContext("2d");if(!I)return;const R=I.createImageData(h,p),D=R.data;console.log("Rendering map data");const O=Math.max(h/y,p/g)*.8,L=Math.ceil(O/2);for(let P=0;P<g;P++)for(let lt=0;lt<y;lt++){const G=Il(lt,P,y,g,u);if(G===null)continue;const[ht,et]=Cl(lt,P,y,g),Et=C([ht,et]);if(!Et)continue;const[pt,Nn]=Et;let kn=G;o&&l&&(kn=be(G,o,l,{isDifference:m}));const Ln=x-v,Pn=Ln===0?.5:Math.min(1,Math.max(0,(kn-v)/Ln)),Ye=Math.floor(Pn*(M.length-1)),Pt=M[Math.min(Ye,M.length-1)],Ge=M[Math.min(Ye+1,M.length-1)],Ke=Pn*(M.length-1)-Ye,oi=Math.round(Pt.r+(Ge.r-Pt.r)*Ke),si=Math.round(Pt.g+(Ge.g-Pt.g)*Ke),li=Math.round(Pt.b+(Ge.b-Pt.b)*Ke),ci=Math.max(0,Math.floor(pt-L)),ui=Math.min(h,Math.ceil(pt+L)),fi=Math.max(0,Math.floor(Nn-L)),di=Math.min(p,Math.ceil(Nn+L));for(let ue=fi;ue<di;ue++)for(let fe=ci;fe<ui;fe++){const de=(ue*h+fe)*4;D[de]=oi,D[de+1]=si,D[de+2]=li,D[de+3]=255,b[ue][fe]=G}}I.putImageData(R,0,0),ft=T,Oe=b,s.clearRect(0,0,d.width,d.height),s.save(),s.translate(-it,-Rt),s.scale(Y,Y),s.imageSmoothingEnabled=!0;const N=ft.width,w=it/Y,A=(it+d.width)/Y,z=Math.floor(w/N)-1,W=Math.ceil(A/N)+1;for(let P=z;P<=W;P++)s.drawImage(ft,P*N,0);s.restore()}function Al(t,e,n,r,i,a,o,l){if(!Oe||!ft)return;let u=(n+it)/Y;const f=(r+Rt)/Y,s=ft.width,d=ft.height;u=(u%s+s)%s;const h=Math.floor(u),p=Math.floor(f);if(h>=0&&h<s&&p>=0&&p<d){const g=Oe?.[p]?.[h]??0;if(isFinite(g)){const y=u/s*360-180,m=90-f/d*180;El(t,e,m,y,g,i,l)}else Xe()}else Xe()}function $t(t){const e=new Date(t);return`${["January","February","March","April","May","June","July","August","September","October","November","December"][e.getMonth()]} ${e.getDate()}, ${e.getFullYear()}`}function Rl(t){const{date:e,timeRange:n,sidebarOpen:r,sidebarWidth:i,mode:a,compareMode:o,compareDateStart:l,compareDateEnd:u}=t;let f=0,s=0,d=0,h=0,p=0,g=0,y=0,m=100;if(n){const v=new Date(n.start),x=new Date(n.end),S=new Date(e);if(s=Math.floor((x.getTime()-v.getTime())/(1e3*60*60*24)),d=Math.floor((S.getTime()-v.getTime())/(1e3*60*60*24)),h=s>0?d/s*100:0,a==="Compare"&&o==="Dates"){const _=l?new Date(l):v,M=u?new Date(u):x;p=Math.max(0,Math.floor((_.getTime()-v.getTime())/(1e3*60*60*24))),g=Math.min(s,Math.floor((M.getTime()-v.getTime())/(1e3*60*60*24))),y=s>0?p/s*100:0,m=s>0?g/s*100:100}}const b=r?i+16:16;if(a==="Compare"&&o==="Dates"&&n){const v=$t(l||n.start),x=$t(u||n.end);return`
      <div class="time-slider-container" style="right: ${b}px">
        <div data-role="time-label" class="time-label">${v} – ${x}</div>
        <div class="time-slider-row dual-slider" data-role="dual-slider">
          <div
            class="dual-slider-track"
            aria-hidden="true"
          ></div>
          <div
            class="dual-slider-fill"
            data-role="dual-fill"
            style="--fill-start: ${y}%; --fill-end: ${m}%"
            aria-hidden="true"
          ></div>
          <input
            type="range"
            min="${f}"
            max="${s}"
            step="1"
            value="${p}"
            data-action="set-time-start"
            class="time-slider dual-thumb dual-thumb-start"
            aria-label="Start date"
          />
          <input
            type="range"
            min="${f}"
            max="${s}"
            step="1"
            value="${g}"
            data-action="set-time-end"
            class="time-slider dual-thumb dual-thumb-end"
            aria-label="End date"
          />
        </div>
      </div>
    `}return`
      <div class="time-slider-container" style="right: ${b}px">
        <div data-role="time-label" class="time-label">${$t(e)}</div>
        <div class="time-slider-row">
          <input
            type="range"
            min="${f}"
            max="${s}"
            step="1"
            value="${d}"
            data-action="set-time"
            class="time-slider"
            style="--slider-fill: ${h}%"
          />
        </div>
      </div>
    `}let Ft=null,bn=null;function Nl(t){const{root:e,getTimeRange:n,onDateChange:r,getMode:i,getCompareMode:a,getCompareDates:o,onDateRangeChange:l}=t;bn=e.querySelector('[data-role="time-label"]')?.parentElement??null;const u=()=>i?.()==="Compare"&&a?.()==="Dates";e.querySelectorAll('[data-action="set-time"]').forEach(m=>m.addEventListener("input",()=>{if(u())return;const b=Number.parseInt(m.value,10),v=n();if(!Number.isNaN(b)&&v){const x=new Date(v.start);x.setDate(x.getDate()+b);const S=x.toISOString().split("T")[0],_=e.querySelector('[data-role="time-label"]');_&&(_.textContent=$t(S));const M=new Date(v.end),C=Math.floor((M.getTime()-new Date(v.start).getTime())/(1e3*60*60*24)),T=C>0?b/C*100:0;m.style.setProperty("--slider-fill",`${T}%`),Ft&&window.clearTimeout(Ft),Ft=window.setTimeout(()=>{r(S)},500)}}));const s=e.querySelectorAll('[data-action="set-time-start"]'),d=e.querySelectorAll('[data-action="set-time-end"]'),h=e.querySelector('[data-role="dual-fill"]'),p=(m,b,v,x,S)=>{const _=e.querySelector('[data-role="time-label"]'),M=new Date(v.start),C=new Date(v.start);M.setDate(M.getDate()+m),C.setDate(C.getDate()+b);const T=M.toISOString().split("T")[0],I=C.toISOString().split("T")[0];_&&(_.textContent=`${$t(T)} – ${$t(I)}`);const R=new Date(v.end).getTime()-new Date(v.start).getTime(),D=Math.max(1,Math.floor(R/(1e3*60*60*24))),O=m/D*100,L=b/D*100;[h,x,S].forEach(w=>{w&&(w.style.setProperty("--fill-start",`${O}%`),w.style.setProperty("--fill-end",`${L}%`))})},g=(m,b,v)=>{m.addEventListener("input",()=>{if(!u())return;const x=n();if(!x)return;const S=Math.floor((new Date(x.end).getTime()-new Date(x.start).getTime())/(1e3*60*60*24));let _=Number.parseInt(v?m.value:b.value,10),M=Number.parseInt(v?b.value:m.value,10);if(Number.isNaN(_)||Number.isNaN(M))return;_=Math.max(0,Math.min(_,S)),M=Math.max(0,Math.min(M,S)),v&&_>M?(M=_,b.value=String(M)):!v&&M<_&&(_=M,b.value=String(_)),p(_,M,x,v?m:b,v?b:m);const C=new Date(x.start);C.setDate(C.getDate()+_);const T=new Date(x.start);T.setDate(T.getDate()+M);const I=C.toISOString().split("T")[0],R=T.toISOString().split("T")[0];Ft&&window.clearTimeout(Ft),Ft=window.setTimeout(()=>{l?.(I,R)},300)})},y=m=>{const b=s[0],v=d[0];!b||!v||(m==="start"?(b.style.zIndex="4",v.style.zIndex="3"):(b.style.zIndex="3",v.style.zIndex="4"))};if(s.length&&d.length){s.forEach((v,x)=>{const S=d[x]||d[0];g(v,S,!0),v.addEventListener("pointerdown",()=>y("start"))}),d.forEach((v,x)=>{const S=s[x]||s[0];g(v,S,!1),v.addEventListener("pointerdown",()=>y("end"))}),s.forEach(v=>v.addEventListener("focus",()=>y("start"))),d.forEach(v=>v.addEventListener("focus",()=>y("end")));const m=(v,x)=>{v.addEventListener("pointerdown",S=>{if(!u())return;const _=n();if(!_)return;const M=v.getBoundingClientRect(),C=Math.min(1,Math.max(0,(S.clientX-M.left)/M.width)),T=Math.max(1,Math.floor((new Date(_.end).getTime()-new Date(_.start).getTime())/(1e3*60*60*24))),I=Number.parseInt(v.value,10),D=(Number.isNaN(I)?0:Math.max(0,Math.min(I,T)))/T;Math.abs(C-D)*M.width>14&&(S.preventDefault(),S.stopPropagation(),y(v===x?"end":"start"))})};if(m(s[0],d[0]),m(d[0],s[0]),u()){const v=n(),x=o?.();if(v&&x){const S=Math.max(0,Math.floor((new Date(x.start).getTime()-new Date(v.start).getTime())/864e5)),_=Math.max(0,Math.floor((new Date(x.end).getTime()-new Date(v.start).getTime())/(1e3*60*60*24))),M=s[0],C=d[0];M.value=String(S),C.value=String(Math.max(_,S)),p(S,Math.max(_,S),v,M,C)}}e.querySelectorAll(".dual-slider").forEach(v=>{v.addEventListener("pointermove",x=>{if(!u())return;const S=n();if(!S)return;const _=s[0],M=d[0];if(!_||!M)return;const C=v.getBoundingClientRect(),T=Math.min(1,Math.max(0,(x.clientX-C.left)/C.width)),I=Math.max(1,Math.floor((new Date(S.end).getTime()-new Date(S.start).getTime())/(1e3*60*60*24)));let R=Number.parseInt(_.value,10),D=Number.parseInt(M.value,10);Number.isNaN(R)&&(R=0),Number.isNaN(D)&&(D=I);const O=R/I,L=D/I,N=Math.abs(T-O)<=Math.abs(T-L);y(N?"start":"end")})})}}function kl(t,e){if(bn){const n=t?e+16:16;bn.style.right=`${n}px`}}const De=["Historical","SSP245","SSP585"],yt=["ACCESS-CM2","CanESM5","CESM2","CMCC-CM2-SR5","EC-Earth3","GFDL-ESM4","INM-CM5-0","IPSL-CM6A-LR","MIROC6","MPI-ESM1-2-HR","MRI-ESM2-0"],qe=["tas","pr","rsds","hurs","rlds","sfcWind","tasmin","tasmax"],Q=[{name:"Viridis",colors:["#440154","#3b528b","#21908d","#5dc863","#fde725"]},{name:"Magma",colors:["#000004","#3b0f70","#8c2981","#de4968","#fe9f6d"]},{name:"Cividis",colors:["#00204c","#31456a","#6b6d7f","#a59c8f","#fdea9b"]},{name:"Thermal",colors:["#04142f","#155570","#1fa187","#f8c932","#f16623"]}],E={page:{position:"relative",minHeight:"100vh",color:"white",overflow:"hidden",fontFamily:"Inter, system-ui, sans-serif"},bgLayer1:{position:"absolute",inset:0,background:"linear-gradient(135deg, #05070f, #0b1326)"},bgLayer2:{position:"absolute",inset:0,background:"radial-gradient(circle at 20% 20%, rgba(56,189,248,0.12), transparent 32%), radial-gradient(circle at 80% 10%, rgba(139,92,246,0.15), transparent 30%), radial-gradient(circle at 50% 70%, rgba(34,197,94,0.08), transparent 28%)"},bgOverlay:{position:"absolute",inset:0,background:"#050505",opacity:.35},field:{minWidth:0,display:"flex",flexDirection:"column",gap:4},fieldLabel:{fontSize:11,letterSpacing:.5,color:"var(--text-secondary)",textTransform:"uppercase"},mapArea:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:10,textAlign:"center",pointerEvents:"none",zIndex:1},loadingIndicator:{position:"absolute",left:18,bottom:80,display:"flex",alignItems:"center",gap:12,padding:0,pointerEvents:"auto",zIndex:20,minWidth:160},loadingSpinner:{width:18,height:18,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.18)",borderTop:"2px solid #34d399",animation:"sv-spin 1s linear infinite",flexShrink:0},loadingTextGroup:{display:"flex",flexDirection:"column",gap:4,alignItems:"flex-start",minWidth:0},loadingText:{fontSize:12.5,fontWeight:700,color:"var(--text-primary)",letterSpacing:.3},loadingSubtext:{fontSize:11.5,color:"var(--text-secondary)",letterSpacing:.2},loadingBar:{position:"relative",width:120,height:6,borderRadius:999,background:"rgba(255, 255, 255, 0.08)",overflow:"hidden"},loadingBarFill:{position:"absolute",inset:0,borderRadius:999,background:"linear-gradient(90deg, rgba(52, 211, 153, 0.9), rgba(125, 211, 252, 0.9))",transition:"width 140ms ease",width:"0%"},compareInfoWrap:{position:"fixed",right:24,bottom:88,display:"flex",alignItems:"center",pointerEvents:"auto",zIndex:1e4},compareInfoButton:{padding:0,background:"transparent",border:"none",color:"var(--text-primary)",fontWeight:700,fontSize:13,letterSpacing:.2,cursor:"pointer",textDecoration:"underline"},infoModalOverlay:{position:"fixed",inset:0,background:"transparent",backdropFilter:"none",zIndex:200,display:"flex",alignItems:"center",justifyContent:"center",padding:16},infoModal:{width:"min(480px, 92vw)",background:"rgba(12, 16, 24, 0.98)",border:"1px solid var(--border-default)",borderRadius:14,boxShadow:"var(--shadow-elevated)",color:"var(--text-primary)",padding:20,position:"relative",maxWidth:"520px"},infoModalHeader:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,marginBottom:12},infoModalTitle:{fontSize:16,fontWeight:900,letterSpacing:.2,background:"var(--gradient-accent)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",color:"transparent"},infoModalClose:{width:32,height:32,borderRadius:8,border:"none",background:"transparent",color:"var(--text-secondary)",cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",fontWeight:700},infoModalBody:{fontSize:14,lineHeight:1.6,color:"var(--text-primary)",display:"block",textAlign:"left",whiteSpace:"normal",wordBreak:"break-word"},infoModalFooter:{marginTop:18,display:"flex",justifyContent:"center"},infoModalConfirm:{padding:"10px 16px",borderRadius:10,border:"1px solid var(--accent-border)",background:"var(--gradient-primary)",color:"white",fontWeight:700,cursor:"pointer",boxShadow:"var(--shadow-combined)"},canvasToggle:{position:"fixed",top:14,display:"flex",alignItems:"center",gap:8,pointerEvents:"auto",zIndex:100,transition:"right 0.25s ease"},canvasSwitch:{position:"relative",display:"grid",gridTemplateColumns:"1fr 1fr",gap:0,padding:3,borderRadius:11,background:"var(--dark-bg)",border:"var(--border-base)",boxShadow:"var(--shadow-elevated)",zIndex:101},canvasIndicator:{position:"absolute",top:3,bottom:3,left:3,width:"calc(50% - 3px)",borderRadius:9,background:"var(--gradient-indicator)",boxShadow:"var(--shadow-canvas), var(--shadow-inset)",transition:"transform 180ms ease",zIndex:0,pointerEvents:"none"},canvasBtn:{width:40,height:40,borderRadius:9,border:"1px solid transparent",background:"var(--bg-transparent)",color:"var(--text-secondary)",cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",transition:"color 120ms ease",position:"relative",zIndex:1},canvasBtnActive:{color:"white"},mapTitle:{fontSize:18,fontWeight:600},mapSubtitle:{fontSize:14,color:"var(--text-secondary)"},modeSwitch:{position:"relative",display:"grid",gridTemplateColumns:"1fr 1fr",gap:4,padding:2,borderRadius:10,border:"1px solid var(--border-subtle)",background:"var(--bg-subtle)",boxShadow:"none"},modeIndicator:{position:"absolute",top:2,bottom:2,left:2,width:"calc(50% - 2px)",borderRadius:8,background:"var(--gradient-mode-indicator)",boxShadow:"var(--shadow-combined)",transition:"transform 200ms ease",zIndex:0},modeBtn:{flex:1,padding:"8px 0",borderRadius:8,border:"none",color:"var(--text-secondary)",cursor:"pointer",transition:"all 0.15s ease",background:"var(--bg-transparent)",textAlign:"center",fontSize:12.5,fontWeight:700,letterSpacing:.2,outline:"none",boxShadow:"none",position:"relative",zIndex:1},modeBtnActive:{background:"var(--gradient-primary)",border:"none",color:"white",boxShadow:"var(--shadow-combined)"},tabSwitch:{position:"absolute",left:32,right:12,bottom:-8,display:"flex",gap:10,padding:"0 8px",alignItems:"flex-end",pointerEvents:"auto",zIndex:0},tabBtn:{borderRadius:"14px 14px 0 0",padding:"12px 18px",background:"var(--bg-strong)",color:"var(--text-secondary)",fontWeight:700,fontSize:13,letterSpacing:.35,cursor:"pointer",transition:"all 0.18s ease",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.06), 0 8px 18px rgba(0,0,0,0.32)",borderTop:"var(--border-base)",borderRight:"var(--border-base)",borderLeft:"var(--border-base)",borderBottom:"none",transform:"translateY(4px)"},tabBtnActive:{background:"var(--gradient-tab-active)",color:"white",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.12), 0 12px 26px rgba(0,0,0,0.42)",borderTop:"var(--border-active)",borderRight:"var(--border-active)",borderLeft:"var(--border-active)",borderBottom:"none",transform:"translateY(-4px)",zIndex:1},modeViewport:{overflow:"hidden",width:"100%",position:"relative",flex:1,minHeight:0,height:0},modeTrack:{display:"grid",gridTemplateColumns:"1fr 1fr",width:"200%",height:"100%",transition:"transform 220ms ease"},modePane:{width:"100%",height:"100%",paddingRight:4,overflowY:"auto",overflowX:"hidden",scrollbarGutter:"stable",minHeight:0,maxHeight:"100%"},chatBox:{display:"flex",alignItems:"center",gap:10,padding:"12px 14px",borderRadius:14,border:"1px solid var(--border-default)",background:"rgba(15,18,25,0.96)",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.05), 0 8px 20px rgba(0,0,0,0.38)"},chatInput:{flex:1,padding:"12px 0",borderRadius:8,border:"none",background:"var(--bg-transparent)",color:"white",fontSize:14,lineHeight:1.4,outline:"none",minHeight:24},chatSend:{padding:"10px 14px",borderRadius:12,border:"1px solid var(--accent-border-strong)",background:"var(--gradient-primary)",color:"white",fontWeight:700,fontSize:14,letterSpacing:.1,cursor:"pointer",boxShadow:"0 10px 22px rgba(0,0,0,0.38), var(--shadow-inset)",transition:"transform 120ms ease, box-shadow 120ms ease"},chatStack:{display:"flex",flexDirection:"column",gap:12},chatLead:{fontSize:13,color:"var(--text-secondary)",lineHeight:1.45,marginTop:10},chatMessages:{display:"flex",flexDirection:"column",gap:10,padding:"4px 0 6px",paddingRight:0,width:"100%",boxSizing:"border-box"},chatBubble:{maxWidth:"100%",width:"fit-content",padding:"16px 16px",borderRadius:12,fontSize:13,lineHeight:1.4,boxShadow:"0 6px 14px rgba(0,0,0,0.3)",boxSizing:"border-box"},chatBubbleUser:{alignSelf:"flex-end",background:"var(--gradient-chat-user)",border:"1px solid rgba(125,211,252,0.45)",color:"white",marginRight:26},chatBubbleAgent:{alignSelf:"flex-start",background:"rgba(20,24,31,0.95)",border:"1px solid var(--border-medium)",color:"var(--text-primary)"},sectionTitle:{fontSize:13,fontWeight:700,color:"var(--text-primary)",letterSpacing:.3,textTransform:"uppercase"},paramGrid:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},range:{width:"100%",background:"var(--bg-transparent)",appearance:"none",WebkitAppearance:"none",height:10,outline:"none",padding:0,margin:0},resolutionRow:{display:"flex",alignItems:"center",gap:12},resolutionValue:{fontSize:12.5,color:"var(--text-secondary)",minWidth:60,textAlign:"right"}},c={mode:"Explore",panelTab:"Manual",sidebarOpen:!0,canvasView:"map",scenario:De[0],model:yt[0],variable:qe[0],date:"2000-01-01",palette:Q[0].name,resolution:2,selectedUnit:Sr(qe[0]).label,chatInput:"",chatMessages:[],compareMode:"Scenarios",availableModels:[],compareModelA:yt[0],compareModelB:yt[1]??yt[0],compareDateStart:"1962-06-28",compareDateEnd:"2007-06-28",isLoading:!1,loadingProgress:0,dataError:null,currentData:null,apiAvailable:null,dataMin:null,dataMax:null,timeRange:null,metaData:void 0,compareInfoOpen:!1};let tn=null,Mt=null,J=null;function Ll(t){return t.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}function $(t){return Object.entries(t).filter(([,e])=>e!=null).map(([e,n])=>{const r=e.startsWith("--")?e:Ll(e),i=typeof n=="number"?`${n}px`:String(n);return`${r}:${i}`}).join(";")}function tt(...t){return t.reduce((e,n)=>n?{...e,...n}:e,{})}function we(t){const e=new Date(t);return Number.isNaN(e.getTime())?t:e.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}function Pl(t,e){return e?.variable_metadata?.[t]?.name||e?.variable_metadata?.[t]?.description||t}function Bl(t){const e=Pl(t.variable,t.metaData),n=t.selectedUnit||t.metaData?.variable_metadata?.[t.variable]?.unit||"",r=n?`${n}`:"the dataset's native units";switch(t.compareMode){case"Dates":{const i=we(t.compareDateStart),a=we(t.compareDateEnd);return{title:"Comparing two dates",paragraphs:[`We are comparing ${e} on ${i} versus ${a} under the ${t.scenario} scenario using the ${t.model} model.`,`Values on the map represent ${a} minus ${i} in ${r}. A value of X means ${e} was X ${n||""} higher on ${a} than on ${i} (negative values mean it was lower).`]}}case"Models":{const i=we(t.date);return{title:"Comparing two models",paragraphs:[`We are comparing ${e} between ${t.compareModelB} and ${t.compareModelA} on ${i} within the ${t.scenario} scenario.`,`Each value shows ${t.compareModelB} minus ${t.compareModelA} in ${r}. Positive numbers mean ${e} is higher in ${t.compareModelB}; negative means it is higher in ${t.compareModelA}.`]}}default:{const i=we(t.date),a="SSP245",o="SSP585";return{title:"Comparing two scenarios",paragraphs:[`We are comparing ${e} for ${o} versus ${a} on ${i} using the ${t.model} model.`,`Values show ${o} minus ${a} in ${r}. A value of X means ${e} is X ${n||""} higher under ${o} than under ${a}; negative values mean it is lower.`]}}}}function Fl(t){if(t.mode!=="Compare"||t.canvasView!=="map")return"";const e=Bl(t),n=e.paragraphs.map((u,f)=>{const d=f===e.paragraphs.length-1?"0":"0 0 12px 0",h=u.replace(/(\bX\b|ΔX)/g,'<span style="color: var(--accent-purple);">$1</span>');return`<p style="display:block; margin:${d}; line-height:1.6; white-space: normal; word-break: break-word;">${h}</p>`}).join(""),r=t.sidebarOpen?rt+24:24,i=t.mode==="Compare"&&t.compareMode==="Dates"?120:88,a=tt(E.infoModalOverlay,{left:"0",right:"0",width:"100%",justifyContent:"center",paddingLeft:0}),o=tt(E.infoModal,{alignSelf:"center",marginLeft:"auto",marginRight:"auto"}),l=t.compareInfoOpen?`
      <div data-role="compare-info-overlay" class="compare-info-overlay" style="${$(a)}">
        <div style="${$(o)}" role="dialog" aria-modal="true" aria-label="${e.title}">
          <div style="${$(E.infoModalHeader)}">
            <div style="${$(E.infoModalTitle)}">${e.title}</div>
            <button type="button" data-action="close-compare-info" style="${$(E.infoModalClose)}" aria-label="Close info dialog">✕</button>
          </div>
          <div style="${$(E.infoModalBody)}">
            ${n}
          </div>
          <div style="${$(E.infoModalFooter)}">
            <button type="button" data-action="close-compare-info" style="${$(E.infoModalConfirm)}">Got it</button>
          </div>
        </div>
      </div>
    `:"";return`
      <div data-role="compare-info-trigger" style="${$(tt(E.compareInfoWrap,{right:r,bottom:i}))}">
        <button type="button" data-action="open-compare-info" style="${$(E.compareInfoButton)}">
          What am I seeing?
        </button>
      </div>
      ${l}
    `}async function Xl(){try{const t=await Ml();c.apiAvailable=t}catch{c.apiAvailable=!1}}function Ol(t){if(t==="Historical")return"2000-01-01";const e=new Date,n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return n<2015?"2015-01-01":n>2100?"2100-12-31":`${n}-${r}-${i}`}function Ue(t){return t==="Historical"?{start:"1950-01-01",end:"2014-12-31"}:{start:"2015-01-01",end:"2100-12-31"}}function Xt(t,e){const n=Ue(e),r=new Date(t),i=new Date(n.start),a=new Date(n.end);return r<i?n.start:r>a?n.end:t}function ql(t){let e=1/0,n=-1/0;for(let r=0;r<t.length;r++){const i=t[r];isFinite(i)&&(e=Math.min(e,i),n=Math.max(n,i))}if(!isFinite(e)||!isFinite(n))throw new Error("No valid numeric values returned from dataset.");return{min:e,max:n}}function Vl(t,e,n,r){const i=Fe(t),a=Fe(e);if(!i||!a)throw new Error("Comparison data is missing numeric values.");if(i.length!==a.length||t.shape[0]!==e.shape[0]||t.shape[1]!==e.shape[1])throw new Error("Comparison datasets have mismatched shapes.");const o=new Float32Array(i.length);let l=1/0,u=-1/0;for(let s=0;s<i.length;s++){const d=i[s],h=a[s];if(!isFinite(d)||!isFinite(h)){o[s]=NaN;continue}const p=h-d;o[s]=p,isFinite(p)&&(l=Math.min(l,p),u=Math.max(u,p))}if(!isFinite(l)||!isFinite(u))throw new Error("Comparison produced no valid numeric values.");return{data:{...t,data:o,data_encoding:"none",dtype:"float32",model:`${r} minus ${n}`,time:`${e.time} minus ${t.time}`,scenario:`${e.scenario} minus ${t.scenario}`,metadata:{...t.metadata,comparison:{labelA:n,labelB:r}}},min:l,max:u}}function ct(t,e=!1){const n=Math.max(0,Math.min(100,Math.round(t)));n!==c.loadingProgress&&(c.loadingProgress=n,(c.isLoading||e)&&U())}async function zl(t,e){let n=bt({variable:c.variable,date:c.date,model:c.model,scenario:c.scenario,resolution:c.resolution}),r=n,i="",a="";switch(c.compareMode){case"Scenarios":{const u="SSP245",f="SSP585",s=Xt(c.date,t);s!==c.date&&(c.date=s),n=bt({variable:c.variable,date:s,model:c.model,scenario:u,resolution:c.resolution}),r=bt({variable:c.variable,date:s,model:c.model,scenario:f,resolution:c.resolution}),i=u,a=f;break}case"Models":{const u=Xt(c.date,t);u!==c.date&&(c.date=u),n=bt({variable:c.variable,date:u,model:c.compareModelA,scenario:c.scenario,resolution:c.resolution}),r=bt({variable:c.variable,date:u,model:c.compareModelB,scenario:c.scenario,resolution:c.resolution}),i=c.compareModelA,a=c.compareModelB;break}case"Dates":{const u=Xt(c.compareDateStart,c.scenario),f=Xt(c.compareDateEnd,c.scenario);u!==c.compareDateStart&&(c.compareDateStart=u),f!==c.compareDateEnd&&(c.compareDateEnd=f),n=bt({variable:c.variable,date:u,model:c.model,scenario:c.scenario,resolution:c.resolution}),r=bt({variable:c.variable,date:f,model:c.model,scenario:c.scenario,resolution:c.resolution}),i=u,a=f;break}}const o=await vn(n);e?.(65);const l=await vn(r);return e?.(85),Vl(o,l,i,a)}async function St(){if(console.log("fetching"),c.canvasView==="map"){c.isLoading=!0,ct(5,!0),c.dataError=null;try{const t=await $l();c.metaData=t,c.availableModels=t.models,ct(20);const e=c.mode==="Compare"&&c.compareMode==="Scenarios"?"SSP245":c.scenario;c.timeRange=Ue(e),ct(30);const n=c.mode==="Compare"?await zl(e,ct):await(async()=>{ct(40);const r=Xt(c.date,e);r!==c.date&&(c.date=r);const i=bt({variable:c.variable,date:r,model:c.model,scenario:c.scenario,resolution:c.resolution});ct(55);let a=await vn(i);ct(80);let o=Fe(a);if(!o)throw new Error("No data returned for the selected parameters.");if(c.variable==="hurs"){const f=new Float32Array(o.length);let s=1/0,d=-1/0;for(let h=0;h<o.length;h++){const p=o[h];if(!isFinite(p)){f[h]=NaN;continue}const g=Math.min(p,100);f[h]=g,s=Math.min(s,g),d=Math.max(d,g)}return a={...a,data:f,data_encoding:"none"},o=f,{data:a,min:s,max:d}}const{min:l,max:u}=ql(o);return ct(95),{data:a,min:l,max:u}})();if(c.currentData=n.data,c.dataMin=n.min,c.dataMax=n.max,ct(100),c.isLoading=!1,U(),J){const r=J.querySelector("#map-canvas");if(r){const i=c.metaData?.variable_metadata[c.variable]?.unit||"";Rn(r,c.currentData,i,c.variable,c.selectedUnit)}}}catch(t){t instanceof kt&&t.statusCode?c.dataError=t.message:c.dataError=t instanceof Error?t.message:String(t),c.isLoading=!1,ct(0,!0),c.currentData=null,c.dataMin=null,c.dataMax=null,U()}}}function U(){if(!J)return;const t=(c.resolution-1)/2*100,e=c.mode==="Explore"?"translateX(0%)":"translateX(-50%)",n=c.mode==="Explore"?"translateX(0%)":"translateX(100%)",r=c.canvasView==="map"?"translateX(0%)":"translateX(100%)",i=c.panelTab==="Manual"?"translateX(0%)":"translateX(-50%)";if(J.innerHTML=`
    <div style="${$(E.page)}">
      <div style="${$(E.bgLayer1)}"></div>
      <div style="${$(E.bgLayer2)}"></div>
      <div style="${$(E.bgOverlay)}"></div>
        ${c.canvasView==="map"&&c.dataMin!==null&&c.dataMax!==null?Si(c.variable,c.dataMin,c.dataMax,c.metaData,c.selectedUnit,c.mode==="Compare"):""}
      <div style="${$(E.mapArea)}">
        ${c.canvasView==="map"?`
              <canvas
                id="map-canvas"
                style="position: absolute; inset: 0; width: 100%; height: 100%; object-fit: contain; pointer-events: auto;"
              ></canvas>
              ${Hl()}
              ${c.dataError?`<div style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.8); z-index: 10;">
                      <div style="text-align: center; max-width: 600px; padding: 20px;">
                        <div style="${$(E.mapTitle)}">Error loading data</div>
                        <div style="${$(E.mapSubtitle)}">${c.dataError}</div>
                        ${c.apiAvailable===!1?`<div style="${$(tt(E.mapSubtitle,{marginTop:12,fontSize:12}))}">
                                Make sure the Python API server is running. Check the terminal for connection details.
                              </div>`:""}
                      </div>
                    </div>`:""}
              ${!c.isLoading&&!c.dataError&&!c.currentData?`<div style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.5); z-index: 5;">
                      <div style="text-align: center;">
                        <div style="${$(E.mapTitle)}">No data loaded</div>
                        <div style="${$(E.mapSubtitle)}">
                          Adjust parameters to load climate data
                        </div>
                      </div>
                    </div>`:""}
            `:`<div style="text-align: center;">
                <div style="${$(E.mapTitle)}">Chart placeholder</div>
                <div style="${$(E.mapSubtitle)}">Chart view coming soon. Visualizations will render here.</div>
              </div>`}
      </div>

      <aside data-role="sidebar" class="sidebar" style="width: ${rt}px; transform: ${c.sidebarOpen?"translateX(0)":`translateX(${rt+24}px)`}; pointer-events: ${c.sidebarOpen?"auto":"none"}" aria-hidden="${!c.sidebarOpen}">
        <div class="sidebar-top">
          <div class="sidebar-brand">
            <div class="logo-dot"></div>
          </div>
          <div class="tab-switch" style="${$(E.tabSwitch)}">
            ${["Manual","Chat"].map(a=>Wl(a,c.panelTab===a?E.tabBtnActive:void 0,"panel-tab")).join("")}
          </div>
        </div>

        <div class="sidebar-content">
          <div class="tab-viewport">
            <div data-role="tab-track" class="tab-track" style="transform: ${i}">
              <div class="tab-pane">
                ${Ul({modeTransform:e,resolutionFill:t,modeIndicatorTransform:n})}
              </div>
              <div class="tab-pane">
                ${Yl()}
              </div>
            </div>
          </div>
        </div>
      </aside>

      <div data-role="canvas-toggle" style="${$({...E.canvasToggle,right:c.sidebarOpen?rt+24:24})}">
        <div style="${$(E.canvasSwitch)}">
          <div data-role="canvas-indicator" style="${$({...E.canvasIndicator,transform:r})}"></div>
          <button
            type="button"
            aria-label="Show map canvas"
            data-action="set-canvas"
            data-value="map"
            style="${$(tt(E.canvasBtn,c.canvasView==="map"?E.canvasBtnActive:void 0))}"
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.6">
              <path d="M4 6.5 9 4l6 2.5L20 4v14l-5 2.5L9 18 4 20.5V6.5Z" />
              <path d="m9 4v14m6-11.5v14" />
            </svg>
          </button>
          <button
            type="button"
            aria-label="Show chart canvas"
            data-action="set-canvas"
            data-value="chart"
            style="${$(tt(E.canvasBtn,c.canvasView==="chart"?E.canvasBtnActive:void 0))}"
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.8">
              <path d="M4 18h16" />
              <path d="M6 18 11 9l4 5 3-6" />
              <circle cx="6" cy="18" r="1.2" />
              <circle cx="11" cy="9" r="1.2" />
              <circle cx="15" cy="14" r="1.2" />
              <circle cx="18" cy="8" r="1.2" />
            </svg>
          </button>
        </div>
      </div>

      ${Fl(c)}

      ${gi(c.sidebarOpen)}

      ${c.canvasView==="map"?Rl({date:c.date,timeRange:c.timeRange,sidebarOpen:c.sidebarOpen,sidebarWidth:rt,mode:c.mode,compareMode:c.compareMode,compareDateStart:c.compareDateStart,compareDateEnd:c.compareDateEnd}):""}
    </div>
  `,Gl(),Mt=J.querySelector("#map-canvas"),Mt&&c.currentData&&!c.dataError&&c.dataMin!==null&&c.dataMax!==null){const a=c.metaData?.variable_metadata[c.variable]?.unit||"";Rn(Mt,c.currentData,a,c.variable,c.selectedUnit),wn(c.currentData,Mt,Q,c.palette,c.dataMin,c.dataMax,c.variable,c.selectedUnit);const o=Q.find(l=>l.name===c.palette)||Q[0];en("legend-gradient-canvas",o.colors)}}function Hl(){if(!c.isLoading)return"";const t=Math.max(0,Math.min(100,Math.round(c.loadingProgress)));return`
      <div style="${$(E.loadingIndicator)}">
        <div style="${$(E.loadingSpinner)}"></div>
        <div style="${$(E.loadingTextGroup)}">
          <div style="${$(E.loadingText)}">Loading data · ${t}%</div>
          <div style="${$(E.loadingBar)}">
            <div style="${$({...E.loadingBarFill,width:`${t}%`})}"></div>
          </div>
          <div style="${$(E.loadingSubtext)}">Fetching climate tiles</div>
        </div>
      </div>
    `}function F(t,e){return`
    <div style="${$(E.field)}">
      ${t?`<div style="${$(E.fieldLabel)}">${t}</div>`:""}
      ${e}
    </div>
  `}function Gt(t,e,n){const r=n?.type??"date",i=n?.dataKey??t,a=n?.min?`min="${n.min}"`:"",o=n?.max?`max="${n.max}"`:"";return`
    <input
      type="${r}"
      value="${e}"
      data-action="update-input"
      data-key="${i}"
      ${a}
      ${o}
    />
  `}function H(t,e,n,r){const i=r?.dataKey??t,a=r?.disabled?"disabled":"";return`
    <select data-action="update-select" data-key="${i}" ${a}>
      ${e.map(o=>`
            <option value="${o}" ${o===n?"selected":""}>
              ${o}
            </option>
          `).join("")}
    </select>
  `}function Wl(t,e,n="panel-tab"){return`
    <button
      type="button"
      data-action="set-tab"
      data-key="${n}"
      data-value="${t}"
      style="${$(tt(E.tabBtn,e))}"
    >
      ${t}
    </button>
  `}function Ul(t){const{modeTransform:e,resolutionFill:n,modeIndicatorTransform:r}=t,i=c.compareMode==="Models"?[F("Scenario",H("scenario",De,c.scenario)),F("Date",Gt("date",c.date))]:c.compareMode==="Dates"?[F("Scenario",H("scenario",De,c.scenario)),F("Model",H("model",yt,c.model))]:[F("Model",H("model",yt,c.model)),F("Date",Gt("date",c.date))];return`
    <div style="${$(E.modeSwitch)}">
      <div data-role="mode-indicator" style="${$({...E.modeIndicator,transform:r})}"></div>
      ${["Explore","Compare"].map(a=>`
            <button
              type="button"
              class="mode-btn"
              data-action="set-mode"
              data-value="${a}"
              style="${$(tt(E.modeBtn,c.mode===a?E.modeBtnActive:void 0))}"
            >
              ${a}
            </button>
          `).join("")}
    </div>

    <div style="${$(E.modeViewport)}">
      <div data-role="mode-track" style="${$({...E.modeTrack,transform:e})}">
        <div class="mode-pane-scrollable" style="${$(E.modePane)}">
          <div style="${$({display:"flex",flexDirection:"column",gap:8})}">
            <div style="${$(E.sectionTitle)}">Parameters</div>
            <div style="${$(E.paramGrid)}">
              ${F("Scenario",H("scenario",De,c.scenario))}
              ${F("Model",H("model",yt,c.model))}
              ${F("Date",(()=>{const a=Ue(c.scenario);return Gt("date",c.date,{min:a.start,max:a.end})})())}
              ${F("Variable",H("variable",qe,c.variable))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${$({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${$(E.sectionTitle)}">Unit</div>
              ${F("",H("unit",qt(c.variable).map(a=>a.label),c.selectedUnit,{dataKey:"unit"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${$({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${$(E.sectionTitle)}">Color palette</div>
              ${F("",H("palette",Q.map(a=>a.name),c.palette,{dataKey:"palette"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${$({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${$(E.sectionTitle)}">Resolution</div>
              <div style="${$(E.resolutionRow)}">
                <input
                  type="range"
                  min="1"
                  max="3"
                  step="1"
                  value="${c.resolution}"
                  data-action="set-resolution"
                  class="resolution-slider"
                  style="${$(tt(E.range,{"--slider-fill":`${n}%`}))}"
                />
                <div data-role="resolution-value" style="${$(E.resolutionValue)}">${c.resolution===1?"Low":c.resolution===2?"Medium":"High"}</div>
              </div>
            </div>
          </div>
        </div>

        <div class="mode-pane-scrollable" style="${$(E.modePane)}">
          <div style="${$({display:"flex",flexDirection:"column",gap:14})}">
            <div style="${$({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${$(E.sectionTitle)}">Compare</div>
              <div style="${$(E.paramGrid)}">
                ${F("What do you want to compare?",H("compareMode",["Scenarios","Models","Dates"],c.compareMode,{dataKey:"compareMode"}))}
              </div>

              ${c.compareMode==="Scenarios"?`
                      <div style="${$(E.paramGrid)}">
                        ${F("Scenario A",H("compareScenarioA",["SSP245"],"SSP245",{disabled:!0}))}
                        ${F("Scenario B",H("compareScenarioB",["SSP585"],"SSP585",{disabled:!0}))}
                      </div>
                    `:""}

              ${c.compareMode==="Models"?`
                      <div style="${$(E.paramGrid)}">
                        ${F("Model A",H("compareModelA",yt,c.compareModelA,{dataKey:"compareModelA"}))}
                        ${F("Model B",H("compareModelB",yt,c.compareModelB,{dataKey:"compareModelB"}))}
                      </div>
                    `:""}

              ${c.compareMode==="Dates"?`
                      <div style="${$(E.paramGrid)}">
                        ${F("Start date",Gt("compareDateStart",c.compareDateStart,{dataKey:"compareDateStart"}))}
                        ${F("End date",Gt("compareDateEnd",c.compareDateEnd,{dataKey:"compareDateEnd"}))}
  </div>
`:""}

              <div style="${$(E.paramGrid)}">
                ${i.join("")}
                ${F("Variable",H("variable",qe,c.variable))}
              </div>

              <div style="margin-top:14px">
                <div style="${$({display:"flex",flexDirection:"column",gap:8})}">
                  <div style="${$(E.sectionTitle)}">Unit</div>
                  ${F("",H("unit",qt(c.variable).map(a=>a.label),c.selectedUnit,{dataKey:"unit"}))}
                </div>
              </div>

              <div style="margin-top:14px">
                <div style="${$({display:"flex",flexDirection:"column",gap:8})}">
                  <div style="${$(E.sectionTitle)}">Color palette</div>
                  ${F("",H("palette",Q.map(a=>a.name),c.palette,{dataKey:"palette"}))}
                </div>
              </div>

              <div style="margin-top:14px">
                <div style="${$({display:"flex",flexDirection:"column",gap:8})}">
                  <div style="${$(E.sectionTitle)}">Resolution</div>
                  <div style="${$(E.resolutionRow)}">
                    <input
                      type="range"
                      min="1"
                      max="3"
                      step="1"
                      value="${c.resolution}"
                      data-action="set-resolution"
                      class="resolution-slider"
                      style="${$(tt(E.range,{"--slider-fill":`${n}%`}))}"
                    />
                    <div data-role="resolution-value" style="${$(E.resolutionValue)}">${c.resolution===1?"Low":c.resolution===2?"Medium":"High"}</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  `}function Yl(){return`
    <div style="${$({display:"flex",flexDirection:"column",gap:8})}">
      <div style="${$(E.sectionTitle)}">Chat</div>
      <div style="${$(E.chatStack)}">
        <div style="${$(E.chatLead)}">Discuss the data with an agent, or ask questions.</div>

        <div style="${$(E.chatMessages)}">
          ${c.chatMessages.map(t=>{const e=t.sender==="user"?tt(E.chatBubble,E.chatBubbleUser):tt(E.chatBubble,E.chatBubbleAgent);return`<div style="${$(e)}">${t.text}</div>`}).join("")}
        </div>

        <div style="${$(E.chatBox)}">
          <input
            type="text"
            value="${c.chatInput}"
            data-action="chat-input"
            style="${$(E.chatInput)}"
            placeholder="Ask a question"
          />
          <button type="button" data-action="chat-send" aria-label="Send chat message" style="${$(E.chatSend)}">
            ➤
          </button>
        </div>
      </div>
    </div>
  `}function Gl(t){if(!J)return;const e=J;pi({root:e,getSidebarOpen:()=>c.sidebarOpen,setSidebarOpen:g=>{c.sidebarOpen=g},onTimeSliderUpdate:g=>{kl(g,rt)}}),e.querySelectorAll('[data-action="set-canvas"]').forEach(g=>g.addEventListener("click",()=>{const y=g.dataset.value;if(y){if(y===c.canvasView)return;const b=c.canvasView==="map"?"translateX(0%)":"translateX(100%)",v=y==="map"?"translateX(0%)":"translateX(100%)";c.canvasView=y,U(),y==="map"&&St();const x=e.querySelector('[data-role="canvas-indicator"]');if(!x)return;x.style.removeProperty("transition"),x.style.transform=b,x.offsetHeight,x.getBoundingClientRect(),requestAnimationFrame(()=>{x.style.transition="transform 180ms ease",x.style.transform=v})}})),e.querySelectorAll('[data-action="set-mode"]').forEach(g=>g.addEventListener("click",()=>{const y=g.dataset.value;if(y){if(y===c.mode)return;const m=c.mode,b=m==="Explore"?"translateX(0%)":"translateX(-50%)",v=m==="Explore"?"translateX(0%)":"translateX(100%)",x=y==="Explore"?"translateX(0%)":"translateX(-50%)",S=y==="Explore"?"translateX(0%)":"translateX(100%)";c.mode=y,U();const _=e.querySelector('[data-role="mode-track"]'),M=e.querySelector('[data-role="mode-indicator"]');if(!_||!M)return;_.style.transition="none",M.style.transition="none",_.style.transform=b,M.style.transform=v,_.offsetHeight,_.style.transition="transform 220ms ease",M.style.transition="transform 200ms ease",_.style.transform=x,M.style.transform=S}c.canvasView==="map"&&St()})),e.querySelectorAll('[data-action="set-tab"]').forEach(g=>g.addEventListener("click",()=>{const y=g.dataset.value;if(y){if(y===c.panelTab)return;const b=c.panelTab==="Manual"?"translateX(0%)":"translateX(-50%)",v=y==="Manual"?"translateX(0%)":"translateX(-50%)";c.panelTab=y,U();const x=e.querySelector('[data-role="tab-track"]');if(!x)return;x.style.removeProperty("transition"),x.style.transform=b,x.offsetHeight,x.getBoundingClientRect(),requestAnimationFrame(()=>{x.style.transition="transform 220ms ease",x.style.transform=v})}})),e.querySelectorAll('[data-action="update-select"]').forEach(g=>g.addEventListener("change",async()=>{const y=g.dataset.key,m=g.value;if(y){switch(y){case"scenario":c.scenario=m,c.date=Ol(m),c.timeRange=Ue(m);break;case"model":c.model=m;break;case"variable":c.variable=m,c.selectedUnit=Sr(m).label;break;case"unit":if(c.selectedUnit=m,U(),c.currentData&&J&&c.dataMin!==null&&c.dataMax!==null){const b=J.querySelector("#map-canvas");if(b){Mt=b;const v=c.metaData?.variable_metadata[c.variable]?.unit||"";Rn(b,c.currentData,v,c.variable,c.selectedUnit),wn(c.currentData,Mt,Q,c.palette,c.dataMin,c.dataMax,c.variable,c.selectedUnit);const x=Q.find(S=>S.name===c.palette)||Q[0];en("legend-gradient-canvas",x.colors)}}return;case"palette":if(c.palette=m,U(),c.currentData&&J&&c.dataMin!==null&&c.dataMax!==null){const b=J.querySelector("#map-canvas");if(b){Mt=b,wn(c.currentData,Mt,Q,c.palette,c.dataMin,c.dataMax,c.variable,c.selectedUnit);const v=Q.find(x=>x.name===c.palette)||Q[0];en("legend-gradient-canvas",v.colors)}}return;case"compareMode":c.compareMode=m;break;case"compareModelA":c.compareModelA=m;break;case"compareModelB":c.compareModelB=m;break}U(),St()}})),e.querySelectorAll('[data-action="update-input"]').forEach(g=>{const y=()=>{const m=g.dataset.key;if(!m)return;const b=g.value;if(!(/^\d{4}-\d{2}-\d{2}$/.test(b)&&!isNaN(new Date(b).getTime()))){g.style.borderColor="rgba(239, 68, 68, 0.6)";return}g.style.borderColor="";let _=b;if(m==="date"&&(_=Xt(b,c.scenario),_!==b&&(g.value=_)),(m==="date"?c.date:m==="compareDateStart"?c.compareDateStart:c.compareDateEnd)!==_){switch(m){case"date":c.date=_;break;case"compareDateStart":c.compareDateStart=b;break;case"compareDateEnd":c.compareDateEnd=b;break}U(),(m==="date"||c.mode==="Compare"&&(m==="compareDateStart"||m==="compareDateEnd"))&&St()}};g.addEventListener("blur",y),g.addEventListener("keydown",m=>{m.key==="Enter"&&(m.preventDefault(),y(),g.blur())})});const l=e.querySelectorAll('[data-action="set-resolution"]'),u=e.querySelectorAll('[data-role="resolution-value"]'),f=g=>{const y=(g-1)/2*100,m=g===1?"Low":g===2?"Medium":"High";l.forEach(b=>{b.value=String(g),b.style.setProperty("--slider-fill",`${y}%`)}),u.forEach(b=>{b.textContent=m})};l.forEach(g=>g.addEventListener("input",()=>{const y=Number.parseInt(g.value,10);Number.isNaN(y)||(c.resolution=y,f(y),St())})),e.querySelector('[data-action="open-compare-info"]')?.addEventListener("click",()=>{c.compareInfoOpen=!0,U()}),e.querySelectorAll('[data-action="close-compare-info"]').forEach(g=>g.addEventListener("click",()=>{c.compareInfoOpen=!1,U()})),Nl({root:e,getTimeRange:()=>c.timeRange,onDateChange:g=>{c.date=g,St()},getMode:()=>c.mode,getCompareMode:()=>c.compareMode,getCompareDates:()=>({start:c.compareDateStart,end:c.compareDateEnd}),onDateRangeChange:(g,y)=>{c.compareDateStart=g,c.compareDateEnd=y,St()}});const h=e.querySelector('[data-action="chat-input"]'),p=e.querySelector('[data-action="chat-send"]');h?.addEventListener("input",()=>{c.chatInput=h.value}),h?.addEventListener("keydown",g=>{g.key==="Enter"&&(g.preventDefault(),xr())}),p?.addEventListener("click",xr)}function xr(){const t=c.chatInput.trim();if(!t)return;const e={id:Date.now(),sender:"user",text:t};c.chatMessages=[...c.chatMessages,e],c.chatInput="",tn&&window.clearTimeout(tn),tn=window.setTimeout(()=>{const n={id:Date.now()+1,sender:"agent",text:"I don't work yet."};c.chatMessages=[...c.chatMessages,n],U()},1e3),U()}async function wr(){if(J=document.querySelector("#app"),!J)throw new Error("Root element #app not found");U(),Xl().then(()=>{U()}),c.canvasView==="map"&&c.mode==="Explore"&&St()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",wr):wr();
