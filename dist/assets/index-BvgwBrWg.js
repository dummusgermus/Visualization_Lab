(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}})();function on(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Ao(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function cr(t){let e,n,r;t.length!==2?(e=on,n=(c,l)=>on(t(c),l),r=(c,l)=>t(c)-l):(e=t===on||t===Ao?t:Ro,n=t,r=t);function a(c,l,u=0,d=c.length){if(u<d){if(e(l,l)!==0)return d;do{const f=u+d>>>1;n(c[f],l)<0?u=f+1:d=f}while(u<d)}return u}function i(c,l,u=0,d=c.length){if(u<d){if(e(l,l)!==0)return d;do{const f=u+d>>>1;n(c[f],l)<=0?u=f+1:d=f}while(u<d)}return u}function s(c,l,u=0,d=c.length){const f=a(c,l,u,d-1);return f>u&&r(c[f-1],l)>-r(c[f],l)?f-1:f}return{left:a,center:s,right:i}}function Ro(){return 0}function _a(t){return t===null?NaN:+t}const No=cr(on),Io=No.right;cr(_a).center;const Po=Math.sqrt(50),Fo=Math.sqrt(10),Uo=Math.sqrt(2);function fn(t,e,n){const r=(e-t)/Math.max(0,n),a=Math.floor(Math.log10(r)),i=r/Math.pow(10,a),s=i>=Po?10:i>=Fo?5:i>=Uo?2:1;let c,l,u;return a<0?(u=Math.pow(10,-a)/s,c=Math.round(t*u),l=Math.round(e*u),c/u<t&&++c,l/u>e&&--l,u=-u):(u=Math.pow(10,a)*s,c=Math.round(t/u),l=Math.round(e/u),c*u<t&&++c,l*u>e&&--l),l<c&&.5<=n&&n<2?fn(t,e,n*2):[c,l,u]}function Bo(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const r=e<t,[a,i,s]=r?fn(e,t,n):fn(t,e,n);if(!(i>=a))return[];const c=i-a+1,l=new Array(c);if(r)if(s<0)for(let u=0;u<c;++u)l[u]=(i-u)/-s;else for(let u=0;u<c;++u)l[u]=(i-u)*s;else if(s<0)for(let u=0;u<c;++u)l[u]=(a+u)/-s;else for(let u=0;u<c;++u)l[u]=(a+u)*s;return l}function Hn(t,e,n){return e=+e,t=+t,n=+n,fn(t,e,n)[2]}function Wn(t,e,n){e=+e,t=+t,n=+n;const r=e<t,a=r?Hn(e,t,n):Hn(t,e,n);return(r?-1:1)*(a<0?1/-a:a)}function Oo(t,e){let n;for(const r of t)r!=null&&(n<r||n===void 0&&r>=r)&&(n=r);return n}function zo(t,e){let n;for(const r of t)r!=null&&(n>r||n===void 0&&r>=r)&&(n=r);return n}function Rn(t,e,n=_a){if(!(!(r=t.length)||isNaN(e=+e))){if(e<=0||r<2)return+n(t[0],0,t);if(e>=1)return+n(t[r-1],r-1,t);var r,a=(r-1)*e,i=Math.floor(a),s=+n(t[i],i,t),c=+n(t[i+1],i+1,t);return s+(c-s)*(a-i)}}function Vo(t,e){let n=0,r=0;for(let a of t)a!=null&&(a=+a)>=a&&(++n,r+=a);if(n)return r/n}var qo={value:()=>{}};function lr(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new sn(n)}function sn(t){this._=t}function Ho(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",a=n.indexOf(".");if(a>=0&&(r=n.slice(a+1),n=n.slice(0,a)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}sn.prototype=lr.prototype={constructor:sn,on:function(t,e){var n=this._,r=Ho(t+"",n),a,i=-1,s=r.length;if(arguments.length<2){for(;++i<s;)if((a=(t=r[i]).type)&&(a=Wo(n[a],t.name)))return a;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++i<s;)if(a=(t=r[i]).type)n[a]=Ar(n[a],t.name,e);else if(e==null)for(a in n)n[a]=Ar(n[a],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new sn(t)},call:function(t,e){if((a=arguments.length-2)>0)for(var n=new Array(a),r=0,a,i;r<a;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(i=this._[t],r=0,a=i.length;r<a;++r)i[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],a=0,i=r.length;a<i;++a)r[a].value.apply(e,n)}};function Wo(t,e){for(var n=0,r=t.length,a;n<r;++n)if((a=t[n]).name===e)return a.value}function Ar(t,e,n){for(var r=0,a=t.length;r<a;++r)if(t[r].name===e){t[r]=qo,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var Yn="http://www.w3.org/1999/xhtml";const Rr={svg:"http://www.w3.org/2000/svg",xhtml:Yn,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function kn(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),Rr.hasOwnProperty(e)?{space:Rr[e],local:t}:t}function Yo(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===Yn&&e.documentElement.namespaceURI===Yn?e.createElement(t):e.createElementNS(n,t)}}function Xo(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function ka(t){var e=kn(t);return(e.local?Xo:Yo)(e)}function Go(){}function ur(t){return t==null?Go:function(){return this.querySelector(t)}}function Ko(t){typeof t!="function"&&(t=ur(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var i=e[a],s=i.length,c=r[a]=new Array(s),l,u,d=0;d<s;++d)(l=i[d])&&(u=t.call(l,l.__data__,d,i))&&("__data__"in l&&(u.__data__=l.__data__),c[d]=u);return new vt(r,this._parents)}function jo(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function Qo(){return[]}function La(t){return t==null?Qo:function(){return this.querySelectorAll(t)}}function Zo(t){return function(){return jo(t.apply(this,arguments))}}function Jo(t){typeof t=="function"?t=Zo(t):t=La(t);for(var e=this._groups,n=e.length,r=[],a=[],i=0;i<n;++i)for(var s=e[i],c=s.length,l,u=0;u<c;++u)(l=s[u])&&(r.push(t.call(l,l.__data__,u,s)),a.push(l));return new vt(r,a)}function Ca(t){return function(){return this.matches(t)}}function Ea(t){return function(e){return e.matches(t)}}var ti=Array.prototype.find;function ei(t){return function(){return ti.call(this.children,t)}}function ni(){return this.firstElementChild}function ri(t){return this.select(t==null?ni:ei(typeof t=="function"?t:Ea(t)))}var ai=Array.prototype.filter;function oi(){return Array.from(this.children)}function ii(t){return function(){return ai.call(this.children,t)}}function si(t){return this.selectAll(t==null?oi:ii(typeof t=="function"?t:Ea(t)))}function ci(t){typeof t!="function"&&(t=Ca(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var i=e[a],s=i.length,c=r[a]=[],l,u=0;u<s;++u)(l=i[u])&&t.call(l,l.__data__,u,i)&&c.push(l);return new vt(r,this._parents)}function Aa(t){return new Array(t.length)}function li(){return new vt(this._enter||this._groups.map(Aa),this._parents)}function hn(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}hn.prototype={constructor:hn,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function ui(t){return function(){return t}}function di(t,e,n,r,a,i){for(var s=0,c,l=e.length,u=i.length;s<u;++s)(c=e[s])?(c.__data__=i[s],r[s]=c):n[s]=new hn(t,i[s]);for(;s<l;++s)(c=e[s])&&(a[s]=c)}function fi(t,e,n,r,a,i,s){var c,l,u=new Map,d=e.length,f=i.length,m=new Array(d),p;for(c=0;c<d;++c)(l=e[c])&&(m[c]=p=s.call(l,l.__data__,c,e)+"",u.has(p)?a[c]=l:u.set(p,l));for(c=0;c<f;++c)p=s.call(t,i[c],c,i)+"",(l=u.get(p))?(r[c]=l,l.__data__=i[c],u.delete(p)):n[c]=new hn(t,i[c]);for(c=0;c<d;++c)(l=e[c])&&u.get(m[c])===l&&(a[c]=l)}function hi(t){return t.__data__}function mi(t,e){if(!arguments.length)return Array.from(this,hi);var n=e?fi:di,r=this._parents,a=this._groups;typeof t!="function"&&(t=ui(t));for(var i=a.length,s=new Array(i),c=new Array(i),l=new Array(i),u=0;u<i;++u){var d=r[u],f=a[u],m=f.length,p=pi(t.call(d,d&&d.__data__,u,r)),$=p.length,A=c[u]=new Array($),L=s[u]=new Array($),M=l[u]=new Array(m);n(d,f,A,L,M,p,e);for(var v=0,D=0,_,C;v<$;++v)if(_=A[v]){for(v>=D&&(D=v+1);!(C=L[D])&&++D<$;);_._next=C||null}}return s=new vt(s,r),s._enter=c,s._exit=l,s}function pi(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function gi(){return new vt(this._exit||this._groups.map(Aa),this._parents)}function yi(t,e,n){var r=this.enter(),a=this,i=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(a=e(a),a&&(a=a.selection())),n==null?i.remove():n(i),r&&a?r.merge(a).order():a}function vi(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,a=n.length,i=r.length,s=Math.min(a,i),c=new Array(a),l=0;l<s;++l)for(var u=n[l],d=r[l],f=u.length,m=c[l]=new Array(f),p,$=0;$<f;++$)(p=u[$]||d[$])&&(m[$]=p);for(;l<a;++l)c[l]=n[l];return new vt(c,this._parents)}function xi(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],a=r.length-1,i=r[a],s;--a>=0;)(s=r[a])&&(i&&s.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(s,i),i=s);return this}function bi(t){t||(t=wi);function e(f,m){return f&&m?t(f.__data__,m.__data__):!f-!m}for(var n=this._groups,r=n.length,a=new Array(r),i=0;i<r;++i){for(var s=n[i],c=s.length,l=a[i]=new Array(c),u,d=0;d<c;++d)(u=s[d])&&(l[d]=u);l.sort(e)}return new vt(a,this._parents).order()}function wi(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Si(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function Mi(){return Array.from(this)}function $i(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],a=0,i=r.length;a<i;++a){var s=r[a];if(s)return s}return null}function Ti(){let t=0;for(const e of this)++t;return t}function Di(){return!this.node()}function _i(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var a=e[n],i=0,s=a.length,c;i<s;++i)(c=a[i])&&t.call(c,c.__data__,i,a);return this}function ki(t){return function(){this.removeAttribute(t)}}function Li(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Ci(t,e){return function(){this.setAttribute(t,e)}}function Ei(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Ai(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function Ri(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function Ni(t,e){var n=kn(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?Li:ki:typeof e=="function"?n.local?Ri:Ai:n.local?Ei:Ci)(n,e))}function Ra(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Ii(t){return function(){this.style.removeProperty(t)}}function Pi(t,e,n){return function(){this.style.setProperty(t,e,n)}}function Fi(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function Ui(t,e,n){return arguments.length>1?this.each((e==null?Ii:typeof e=="function"?Fi:Pi)(t,e,n??"")):we(this.node(),t)}function we(t,e){return t.style.getPropertyValue(e)||Ra(t).getComputedStyle(t,null).getPropertyValue(e)}function Bi(t){return function(){delete this[t]}}function Oi(t,e){return function(){this[t]=e}}function zi(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function Vi(t,e){return arguments.length>1?this.each((e==null?Bi:typeof e=="function"?zi:Oi)(t,e)):this.node()[t]}function Na(t){return t.trim().split(/^|\s+/)}function dr(t){return t.classList||new Ia(t)}function Ia(t){this._node=t,this._names=Na(t.getAttribute("class")||"")}Ia.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function Pa(t,e){for(var n=dr(t),r=-1,a=e.length;++r<a;)n.add(e[r])}function Fa(t,e){for(var n=dr(t),r=-1,a=e.length;++r<a;)n.remove(e[r])}function qi(t){return function(){Pa(this,t)}}function Hi(t){return function(){Fa(this,t)}}function Wi(t,e){return function(){(e.apply(this,arguments)?Pa:Fa)(this,t)}}function Yi(t,e){var n=Na(t+"");if(arguments.length<2){for(var r=dr(this.node()),a=-1,i=n.length;++a<i;)if(!r.contains(n[a]))return!1;return!0}return this.each((typeof e=="function"?Wi:e?qi:Hi)(n,e))}function Xi(){this.textContent=""}function Gi(t){return function(){this.textContent=t}}function Ki(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function ji(t){return arguments.length?this.each(t==null?Xi:(typeof t=="function"?Ki:Gi)(t)):this.node().textContent}function Qi(){this.innerHTML=""}function Zi(t){return function(){this.innerHTML=t}}function Ji(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function ts(t){return arguments.length?this.each(t==null?Qi:(typeof t=="function"?Ji:Zi)(t)):this.node().innerHTML}function es(){this.nextSibling&&this.parentNode.appendChild(this)}function ns(){return this.each(es)}function rs(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function as(){return this.each(rs)}function os(t){var e=typeof t=="function"?t:ka(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function is(){return null}function ss(t,e){var n=typeof t=="function"?t:ka(t),r=e==null?is:typeof e=="function"?e:ur(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function cs(){var t=this.parentNode;t&&t.removeChild(this)}function ls(){return this.each(cs)}function us(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function ds(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function fs(t){return this.select(t?ds:us)}function hs(t){return arguments.length?this.property("__data__",t):this.node().__data__}function ms(t){return function(e){t.call(this,e,this.__data__)}}function ps(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function gs(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,a=e.length,i;n<a;++n)i=e[n],(!t.type||i.type===t.type)&&i.name===t.name?this.removeEventListener(i.type,i.listener,i.options):e[++r]=i;++r?e.length=r:delete this.__on}}}function ys(t,e,n){return function(){var r=this.__on,a,i=ms(e);if(r){for(var s=0,c=r.length;s<c;++s)if((a=r[s]).type===t.type&&a.name===t.name){this.removeEventListener(a.type,a.listener,a.options),this.addEventListener(a.type,a.listener=i,a.options=n),a.value=e;return}}this.addEventListener(t.type,i,n),a={type:t.type,name:t.name,value:e,listener:i,options:n},r?r.push(a):this.__on=[a]}}function vs(t,e,n){var r=ps(t+""),a,i=r.length,s;if(arguments.length<2){var c=this.node().__on;if(c){for(var l=0,u=c.length,d;l<u;++l)for(a=0,d=c[l];a<i;++a)if((s=r[a]).type===d.type&&s.name===d.name)return d.value}return}for(c=e?ys:gs,a=0;a<i;++a)this.each(c(r[a],e,n));return this}function Ua(t,e,n){var r=Ra(t),a=r.CustomEvent;typeof a=="function"?a=new a(e,n):(a=r.document.createEvent("Event"),n?(a.initEvent(e,n.bubbles,n.cancelable),a.detail=n.detail):a.initEvent(e,!1,!1)),t.dispatchEvent(a)}function xs(t,e){return function(){return Ua(this,t,e)}}function bs(t,e){return function(){return Ua(this,t,e.apply(this,arguments))}}function ws(t,e){return this.each((typeof e=="function"?bs:xs)(t,e))}function*Ss(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],a=0,i=r.length,s;a<i;++a)(s=r[a])&&(yield s)}var Ba=[null];function vt(t,e){this._groups=t,this._parents=e}function He(){return new vt([[document.documentElement]],Ba)}function Ms(){return this}vt.prototype=He.prototype={constructor:vt,select:Ko,selectAll:Jo,selectChild:ri,selectChildren:si,filter:ci,data:mi,enter:li,exit:gi,join:yi,merge:vi,selection:Ms,order:xi,sort:bi,call:Si,nodes:Mi,node:$i,size:Ti,empty:Di,each:_i,attr:Ni,style:Ui,property:Vi,classed:Yi,text:ji,html:ts,raise:ns,lower:as,append:os,insert:ss,remove:ls,clone:fs,datum:hs,on:vs,dispatch:ws,[Symbol.iterator]:Ss};function qt(t){return typeof t=="string"?new vt([[document.querySelector(t)]],[document.documentElement]):new vt([[t]],Ba)}function $s(t){let e;for(;e=t.sourceEvent;)t=e;return t}function Vt(t,e){if(t=$s(t),e===void 0&&(e=t.currentTarget),e){var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}if(e.getBoundingClientRect){var a=e.getBoundingClientRect();return[t.clientX-a.left-e.clientLeft,t.clientY-a.top-e.clientTop]}}return[t.pageX,t.pageY]}const Xn={capture:!0,passive:!1};function Gn(t){t.preventDefault(),t.stopImmediatePropagation()}function Ts(t){var e=t.document.documentElement,n=qt(t).on("dragstart.drag",Gn,Xn);"onselectstart"in e?n.on("selectstart.drag",Gn,Xn):(e.__noselect=e.style.MozUserSelect,e.style.MozUserSelect="none")}function Ds(t,e){var n=t.document.documentElement,r=qt(t).on("dragstart.drag",null);e&&(r.on("click.drag",Gn,Xn),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}function fr(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Oa(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function We(){}var Ue=.7,mn=1/Ue,ve="\\s*([+-]?\\d+)\\s*",Be="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Dt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",_s=/^#([0-9a-f]{3,8})$/,ks=new RegExp(`^rgb\\(${ve},${ve},${ve}\\)$`),Ls=new RegExp(`^rgb\\(${Dt},${Dt},${Dt}\\)$`),Cs=new RegExp(`^rgba\\(${ve},${ve},${ve},${Be}\\)$`),Es=new RegExp(`^rgba\\(${Dt},${Dt},${Dt},${Be}\\)$`),As=new RegExp(`^hsl\\(${Be},${Dt},${Dt}\\)$`),Rs=new RegExp(`^hsla\\(${Be},${Dt},${Dt},${Be}\\)$`),Nr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};fr(We,ie,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Ir,formatHex:Ir,formatHex8:Ns,formatHsl:Is,formatRgb:Pr,toString:Pr});function Ir(){return this.rgb().formatHex()}function Ns(){return this.rgb().formatHex8()}function Is(){return za(this).formatHsl()}function Pr(){return this.rgb().formatRgb()}function ie(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=_s.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?Fr(e):n===3?new pt(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Qe(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Qe(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=ks.exec(t))?new pt(e[1],e[2],e[3],1):(e=Ls.exec(t))?new pt(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Cs.exec(t))?Qe(e[1],e[2],e[3],e[4]):(e=Es.exec(t))?Qe(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=As.exec(t))?Or(e[1],e[2]/100,e[3]/100,1):(e=Rs.exec(t))?Or(e[1],e[2]/100,e[3]/100,e[4]):Nr.hasOwnProperty(t)?Fr(Nr[t]):t==="transparent"?new pt(NaN,NaN,NaN,0):null}function Fr(t){return new pt(t>>16&255,t>>8&255,t&255,1)}function Qe(t,e,n,r){return r<=0&&(t=e=n=NaN),new pt(t,e,n,r)}function Ps(t){return t instanceof We||(t=ie(t)),t?(t=t.rgb(),new pt(t.r,t.g,t.b,t.opacity)):new pt}function Kn(t,e,n,r){return arguments.length===1?Ps(t):new pt(t,e,n,r??1)}function pt(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}fr(pt,Kn,Oa(We,{brighter(t){return t=t==null?mn:Math.pow(mn,t),new pt(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?Ue:Math.pow(Ue,t),new pt(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new pt(oe(this.r),oe(this.g),oe(this.b),pn(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Ur,formatHex:Ur,formatHex8:Fs,formatRgb:Br,toString:Br}));function Ur(){return`#${ne(this.r)}${ne(this.g)}${ne(this.b)}`}function Fs(){return`#${ne(this.r)}${ne(this.g)}${ne(this.b)}${ne((isNaN(this.opacity)?1:this.opacity)*255)}`}function Br(){const t=pn(this.opacity);return`${t===1?"rgb(":"rgba("}${oe(this.r)}, ${oe(this.g)}, ${oe(this.b)}${t===1?")":`, ${t})`}`}function pn(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function oe(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function ne(t){return t=oe(t),(t<16?"0":"")+t.toString(16)}function Or(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new wt(t,e,n,r)}function za(t){if(t instanceof wt)return new wt(t.h,t.s,t.l,t.opacity);if(t instanceof We||(t=ie(t)),!t)return new wt;if(t instanceof wt)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,a=Math.min(e,n,r),i=Math.max(e,n,r),s=NaN,c=i-a,l=(i+a)/2;return c?(e===i?s=(n-r)/c+(n<r)*6:n===i?s=(r-e)/c+2:s=(e-n)/c+4,c/=l<.5?i+a:2-i-a,s*=60):c=l>0&&l<1?0:s,new wt(s,c,l,t.opacity)}function Us(t,e,n,r){return arguments.length===1?za(t):new wt(t,e,n,r??1)}function wt(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}fr(wt,Us,Oa(We,{brighter(t){return t=t==null?mn:Math.pow(mn,t),new wt(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?Ue:Math.pow(Ue,t),new wt(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,a=2*n-r;return new pt(Nn(t>=240?t-240:t+120,a,r),Nn(t,a,r),Nn(t<120?t+240:t-120,a,r),this.opacity)},clamp(){return new wt(zr(this.h),Ze(this.s),Ze(this.l),pn(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=pn(this.opacity);return`${t===1?"hsl(":"hsla("}${zr(this.h)}, ${Ze(this.s)*100}%, ${Ze(this.l)*100}%${t===1?")":`, ${t})`}`}}));function zr(t){return t=(t||0)%360,t<0?t+360:t}function Ze(t){return Math.max(0,Math.min(1,t||0))}function Nn(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const hr=t=>()=>t;function Bs(t,e){return function(n){return t+n*e}}function Os(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function zs(t){return(t=+t)==1?Va:function(e,n){return n-e?Os(e,n,t):hr(isNaN(e)?n:e)}}function Va(t,e){var n=e-t;return n?Bs(t,n):hr(isNaN(t)?e:t)}const gn=(function t(e){var n=zs(e);function r(a,i){var s=n((a=Kn(a)).r,(i=Kn(i)).r),c=n(a.g,i.g),l=n(a.b,i.b),u=Va(a.opacity,i.opacity);return function(d){return a.r=s(d),a.g=c(d),a.b=l(d),a.opacity=u(d),a+""}}return r.gamma=t,r})(1);function Vs(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),a;return function(i){for(a=0;a<n;++a)r[a]=t[a]*(1-i)+e[a]*i;return r}}function qs(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Hs(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,a=new Array(r),i=new Array(n),s;for(s=0;s<r;++s)a[s]=mr(t[s],e[s]);for(;s<n;++s)i[s]=e[s];return function(c){for(s=0;s<r;++s)i[s]=a[s](c);return i}}function Ws(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function bt(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function Ys(t,e){var n={},r={},a;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(a in e)a in t?n[a]=mr(t[a],e[a]):r[a]=e[a];return function(i){for(a in n)r[a]=n[a](i);return r}}var jn=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,In=new RegExp(jn.source,"g");function Xs(t){return function(){return t}}function Gs(t){return function(e){return t(e)+""}}function qa(t,e){var n=jn.lastIndex=In.lastIndex=0,r,a,i,s=-1,c=[],l=[];for(t=t+"",e=e+"";(r=jn.exec(t))&&(a=In.exec(e));)(i=a.index)>n&&(i=e.slice(n,i),c[s]?c[s]+=i:c[++s]=i),(r=r[0])===(a=a[0])?c[s]?c[s]+=a:c[++s]=a:(c[++s]=null,l.push({i:s,x:bt(r,a)})),n=In.lastIndex;return n<e.length&&(i=e.slice(n),c[s]?c[s]+=i:c[++s]=i),c.length<2?l[0]?Gs(l[0].x):Xs(e):(e=l.length,function(u){for(var d=0,f;d<e;++d)c[(f=l[d]).i]=f.x(u);return c.join("")})}function mr(t,e){var n=typeof e,r;return e==null||n==="boolean"?hr(e):(n==="number"?bt:n==="string"?(r=ie(e))?(e=r,gn):qa:e instanceof ie?gn:e instanceof Date?Ws:qs(e)?Vs:Array.isArray(e)?Hs:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?Ys:bt)(t,e)}function Ks(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var Vr=180/Math.PI,Qn={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Ha(t,e,n,r,a,i){var s,c,l;return(s=Math.sqrt(t*t+e*e))&&(t/=s,e/=s),(l=t*n+e*r)&&(n-=t*l,r-=e*l),(c=Math.sqrt(n*n+r*r))&&(n/=c,r/=c,l/=c),t*r<e*n&&(t=-t,e=-e,l=-l,s=-s),{translateX:a,translateY:i,rotate:Math.atan2(e,t)*Vr,skewX:Math.atan(l)*Vr,scaleX:s,scaleY:c}}var Je;function js(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?Qn:Ha(e.a,e.b,e.c,e.d,e.e,e.f)}function Qs(t){return t==null||(Je||(Je=document.createElementNS("http://www.w3.org/2000/svg","g")),Je.setAttribute("transform",t),!(t=Je.transform.baseVal.consolidate()))?Qn:(t=t.matrix,Ha(t.a,t.b,t.c,t.d,t.e,t.f))}function Wa(t,e,n,r){function a(u){return u.length?u.pop()+" ":""}function i(u,d,f,m,p,$){if(u!==f||d!==m){var A=p.push("translate(",null,e,null,n);$.push({i:A-4,x:bt(u,f)},{i:A-2,x:bt(d,m)})}else(f||m)&&p.push("translate("+f+e+m+n)}function s(u,d,f,m){u!==d?(u-d>180?d+=360:d-u>180&&(u+=360),m.push({i:f.push(a(f)+"rotate(",null,r)-2,x:bt(u,d)})):d&&f.push(a(f)+"rotate("+d+r)}function c(u,d,f,m){u!==d?m.push({i:f.push(a(f)+"skewX(",null,r)-2,x:bt(u,d)}):d&&f.push(a(f)+"skewX("+d+r)}function l(u,d,f,m,p,$){if(u!==f||d!==m){var A=p.push(a(p)+"scale(",null,",",null,")");$.push({i:A-4,x:bt(u,f)},{i:A-2,x:bt(d,m)})}else(f!==1||m!==1)&&p.push(a(p)+"scale("+f+","+m+")")}return function(u,d){var f=[],m=[];return u=t(u),d=t(d),i(u.translateX,u.translateY,d.translateX,d.translateY,f,m),s(u.rotate,d.rotate,f,m),c(u.skewX,d.skewX,f,m),l(u.scaleX,u.scaleY,d.scaleX,d.scaleY,f,m),u=d=null,function(p){for(var $=-1,A=m.length,L;++$<A;)f[(L=m[$]).i]=L.x(p);return f.join("")}}}var Zs=Wa(js,"px, ","px)","deg)"),Js=Wa(Qs,", ",")",")"),tc=1e-12;function qr(t){return((t=Math.exp(t))+1/t)/2}function ec(t){return((t=Math.exp(t))-1/t)/2}function nc(t){return((t=Math.exp(2*t))-1)/(t+1)}const rc=(function t(e,n,r){function a(i,s){var c=i[0],l=i[1],u=i[2],d=s[0],f=s[1],m=s[2],p=d-c,$=f-l,A=p*p+$*$,L,M;if(A<tc)M=Math.log(m/u)/e,L=function(g){return[c+g*p,l+g*$,u*Math.exp(e*g*M)]};else{var v=Math.sqrt(A),D=(m*m-u*u+r*A)/(2*u*n*v),_=(m*m-u*u-r*A)/(2*m*n*v),C=Math.log(Math.sqrt(D*D+1)-D),w=Math.log(Math.sqrt(_*_+1)-_);M=(w-C)/e,L=function(g){var b=g*M,R=qr(C),I=u/(n*v)*(R*nc(e*b+C)-ec(C));return[c+I*p,l+I*$,u*R/qr(e*b+C)]}}return L.duration=M*1e3*e/Math.SQRT2,L}return a.rho=function(i){var s=Math.max(.001,+i),c=s*s,l=c*c;return t(s,c,l)},a})(Math.SQRT2,2,4);var Se=0,Ne=0,ke=0,Ya=1e3,yn,Ie,vn=0,se=0,Ln=0,Oe=typeof performance=="object"&&performance.now?performance:Date,Xa=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function pr(){return se||(Xa(ac),se=Oe.now()+Ln)}function ac(){se=0}function xn(){this._call=this._time=this._next=null}xn.prototype=Ga.prototype={constructor:xn,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?pr():+n)+(e==null?0:+e),!this._next&&Ie!==this&&(Ie?Ie._next=this:yn=this,Ie=this),this._call=t,this._time=n,Zn()},stop:function(){this._call&&(this._call=null,this._time=1/0,Zn())}};function Ga(t,e,n){var r=new xn;return r.restart(t,e,n),r}function oc(){pr(),++Se;for(var t=yn,e;t;)(e=se-t._time)>=0&&t._call.call(void 0,e),t=t._next;--Se}function Hr(){se=(vn=Oe.now())+Ln,Se=Ne=0;try{oc()}finally{Se=0,sc(),se=0}}function ic(){var t=Oe.now(),e=t-vn;e>Ya&&(Ln-=e,vn=t)}function sc(){for(var t,e=yn,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:yn=n);Ie=t,Zn(r)}function Zn(t){if(!Se){Ne&&(Ne=clearTimeout(Ne));var e=t-se;e>24?(t<1/0&&(Ne=setTimeout(Hr,t-Oe.now()-Ln)),ke&&(ke=clearInterval(ke))):(ke||(vn=Oe.now(),ke=setInterval(ic,Ya)),Se=1,Xa(Hr))}}function Wr(t,e,n){var r=new xn;return e=e==null?0:+e,r.restart(a=>{r.stop(),t(a+e)},e,n),r}var cc=lr("start","end","cancel","interrupt"),lc=[],Ka=0,Yr=1,Jn=2,cn=3,Xr=4,tr=5,ln=6;function Cn(t,e,n,r,a,i){var s=t.__transition;if(!s)t.__transition={};else if(n in s)return;uc(t,n,{name:e,index:r,group:a,on:cc,tween:lc,time:i.time,delay:i.delay,duration:i.duration,ease:i.ease,timer:null,state:Ka})}function gr(t,e){var n=St(t,e);if(n.state>Ka)throw new Error("too late; already scheduled");return n}function _t(t,e){var n=St(t,e);if(n.state>cn)throw new Error("too late; already running");return n}function St(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function uc(t,e,n){var r=t.__transition,a;r[e]=n,n.timer=Ga(i,0,n.time);function i(u){n.state=Yr,n.timer.restart(s,n.delay,n.time),n.delay<=u&&s(u-n.delay)}function s(u){var d,f,m,p;if(n.state!==Yr)return l();for(d in r)if(p=r[d],p.name===n.name){if(p.state===cn)return Wr(s);p.state===Xr?(p.state=ln,p.timer.stop(),p.on.call("interrupt",t,t.__data__,p.index,p.group),delete r[d]):+d<e&&(p.state=ln,p.timer.stop(),p.on.call("cancel",t,t.__data__,p.index,p.group),delete r[d])}if(Wr(function(){n.state===cn&&(n.state=Xr,n.timer.restart(c,n.delay,n.time),c(u))}),n.state=Jn,n.on.call("start",t,t.__data__,n.index,n.group),n.state===Jn){for(n.state=cn,a=new Array(m=n.tween.length),d=0,f=-1;d<m;++d)(p=n.tween[d].value.call(t,t.__data__,n.index,n.group))&&(a[++f]=p);a.length=f+1}}function c(u){for(var d=u<n.duration?n.ease.call(null,u/n.duration):(n.timer.restart(l),n.state=tr,1),f=-1,m=a.length;++f<m;)a[f].call(t,d);n.state===tr&&(n.on.call("end",t,t.__data__,n.index,n.group),l())}function l(){n.state=ln,n.timer.stop(),delete r[e];for(var u in r)return;delete t.__transition}}function un(t,e){var n=t.__transition,r,a,i=!0,s;if(n){e=e==null?null:e+"";for(s in n){if((r=n[s]).name!==e){i=!1;continue}a=r.state>Jn&&r.state<tr,r.state=ln,r.timer.stop(),r.on.call(a?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[s]}i&&delete t.__transition}}function dc(t){return this.each(function(){un(this,t)})}function fc(t,e){var n,r;return function(){var a=_t(this,t),i=a.tween;if(i!==n){r=n=i;for(var s=0,c=r.length;s<c;++s)if(r[s].name===e){r=r.slice(),r.splice(s,1);break}}a.tween=r}}function hc(t,e,n){var r,a;if(typeof n!="function")throw new Error;return function(){var i=_t(this,t),s=i.tween;if(s!==r){a=(r=s).slice();for(var c={name:e,value:n},l=0,u=a.length;l<u;++l)if(a[l].name===e){a[l]=c;break}l===u&&a.push(c)}i.tween=a}}function mc(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=St(this.node(),n).tween,a=0,i=r.length,s;a<i;++a)if((s=r[a]).name===t)return s.value;return null}return this.each((e==null?fc:hc)(n,t,e))}function yr(t,e,n){var r=t._id;return t.each(function(){var a=_t(this,r);(a.value||(a.value={}))[e]=n.apply(this,arguments)}),function(a){return St(a,r).value[e]}}function ja(t,e){var n;return(typeof e=="number"?bt:e instanceof ie?gn:(n=ie(e))?(e=n,gn):qa)(t,e)}function pc(t){return function(){this.removeAttribute(t)}}function gc(t){return function(){this.removeAttributeNS(t.space,t.local)}}function yc(t,e,n){var r,a=n+"",i;return function(){var s=this.getAttribute(t);return s===a?null:s===r?i:i=e(r=s,n)}}function vc(t,e,n){var r,a=n+"",i;return function(){var s=this.getAttributeNS(t.space,t.local);return s===a?null:s===r?i:i=e(r=s,n)}}function xc(t,e,n){var r,a,i;return function(){var s,c=n(this),l;return c==null?void this.removeAttribute(t):(s=this.getAttribute(t),l=c+"",s===l?null:s===r&&l===a?i:(a=l,i=e(r=s,c)))}}function bc(t,e,n){var r,a,i;return function(){var s,c=n(this),l;return c==null?void this.removeAttributeNS(t.space,t.local):(s=this.getAttributeNS(t.space,t.local),l=c+"",s===l?null:s===r&&l===a?i:(a=l,i=e(r=s,c)))}}function wc(t,e){var n=kn(t),r=n==="transform"?Js:ja;return this.attrTween(t,typeof e=="function"?(n.local?bc:xc)(n,r,yr(this,"attr."+t,e)):e==null?(n.local?gc:pc)(n):(n.local?vc:yc)(n,r,e))}function Sc(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function Mc(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function $c(t,e){var n,r;function a(){var i=e.apply(this,arguments);return i!==r&&(n=(r=i)&&Mc(t,i)),n}return a._value=e,a}function Tc(t,e){var n,r;function a(){var i=e.apply(this,arguments);return i!==r&&(n=(r=i)&&Sc(t,i)),n}return a._value=e,a}function Dc(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=kn(t);return this.tween(n,(r.local?$c:Tc)(r,e))}function _c(t,e){return function(){gr(this,t).delay=+e.apply(this,arguments)}}function kc(t,e){return e=+e,function(){gr(this,t).delay=e}}function Lc(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?_c:kc)(e,t)):St(this.node(),e).delay}function Cc(t,e){return function(){_t(this,t).duration=+e.apply(this,arguments)}}function Ec(t,e){return e=+e,function(){_t(this,t).duration=e}}function Ac(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Cc:Ec)(e,t)):St(this.node(),e).duration}function Rc(t,e){if(typeof e!="function")throw new Error;return function(){_t(this,t).ease=e}}function Nc(t){var e=this._id;return arguments.length?this.each(Rc(e,t)):St(this.node(),e).ease}function Ic(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;_t(this,t).ease=n}}function Pc(t){if(typeof t!="function")throw new Error;return this.each(Ic(this._id,t))}function Fc(t){typeof t!="function"&&(t=Ca(t));for(var e=this._groups,n=e.length,r=new Array(n),a=0;a<n;++a)for(var i=e[a],s=i.length,c=r[a]=[],l,u=0;u<s;++u)(l=i[u])&&t.call(l,l.__data__,u,i)&&c.push(l);return new Ut(r,this._parents,this._name,this._id)}function Uc(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,a=n.length,i=Math.min(r,a),s=new Array(r),c=0;c<i;++c)for(var l=e[c],u=n[c],d=l.length,f=s[c]=new Array(d),m,p=0;p<d;++p)(m=l[p]||u[p])&&(f[p]=m);for(;c<r;++c)s[c]=e[c];return new Ut(s,this._parents,this._name,this._id)}function Bc(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function Oc(t,e,n){var r,a,i=Bc(e)?gr:_t;return function(){var s=i(this,t),c=s.on;c!==r&&(a=(r=c).copy()).on(e,n),s.on=a}}function zc(t,e){var n=this._id;return arguments.length<2?St(this.node(),n).on.on(t):this.each(Oc(n,t,e))}function Vc(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function qc(){return this.on("end.remove",Vc(this._id))}function Hc(t){var e=this._name,n=this._id;typeof t!="function"&&(t=ur(t));for(var r=this._groups,a=r.length,i=new Array(a),s=0;s<a;++s)for(var c=r[s],l=c.length,u=i[s]=new Array(l),d,f,m=0;m<l;++m)(d=c[m])&&(f=t.call(d,d.__data__,m,c))&&("__data__"in d&&(f.__data__=d.__data__),u[m]=f,Cn(u[m],e,n,m,u,St(d,n)));return new Ut(i,this._parents,e,n)}function Wc(t){var e=this._name,n=this._id;typeof t!="function"&&(t=La(t));for(var r=this._groups,a=r.length,i=[],s=[],c=0;c<a;++c)for(var l=r[c],u=l.length,d,f=0;f<u;++f)if(d=l[f]){for(var m=t.call(d,d.__data__,f,l),p,$=St(d,n),A=0,L=m.length;A<L;++A)(p=m[A])&&Cn(p,e,n,A,m,$);i.push(m),s.push(d)}return new Ut(i,s,e,n)}var Yc=He.prototype.constructor;function Xc(){return new Yc(this._groups,this._parents)}function Gc(t,e){var n,r,a;return function(){var i=we(this,t),s=(this.style.removeProperty(t),we(this,t));return i===s?null:i===n&&s===r?a:a=e(n=i,r=s)}}function Qa(t){return function(){this.style.removeProperty(t)}}function Kc(t,e,n){var r,a=n+"",i;return function(){var s=we(this,t);return s===a?null:s===r?i:i=e(r=s,n)}}function jc(t,e,n){var r,a,i;return function(){var s=we(this,t),c=n(this),l=c+"";return c==null&&(l=c=(this.style.removeProperty(t),we(this,t))),s===l?null:s===r&&l===a?i:(a=l,i=e(r=s,c))}}function Qc(t,e){var n,r,a,i="style."+e,s="end."+i,c;return function(){var l=_t(this,t),u=l.on,d=l.value[i]==null?c||(c=Qa(e)):void 0;(u!==n||a!==d)&&(r=(n=u).copy()).on(s,a=d),l.on=r}}function Zc(t,e,n){var r=(t+="")=="transform"?Zs:ja;return e==null?this.styleTween(t,Gc(t,r)).on("end.style."+t,Qa(t)):typeof e=="function"?this.styleTween(t,jc(t,r,yr(this,"style."+t,e))).each(Qc(this._id,t)):this.styleTween(t,Kc(t,r,e),n).on("end.style."+t,null)}function Jc(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function tl(t,e,n){var r,a;function i(){var s=e.apply(this,arguments);return s!==a&&(r=(a=s)&&Jc(t,s,n)),r}return i._value=e,i}function el(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,tl(t,e,n??""))}function nl(t){return function(){this.textContent=t}}function rl(t){return function(){var e=t(this);this.textContent=e??""}}function al(t){return this.tween("text",typeof t=="function"?rl(yr(this,"text",t)):nl(t==null?"":t+""))}function ol(t){return function(e){this.textContent=t.call(this,e)}}function il(t){var e,n;function r(){var a=t.apply(this,arguments);return a!==n&&(e=(n=a)&&ol(a)),e}return r._value=t,r}function sl(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,il(t))}function cl(){for(var t=this._name,e=this._id,n=Za(),r=this._groups,a=r.length,i=0;i<a;++i)for(var s=r[i],c=s.length,l,u=0;u<c;++u)if(l=s[u]){var d=St(l,e);Cn(l,t,n,u,s,{time:d.time+d.delay+d.duration,delay:0,duration:d.duration,ease:d.ease})}return new Ut(r,this._parents,t,n)}function ll(){var t,e,n=this,r=n._id,a=n.size();return new Promise(function(i,s){var c={value:s},l={value:function(){--a===0&&i()}};n.each(function(){var u=_t(this,r),d=u.on;d!==t&&(e=(t=d).copy(),e._.cancel.push(c),e._.interrupt.push(c),e._.end.push(l)),u.on=e}),a===0&&i()})}var ul=0;function Ut(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function Za(){return++ul}var Lt=He.prototype;Ut.prototype={constructor:Ut,select:Hc,selectAll:Wc,selectChild:Lt.selectChild,selectChildren:Lt.selectChildren,filter:Fc,merge:Uc,selection:Xc,transition:cl,call:Lt.call,nodes:Lt.nodes,node:Lt.node,size:Lt.size,empty:Lt.empty,each:Lt.each,on:zc,attr:wc,attrTween:Dc,style:Zc,styleTween:el,text:al,textTween:sl,remove:qc,tween:mc,delay:Lc,duration:Ac,ease:Nc,easeVarying:Pc,end:ll,[Symbol.iterator]:Lt[Symbol.iterator]};function dl(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var fl={time:null,delay:0,duration:250,ease:dl};function hl(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function ml(t){var e,n;t instanceof Ut?(e=t._id,t=t._name):(e=Za(),(n=fl).time=pr(),t=t==null?null:t+"");for(var r=this._groups,a=r.length,i=0;i<a;++i)for(var s=r[i],c=s.length,l,u=0;u<c;++u)(l=s[u])&&Cn(l,t,e,u,s,n||hl(l,e));return new Ut(r,this._parents,t,e)}He.prototype.interrupt=dc;He.prototype.transition=ml;function pl(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function bn(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function Me(t){return t=bn(Math.abs(t)),t?t[1]:NaN}function gl(t,e){return function(n,r){for(var a=n.length,i=[],s=0,c=t[0],l=0;a>0&&c>0&&(l+c+1>r&&(c=Math.max(1,r-l)),i.push(n.substring(a-=c,a+c)),!((l+=c+1)>r));)c=t[s=(s+1)%t.length];return i.reverse().join(e)}}function yl(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var vl=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function wn(t){if(!(e=vl.exec(t)))throw new Error("invalid format: "+t);var e;return new vr({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}wn.prototype=vr.prototype;function vr(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}vr.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function xl(t){t:for(var e=t.length,n=1,r=-1,a;n<e;++n)switch(t[n]){case".":r=a=n;break;case"0":r===0&&(r=n),a=n;break;default:if(!+t[n])break t;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(a+1):t}var Ja;function bl(t,e){var n=bn(t,e);if(!n)return t+"";var r=n[0],a=n[1],i=a-(Ja=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,s=r.length;return i===s?r:i>s?r+new Array(i-s+1).join("0"):i>0?r.slice(0,i)+"."+r.slice(i):"0."+new Array(1-i).join("0")+bn(t,Math.max(0,e+i-1))[0]}function Gr(t,e){var n=bn(t,e);if(!n)return t+"";var r=n[0],a=n[1];return a<0?"0."+new Array(-a).join("0")+r:r.length>a+1?r.slice(0,a+1)+"."+r.slice(a+1):r+new Array(a-r.length+2).join("0")}const Kr={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:pl,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Gr(t*100,e),r:Gr,s:bl,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function jr(t){return t}var Qr=Array.prototype.map,Zr=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function wl(t){var e=t.grouping===void 0||t.thousands===void 0?jr:gl(Qr.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",a=t.decimal===void 0?".":t.decimal+"",i=t.numerals===void 0?jr:yl(Qr.call(t.numerals,String)),s=t.percent===void 0?"%":t.percent+"",c=t.minus===void 0?"−":t.minus+"",l=t.nan===void 0?"NaN":t.nan+"";function u(f){f=wn(f);var m=f.fill,p=f.align,$=f.sign,A=f.symbol,L=f.zero,M=f.width,v=f.comma,D=f.precision,_=f.trim,C=f.type;C==="n"?(v=!0,C="g"):Kr[C]||(D===void 0&&(D=12),_=!0,C="g"),(L||m==="0"&&p==="=")&&(L=!0,m="0",p="=");var w=A==="$"?n:A==="#"&&/[boxX]/.test(C)?"0"+C.toLowerCase():"",g=A==="$"?r:/[%p]/.test(C)?s:"",b=Kr[C],R=/[defgprs%]/.test(C);D=D===void 0?6:/[gprs]/.test(C)?Math.max(1,Math.min(21,D)):Math.max(0,Math.min(20,D));function I(N){var E=w,P=g,h,k,S;if(C==="c")P=b(N)+P,N="";else{N=+N;var z=N<0||1/N<0;if(N=isNaN(N)?l:b(Math.abs(N),D),_&&(N=xl(N)),z&&+N==0&&$!=="+"&&(z=!1),E=(z?$==="("?$:c:$==="-"||$==="("?"":$)+E,P=(C==="s"?Zr[8+Ja/3]:"")+P+(z&&$==="("?")":""),R){for(h=-1,k=N.length;++h<k;)if(S=N.charCodeAt(h),48>S||S>57){P=(S===46?a+N.slice(h+1):N.slice(h))+P,N=N.slice(0,h);break}}}v&&!L&&(N=e(N,1/0));var U=E.length+N.length+P.length,F=U<M?new Array(M-U+1).join(m):"";switch(v&&L&&(N=e(F+N,F.length?M-P.length:1/0),F=""),p){case"<":N=E+N+P+F;break;case"=":N=E+F+N+P;break;case"^":N=F.slice(0,U=F.length>>1)+E+N+P+F.slice(U);break;default:N=F+E+N+P;break}return i(N)}return I.toString=function(){return f+""},I}function d(f,m){var p=u((f=wn(f),f.type="f",f)),$=Math.max(-8,Math.min(8,Math.floor(Me(m)/3)))*3,A=Math.pow(10,-$),L=Zr[8+$/3];return function(M){return p(A*M)+L}}return{format:u,formatPrefix:d}}var tn,to,eo;Sl({thousands:",",grouping:[3],currency:["$",""]});function Sl(t){return tn=wl(t),to=tn.format,eo=tn.formatPrefix,tn}function Ml(t){return Math.max(0,-Me(Math.abs(t)))}function $l(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Me(e)/3)))*3-Me(Math.abs(t)))}function Tl(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Me(e)-Me(t))+1}function no(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function Dl(t){return function(){return t}}function _l(t){return+t}var Jr=[0,1];function me(t){return t}function er(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:Dl(isNaN(e)?NaN:.5)}function kl(t,e){var n;return t>e&&(n=t,t=e,e=n),function(r){return Math.max(t,Math.min(e,r))}}function Ll(t,e,n){var r=t[0],a=t[1],i=e[0],s=e[1];return a<r?(r=er(a,r),i=n(s,i)):(r=er(r,a),i=n(i,s)),function(c){return i(r(c))}}function Cl(t,e,n){var r=Math.min(t.length,e.length)-1,a=new Array(r),i=new Array(r),s=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++s<r;)a[s]=er(t[s],t[s+1]),i[s]=n(e[s],e[s+1]);return function(c){var l=Io(t,c,1,r)-1;return i[l](a[l](c))}}function ro(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function El(){var t=Jr,e=Jr,n=mr,r,a,i,s=me,c,l,u;function d(){var m=Math.min(t.length,e.length);return s!==me&&(s=kl(t[0],t[m-1])),c=m>2?Cl:Ll,l=u=null,f}function f(m){return m==null||isNaN(m=+m)?i:(l||(l=c(t.map(r),e,n)))(r(s(m)))}return f.invert=function(m){return s(a((u||(u=c(e,t.map(r),bt)))(m)))},f.domain=function(m){return arguments.length?(t=Array.from(m,_l),d()):t.slice()},f.range=function(m){return arguments.length?(e=Array.from(m),d()):e.slice()},f.rangeRound=function(m){return e=Array.from(m),n=Ks,d()},f.clamp=function(m){return arguments.length?(s=m?!0:me,d()):s!==me},f.interpolate=function(m){return arguments.length?(n=m,d()):n},f.unknown=function(m){return arguments.length?(i=m,f):i},function(m,p){return r=m,a=p,d()}}function ao(){return El()(me,me)}function Al(t,e,n,r){var a=Wn(t,e,n),i;switch(r=wn(r??",f"),r.type){case"s":{var s=Math.max(Math.abs(t),Math.abs(e));return r.precision==null&&!isNaN(i=$l(a,s))&&(r.precision=i),eo(r,s)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(i=Tl(a,Math.max(Math.abs(t),Math.abs(e))))&&(r.precision=i-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(i=Ml(a))&&(r.precision=i-(r.type==="%")*2);break}}return to(r)}function Rl(t){var e=t.domain;return t.ticks=function(n){var r=e();return Bo(r[0],r[r.length-1],n??10)},t.tickFormat=function(n,r){var a=e();return Al(a[0],a[a.length-1],n??10,r)},t.nice=function(n){n==null&&(n=10);var r=e(),a=0,i=r.length-1,s=r[a],c=r[i],l,u,d=10;for(c<s&&(u=s,s=c,c=u,u=a,a=i,i=u);d-- >0;){if(u=Hn(s,c,n),u===l)return r[a]=s,r[i]=c,e(r);if(u>0)s=Math.floor(s/u)*u,c=Math.ceil(c/u)*u;else if(u<0)s=Math.ceil(s*u)/u,c=Math.floor(c*u)/u;else break;l=u}return t},t}function xr(){var t=ao();return t.copy=function(){return ro(t,xr())},no.apply(t,arguments),Rl(t)}function Nl(t,e){t=t.slice();var n=0,r=t.length-1,a=t[n],i=t[r],s;return i<a&&(s=n,n=r,r=s,s=a,a=i,i=s),t[n]=e.floor(a),t[r]=e.ceil(i),t}const Pn=new Date,Fn=new Date;function ot(t,e,n,r){function a(i){return t(i=arguments.length===0?new Date:new Date(+i)),i}return a.floor=i=>(t(i=new Date(+i)),i),a.ceil=i=>(t(i=new Date(i-1)),e(i,1),t(i),i),a.round=i=>{const s=a(i),c=a.ceil(i);return i-s<c-i?s:c},a.offset=(i,s)=>(e(i=new Date(+i),s==null?1:Math.floor(s)),i),a.range=(i,s,c)=>{const l=[];if(i=a.ceil(i),c=c==null?1:Math.floor(c),!(i<s)||!(c>0))return l;let u;do l.push(u=new Date(+i)),e(i,c),t(i);while(u<i&&i<s);return l},a.filter=i=>ot(s=>{if(s>=s)for(;t(s),!i(s);)s.setTime(s-1)},(s,c)=>{if(s>=s)if(c<0)for(;++c<=0;)for(;e(s,-1),!i(s););else for(;--c>=0;)for(;e(s,1),!i(s););}),n&&(a.count=(i,s)=>(Pn.setTime(+i),Fn.setTime(+s),t(Pn),t(Fn),Math.floor(n(Pn,Fn))),a.every=i=>(i=Math.floor(i),!isFinite(i)||!(i>0)?null:i>1?a.filter(r?s=>r(s)%i===0:s=>a.count(0,s)%i===0):a)),a}const Sn=ot(()=>{},(t,e)=>{t.setTime(+t+e)},(t,e)=>e-t);Sn.every=t=>(t=Math.floor(t),!isFinite(t)||!(t>0)?null:t>1?ot(e=>{e.setTime(Math.floor(e/t)*t)},(e,n)=>{e.setTime(+e+n*t)},(e,n)=>(n-e)/t):Sn);Sn.range;const At=1e3,xt=At*60,Rt=xt*60,Bt=Rt*24,br=Bt*7,ta=Bt*30,Un=Bt*365,pe=ot(t=>{t.setTime(t-t.getMilliseconds())},(t,e)=>{t.setTime(+t+e*At)},(t,e)=>(e-t)/At,t=>t.getUTCSeconds());pe.range;const wr=ot(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*At)},(t,e)=>{t.setTime(+t+e*xt)},(t,e)=>(e-t)/xt,t=>t.getMinutes());wr.range;const Il=ot(t=>{t.setUTCSeconds(0,0)},(t,e)=>{t.setTime(+t+e*xt)},(t,e)=>(e-t)/xt,t=>t.getUTCMinutes());Il.range;const Sr=ot(t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*At-t.getMinutes()*xt)},(t,e)=>{t.setTime(+t+e*Rt)},(t,e)=>(e-t)/Rt,t=>t.getHours());Sr.range;const Pl=ot(t=>{t.setUTCMinutes(0,0,0)},(t,e)=>{t.setTime(+t+e*Rt)},(t,e)=>(e-t)/Rt,t=>t.getUTCHours());Pl.range;const Ye=ot(t=>t.setHours(0,0,0,0),(t,e)=>t.setDate(t.getDate()+e),(t,e)=>(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*xt)/Bt,t=>t.getDate()-1);Ye.range;const Mr=ot(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/Bt,t=>t.getUTCDate()-1);Mr.range;const Fl=ot(t=>{t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCDate(t.getUTCDate()+e)},(t,e)=>(e-t)/Bt,t=>Math.floor(t/Bt));Fl.range;function le(t){return ot(e=>{e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)},(e,n)=>{e.setDate(e.getDate()+n*7)},(e,n)=>(n-e-(n.getTimezoneOffset()-e.getTimezoneOffset())*xt)/br)}const En=le(0),Mn=le(1),Ul=le(2),Bl=le(3),$e=le(4),Ol=le(5),zl=le(6);En.range;Mn.range;Ul.range;Bl.range;$e.range;Ol.range;zl.range;function ue(t){return ot(e=>{e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCDate(e.getUTCDate()+n*7)},(e,n)=>(n-e)/br)}const oo=ue(0),$n=ue(1),Vl=ue(2),ql=ue(3),Te=ue(4),Hl=ue(5),Wl=ue(6);oo.range;$n.range;Vl.range;ql.range;Te.range;Hl.range;Wl.range;const $r=ot(t=>{t.setDate(1),t.setHours(0,0,0,0)},(t,e)=>{t.setMonth(t.getMonth()+e)},(t,e)=>e.getMonth()-t.getMonth()+(e.getFullYear()-t.getFullYear())*12,t=>t.getMonth());$r.range;const Yl=ot(t=>{t.setUTCDate(1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCMonth(t.getUTCMonth()+e)},(t,e)=>e.getUTCMonth()-t.getUTCMonth()+(e.getUTCFullYear()-t.getUTCFullYear())*12,t=>t.getUTCMonth());Yl.range;const Ot=ot(t=>{t.setMonth(0,1),t.setHours(0,0,0,0)},(t,e)=>{t.setFullYear(t.getFullYear()+e)},(t,e)=>e.getFullYear()-t.getFullYear(),t=>t.getFullYear());Ot.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:ot(e=>{e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)},(e,n)=>{e.setFullYear(e.getFullYear()+n*t)});Ot.range;const ce=ot(t=>{t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,e)=>{t.setUTCFullYear(t.getUTCFullYear()+e)},(t,e)=>e.getUTCFullYear()-t.getUTCFullYear(),t=>t.getUTCFullYear());ce.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:ot(e=>{e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,n)=>{e.setUTCFullYear(e.getUTCFullYear()+n*t)});ce.range;function Xl(t,e,n,r,a,i){const s=[[pe,1,At],[pe,5,5*At],[pe,15,15*At],[pe,30,30*At],[i,1,xt],[i,5,5*xt],[i,15,15*xt],[i,30,30*xt],[a,1,Rt],[a,3,3*Rt],[a,6,6*Rt],[a,12,12*Rt],[r,1,Bt],[r,2,2*Bt],[n,1,br],[e,1,ta],[e,3,3*ta],[t,1,Un]];function c(u,d,f){const m=d<u;m&&([u,d]=[d,u]);const p=f&&typeof f.range=="function"?f:l(u,d,f),$=p?p.range(u,+d+1):[];return m?$.reverse():$}function l(u,d,f){const m=Math.abs(d-u)/f,p=cr(([,,L])=>L).right(s,m);if(p===s.length)return t.every(Wn(u/Un,d/Un,f));if(p===0)return Sn.every(Math.max(Wn(u,d,f),1));const[$,A]=s[m/s[p-1][2]<s[p][2]/m?p-1:p];return $.every(A)}return[c,l]}const[Gl,Kl]=Xl(Ot,$r,En,Ye,Sr,wr);function Bn(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function On(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function Le(t,e,n){return{y:t,m:e,d:n,H:0,M:0,S:0,L:0}}function jl(t){var e=t.dateTime,n=t.date,r=t.time,a=t.periods,i=t.days,s=t.shortDays,c=t.months,l=t.shortMonths,u=Ce(a),d=Ee(a),f=Ce(i),m=Ee(i),p=Ce(s),$=Ee(s),A=Ce(c),L=Ee(c),M=Ce(l),v=Ee(l),D={a:z,A:U,b:F,B:V,c:null,d:ia,e:ia,f:xu,g:Lu,G:Eu,H:gu,I:yu,j:vu,L:io,m:bu,M:wu,p:B,q,Q:la,s:ua,S:Su,u:Mu,U:$u,V:Tu,w:Du,W:_u,x:null,X:null,y:ku,Y:Cu,Z:Au,"%":ca},_={a:j,A:Y,b:et,B:rt,c:null,d:sa,e:sa,f:Pu,g:Yu,G:Gu,H:Ru,I:Nu,j:Iu,L:co,m:Fu,M:Uu,p:at,q:mt,Q:la,s:ua,S:Bu,u:Ou,U:zu,V:Vu,w:qu,W:Hu,x:null,X:null,y:Wu,Y:Xu,Z:Ku,"%":ca},C={a:I,A:N,b:E,B:P,c:h,d:aa,e:aa,f:fu,g:ra,G:na,H:oa,I:oa,j:cu,L:du,m:su,M:lu,p:R,q:iu,Q:mu,s:pu,S:uu,u:eu,U:nu,V:ru,w:tu,W:au,x:k,X:S,y:ra,Y:na,Z:ou,"%":hu};D.x=w(n,D),D.X=w(r,D),D.c=w(e,D),_.x=w(n,_),_.X=w(r,_),_.c=w(e,_);function w(O,W){return function(X){var T=[],it=-1,Z=0,ft=O.length,ht,kt,Xe;for(X instanceof Date||(X=new Date(+X));++it<ft;)O.charCodeAt(it)===37&&(T.push(O.slice(Z,it)),(kt=ea[ht=O.charAt(++it)])!=null?ht=O.charAt(++it):kt=ht==="e"?" ":"0",(Xe=W[ht])&&(ht=Xe(X,kt)),T.push(ht),Z=it+1);return T.push(O.slice(Z,it)),T.join("")}}function g(O,W){return function(X){var T=Le(1900,void 0,1),it=b(T,O,X+="",0),Z,ft;if(it!=X.length)return null;if("Q"in T)return new Date(T.Q);if("s"in T)return new Date(T.s*1e3+("L"in T?T.L:0));if(W&&!("Z"in T)&&(T.Z=0),"p"in T&&(T.H=T.H%12+T.p*12),T.m===void 0&&(T.m="q"in T?T.q:0),"V"in T){if(T.V<1||T.V>53)return null;"w"in T||(T.w=1),"Z"in T?(Z=On(Le(T.y,0,1)),ft=Z.getUTCDay(),Z=ft>4||ft===0?$n.ceil(Z):$n(Z),Z=Mr.offset(Z,(T.V-1)*7),T.y=Z.getUTCFullYear(),T.m=Z.getUTCMonth(),T.d=Z.getUTCDate()+(T.w+6)%7):(Z=Bn(Le(T.y,0,1)),ft=Z.getDay(),Z=ft>4||ft===0?Mn.ceil(Z):Mn(Z),Z=Ye.offset(Z,(T.V-1)*7),T.y=Z.getFullYear(),T.m=Z.getMonth(),T.d=Z.getDate()+(T.w+6)%7)}else("W"in T||"U"in T)&&("w"in T||(T.w="u"in T?T.u%7:"W"in T?1:0),ft="Z"in T?On(Le(T.y,0,1)).getUTCDay():Bn(Le(T.y,0,1)).getDay(),T.m=0,T.d="W"in T?(T.w+6)%7+T.W*7-(ft+5)%7:T.w+T.U*7-(ft+6)%7);return"Z"in T?(T.H+=T.Z/100|0,T.M+=T.Z%100,On(T)):Bn(T)}}function b(O,W,X,T){for(var it=0,Z=W.length,ft=X.length,ht,kt;it<Z;){if(T>=ft)return-1;if(ht=W.charCodeAt(it++),ht===37){if(ht=W.charAt(it++),kt=C[ht in ea?W.charAt(it++):ht],!kt||(T=kt(O,X,T))<0)return-1}else if(ht!=X.charCodeAt(T++))return-1}return T}function R(O,W,X){var T=u.exec(W.slice(X));return T?(O.p=d.get(T[0].toLowerCase()),X+T[0].length):-1}function I(O,W,X){var T=p.exec(W.slice(X));return T?(O.w=$.get(T[0].toLowerCase()),X+T[0].length):-1}function N(O,W,X){var T=f.exec(W.slice(X));return T?(O.w=m.get(T[0].toLowerCase()),X+T[0].length):-1}function E(O,W,X){var T=M.exec(W.slice(X));return T?(O.m=v.get(T[0].toLowerCase()),X+T[0].length):-1}function P(O,W,X){var T=A.exec(W.slice(X));return T?(O.m=L.get(T[0].toLowerCase()),X+T[0].length):-1}function h(O,W,X){return b(O,e,W,X)}function k(O,W,X){return b(O,n,W,X)}function S(O,W,X){return b(O,r,W,X)}function z(O){return s[O.getDay()]}function U(O){return i[O.getDay()]}function F(O){return l[O.getMonth()]}function V(O){return c[O.getMonth()]}function B(O){return a[+(O.getHours()>=12)]}function q(O){return 1+~~(O.getMonth()/3)}function j(O){return s[O.getUTCDay()]}function Y(O){return i[O.getUTCDay()]}function et(O){return l[O.getUTCMonth()]}function rt(O){return c[O.getUTCMonth()]}function at(O){return a[+(O.getUTCHours()>=12)]}function mt(O){return 1+~~(O.getUTCMonth()/3)}return{format:function(O){var W=w(O+="",D);return W.toString=function(){return O},W},parse:function(O){var W=g(O+="",!1);return W.toString=function(){return O},W},utcFormat:function(O){var W=w(O+="",_);return W.toString=function(){return O},W},utcParse:function(O){var W=g(O+="",!0);return W.toString=function(){return O},W}}}var ea={"-":"",_:" ",0:"0"},ct=/^\s*\d+/,Ql=/^%/,Zl=/[\\^$*+?|[\]().{}]/g;function K(t,e,n){var r=t<0?"-":"",a=(r?-t:t)+"",i=a.length;return r+(i<n?new Array(n-i+1).join(e)+a:a)}function Jl(t){return t.replace(Zl,"\\$&")}function Ce(t){return new RegExp("^(?:"+t.map(Jl).join("|")+")","i")}function Ee(t){return new Map(t.map((e,n)=>[e.toLowerCase(),n]))}function tu(t,e,n){var r=ct.exec(e.slice(n,n+1));return r?(t.w=+r[0],n+r[0].length):-1}function eu(t,e,n){var r=ct.exec(e.slice(n,n+1));return r?(t.u=+r[0],n+r[0].length):-1}function nu(t,e,n){var r=ct.exec(e.slice(n,n+2));return r?(t.U=+r[0],n+r[0].length):-1}function ru(t,e,n){var r=ct.exec(e.slice(n,n+2));return r?(t.V=+r[0],n+r[0].length):-1}function au(t,e,n){var r=ct.exec(e.slice(n,n+2));return r?(t.W=+r[0],n+r[0].length):-1}function na(t,e,n){var r=ct.exec(e.slice(n,n+4));return r?(t.y=+r[0],n+r[0].length):-1}function ra(t,e,n){var r=ct.exec(e.slice(n,n+2));return r?(t.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function ou(t,e,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(n,n+6));return r?(t.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function iu(t,e,n){var r=ct.exec(e.slice(n,n+1));return r?(t.q=r[0]*3-3,n+r[0].length):-1}function su(t,e,n){var r=ct.exec(e.slice(n,n+2));return r?(t.m=r[0]-1,n+r[0].length):-1}function aa(t,e,n){var r=ct.exec(e.slice(n,n+2));return r?(t.d=+r[0],n+r[0].length):-1}function cu(t,e,n){var r=ct.exec(e.slice(n,n+3));return r?(t.m=0,t.d=+r[0],n+r[0].length):-1}function oa(t,e,n){var r=ct.exec(e.slice(n,n+2));return r?(t.H=+r[0],n+r[0].length):-1}function lu(t,e,n){var r=ct.exec(e.slice(n,n+2));return r?(t.M=+r[0],n+r[0].length):-1}function uu(t,e,n){var r=ct.exec(e.slice(n,n+2));return r?(t.S=+r[0],n+r[0].length):-1}function du(t,e,n){var r=ct.exec(e.slice(n,n+3));return r?(t.L=+r[0],n+r[0].length):-1}function fu(t,e,n){var r=ct.exec(e.slice(n,n+6));return r?(t.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function hu(t,e,n){var r=Ql.exec(e.slice(n,n+1));return r?n+r[0].length:-1}function mu(t,e,n){var r=ct.exec(e.slice(n));return r?(t.Q=+r[0],n+r[0].length):-1}function pu(t,e,n){var r=ct.exec(e.slice(n));return r?(t.s=+r[0],n+r[0].length):-1}function ia(t,e){return K(t.getDate(),e,2)}function gu(t,e){return K(t.getHours(),e,2)}function yu(t,e){return K(t.getHours()%12||12,e,2)}function vu(t,e){return K(1+Ye.count(Ot(t),t),e,3)}function io(t,e){return K(t.getMilliseconds(),e,3)}function xu(t,e){return io(t,e)+"000"}function bu(t,e){return K(t.getMonth()+1,e,2)}function wu(t,e){return K(t.getMinutes(),e,2)}function Su(t,e){return K(t.getSeconds(),e,2)}function Mu(t){var e=t.getDay();return e===0?7:e}function $u(t,e){return K(En.count(Ot(t)-1,t),e,2)}function so(t){var e=t.getDay();return e>=4||e===0?$e(t):$e.ceil(t)}function Tu(t,e){return t=so(t),K($e.count(Ot(t),t)+(Ot(t).getDay()===4),e,2)}function Du(t){return t.getDay()}function _u(t,e){return K(Mn.count(Ot(t)-1,t),e,2)}function ku(t,e){return K(t.getFullYear()%100,e,2)}function Lu(t,e){return t=so(t),K(t.getFullYear()%100,e,2)}function Cu(t,e){return K(t.getFullYear()%1e4,e,4)}function Eu(t,e){var n=t.getDay();return t=n>=4||n===0?$e(t):$e.ceil(t),K(t.getFullYear()%1e4,e,4)}function Au(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+K(e/60|0,"0",2)+K(e%60,"0",2)}function sa(t,e){return K(t.getUTCDate(),e,2)}function Ru(t,e){return K(t.getUTCHours(),e,2)}function Nu(t,e){return K(t.getUTCHours()%12||12,e,2)}function Iu(t,e){return K(1+Mr.count(ce(t),t),e,3)}function co(t,e){return K(t.getUTCMilliseconds(),e,3)}function Pu(t,e){return co(t,e)+"000"}function Fu(t,e){return K(t.getUTCMonth()+1,e,2)}function Uu(t,e){return K(t.getUTCMinutes(),e,2)}function Bu(t,e){return K(t.getUTCSeconds(),e,2)}function Ou(t){var e=t.getUTCDay();return e===0?7:e}function zu(t,e){return K(oo.count(ce(t)-1,t),e,2)}function lo(t){var e=t.getUTCDay();return e>=4||e===0?Te(t):Te.ceil(t)}function Vu(t,e){return t=lo(t),K(Te.count(ce(t),t)+(ce(t).getUTCDay()===4),e,2)}function qu(t){return t.getUTCDay()}function Hu(t,e){return K($n.count(ce(t)-1,t),e,2)}function Wu(t,e){return K(t.getUTCFullYear()%100,e,2)}function Yu(t,e){return t=lo(t),K(t.getUTCFullYear()%100,e,2)}function Xu(t,e){return K(t.getUTCFullYear()%1e4,e,4)}function Gu(t,e){var n=t.getUTCDay();return t=n>=4||n===0?Te(t):Te.ceil(t),K(t.getUTCFullYear()%1e4,e,4)}function Ku(){return"+0000"}function ca(){return"%"}function la(t){return+t}function ua(t){return Math.floor(+t/1e3)}var de,Tr;ju({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function ju(t){return de=jl(t),Tr=de.format,de.parse,de.utcFormat,de.utcParse,de}function Qu(t){return new Date(t)}function Zu(t){return t instanceof Date?+t:+new Date(+t)}function uo(t,e,n,r,a,i,s,c,l,u){var d=ao(),f=d.invert,m=d.domain,p=u(".%L"),$=u(":%S"),A=u("%I:%M"),L=u("%I %p"),M=u("%a %d"),v=u("%b %d"),D=u("%B"),_=u("%Y");function C(w){return(l(w)<w?p:c(w)<w?$:s(w)<w?A:i(w)<w?L:r(w)<w?a(w)<w?M:v:n(w)<w?D:_)(w)}return d.invert=function(w){return new Date(f(w))},d.domain=function(w){return arguments.length?m(Array.from(w,Zu)):m().map(Qu)},d.ticks=function(w){var g=m();return t(g[0],g[g.length-1],w??10)},d.tickFormat=function(w,g){return g==null?C:u(g)},d.nice=function(w){var g=m();return(!w||typeof w.range!="function")&&(w=e(g[0],g[g.length-1],w??10)),w?m(Nl(g,w)):d},d.copy=function(){return ro(d,uo(t,e,n,r,a,i,s,c,l,u))},d}function Ju(){return no.apply(uo(Gl,Kl,Ot,$r,En,Ye,Sr,wr,pe,Tr).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}const en=t=>()=>t;function td(t,{sourceEvent:e,target:n,transform:r,dispatch:a}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:a}})}function Nt(t,e,n){this.k=t,this.x=e,this.y=n}Nt.prototype={constructor:Nt,scale:function(t){return t===1?this:new Nt(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new Nt(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Dr=new Nt(1,0,0);Nt.prototype;function zn(t){t.stopImmediatePropagation()}function Ae(t){t.preventDefault(),t.stopImmediatePropagation()}function ed(t){return(!t.ctrlKey||t.type==="wheel")&&!t.button}function nd(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t,t.hasAttribute("viewBox")?(t=t.viewBox.baseVal,[[t.x,t.y],[t.x+t.width,t.y+t.height]]):[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]):[[0,0],[t.clientWidth,t.clientHeight]]}function da(){return this.__zoom||Dr}function rd(t){return-t.deltaY*(t.deltaMode===1?.05:t.deltaMode?1:.002)*(t.ctrlKey?10:1)}function ad(){return navigator.maxTouchPoints||"ontouchstart"in this}function od(t,e,n){var r=t.invertX(e[0][0])-n[0][0],a=t.invertX(e[1][0])-n[1][0],i=t.invertY(e[0][1])-n[0][1],s=t.invertY(e[1][1])-n[1][1];return t.translate(a>r?(r+a)/2:Math.min(0,r)||Math.max(0,a),s>i?(i+s)/2:Math.min(0,i)||Math.max(0,s))}function id(){var t=ed,e=nd,n=od,r=rd,a=ad,i=[0,1/0],s=[[-1/0,-1/0],[1/0,1/0]],c=250,l=rc,u=lr("start","zoom","end"),d,f,m,p=500,$=150,A=0,L=10;function M(h){h.property("__zoom",da).on("wheel.zoom",b,{passive:!1}).on("mousedown.zoom",R).on("dblclick.zoom",I).filter(a).on("touchstart.zoom",N).on("touchmove.zoom",E).on("touchend.zoom touchcancel.zoom",P).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}M.transform=function(h,k,S,z){var U=h.selection?h.selection():h;U.property("__zoom",da),h!==U?C(h,k,S,z):U.interrupt().each(function(){w(this,arguments).event(z).start().zoom(null,typeof k=="function"?k.apply(this,arguments):k).end()})},M.scaleBy=function(h,k,S,z){M.scaleTo(h,function(){var U=this.__zoom.k,F=typeof k=="function"?k.apply(this,arguments):k;return U*F},S,z)},M.scaleTo=function(h,k,S,z){M.transform(h,function(){var U=e.apply(this,arguments),F=this.__zoom,V=S==null?_(U):typeof S=="function"?S.apply(this,arguments):S,B=F.invert(V),q=typeof k=="function"?k.apply(this,arguments):k;return n(D(v(F,q),V,B),U,s)},S,z)},M.translateBy=function(h,k,S,z){M.transform(h,function(){return n(this.__zoom.translate(typeof k=="function"?k.apply(this,arguments):k,typeof S=="function"?S.apply(this,arguments):S),e.apply(this,arguments),s)},null,z)},M.translateTo=function(h,k,S,z,U){M.transform(h,function(){var F=e.apply(this,arguments),V=this.__zoom,B=z==null?_(F):typeof z=="function"?z.apply(this,arguments):z;return n(Dr.translate(B[0],B[1]).scale(V.k).translate(typeof k=="function"?-k.apply(this,arguments):-k,typeof S=="function"?-S.apply(this,arguments):-S),F,s)},z,U)};function v(h,k){return k=Math.max(i[0],Math.min(i[1],k)),k===h.k?h:new Nt(k,h.x,h.y)}function D(h,k,S){var z=k[0]-S[0]*h.k,U=k[1]-S[1]*h.k;return z===h.x&&U===h.y?h:new Nt(h.k,z,U)}function _(h){return[(+h[0][0]+ +h[1][0])/2,(+h[0][1]+ +h[1][1])/2]}function C(h,k,S,z){h.on("start.zoom",function(){w(this,arguments).event(z).start()}).on("interrupt.zoom end.zoom",function(){w(this,arguments).event(z).end()}).tween("zoom",function(){var U=this,F=arguments,V=w(U,F).event(z),B=e.apply(U,F),q=S==null?_(B):typeof S=="function"?S.apply(U,F):S,j=Math.max(B[1][0]-B[0][0],B[1][1]-B[0][1]),Y=U.__zoom,et=typeof k=="function"?k.apply(U,F):k,rt=l(Y.invert(q).concat(j/Y.k),et.invert(q).concat(j/et.k));return function(at){if(at===1)at=et;else{var mt=rt(at),O=j/mt[2];at=new Nt(O,q[0]-mt[0]*O,q[1]-mt[1]*O)}V.zoom(null,at)}})}function w(h,k,S){return!S&&h.__zooming||new g(h,k)}function g(h,k){this.that=h,this.args=k,this.active=0,this.sourceEvent=null,this.extent=e.apply(h,k),this.taps=0}g.prototype={event:function(h){return h&&(this.sourceEvent=h),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(h,k){return this.mouse&&h!=="mouse"&&(this.mouse[1]=k.invert(this.mouse[0])),this.touch0&&h!=="touch"&&(this.touch0[1]=k.invert(this.touch0[0])),this.touch1&&h!=="touch"&&(this.touch1[1]=k.invert(this.touch1[0])),this.that.__zoom=k,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(h){var k=qt(this.that).datum();u.call(h,this.that,new td(h,{sourceEvent:this.sourceEvent,target:M,transform:this.that.__zoom,dispatch:u}),k)}};function b(h,...k){if(!t.apply(this,arguments))return;var S=w(this,k).event(h),z=this.__zoom,U=Math.max(i[0],Math.min(i[1],z.k*Math.pow(2,r.apply(this,arguments)))),F=Vt(h);if(S.wheel)(S.mouse[0][0]!==F[0]||S.mouse[0][1]!==F[1])&&(S.mouse[1]=z.invert(S.mouse[0]=F)),clearTimeout(S.wheel);else{if(z.k===U)return;S.mouse=[F,z.invert(F)],un(this),S.start()}Ae(h),S.wheel=setTimeout(V,$),S.zoom("mouse",n(D(v(z,U),S.mouse[0],S.mouse[1]),S.extent,s));function V(){S.wheel=null,S.end()}}function R(h,...k){if(m||!t.apply(this,arguments))return;var S=h.currentTarget,z=w(this,k,!0).event(h),U=qt(h.view).on("mousemove.zoom",q,!0).on("mouseup.zoom",j,!0),F=Vt(h,S),V=h.clientX,B=h.clientY;Ts(h.view),zn(h),z.mouse=[F,this.__zoom.invert(F)],un(this),z.start();function q(Y){if(Ae(Y),!z.moved){var et=Y.clientX-V,rt=Y.clientY-B;z.moved=et*et+rt*rt>A}z.event(Y).zoom("mouse",n(D(z.that.__zoom,z.mouse[0]=Vt(Y,S),z.mouse[1]),z.extent,s))}function j(Y){U.on("mousemove.zoom mouseup.zoom",null),Ds(Y.view,z.moved),Ae(Y),z.event(Y).end()}}function I(h,...k){if(t.apply(this,arguments)){var S=this.__zoom,z=Vt(h.changedTouches?h.changedTouches[0]:h,this),U=S.invert(z),F=S.k*(h.shiftKey?.5:2),V=n(D(v(S,F),z,U),e.apply(this,k),s);Ae(h),c>0?qt(this).transition().duration(c).call(C,V,z,h):qt(this).call(M.transform,V,z,h)}}function N(h,...k){if(t.apply(this,arguments)){var S=h.touches,z=S.length,U=w(this,k,h.changedTouches.length===z).event(h),F,V,B,q;for(zn(h),V=0;V<z;++V)B=S[V],q=Vt(B,this),q=[q,this.__zoom.invert(q),B.identifier],U.touch0?!U.touch1&&U.touch0[2]!==q[2]&&(U.touch1=q,U.taps=0):(U.touch0=q,F=!0,U.taps=1+!!d);d&&(d=clearTimeout(d)),F&&(U.taps<2&&(f=q[0],d=setTimeout(function(){d=null},p)),un(this),U.start())}}function E(h,...k){if(this.__zooming){var S=w(this,k).event(h),z=h.changedTouches,U=z.length,F,V,B,q;for(Ae(h),F=0;F<U;++F)V=z[F],B=Vt(V,this),S.touch0&&S.touch0[2]===V.identifier?S.touch0[0]=B:S.touch1&&S.touch1[2]===V.identifier&&(S.touch1[0]=B);if(V=S.that.__zoom,S.touch1){var j=S.touch0[0],Y=S.touch0[1],et=S.touch1[0],rt=S.touch1[1],at=(at=et[0]-j[0])*at+(at=et[1]-j[1])*at,mt=(mt=rt[0]-Y[0])*mt+(mt=rt[1]-Y[1])*mt;V=v(V,Math.sqrt(at/mt)),B=[(j[0]+et[0])/2,(j[1]+et[1])/2],q=[(Y[0]+rt[0])/2,(Y[1]+rt[1])/2]}else if(S.touch0)B=S.touch0[0],q=S.touch0[1];else return;S.zoom("touch",n(D(V,B,q),S.extent,s))}}function P(h,...k){if(this.__zooming){var S=w(this,k).event(h),z=h.changedTouches,U=z.length,F,V;for(zn(h),m&&clearTimeout(m),m=setTimeout(function(){m=null},p),F=0;F<U;++F)V=z[F],S.touch0&&S.touch0[2]===V.identifier?delete S.touch0:S.touch1&&S.touch1[2]===V.identifier&&delete S.touch1;if(S.touch1&&!S.touch0&&(S.touch0=S.touch1,delete S.touch1),S.touch0)S.touch0[1]=this.__zoom.invert(S.touch0[0]);else if(S.end(),S.taps===2&&(V=Vt(V,this),Math.hypot(f[0]-V[0],f[1]-V[1])<L)){var B=qt(this).on("dblclick.zoom");B&&B.apply(this,arguments)}}}return M.wheelDelta=function(h){return arguments.length?(r=typeof h=="function"?h:en(+h),M):r},M.filter=function(h){return arguments.length?(t=typeof h=="function"?h:en(!!h),M):t},M.touchable=function(h){return arguments.length?(a=typeof h=="function"?h:en(!!h),M):a},M.extent=function(h){return arguments.length?(e=typeof h=="function"?h:en([[+h[0][0],+h[0][1]],[+h[1][0],+h[1][1]]]),M):e},M.scaleExtent=function(h){return arguments.length?(i[0]=+h[0],i[1]=+h[1],M):[i[0],i[1]]},M.translateExtent=function(h){return arguments.length?(s[0][0]=+h[0][0],s[1][0]=+h[1][0],s[0][1]=+h[0][1],s[1][1]=+h[1][1],M):[[s[0][0],s[0][1]],[s[1][0],s[1][1]]]},M.constrain=function(h){return arguments.length?(n=h,M):n},M.duration=function(h){return arguments.length?(c=+h,M):c},M.interpolate=function(h){return arguments.length?(l=h,M):l},M.on=function(){var h=u.on.apply(u,arguments);return h===u?M:h},M.clickDistance=function(h){return arguments.length?(A=(h=+h)*h,M):Math.sqrt(A)},M.tapDistance=function(h){return arguments.length?(L=+h,M):L},M}const gt=360;let Jt=null,Et=null;function sd(t){const{root:e,isOpen:n,onCanvasToggleUpdate:r,onTimeSliderUpdate:a}=t;Jt||(Jt=e.querySelector('[data-role="sidebar"]')),Et||(Et=e.querySelector('[data-action="toggle-sidebar"]'));const i=e.querySelector('[data-role="canvas-toggle"]'),s=e.querySelector('[data-role="compare-info-trigger"]'),c=e.querySelector('[data-role="compare-info-overlay"]');if(!Jt||!i||!Et)return;const l=n?"translateX(0)":`translateX(${gt+24}px)`;Jt.style.transform=l,Jt.style.pointerEvents=n?"auto":"none",Jt.setAttribute("aria-hidden",String(!n));const u=n?`${gt+10}px`:"14px";Et.style.right=u,Et.setAttribute("aria-label",n?"Collapse sidebar":"Expand sidebar"),Et.className=n?"sidebar-toggle open":"sidebar-toggle";const d=Et.querySelector("span");d&&(d.textContent=n?"›":"‹");const f=n?gt+24:24;i.style.right=`${f}px`,s&&(s.style.right=`${f}px`),c&&(c.style.left=n?`${gt}px`:"0",c.style.right="0"),r&&r(f),a&&a(n)}function cd(t){const{root:e,getSidebarOpen:n,setSidebarOpen:r,onCanvasToggleUpdate:a,onTimeSliderUpdate:i}=t;Jt=e.querySelector('[data-role="sidebar"]'),Et=e.querySelector('[data-action="toggle-sidebar"]'),Et?.addEventListener("click",()=>{const s=!n();r(s),sd({root:e,isOpen:s,onCanvasToggleUpdate:a,onTimeSliderUpdate:i})})}function ld(t){const e=t?gt+10:14;return`
      <button
        type="button"
        aria-label="${t?"Collapse sidebar":"Expand sidebar"}"
        data-action="toggle-sidebar"
        class="${t?"sidebar-toggle open":"sidebar-toggle"}"
        style="right: ${e}px"
      >
        <span class="sidebar-toggle-icon">${t?"›":"‹"}</span>
      </button>
    `}function fo(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:{r:0,g:0,b:0}}const ud=t=>t-273.15,dd=t=>(t-273.15)*(9/5)+32,fd=t=>t*1e3,hd=t=>t*3.6,md=t=>t*2.237,pd=t=>t/1e3,fe=t=>t;function Kt(t){switch(t){case"tas":case"tasmin":case"tasmax":return[{label:"Kelvin (K)",unit:"K",convert:fe},{label:"Celsius (°C)",unit:"°C",convert:ud},{label:"Fahrenheit (°F)",unit:"°F",convert:dd}];case"pr":return[{label:"g m⁻² s⁻¹",unit:"g m⁻² s⁻¹",convert:fd},{label:"kg m⁻² s⁻¹",unit:"kg m⁻² s⁻¹",convert:fe}];case"rsds":case"rlds":return[{label:"W/m²",unit:"W/m²",convert:fe},{label:"kW/m²",unit:"kW/m²",convert:pd}];case"sfcWind":return[{label:"m/s",unit:"m/s",convert:fe},{label:"km/h",unit:"km/h",convert:hd},{label:"mph",unit:"mph",convert:md}];case"hurs":return[{label:"Percent (%)",unit:"%",convert:fe}];default:return[{label:"Default",unit:"",convert:fe}]}}function ze(t){return Kt(t)[0]}function xe(t,e,n,r){const i=Kt(e).find(s=>s.label===n);return i?r?.isDifference&&["tas","tasmin","tasmax"].includes(e)?n.includes("Celsius")?t:n.includes("Fahrenheit")?t*(9/5):t:i.convert(t):t}function ho(t,e){return Kt(t).find(a=>a.label===e)?.unit||""}function mo(t,e,n,r,a){const s=Kt(n).find(c=>c.label===r);return s?a?.isDifference&&["tas","tasmin","tasmax"].includes(n)?r.startsWith("Celsius")?{min:t,max:e}:r.startsWith("Fahrenheit")?{min:t*1.8,max:e*1.8}:{min:t,max:e}:{min:s.convert(t),max:s.convert(e)}:{min:t,max:e}}let It=null,Ve=[];function _r(t,e,n,r){const a=r.map(fo);for(let i=0;i<n;i++){const c=(1-i/(n-1))*(a.length-1),l=Math.floor(c),u=Math.min(l+1,a.length-1),d=c-l,f=a[l],m=a[u],p=Math.round(f.r+(m.r-f.r)*d),$=Math.round(f.g+(m.g-f.g)*d),A=Math.round(f.b+(m.b-f.b)*d);t.fillStyle=`rgb(${p}, ${$}, ${A})`,t.fillRect(0,i,e,1)}}function gd(t,e,n,r,a,i){const s=r?.variable_metadata[t],c=s?.name||t;let l=e,u=n,d=s?.unit||"";if(a){const p=mo(e,n,t,a,{isDifference:i});l=p.min,u=p.max,d=ho(t,a)}const f=(u-l)/4,m=[u,u-f,u-2*f,u-3*f,l];return`
      <div class="map-legend">
        <div class="legend-title">${c}</div>
        <div class="legend-container">
        <canvas id="legend-gradient-canvas" width="20" height="200" style="width: 20px; height: 200px; border-radius: 4px;"></canvas>
          <div class="legend-labels">
            ${m.map(p=>`<span>${p.toFixed(2)} ${d}</span>`).join("")}
          </div>
        </div>
      </div>
    `}function nr(t,e){const n=document.getElementById(t);if(!n){console.warn("Legend canvas not found");return}It=n,Ve=e;const r=n.getContext("2d");if(!r)return;const a=n.width,i=n.height;_r(r,a,i,e)}function yd(t,e,n){if(!It||Ve.length===0)return;const r=It.getContext("2d");if(!r)return;const a=It.width,i=It.height;_r(r,a,i,Ve);const s=(t-e)/(n-e),c=Math.round(i*(1-s));r.strokeStyle="rgba(255, 255, 255, 0.95)",r.lineWidth=2,r.shadowColor="rgba(0, 0, 0, 0.8)",r.shadowBlur=4,r.beginPath(),r.moveTo(0,c),r.lineTo(a,c),r.stroke(),r.shadowBlur=0}function vd(){if(!It||Ve.length===0)return;const t=It.getContext("2d");if(!t)return;const e=It.width,n=It.height;_r(t,e,n,Ve)}const kr="http://localhost:8000";class Gt extends Error{statusCode;details;constructor(e,n,r){super(e),this.name="DataClientError",this.statusCode=n,this.details=r}}function xd(t){return{Historical:"historical",SSP245:"ssp245",SSP585:"ssp585"}[t]||t.toLowerCase()}function bd(t){return t===1?"low":t===2?"medium":"high"}function wd(t,e,n="float32"){const r=atob(t),a=new Uint8Array(r.length);for(let i=0;i<r.length;i++)a[i]=r.charCodeAt(i);if(n.includes("float32"))return new Float32Array(a.buffer);if(n.includes("float64"))return new Float64Array(a.buffer);throw new Error(`Unsupported dtype: ${n}`)}function Sd(t,e){const n=t.flat(),r=new Float32Array(n.length);for(let a=0;a<n.length;a++)r[a]=n[a];return r}async function qe(t,e){const r=`${kr}/data`;try{const a=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...t,scenario:t.scenario?xd(t.scenario):void 0,data_format:t.data_format||"base64"})});if(!a.ok){const i=await a.json().catch(()=>({detail:a.statusText}));throw new Gt(i.detail||`HTTP ${a.status}: ${a.statusText}`,a.status,i)}return await a.json()}catch(a){throw a instanceof Gt?a:new Gt(`Failed to fetch data: ${a instanceof Error?a.message:String(a)}`,void 0,a)}}async function po(t){const n=`${kr}/metadata`;try{const r=await fetch(n,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Gt(`HTTP ${r.status}: ${r.statusText}`,r.status);return await r.json()}catch(r){throw r instanceof Gt?r:new Gt(`Failed to fetch metadata: ${r instanceof Error?r.message:String(r)}`)}}function De(t){return t.data?t.data instanceof Float32Array||t.data instanceof Float64Array?t.data:t.data_encoding==="none"?null:t.data_encoding==="base64"&&typeof t.data=="string"?wd(t.data,t.shape,t.dtype):t.data_encoding==="list"&&Array.isArray(t.data)?Sd(t.data,t.shape):null:null}function Mt(t){return{variable:t.variable,time:t.date,model:t.model,scenario:t.scenario,resolution:bd(t.resolution),data_format:t.dataFormat||"base64"}}async function Md(t){const n=`${kr}/health`;try{return(await fetch(n,{method:"GET",signal:AbortSignal.timeout(5e3)})).ok}catch{return!1}}let Re=null,rr=0,ar=1,te="",ee="",dn=!1;function go(){return Re||(Re=document.createElement("div"),Re.className="map-tooltip",document.body.appendChild(Re)),Re}function $d(t,e,n,r,a,i,s){const c=go();let l=a,u=i;ee&&te&&(l=xe(a,te,ee,{isDifference:s??dn}),u=ho(te,ee)||i),c.textContent=`Lat: ${n.toFixed(2)}, Lon: ${r.toFixed(2)}, Value: ${l.toFixed(2)} ${u}`,c.style.display="block",c.style.left=`${t+10}px`,c.style.top=`${e+10}px`;let d=rr,f=ar;if(ee&&te){const m=xe(rr,te,ee,{isDifference:s??dn}),p=xe(ar,te,ee,{isDifference:s??dn});d=m,f=p}yd(l,d,f)}function Pe(){const t=go();t.style.display="none",vd()}function Td(t,e,n,r,a){rr=t,ar=e,n!==void 0&&(te=n),r!==void 0&&(ee=r),a!==void 0&&(dn=a)}let G=Dr,fa=null,dt=null,yo=null,vo=!1,Tn=null,xo,bo,Fe=!1,or=null,ha=null;function Dd(t){const e=t.getContext("2d");if(!e)return null;const n=t.getBoundingClientRect();return t.width=n.width*window.devicePixelRatio,t.height=n.height*window.devicePixelRatio,e.scale(window.devicePixelRatio,window.devicePixelRatio),{ctx:e,rect:n,viewWidth:n.width,viewHeight:n.height}}function _d(t,e,n,r){const a=t*n+n/2,i=a>180?a-360:a,s=90-(e*r+r/2);return[i,s]}function kd(t,e,n,r,a){if(t<0||t>=n||e<0||e>=r)return null;const s=(r-1-e)*n+t,c=a[s];return isFinite(c)?c:null}function Vn(t){Fe?t.style.cursor="crosshair":t.style.cursor="auto"}function ma(t,e,n){if(!dt)return null;const r=t.getBoundingClientRect(),a=e-r.left,i=n-r.top;let s=(a-G.x)/G.k;const c=(i-G.y)/G.k,l=dt.width,u=dt.height;if(c<0||c>u)return null;let d=s;d=d%l,d<0&&(d+=l),d<0&&(d=0),d>=l&&(d=l*(1-Number.EPSILON));const f=d/l*360-180,m=90-c/u*180,p=Math.max(-180,Math.min(180,f)),$=Math.max(-90,Math.min(90,m));return!Number.isFinite(p)||!Number.isFinite($)?null:{lat:$,lon:p}}function Ld(t,e){Fe=t,or=t?e??null:null}function Cd(t,e,n){if(!dt)return null;const r=dt.width,a=dt.height;let i=e;for(;i>180;)i-=360;for(;i<-180;)i+=360;const s=(i+180)/360*r,c=(90-n)/180*a,l=s*G.k+G.x,u=c*G.k+G.y,d=t.getBoundingClientRect(),f=r*G.k,m=d.width/2;let p=l,$=Math.abs(l-m);for(let A=-f;A<=f;A+=f){const L=l+A,M=Math.abs(L-m);M<$&&($=M,p=L)}return u<-a*G.k||u>d.height+a*G.k?null:{x:p,y:u}}function Ed(t,e,n,r,a,i){Ld(i?.drawMode??!1,{onClick:i?.onDrawClick,onMove:i?.onDrawMove}),ha=i?.onTransform??null,Vn(t);const s=qt(t);fa=id().scaleExtent([.8,10]).filter(c=>Fe?!1:!c.ctrlKey&&!c.button).on("zoom",c=>{G=c.transform,e&&Ad(t),ha?.()}).on("start",()=>{t.style.cursor="grabbing",Pe()}).on("end",()=>{Vn(t)}),s.call(fa),s.on("click.draw",c=>{if(Fe){const l=ma(t,c.clientX,c.clientY);l&&or?.onClick?.(l)}}),s.on("pointermove.tooltip",c=>{if(Fe){const l=ma(t,c.clientX,c.clientY);l&&or?.onMove?.(l),Pe();return}if(c.buttons===0&&yo&&Tn&&dt){const[l,u]=Vt(c,t);Rd(c.clientX,c.clientY,l,u,n,xo,bo,vo)}}),s.on("pointerleave",()=>{Pe()}),Vn(t)}function Ad(t){if(!dt)return;const e=t.getContext("2d");if(!e)return;const n=t.getBoundingClientRect();e.clearRect(0,0,n.width,n.height),e.save(),e.translate(G.x,G.y),e.scale(G.k,G.k),e.imageSmoothingEnabled=!1;const r=dt.width,a=-G.x/G.k,i=(n.width-G.x)/G.k,s=Math.floor(a/r)-1,c=Math.ceil(i/r)+1;for(let l=s;l<=c;l++)e.drawImage(dt,l*r,0);e.restore()}function ir(t,e,n,r,a,i,s,c){if(!e)return;const l=De(t);if(!l){console.warn("No data to render");return}console.log("Rendering map data (full render)");const u=Dd(e);if(!u)return;const{ctx:d,rect:f,viewWidth:m,viewHeight:p}=u,[$,A]=t.shape;d.clearRect(0,0,f.width,f.height),d.save();const L=!!t?.metadata?.comparison||typeof t.model=="string"&&t.model.includes(" minus ");yo=t,xo=s,bo=c,vo=L;const M=new Array(p).fill(null).map(()=>new Float32Array(m).fill(NaN));let v=a,D=i;if(s&&c){const B=mo(a,i,s,c,{isDifference:L});v=B.min,D=B.max}Td(a,i,s,c,L);const w=(n.find(B=>B.name===r)||n[0]).colors.map(fo);function g(B,q){const j=(B+180)/360*m,Y=(90-q)/150*p;return[j,Y]}const b=document.createElement("canvas");b.width=m,b.height=p;const R=b.getContext("2d");if(!R)return;const I=R.createImageData(m,p),N=I.data;console.log("Rendering map data");const E=Math.max(m/A,p/$)*.8,P=Math.ceil(E/2),h=360/A,k=150/$;for(let B=0;B<$;B++)for(let q=0;q<A;q++){const j=kd(q,B,A,$,l);if(j===null)continue;const[Y,et]=_d(q,B,h,k),[rt,at]=g(Y,et);let mt=j;s&&c&&(mt=xe(j,s,c,{isDifference:L}));const O=D-v,W=O===0?.5:Math.min(1,Math.max(0,(mt-v)/O)),X=Math.floor(W*(w.length-1)),T=w[Math.min(X,w.length-1)],it=w[Math.min(X+1,w.length-1)],Z=W*(w.length-1)-X,ft=Math.round(T.r+(it.r-T.r)*Z),ht=Math.round(T.g+(it.g-T.g)*Z),kt=Math.round(T.b+(it.b-T.b)*Z),Xe=Math.max(0,Math.floor(rt-P)),Lo=Math.min(m,Math.ceil(rt+P)),Co=Math.max(0,Math.floor(at-P)),Eo=Math.min(p,Math.ceil(at+P));for(let Ge=Co;Ge<Eo;Ge++)for(let Ke=Xe;Ke<Lo;Ke++){const je=(Ge*m+Ke)*4;N[je]=ft,N[je+1]=ht,N[je+2]=kt,N[je+3]=255,M[Ge][Ke]=j}}R.putImageData(I,0,0),dt=b,Tn=M,d.clearRect(0,0,f.width,f.height),d.save(),d.translate(G.x,G.y),d.scale(G.k,G.k),d.imageSmoothingEnabled=!1;const S=dt.width,z=-G.x/G.k,U=(f.width-G.x)/G.k,F=Math.floor(z/S)-1,V=Math.ceil(U/S)+1;for(let B=F;B<=V;B++)d.drawImage(dt,B*S,0);d.restore()}function Rd(t,e,n,r,a,i,s,c){if(!Tn||!dt)return;let l=(n-G.x)/G.k;const u=(r-G.y)/G.k,d=dt.width,f=dt.height;l=(l%d+d)%d;const m=Math.floor(l),p=Math.floor(u);if(m>=0&&m<d&&p>=0&&p<f){const $=Tn?.[p]?.[m]??0;if(isFinite($)){const A=l/d*360-180,L=90-u/f*150;$d(t,e,L,A,$,a,c)}else Pe()}else Pe()}function Ht(t){const e=new Date(t);return`${["January","February","March","April","May","June","July","August","September","October","November","December"][e.getMonth()]} ${e.getDate()}, ${e.getFullYear()}`}function Nd(t){const{date:e,timeRange:n,sidebarOpen:r,sidebarWidth:a,mode:i,compareMode:s,compareDateStart:c,compareDateEnd:l}=t;let u=0,d=0,f=0,m=0,p=0,$=0,A=0,L=100;if(n){const v=new Date(n.start),D=new Date(n.end),_=new Date(e);if(d=Math.floor((D.getTime()-v.getTime())/(1e3*60*60*24)),f=Math.floor((_.getTime()-v.getTime())/(1e3*60*60*24)),m=d>0?f/d*100:0,i==="Compare"&&s==="Dates"){const C=c?new Date(c):v,w=l?new Date(l):D;p=Math.max(0,Math.floor((C.getTime()-v.getTime())/(1e3*60*60*24))),$=Math.min(d,Math.floor((w.getTime()-v.getTime())/(1e3*60*60*24))),A=d>0?p/d*100:0,L=d>0?$/d*100:100}}const M=r?a+16:16;if(i==="Compare"&&s==="Dates"&&n){const v=Ht(c||n.start),D=Ht(l||n.end);return`
      <div class="time-slider-container" style="right: ${M}px">
        <div data-role="time-label" class="time-label">${v} – ${D}</div>
        <div class="time-slider-row dual-slider" data-role="dual-slider">
          <div
            class="dual-slider-track"
            aria-hidden="true"
          ></div>
          <div
            class="dual-slider-fill"
            data-role="dual-fill"
            style="--fill-start: ${A}%; --fill-end: ${L}%"
            aria-hidden="true"
          ></div>
          <input
            type="range"
            min="${u}"
            max="${d}"
            step="1"
            value="${p}"
            data-action="set-time-start"
            class="time-slider dual-thumb dual-thumb-start"
            aria-label="Start date"
          />
          <input
            type="range"
            min="${u}"
            max="${d}"
            step="1"
            value="${$}"
            data-action="set-time-end"
            class="time-slider dual-thumb dual-thumb-end"
            aria-label="End date"
          />
        </div>
      </div>
    `}return`
      <div class="time-slider-container" style="right: ${M}px">
        <div data-role="time-label" class="time-label">${Ht(e)}</div>
        <div class="time-slider-row">
          <input
            type="range"
            min="${u}"
            max="${d}"
            step="1"
            value="${f}"
            data-action="set-time"
            class="time-slider"
            style="--slider-fill: ${m}%"
          />
        </div>
      </div>
    `}let he=null,sr=null;function Id(t){const{root:e,getTimeRange:n,onDateChange:r,getMode:a,getCompareMode:i,getCompareDates:s,onDateRangeChange:c}=t;sr=e.querySelector('[data-role="time-label"]')?.parentElement??null;const l=()=>a?.()==="Compare"&&i?.()==="Dates";e.querySelectorAll('[data-action="set-time"]').forEach(L=>L.addEventListener("input",()=>{if(l())return;const M=Number.parseInt(L.value,10),v=n();if(!Number.isNaN(M)&&v){const D=new Date(v.start);D.setDate(D.getDate()+M);const _=D.toISOString().split("T")[0],C=e.querySelector('[data-role="time-label"]');C&&(C.textContent=Ht(_));const w=new Date(v.end),g=Math.floor((w.getTime()-new Date(v.start).getTime())/(1e3*60*60*24)),b=g>0?M/g*100:0;L.style.setProperty("--slider-fill",`${b}%`),he&&window.clearTimeout(he),he=window.setTimeout(()=>{r(_)},500)}}));const d=e.querySelectorAll('[data-action="set-time-start"]'),f=e.querySelectorAll('[data-action="set-time-end"]'),m=e.querySelector('[data-role="dual-fill"]'),p=(L,M,v,D,_)=>{const C=e.querySelector('[data-role="time-label"]'),w=new Date(v.start),g=new Date(v.start);w.setDate(w.getDate()+L),g.setDate(g.getDate()+M);const b=w.toISOString().split("T")[0],R=g.toISOString().split("T")[0];C&&(C.textContent=`${Ht(b)} – ${Ht(R)}`);const I=new Date(v.end).getTime()-new Date(v.start).getTime(),N=Math.max(1,Math.floor(I/(1e3*60*60*24))),E=L/N*100,P=M/N*100;[m,D,_].forEach(k=>{k&&(k.style.setProperty("--fill-start",`${E}%`),k.style.setProperty("--fill-end",`${P}%`))})},$=(L,M,v)=>{L.addEventListener("input",()=>{if(!l())return;const D=n();if(!D)return;const _=Math.floor((new Date(D.end).getTime()-new Date(D.start).getTime())/(1e3*60*60*24));let C=Number.parseInt(v?L.value:M.value,10),w=Number.parseInt(v?M.value:L.value,10);if(Number.isNaN(C)||Number.isNaN(w))return;C=Math.max(0,Math.min(C,_)),w=Math.max(0,Math.min(w,_)),v&&C>w?(w=C,M.value=String(w)):!v&&w<C&&(C=w,M.value=String(C)),p(C,w,D,v?L:M,v?M:L);const g=new Date(D.start);g.setDate(g.getDate()+C);const b=new Date(D.start);b.setDate(b.getDate()+w);const R=g.toISOString().split("T")[0],I=b.toISOString().split("T")[0];he&&window.clearTimeout(he),he=window.setTimeout(()=>{c?.(R,I)},300)})},A=L=>{const M=d[0],v=f[0];!M||!v||(L==="start"?(M.style.zIndex="4",v.style.zIndex="3"):(M.style.zIndex="3",v.style.zIndex="4"))};if(d.length&&f.length){d.forEach((v,D)=>{const _=f[D]||f[0];$(v,_,!0),v.addEventListener("pointerdown",()=>A("start"))}),f.forEach((v,D)=>{const _=d[D]||d[0];$(v,_,!1),v.addEventListener("pointerdown",()=>A("end"))}),d.forEach(v=>v.addEventListener("focus",()=>A("start"))),f.forEach(v=>v.addEventListener("focus",()=>A("end")));const L=(v,D)=>{v.addEventListener("pointerdown",_=>{if(!l())return;const C=n();if(!C)return;const w=v.getBoundingClientRect(),g=Math.min(1,Math.max(0,(_.clientX-w.left)/w.width)),b=Math.max(1,Math.floor((new Date(C.end).getTime()-new Date(C.start).getTime())/(1e3*60*60*24))),R=Number.parseInt(v.value,10),N=(Number.isNaN(R)?0:Math.max(0,Math.min(R,b)))/b;Math.abs(g-N)*w.width>14&&(_.preventDefault(),_.stopPropagation(),A(v===D?"end":"start"))})};if(L(d[0],f[0]),L(f[0],d[0]),l()){const v=n(),D=s?.();if(v&&D){const _=Math.max(0,Math.floor((new Date(D.start).getTime()-new Date(v.start).getTime())/864e5)),C=Math.max(0,Math.floor((new Date(D.end).getTime()-new Date(v.start).getTime())/(1e3*60*60*24))),w=d[0],g=f[0];w.value=String(_),g.value=String(Math.max(C,_)),p(_,Math.max(C,_),v,w,g)}}e.querySelectorAll(".dual-slider").forEach(v=>{v.addEventListener("pointermove",D=>{if(!l())return;const _=n();if(!_)return;const C=d[0],w=f[0];if(!C||!w)return;const g=v.getBoundingClientRect(),b=Math.min(1,Math.max(0,(D.clientX-g.left)/g.width)),R=Math.max(1,Math.floor((new Date(_.end).getTime()-new Date(_.start).getTime())/(1e3*60*60*24)));let I=Number.parseInt(C.value,10),N=Number.parseInt(w.value,10);Number.isNaN(I)&&(I=0),Number.isNaN(N)&&(N=R);const E=I/R,P=N/R,h=Math.abs(b-E)<=Math.abs(b-P);A(h?"start":"end")})})}}function Pd(t,e){if(sr){const n=t?e+16:16;sr.style.right=`${n}px`}}const Fd=!1;function wo(t,e){document.querySelectorAll("[data-role='chart-container']").forEach(r=>{r.style.transition="padding 220ms ease, padding-right 220ms ease, transform 220ms ease",r.style.paddingRight=`${t}px`,typeof e=="number"&&(r.style.transform=`scale(${e})`,r.style.transformOrigin="center center")})}function Lr(t){const e=t.toLowerCase();return e==="historical"?"Historical":e==="ssp245"?"SSP245":e==="ssp370"?"SSP370":e==="ssp585"?"SSP585":t}function J(t){return new Date(t)}function Cr(t){if(!t.length)return jt("Historical");let e="1900-01-01",n="2100-12-31";return t.forEach((r,a)=>{const i=jt(r);if(a===0){e=i.start,n=i.end;return}e=J(i.start)>J(e)?i.start:e,n=J(i.end)<J(n)?i.end:n}),{start:e,end:n}}function Wt(t,e){const n=J(t),r=J(e.start),a=J(e.end);return n<r?e.start:n>a?e.end:t}const Ft=["Historical","SSP245","SSP370","SSP585"],yt=["ACCESS-CM2","CanESM5","CESM2","CMCC-CM2-SR5","EC-Earth3","GFDL-ESM4","INM-CM5-0","IPSL-CM6A-LR","MIROC6","MPI-ESM1-2-HR","MRI-ESM2-0"],Pt=["tas","pr","rsds","hurs","rlds","sfcWind","tasmin","tasmax"],Ud={SSP245:"A moderate scenario (2015-2100) that assumes we take active measures against climate change. This represents a realistic path where significant climate protection policies are implemented, leading to moderate warming by the end of the century.",SSP370:"A moderate-to-high scenario (2015-2100) representing a middle ground. This path assumes some climate action is taken, but not enough to prevent substantial warming. It falls between optimistic and pessimistic outcomes.",SSP585:"A pessimistic scenario (2015-2100) representing a worst-case path with minimal climate action. This shows what happens if we continue with current trends and take little to no measures against climate change, leading to severe warming.",Historical:"Historical climate simulation (1950-2014) based on past conditions. This represents simulated climate data for the historical period, used as a baseline to compare against future projections."},Bd={tas:"Near-Surface Air Temperature",pr:"Precipitation",rsds:"Surface Downwelling Shortwave Radiation",hurs:"Near-Surface Relative Humidity",rlds:"Surface Downwelling Longwave Radiation",sfcWind:"Daily-Mean Near-Surface Wind Speed",tasmin:"Daily Minimum Near-Surface Air Temperature",tasmax:"Daily Maximum Near-Surface Air Temperature"},Od={tas:"The air temperature near the Earth's surface, measured in Kelvin.",pr:"The amount of water that falls from the atmosphere to the surface, measured as mass per unit area per unit time.",rsds:"Incoming solar radiation reaching the Earth's surface, measured in Watts per square meter.",hurs:"The amount of moisture in the air relative to the maximum it can hold, expressed as a percentage.",rlds:"Incoming thermal radiation from the atmosphere, measured in Watts per square meter.",sfcWind:"The average wind speed near the surface over a day, measured in meters per second.",tasmin:"The lowest air temperature near the surface during a day, measured in Kelvin.",tasmax:"The highest air temperature near the surface during a day, measured in Kelvin."},zd={"ACCESS-CM2":"Developed by Australia's research institutions. This model is part of the global CMIP6 ensemble, providing climate projections that contribute to our understanding of future climate patterns.",CanESM5:"The Canadian Earth System Model version 5, developed by Environment and Climate Change Canada. This model represents North American climate research and contributes valuable projections to the global climate science community.",CESM2:"The Community Earth System Model version 2, developed by the National Center for Atmospheric Research (NCAR) in the United States. One of the most widely used models in climate research, known for its comprehensive representation of Earth's climate system.","CMCC-CM2-SR5":"Developed by the Euro-Mediterranean Center on Climate Change (CMCC) in Italy. This model provides European perspectives on climate change and is particularly valuable for understanding Mediterranean and European climate patterns.","EC-Earth3":"A collaborative European climate model developed by multiple research institutions across Europe. This model combines expertise from various European countries to provide comprehensive climate projections.","GFDL-ESM4":"Developed by NOAA's Geophysical Fluid Dynamics Laboratory in the United States. This model is known for its advanced representation of ocean and atmosphere interactions, providing detailed climate projections.","INM-CM5-0":"Developed by the Institute of Numerical Mathematics in Russia. This model contributes a unique perspective from Russian climate research to the global ensemble of climate models.","IPSL-CM6A-LR":"Developed by the Institut Pierre-Simon Laplace in France. This model is part of a long-standing French climate modeling tradition and provides important contributions to understanding global climate dynamics.",MIROC6:"Developed by a Japanese research consortium. This model represents Asian climate research expertise and contributes valuable insights, particularly for understanding climate patterns in the Asia-Pacific region.","MPI-ESM1-2-HR":"Developed by the Max Planck Institute in Germany. This high-resolution model provides detailed climate projections and is known for its sophisticated representation of Earth's climate system.","MRI-ESM2-0":"Developed by Japan's Meteorological Research Institute. This model contributes Japanese climate research expertise to the global ensemble, providing valuable perspectives on climate change projections."},ut=[{name:"Viridis",colors:["#440154","#3b528b","#21908d","#5dc863","#fde725"]},{name:"Magma",colors:["#000004","#3b0f70","#8c2981","#de4968","#fe9f6d"]},{name:"Cividis",colors:["#00204c","#31456a","#6b6d7f","#a59c8f","#fdea9b"]},{name:"Thermal",colors:["#04142f","#155570","#1fa187","#f8c932","#f16623"]}],x={page:{position:"relative",minHeight:"100vh",color:"white",overflow:"hidden",fontFamily:"Inter, system-ui, sans-serif"},bgLayer1:{position:"absolute",inset:0,background:"linear-gradient(135deg, #05070f, #0b1326)"},bgLayer2:{position:"absolute",inset:0,background:"radial-gradient(circle at 20% 20%, rgba(56,189,248,0.12), transparent 32%), radial-gradient(circle at 80% 10%, rgba(139,92,246,0.15), transparent 30%), radial-gradient(circle at 50% 70%, rgba(34,197,94,0.08), transparent 28%)"},bgOverlay:{position:"absolute",inset:0,background:"#050505",opacity:.35},branding:{position:"fixed",top:16,left:16,display:"flex",alignItems:"center",gap:12,padding:"8px 0",background:"transparent",border:"none",borderRadius:0,zIndex:"9999",boxShadow:"none",backdropFilter:"none",pointerEvents:"auto"},brandIcon:{width:38,height:38,position:"relative",display:"grid",placeItems:"center",filter:"drop-shadow(0 8px 18px rgba(0, 0, 0, 0.42))",transition:"transform 160ms ease, filter 160ms ease","--iris-x":"0px","--iris-y":"0px","--pupil-x":"0px","--pupil-y":"0px","--blink-open":"1"},brandSvg:{width:"100%",height:"100%",display:"block"},brandOutline:{stroke:"white",strokeWidth:5,strokeLinecap:"round",strokeLinejoin:"round",fill:"none",opacity:.92},brandLids:{transform:"translate(60px, 40px) scaleY(var(--blink-open, 1)) translate(-60px, -40px)",transformOrigin:"60px 40px",transition:"none"},brandClipRect:{transform:"translate(60px, 40px) scaleY(var(--blink-open, 1)) translate(-60px, -40px)",transformOrigin:"60px 40px",transition:"none"},brandIrisGroup:{transform:"translate(var(--iris-x, 0px), var(--iris-y, 0px))",transition:"none",transformBox:"fill-box",transformOrigin:"center center"},brandIris:{stroke:"white",strokeWidth:5,fill:"rgba(255, 255, 255, 0.08)"},brandPupilGroup:{transform:"translate(var(--pupil-x, 0px), var(--pupil-y, 0px))",transition:"none",transformOrigin:"center center"},brandEyeContent:{clipPath:"url(#brand-eye-clip)"},brandPupil:{fill:"white"},brandHighlight:{fill:"white",opacity:.92},brandName:{fontSize:18,fontWeight:700,letterSpacing:.6,color:"white",textTransform:"none",textShadow:"0 8px 20px rgba(0, 0, 0, 0.45)"},field:{minWidth:0,display:"flex",flexDirection:"column",gap:4},fieldLabel:{fontSize:11,letterSpacing:.5,color:"var(--text-secondary)",textTransform:"uppercase"},mapArea:{position:"absolute",inset:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:10,textAlign:"center",pointerEvents:"none",zIndex:1},drawOverlay:{position:"absolute",inset:0,background:"rgba(5, 10, 20, 0.28)",backdropFilter:"blur(1px)",pointerEvents:"none",zIndex:8},drawOverlayCanvas:{position:"absolute",inset:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:9},drawPrompt:{position:"absolute",top:16,left:"50%",transform:"translateX(-50%)",padding:"10px 14px",borderRadius:12,background:"rgba(15, 23, 42, 0.92)",border:"1px solid var(--border-medium)",boxShadow:"var(--shadow-elevated)",fontWeight:800,fontSize:13,color:"var(--text-primary)",pointerEvents:"none",zIndex:10,textAlign:"center"},drawPromptSub:{marginTop:4,fontSize:12,fontWeight:600,color:"var(--text-secondary)"},loadingIndicator:{position:"absolute",left:18,bottom:80,display:"flex",alignItems:"center",gap:12,padding:0,pointerEvents:"auto",zIndex:20,minWidth:160},loadingSpinner:{width:18,height:18,borderRadius:"50%",border:"2px solid rgba(255,255,255,0.18)",borderTop:"2px solid #34d399",animation:"sv-spin 1s linear infinite",flexShrink:0},loadingTextGroup:{display:"flex",flexDirection:"column",gap:4,alignItems:"flex-start",minWidth:0},loadingText:{fontSize:12.5,fontWeight:700,color:"var(--text-primary)",letterSpacing:.3},loadingSubtext:{fontSize:11.5,color:"var(--text-secondary)",letterSpacing:.2},loadingBar:{position:"relative",width:120,height:6,borderRadius:999,background:"rgba(255, 255, 255, 0.08)",overflow:"hidden"},loadingBarFill:{position:"absolute",inset:0,borderRadius:999,background:"linear-gradient(90deg, rgba(52, 211, 153, 0.9), rgba(125, 211, 252, 0.9))",transition:"width 140ms ease",width:"0%"},compareInfoWrap:{position:"fixed",right:24,bottom:88,display:"flex",alignItems:"center",pointerEvents:"auto",zIndex:1e4},compareInfoButton:{padding:0,background:"transparent",border:"none",color:"var(--text-primary)",fontWeight:700,fontSize:13,letterSpacing:.2,cursor:"pointer",textDecoration:"underline"},infoModalOverlay:{position:"fixed",inset:0,background:"transparent",backdropFilter:"none",zIndex:200,display:"flex",alignItems:"center",justifyContent:"center",padding:16},infoModal:{width:"min(480px, 92vw)",background:"rgba(12, 16, 24, 0.98)",border:"1px solid var(--border-default)",borderRadius:14,boxShadow:"var(--shadow-elevated)",color:"var(--text-primary)",padding:20,position:"relative",maxWidth:"520px"},infoModalHeader:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,marginBottom:12},infoModalTitle:{fontSize:16,fontWeight:900,letterSpacing:.2,background:"var(--gradient-accent)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",color:"transparent"},infoModalClose:{width:32,height:32,borderRadius:8,border:"none",background:"transparent",color:"var(--text-secondary)",cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",fontWeight:700},infoModalBody:{fontSize:14,lineHeight:1.6,color:"var(--text-primary)",display:"block",textAlign:"left",whiteSpace:"normal",wordBreak:"break-word"},infoModalFooter:{marginTop:18,display:"flex",justifyContent:"center"},infoModalConfirm:{padding:"10px 16px",borderRadius:10,border:"1px solid var(--accent-border)",background:"var(--gradient-primary)",color:"white",fontWeight:700,cursor:"pointer",boxShadow:"var(--shadow-combined)"},canvasToggle:{position:"fixed",top:14,display:"flex",alignItems:"center",gap:8,pointerEvents:"auto",zIndex:100,transition:"right 0.25s ease"},canvasSwitch:{position:"relative",display:"grid",gridTemplateColumns:"1fr 1fr",gap:0,padding:3,borderRadius:11,background:"var(--dark-bg)",border:"var(--border-base)",boxShadow:"var(--shadow-elevated)",zIndex:101},canvasIndicator:{position:"absolute",top:3,bottom:3,left:3,width:"calc(50% - 3px)",borderRadius:9,background:"var(--gradient-indicator)",boxShadow:"var(--shadow-canvas), var(--shadow-inset)",transition:"transform 180ms ease",zIndex:0,pointerEvents:"none"},canvasBtn:{width:40,height:40,borderRadius:9,border:"1px solid transparent",background:"var(--bg-transparent)",color:"var(--text-secondary)",cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center",transition:"color 120ms ease",position:"relative",zIndex:1},canvasBtnActive:{color:"white"},mapTitle:{fontSize:18,fontWeight:600},mapSubtitle:{fontSize:14,color:"var(--text-secondary)"},modeSwitch:{position:"relative",display:"grid",gridTemplateColumns:"1fr 1fr",gap:4,padding:2,borderRadius:10,border:"1px solid var(--border-subtle)",background:"var(--bg-subtle)",boxShadow:"none"},modeIndicator:{position:"absolute",top:2,bottom:2,left:2,width:"calc(50% - 2px)",borderRadius:8,background:"var(--gradient-mode-indicator)",boxShadow:"var(--shadow-combined)",transition:"transform 200ms ease",zIndex:0},modeBtn:{flex:1,padding:"8px 0",borderRadius:8,border:"none",color:"var(--text-secondary)",cursor:"pointer",transition:"all 0.15s ease",background:"var(--bg-transparent)",textAlign:"center",fontSize:12.5,fontWeight:700,letterSpacing:.2,outline:"none",boxShadow:"none",position:"relative",zIndex:1},modeBtnActive:{background:"var(--gradient-primary)",border:"none",color:"white",boxShadow:"var(--shadow-combined)"},tabSwitch:{position:"absolute",left:32,right:12,bottom:-8,display:"flex",gap:10,padding:"0 8px",alignItems:"flex-end",pointerEvents:"auto",zIndex:0},tabBtn:{borderRadius:"14px 14px 0 0",padding:"12px 18px",background:"var(--bg-strong)",color:"var(--text-secondary)",fontWeight:700,fontSize:13,letterSpacing:.35,cursor:"pointer",transition:"all 0.18s ease",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.06), 0 8px 18px rgba(0,0,0,0.32)",borderTop:"var(--border-base)",borderRight:"var(--border-base)",borderLeft:"var(--border-base)",borderBottom:"none",transform:"translateY(4px)"},tabBtnActive:{background:"var(--gradient-tab-active)",color:"white",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.12), 0 12px 26px rgba(0,0,0,0.42)",borderTop:"var(--border-active)",borderRight:"var(--border-active)",borderLeft:"var(--border-active)",borderBottom:"none",transform:"translateY(-4px)",zIndex:1},modeViewport:{overflow:"hidden",width:"100%",position:"relative",flex:1,minHeight:0,height:0},modeTrack:{display:"grid",gridTemplateColumns:"1fr 1fr",width:"200%",height:"100%",transition:"transform 220ms ease"},modePane:{width:"100%",height:"100%",paddingRight:4,overflowY:"auto",overflowX:"hidden",scrollbarGutter:"stable",minHeight:0,maxHeight:"100%"},chatBox:{display:"flex",alignItems:"center",gap:10,padding:"12px 14px",borderRadius:14,border:"1px solid var(--border-default)",background:"rgba(15,18,25,0.96)",boxShadow:"inset 0 1px 0 rgba(255,255,255,0.05), 0 8px 20px rgba(0,0,0,0.38)"},chatInput:{flex:1,padding:"12px 0",borderRadius:8,border:"none",background:"var(--bg-transparent)",color:"white",fontSize:14,lineHeight:1.4,outline:"none",minHeight:24},chatSend:{padding:"10px 14px",borderRadius:12,border:"1px solid var(--accent-border-strong)",background:"var(--gradient-primary)",color:"white",fontWeight:700,fontSize:14,letterSpacing:.1,cursor:"pointer",boxShadow:"0 10px 22px rgba(0,0,0,0.38), var(--shadow-inset)",transition:"transform 120ms ease, box-shadow 120ms ease"},chatStack:{display:"flex",flexDirection:"column",gap:12},chatLead:{fontSize:13,color:"var(--text-secondary)",lineHeight:1.45,marginTop:10},chatMessages:{display:"flex",flexDirection:"column",gap:10,padding:"4px 0 6px",paddingRight:0,width:"100%",boxSizing:"border-box"},chatBubble:{maxWidth:"100%",width:"fit-content",padding:"16px 16px",borderRadius:12,fontSize:13,lineHeight:1.4,boxShadow:"0 6px 14px rgba(0,0,0,0.3)",boxSizing:"border-box"},chatBubbleUser:{alignSelf:"flex-end",background:"var(--gradient-chat-user)",border:"1px solid rgba(125,211,252,0.45)",color:"white",marginRight:26},chatBubbleAgent:{alignSelf:"flex-start",background:"rgba(20,24,31,0.95)",border:"1px solid var(--border-medium)",color:"var(--text-primary)"},sectionTitle:{fontSize:13,fontWeight:700,color:"var(--text-primary)",letterSpacing:.3,textTransform:"uppercase"},paramGrid:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:10},range:{width:"100%",background:"var(--bg-transparent)",appearance:"none",WebkitAppearance:"none",height:10,outline:"none",padding:0,margin:0},resolutionRow:{display:"flex",alignItems:"center",gap:12},resolutionValue:{fontSize:12.5,color:"var(--text-secondary)",minWidth:60,textAlign:"right"},chartPanel:{width:"min(1200px, 100%)",background:"transparent",border:"none",borderRadius:0,padding:0,boxShadow:"none",backdropFilter:"none"},chartHeader:{textAlign:"center",marginBottom:12},chartTitle:{fontSize:18,fontWeight:800,color:"var(--text-primary)"},chartPlotWrapper:{width:"100%",minHeight:360,background:"transparent",border:"none",borderRadius:0,padding:0,position:"relative"},chartEmpty:{textAlign:"center",color:"var(--text-secondary)",padding:"40px 16px",lineHeight:1.6},chartError:{color:"#fca5a5",background:"rgba(248,113,113,0.08)",border:"1px solid rgba(248,113,113,0.35)",borderRadius:12,padding:14,fontSize:13,lineHeight:1.5},chipRow:{display:"flex",flexWrap:"wrap",gap:8},chip:{padding:"8px 10px",borderRadius:12,border:"1px solid var(--border-medium)",background:"rgba(255,255,255,0.04)",color:"var(--text-primary)",cursor:"pointer",fontSize:12.5,fontWeight:700,letterSpacing:.2,transition:"all 140ms ease"},chipActive:{borderColor:"rgba(167,139,250,0.65)",background:"rgba(167,139,250,0.16)",boxShadow:"0 0 0 1px rgba(167,139,250,0.35)"},chartLegend:{display:"flex",gap:12,flexWrap:"wrap",alignItems:"center",marginTop:10,fontSize:12,color:"var(--text-secondary)"}},o={mode:"Explore",panelTab:"Manual",sidebarOpen:!0,canvasView:"map",scenario:Ft[0],model:yt[0],variable:Pt[0],date:"2000-01-01",palette:ut[0].name,resolution:2,selectedUnit:ze(Pt[0]).label,chartMode:"single",chartDate:"2026-01-16",chartRangeStart:"2020-01-01",chartRangeEnd:"2077-06-28",chartVariable:Pt[0],chartUnit:ze(Pt[0]).label,chartScenarios:["SSP245","SSP370","SSP585"],chartModels:[...yt],chartDropdown:{scenariosOpen:!1,modelsOpen:!1},chartLoadingProgress:{total:0,done:0},chartSamples:[],chartBoxes:null,chartRangeSeries:null,chartLoading:!1,chartError:null,chartLocation:"World",chartLocationName:null,chartLocationSearchQuery:"",chartLocationSearchResults:[],chartLocationSearchLoading:!1,chartLocationSearchError:null,chartPolygon:null,chartPoint:null,drawState:{active:!1,points:[],previewPoint:null},pointSelectActive:!1,chatInput:"",chatMessages:[],compareMode:"Scenarios",availableModels:[],compareScenarioA:"SSP245",compareScenarioB:"SSP585",compareModelA:yt[0],compareModelB:yt[1]??yt[0],compareDateStart:"1962-06-28",compareDateEnd:"2007-06-28",isLoading:!1,loadingProgress:0,dataError:null,currentData:null,apiAvailable:null,dataMin:null,dataMax:null,timeRange:null,metaData:void 0,compareInfoOpen:!1};let qn=null,Tt=null,be=null,nt=null,nn=null,Qt=null,zt=null,Zt=null,Ct=null,re=null,rn=0;const Vd=500;function qd(t){return t.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}function y(t){return Object.entries(t).filter(([,e])=>e!=null).map(([e,n])=>{const r=e.startsWith("--")?e:qd(e),a=typeof n=="number"?`${n}px`:String(n);return`${r}:${a}`}).join(";")}function st(...t){return t.reduce((e,n)=>n?{...e,...n}:e,{})}function ge(t){return t.replace(/[&<>"']/g,e=>{switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";default:return e}})}function ae(t){const e=new Date(t);return Number.isNaN(e.getTime())?t:e.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}function So(t,e){return e?.variable_metadata?.[t]?.name||e?.variable_metadata?.[t]?.description||t}function Hd(t){const e=So(t.variable,t.metaData),n=t.selectedUnit||t.metaData?.variable_metadata?.[t.variable]?.unit||"",r=n?`${n}`:"the dataset's native units";switch(t.compareMode){case"Dates":{const a=ae(t.compareDateStart),i=ae(t.compareDateEnd);return{title:"Comparing two dates",paragraphs:[`We are comparing ${e} on ${a} versus ${i} under the ${t.scenario} scenario using the ${t.model} model.`,`Values on the map represent ${i} minus ${a} in ${r}. A value of X means ${e} was X ${n||""} higher on ${i} than on ${a} (negative values mean it was lower).`]}}case"Models":{const a=ae(t.date);return{title:"Comparing two models",paragraphs:[`We are comparing ${e} between ${t.compareModelB} and ${t.compareModelA} on ${a} within the ${t.scenario} scenario.`,`Each value shows ${t.compareModelB} minus ${t.compareModelA} in ${r}. Positive numbers mean ${e} is higher in ${t.compareModelB}; negative means it is higher in ${t.compareModelA}.`]}}default:{const a=ae(t.date),i=t.compareScenarioA,s=t.compareScenarioB;return{title:"Comparing two scenarios",paragraphs:[`We are comparing ${e} for ${s} versus ${i} on ${a} using the ${t.model} model.`,`Values show ${s} minus ${i} in ${r}. A value of X means ${e} is X ${n||""} higher under ${s} than under ${i}; negative values mean it is lower.`]}}}}function Wd(t){if(t.mode!=="Compare"||t.canvasView!=="map")return"";const e=Hd(t),n=e.paragraphs.map((l,u)=>{const f=u===e.paragraphs.length-1?"0":"0 0 12px 0",m=l.replace(/(\bX\b|ΔX)/g,'<span style="color: var(--accent-purple);">$1</span>');return`<p style="display:block; margin:${f}; line-height:1.6; white-space: normal; word-break: break-word;">${m}</p>`}).join(""),r=t.sidebarOpen?gt+24:24,a=t.mode==="Compare"&&t.compareMode==="Dates"?120:88,i=st(x.infoModalOverlay,{left:"0",right:"0",width:"100%",justifyContent:"center",paddingLeft:0}),s=st(x.infoModal,{alignSelf:"center",marginLeft:"auto",marginRight:"auto"}),c=t.compareInfoOpen?`
      <div data-role="compare-info-overlay" class="compare-info-overlay" style="${y(i)}">
        <div style="${y(s)}" role="dialog" aria-modal="true" aria-label="${e.title}">
          <div style="${y(x.infoModalHeader)}">
            <div style="${y(x.infoModalTitle)}">${e.title}</div>
            <button type="button" data-action="close-compare-info" style="${y(x.infoModalClose)}" aria-label="Close info dialog">✕</button>
          </div>
          <div style="${y(x.infoModalBody)}">
            ${n}
          </div>
          <div style="${y(x.infoModalFooter)}">
            <button type="button" data-action="close-compare-info" style="${y(x.infoModalConfirm)}">Got it</button>
          </div>
        </div>
      </div>
    `:"";return`
      <div data-role="compare-info-trigger" style="${y(st(x.compareInfoWrap,{right:r,bottom:a}))}">
        <button type="button" data-action="open-compare-info" style="${y(x.compareInfoButton)}">
          What am I seeing?
        </button>
      </div>
      ${c}
    `}async function Yd(){try{const t=await Md();o.apiAvailable=t}catch{o.apiAvailable=!1}}function Xd(t){if(t==="Historical")return"2000-01-01";const e=new Date,n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return n<2015?"2015-01-01":n>2100?"2100-12-31":`${n}-${r}-${a}`}function jt(t){return t==="Historical"?{start:"1950-01-01",end:"2014-12-31"}:{start:"2015-01-01",end:"2100-12-31"}}function ye(t,e){const n=jt(e),r=new Date(t),a=new Date(n.start),i=new Date(n.end);return r<a?n.start:r>i?n.end:t}function Gd(t){let e=1/0,n=-1/0;for(let r=0;r<t.length;r++){const a=t[r];isFinite(a)&&(e=Math.min(e,a),n=Math.max(n,a))}if(!isFinite(e)||!isFinite(n))throw new Error("No valid numeric values returned from dataset.");return{min:e,max:n}}function pa(t,e){let n=0,r=0;for(let a=0;a<t.length;a++){const i=t[a];if(!isFinite(i))continue;const s=e==="hurs"?Math.min(i,100):i;n+=s,r+=1}if(!r)throw new Error("No valid numeric values returned from dataset.");return n/r}function Kd(t,e){let n=!1;for(let r=0,a=e.length-1;r<e.length;a=r++){const i=e[r].lon,s=e[r].lat,c=e[a].lon,l=e[a].lat;s>t.lat!=l>t.lat&&t.lon<(c-i)*(t.lat-s)/(l-s+Number.EPSILON)+i&&(n=!n)}return n}function ga(t,e,n,r){const[a,i]=n,s=360/i,c=150/a;let l=0,u=0;for(let d=0;d<a;d++){const f=90-d*c-c/2;for(let m=0;m<i;m++){const p=m*s+s/2,$=p>180?p-360:p,A=(a-1-d)*i+m,L=t[A];if(!isFinite(L))continue;const M=e==="hurs"?Math.min(L,100):L;Kd({lat:f,lon:$},r)&&(l+=M,u+=1)}}if(!u)throw new Error("The selected region does not contain valid data points.");return l/u}function jd(t,e,n=.75){const r=t.lat-e.lat,a=t.lon-e.lon;return Math.hypot(r,a)<=n}function ya(t,e,n,r){const[a,i]=n,c=((r.lon+360)%360+360)%360/360*i-.5,l=(90-r.lat)/150*a-.5,u=(L,M,v)=>Math.min(v,Math.max(M,L)),d=u(Math.round(c),0,i-1),f=u(Math.round(l),0,a-1),m=(L,M)=>(a-1-M)*i+L,p=(L,M)=>{const v=(L%i+i)%i,D=u(M,0,a-1),_=m(v,D),C=t[_];return Number.isFinite(C)?C:null};let $=p(d,f);if($===null){let M=null;for(let v=1;v<=3&&M===null;v++)for(let D=-v;D<=v;D++){for(let _=-v;_<=v;_++){if(Math.abs(_)!==v&&Math.abs(D)!==v)continue;const C=p(d+_,f+D);if(C!==null){M=C;break}}if(M!==null)break}$=M}if($===null)throw new Error("No valid data at the selected point.");const A=e==="hurs"?Math.min($,100):$;if(!Number.isFinite(A))throw new Error(`Invalid value at point: ${A}`);return A}function _e(){return{active:!1,points:[],previewPoint:null}}function Qd(t){be||(be=e=>{e.key==="Enter"&&o.drawState.active&&(e.preventDefault(),t())},window.addEventListener("keydown",be))}function Mo(){be&&(window.removeEventListener("keydown",be),be=null)}function Er(t){const e=o.drawState.active||o.pointSelectActive,n=o.metaData?.variable_metadata[o.variable]?.unit||"";Ed(t,o.currentData,n,o.variable,o.selectedUnit,{drawMode:e,onDrawClick:o.pointSelectActive?of:af,onDrawMove:o.drawState.active?rf:void 0,onTransform:()=>{An(),va()}}),va()}function An(){if(!nt)return;const t=nt.querySelector("#draw-overlay-canvas"),e=Tt||nt.querySelector("#map-canvas");if(!t||!e)return;const n=e.getBoundingClientRect(),r=window.devicePixelRatio||1;t.width=n.width*r,t.height=n.height*r,t.style.width=`${n.width}px`,t.style.height=`${n.height}px`;const a=t.getContext("2d");if(!a)return;a.save(),a.scale(r,r),a.clearRect(0,0,n.width,n.height);const i=[...o.drawState.points],s=o.drawState.previewPoint?[...i,o.drawState.previewPoint]:i,c=[];if(s.forEach(l=>{const u=Cd(e,l.lon,l.lat);u&&c.push(u)}),!c.length){a.restore();return}a.lineWidth=2,a.strokeStyle="#34d399",a.fillStyle="rgba(52,211,153,0.18)",a.beginPath(),a.moveTo(c[0].x,c[0].y);for(let l=1;l<c.length;l++)a.lineTo(c[l].x,c[l].y);c.length>2&&(a.closePath(),a.fill()),a.stroke(),c.forEach(({x:l,y:u},d)=>{a.beginPath(),a.fillStyle=d===0?"#10b981":"#34d399",a.arc(l,u,4,0,Math.PI*2),a.fill(),a.strokeStyle="#0f172a",a.lineWidth=1,a.stroke()}),a.restore()}function Zd(){return o.drawState.active?`
      <div style="${y(x.drawOverlay)}"></div>
      <canvas
        id="draw-overlay-canvas"
        style="${y(x.drawOverlayCanvas)}"
      ></canvas>
      <div style="${y(x.drawPrompt)}">
        <div>Draw the region you want to explore</div>
        <div style="${y(x.drawPromptSub)}">
          Click to add points · Enter or click first point to finish
        </div>
      </div>
    `:""}function va(){if(!nt)return;const t=nt.querySelector("#point-overlay-marker"),e=Tt||nt.querySelector("#map-canvas");!t||!e||!o.pointSelectActive||(t.style.left="0px",t.style.top="0px",t.style.right="0px",t.style.bottom="0px",t.style.width="100%",t.style.height="100%")}function Jd(){return o.pointSelectActive?`
      <div style="${y(x.drawOverlay)}"></div>
      <div
        id="point-overlay-marker"
        style="${y({position:"absolute",inset:0,pointerEvents:"none",zIndex:9})}"
      ></div>
      <div style="${y(x.drawPrompt)}">
        <div>Click a point to sample</div>
        <div style="${y(x.drawPromptSub)}">
          The chart will load data for this single location
        </div>
      </div>
    `:""}function xa(){o.chartLocation="Draw",o.chartPolygon=null,o.chartLocationName=null,o.chartLocationSearchResults=[],o.chartLocationSearchQuery="",o.chartLocationSearchError=null,o.chartLocationSearchLoading=!1,o.chartError=null,o.pointSelectActive=!1,o.drawState={active:!0,points:[],previewPoint:null},o.canvasView="map",Qd($o),H(),$t()}function Dn(){o.drawState=_e(),Mo()}function ba(){o.chartLocation="Point",o.chartPolygon=null,o.chartPoint=null,o.chartLocationName=null,o.chartLocationSearchResults=[],o.chartLocationSearchQuery="",o.chartLocationSearchError=null,o.chartLocationSearchLoading=!1,o.chartError=null,o.drawState=_e(),o.chartUnit=ze(o.chartVariable).label,o.pointSelectActive=!0,o.canvasView="map",H(),$t()}function _n(){o.pointSelectActive=!1}async function tf(t){const e=t.trim();if(!e)return[];const n=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(e)}&limit=5&addressdetails=1`,r=await fetch(n,{headers:{Accept:"application/json","User-Agent":"climate-visualization-app/1.0"}});if(!r.ok)throw new Error("Location search failed. Please try again.");return(await r.json()).map(i=>({displayName:i.display_name,lat:Number(i.lat),lon:Number(i.lon)})).filter(i=>Number.isFinite(i.lat)&&Number.isFinite(i.lon))}function ef(t){re!==null&&(window.clearTimeout(re),re=null),o.chartLocation="Search",o.chartPoint={lat:t.lat,lon:t.lon},o.chartLocationName=t.displayName,o.chartLocationSearchError=null,o.chartLocationSearchResults=[],o.chartLocationSearchLoading=!1,o.chartLocationSearchQuery="",o.chartError=null,o.chartPolygon=null,o.pointSelectActive=!1,o.drawState=_e(),o.canvasView="chart",Dn(),_n(),H(),Yt()}async function nf(t){const e=t.trim(),n=++rn;if(o.chartLocation="Search",o.chartLocationSearchQuery=t,o.chartLocationSearchError=null,o.chartLocationSearchResults=[],o.chartLocationName=null,o.chartPoint=null,o.chartError=null,o.chartPolygon=null,o.pointSelectActive=!1,o.drawState=_e(),o.canvasView="chart",Dn(),_n(),!e){o.chartLocationSearchLoading=!1,o.chartLocationSearchResults=[],o.chartLocationSearchError=null,H();return}o.chartLocationSearchLoading=!0,H();try{const r=await tf(e);if(n!==rn)return;o.chartLocationSearchResults=r,r.length||(o.chartLocationSearchError="No places found for that query.")}catch(r){if(n!==rn)return;o.chartLocationSearchError=r instanceof Error?r.message:"Search failed."}finally{if(n!==rn)return;o.chartLocationSearchLoading=!1,H()}}function rf(t){o.drawState.active&&(o.drawState={...o.drawState,previewPoint:t},An())}function af(t){if(!o.drawState.active)return;const e=o.drawState.points;if(e.length>=3&&jd(t,e[0])){$o();return}o.drawState={...o.drawState,points:[...e,t],previewPoint:t},An()}function of(t){o.pointSelectActive&&(o.chartPoint=t,o.pointSelectActive=!1,o.chartError=null,o.canvasView="chart",H(),Yt())}function $o(){if(o.drawState.active){if(o.drawState.points.length<3){o.chartError="Draw at least three points to define a region.",H();return}o.chartPolygon=o.drawState.points,o.drawState=_e(),Mo(),o.chartError=null,o.canvasView="chart",H(),Yt()}}function To(t){const e=t.filter(s=>Number.isFinite(s)).sort((s,c)=>s-c);if(!e.length)throw new Error("No valid values available to build chart statistics.");const n=Rn(e,.25)??e[0],r=Rn(e,.5)??e[Math.floor(e.length/2)],a=Rn(e,.75)??e[e.length-1],i=Vo(e)??e[0];return{min:e[0],q1:n,median:r,q3:a,max:e[e.length-1],mean:i,count:e.length}}function Do(t,e,n){const r=new Map;return t.forEach(a=>{const i=r.get(a.scenario)??[];i.push(a),r.set(a.scenario,i)}),Array.from(r.entries()).map(([a,i])=>{const s=i.map(l=>{const u=xe(l.rawValue,e,n);return{...l,value:u}}),c=To(s.map(l=>l.value));return{scenario:a,dateUsed:i[0]?.dateUsed??"",samples:s,stats:c}})}function sf(t,e,n=50){const r=J(t),a=J(e);if(Number.isNaN(r.getTime())||Number.isNaN(a.getTime())||n<=0)return[];let i=r,s=a;i>s&&([i,s]=[s,i]);const c=1440*60*1e3,u=Math.floor((s.getTime()-i.getTime())/c)+1,d=[];if(u<=n){for(let p=0;p<u;p++){const $=new Date(i.getTime()+p*c);d.push($.toISOString().slice(0,10))}return d}const f=(s.getTime()-i.getTime())/(n-1),m=new Set;for(let p=0;p<n;p++){const $=new Date(i.getTime()+f*p);m.add($.toISOString().slice(0,10))}return m.add(s.toISOString().slice(0,10)),Array.from(m).sort((p,$)=>J(p).getTime()-J($).getTime())}function cf(t,e,n=50){const r=J(t),a=J(e);if(Number.isNaN(r.getTime())||Number.isNaN(a.getTime())||n<=0)return[];let i=r,s=a;i>s&&([i,s]=[s,i]);const c=1440*60*1e3;if(Math.floor((s.getTime()-i.getTime())/c)<=120)return sf(i.toISOString().slice(0,10),s.toISOString().slice(0,10),n);const u=i.getDate(),d=i.getMonth(),f=i.getFullYear(),m=s.getFullYear(),p=m-f+1,$=Math.min(n,p),A=new Set;if($===1)A.add(f);else{const v=(p-1)/($-1);for(let D=0;D<$;D++){const _=Math.round(f+v*D);A.add(Math.min(m,Math.max(f,_)))}}const L=[];return Array.from(A).sort((v,D)=>v-D).forEach(v=>{const D=new Date(v,d+1,0).getDate(),_=Math.min(u,D),C=new Date(v,d,_);let w=C;C<i&&(w=i),C>s&&(w=s),L.push(w.toISOString().slice(0,10))}),Array.from(new Set(L)).sort((v,D)=>J(v).getTime()-J(D).getTime())}function _o(t,e,n){const r=new Map;return t.forEach(a=>{const i=r.get(a.scenario)??[];i.push(a),r.set(a.scenario,i)}),Array.from(r.entries()).map(([a,i])=>{const s=new Map;i.forEach(l=>{const u=xe(l.rawValue,e,n),d=s.get(l.dateUsed)??[];d.push({...l,value:u}),s.set(l.dateUsed,d)});const c=Array.from(s.entries()).map(([l,u])=>({date:l,samples:u,stats:To(u.map(d=>d.value))})).sort((l,u)=>J(l.date).getTime()-J(u.date).getTime());return{scenario:a,points:c}})}function lf(t,e,n,r){const a=De(t),i=De(e);if(!a||!i)throw new Error("Comparison data is missing numeric values.");if(a.length!==i.length||t.shape[0]!==e.shape[0]||t.shape[1]!==e.shape[1])throw new Error("Comparison datasets have mismatched shapes.");const s=new Float32Array(a.length);let c=1/0,l=-1/0;for(let d=0;d<a.length;d++){const f=a[d],m=i[d];if(!isFinite(f)||!isFinite(m)){s[d]=NaN;continue}const p=m-f;s[d]=p,isFinite(p)&&(c=Math.min(c,p),l=Math.max(l,p))}if(!isFinite(c)||!isFinite(l))throw new Error("Comparison produced no valid numeric values.");return{data:{...t,data:s,data_encoding:"none",dtype:"float32",model:`${r} minus ${n}`,time:`${e.time} minus ${t.time}`,scenario:`${e.scenario} minus ${t.scenario}`,metadata:{...t.metadata,comparison:{labelA:n,labelB:r}}},min:c,max:l}}function lt(t,e=!1){const n=Math.max(0,Math.min(100,Math.round(t)));n!==o.loadingProgress&&(o.loadingProgress=n,(o.isLoading||e)&&H())}async function uf(t,e){let n=Mt({variable:o.variable,date:o.date,model:o.model,scenario:o.scenario,resolution:o.resolution}),r=n,a="",i="";switch(o.compareMode){case"Scenarios":{const l=o.compareScenarioA,u=o.compareScenarioB,d=ye(o.date,t);d!==o.date&&(o.date=d),n=Mt({variable:o.variable,date:d,model:o.model,scenario:l,resolution:o.resolution}),r=Mt({variable:o.variable,date:d,model:o.model,scenario:u,resolution:o.resolution}),a=l,i=u;break}case"Models":{const l=ye(o.date,t);l!==o.date&&(o.date=l),n=Mt({variable:o.variable,date:l,model:o.compareModelA,scenario:o.scenario,resolution:o.resolution}),r=Mt({variable:o.variable,date:l,model:o.compareModelB,scenario:o.scenario,resolution:o.resolution}),a=o.compareModelA,i=o.compareModelB;break}case"Dates":{const l=ye(o.compareDateStart,o.scenario),u=ye(o.compareDateEnd,o.scenario);l!==o.compareDateStart&&(o.compareDateStart=l),u!==o.compareDateEnd&&(o.compareDateEnd=u),n=Mt({variable:o.variable,date:l,model:o.model,scenario:o.scenario,resolution:o.resolution}),r=Mt({variable:o.variable,date:u,model:o.model,scenario:o.scenario,resolution:o.resolution}),a=l,i=u;break}}const s=await qe(n);e?.(65);const c=await qe(r);return e?.(85),lf(s,c,a,i)}async function Yt(){if(o.canvasView==="chart"){if(o.chartLocation==="Draw"&&(!o.chartPolygon||o.chartPolygon.length<3)){o.chartError="Draw a region on the map to load chart data.",o.chartBoxes=null,o.chartRangeSeries=null,o.chartSamples=[],o.chartLoading=!1,o.chartLoadingProgress={total:0,done:0},H();return}if(o.chartLocation==="Point"&&!o.chartPoint){o.chartError="Click a point on the map to load chart data.",o.chartBoxes=null,o.chartRangeSeries=null,o.chartSamples=[],o.chartLoading=!1,o.chartLoadingProgress={total:0,done:0},H();return}if(o.chartLocation==="Search"&&!o.chartPoint){o.chartError=o.chartLocationSearchLoading?"Searching for a place...":"Search for a place and pick a result.",o.chartBoxes=null,o.chartRangeSeries=null,o.chartSamples=[],o.chartLoading=!1,o.chartLoadingProgress={total:0,done:0},H();return}o.chartLoading=!0,o.chartError=null,lt(5,!0),o.chartLoadingProgress={total:0,done:0},H();try{const t=o.metaData??await po();o.metaData||(o.metaData=t);const e=t?.scenarios?.length?Array.from(new Set(t.scenarios.map(Lr))):Ft,n=t?.models?.length?t.models:yt,r=(o.chartScenarios.length?o.chartScenarios:e).filter(s=>e.includes(s)),a=(o.chartModels.length?o.chartModels:n).filter(s=>n.includes(s));if(!r.length||!a.length){o.chartError="Select at least one scenario and one model.",o.chartSamples=[],o.chartBoxes=null,o.chartRangeSeries=null,o.chartLoading=!1,o.chartLoadingProgress={total:0,done:0},H();return}const i=Cr(r);if(o.chartMode==="single"){const s=Wt(o.chartDate,i);s!==o.chartDate&&(o.chartDate=s);const c=r.length*a.length;o.chartLoadingProgress={total:c,done:0},o.chartRangeSeries=null,H();const l=[];for(const u of r){const d=Wt(o.chartDate,jt(u));for(const f of a){const m=o.chartLoadingProgress.done;lt(Math.min(95,Math.round((m+.1)/c*100)));const p=Mt({variable:o.chartVariable,date:d,model:f,scenario:u,resolution:1}),$=await qe(p),A=o.chartLoadingProgress.done+1;o.chartLoadingProgress={total:c,done:A},lt(Math.min(98,Math.round(A/c*100))),H();const L=De($);if(!L)throw new Error("No data returned for chart request.");const M=o.chartLocation==="Draw"&&o.chartPolygon&&o.chartPolygon.length>=3?ga(L,o.chartVariable,$.shape,o.chartPolygon):(o.chartLocation==="Point"||o.chartLocation==="Search")&&o.chartPoint?ya(L,o.chartVariable,$.shape,o.chartPoint):pa(L,o.chartVariable);l.push({scenario:u,model:f,rawValue:M,dateUsed:d})}}o.chartSamples=l,o.chartBoxes=Do(l,o.chartVariable,o.chartUnit),o.chartLoadingProgress={total:c,done:c},lt(100)}else{let s=Wt(o.chartRangeStart,i),c=Wt(o.chartRangeEnd,i);if(J(s)>J(c)&&([s,c]=[c,s]),o.chartRangeStart=s,o.chartRangeEnd=c,!Fd){const l=cf(s,c,50);if(!l.length){o.chartError="Enter a valid date range within the selected scenarios.",o.chartSamples=[],o.chartBoxes=null,o.chartRangeSeries=null,o.chartLoading=!1,o.chartLoadingProgress={total:0,done:0},H();return}const u=r.length*a.length*l.length;o.chartLoadingProgress={total:u,done:0},o.chartBoxes=null,H();const d=[];for(const f of r){const m=jt(f);for(const p of l){const $=Wt(p,m);for(const A of a){const L=o.chartLoadingProgress.done;lt(Math.min(95,Math.round((L+.1)/u*100)));const M=Mt({variable:o.chartVariable,date:$,model:A,scenario:f,resolution:1}),v=await qe(M),D=o.chartLoadingProgress.done+1;o.chartLoadingProgress={total:u,done:D},lt(Math.min(98,Math.round(D/u*100))),H();const _=De(v);if(!_)throw new Error("No data returned for chart request.");const C=o.chartLocation==="Draw"&&o.chartPolygon&&o.chartPolygon.length>=3?ga(_,o.chartVariable,v.shape,o.chartPolygon):(o.chartLocation==="Point"||o.chartLocation==="Search")&&o.chartPoint?ya(_,o.chartVariable,v.shape,o.chartPoint):pa(_,o.chartVariable);d.push({scenario:f,model:A,rawValue:C,dateUsed:$})}}}o.chartSamples=d,o.chartRangeSeries=_o(d,o.chartVariable,o.chartUnit),o.chartLoadingProgress={total:u,done:u},lt(100)}}}catch(t){o.chartError=t instanceof Gt&&t.statusCode||t instanceof Error?t.message:String(t),o.chartSamples=[],o.chartBoxes=null,o.chartRangeSeries=null,o.chartLoadingProgress={total:1,done:1}}finally{o.chartLoading=!1,H()}}}async function $t(){if(console.log("fetching"),o.canvasView==="map"){o.isLoading=!0,lt(5,!0),o.dataError=null;try{const t=await po();o.metaData=t,o.availableModels=t.models,lt(20);const e=o.mode==="Compare"&&o.compareMode==="Scenarios"?o.compareScenarioA:o.scenario;o.timeRange=jt(e),lt(30);const n=o.mode==="Compare"?await uf(e,lt):await(async()=>{lt(40);const r=ye(o.date,e);r!==o.date&&(o.date=r);const a=Mt({variable:o.variable,date:r,model:o.model,scenario:o.scenario,resolution:o.resolution});lt(55);let i=await qe(a);lt(80);let s=De(i);if(!s)throw new Error("No data returned for the selected parameters.");if(o.variable==="hurs"){const u=new Float32Array(s.length);let d=1/0,f=-1/0;for(let m=0;m<s.length;m++){const p=s[m];if(!isFinite(p)){u[m]=NaN;continue}const $=Math.min(p,100);u[m]=$,d=Math.min(d,$),f=Math.max(f,$)}return i={...i,data:u,data_encoding:"none"},s=u,{data:i,min:d,max:f}}const{min:c,max:l}=Gd(s);return lt(95),{data:i,min:c,max:l}})();if(o.currentData=n.data,o.dataMin=n.min,o.dataMax=n.max,lt(100),o.isLoading=!1,H(),nt){const r=nt.querySelector("#map-canvas");r&&Er(r)}}catch(t){t instanceof Gt&&t.statusCode?o.dataError=t.message:o.dataError=t instanceof Error?t.message:String(t),o.isLoading=!1,lt(0,!0),o.currentData=null,o.dataMin=null,o.dataMax=null,H()}}}function df(){return`
      <div style="${y(x.branding)}">
        <div data-role="brand-eye" style="${y(x.brandIcon)}">
          <svg viewBox="0 0 120 80" style="${y(x.brandSvg)}" aria-hidden="true">
            <defs>
              <clipPath id="brand-eye-clip">
                <rect x="0" y="0" width="120" height="80" style="${y(x.brandClipRect)}" />
              </clipPath>
            </defs>
            <g style="${y(x.brandLids)}">
              <path
                d="M10 40c10-15 30-30 50-30s40 15 50 30c-10 15-30 30-50 30S20 55 10 40Z"
                style="${y(x.brandOutline)}"
              />
            </g>
            <g data-role="brand-iris" style="${y(st(x.brandIrisGroup,x.brandEyeContent))}">
              <circle cx="60" cy="40" r="20" style="${y(x.brandIris)}" />
              <g data-role="brand-pupil" style="${y(x.brandPupilGroup)}">
                <circle cx="60" cy="40" r="10" style="${y(x.brandPupil)}" />
                <circle cx="72" cy="30" r="4" style="${y(x.brandHighlight)}" />
              </g>
            </g>
          </svg>
        </div>
        <span style="${y(x.brandName)}">Polyoracle</span>
      </div>
    `}function H(){if(!nt)return;const t=!!nt.querySelector('.custom-select-wrapper[data-key="chartLocation"]')?.classList.contains("open"),e=(o.resolution-1)/2*100,n=o.mode==="Explore"?"translateX(0%)":"translateX(-50%)",r=o.mode==="Explore"?"translateX(0%)":"translateX(100%)",a=o.canvasView==="map"?"translateX(0%)":"translateX(100%)",i=o.panelTab==="Manual"?"translateX(0%)":"translateX(-50%)";if(nt.innerHTML=`
    <div style="${y(x.page)}">
      <div style="${y(x.bgLayer1)}"></div>
      <div style="${y(x.bgLayer2)}"></div>
      <div style="${y(x.bgOverlay)}"></div>
      ${df()}
        ${o.canvasView==="map"&&o.dataMin!==null&&o.dataMax!==null?gd(o.variable,o.dataMin,o.dataMax,o.metaData,o.selectedUnit,o.mode==="Compare"):""}
      <div style="${y(x.mapArea)}">
        ${o.canvasView==="map"?`
              <canvas
                id="map-canvas"
                style="position: absolute; inset: 0; width: 100%; height: 100%; object-fit: contain; pointer-events: auto;"
              ></canvas>
              ${Zd()}
              ${Jd()}
              ${ff()}
              ${o.dataError?`<div style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.8); z-index: 10;">
                      <div style="text-align: center; max-width: 600px; padding: 20px;">
                        <div style="${y(x.mapTitle)}">Error loading data</div>
                        <div style="${y(x.mapSubtitle)}">${o.dataError}</div>
                        ${o.apiAvailable===!1?`<div style="${y(st(x.mapSubtitle,{marginTop:12,fontSize:12}))}">
                                Make sure the Python API server is running. Check the terminal for connection details.
                              </div>`:""}
                      </div>
                    </div>`:""}
              ${!o.isLoading&&!o.dataError&&!o.currentData?`<div style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.5); z-index: 5;">
                      <div style="text-align: center;">
                        <div style="${y(x.mapTitle)}">No data loaded</div>
                        <div style="${y(x.mapSubtitle)}">
                          Adjust parameters to load climate data
                        </div>
                      </div>
                    </div>`:""}
            `:mf()}
      </div>

      <aside data-role="sidebar" class="sidebar" style="width: ${gt}px; transform: ${o.sidebarOpen?"translateX(0)":`translateX(${gt+24}px)`}; pointer-events: ${o.sidebarOpen?"auto":"none"}" aria-hidden="${!o.sidebarOpen}">
        <div class="sidebar-top">
          <div class="sidebar-brand">
            <div class="logo-dot"></div>
          </div>
          <div class="tab-switch" style="${y(x.tabSwitch)}">
            ${["Manual","Chat"].map(l=>pf(l,o.panelTab===l?x.tabBtnActive:void 0,"panel-tab")).join("")}
          </div>
        </div>

        <div class="sidebar-content">
          <div class="tab-viewport">
            <div data-role="tab-track" class="tab-track" style="transform: ${i}">
              <div class="tab-pane">
                ${o.canvasView==="map"?gf({modeTransform:n,resolutionFill:e,modeIndicatorTransform:r}):yf()}
              </div>
              <div class="tab-pane">
                ${vf()}
              </div>
            </div>
          </div>
        </div>
      </aside>

      <div data-role="canvas-toggle" style="${y({...x.canvasToggle,right:o.sidebarOpen?gt+24:24})}">
        <div style="${y(x.canvasSwitch)}">
          <div data-role="canvas-indicator" style="${y({...x.canvasIndicator,transform:a})}"></div>
          <button
            type="button"
            aria-label="Show map canvas"
            data-action="set-canvas"
            data-value="map"
            style="${y(st(x.canvasBtn,o.canvasView==="map"?x.canvasBtnActive:void 0))}"
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.6">
              <path d="M4 6.5 9 4l6 2.5L20 4v14l-5 2.5L9 18 4 20.5V6.5Z" />
              <path d="m9 4v14m6-11.5v14" />
            </svg>
          </button>
          <button
            type="button"
            aria-label="Show chart canvas"
            data-action="set-canvas"
            data-value="chart"
            style="${y(st(x.canvasBtn,o.canvasView==="chart"?x.canvasBtnActive:void 0))}"
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.8">
              <path d="M4 18h16" />
              <path d="M6 18 11 9l4 5 3-6" />
              <circle cx="6" cy="18" r="1.2" />
              <circle cx="11" cy="9" r="1.2" />
              <circle cx="15" cy="14" r="1.2" />
              <circle cx="18" cy="8" r="1.2" />
            </svg>
          </button>
        </div>
      </div>

      ${Wd(o)}

      ${ld(o.sidebarOpen)}

      ${o.canvasView==="map"?Nd({date:o.date,timeRange:o.timeRange,sidebarOpen:o.sidebarOpen,sidebarWidth:gt,mode:o.mode,compareMode:o.compareMode,compareDateStart:o.compareDateStart,compareDateEnd:o.compareDateEnd}):""}
    </div>
  `,bf(),t){const l=nt.querySelector('.custom-select-wrapper[data-key="chartLocation"]');l&&l.classList.add("open")}if(Tt=nt.querySelector("#map-canvas"),Tt&&o.currentData&&!o.dataError&&o.dataMin!==null&&o.dataMax!==null){Er(Tt),ir(o.currentData,Tt,ut,o.palette,o.dataMin,o.dataMax,o.variable,o.selectedUnit);const l=ut.find(u=>u.name===o.palette)||ut[0];nr("legend-gradient-canvas",l.colors),o.drawState.active&&requestAnimationFrame(An)}const s=(o.sidebarOpen?gt+24:24)+8,c=o.sidebarOpen?1:.9;wo(s,c)}function ff(){if(!o.isLoading)return"";const t=Math.max(0,Math.min(100,Math.round(o.loadingProgress)));return`
      <div style="${y(x.loadingIndicator)}">
        <div style="${y(x.loadingSpinner)}"></div>
        <div style="${y(x.loadingTextGroup)}">
          <div style="${y(x.loadingText)}">Loading data · ${t}%</div>
          <div style="${y(x.loadingBar)}">
            <div style="${y({...x.loadingBarFill,width:`${t}%`})}"></div>
          </div>
          <div style="${y(x.loadingSubtext)}">Fetching climate tiles</div>
        </div>
      </div>
    `}function hf(){return`
      <div style="position:absolute; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none;">
      </div>
    `}function ko(t){if(!Number.isFinite(t))return"-";const e=Math.abs(t);return e>=1e3?t.toFixed(0):e>=100?t.toFixed(1):e>=1?t.toFixed(2):t.toPrecision(2)}function wa(t){if(!t.length)return`<div style="${y(x.chartEmpty)}">No chart data loaded yet.</div>`;const e=[...t].sort((_,C)=>Ft.indexOf(_.scenario)-Ft.indexOf(C.scenario)),r=(ut.find(_=>_.name===o.palette)||ut[0]).colors,a=900,i=440,s={top:26,right:36,bottom:70,left:86},c=a-s.left-s.right,l=i-s.top-s.bottom,u=e.flatMap(_=>[_.stats.min,_.stats.max]),d=Math.min(...u),f=Math.max(...u),m=Math.max(Math.abs(f-d)*.12,1e-6),p=xr().domain([d-m,f+m]).range([l,0]),$=p.ticks(6),A=c/(e.length+1),L=$.map(_=>{const C=p(_)+s.top;return`
        <g>
          <line x1="${s.left}" x2="${a-s.right}" y1="${C}" y2="${C}" stroke="rgba(255,255,255,0.08)" />
          <text x="${s.left-10}" y="${C+4}" fill="var(--text-secondary)" font-size="11" text-anchor="end">
            ${ko(_)}
          </text>
        </g>
      `}).join(""),M=e.map((_,C)=>{const w=s.left+A*(C+1),g=r[C%r.length],{min:b,q1:R,median:I,q3:N,max:E,mean:P}=_.stats,h=p(N)+s.top,k=p(R)+s.top,S=Math.max(2,k-h);return`
        <g>
          <line x1="${w}" x2="${w}" y1="${p(b)+s.top}" y2="${p(E)+s.top}" stroke="${g}" stroke-width="2" stroke-linecap="round" />
          <rect x="${w-24}" y="${h}" width="48" height="${S}" fill="rgba(255,255,255,0.06)" stroke="${g}" stroke-width="2" rx="6" />
          <line x1="${w-24}" x2="${w+24}" y1="${p(I)+s.top}" y2="${p(I)+s.top}" stroke="${g}" stroke-width="2.4" />
          <circle cx="${w}" cy="${p(P)+s.top}" r="4" fill="${g}" stroke="rgba(0,0,0,0.55)" stroke-width="1" />
          <text x="${w}" y="${i-s.bottom+32}" fill="var(--text-primary)" font-weight="700" font-size="12" text-anchor="middle">${_.scenario}</text>
          <text x="${w}" y="${i-s.bottom+48}" fill="var(--text-secondary)" font-size="11" text-anchor="middle">${_.samples.length} model${_.samples.length===1?"":"s"}</text>
        </g>
      `}).join(""),v=`
      <line
        x1="${s.left}"
        x2="${s.left}"
        y1="${s.top}"
        y2="${i-s.bottom}"
        stroke="rgba(255,255,255,0.65)"
        stroke-width="1.2"
      />
    `,D=`
      <text
        x="${s.left-70}"
        y="${s.top+l/2}"
        fill="var(--text-secondary)"
        font-size="12"
        text-anchor="middle"
        transform="rotate(-90 ${s.left-70} ${s.top+l/2})"
      >
        ${o.chartUnit}
      </text>
    `;return`
      <svg viewBox="0 0 ${a} ${i}" role="img" aria-label="Global box plots" preserveAspectRatio="xMidYMid meet" style="width:100%; height:auto;">
        ${v}
        ${L}
        ${M}
        ${D}
      </svg>
    `}function Sa(t){if(!t.length)return`<div style="${y(x.chartEmpty)}">No chart data loaded yet.</div>`;const n=(ut.find(P=>P.name===o.palette)||ut[0]).colors,r=960,a=460,i={top:28,right:32,bottom:82,left:86},s=r-i.left-i.right,c=a-i.top-i.bottom,l=t.flatMap(P=>P.points),u=l.map(P=>J(P.date)),d=zo(u),f=Oo(u);if(!d||!f)return`<div style="${y(x.chartEmpty)}">No chart data loaded yet.</div>`;const m=1440*60*1e3,p=new Date(d.getTime()-m*.25),$=new Date(f.getTime()+m*.25),A=Ju().domain([p,$]).range([0,s]),L=A.ticks(6),M=Tr("%b %Y"),v=l.flatMap(P=>[P.stats.min,P.stats.max]),D=Math.min(...v),_=Math.max(...v),C=Math.max(Math.abs(_-D)*.12,1e-6),w=xr().domain([D-C,_+C]).range([c,0]),b=w.ticks(6).map(P=>{const h=w(P)+i.top;return`
        <g>
          <line x1="${i.left}" x2="${r-i.right}" y1="${h}" y2="${h}" stroke="rgba(255,255,255,0.08)" />
          <text x="${i.left-10}" y="${h+4}" fill="var(--text-secondary)" font-size="11" text-anchor="end">
            ${ko(P)}
          </text>
        </g>
      `}).join(""),R=L.map(P=>{const h=A(P)+i.left;return`
        <g>
          <line x1="${h}" x2="${h}" y1="${i.top}" y2="${a-i.bottom}" stroke="rgba(255,255,255,0.06)" />
          <text x="${h}" y="${a-i.bottom+26}" fill="var(--text-secondary)" font-size="11" text-anchor="middle">
            ${M(P)}
          </text>
        </g>
      `}).join(""),I=Math.max(Pt.length,4),N=t.map((P,h)=>{if(!P.points.length)return"";const k=n[h%n.length],S=P.points.map(B=>{const q=Array.from({length:I+1},(j,Y)=>{const et=Y/I;return B.stats.min+(B.stats.max-B.stats.min)*et});return{point:B,levels:q}}),z=B=>{const q=S.map(({point:Y,levels:et})=>{const rt=A(J(Y.date))+i.left,at=w(et[B+1])+i.top;return`${rt},${at}`}).join(" L "),j=[...S].reverse().map(({point:Y,levels:et})=>{const rt=A(J(Y.date))+i.left,at=w(et[B])+i.top;return`${rt},${at}`}).join(" L ");return`M ${q} L ${j} Z`},U=Array.from({length:I},(B,q)=>{const j=z(q),Y=I/2,rt=.55*(1-Math.min(Math.abs(q+.5-Y)/Y,1))+.08;return`<path d="${j}" fill="${k}" fill-opacity="${rt.toFixed(3)}" stroke="none" />`}).join(""),F=P.points.map((B,q)=>{const j=A(J(B.date))+i.left,Y=w(B.stats.median)+i.top;return`${q===0?"M":"L"} ${j} ${Y}`}).join(" "),V=P.points.map((B,q)=>{const j=A(J(B.date))+i.left,Y=w(B.stats.mean)+i.top;return`${q===0?"M":"L"} ${j} ${Y}`}).join(" ");return`
        <g>
          ${U}
          <path d="${F}" fill="none" stroke="${k}" stroke-width="2.2" />
          <path d="${V}" fill="none" stroke="${k}" stroke-width="1.6" stroke-dasharray="6 6" stroke-opacity="0.9" />
          <circle cx="${A(J(P.points[P.points.length-1].date))+i.left}" cy="${w(P.points[P.points.length-1].stats.median)+i.top}" r="4" fill="${k}" stroke="rgba(0,0,0,0.4)" stroke-width="1" />
        </g>
      `}).join(""),E=`
      <text
        x="${i.left-70}"
        y="${i.top+c/2}"
        fill="var(--text-secondary)"
        font-size="12"
        text-anchor="middle"
        transform="rotate(-90 ${i.left-70} ${i.top+c/2})"
      >
        ${o.chartUnit}
      </text>
    `;return`
      <div style="width:100%; display:flex; flex-direction:column; gap:12px; align-items:center;">
        <div style="position:relative; width:100%; display:flex; justify-content:center;">
          <div style="position:absolute; top:10px; right:16px; display:flex; gap:12px; align-items:center; color:var(--text-secondary); font-size:11.5px; z-index:2;">
            <div style="display:flex; align-items:center; gap:6px;">
              <span style="display:inline-block; width:26px; height:0; border-top:1px solid var(--text-primary);"></span>
              <span>Median</span>
            </div>
            <div style="display:flex; align-items:center; gap:6px;">
              <span style="display:inline-block; width:26px; height:0; border-top:1px dashed var(--text-primary);"></span>
              <span>Mean</span>
            </div>
          </div>
          <svg viewBox="0 0 ${r} ${a}" role="img" aria-label="Distribution over time" preserveAspectRatio="xMidYMid meet" style="width:100%; height:auto;">
            ${b}
            ${R}
            <path
              d="M ${i.left} ${i.top} L ${i.left} ${a-i.bottom} L ${r-i.right} ${a-i.bottom}"
              fill="none"
              stroke="rgba(255,255,255,0.6)"
              stroke-width="1.2"
              stroke-linecap="round"
            />
            ${N}
            ${E}
          </svg>
        </div>
        <div style="${y(x.chartLegend)}">
          ${t.map((P,h)=>`
            <div style="display:flex; align-items:center; gap:8px; font-size:12; color:var(--text-secondary);">
              <span style="display:inline-block; width:16px; height:8px; background:${n[h%n.length]}; border-radius:999px;"></span>
              <span style="color:var(--text-primary); font-weight:700;">${P.scenario}</span>
            </div>
          `).join("")}
        </div>
      </div>
    `}function mf(){let t="";const e=o.chartMode==="range";if(o.chartLoading)t=`
          <div style="position:absolute; inset:0; pointer-events:none;">
            <div style="${y(st(x.loadingIndicator,{position:"absolute",left:18,bottom:-95,pointerEvents:"auto"}))}">
              <div style="${y(x.loadingSpinner)}"></div>
              <div style="${y(x.loadingTextGroup)}">
                <div style="${y(x.loadingText)}">Loading data</div>
                <div style="${y(x.loadingBar)}">
                  <div style="${y({...x.loadingBarFill,width:`${Math.max(0,Math.min(100,Math.round(o.loadingProgress||25)))}%`})}"></div>
                </div>
                <div style="${y(x.loadingSubtext)}">${o.chartLoadingProgress.total>0?`${o.chartLoadingProgress.done}/${o.chartLoadingProgress.total} datasets loaded`:"Preparing datasets"}</div>
              </div>
            </div>
            ${hf()}
          </div>
          ${!e&&o.chartBoxes?wa(o.chartBoxes):e&&o.chartRangeSeries?Sa(o.chartRangeSeries):""}
        `;else if(o.chartError)t=`<div style="${y(x.chartError)}">${o.chartError}</div>`;else if(!e&&(!o.chartBoxes||!o.chartBoxes.length)||e&&(!o.chartRangeSeries||!o.chartRangeSeries.length)){const i=e?"Select scenarios, models, and a date range to see how the distribution evolves over time.":"Select scenarios and models to fetch the global box plot.";t=`<div style="${y(x.chartEmpty)}">${i}</div>`}else t=e?Sa(o.chartRangeSeries??[]):wa(o.chartBoxes??[]);const n=o.chartLocationName||(o.chartLocation==="Point"&&o.chartPoint?`Point (${o.chartPoint.lat.toFixed(2)}, ${o.chartPoint.lon.toFixed(2)})`:o.chartLocation==="Draw"?"Custom region":o.chartLocation==="World"?"Global":""),r=o.chartMode==="range"?`${ae(o.chartRangeStart)} – ${ae(o.chartRangeEnd)}`:ae(o.chartDate);return`
      <div data-role="chart-container" style="pointer-events:auto; width:100%; display:flex; align-items:center; justify-content:center; padding:24px; padding-right:${o.sidebarOpen?gt+32:24}px;">
        <div style="${y(x.chartPanel)}">
          <div style="${y(x.chartHeader)}">
            <div style="${y(x.chartTitle)}">${So(o.chartVariable,o.metaData)}</div>
            <div style="${y(x.mapSubtitle)}">${n?`${ge(n)} · ${r}`:r}</div>
          </div>
          <div style="${y(st(x.chartPlotWrapper,{display:"flex",alignItems:"center",justifyContent:"center"}))}">
            ${t}
          </div>
        </div>
      </div>
    `}function Q(t,e){return`
    <div style="${y(x.field)}">
      ${t?`<div style="${y(x.fieldLabel)}">${t}</div>`:""}
      ${e}
    </div>
  `}function Xt(t,e,n){const r=n?.type??"date",a=n?.dataKey??t,i=n?.min?`min="${n.min}"`:"",s=n?.max?`max="${n.max}"`:"";return`
    <input
      type="${r}"
      value="${e}"
      data-action="update-input"
      data-key="${a}"
      ${i}
      ${s}
    />
  `}function tt(t,e,n,r){const a=r?.dataKey??t,i=r?.disabled?"disabled":"",s=`custom-select-${a}-${Math.random().toString(36).substr(2,9)}`,c=r?.infoType,l=ge(r?.selectedLabel??n),u=r?.extraContent??"";return`
    <div class="custom-select-container">
      <div class="custom-select-info-panel" id="${s}-info" role="tooltip"></div>
      <div class="custom-select-wrapper" data-key="${a}" ${i?'data-disabled="true"':""} ${c?`data-info-type="${c}"`:""}>
        <div class="custom-select-trigger" data-action="update-select" data-key="${a}" id="${s}-trigger" ${i?'aria-disabled="true"':""} tabindex="${i?"-1":"0"}">
          <span class="custom-select-value">${l}</span>
          <svg class="custom-select-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="custom-select-dropdown" id="${s}-dropdown" role="listbox">
          ${e.map(d=>`
                <div class="custom-select-option ${d===n?"selected":""}" 
                     data-value="${d}" 
                     data-action="update-select" 
                     data-key="${a}"
                     role="option"
                     ${d===n?'aria-selected="true"':""}
                     tabindex="0">
                  ${d}
                </div>
              `).join("")}
          ${u}
        </div>
      </div>
    </div>
  `}function pf(t,e,n="panel-tab"){return`
    <button
      type="button"
      data-action="set-tab"
      data-key="${n}"
      data-value="${t}"
      style="${y(st(x.tabBtn,e))}"
    >
      ${t}
    </button>
  `}function gf(t){const{modeTransform:e,resolutionFill:n,modeIndicatorTransform:r}=t,a=o.compareMode==="Models"?[Q("Scenario",tt("scenario",Ft,o.scenario,{infoType:"scenario"})),Q("Date",Xt("date",o.date))]:o.compareMode==="Dates"?[Q("Scenario",tt("scenario",Ft,o.scenario,{infoType:"scenario"})),Q("Model",tt("model",yt,o.model,{infoType:"model"}))]:[Q("Model",tt("model",yt,o.model,{infoType:"model"})),Q("Date",Xt("date",o.date))];return`
    <div style="${y(x.modeSwitch)}">
      <div data-role="mode-indicator" style="${y({...x.modeIndicator,transform:r})}"></div>
      ${["Explore","Compare"].map(i=>`
            <button
              type="button"
              class="mode-btn"
              data-action="set-mode"
              data-value="${i}"
              style="${y(st(x.modeBtn,o.mode===i?x.modeBtnActive:void 0))}"
            >
              ${i}
            </button>
          `).join("")}
    </div>

    <div style="${y(x.modeViewport)}">
      <div data-role="mode-track" style="${y({...x.modeTrack,transform:e})}">
        <div class="mode-pane-scrollable" style="${y(x.modePane)}">
          <div style="${y({display:"flex",flexDirection:"column",gap:8})}">
            <div style="${y(x.sectionTitle)}">Parameters</div>
            <div style="${y(x.paramGrid)}">
              ${Q("Scenario",tt("scenario",Ft,o.scenario,{infoType:"scenario"}))}
              ${Q("Model",tt("model",yt,o.model,{infoType:"model"}))}
              ${Q("Date",(()=>{const i=jt(o.scenario);return Xt("date",o.date,{min:i.start,max:i.end})})())}
              ${Q("Variable",tt("variable",Pt,o.variable,{infoType:"variable"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${y({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${y(x.sectionTitle)}">Unit</div>
              ${Q("",tt("unit",Kt(o.variable).map(i=>i.label),o.selectedUnit,{dataKey:"unit"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${y({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${y(x.sectionTitle)}">Color palette</div>
              ${Q("",tt("palette",ut.map(i=>i.name),o.palette,{dataKey:"palette"}))}
            </div>
          </div>

          <div style="margin-top:14px">
            <div style="${y({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${y(x.sectionTitle)}">Resolution</div>
              <div style="${y(x.resolutionRow)}">
                <input
                  type="range"
                  min="1"
                  max="3"
                  step="1"
                  value="${o.resolution}"
                  data-action="set-resolution"
                  class="resolution-slider"
                  style="${y(st(x.range,{"--slider-fill":`${n}%`}))}"
                />
                <div data-role="resolution-value" style="${y(x.resolutionValue)}">${o.resolution===1?"Low":o.resolution===2?"Medium":"High"}</div>
              </div>
            </div>
          </div>
        </div>

        <div class="mode-pane-scrollable" style="${y(x.modePane)}">
          <div style="${y({display:"flex",flexDirection:"column",gap:14})}">
            <div style="${y({display:"flex",flexDirection:"column",gap:8})}">
              <div style="${y(x.sectionTitle)}">Compare</div>
              <div style="${y(x.paramGrid)}">
                ${Q("What do you want to compare?",tt("compareMode",["Scenarios","Models","Dates"],o.compareMode,{dataKey:"compareMode"}))}
              </div>

              ${o.compareMode==="Scenarios"?`
                      <div style="${y(x.paramGrid)}">
                        ${Q("Scenario A",tt("compareScenarioA",["SSP245","SSP370","SSP585"],o.compareScenarioA,{dataKey:"compareScenarioA",infoType:"scenario"}))}
                        ${Q("Scenario B",tt("compareScenarioB",["SSP245","SSP370","SSP585"],o.compareScenarioB,{dataKey:"compareScenarioB",infoType:"scenario"}))}
                      </div>
                    `:""}

              ${o.compareMode==="Models"?`
                      <div style="${y(x.paramGrid)}">
                        ${Q("Model A",tt("compareModelA",(()=>{const i=yt.filter(s=>s!==o.compareModelB);return i.includes(o.compareModelA)?i:[o.compareModelA,...i]})(),o.compareModelA,{dataKey:"compareModelA",infoType:"model"}))}
                        ${Q("Model B",tt("compareModelB",(()=>{const i=yt.filter(s=>s!==o.compareModelA);return i.includes(o.compareModelB)?i:[o.compareModelB,...i]})(),o.compareModelB,{dataKey:"compareModelB",infoType:"model"}))}
                      </div>
                    `:""}

              ${o.compareMode==="Dates"?`
                      <div style="${y(x.paramGrid)}">
                        ${Q("Start date",Xt("compareDateStart",o.compareDateStart,{dataKey:"compareDateStart"}))}
                        ${Q("End date",Xt("compareDateEnd",o.compareDateEnd,{dataKey:"compareDateEnd"}))}
  </div>
`:""}

              <div style="${y(x.paramGrid)}">
                ${a.join("")}
                ${Q("Variable",tt("variable",Pt,o.variable,{infoType:"variable"}))}
              </div>

              <div style="margin-top:14px">
                <div style="${y({display:"flex",flexDirection:"column",gap:8})}">
                  <div style="${y(x.sectionTitle)}">Unit</div>
                  ${Q("",tt("unit",Kt(o.variable).map(i=>i.label),o.selectedUnit,{dataKey:"unit"}))}
                </div>
              </div>

              <div style="margin-top:14px">
                <div style="${y({display:"flex",flexDirection:"column",gap:8})}">
                  <div style="${y(x.sectionTitle)}">Color palette</div>
                  ${Q("",tt("palette",ut.map(i=>i.name),o.palette,{dataKey:"palette"}))}
                </div>
              </div>

              <div style="margin-top:14px">
                <div style="${y({display:"flex",flexDirection:"column",gap:8})}">
                  <div style="${y(x.sectionTitle)}">Resolution</div>
                  <div style="${y(x.resolutionRow)}">
                    <input
                      type="range"
                      min="1"
                      max="3"
                      step="1"
                      value="${o.resolution}"
                      data-action="set-resolution"
                      class="resolution-slider"
                      style="${y(st(x.range,{"--slider-fill":`${n}%`}))}"
                    />
                    <div data-role="resolution-value" style="${y(x.resolutionValue)}">${o.resolution===1?"Low":o.resolution===2?"Medium":"High"}</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  `}function an(t,e,n){const r=new Set(e);return`
      <div style="${y(x.chipRow)}">
        ${t.map(a=>{const i=r.has(a);return`
                  <button
                    type="button"
                    data-action="toggle-multi"
                    data-key="${n}"
                    data-value="${a}"
                    style="${y(st(x.chip,i?x.chipActive:void 0))}"
                  >
                    ${a}
                  </button>
                `}).join("")}
      </div>
    `}function Ma(){const t=o.chartLocationSearchResults.length>0?o.chartLocationSearchResults.map(r=>`
                <button
                  type="button"
                  class="location-search-result"
                  data-role="location-search-result"
                  data-name="${ge(r.displayName)}"
                  data-lat="${r.lat}"
                  data-lon="${r.lon}"
                >
                  <div class="location-search-result-name">${ge(r.displayName)}</div>
                  <div class="location-search-result-coord">
                    ${r.lat.toFixed(3)}, ${r.lon.toFixed(3)}
                  </div>
                </button>
              `).join(""):"",e=o.chartLocationSearchQuery.trim().length>0,n=o.chartLocationSearchError?`<div class="location-search-error">${ge(o.chartLocationSearchError)}</div>`:o.chartLocationSearchLoading?'<div class="location-search-status">Searching...</div>':o.chartLocationSearchResults.length===0&&e?'<div class="location-search-status">No places found. Try refining your query.</div>':"";return`
      <div class="custom-select-extra" data-role="chart-location-search">
        <div class="location-search-row">
          <input
            type="text"
            class="location-search-input"
            value="${ge(o.chartLocationSearchQuery)}"
            placeholder="Search a place (e.g. Aachen)"
            data-role="location-search-input"
          />
        </div>
        ${n}
        <div class="location-search-results" data-role="location-search-results">
          ${t||""}
        </div>
      </div>
    `}function yf(){const t=o.chartMode==="single"?"translateX(0%)":"translateX(100%)",e=o.metaData?.scenarios?.length?Array.from(new Set(o.metaData.scenarios.map(Lr))):Ft,n=o.metaData?.models?.length?o.metaData.models:yt,r=Cr(o.chartScenarios.length?o.chartScenarios:e),a=(c,l,u,d,f)=>`
          <div style="${y({border:"1px solid var(--border-medium)",borderRadius:12,background:"var(--bg-subtle)",padding:"10px 12px"})}">
            <button
              type="button"
              data-action="toggle-collapse"
              data-key="${f}"
              style="${y({display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",background:"transparent",border:"none",color:"var(--text-primary)",fontWeight:700,fontSize:13,cursor:"pointer",padding:0})}"
            >
              <span>${c}</span>
              <span style="${y({color:"var(--text-secondary)",fontWeight:600,fontSize:12})}">${u} ${l?"▴":"▾"}</span>
            </button>
            ${l?`<div style="${y({marginTop:10,display:"flex",flexWrap:"wrap",gap:8})}">${d}</div>`:""}
          </div>
        `,i=`
      <div style="${y(x.paramGrid)}">
        ${Q("Date",Xt("chartDate",o.chartDate,{dataKey:"chartDate",min:r.start,max:r.end}))}
        ${Q("Variable",tt("chartVariable",Pt,o.chartVariable,{dataKey:"chartVariable",infoType:"variable"}))}
      </div>

      <div style="margin-top:10px">
        ${Q("Location",tt("chartLocation",["World","Draw","Point"],o.chartLocation,{dataKey:"chartLocation",selectedLabel:o.chartLocation==="Search"&&o.chartLocationName?`Search: ${o.chartLocationName}`:o.chartLocation,extraContent:Ma()}))}
      </div>

      <div style="margin-top:14px">
        ${a("Scenarios",o.chartDropdown.scenariosOpen,`${o.chartScenarios.length} selected`,an(e,o.chartScenarios,"chartScenarios"),"chartScenarios")}
      </div>

      <div style="margin-top:14px">
        ${a("Models",o.chartDropdown.modelsOpen,`${o.chartModels.length} selected`,an(n,o.chartModels,"chartModels"),"chartModels")}
      </div>

      <div style="margin-top:14px">
        <div style="${y(x.sectionTitle)}">Unit</div>
        ${Q("",tt("chartUnit",Kt(o.chartVariable).map(c=>c.label),o.chartUnit,{dataKey:"chartUnit"}))}
      </div>
    `,s=`
      <div style="${y(x.paramGrid)}">
        ${Q("Start date",Xt("chartRangeStart",o.chartRangeStart,{dataKey:"chartRangeStart",min:r.start,max:r.end}))}
        ${Q("End date",Xt("chartRangeEnd",o.chartRangeEnd,{dataKey:"chartRangeEnd",min:r.start,max:r.end}))}
      </div>

      <div style="${y(st(x.paramGrid,{marginTop:12}))}">
        ${Q("Variable",tt("chartVariable",Pt,o.chartVariable,{dataKey:"chartVariable",infoType:"variable"}))}
      </div>

      <div style="margin-top:10px">
        ${Q("Location",tt("chartLocation",["World","Draw","Point"],o.chartLocation,{dataKey:"chartLocation",selectedLabel:o.chartLocation==="Search"&&o.chartLocationName?`Search: ${o.chartLocationName}`:o.chartLocation,extraContent:Ma()}))}
      </div>

      <div style="margin-top:14px">
        ${a("Scenarios",o.chartDropdown.scenariosOpen,`${o.chartScenarios.length} selected`,an(e,o.chartScenarios,"chartScenarios"),"chartScenarios")}
      </div>

      <div style="margin-top:14px">
        ${a("Models",o.chartDropdown.modelsOpen,`${o.chartModels.length} selected`,an(n,o.chartModels,"chartModels"),"chartModels")}
      </div>

      <div style="margin-top:14px">
        <div style="${y(x.sectionTitle)}">Unit</div>
        ${Q("",tt("chartUnit",Kt(o.chartVariable).map(c=>c.label),o.chartUnit,{dataKey:"chartUnit"}))}
      </div>
    `;return`
      <div style="${y(x.modeSwitch)}">
        <div data-role="chart-mode-indicator" style="${y({...x.modeIndicator,transform:t})}"></div>
        ${["single","range"].map(c=>{const l=c==="single"?"Single dates":"Range";return`
              <button
                type="button"
                class="mode-btn"
                data-action="set-chart-mode"
                data-value="${c}"
                style="${y(st(x.modeBtn,o.chartMode===c?x.modeBtnActive:void 0))}"
              >
                ${l}
              </button>
            `}).join("")}
      </div>

      <div class="mode-pane-scrollable" style="${y(x.modePane)}">
        ${o.chartMode==="single"?i:s}
      </div>
    `}function vf(){return`
    <div style="${y({display:"flex",flexDirection:"column",gap:8})}">
      <div style="${y(x.sectionTitle)}">Chat</div>
      <div style="${y(x.chatStack)}">
        <div style="${y(x.chatLead)}">Discuss the data with an agent, or ask questions.</div>

        <div style="${y(x.chatMessages)}">
          ${o.chatMessages.map(t=>{const e=t.sender==="user"?st(x.chatBubble,x.chatBubbleUser):st(x.chatBubble,x.chatBubbleAgent);return`<div style="${y(e)}">${t.text}</div>`}).join("")}
        </div>

        <div style="${y(x.chatBox)}">
          <input
            type="text"
            value="${o.chatInput}"
            data-action="chat-input"
            style="${y(x.chatInput)}"
            placeholder="Ask a question"
          />
          <button type="button" data-action="chat-send" aria-label="Send chat message" style="${y(x.chatSend)}">
            ➤
          </button>
        </div>
      </div>
    </div>
  `}function $a(t,e,n){const r=Math.hypot(t,e);if(!r||!isFinite(r)||n<=0)return{x:0,y:0};const a=Math.min(1,n/r);return{x:t*a,y:e*a}}function xf(t){nn&&(nn(),nn=null),Qt!==null&&(cancelAnimationFrame(Qt),Qt=null),zt!==null&&(cancelAnimationFrame(zt),zt=null),Zt!==null&&(clearTimeout(Zt),Zt=null),Ct!==null&&(clearTimeout(Ct),Ct=null);const e=t.querySelector('[data-role="brand-eye"]');if(!e)return;let n={x:0,y:0},r={x:0,y:0},a={x:0,y:0},i={x:0,y:0},s=1,c=!1;const l=3e4,u=(v,D)=>{const _=e.getBoundingClientRect(),C=_.left+_.width/2,w=_.top+_.height/2,g=v-C,b=D-w,I=Math.min(_.width,_.height)*.14,N=I*.6;n=$a(g,b,I),r=$a(g,b,N)},d=v=>{s=Math.max(0,Math.min(1,v)),e.style.setProperty("--blink-open",`${s}`)},f=()=>{Ct!==null&&clearTimeout(Ct),Ct=window.setTimeout(()=>{n={x:0,y:0},r={x:0,y:0}},l)},m=()=>{a.x+=(n.x-a.x)*.28,a.y+=(n.y-a.y)*.28,i.x+=(r.x-i.x)*.32,i.y+=(r.y-i.y)*.32,e.style.setProperty("--iris-x",`${a.x}px`),e.style.setProperty("--iris-y",`${a.y}px`),e.style.setProperty("--pupil-x",`${i.x}px`),e.style.setProperty("--pupil-y",`${i.y}px`),Qt=requestAnimationFrame(m)},p=()=>{if(c)return;c=!0;const v=[{t:0,v:1},{t:.16,v:.08},{t:.26,v:.02},{t:.4,v:1}],D=350,_=performance.now(),C=w=>{const g=w-_,b=Math.min(1,g/D);let R=v[0],I=v[v.length-1];for(let k=0;k<v.length-1;k++){const S=v[k],z=v[k+1];if(b>=S.t&&b<=z.t){R=S,I=z;break}}const N=I.t-R.t||1,E=Math.min(1,Math.max(0,(b-R.t)/N)),P=1-Math.pow(1-E,2),h=R.v+(I.v-R.v)*P;d(h),b<1?zt=requestAnimationFrame(C):(d(1),c=!1,$())};zt=requestAnimationFrame(C)},$=()=>{const v=3e3+Math.random()*15e3;Zt=window.setTimeout(p,v)},A=()=>{const v=e.getBoundingClientRect();u(v.left+v.width/2,v.top+v.height/2)},L=v=>{u(v.clientX,v.clientY),f()},M=()=>A();A(),m(),$(),f(),window.addEventListener("pointermove",L),window.addEventListener("pointerleave",M),nn=()=>{window.removeEventListener("pointermove",L),window.removeEventListener("pointerleave",M),Qt!==null&&(cancelAnimationFrame(Qt),Qt=null),zt!==null&&(cancelAnimationFrame(zt),zt=null),Zt!==null&&(clearTimeout(Zt),Zt=null),Ct!==null&&(clearTimeout(Ct),Ct=null)}}function bf(t){if(!nt)return;const e=nt;xf(e),cd({root:e,getSidebarOpen:()=>o.sidebarOpen,setSidebarOpen:g=>{o.sidebarOpen=g},onTimeSliderUpdate:g=>{Pd(g,gt)},onCanvasToggleUpdate:g=>{const b=o.sidebarOpen?1:.9;wo(g+8,b)}}),e.querySelectorAll('[data-action="set-canvas"]').forEach(g=>g.addEventListener("click",()=>{const b=g.dataset.value;if(b){if(b===o.canvasView)return;const I=o.canvasView==="map"?"translateX(0%)":"translateX(100%)",N=b==="map"?"translateX(0%)":"translateX(100%)";o.canvasView=b,H(),b==="map"?$t():Yt();const E=e.querySelector('[data-role="canvas-indicator"]');if(!E)return;E.style.removeProperty("transition"),E.style.transform=I,E.offsetHeight,E.getBoundingClientRect(),requestAnimationFrame(()=>{E.style.transition="transform 180ms ease",E.style.transform=N})}})),e.querySelectorAll('[data-action="set-mode"]').forEach(g=>g.addEventListener("click",()=>{const b=g.dataset.value;if(b){if(b===o.mode)return;const R=o.mode,I=R==="Explore"?"translateX(0%)":"translateX(-50%)",N=R==="Explore"?"translateX(0%)":"translateX(100%)",E=b==="Explore"?"translateX(0%)":"translateX(-50%)",P=b==="Explore"?"translateX(0%)":"translateX(100%)";o.mode=b,H();const h=e.querySelector('[data-role="mode-track"]'),k=e.querySelector('[data-role="mode-indicator"]');if(!h||!k)return;h.style.transition="none",k.style.transition="none",h.style.transform=I,k.style.transform=N,h.offsetHeight,h.style.transition="transform 220ms ease",k.style.transition="transform 200ms ease",h.style.transform=E,k.style.transform=P}o.canvasView==="map"&&$t()})),e.querySelectorAll('[data-action="set-chart-mode"]').forEach(g=>g.addEventListener("click",()=>{const b=g.dataset.value;if(!b||b===o.chartMode)return;const I=o.chartMode==="single"?"translateX(0%)":"translateX(100%)",N=b==="single"?"translateX(0%)":"translateX(100%)";o.chartMode=b,H();const E=e.querySelector('[data-role="chart-mode-indicator"]');E&&(E.style.removeProperty("transition"),E.style.transform=I,E.offsetHeight,requestAnimationFrame(()=>{E.style.transition="transform 200ms ease",E.style.transform=N})),o.canvasView==="chart"&&Yt()})),e.querySelectorAll('[data-action="set-tab"]').forEach(g=>g.addEventListener("click",()=>{const b=g.dataset.value;if(b){if(b===o.panelTab)return;const I=o.panelTab==="Manual"?"translateX(0%)":"translateX(-50%)",N=b==="Manual"?"translateX(0%)":"translateX(-50%)";o.panelTab=b,H();const E=e.querySelector('[data-role="tab-track"]');if(!E)return;E.style.removeProperty("transition"),E.style.transform=I,E.offsetHeight,E.getBoundingClientRect(),requestAnimationFrame(()=>{E.style.transition="transform 220ms ease",E.style.transform=N})}}));const s=e.querySelectorAll(".custom-select-wrapper");let c=document.querySelector(".custom-select-info-panel-shared");c||(c=document.createElement("div"),c.className="custom-select-info-panel custom-select-info-panel-shared",c.setAttribute("role","tooltip"),document.body.appendChild(c));const l=g=>{g.target.closest(".custom-select-wrapper")||(s.forEach(R=>{R.classList.remove("open")}),c&&c.classList.remove("visible"))},u=g=>{g.key==="Escape"&&(s.forEach(b=>{b.classList.remove("open")}),c&&c.classList.remove("visible"))};document.addEventListener("click",l),document.addEventListener("keydown",u),s.forEach(g=>{const b=g.querySelector(".custom-select-trigger"),R=g.querySelector(".custom-select-dropdown"),I=g.querySelectorAll(".custom-select-option"),N=g.dataset.key,E=g.dataset.infoType,P=g.dataset.disabled==="true";if(!b||!R||P)return;const h=c,k=(U,F)=>{if(!h||!E)return;let V="",B=U;if(E==="scenario"?V=Ud[U]||"":E==="variable"?(V=Od[U]||"",B=Bd[U]||U):E==="model"&&(V=zd[U]||""),V){if(h.innerHTML=`
                    <div class="custom-select-info-panel-title">${B}</div>
                    <div class="custom-select-info-panel-content">${V}</div>
                `,F||b){const q=F||b;if(q){const j=q.getBoundingClientRect();h.style.left=`${j.left-272}px`,h.style.top=`${j.top}px`}}h.classList.add("visible")}},S=()=>{h&&h.classList.remove("visible")};b.addEventListener("click",U=>{if(U.stopPropagation(),P)return;const F=g.classList.contains("open");s.forEach(V=>{V!==g&&V.classList.remove("open")}),g.classList.toggle("open",!F)}),b.addEventListener("keydown",U=>{if(!P&&(U.key==="Enter"||U.key===" "||U.key==="ArrowDown")){U.preventDefault(),g.classList.add("open");const F=I[0];F&&F.focus()}}),I.forEach(U=>{U.addEventListener("click",F=>{F.stopPropagation();const V=U.dataset.value;if(!V||!N)return;I.forEach(q=>{q.classList.remove("selected"),q.removeAttribute("aria-selected")}),U.classList.add("selected"),U.setAttribute("aria-selected","true");const B=b.querySelector(".custom-select-value");B&&(B.textContent=V),g.classList.remove("open"),S(),d(N,V)}),E&&(U.addEventListener("mouseenter",()=>{const F=U.dataset.value;F&&k(F,U)}),U.addEventListener("mouseleave",()=>{S()})),U.addEventListener("keydown",F=>{const V=Array.from(I).indexOf(U);if(F.key==="Enter"||F.key===" ")F.preventDefault(),U.click();else if(F.key==="ArrowDown"){F.preventDefault();const B=(V+1)%I.length;I[B]?.focus()}else if(F.key==="ArrowUp"){F.preventDefault();const B=V===0?I.length-1:V-1;I[B]?.focus()}else F.key==="Escape"?(F.preventDefault(),g.classList.remove("open"),S(),b.focus()):F.key==="Home"?(F.preventDefault(),I[0]?.focus()):F.key==="End"&&(F.preventDefault(),I[I.length-1]?.focus())})}),new MutationObserver(U=>{U.forEach(F=>{F.type==="attributes"&&F.attributeName==="class"&&(g.classList.contains("open")||S())})}).observe(g,{attributes:!0})});const d=async(g,b)=>{if(!g)return;let R=!1,I=!1;switch(g){case"scenario":o.scenario=b,o.date=Xd(b),o.timeRange=jt(b),R=!0;break;case"model":o.model=b,R=!0;break;case"variable":o.variable=b,o.selectedUnit=ze(b).label,R=!0;break;case"unit":if(o.selectedUnit=b,H(),o.currentData&&nt&&o.dataMin!==null&&o.dataMax!==null){const N=nt.querySelector("#map-canvas");if(N){Tt=N,Er(N),ir(o.currentData,Tt,ut,o.palette,o.dataMin,o.dataMax,o.variable,o.selectedUnit);const E=ut.find(P=>P.name===o.palette)||ut[0];nr("legend-gradient-canvas",E.colors)}}return;case"palette":if(o.palette=b,H(),o.canvasView==="map"&&o.currentData&&nt&&o.dataMin!==null&&o.dataMax!==null){const N=nt.querySelector("#map-canvas");if(N){Tt=N,ir(o.currentData,Tt,ut,o.palette,o.dataMin,o.dataMax,o.variable,o.selectedUnit);const E=ut.find(P=>P.name===o.palette)||ut[0];nr("legend-gradient-canvas",E.colors)}}return;case"compareMode":o.compareMode=b,R=!0;break;case"compareScenarioA":b===o.compareScenarioB&&(o.compareScenarioB=o.compareScenarioA),o.compareScenarioA=b,R=!0;break;case"compareScenarioB":b===o.compareScenarioA&&(o.compareScenarioA=o.compareScenarioB),o.compareScenarioB=b,R=!0;break;case"compareModelA":b===o.compareModelB&&(o.compareModelB=o.compareModelA),o.compareModelA=b,R=!0;break;case"compareModelB":b===o.compareModelA&&(o.compareModelA=o.compareModelB),o.compareModelB=b,R=!0;break;case"chartVariable":o.chartVariable=b,o.chartUnit=ze(b).label,I=!0;break;case"chartUnit":o.chartUnit=b,o.chartSamples.length&&(o.chartMode==="range"?(o.chartRangeSeries=_o(o.chartSamples,o.chartVariable,o.chartUnit),o.chartBoxes=null):o.chartBoxes=Do(o.chartSamples,o.chartVariable,o.chartUnit)),H();return;case"chartLocation":if(b==="Draw"){xa();return}if(b==="Point"){ba();return}if(b==="Search"){o.chartLocation="Search",o.chartPolygon=null,o.pointSelectActive=!1,o.drawState=_e(),o.chartError=null,o.chartLocationName=null,o.chartLocationSearchError=null,o.chartLocationSearchResults=[],o.chartLocationSearchQuery="",o.chartLocationSearchLoading=!1,o.canvasView="chart",Dn(),_n(),H();return}o.chartLocation="World",o.chartPolygon=null,o.chartPoint=null,o.chartLocationName=null,o.chartLocationSearchError=null,o.chartLocationSearchResults=[],o.chartLocationSearchQuery="",o.chartLocationSearchLoading=!1,Dn(),_n(),I=!0;break}H(),o.canvasView==="map"&&R&&$t(),o.canvasView==="chart"&&(I||R)&&Yt()},f=e.querySelector('.custom-select-wrapper[data-key="chartLocation"]');if(f){f.querySelectorAll(".custom-select-option").forEach(E=>{E.addEventListener("click",()=>{const P=E.dataset.value;P==="Draw"&&o.chartLocation==="Draw"?xa():P==="Point"&&o.chartLocation==="Point"&&ba()})});const b=f.querySelectorAll('[data-role="location-search-input"]'),R=f.querySelectorAll('[data-role="location-search-result"]'),I=()=>{re!==null&&(window.clearTimeout(re),re=null)},N=E=>{I(),nf(E)};if(b.forEach(E=>{E.addEventListener("input",()=>{const P=o.chartLocationSearchResults.length>0,h=o.chartLocationSearchLoading,k=!!o.chartLocationSearchError;if(o.chartLocationSearchQuery=E.value,o.chartLocationSearchError=null,I(),!E.value.trim()){o.chartLocationSearchResults=[],o.chartLocationSearchLoading=!1,H();return}(P||h||k)&&(o.chartLocationSearchResults=[],o.chartLocationSearchLoading=!1,H()),re=window.setTimeout(()=>{N(E.value)},Vd)}),E.addEventListener("keydown",P=>{P.key==="Enter"&&(P.preventDefault(),I(),N(E.value))})}),R.forEach(E=>{E.addEventListener("click",()=>{const P=Number(E.dataset.lat),h=Number(E.dataset.lon),k=E.dataset.name??"Selected place";!Number.isFinite(P)||!Number.isFinite(h)||(f.classList.remove("open"),ef({displayName:k,lat:P,lon:h}))})}),o.chartLocation==="Search"){const E=f.querySelector('[data-role="location-search-input"]');E&&setTimeout(()=>E.focus(),0)}}e.querySelectorAll('select[data-action="update-select"]').forEach(g=>g.addEventListener("change",async()=>{const b=g.dataset.key,R=g.value;b&&await d(b,R)})),e.querySelectorAll('[data-action="toggle-multi"]').forEach(g=>g.addEventListener("click",()=>{const b=g.dataset.key,R=g.dataset.value;if(!(!b||!R)){if(b==="chartScenarios"){const I=o.metaData?.scenarios?.length&&o.metaData.scenarios?Array.from(new Set(o.metaData.scenarios.map(Lr))):Ft,N=R==="Historical",E=new Set(o.chartScenarios);E.has(R)?E.delete(R):N?(E.clear(),E.add("Historical")):(E.delete("Historical"),E.add(R)),E.size===0&&E.add(N?"Historical":R),o.chartScenarios=Array.from(E).filter(h=>I.includes(h));const P=Cr(o.chartScenarios);o.chartDate=Wt(o.chartDate,P),o.chartRangeStart=Wt(o.chartRangeStart,P),o.chartRangeEnd=Wt(o.chartRangeEnd,P)}if(b==="chartModels"){const I=o.metaData?.models?.length&&o.metaData.models?o.metaData.models:yt,N=new Set(o.chartModels);N.has(R)?N.delete(R):N.add(R),o.chartModels=N.size?Array.from(N):[...I]}H(),o.canvasView==="chart"&&Yt()}})),e.querySelectorAll('[data-action="toggle-collapse"]').forEach(g=>g.addEventListener("click",()=>{const b=g.dataset.key;b&&(b==="chartScenarios"&&(o.chartDropdown.scenariosOpen=!o.chartDropdown.scenariosOpen),b==="chartModels"&&(o.chartDropdown.modelsOpen=!o.chartDropdown.modelsOpen),H())})),e.querySelectorAll('[data-action="update-input"]').forEach(g=>{const b=()=>{const R=g.dataset.key;if(!R)return;const I=g.value;if(!(/^\d{4}-\d{2}-\d{2}$/.test(I)&&!isNaN(new Date(I).getTime()))){g.style.borderColor="rgba(239, 68, 68, 0.6)";return}g.style.borderColor="";let h=I;if(R==="date"&&(h=ye(I,o.scenario),h!==I&&(g.value=h)),(R==="date"?o.date:R==="compareDateStart"?o.compareDateStart:R==="compareDateEnd"?o.compareDateEnd:R==="chartRangeStart"?o.chartRangeStart:R==="chartRangeEnd"?o.chartRangeEnd:o.chartDate)!==h){switch(R){case"date":o.date=h;break;case"compareDateStart":o.compareDateStart=I;break;case"compareDateEnd":o.compareDateEnd=I;break;case"chartDate":o.chartDate=I;break;case"chartRangeStart":o.chartRangeStart=I;break;case"chartRangeEnd":o.chartRangeEnd=I;break}H(),(R==="date"||o.mode==="Compare"&&(R==="compareDateStart"||R==="compareDateEnd"))&&$t(),o.canvasView==="chart"&&(R==="chartDate"||R==="chartRangeStart"||R==="chartRangeEnd")&&Yt()}};g.addEventListener("blur",b),g.addEventListener("keydown",R=>{R.key==="Enter"&&(R.preventDefault(),b(),g.blur())})});const L=e.querySelectorAll('[data-action="set-resolution"]'),M=e.querySelectorAll('[data-role="resolution-value"]'),v=g=>{const b=(g-1)/2*100,R=g===1?"Low":g===2?"Medium":"High";L.forEach(I=>{I.value=String(g),I.style.setProperty("--slider-fill",`${b}%`)}),M.forEach(I=>{I.textContent=R})};L.forEach(g=>g.addEventListener("input",()=>{const b=Number.parseInt(g.value,10);Number.isNaN(b)||(o.resolution=b,v(b),o.canvasView==="map"&&$t())})),e.querySelector('[data-action="open-compare-info"]')?.addEventListener("click",()=>{o.compareInfoOpen=!0,H()}),e.querySelectorAll('[data-action="close-compare-info"]').forEach(g=>g.addEventListener("click",()=>{o.compareInfoOpen=!1,H()})),Id({root:e,getTimeRange:()=>o.timeRange,onDateChange:g=>{o.date=g,$t()},getMode:()=>o.mode,getCompareMode:()=>o.compareMode,getCompareDates:()=>({start:o.compareDateStart,end:o.compareDateEnd}),onDateRangeChange:(g,b)=>{o.compareDateStart=g,o.compareDateEnd=b,$t()}});const C=e.querySelector('[data-action="chat-input"]'),w=e.querySelector('[data-action="chat-send"]');C?.addEventListener("input",()=>{o.chatInput=C.value}),C?.addEventListener("keydown",g=>{g.key==="Enter"&&(g.preventDefault(),Ta())}),w?.addEventListener("click",Ta)}function Ta(){const t=o.chatInput.trim();if(!t)return;const e={id:Date.now(),sender:"user",text:t};o.chatMessages=[...o.chatMessages,e],o.chatInput="",qn&&window.clearTimeout(qn),qn=window.setTimeout(()=>{const n={id:Date.now()+1,sender:"agent",text:"I don't work yet."};o.chatMessages=[...o.chatMessages,n],H()},1e3),H()}async function Da(){if(nt=document.querySelector("#app"),!nt)throw new Error("Root element #app not found");H(),Yd().then(()=>{H()}),o.canvasView==="map"&&o.mode==="Explore"&&$t()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Da):Da();
